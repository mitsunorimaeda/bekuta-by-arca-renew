import{a7 as e,a8 as t,j as a,a9 as r,N as s,E as l,V as n,aa as i,K as d,ab as o,P as c,Y as m,ac as x,ad as u,s as g,ae as p,Z as b,af as h,y}from"./index-DC548egD.js";import{r as f,d as v,R as _,L as j,C as k,X as N,Y as w,T as F,e as S,b as M,c as D}from"./chart-vendor-DEPfNMx8.js";import"./supabase-vendor-BgrwFlS9.js";const C=e=>e<=0?0:Math.max(0,(e-504.9)/44.73),B=(e,t)=>60*e+t,R=e=>e<=0?0:.0084*e+36.4,T=e=>e<=0?0:.0136*e+45.3,q=e=>{if(e<=0)return 0;const t={8:27.8,9:28,10:28.3,11:28.5,12:28.7,13:28.9,14:29.2,15:29.4,16:29.6,17:29.8,18:30.1,19:30.3,20:30.5,21:30.7,22:31,23:31.2,24:31.4,25:31.6,26:31.9,27:32.1,28:32.3,29:32.5,30:32.8,31:33,32:33.2,33:33.4,34:33.7,35:33.9,36:34.1,37:34.3,38:34.6,39:34.8,40:35,41:35.2,42:35.5,43:35.7,44:35.9,45:36.1,46:36.4,47:36.6,48:36.8,49:37,50:37.3,51:37.5,52:37.7,53:37.9,54:38.2,55:38.4,56:38.6,57:38.8,58:39.1,59:39.3,60:39.5,61:39.7,62:40,63:40.2,64:40.4,65:40.6,66:40.9,67:41.1,68:41.3,69:41.5,70:41.8,71:42,72:42.2,73:42.4,74:42.7,75:42.9,76:43.1,77:43.3,78:43.6,79:43.8,80:44,81:44.2,82:44.5,83:44.7,84:44.9,85:45.1,86:45.4,87:45.6,88:45.8,89:46,90:46.3,91:46.5,92:46.7,93:46.9,94:47.2,95:47.4,96:47.6,97:47.8,98:48.1,99:48.3,100:48.5,101:48.7,102:49,103:49.2,104:49.4,105:49.6,106:49.9,107:50.1,108:50.3,109:50.5,110:50.8,111:51,112:51.2,113:51.4,114:51.7,115:51.9,116:52.1,117:52.3,118:52.6,119:52.8,120:53,121:53.2,122:53.5,123:53.7,124:53.9,125:54.1,126:54.4,127:54.6,128:54.8,129:55,130:55.3,131:55.5,132:55.7,133:55.9,134:56.2,135:56.4,136:56.6,137:56.8,138:57.1,139:57.3,140:57.5,141:57.7,142:58,143:58.2,144:58.4,145:58.6,146:58.9,147:59.1,148:59.5,149:59.8,150:60,151:60.2,152:60.4,153:60.7,154:60.9,155:61.1,156:61.1,157:61.3};if(t[e])return t[e];if(e<8)return 27.8;if(e>157)return 61.3+.2*(e-157);const a=Math.floor(e),r=Math.ceil(e);return t[a]+(t[r]-t[a])*(e-a)},P=(e,t)=>e<=0||t<=0?0:1===t?e:Math.round(e*(1+t/30)*10)/10;function A(e){switch(e){case"cmj":case"cmj_as":case"standing_long_jump":case"standing_five_jump":return"cm";case"cooper_test":case"yoyo_ir1":case"yoyo_ir2":case"shuttle_run_20m":return"ml/kg/min";case"1000m_run":case"1500m_run":case"arrowhead_r":case"arrowhead_l":case"050_r":case"050_l":case"050-l":case"pro_agility_r":case"pro_agility_l":case"sprint_5m":case"sprint_10m":case"sprint_15m":case"sprint_20m":case"sprint_30m":case"sprint_50m":return"Áßí";case"bench_press":case"back_squat":case"deadlift":case"bulgarian_squat_r":case"bulgarian_squat_l":return"kg";case"dj_rsi":case"rj_rsi":return"RSI";default:return""}}function L(e,t){if(null==t||!Number.isFinite(t))return"-";const a=(e||"").toLowerCase();if(a.includes("rsi"))return Number(t).toFixed(2);if(new Set(["cooper_test","yoyo_ir1","yoyo_ir2","shuttle_run_20m"]).has(a))return Number(t).toFixed(1);if(new Set(["050_r","050_l","050-l","pro_agility_r","pro_agility_l","arrowhead_r","arrowhead_l","sprint_5m","sprint_10m","sprint_15m","sprint_20m","sprint_30m","sprint_50m"]).has(a))return Number(t).toFixed(2);return new Set(["bench_press","back_squat","deadlift","bulgarian_squat_r","bulgarian_squat_l"]).has(a)?Number(t).toFixed(1):String(t)}const E=["bench_press","back_squat","deadlift","bulgarian_squat_r","bulgarian_squat_l"];function W({userId:c,userRole:m,testTypes:x,onSubmit:u,onCheckExisting:g,onUpdate:p,loading:b,lastRecords:h,personalBests:y}){var v,_;const{getLatestWeight:j}=e(c),[k,N]=f.useState(""),[w,F]=f.useState(t()),[S,M]=f.useState({}),[D,W]=f.useState(""),[z,J]=f.useState(!1),[I,K]=f.useState(""),[Y,O]=f.useState(!1),[V,H]=f.useState(null),[U,X]=f.useState(null),[Z,$]=f.useState(!1),[G,Q]=f.useState(null),[ee,te]=f.useState(null),ae=f.useMemo(()=>x.find(e=>e.id===k),[x,k]);f.useEffect(()=>{if(!ae)return;const e={};Array.isArray(ae.fields)&&ae.fields.forEach(t=>{e[t.name]=""}),M(e);if(E.includes(ae.name)){const e=j();console.log("üèãÔ∏è Strength test selected, latest weight:",e),H(e)}else H(null),X(null)},[ae,j]);const re=e=>ae?function(e,t){try{switch(e){case"cmj":case"cmj_as":case"sqj":return parseFloat(t.height)||null;case"standing_long_jump":case"standing_five_jump":return parseFloat(t.distance)||null;case"dj_rsi":return t.height&&t.contact_time?parseFloat(t.height)/100/(parseFloat(t.contact_time)/1e3):null;case"rj_rsi":return t.avg_height&&t.avg_contact_time?parseFloat(t.avg_height)/100/(parseFloat(t.avg_contact_time)/1e3):null;case"cooper_test":return C(parseFloat(t.distance));case"1500m_run":return B(parseFloat(t.time_minutes),parseFloat(t.time_seconds));case"yoyo_ir1":return R(parseFloat(t.distance));case"yoyo_ir2":return T(parseFloat(t.distance));case"shuttle_run_20m":return q(parseFloat(t.count));case"bench_press":case"back_squat":case"deadlift":case"bulgarian_squat_r":case"bulgarian_squat_l":return P(parseFloat(t.weight),parseFloat(t.reps));case"1000m_run":return 60*parseFloat(t.time_minutes)+parseFloat(t.time_seconds);case"pull_up":case"side_step_test":return parseFloat(t.count)||null;case"050_r":case"050_l":case"050-l":case"pro_agility_r":case"pro_agility_l":case"arrowhead_r":case"arrowhead_l":case"sprint_5m":case"sprint_10m":case"sprint_15m":case"sprint_20m":case"sprint_30m":case"sprint_50m":return parseFloat(t.time)||null;default:return null}}catch(I){return console.error("Error calculating primary value:",I),null}}(ae.name,e):null,se=()=>{if(!ae)return"";return A(ae.name)||ae.unit},le=()=>{if(!ae)return"-";const e=re(S);return null===e?"-":L(ae.name,e)},ne=null==h?void 0:h.get(k),ie=null==y?void 0:y.get(k),de=()=>{$(!1),Q(null),te(null)},oe=(e,t)=>{const a={...S,[e]:t};M(a);if(!!ae&&E.includes(ae.name)&&("weight"===e||"reps"===e)&&V){const e=parseFloat(a.weight||"0"),t=parseFloat(a.reps||"0");if(console.log("üí™ Calculating relative 1RM from:",{weight:e,reps:t,latestWeight:V}),e>0&&t>0){const a=e*(1+t/30),r=a/V;console.log("‚úÖ 1RM:",a.toFixed(1),"kg, Relative 1RM:",r.toFixed(2)),X(Math.round(100*r)/100)}else X(null)}};return a.jsxs(a.Fragment,{children:[a.jsx(r,{isOpen:Z,onClose:de,onOverwrite:async()=>{if(G&&ee){J(!0),$(!1);try{await p(G.id,{values:ee.values,notes:ee.notes}),M({}),W(""),N(""),F(t()),Q(null),te(null),X(null),H(null)}catch(e){console.error("Error updating record:",e),K("Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{J(!1)}}},onCancel:de,existingRecord:G,newValue:(null==(v=null==ee?void 0:ee.values)?void 0:v.primary_value)||0}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),K(""),!ae)return void K("Ê∏¨ÂÆöÁ®ÆÁõÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ");const a=Array.isArray(ae.fields)?ae.fields.filter(e=>e.required):[];for(const t of a)if(!S[t.name]||""===S[t.name])return void K(`${t.label}„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`);const r=re(S);if(null===r)return void K("Ë®àÁÆó„Åß„Åç„Å™„ÅÑÂÄ§„ÅåÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô");const s=se();let l;l="Áßí"===s?Number(r.toFixed(2)):"ml/kg/min"===s?Number(r.toFixed(1)):"RSI"===s?Number(r.toFixed(2)):"kg"===s?Number(r.toFixed(1)):r;const n=E.includes(ae.name),i={...S,primary_value:l,...n&&V?{relative_1rm:U,weight_at_test:V}:{}},d=await g(k,w);if(d)return Q(d),te({test_type_id:k,date:w,values:i,notes:D||void 0,is_official:!0}),void $(!0);J(!0);try{(await u({test_type_id:k,date:w,values:i,notes:D||void 0,is_official:!0})).isNewPersonalBest&&(O(!0),setTimeout(()=>O(!1),5e3)),M({}),W(""),N(""),F(t()),X(null),H(null)}catch(o){console.error("Error submitting performance record:",o),K("Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{J(!1)}},className:"space-y-6",children:[Y&&a.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/30 border-2 border-yellow-400 dark:border-yellow-600 rounded-xl p-4 animate-bounce-subtle",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(s,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold text-yellow-900 dark:text-yellow-100",children:"üéâ „Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„ÉàÊõ¥Êñ∞ÔºÅ"}),a.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅËá™Â∑±ÊúÄÈ´òË®òÈå≤„ÇíÈÅîÊàê„Åó„Åæ„Åó„ÅüÔºÅ"})]})]})}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"Ê∏¨ÂÆöÊó•"]}),a.jsx("input",{type:"date",value:w,onChange:e=>F(e.target.value),max:t(),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white",style:{fontSize:"16px"}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ê∏¨ÂÆöÁ®ÆÁõÆ"}),a.jsxs("select",{value:k,onChange:e=>N(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white",style:{fontSize:"16px"},children:[a.jsx("option",{value:"",children:"Ê∏¨ÂÆöÁ®ÆÁõÆ„ÇíÈÅ∏Êäû"}),x.filter(e=>!1!==e.user_can_input).map(e=>a.jsx("option",{value:e.id,children:e.display_name},e.id)),x.filter(e=>!1===e.user_can_input).map(e=>a.jsxs("option",{value:e.id,disabled:!0,className:"text-gray-400",children:["üîí ",e.display_name,"ÔºàÂ∞ÇÈñÄÊ•≠ËÄÖÊ∏¨ÂÆöÔºâ"]},e.id))]}),ae&&a.jsxs("div",{className:"mt-2",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:ae.description}),!1===ae.user_can_input&&a.jsxs("div",{className:"mt-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3 flex items-start",children:[a.jsx(n,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mr-2 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:[a.jsx("p",{className:"font-semibold",children:"Â∞ÇÈñÄÊ•≠ËÄÖ„Å´„Çà„ÇãÊ∏¨ÂÆö„ÅåÂøÖË¶Å„Åß„Åô"}),a.jsx("p",{className:"mt-1",children:"„Åì„ÅÆÊ∏¨ÂÆö„ÅØÂ∞ÇÁî®Ê©üÂô®„ÅåÂøÖË¶Å„Å™„Åü„ÇÅ„ÄÅÂÄã‰∫∫„Åß„ÅÆÂÖ•Âäõ„ÅØ„Åß„Åç„Åæ„Åõ„Çì„ÄÇÊ∏¨ÂÆö„Éá„Éº„Çø„ÅØÂ∞ÇÈñÄÊ•≠ËÄÖ„Å´„Çà„Å£„Å¶Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ"})]})]})]})]}),ae&&Array.isArray(ae.fields)&&a.jsxs(a.Fragment,{children:[ne&&a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-sm",children:[a.jsx("p",{className:"text-blue-600 dark:text-blue-400 mb-1",children:"ÂâçÂõû„ÅÆË®òÈå≤"}),a.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:[L(ae.name,Number(null==(_=ne.values)?void 0:_.primary_value))," ",se()," ","(",new Date(ne.date).toLocaleDateString("ja-JP"),")"]})]}),ie&&a.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-3 text-sm",children:[a.jsxs("p",{className:"text-yellow-600 dark:text-yellow-400 mb-1 flex items-center",children:[a.jsx(s,{className:"w-4 h-4 mr-1"}),"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"]}),a.jsxs("p",{className:"text-yellow-700 dark:text-yellow-300 font-semibold",children:[L(ae.name,Number(ie.value))," ",se()," ","(",new Date(ie.date).toLocaleDateString("ja-JP"),")"]})]}),a.jsx("div",{className:"space-y-4",children:ae.fields.map(e=>{var t;return a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.label," ",e.required&&a.jsx("span",{className:"text-red-500",children:"*"}),e.unit&&a.jsxs("span",{className:"text-gray-500 text-xs ml-1",children:["(",e.unit,")"]})]}),"select"===e.type?a.jsxs("select",{value:S[e.name]||"",onChange:t=>oe(e.name,t.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white",style:{fontSize:"16px"},children:[a.jsxs("option",{value:"",children:[e.label,"„ÇíÈÅ∏Êäû"]}),null==(t=e.options)?void 0:t.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}):a.jsx("input",{type:"text"===e.type?"text":"number",inputMode:"text"===e.type?"text":"decimal",step:"text"===e.type?void 0:"0.01",min:"text"===e.type?void 0:0,value:S[e.name]||"",onChange:t=>oe(e.name,t.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white",placeholder:e.label,style:{fontSize:"16px"}})]},e.name)})}),a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4 transition-colors",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:ae?function(e){switch(e){case"sqj":case"cmj":case"cmj_as":return"Ë∑≥Ë∫çÈ´ò";case"standing_long_jump":case"standing_five_jump":return"Ë∑ùÈõ¢";case"cooper_test":case"yoyo_ir1":case"yoyo_ir2":case"shuttle_run_20m":return"Êé®ÂÆöVO2max";case"1500m_run":case"1000m_run":case"arrowhead_r":case"arrowhead_l":case"050_r":case"050_l":case"050-l":case"pro_agility_r":case"pro_agility_l":return"„Çø„Ç§„É†";case"bench_press":case"back_squat":case"deadlift":case"bulgarian_squat_r":case"bulgarian_squat_l":return"Êé®ÂÆö1RM";case"dj_rsi":case"rj_rsi":return"RSI";default:return"Ë®àÁÆóÂÄ§"}}(ae.name):"Ë®àÁÆóÂÄ§"}),a.jsxs("span",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[le()," ",se()]})]})}),ae&&E.includes(ae.name)&&a.jsxs("div",{className:"space-y-3",children:[V&&a.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 transition-colors",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(i,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2"}),a.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Ê∏¨ÂÆöÊôÇ„ÅÆ‰ΩìÈáç"})]}),a.jsxs("span",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[V.toFixed(1)," kg"]})]}),a.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"ÊúÄÊñ∞„ÅÆ‰ΩìÈáçË®òÈå≤„Åã„ÇâËá™ÂãïÂèñÂæó"})]}),U&&V&&a.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-4 transition-colors",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Áõ∏ÂØæ1RMÔºà‰ΩìÈáçÊØîÔºâ"}),a.jsx("span",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:U.toFixed(2)})]}),a.jsxs("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:["1RM ",le()," kg √∑ ‰ΩìÈáç ",V.toFixed(1)," kg = ",U.toFixed(2)]})]}),!V&&a.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(d,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-200",children:"‰ΩìÈáçË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),a.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mt-1",children:"Áõ∏ÂØæ1RMÔºà‰ΩìÈáçÊØîÔºâ„ÇíË®àÁÆó„Åô„Çã„Å´„ÅØ„ÄÅ‰ΩìÈáçË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]})]})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),a.jsx("textarea",{value:D,onChange:e=>W(e.target.value),rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white resize-none",placeholder:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÇÑÊ∞ó„Å•„ÅÑ„Åü„Åì„Å®„ÇíË®òÈå≤...",style:{fontSize:"16px"}})]}),I&&a.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(d,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),a.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:I})]})}),a.jsxs("button",{type:"submit",disabled:z||b||!k||!1===(null==ae?void 0:ae.user_can_input),className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:[z?a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):a.jsx(o,{className:"w-5 h-5 mr-2"}),z?"Ë®òÈå≤‰∏≠...":"Ê∏¨ÂÆöË®òÈå≤„ÇíËøΩÂä†"]})]})]})}function z({records:e,personalBests:t,loading:r}){const n=e=>{if(null==e||""===e)return null;const t="string"==typeof e?parseFloat(e):Number(e);return Number.isFinite(t)?t:null},i=e=>{var t,a;return A((null==(t=e.test_type)?void 0:t.name)||"")||(null==(a=e.test_type)?void 0:a.unit)||""};if(r)return a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(0===e.length)return a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:a.jsx(c,{className:"w-8 h-8 text-gray-400"})}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"„Åæ„Å†Ê∏¨ÂÆöË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:"ÊúÄÂàù„ÅÆË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„ÄÅÊàêÈï∑„ÇíËøΩË∑°„Åó„Åæ„Åó„Çá„ÅÜÔºÅ"})]});const d=e.reduce((e,t)=>{if(!t.test_type)return e;const a=t.test_type.display_name;return e[a]||(e[a]=[]),e[a].push(t),e},{});return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ê∏¨ÂÆöË®òÈå≤Â±•Ê≠¥"}),a.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ÂÖ® ",e.length," ‰ª∂"]})]}),Object.entries(d).map(([r,d])=>{var o,g;const p=d[0],b=i(p),h=!!(null==(o=p.test_type)?void 0:o.higher_is_better);return a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden transition-colors",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:r}),a.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:[b," - ",h?"È´ò„ÅÑÊñπ„ÅåËâØ„ÅÑ":"‰Ωé„ÅÑÊñπ„ÅåËâØ„ÅÑ"]})]}),!1===(null==(g=p.test_type)?void 0:g.user_can_input)&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300",children:[a.jsx(m,{className:"w-3 h-3 mr-1"}),"Â∞ÇÈñÄÊ•≠ËÄÖÊ∏¨ÂÆö"]})]})}),a.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:d.map(r=>{var d,o,m,g,p,b;const h=(e=>{var a,r;const s=t.find(t=>t.test_type_id===e.test_type_id);if(!s)return!1;const l=(null==(a=e.test_type)?void 0:a.name)||"",i=n(null==(r=e.values)?void 0:r.primary_value),d=n(s.value);if(null===i||null===d)return!1;const o=L(l,i),c=L(l,d);return s.date===e.date&&o===c})(r),y=(t=>{var a,r;if(!t.test_type)return null;const s=e.filter(e=>e.test_type_id===t.test_type_id).filter(e=>new Date(e.date)<new Date(t.date)).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())[0];if(!s)return null;const l=n(null==(a=t.values)?void 0:a.primary_value),i=n(null==(r=s.values)?void 0:r.primary_value);return null===l||null===i||0===i?null:(l-i)/Math.abs(i)*100})(r),f=(null==(d=r.test_type)?void 0:d.name)||"",v=i(r),_=L(f,n(null==(o=r.values)?void 0:o.primary_value)),j=null!==y&&(y>0&&(null==(m=r.test_type)?void 0:m.higher_is_better)||y<0&&!(null==(g=r.test_type)?void 0:g.higher_is_better)),k=n(null==(p=r.values)?void 0:p.relative_1rm),N=n(null==(b=r.values)?void 0:b.weight_at_test);return a.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors "+(h?"bg-yellow-50 dark:bg-yellow-900/10 border-l-4 border-yellow-400":""),children:a.jsx("div",{className:"flex items-start justify-between",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(l,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(r.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}),h&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300",children:[a.jsx(c,{className:"w-3 h-3 mr-1"}),"PB"]})]}),a.jsxs("div",{className:"flex items-baseline space-x-2 mb-2",children:[a.jsx("span",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:_}),a.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:v}),null!==y&&a.jsxs("span",{className:"text-sm font-medium flex items-center "+(j?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[j?a.jsx(s,{className:"w-4 h-4 mr-1"}):a.jsx(x,{className:"w-4 h-4 mr-1"}),Math.abs(y).toFixed(1),"%"]})]}),r.test_type&&["bench_press","back_squat","deadlift","bulgarian_squat_r","bulgarian_squat_l"].includes(r.test_type.name)&&null!==k&&a.jsxs("div",{className:"mb-2 inline-flex items-center px-3 py-1.5 rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20",children:[a.jsx("span",{className:"text-xs font-medium text-purple-700 dark:text-purple-300 mr-2",children:"Áõ∏ÂØæ1RM:"}),a.jsx("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:k.toFixed(2)}),null!==N&&a.jsxs("span",{className:"text-xs text-purple-600 dark:text-purple-400 ml-2",children:["(‰ΩìÈáç ",N.toFixed(1)," kg)"]})]}),r.test_type&&Array.isArray(r.test_type.fields)&&a.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-400",children:r.test_type.fields.map(e=>{var t;const s=null==(t=r.values)?void 0:t[e.name];return null==s||""===s?null:a.jsxs("div",{children:[a.jsxs("span",{className:"font-medium",children:[e.label,":"]})," ",s," ",e.unit]},e.name)})}),r.notes&&a.jsxs("div",{className:"mt-2 flex items-start space-x-2",children:[a.jsx(u,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.notes})]})]})})},r.id)})})]},r)})]})}const J=v.memo(function({records:e,personalBest:t,testTypeName:r,metricKey:s="primary_value",unitLabel:l,teamMonthly:n=[]}){var i;if(!e||0===e.length)return a.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"});const d=f.useMemo(()=>[...e].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),[e]),o=null==(i=e[0])?void 0:i.test_type,c=(null==o?void 0:o.higher_is_better)??!0,m=f.useMemo(()=>l||("relative_1rm"===s?"√óBW":(null==o?void 0:o.unit)||""),[l,s,null==o?void 0:o.unit]),x=f.useMemo(()=>{var e;return"relative_1rm"===s||(null==(e=null==o?void 0:o.name)?void 0:e.includes("rsi"))?2:1},[s,null==o?void 0:o.name]),u=f.useMemo(()=>d.map(e=>{const t=(e=>{var t,a;const r="relative_1rm"===s?null==(t=e.values)?void 0:t.relative_1rm:null==(a=e.values)?void 0:a.primary_value,l="string"==typeof r?parseFloat(r):r;return Number.isFinite(l)?l:null})(e);return{x:e.date,dateLabel:new Date(e.date).toLocaleDateString("ja-JP",{month:"short",day:"numeric"}),value:t,team_avg:null,team_n:null,unit:m,notes:e.notes||"",kind:"athlete"}}),[d,s,m]),g=f.useMemo(()=>(n??[]).filter(e=>null!==(null==e?void 0:e.team_avg)&&void 0!==(null==e?void 0:e.team_avg)).map(e=>{const t="string"==typeof e.month_start?e.month_start:String(e.month_start);return{x:t,dateLabel:new Date(t).toLocaleDateString("ja-JP",{year:"numeric",month:"short"}),value:null,team_avg:e.team_avg,team_n:e.team_n??null,unit:m,notes:"",kind:"team"}}),[n,m]),p=f.useMemo(()=>[...u,...g].sort((e,t)=>new Date(e.x).getTime()-new Date(t.x).getTime()).map(e=>({...e,date:"team"===e.kind?e.dateLabel:new Date(e.x).toLocaleDateString("ja-JP",{month:"short",day:"numeric"}),fullDate:e.x})),[u,g]),b=f.useMemo(()=>{const e=[];for(const t of p)"number"==typeof t.value&&Number.isFinite(t.value)&&e.push(t.value),"number"==typeof t.team_avg&&Number.isFinite(t.team_avg)&&e.push(t.team_avg);return e.length?e:[0]},[p]),h=Math.min(...b),y=Math.max(...b),v=y-h||1,C=Math.max(0,h-.1*v),B=y+.1*v,R=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:new Date(e.fullDate).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}),null!==e.value&&void 0!==e.value&&a.jsxs("p",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:["ÂÄã‰∫∫: ",Number(e.value).toFixed(x)," ",m]}),null!==e.team_avg&&void 0!==e.team_avg&&a.jsxs("p",{className:"text-sm font-semibold text-indigo-600 dark:text-indigo-300 mt-1",children:["„ÉÅ„Éº„É†ÊúàÊ¨°Âπ≥Âùá: ",Number(e.team_avg).toFixed(x)," ",m,e.team_n?a.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:["(n=",e.team_n,")"]}):null]}),e.notes&&a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 max-w-xs",children:e.notes})]})}return null},T=f.useMemo(()=>u.map(e=>"number"==typeof e.value&&Number.isFinite(e.value)?e.value:null).filter(e=>null!==e),[u]),q=f.useMemo(()=>{var e;for(let t=u.length-1;t>=0;t--){const a=null==(e=u[t])?void 0:e.value;if("number"==typeof a&&Number.isFinite(a))return a}return null},[u]),P=f.useMemo(()=>T.length?c?Math.max(...T):Math.min(...T):null,[T,c]);return a.jsxs("div",{className:"w-full",children:[r&&a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:[r," „ÅÆÊé®Áßª"]}),t&&a.jsx("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:a.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[a.jsx("span",{className:"font-semibold",children:"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà:"})," ",t.value.toFixed(x)," ",m,a.jsxs("span",{className:"text-xs ml-2",children:["(",new Date(t.date).toLocaleDateString("ja-JP"),")"]})]})}),a.jsx(_,{width:"100%",height:400,children:a.jsxs(j,{data:p,margin:{top:5,right:30,left:20,bottom:5},children:[a.jsx(k,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),a.jsx(N,{dataKey:"date",className:"text-xs",stroke:"#9CA3AF",tick:{fill:"#9CA3AF"}}),a.jsx(w,{domain:[C,B],className:"text-xs",stroke:"#9CA3AF",tick:{fill:"#9CA3AF"},label:{value:m||"",angle:-90,position:"insideLeft",style:{fill:"#9CA3AF",fontSize:"12px"}}}),a.jsx(F,{content:a.jsx(R,{})}),a.jsx(S,{wrapperStyle:{paddingTop:"20px"},iconType:"line"}),t&&a.jsx(M,{y:t.value,stroke:"#F59E0B",strokeDasharray:"5 5",label:{value:"PB",position:"right",fill:"#F59E0B",fontSize:12,fontWeight:"bold"}}),a.jsx(D,{type:"monotone",dataKey:"value",name:"relative_1rm"===s?"ÂÄã‰∫∫ÔºàÁõ∏ÂØæÔºâ":(null==o?void 0:o.display_name)||"ÂÄã‰∫∫",stroke:"#3B82F6",strokeWidth:3,dot:{r:5,fill:"#3B82F6",strokeWidth:2,stroke:"#fff"},activeDot:{r:7,fill:"#2563EB",strokeWidth:2,stroke:"#fff"},connectNulls:!1}),(null==n?void 0:n.length)>0&&a.jsx(D,{type:"monotone",dataKey:"team_avg",name:"relative_1rm"===s?"„ÉÅ„Éº„É†ÊúàÊ¨°Âπ≥ÂùáÔºàÁõ∏ÂØæ/ÊúÄÊñ∞Ôºâ":"„ÉÅ„Éº„É†ÊúàÊ¨°Âπ≥ÂùáÔºàÊúÄÊñ∞Ôºâ",stroke:"#6366F1",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0,strokeDasharray:"4 4"})]})}),T.length>1&&a.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"ÊúÄÊñ∞Ë®òÈå≤"}),a.jsxs("p",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:[null!==q?Number(q).toFixed(x):"-"," ",m]})]}),a.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[a.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:[c?"ÊúÄÈ´ò":"ÊúÄ‰Ωé","Ë®òÈå≤"]}),a.jsxs("p",{className:"text-lg font-bold text-green-700 dark:text-green-300",children:[null!==P?Number(P).toFixed(x):"-"," ",m]})]}),a.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400 mb-1",children:"Ê∏¨ÂÆöÂõûÊï∞"}),a.jsxs("p",{className:"text-lg font-bold text-purple-700 dark:text-purple-300",children:[T.length," Âõû"]})]})]})]})});function I({testTypes:e,records:t,personalBests:r,getRecordsByTestType:n,getPersonalBest:i}){const[d,o]=f.useState(null),[m,x]=f.useState({}),[u,p]=f.useState({}),[b,h]=f.useState({}),[y,v]=f.useState({}),[_,j]=f.useState(!1),k=["bench_press","back_squat","deadlift","bulgarian_squat_r","bulgarian_squat_l"],[N,w]=f.useState({}),F=f.useMemo(()=>d?e.find(e=>e.id===d):null,[d,e]),S=f.useMemo(()=>d?n(d):[],[d,n]),M=f.useMemo(()=>d&&F&&k.includes(F.name)?N[d]??"primary_value":"primary_value",[d,F,N]),D=f.useMemo(()=>{if(!F||0===S.length)return;const e=F.higher_is_better??!0;return function(e,t,a){var r;let s=null;for(const l of e){const e=null==(r=null==l?void 0:l.values)?void 0:r[t],n="string"==typeof e?parseFloat(e):e;null==n||Number.isNaN(n)||(s?(a?n>s.value:n<s.value)&&(s={value:n,date:l.date}):s={value:n,date:l.date})}return s?{value:s.value,date:s.date}:void 0}(S,M,e)},[F,S,M]);if(f.useEffect(()=>{if(!t||0===t.length)return;let e=!1;return(async()=>{try{j(!0);const[{data:t,error:a},{data:r,error:s}]=await Promise.all([g.rpc("get_my_team_benchmarks",{p_days:90,p_metric:"primary_value"}),g.rpc("get_my_team_benchmarks",{p_days:90,p_metric:"relative_1rm"})]);if(a)throw a;if(s)throw s;const l={};(t??[]).forEach(e=>{(null==e?void 0:e.test_type_id)&&(l[e.test_type_id]=e)});const n={};(r??[]).forEach(e=>{(null==e?void 0:e.test_type_id)&&(n[e.test_type_id]=e)}),e||(h(l),v(n))}catch(t){console.warn("[get_my_team_benchmarks error]",t),e||(h({}),v({}))}finally{e||j(!1)}})(),()=>{e=!0}},[null==t?void 0:t.length]),f.useEffect(()=>{if(!d)return;let e=!1;return(async()=>{try{const{data:t,error:a}=await g.rpc("get_my_team_monthly_averages",{p_test_type_id:d,p_metric:M,p_months:6});if(a)throw a;if(e)return;const r=(t??[]??[]).map(e=>{const t=(null==e?void 0:e.month_start)??(null==e?void 0:e.month)??(null==e?void 0:e.month_start_date)??(null==e?void 0:e.month_start_at)??(null==e?void 0:e.month_begin)??null,a=(null==e?void 0:e.team_avg)??(null==e?void 0:e.avg)??(null==e?void 0:e.mean)??(null==e?void 0:e.team_mean)??null,r=(null==e?void 0:e.team_n)??(null==e?void 0:e.n)??(null==e?void 0:e.count)??null;return t?{month_start:String(t),team_avg:null==a?null:Number(a),team_n:null==r?null:Number(r)}:null}).filter(Boolean);"relative_1rm"===M?p(e=>({...e,[d]:r})):x(e=>({...e,[d]:r}))}catch(t){if(console.warn("[get_my_team_monthly_averages error]",t),e)return;"relative_1rm"===M?p(e=>({...e,[d]:[]})):x(e=>({...e,[d]:[]}))}})(),()=>{e=!0}},[d,M]),0===t.length)return a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-8 text-center transition-colors",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-full mb-4",children:a.jsx(c,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),a.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Ê∏¨ÂÆö„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"ÊúÄÂàù„ÅÆÊ∏¨ÂÆö„ÇíË®òÈå≤„Åó„Å¶„ÄÅÊàêÈï∑„ÇíËøΩË∑°„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"})]});const C=e=>A(e.name||"")||e.unit,B=(e,t)=>{const a="string"==typeof e?parseFloat(e):e;return null==a||Number.isNaN(a)?"-":a.toFixed(t.includes("rsi")?2:1)};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>{const t=i(e.id),r=n(e.id),m=r[0],x=k.includes(e.name)?N[e.id]??"primary_value":"primary_value",u="relative_1rm"===x?y[e.id]:b[e.id],g=!!u&&!!u.team_n&&u.team_n>=2,p="relative_1rm"===x?"√óBW":C(e),h=e.name.includes("rsi")?2:1,f=e=>null==e?"-":Number(e).toFixed(h);return a.jsxs("button",{onClick:()=>o(e.id),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 text-left transition-all hover:shadow-md "+(d===e.id?"ring-2 ring-blue-500 dark:ring-blue-400":""),children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:e.display_name}),t&&a.jsx(c,{className:"w-5 h-5 text-yellow-500 flex-shrink-0"})]}),t?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"}),a.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[t.value.toFixed(e.name.includes("rsi")?2:1),a.jsx("span",{className:"text-sm ml-1 text-gray-600 dark:text-gray-400",children:C(e)})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(t.date).toLocaleDateString("ja-JP")})]}),m&&m.date!==t.date&&a.jsxs("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"ÊúÄÊñ∞Ë®òÈå≤"}),a.jsxs("p",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400",children:[B(m.values.primary_value,e.name),a.jsx("span",{className:"text-xs ml-1 text-gray-600 dark:text-gray-400",children:C(e)})]})]})]}):r.length>0?a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"ÊúÄÊñ∞Ë®òÈå≤"}),a.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[B(m.values.primary_value,e.name),a.jsx("span",{className:"text-sm ml-1 text-gray-600 dark:text-gray-400",children:C(e)})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(m.date).toLocaleDateString("ja-JP")})]}):a.jsx("div",{className:"text-center py-4",children:a.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Êú™Ê∏¨ÂÆö"})}),r.length>0&&a.jsxs("div",{className:"mt-3",children:[k.includes(e.name)&&a.jsxs("div",{className:"mb-2 inline-flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1 text-[11px]",children:[a.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),w(t=>({...t,[e.id]:"primary_value"}))},className:"px-2 py-1 rounded-md "+("primary_value"===(N[e.id]??"primary_value")?"bg-white dark:bg-gray-800 shadow text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-300"),children:"Êé®ÂÆö1RM"}),a.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),w(t=>({...t,[e.id]:"relative_1rm"}))},className:"px-2 py-1 rounded-md "+("relative_1rm"===(N[e.id]??"primary_value")?"bg-white dark:bg-gray-800 shadow text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-300"),children:"Áõ∏ÂØæ1RM"})]}),g?a.jsxs("div",{className:"flex flex-wrap gap-2",children:[null!==u.team_avg&&void 0!==u.team_avg&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200",children:["„ÉÅ„Éº„É†Âπ≥Âùá ",f(u.team_avg),p]}),null!==u.diff_vs_team_avg&&void 0!==u.diff_vs_team_avg&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium "+(u.diff_vs_team_avg>=0?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-200":"bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-200"),children:["Âπ≥ÂùáÂ∑Æ ",u.diff_vs_team_avg>=0?"+":"",f(u.diff_vs_team_avg),p]}),null!==u.team_rank&&void 0!==u.team_rank&&u.team_n&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-200",children:[u.team_n,"‰∫∫‰∏≠ ",u.team_rank,"‰Ωç"]}),null!==u.team_top_percent&&void 0!==u.team_top_percent&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200",children:["‰∏ä‰Ωç ",Number(u.team_top_percent).toFixed(1),"%"]}),u.team_n&&u.team_n<10&&a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:"ÂèÇËÄÉÔºànÂ∞ëÔºâ"})]}):a.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:_?"„ÉÅ„Éº„É†ÊØîËºÉ„ÇíË®àÁÆó‰∏≠‚Ä¶":"„ÉÅ„Éº„É†ÊØîËºÉ„ÅØ„Éá„Éº„Çø‰∏çË∂≥Ôºàn<2Ôºâ"})]}),r.length>0&&a.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{className:"flex items-center",children:[a.jsx(l,{className:"w-3 h-3 mr-1"}),r.length,"ÂõûÊ∏¨ÂÆö"]}),r.length>1&&a.jsxs("span",{className:"flex items-center text-blue-600 dark:text-blue-400",children:[a.jsx(s,{className:"w-3 h-3 mr-1"}),"„Ç∞„É©„Éï„ÇíË¶ã„Çã"]})]})]},e.id)})}),F&&S.length>0&&a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[F.display_name," „ÅÆÊàêÈï∑„Ç∞„É©„Éï"]}),(()=>{const e="relative_1rm"===M?y[F.id]:b[F.id];if(!(!!e&&!!e.team_n&&e.team_n>=2))return null;const t="relative_1rm"===M?"√óBW":C(F),r=F.name.includes("rsi")?2:1;return a.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:["„ÉÅ„Éº„É†Âπ≥Âùá: ",(s=e.team_avg,null==s?"-":Number(s).toFixed(r)),t," / ",e.team_n,"‰∫∫‰∏≠ ",e.team_rank??"-","‰ΩçÔºà‰∏ä‰Ωç"," ",null!==e.team_top_percent&&void 0!==e.team_top_percent?Number(e.team_top_percent).toFixed(1):"-","%Ôºâ"]});var s})()]}),a.jsx("button",{onClick:()=>o(null),className:"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Èñâ„Åò„Çã"})]}),a.jsx(J,{records:S,personalBest:D,testTypeName:F.display_name,metricKey:M,unitLabel:"relative_1rm"===M?"√óBW":C(F),teamMonthly:"relative_1rm"===M?u[F.id]??[]:m[F.id]??[]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-1",children:"Á∑èÊ∏¨ÂÆöÂõûÊï∞"}),a.jsx("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-100",children:t.length})]}),a.jsx(l,{className:"w-10 h-10 text-blue-600 dark:text-blue-400 opacity-50"})]})}),a.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/30 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-1",children:"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"}),a.jsx("p",{className:"text-3xl font-bold text-yellow-900 dark:text-yellow-100",children:r.length})]}),a.jsx(c,{className:"w-10 h-10 text-yellow-600 dark:text-yellow-400 opacity-50"})]})}),a.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-1",children:"Ê∏¨ÂÆöÁ®ÆÁõÆ"}),a.jsx("p",{className:"text-3xl font-bold text-green-900 dark:text-green-100",children:e.filter(e=>n(e.id).length>0).length}),a.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["/ ",e.length]})]}),a.jsx(s,{className:"w-10 h-10 text-green-600 dark:text-green-400 opacity-50"})]})})]})]})}function K({testName:e,testTypeName:t,value:r,unit:l,previousBest:n,onClose:i}){f.useEffect(()=>{const e=Date.now()+3e3,t={startVelocity:30,spread:360,ticks:60,zIndex:9999};function a(e,t){return Math.random()*(t-e)+e}const r=setInterval(function(){const s=e-Date.now();if(s<=0)return clearInterval(r);const l=s/3e3*50;p({...t,particleCount:l,origin:{x:a(.1,.3),y:Math.random()-.2}}),p({...t,particleCount:l,origin:{x:a(.7,.9),y:Math.random()-.2}})},250);return()=>clearInterval(r)},[]);const d=n?(r-n)/n*100:null,o=L((t||"").trim()||(e||"").trim(),r),m=null!==d?d.toFixed(1):null;return a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:[a.jsx("div",{className:"bg-gradient-to-br from-yellow-50 via-yellow-100 to-orange-100 dark:from-yellow-900/40 dark:via-yellow-800/40 dark:to-orange-900/40 rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform animate-scale-up border-4 border-yellow-400 dark:border-yellow-600",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mb-6 animate-bounce-slow shadow-lg",children:a.jsx(c,{className:"w-12 h-12 text-white"})}),a.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2 animate-fade-in",children:"üéâ „Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„ÉàÊõ¥Êñ∞ÔºÅ"}),a.jsx("p",{className:"text-lg text-gray-700 dark:text-gray-200 mb-6",children:e}),a.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 rounded-xl p-6 mb-6 shadow-inner",children:[a.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[a.jsx(b,{className:"w-8 h-8 text-yellow-500 animate-pulse"}),a.jsx("div",{className:"text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-orange-600 dark:from-yellow-400 dark:to-orange-400",children:o}),a.jsx("span",{className:"text-2xl text-gray-600 dark:text-gray-300",children:l})]}),null!==m&&a.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-600 dark:text-green-400",children:[a.jsx(s,{className:"w-5 h-5"}),a.jsxs("span",{className:"text-lg font-semibold",children:["ÂâçÂõûÊØî +",m,"%"]})]})]}),a.jsxs("div",{className:"space-y-2 mb-6",children:[a.jsx("p",{className:"text-gray-700 dark:text-gray-300 font-medium",children:"Á¥†Êô¥„Çâ„Åó„ÅÑÊàêÊûú„Åß„ÅôÔºÅ"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Êó•„ÄÖ„ÅÆÂä™Âäõ„ÅåÂÆü„ÇíÁµê„Å≥„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ"})]}),a.jsx("button",{onClick:i,className:"w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:"Á∂ö„Åë„Çã"})]})}),a.jsx("style",{children:"\n        @keyframes scale-up {\n          from { transform: scale(0.8); opacity: 0; }\n          to { transform: scale(1); opacity: 1; }\n        }\n        @keyframes bounce-slow {\n          0%, 100% { transform: translateY(0); }\n          50% { transform: translateY(-10px); }\n        }\n        @keyframes fade-in {\n          from { opacity: 0; transform: translateY(-10px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        .animate-scale-up { animation: scale-up 0.4s ease-out; }\n        .animate-bounce-slow { animation: bounce-slow 2s infinite; }\n        .animate-fade-in { animation: fade-in 0.6s ease-out; }\n      "})]})}function Y({user:e,onBackHome:t}){const[r,s]=f.useState("jump"),{testTypes:l,records:n,personalBests:i,loading:d,addRecord:o,updateRecord:c,checkExistingRecord:m,getRecordsByTestType:x,getPersonalBest:u}=h(e.id,r),[g,p]=f.useState(null),v=f.useCallback(e=>{switch(e){case"jump":return"„Ç∏„É£„É≥„ÉóÊ∏¨ÂÆö";case"endurance":return"ÂÖ®Ë∫´ÊåÅ‰πÖÂäõÊ∏¨ÂÆö";case"strength":return"Á≠ãÂäõÊ∏¨ÂÆö";case"sprint":return"„Çπ„Éó„É™„É≥„ÉàÊ∏¨ÂÆö";case"agility":return"„Ç¢„Ç∏„É™„ÉÜ„Ç£Ê∏¨ÂÆö";default:return"„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ∏¨ÂÆö"}},[]),_=f.useCallback(async(e,t)=>{await c(e,t)},[c]),j=f.useCallback(async e=>{var t;const a=await o(e);if(null==a?void 0:a.isNewPersonalBest){const a=l.find(t=>t.id===e.test_type_id),r=u(e.test_type_id);a&&p({testName:a.display_name,value:Number((null==(t=null==e?void 0:e.values)?void 0:t.primary_value)??0),unit:a.unit,previousBest:null==r?void 0:r.value})}return a},[o,l,u]),{lastPerformanceRecords:k,personalBestsMap:N}=f.useMemo(()=>{const e=new Map,t=new Map;for(const a of l){const r=x(a.id);r&&r.length>0&&e.set(a.id,r[0]);const s=u(a.id);s&&t.set(a.id,s)}return{lastPerformanceRecords:e,personalBestsMap:t}},[l,x,u]);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("button",{type:"button",onClick:t,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:opacity-90 active:opacity-80 transition",children:[a.jsx(y,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"„Éõ„Éº„É†„Å∏Êàª„Çã"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(b,{className:"w-5 h-5 text-yellow-500"}),a.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[a.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[i.length>0&&a.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl shadow-sm p-4 border-2 border-yellow-300 dark:border-yellow-700",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3 flex items-center",children:[a.jsx(b,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2"}),"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"]}),a.jsx("div",{className:"space-y-2",children:i.slice(0,3).map(e=>{var t;const r=null==(t=l.find(t=>t.id===e.test_type_id))?void 0:t.unit,s=Number(e.value??0),n=String(e.test_name??"").toLowerCase().includes("rsi");return a.jsxs("div",{className:"bg-white/60 dark:bg-gray-800/60 rounded-lg p-2",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.test_display_name}),a.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[Number.isFinite(s)?s.toFixed(n?2:1):"-"," ",r]})]},e.test_type_id)})})]}),a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden transition-colors",children:a.jsxs("div",{className:"grid grid-cols-5 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:()=>s("jump"),className:"py-3 px-2 text-xs sm:text-sm font-medium transition-colors "+("jump"===r?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"),children:"„Ç∏„É£„É≥„Éó"}),a.jsx("button",{type:"button",onClick:()=>s("sprint"),className:"py-3 px-2 text-xs sm:text-sm font-medium transition-colors "+("sprint"===r?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"),children:"„Çπ„Éó„É™„É≥„Éà"}),a.jsx("button",{type:"button",onClick:()=>s("agility"),className:"py-3 px-2 text-xs sm:text-sm font-medium transition-colors "+("agility"===r?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"),children:"„Ç¢„Ç∏„É™„ÉÜ„Ç£"}),a.jsx("button",{type:"button",onClick:()=>s("endurance"),className:"py-3 px-2 text-xs sm:text-sm font-medium transition-colors "+("endurance"===r?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"),children:"ÊåÅ‰πÖÂäõ"}),a.jsx("button",{type:"button",onClick:()=>s("strength"),className:"py-3 px-2 text-xs sm:text-sm font-medium transition-colors "+("strength"===r?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"),children:"Á≠ãÂäõ"})]})}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:v(r)}),a.jsx(b,{className:"w-5 h-5 sm:w-6 sm:h-6 text-yellow-500"})]}),a.jsx(W,{userId:e.id,userRole:e.role,testTypes:l,onSubmit:j,onCheckExisting:m,onUpdate:_,loading:d,lastRecords:k,personalBests:N})]})]}),a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:a.jsx(I,{testTypes:l,records:n,personalBests:i,getRecordsByTestType:x,getPersonalBest:u})}),a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:a.jsx(z,{records:n,personalBests:i,loading:d})})]})]}),g&&a.jsx(K,{testName:g.testName,value:g.value,unit:g.unit,previousBest:g.previousBest,onClose:()=>p(null)})]})}export{Y as default};
//# sourceMappingURL=AthletePerformanceView-COoFGWZu.js.map

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GamificationView-DEbO_yrF.js","assets/chart-vendor-B8I3tXXj.js","assets/supabase-vendor-CRHRt2Ih.js","assets/AthleteNutritionDashboardView-WwDb9dzp.js","assets/ExportPanel-De4YFCm4.js","assets/exportUtils-Bhmxw8Iv.js","assets/MessagingPanel-B_3knzbj.js","assets/AthletePerformanceView-DMqG799r.js","assets/PerformanceChart-B8Th93D_.js","assets/TeamExportPanel-DTTY_LaL.js","assets/ReportView-B9g3UWGc.js","assets/CoachRankingsView-BOTKQU3S.js","assets/GrowthUnderstandingQuadrantSummary-DcM4W1MG.js","assets/GrowthUnderstandingMatrix-BIRu8EdZ.js","assets/OrganizationAdminView-B7CghIAN.js"])))=>i.map(i=>d[i]);
var hn=Object.defineProperty;var bn=(t,s,r)=>s in t?hn(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var Zr=(t,s,r)=>bn(t,typeof s!="symbol"?s+"":s,r);import{r as a,a as fn,R as Je,L as St,C as Ye,X as Ge,Y as De,T as Ze,b as Ie,c as fe,d as Ae,e as lt,S as Ra,f as Qr,g as $a,B as pn,h as _s,i as Xr}from"./chart-vendor-B8I3tXXj.js";import{c as yn}from"./supabase-vendor-CRHRt2Ih.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(l){if(l.ep)return;l.ep=!0;const i=r(l);fetch(l.href,i)}})();var Fa={exports:{}},sr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jn=a,wn=Symbol.for("react.element"),vn=Symbol.for("react.fragment"),Nn=Object.prototype.hasOwnProperty,kn=jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_n={key:!0,ref:!0,__self:!0,__source:!0};function La(t,s,r){var n,l={},i=null,c=null;r!==void 0&&(i=""+r),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(c=s.ref);for(n in s)Nn.call(s,n)&&!_n.hasOwnProperty(n)&&(l[n]=s[n]);if(t&&t.defaultProps)for(n in s=t.defaultProps,s)l[n]===void 0&&(l[n]=s[n]);return{$$typeof:wn,type:t,key:i,ref:c,props:l,_owner:kn.current}}sr.Fragment=vn;sr.jsx=La;sr.jsxs=La;Fa.exports=sr;var e=Fa.exports,Pa,ea=fn;Pa=ea.createRoot,ea.hydrateRoot;const Sn="modulepreload",Cn=function(t){return"/"+t},ta={},Qe=function(s,r,n){let l=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),j=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));l=Promise.allSettled(r.map(x=>{if(x=Cn(x),x in ta)return;ta[x]=!0;const y=x.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${v}`))return;const N=document.createElement("link");if(N.rel=y?"stylesheet":Sn,y||(N.as="script"),N.crossOrigin="",N.href=x,j&&N.setAttribute("nonce",j),document.head.appendChild(N),y)return new Promise((w,p)=>{N.addEventListener("load",w),N.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${x}`)))})}))}function i(c){const j=new Event("vite:preloadError",{cancelable:!0});if(j.payload=c,window.dispatchEvent(j),!j.defaultPrevented)throw c}return l.then(c=>{for(const j of c||[])j.status==="rejected"&&i(j.reason);return s().catch(i)})},Mn="http://127.0.0.1:54321",Dn="sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",sa=globalThis,L=sa.__bekuta_supabase??(sa.__bekuta_supabase=yn(Mn,Dn,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:typeof window<"u"?window.localStorage:void 0},realtime:{params:{eventsPerSecond:0}}}));async function _r(t){const s=t&&typeof t=="object"&&"message"in t?String(t.message):String(t??"");if(s.includes("Invalid Refresh Token")||s.includes("Refresh Token Not Found")||s.includes("refresh_token")){try{await L.auth.signOut()}catch{}try{const r=Object.keys(window.localStorage);for(const n of r)n.startsWith("sb-")&&n.endsWith("-auth-token")&&window.localStorage.removeItem(n)}catch{}window.location.reload()}}const Tn=Object.freeze(Object.defineProperty({__proto__:null,recoverFromInvalidRefreshToken:_r,supabase:L},Symbol.toStringTag,{value:"Module"}));function En(t){return new Promise(s=>setTimeout(s,t))}async function ra(t,s){let r;try{return await Promise.race([t,new Promise(l=>{r=setTimeout(()=>l(null),s)})])}finally{clearTimeout(r)}}function An(){const[t,s]=a.useState(null),[r,n]=a.useState(null),[l,i]=a.useState("booting"),c=l!=="ready",[j,x]=a.useState(!1),y=a.useRef(!0),v=a.useRef(0),N=g=>{var b;const m=((b=g.user_metadata)==null?void 0:b.requires_password_change)===!0;x(m)},w=a.useCallback(async g=>{const m=++v.current,b=[0,300,800,1500];for(let _=0;_<b.length;_++){if(!y.current||m!==v.current)return;b[_]>0&&await En(b[_]);const S=await ra(L.from("users").select("*").eq("id",g).maybeSingle(),8e3);if(!y.current||m!==v.current)return;if(S===null)continue;const{data:C,error:R}=S;if(R){console.error("[useAuth] fetchUserProfile error:",R),n(null);return}if(C){n(C);return}}n(null)},[]),p=a.useCallback(async g=>{const m=(g==null?void 0:g.user)??null;s(m),m?(N(m),w(m.id)):(n(null),x(!1))},[w]),h=a.useCallback(async()=>{var g;try{const{data:m,error:b}=await L.auth.getUser();if(b){console.error("[useAuth] refreshUserProfile getUser error:",b);return}const _=(g=m.user)==null?void 0:g.id;if(!_)return;await w(_)}catch(m){console.error("[useAuth] refreshUserProfile failed:",m)}},[w]);return a.useEffect(()=>{y.current=!0;const{data:g}=L.auth.onAuthStateChange(async(m,b)=>{y.current&&(await p(b),y.current&&i("ready"))});return(async()=>{var m;try{const b=await ra(L.auth.getSession(),8e3);if(!y.current)return;(m=b==null?void 0:b.data)!=null&&m.session&&await p(b.data.session)}catch(b){console.error("[useAuth] init getSession failed:",b)}finally{y.current&&i("ready")}})(),()=>{var m;y.current=!1,(m=g==null?void 0:g.subscription)==null||m.unsubscribe()}},[p]),{user:t,userProfile:r,loading:c,requiresPasswordChange:j,signIn:async(g,m)=>{var S,C;const{data:b,error:_}=await L.auth.signInWithPassword({email:g.trim(),password:m});if(_)throw _;return(C=(S=b.user)==null?void 0:S.user_metadata)!=null&&C.requires_password_change&&x(!0),b},signOut:async()=>{try{await L.auth.signOut()}catch(g){console.error("[useAuth] signOut error:",g)}finally{s(null),n(null),x(!1),i("ready")}},changePassword:async g=>{const{error:m}=await L.auth.updateUser({password:g,data:{requires_password_change:!1}});if(m)throw m;x(!1)},acceptTerms:async()=>{if(!t)throw new Error("User not logged in");const g=new Date().toISOString(),{error:m}=await L.from("users").update({terms_accepted:!0,terms_accepted_at:g}).eq("id",t.id);if(m)throw console.error("[useAuth] acceptTerms failed:",m),m;n(b=>b&&{...b,terms_accepted:!0,terms_accepted_at:g})},refreshUserProfile:h}}const Rn=9*60*60*1e3;function qa(t){return new Date(t.getTime()+Rn)}function Ts(t){const s=qa(t),r=s.getUTCFullYear(),n=String(s.getUTCMonth()+1).padStart(2,"0"),l=String(s.getUTCDate()).padStart(2,"0");return`${r}-${n}-${l}`}function za(){return qa(new Date)}function _t(){return Ts(new Date)}function $n(t){const s=za();return s.setUTCDate(s.getUTCDate()-t),Ts(s)}function Fn(t){const s=za();return s.setUTCFullYear(s.getUTCFullYear()-t),Ts(s)}function Ln(t){return Fn(t)}function Pn(t){return $n(t)}function aa(t){return Ts(t)}function Zs(t){return Ts(t)}function Vc(){return new Date(Date.now()+324e5).toISOString().replace("Z","+09:00")}const qn=21,zn=[{type:"high_risk",condition:"acwr_above",threshold:1.5,enabled:!0,description:"ACWR „Åå 1.5 „ÇíË∂Ö„Åà„ÅüÂ†¥ÂêàÔºàÈ´ò„É™„Çπ„ÇØÔºâ"},{type:"caution",condition:"acwr_above",threshold:1.3,enabled:!0,description:"ACWR „Åå 1.3 „ÇíË∂Ö„Åà„ÅüÂ†¥ÂêàÔºàÊ≥®ÊÑè„É¨„Éô„É´Ôºâ"},{type:"low_load",condition:"acwr_below",threshold:.8,enabled:!0,description:"ACWR „Åå 0.8 „Çí‰∏ãÂõû„Å£„ÅüÂ†¥ÂêàÔºà‰ΩéË≤†Ëç∑Ôºâ"},{type:"no_data",condition:"no_training_days",threshold:5,enabled:!0,description:"5Êó•ÈñìÁ∑¥ÁøíË®òÈå≤„Åå„Å™„ÅÑÂ†¥Âêà"},{type:"reminder",condition:"no_training_today",threshold:1,enabled:!1,description:"ÂΩìÊó•„ÅÆÁ∑¥ÁøíË®òÈå≤„Åå„Å™„ÅÑÂ†¥ÂêàÔºà22ÊôÇ‰ª•ÈôçÔºâ"},{type:"srpe_high",condition:"srpe_above",threshold:600,enabled:!0,description:"sRPEÔºàRPE√óÂàÜÔºâ„Åå600„ÇíË∂Ö„Åà„ÅüÂ†¥ÂêàÔºàÂçòÁô∫È´òË≤†Ëç∑Ôºâ"},{type:"srpe_spike",condition:"srpe_spike_ratio",threshold:1.6,enabled:!0,description:"ÂΩìÊó•„ÅÆsRPE„ÅåÁõ¥ËøëÂπ≥ÂùáÊØî„ÅßÊÄ•Â¢óÔºà‰æãÔºö1.6ÂÄç‰ª•‰∏äÔºâ"}];function On(t,s,r,n,l){const i=[],c=new Date,j=Zs(c),x=r.length>0?r[r.length-1]:null,y=n.length>0?n[n.length-1]:null,v=n.find(b=>b.date===j),p=Array.from(new Set(n.map(b=>b.date))).length>=qn,h=b=>{const _=Number((b==null?void 0:b.rpe)??0),S=Number((b==null?void 0:b.duration_min)??0);return!_||!S?0:Math.round(_*S)},u=new Map;for(const b of n){const _=b.date;_&&u.set(_,(u.get(_)??0)+h(b))}const f=u.get(j)??0,o=Array.from(u.keys()).sort().filter(b=>b<j).slice(-7).map(b=>u.get(b)??0).filter(b=>b>0),g=o.length?Math.round(o.reduce((b,_)=>b+_,0)/o.length):0,m=g>0?Number((f/g).toFixed(2)):0;return l.forEach(b=>{if(!b.enabled)return;let _=!1,S={user_id:t,user_name:s,type:b.type,is_read:!1,is_dismissed:!1,created_at:c.toISOString()};switch(b.condition){case"acwr_above":if(!p)break;x&&x.acwr>b.threshold&&(_=!0,S={...S,priority:b.type==="high_risk"?"high":"medium",title:b.type==="high_risk"?"üö® È´ò„É™„Çπ„ÇØË≠¶Âëä":"‚ö†Ô∏è Ê≥®ÊÑè„É¨„Éô„É´",message:`${s}„Åï„Çì„ÅÆACWR„Åå${x.acwr}„Å®„Å™„Çä„ÄÅ${b.threshold}„ÇíË∂Ö„Åà„Åæ„Åó„Åü„ÄÇÊÄ™Êàë„ÅÆ„É™„Çπ„ÇØ„ÅåÈ´ò„Åæ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ`,acwr_value:x.acwr,threshold_exceeded:`${b.threshold}‰ª•‰∏ä`,expires_at:new Date(c.getTime()+48*60*60*1e3).toISOString()});break;case"acwr_below":if(!p)break;x&&x.acwr<b.threshold&&(_=!0,S={...S,priority:"low",title:"üìâ ‰ΩéË≤†Ëç∑ÈÄöÁü•",message:`${s}„Åï„Çì„ÅÆACWR„Åå${x.acwr}„Å®„Å™„Çä„ÄÅ${b.threshold}„Çí‰∏ãÂõû„Çä„Åæ„Åó„Åü„ÄÇÁ∑¥ÁøíË≤†Ëç∑„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`,acwr_value:x.acwr,threshold_exceeded:`${b.threshold}Êú™Ê∫Ä`,expires_at:new Date(c.getTime()+72*60*60*1e3).toISOString()});break;case"no_training_days":if(y){const C=Math.floor((c.getTime()-new Date(y.date).getTime())/864e5);C>=b.threshold&&(_=!0,S={...S,priority:"medium",title:"üìÖ Á∑¥ÁøíË®òÈå≤„Å™„Åó",message:`${s}„Åï„Çì„ÅÆÁ∑¥ÁøíË®òÈå≤„Åå${C}Êó•Èñì„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÁ∂ôÁ∂öÁöÑ„Å™„Éá„Éº„ÇøË®òÈå≤„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ`,last_training_date:y.date,days_since_last_training:C,expires_at:new Date(c.getTime()+7*24*60*60*1e3).toISOString()})}break;case"no_training_today":c.getHours()>=22&&!v&&(_=!0,S={...S,priority:"low",title:"‚è∞ ‰ªäÊó•„ÅÆË®òÈå≤Âøò„Çå",message:`${s}„Åï„Çì„ÄÅ‰ªäÊó•„ÅÆÁ∑¥ÁøíË®òÈå≤„Çí„Åæ„Å†ÂÖ•Âäõ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÂøò„Çå„Åö„Å´Ë®òÈå≤„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ`,expires_at:new Date(c.getTime()+2*60*60*1e3).toISOString()});break;case"srpe_above":f>0&&f>=b.threshold&&(_=!0,S={...S,priority:"medium",title:"üî• È´òË≤†Ëç∑ÔºàsRPEÔºâ",message:`${s}„Åï„Çì„ÅÆ‰ªäÊó•„ÅÆË≤†Ëç∑ÔºàsRPEÔºâ„Åå${f}„Åß„Åô„ÄÇÁñ≤Âä¥„ÅåÊ∫ú„Åæ„Çä„ÇÑ„Åô„ÅÑ„ÅÆ„ÅßÁù°Áú†„ÉªË£úÈ£ü„ÉªÂõûÂæ©„ÇíÊÑèË≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,srpe_value:f,expires_at:new Date(c.getTime()+48*60*60*1e3).toISOString()});break;case"srpe_spike_ratio":f>0&&g>0&&m>=b.threshold&&(_=!0,S={...S,priority:"high",title:"‚ö° ÊÄ•Â¢óÔºàsRPEÔºâ",message:`${s}„Åï„Çì„ÅÆ‰ªäÊó•„ÅÆË≤†Ëç∑ÔºàsRPEÔºâ„ÅåÊÄ•Â¢ó„Åó„Å¶„ÅÑ„Åæ„ÅôÔºà${f} / Áõ¥ËøëÂπ≥Âùá${g} = ${m}ÂÄçÔºâ„ÄÇÊÄ™Êàë„É™„Çπ„ÇØ„Åå‰∏ä„Åå„Çä„ÇÑ„Åô„ÅÑ„ÅÆ„ÅßÊ≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,srpe_value:f,srpe_avg_7d:g,srpe_spike_ratio:m,expires_at:new Date(c.getTime()+72*60*60*1e3).toISOString()});break}_&&i.push({id:`${t}-${b.type}-${Date.now()}`,...S})}),i}function ks(t){switch(t.priority){case"high":return{bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-600",icon:"üö®"};case"medium":return{bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-600",icon:"‚ö†Ô∏è"};case"low":return{bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-600",icon:"üí°"};default:return{bgColor:"bg-gray-50",borderColor:"border-gray-200",textColor:"text-gray-800",iconColor:"text-gray-600",icon:"‚ÑπÔ∏è"}}}function cr(t){switch(t){case"high_risk":return"È´ò„É™„Çπ„ÇØ";case"caution":return"Ê≥®ÊÑè";case"low_load":return"‰ΩéË≤†Ëç∑";case"no_data":return"„Éá„Éº„Çø„Å™„Åó";case"reminder":return"„É™„Éû„Ç§„É≥„ÉÄ„Éº";case"srpe_high":return"È´òË≤†Ëç∑ÔºàsRPEÔºâ";case"srpe_spike":return"ÊÄ•Â¢óÔºàsRPEÔºâ";default:return"‰∏çÊòé"}}function Bn(t){return t.expires_at?new Date>new Date(t.expires_at):!1}function xr(t){return t.filter(s=>!s.is_dismissed&&!Bn(s))}function Wn(t){const s={high:3,medium:2,low:1};return t.sort((r,n)=>{const l=s[n.priority]-s[r.priority];return l!==0?l:new Date(n.created_at).getTime()-new Date(r.created_at).getTime()})}function na(t){const[s,r,n]=t.split("-").map(l=>Number(l));return new Date(Date.UTC(s,(r||1)-1,n||1))}function In(t){return t.toISOString().slice(0,10)}function Un(t,s){const r=new Date(t);return r.setUTCDate(r.getUTCDate()+s),r}function la(t){switch(t){case"high":return"È´ò„É™„Çπ„ÇØ";case"caution":return"Ê≥®ÊÑè";case"good":return"ËâØÂ•Ω";case"low":return"‰ΩéË≤†Ëç∑";default:return"‰∏çÊòé"}}function zt(t){if(typeof t=="string")switch(t){case"high":return"#ef4444";case"caution":return"#f59e0b";case"good":return"#22c55e";case"low":return"#3b82f6";default:return"#94a3b8"}const s=t;return s==null||!Number.isFinite(s)?"#94a3b8":s>1.5?"#ef4444":s>=1.3?"#f59e0b":s>=.8?"#22c55e":"#3b82f6"}function Oa(t){const s=new Map;for(const j of t){if(!(j!=null&&j.date))continue;const x=typeof j.load=="number"&&Number.isFinite(j.load)?j.load:0;s.set(j.date,(s.get(j.date)??0)+x)}const r=Array.from(s.keys()).sort();if(r.length===0)return[];const n=na(r[0]),l=na(r[r.length-1]),i=[];for(let j=n;j<=l;j=Un(j,1)){const x=In(j);i.push({date:x,load:s.get(x)??0})}const c=[];for(let j=0;j<i.length;j++){const x=i[j].date;if(j<27){c.push({date:x,acwr:null,acuteLoad:null,chronicLoad:null,riskLevel:"unknown"});continue}const y=i.slice(j-6,j+1).reduce((u,f)=>u+f.load,0),N=i.slice(j-27,j+1).reduce((u,f)=>u+f.load,0)/4,w=N>0?y/N:null,p=w!=null?Number(w.toFixed(2)):null,h=p==null?"unknown":p>1.5?"high":p>=1.3?"caution":p>=.8?"good":"low";c.push({date:x,acuteLoad:Number(y.toFixed(1)),chronicLoad:N>0?Number(N.toFixed(1)):null,acwr:p,riskLevel:h})}return c}const Ba=a.createContext(null);function Hn({children:t}){const[s,r]=a.useState(()=>typeof document>"u"?!0:!document.hidden),[n,l]=a.useState(()=>typeof navigator>"u"?!0:navigator.onLine),i=a.useRef(new Map),c=a.useRef(s),j=a.useRef(n);a.useEffect(()=>{c.current=s},[s]),a.useEffect(()=>{j.current=n},[n]),a.useEffect(()=>{const p=()=>r(!document.hidden),h=()=>l(!0),u=()=>l(!1);return document.addEventListener("visibilitychange",p),window.addEventListener("online",h),window.addEventListener("offline",u),()=>{document.removeEventListener("visibilitychange",p),window.removeEventListener("online",h),window.removeEventListener("offline",u)}},[]);const x=a.useCallback(p=>{i.current.delete(p)},[]),y=a.useCallback(async p=>{try{await p.run(),p.failCount=0,p.nextAt=Date.now()+p.intervalMs}catch{p.failCount+=1;const f=Math.min(3e5,2e3*Math.pow(2,Math.min(8,p.failCount)));p.nextAt=Date.now()+f}},[]);a.useEffect(()=>{const p=window.setInterval(()=>{const h=Date.now(),u=c.current,f=j.current;for(const d of i.current.values())d.enabled&&(d.requireVisible&&!u||d.requireOnline&&!f||h<d.nextAt||y(d))},1e3);return()=>window.clearInterval(p)},[y]);const v=a.useCallback(p=>{const{key:h,intervalMs:u,run:f,enabled:d=!0,requireVisible:o=!0,requireOnline:g=!0,immediate:m=!1}=p,_=i.current.get(h)??{key:h,intervalMs:u,run:f,enabled:d,requireVisible:o,requireOnline:g,nextAt:Date.now(),failCount:0};return _.intervalMs=u,_.run=f,_.enabled=d,_.requireVisible=o,_.requireOnline=g,d&&(_.nextAt=m?Date.now():Date.now()+u),i.current.set(h,_),m&&d&&y(_),()=>{i.current.delete(h)}},[y]),N=a.useMemo(()=>{const p=s&&n;return{isVisible:s,isOnline:n,canRun:p,canRealtime:p}},[s,n]),w=a.useMemo(()=>({state:N,registerPollJob:v,unregisterJob:x}),[N,v,x]);return e.jsx(Ba.Provider,{value:w,children:t})}function Lr(){const t=a.useContext(Ba);if(!t)throw new Error("useRealtimeHub must be used within RealtimeHubProvider");return t}const Vn=!1;function Kn(t,s){var R,A;const[r,n]=a.useState([]),[l,i]=a.useState([]),[c,j]=a.useState(!0),[x,y]=a.useState(0),{registerPollJob:v}=Lr(),N=a.useRef(((A=(R=globalThis.crypto)==null?void 0:R.randomUUID)==null?void 0:A.call(R))??Math.random().toString(36).slice(2)),w=a.useRef(null),p=async T=>{},h=a.useCallback(async()=>{if(!t||!s)return[];let T=[];if(s==="athlete"){const{data:M}=await L.from("users").select("id, name").eq("id",t).single();M&&(T=[M])}if(s==="staff"){const{data:M,error:k}=await L.from("staff_team_links").select(`
          team_id,
          teams!inner (
            users!inner (
              id,
              name
            )
          )
        `).eq("staff_user_id",t);k&&console.error("[useAlerts] staff team fetch error:",k);const F=(M==null?void 0:M.flatMap(z=>{var P;return((P=z.teams)==null?void 0:P.users)||[]}))||[],O=new Map;for(const z of F)z!=null&&z.id&&(O.has(z.id)||O.set(z.id,{id:z.id,name:z.name??""}));T=Array.from(O.values())}if(s==="global_admin"){const{data:M,error:k}=await L.from("users").select("id, name").eq("role","athlete");k&&console.error("[useAlerts] admin athletes fetch error:",k);const F=new Map;for(const O of M||[])O!=null&&O.id&&(F.has(O.id)||F.set(O.id,{id:O.id,name:O.name??""}));T=Array.from(F.values())}return T},[t,s]),u=a.useCallback(async()=>{if(!(!t||!s))try{const T=await h();if(!T.length)return;const M=(l??[]).filter(z=>!(s!=="athlete"&&z.type==="no_data")),k=T.map(async z=>{const{data:P,error:$}=await L.from("training_records").select("*").eq("user_id",z.id).order("date",{ascending:!0});if($)throw{user:z,error:$};return{user:z,trainingRecords:P||[]}}),F=await Promise.allSettled(k),O=[];for(const z of F){if(z.status==="rejected"){console.error("[useAlerts] training_records fetch failed:",z.reason);continue}const{user:P,trainingRecords:$}=z.value,q=Oa($),E=On(P.id,P.name,q,$,M);O.push(...E)}n(z=>{const P=new Set(z.map(q=>`${q.user_id}-${q.type}-${q.created_at.split("T")[0]}`)),$=O.filter(q=>!P.has(`${q.user_id}-${q.type}-${q.created_at.split("T")[0]}`));if($.length>0){const q=[...z,...$];return Wn(xr(q))}return xr(z)})}catch(T){console.error("Error checking and generating alerts:",T)}},[t,s,l,h]),f=a.useCallback(async()=>{const T=zn.map((M,k)=>({id:`default-${k}`,...M}));i(T)},[]);a.useEffect(()=>{let T=!1;return(async()=>{if(!t||!s){j(!1);return}j(!0);try{await f()}catch(k){console.error("Error loading alert rules:",k),await f()}finally{T||j(!1)}})(),()=>{T=!0}},[t,s,f]),a.useEffect(()=>{l.length>0&&t&&s&&u()},[l.length,t,s,u]),a.useEffect(()=>{if(w.current&&(w.current(),w.current=null),!t||!s||l.length===0)return;const T=`alerts:${t}:${s}:${N.current}`,M=v({key:T,intervalMs:30*60*1e3,run:async()=>{await u()},enabled:!0,requireVisible:!0,requireOnline:!0,immediate:!1});return w.current=M,()=>{w.current&&(w.current(),w.current=null)}},[t,s,l.length,v,u]),a.useEffect(()=>{const T=r.filter(M=>!M.is_read&&!M.is_dismissed).length;y(T)},[r]);const d=a.useCallback(async T=>{n(M=>M.map(k=>k.id===T?{...k,is_read:!0}:k))},[]),o=a.useCallback(async T=>{n(M=>M.map(k=>k.id===T?{...k,is_dismissed:!0}:k))},[]),g=a.useCallback(async()=>{n(T=>T.map(M=>({...M,is_read:!0})))},[]),m=a.useCallback(()=>{n(T=>T.filter(M=>!M.is_dismissed))},[]),b=a.useCallback(()=>xr(r),[r]),_=a.useCallback(()=>r.filter(T=>!T.is_read&&!T.is_dismissed),[r]),S=a.useCallback(T=>b().filter(M=>M.priority===T),[b]),C=a.useCallback(T=>b().filter(M=>M.user_id===T),[b]);return{alerts:b(),alertRules:l,loading:c,unreadCount:x,markAsRead:d,dismissAlert:o,markAllAsRead:g,clearDismissedAlerts:m,getUnreadAlerts:_,getAlertsByPriority:S,getAlertsByUser:C,refreshAlerts:u}}function Jn(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null);a.useEffect(()=>{if(!t){l(!1);return}j()},[t]);const j=async()=>{if(t)try{l(!0),c(null);const{data:v,error:N}=await L.from("organization_members").select(`
          organization_id,
          role,
          organizations (
            id,
            name
          )
        `).eq("user_id",t);if(N)throw N;const w=(v||[]).map(p=>{var h;return{organizationId:p.organization_id,organizationName:((h=p.organizations)==null?void 0:h.name)||"Unknown",role:p.role}});r(w)}catch(v){const N=v instanceof Error?v.message:"Failed to load organization roles";c(N),console.error("Error loading organization roles:",v)}finally{l(!1)}};return{organizationRoles:s,loading:n,error:i,isOrganizationAdmin:v=>v?s.some(N=>N.organizationId===v&&N.role==="organization_admin"):s.some(N=>N.role==="organization_admin"),getOrganizationAdminRoles:()=>s.filter(v=>v.role==="organization_admin"),reload:j}}function Yn(){const[t,s]=a.useState([]),r=a.useCallback((j,x="success",y=3e3)=>{const N={id:`toast-${Date.now()}-${Math.random()}`,message:j,type:x,duration:y};s(w=>[...w,N])},[]),n=a.useCallback(j=>{s(x=>x.filter(y=>y.id!==j))},[]),l=a.useCallback((j,x)=>{r(j,"success",x)},[r]),i=a.useCallback((j,x)=>{r(j,"error",x)},[r]),c=a.useCallback((j,x)=>{r(j,"info",x)},[r]);return{toasts:t,showToast:r,removeToast:n,success:l,error:i,info:c}}function Gn(t,s){const[r,n]=a.useState(null),[l,i]=a.useState(!0),[c,j]=a.useState(null),x=a.useCallback(async()=>{if(!t||!s){i(!1);return}try{i(!0),j(null);const{data:f,error:d}=await L.from("tutorial_progress").select("*").eq("user_id",t).eq("role",s).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(d)throw d;n(f||{user_id:t,role:s,completed_steps:[],current_step:null,is_completed:!1,skipped:!1})}catch(f){console.error("Error loading tutorial progress:",f),j(f.message??String(f))}finally{i(!1)}},[t,s]);a.useEffect(()=>{x()},[x]);const y=a.useCallback(async f=>{if(!t||!s)return null;try{j(null);const d={...r??{user_id:t,role:s,completed_steps:[],current_step:null,is_completed:!1,skipped:!1},...f,user_id:t,role:s},{data:o,error:g}=await L.from("tutorial_progress").upsert(d,{onConflict:"user_id,role"}).select().single();if(g)throw g;return n(o),o}catch(d){console.error("Error saving tutorial progress:",d),j(d.message??String(d));const o={...r??{user_id:t,role:s,completed_steps:[],current_step:null,is_completed:!1,skipped:!1},...f,user_id:t,role:s};return n(o),o}},[t,s,r]),v=a.useCallback(async f=>{if(!r)return null;const d=[...r.completed_steps];return d.includes(f)||d.push(f),await y({completed_steps:d,current_step:f})},[r,y]),N=a.useCallback(async f=>await y({current_step:f}),[y]),w=a.useCallback(async()=>await y({is_completed:!0,current_step:null}),[y]),p=a.useCallback(async()=>await y({skipped:!0,current_step:null}),[y]),h=a.useCallback(async()=>await y({completed_steps:[],current_step:null,is_completed:!1,skipped:!1}),[y]),u=a.useCallback(()=>r?!r.is_completed&&!r.skipped:!1,[r]);return{progress:r,loading:l,error:c,completeStep:v,setCurrentStep:N,completeTutorial:w,skipTutorial:p,resetTutorial:h,shouldShowTutorial:u,refreshProgress:x}}const Wa=a.createContext(void 0);function Zn({userId:t,role:s,children:r}){const n=Gn(t,s),[l,i]=a.useState(!1),[c,j]=a.useState(0),x=a.useCallback(()=>{i(!0),j(0)},[]),y=a.useCallback(()=>{i(!1)},[]),v=a.useCallback(async()=>{await n.completeTutorial(),i(!1)},[n]),N=a.useCallback(async()=>{await n.skipTutorial(),i(!1)},[n]),w={...n,isActive:l,currentStepIndex:c,startTutorial:x,stopTutorial:y,completeTutorial:v,skipTutorial:N,setCurrentStepIndex:j};return e.jsx(Wa.Provider,{value:w,children:r})}function Pr(){const t=a.useContext(Wa);if(t===void 0)throw new Error("useTutorialContext must be used within a TutorialProvider");return t}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),X=(t,s)=>{const r=a.forwardRef(({color:n="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:j="",children:x,...y},v)=>a.createElement("svg",{ref:v,...Qn,width:l,height:l,stroke:n,strokeWidth:c?Number(i)*24/Number(l):i,className:["lucide",`lucide-${Xn(t)}`,j].join(" "),...y},[...s.map(([N,w])=>a.createElement(N,w)),...Array.isArray(x)?x:[x]]));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=X("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=X("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=X("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=X("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=X("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=X("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=X("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=X("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=X("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=X("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=X("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=X("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=X("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=X("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=X("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=X("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=X("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=X("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=X("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=X("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=X("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=X("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=X("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=X("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=X("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=X("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=X("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=X("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=X("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=X("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=X("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ll=X("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=X("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=X("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const il=X("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=X("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=X("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=X("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=X("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=X("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=X("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=X("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xl=X("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=X("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=X("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=X("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=X("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=X("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=X("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=X("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=X("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=X("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=X("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=X("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=X("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=X("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=X("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=X("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yl=X("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=X("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=X("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=X("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=X("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=X("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vl=X("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=X("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=X("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=X("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nl=X("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=X("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=X("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=X("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=X("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=X("Sliders",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=X("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=X("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=X("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=X("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=X("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=X("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=X("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=X("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=X("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=X("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=X("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=X("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=X("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=X("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=X("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=X("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=X("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=X("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=X("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=X("Wind",[["path",{d:"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2",key:"1k4u03"}],["path",{d:"M9.6 4.6A2 2 0 1 1 11 8H2",key:"b7d0fd"}],["path",{d:"M12.6 19.4A2 2 0 1 0 14 16H2",key:"1p5cb3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=X("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=X("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function Cl({onLogin:t}){const[s,r]=a.useState(""),[n,l]=a.useState(""),[i,c]=a.useState(!1),[j,x]=a.useState(""),[y,v]=a.useState(!1),[N,w]=a.useState(!1),[p,h]=a.useState(""),[u,f]=a.useState(!1),[d,o]=a.useState(""),g=async _=>{var S,C,R,A,T;if(_.preventDefault(),!s.trim()||!n){x("„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");return}if(!s.includes("@")){x("ÊúâÂäπ„Å™„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");return}c(!0),x("");try{console.log("üîê Login attempt for:",s.trim()),await t(s.trim(),n),console.log("‚úÖ Login successful")}catch(M){console.error("‚ùå Login error:",M),console.error("Error message:",M.message),console.error("Error details:",M),(S=M.message)!=null&&S.includes("Invalid login credentials")||(C=M.message)!=null&&C.includes("„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì")?x(`„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ

ËÄÉ„Åà„Çâ„Çå„ÇãÂéüÂõ†Ôºö
‚Ä¢ „Ç¢„Ç´„Ç¶„É≥„Éà„Åå‰ΩúÊàê„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ
‚Ä¢ „Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Çã
‚Ä¢ „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Çã

ÁÆ°ÁêÜËÄÖ„Å´„Ç¢„Ç´„Ç¶„É≥„Éà‰ΩúÊàê„Çí‰æùÈ†º„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`):(R=M.message)!=null&&R.includes("Email not confirmed")?x("„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅåÁ¢∫Ë™ç„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ"):(A=M.message)!=null&&A.includes("Too many requests")?x("„É≠„Ç∞„Ç§„É≥Ë©¶Ë°åÂõûÊï∞„ÅåÂ§ö„Åô„Åé„Åæ„Åô„ÄÇ5ÂàÜÁ®ãÂ∫¶ÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"):(T=M.message)!=null&&T.includes("Missing Supabase environment variables")?x("„Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö„Ç®„É©„ÉºÔºö„Éá„Éº„Çø„Éô„Éº„ÇπÊé•Á∂ö„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÁÆ°ÁêÜËÄÖ„Å´ÈÄ£Áµ°„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"):x(M.message||"„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åô„Çã„Åã„ÄÅÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ")}finally{c(!1)}},m=_=>{_.preventDefault(),v(S=>!S)},b=async _=>{_.preventDefault(),o(""),f(!1);const S=p.trim();if(!S||!S.includes("@")){o("ÊúâÂäπ„Å™„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");return}const C="http://127.0.0.1:54321",R="sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH";c(!0);try{console.log("üîê Requesting password reset for:",S);const A=await fetch(`${C}/functions/v1/request-password-reset`,{method:"POST",headers:{"Content-Type":"application/json",apikey:R,Authorization:`Bearer ${R}`},body:JSON.stringify({email:S,redirectUrl:window.location.origin})}),T=await A.json().catch(()=>({}));if(!A.ok){console.error("‚ùå request-password-reset error:",A.status,T),A.status===404?o("„Åì„ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂÖ•ÂäõÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åô„Çã„Åã„ÄÅÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ"):o((T==null?void 0:T.error)||"„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„É°„Éº„É´„ÅÆÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ");return}console.log("‚úÖ Password reset request accepted:",T),f(!0)}catch(A){console.error("‚ùå Password reset request failed:",A),o("„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„É°„Éº„É´„ÅÆÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÁí∞Â¢É„ÇíÁ¢∫Ë™ç„Åô„Çã„Åã„ÄÅÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ")}finally{c(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4 transition-colors",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md transition-colors",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-colors",children:e.jsx(gl,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),e.jsxs("h1",{className:"flex items-baseline justify-center space-x-2 mb-2 transition-colors",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"-0.02em"},children:"Bekuta"}),e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",style:{letterSpacing:"0.05em"},children:"by ARCA"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 transition-colors",children:"„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†„Å∏„É≠„Ç∞„Ç§„É≥"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsx("input",{type:"email",id:"email",value:s,onChange:_=>r(_.target.value),className:`
                w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg 
                focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent 
                transition-colors text-base
                bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                placeholder-gray-500 dark:placeholder-gray-400
              `,placeholder:"your-email@example.com",required:!0,disabled:i,autoComplete:"email",style:{fontSize:"16px",WebkitAppearance:"none",WebkitBorderRadius:"0.5rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"„Éë„Çπ„ÉØ„Éº„Éâ"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",id:"password",value:n,onChange:_=>l(_.target.value),className:`
                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg 
                  focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent 
                  transition-colors text-base
                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                  placeholder-gray-500 dark:placeholder-gray-400
                `,placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0,disabled:i,autoComplete:"current-password",style:{fontSize:"16px",WebkitAppearance:"none",WebkitBorderRadius:"0.5rem"}}),e.jsx("button",{type:"button",onClick:m,className:`
                  absolute right-3 top-1/2 transform -translate-y-1/2 
                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 
                  transition-colors touch-target
                `,disabled:i,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:y?e.jsx(Zt,{className:"w-5 h-5"}):e.jsx(Qt,{className:"w-5 h-5"})})]})]}),j&&e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors",children:[e.jsx(pe,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº"}),e.jsx("p",{className:"whitespace-pre-line",children:j})]})]}),e.jsx("button",{type:"submit",disabled:i,className:`
              w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg
              hover:bg-blue-700 dark:hover:bg-blue-600
              focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800
              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium touch-target
            `,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:i?"„É≠„Ç∞„Ç§„É≥‰∏≠...":"„É≠„Ç∞„Ç§„É≥"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>{w(!0),h(s),o(""),f(!1)},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:"„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂøò„Çå„ÅüÂ†¥Âêà"})})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 transition-colors",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 transition-colors",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Wt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"ÂàùÂõûÂà©Áî®„ÅÆÊñπ„Å∏"}),e.jsxs("div",{className:"text-blue-700 dark:text-blue-400 space-y-1 text-left text-xs",children:[e.jsx("p",{children:"1. ÁÆ°ÁêÜËÄÖ„Åã„Çâ„ÄåBekuta ÊãõÂæÖ„É°„Éº„É´„Äç„ÇíÂèó„ÅëÂèñ„Çã"}),e.jsx("p",{children:"2. „É°„Éº„É´ÂÜÖ„ÅÆ„Äå„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åô„Çã„Äç„Éú„Çø„É≥„ÇíÊäº„Åô"}),e.jsx("p",{children:"3. Ë°®Á§∫„Åï„Çå„ÇãÁîªÈù¢„Åß„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„ÄÅ„Åù„ÅÆÂæå„Åì„ÅÆÁîªÈù¢„Åã„Çâ„É≠„Ç∞„Ç§„É≥"})]})]})]})}),e.jsx("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg transition-colors",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(pe,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-amber-700 dark:text-amber-400 text-xs text-left",children:[e.jsx("p",{className:"font-medium mb-1",children:"„É≠„Ç∞„Ç§„É≥„Åß„Åç„Å™„ÅÑÂ†¥Âêà"}),e.jsx("p",{children:"ÁÆ°ÁêÜËÄÖ„Å´‰ª•‰∏ã„ÅÆÊÉÖÂ†±„Çí„Åä‰ºù„Åà„Åè„Å†„Åï„ÅÑÔºö"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"‰ΩøÁî®„Åó„Å¶„ÅÑ„Çã„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsx("li",{children:"„ÄåÊãõÂæÖ„É°„Éº„É´„Äç„Åæ„Åü„ÅØ„Äå„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„É°„Éº„É´„Äç„ÇíÂèó„ÅëÂèñ„Å£„Å¶„ÅÑ„Çã„Åã"}),e.jsx("li",{children:"„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆöÔºàÂ§âÊõ¥ÔºâÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Çã„Åã„Å©„ÅÜ„Åã"}),e.jsx("li",{children:"„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂÜÖÂÆπ"})]})]})]})}),e.jsx("p",{className:"mt-4 text-xs",children:"„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„Åå‰∏çÊòé„Å™Â†¥Âêà„ÅØÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ"})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"„Éë„Çπ„ÉØ„Éº„Éâ„Çí„É™„Çª„ÉÉ„Éà"}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-green-800 dark:text-green-300 text-sm",children:"„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„ÉàÁî®„ÅÆ„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ"}),e.jsx("p",{className:"text-green-700 dark:text-green-400 text-sm mt-2",children:"„É°„Éº„É´„Å´Ë®òËºâ„Åï„Çå„Åü„É™„É≥„ÇØ„ÇíÊäº„Åó„Å¶„ÄÅË°®Á§∫„Åï„Çå„ÅüÁîªÈù¢„ÅßÊñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]}),e.jsx("button",{onClick:()=>{w(!1),f(!1),h("")},className:"w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors",children:"Èñâ„Åò„Çã"})]}):e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Çã„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„ÉàÁî®„ÅÆ„É™„É≥„ÇØ„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"‚Äª‰ª•Ââç„Å®Âêå„Åò„Éë„Çπ„ÉØ„Éº„Éâ„Å´„ÅØÂ§âÊõ¥„Åß„Åç„Åæ„Åõ„Çì„ÄÇ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsx("input",{type:"email",value:p,onChange:_=>h(_.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors",placeholder:"email@example.com",disabled:i})]}),d&&e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400",children:[e.jsx(pe,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm whitespace-pre-line",children:d})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{w(!1),o(""),h("")},className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",disabled:i,children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{type:"submit",disabled:i,className:"flex-1 bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i?"ÈÄÅ‰ø°‰∏≠...":"„É™„Çª„ÉÉ„Éà„É°„Éº„É´„ÇíÈÄÅ‰ø°"})]})]})]})})]})}var Wr={};(function t(s,r,n,l){var i=!!(s.Worker&&s.Blob&&s.Promise&&s.OffscreenCanvas&&s.OffscreenCanvasRenderingContext2D&&s.HTMLCanvasElement&&s.HTMLCanvasElement.prototype.transferControlToOffscreen&&s.URL&&s.URL.createObjectURL),c=typeof Path2D=="function"&&typeof DOMMatrix=="function",j=function(){if(!s.OffscreenCanvas)return!1;try{var E=new OffscreenCanvas(1,1),D=E.getContext("2d");D.fillRect(0,0,1,1);var B=E.transferToImageBitmap();D.createPattern(B,"no-repeat")}catch{return!1}return!0}();function x(){}function y(E){var D=r.exports.Promise,B=D!==void 0?D:s.Promise;return typeof B=="function"?new B(E):(E(x,x),null)}var v=function(E,D){return{transform:function(B){if(E)return B;if(D.has(B))return D.get(B);var H=new OffscreenCanvas(B.width,B.height),W=H.getContext("2d");return W.drawImage(B,0,0),D.set(B,H),H},clear:function(){D.clear()}}}(j,new Map),N=function(){var E=Math.floor(16.666666666666668),D,B,H={},W=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(D=function(U){var Z=Math.random();return H[Z]=requestAnimationFrame(function Y(ee){W===ee||W+E-1<ee?(W=ee,delete H[Z],U()):H[Z]=requestAnimationFrame(Y)}),Z},B=function(U){H[U]&&cancelAnimationFrame(H[U])}):(D=function(U){return setTimeout(U,E)},B=function(U){return clearTimeout(U)}),{frame:D,cancel:B}}(),w=function(){var E,D,B={};function H(W){function U(Z,Y){W.postMessage({options:Z||{},callback:Y})}W.init=function(Y){var ee=Y.transferControlToOffscreen();W.postMessage({canvas:ee},[ee])},W.fire=function(Y,ee,ae){if(D)return U(Y,null),D;var V=Math.random().toString(36).slice(2);return D=y(function(te){function se(I){I.data.callback===V&&(delete B[V],W.removeEventListener("message",se),D=null,v.clear(),ae(),te())}W.addEventListener("message",se),U(Y,V),B[V]=se.bind(null,{data:{callback:V}})}),D},W.reset=function(){W.postMessage({reset:!0});for(var Y in B)B[Y](),delete B[Y]}}return function(){if(E)return E;if(!n&&i){var W=["var CONFETTI, SIZE = {}, module = {};","("+t.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{E=new Worker(URL.createObjectURL(new Blob([W])))}catch(U){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("üéä Could not load worker",U),null}H(E)}return E}}(),p={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function h(E,D){return D?D(E):E}function u(E){return E!=null}function f(E,D,B){return h(E&&u(E[D])?E[D]:p[D],B)}function d(E){return E<0?0:Math.floor(E)}function o(E,D){return Math.floor(Math.random()*(D-E))+E}function g(E){return parseInt(E,16)}function m(E){return E.map(b)}function b(E){var D=String(E).replace(/[^0-9a-f]/gi,"");return D.length<6&&(D=D[0]+D[0]+D[1]+D[1]+D[2]+D[2]),{r:g(D.substring(0,2)),g:g(D.substring(2,4)),b:g(D.substring(4,6))}}function _(E){var D=f(E,"origin",Object);return D.x=f(D,"x",Number),D.y=f(D,"y",Number),D}function S(E){E.width=document.documentElement.clientWidth,E.height=document.documentElement.clientHeight}function C(E){var D=E.getBoundingClientRect();E.width=D.width,E.height=D.height}function R(E){var D=document.createElement("canvas");return D.style.position="fixed",D.style.top="0px",D.style.left="0px",D.style.pointerEvents="none",D.style.zIndex=E,D}function A(E,D,B,H,W,U,Z,Y,ee){E.save(),E.translate(D,B),E.rotate(U),E.scale(H,W),E.arc(0,0,1,Z,Y,ee),E.restore()}function T(E){var D=E.angle*(Math.PI/180),B=E.spread*(Math.PI/180);return{x:E.x,y:E.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:E.startVelocity*.5+Math.random()*E.startVelocity,angle2D:-D+(.5*B-Math.random()*B),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:E.color,shape:E.shape,tick:0,totalTicks:E.ticks,decay:E.decay,drift:E.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:E.gravity*3,ovalScalar:.6,scalar:E.scalar,flat:E.flat}}function M(E,D){D.x+=Math.cos(D.angle2D)*D.velocity+D.drift,D.y+=Math.sin(D.angle2D)*D.velocity+D.gravity,D.velocity*=D.decay,D.flat?(D.wobble=0,D.wobbleX=D.x+10*D.scalar,D.wobbleY=D.y+10*D.scalar,D.tiltSin=0,D.tiltCos=0,D.random=1):(D.wobble+=D.wobbleSpeed,D.wobbleX=D.x+10*D.scalar*Math.cos(D.wobble),D.wobbleY=D.y+10*D.scalar*Math.sin(D.wobble),D.tiltAngle+=.1,D.tiltSin=Math.sin(D.tiltAngle),D.tiltCos=Math.cos(D.tiltAngle),D.random=Math.random()+2);var B=D.tick++/D.totalTicks,H=D.x+D.random*D.tiltCos,W=D.y+D.random*D.tiltSin,U=D.wobbleX+D.random*D.tiltCos,Z=D.wobbleY+D.random*D.tiltSin;if(E.fillStyle="rgba("+D.color.r+", "+D.color.g+", "+D.color.b+", "+(1-B)+")",E.beginPath(),c&&D.shape.type==="path"&&typeof D.shape.path=="string"&&Array.isArray(D.shape.matrix))E.fill(P(D.shape.path,D.shape.matrix,D.x,D.y,Math.abs(U-H)*.1,Math.abs(Z-W)*.1,Math.PI/10*D.wobble));else if(D.shape.type==="bitmap"){var Y=Math.PI/10*D.wobble,ee=Math.abs(U-H)*.1,ae=Math.abs(Z-W)*.1,V=D.shape.bitmap.width*D.scalar,te=D.shape.bitmap.height*D.scalar,se=new DOMMatrix([Math.cos(Y)*ee,Math.sin(Y)*ee,-Math.sin(Y)*ae,Math.cos(Y)*ae,D.x,D.y]);se.multiplySelf(new DOMMatrix(D.shape.matrix));var I=E.createPattern(v.transform(D.shape.bitmap),"no-repeat");I.setTransform(se),E.globalAlpha=1-B,E.fillStyle=I,E.fillRect(D.x-V/2,D.y-te/2,V,te),E.globalAlpha=1}else if(D.shape==="circle")E.ellipse?E.ellipse(D.x,D.y,Math.abs(U-H)*D.ovalScalar,Math.abs(Z-W)*D.ovalScalar,Math.PI/10*D.wobble,0,2*Math.PI):A(E,D.x,D.y,Math.abs(U-H)*D.ovalScalar,Math.abs(Z-W)*D.ovalScalar,Math.PI/10*D.wobble,0,2*Math.PI);else if(D.shape==="star")for(var J=Math.PI/2*3,G=4*D.scalar,ne=8*D.scalar,oe=D.x,de=D.y,ue=5,ye=Math.PI/ue;ue--;)oe=D.x+Math.cos(J)*ne,de=D.y+Math.sin(J)*ne,E.lineTo(oe,de),J+=ye,oe=D.x+Math.cos(J)*G,de=D.y+Math.sin(J)*G,E.lineTo(oe,de),J+=ye;else E.moveTo(Math.floor(D.x),Math.floor(D.y)),E.lineTo(Math.floor(D.wobbleX),Math.floor(W)),E.lineTo(Math.floor(U),Math.floor(Z)),E.lineTo(Math.floor(H),Math.floor(D.wobbleY));return E.closePath(),E.fill(),D.tick<D.totalTicks}function k(E,D,B,H,W){var U=D.slice(),Z=E.getContext("2d"),Y,ee,ae=y(function(V){function te(){Y=ee=null,Z.clearRect(0,0,H.width,H.height),v.clear(),W(),V()}function se(){n&&!(H.width===l.width&&H.height===l.height)&&(H.width=E.width=l.width,H.height=E.height=l.height),!H.width&&!H.height&&(B(E),H.width=E.width,H.height=E.height),Z.clearRect(0,0,H.width,H.height),U=U.filter(function(I){return M(Z,I)}),U.length?Y=N.frame(se):te()}Y=N.frame(se),ee=te});return{addFettis:function(V){return U=U.concat(V),ae},canvas:E,promise:ae,reset:function(){Y&&N.cancel(Y),ee&&ee()}}}function F(E,D){var B=!E,H=!!f(D||{},"resize"),W=!1,U=f(D,"disableForReducedMotion",Boolean),Z=i&&!!f(D||{},"useWorker"),Y=Z?w():null,ee=B?S:C,ae=E&&Y?!!E.__confetti_initialized:!1,V=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,te;function se(J,G,ne){for(var oe=f(J,"particleCount",d),de=f(J,"angle",Number),ue=f(J,"spread",Number),ye=f(J,"startVelocity",Number),je=f(J,"decay",Number),st=f(J,"gravity",Number),ct=f(J,"drift",Number),Se=f(J,"colors",m),rt=f(J,"ticks",Number),Oe=f(J,"shapes"),bt=f(J,"scalar"),xe=!!f(J,"flat"),xt=_(J),Te=oe,Fe=[],ft=E.width*xt.x,Pe=E.height*xt.y;Te--;)Fe.push(T({x:ft,y:Pe,angle:de,spread:ue,startVelocity:ye,color:Se[Te%Se.length],shape:Oe[o(0,Oe.length)],ticks:rt,decay:je,gravity:st,drift:ct,scalar:bt,flat:xe}));return te?te.addFettis(Fe):(te=k(E,Fe,ee,G,ne),te.promise)}function I(J){var G=U||f(J,"disableForReducedMotion",Boolean),ne=f(J,"zIndex",Number);if(G&&V)return y(function(ye){ye()});B&&te?E=te.canvas:B&&!E&&(E=R(ne),document.body.appendChild(E)),H&&!ae&&ee(E);var oe={width:E.width,height:E.height};Y&&!ae&&Y.init(E),ae=!0,Y&&(E.__confetti_initialized=!0);function de(){if(Y){var ye={getBoundingClientRect:function(){if(!B)return E.getBoundingClientRect()}};ee(ye),Y.postMessage({resize:{width:ye.width,height:ye.height}});return}oe.width=oe.height=null}function ue(){te=null,H&&(W=!1,s.removeEventListener("resize",de)),B&&E&&(document.body.contains(E)&&document.body.removeChild(E),E=null,ae=!1)}return H&&!W&&(W=!0,s.addEventListener("resize",de,!1)),Y?Y.fire(J,oe,ue):se(J,oe,ue)}return I.reset=function(){Y&&Y.reset(),te&&te.reset()},I}var O;function z(){return O||(O=F(null,{useWorker:!0,resize:!0})),O}function P(E,D,B,H,W,U,Z){var Y=new Path2D(E),ee=new Path2D;ee.addPath(Y,new DOMMatrix(D));var ae=new Path2D;return ae.addPath(ee,new DOMMatrix([Math.cos(Z)*W,Math.sin(Z)*W,-Math.sin(Z)*U,Math.cos(Z)*U,B,H])),ae}function $(E){if(!c)throw new Error("path confetti are not supported in this browser");var D,B;typeof E=="string"?D=E:(D=E.path,B=E.matrix);var H=new Path2D(D),W=document.createElement("canvas"),U=W.getContext("2d");if(!B){for(var Z=1e3,Y=Z,ee=Z,ae=0,V=0,te,se,I=0;I<Z;I+=2)for(var J=0;J<Z;J+=2)U.isPointInPath(H,I,J,"nonzero")&&(Y=Math.min(Y,I),ee=Math.min(ee,J),ae=Math.max(ae,I),V=Math.max(V,J));te=ae-Y,se=V-ee;var G=10,ne=Math.min(G/te,G/se);B=[ne,0,0,ne,-Math.round(te/2+Y)*ne,-Math.round(se/2+ee)*ne]}return{type:"path",path:D,matrix:B}}function q(E){var D,B=1,H="#000000",W='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof E=="string"?D=E:(D=E.text,B="scalar"in E?E.scalar:B,W="fontFamily"in E?E.fontFamily:W,H="color"in E?E.color:H);var U=10*B,Z=""+U+"px "+W,Y=new OffscreenCanvas(U,U),ee=Y.getContext("2d");ee.font=Z;var ae=ee.measureText(D),V=Math.ceil(ae.actualBoundingBoxRight+ae.actualBoundingBoxLeft),te=Math.ceil(ae.actualBoundingBoxAscent+ae.actualBoundingBoxDescent),se=2,I=ae.actualBoundingBoxLeft+se,J=ae.actualBoundingBoxAscent+se;V+=se+se,te+=se+se,Y=new OffscreenCanvas(V,te),ee=Y.getContext("2d"),ee.font=Z,ee.fillStyle=H,ee.fillText(D,I,J);var G=1/B;return{type:"bitmap",bitmap:Y.transferToImageBitmap(),matrix:[G,0,0,G,-V*G/2,-te*G/2]}}r.exports=function(){return z().apply(this,arguments)},r.exports.reset=function(){z().reset()},r.exports.create=F,r.exports.shapeFromPath=$,r.exports.shapeFromText=q})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),Wr,!1);const tt=Wr.exports;var Ml=Wr.exports.create;const Kc=Object.freeze(Object.defineProperty({__proto__:null,create:Ml,default:tt},Symbol.toStringTag,{value:"Module"}));function Dl({onPasswordChange:t,userName:s}){const[r,n]=a.useState(""),[l,i]=a.useState(""),[c,j]=a.useState(!1),[x,y]=a.useState(!1),[v,N]=a.useState(!1),[w,p]=a.useState(""),[h,u]=a.useState(0),[f,d]=a.useState(0);a.useEffect(()=>{setTimeout(()=>u(1),100),setTimeout(()=>u(2),400)},[]),a.useEffect(()=>{const C=[g.minLength,g.hasUpperCase,g.hasLowerCase,g.hasNumbers,g.hasSpecialChar],A=C.filter(Boolean).length/C.length*100;d(A)},[r]);const g=(C=>{const R=C.length>=8,A=/[A-Z]/.test(C),T=/[a-z]/.test(C),M=/\d/.test(C),k=/[!@#$%^&*(),.?":{}|<>]/.test(C);return{minLength:R,hasUpperCase:A,hasLowerCase:T,hasNumbers:M,hasSpecialChar:k,isValid:R&&A&&T&&M&&k}})(r),m=r===l&&l.length>0,b=async C=>{if(C.preventDefault(),p(""),!g.isValid){p("„Éë„Çπ„ÉØ„Éº„Éâ„ÅåË¶Å‰ª∂„ÇíÊ∫Ä„Åü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ");return}if(!m){p("„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì„ÄÇ");return}N(!0);try{tt({particleCount:100,spread:70,origin:{y:.6}}),setTimeout(()=>{tt({particleCount:50,angle:60,spread:55,origin:{x:0}}),tt({particleCount:50,angle:120,spread:55,origin:{x:1}})},250),await t(r)}catch(R){console.error("Password change error:",R);const A=(R==null?void 0:R.message)||(R==null?void 0:R.error_description)||"";A.includes("different from the old password")?p("‰ª•Ââç„Å®Âêå„Åò„Éë„Çπ„ÉØ„Éº„Éâ„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇÂà•„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"):A.includes("Password should be at least")?p("„Éë„Çπ„ÉØ„Éº„Éâ„ÅÆÂΩ¢Âºè„ÅåË¶Å‰ª∂„ÇíÊ∫Ä„Åü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ"):A.includes("Auth session missing")?p("„Çª„ÉÉ„Ç∑„Éß„É≥„ÅÆÊúâÂäπÊúüÈôê„ÅåÂàá„Çå„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„É™„É≥„ÇØ„Åã„Çâ„ÇÑ„ÇäÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"):p("„Éë„Çπ„ÉØ„Éº„Éâ„ÅÆÂ§âÊõ¥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ")}finally{N(!1)}},_=()=>f<40?"bg-red-500":f<80?"bg-yellow-500":"bg-green-500",S=()=>f===0?"":f<40?"Âº±„ÅÑ":f<80?"ÊôÆÈÄö":"Âº∑„ÅÑ";return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden",children:e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md transition-all duration-700 ${h>=1?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-all duration-500 ${h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:e.jsx(ts,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),e.jsx("h1",{className:`text-2xl font-bold text-gray-900 dark:text-white mb-2 transition-all duration-500 delay-100 ${h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:"„ÅÇ„Å®1„Çπ„ÉÜ„ÉÉ„ÉóÔºÅ"}),e.jsxs("p",{className:`text-lg text-gray-600 dark:text-gray-300 mb-2 transition-all duration-500 delay-200 ${h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:["„Çà„ÅÜ„Åì„Åù„ÄÅ",s,"„Åï„Çì"]}),e.jsxs("div",{className:`bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-4 transition-all duration-500 delay-300 ${h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold",children:"1"}),e.jsx("div",{className:"w-12 h-1 bg-blue-600 dark:bg-blue-500 rounded"}),e.jsx("div",{className:"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold",children:"2"}),e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"w-8 h-8 bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 rounded-full flex items-center justify-center text-sm font-bold",children:"3"})]}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆ„Åü„ÇÅ„ÄÅÊñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c?"text":"password",id:"newPassword",value:r,onChange:C=>n(C.target.value),className:`
                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg 
                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent 
                  transition-colors
                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                  placeholder-gray-500 dark:placeholder-gray-400
                `,placeholder:"Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ",required:!0}),e.jsx("button",{type:"button",onClick:()=>j(!c),className:`
                  absolute right-3 top-1/2 transform -translate-y-1/2 
                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 
                  transition-colors
                `,children:c?e.jsx(Zt,{className:"w-5 h-5"}):e.jsx(Qt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"„Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:x?"text":"password",id:"confirmPassword",value:l,onChange:C=>i(C.target.value),className:`
                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg 
                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent 
                  transition-colors
                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                  placeholder-gray-500 dark:placeholder-gray-400
                `,placeholder:"„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÜçÂÖ•Âäõ",required:!0}),e.jsx("button",{type:"button",onClick:()=>y(!x),className:`
                  absolute right-3 top-1/2 transform -translate-y-1/2 
                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 
                  transition-colors
                `,children:x?e.jsx(Zt,{className:"w-5 h-5"}):e.jsx(Qt,{className:"w-5 h-5"})})]})]}),r&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"„Éë„Çπ„ÉØ„Éº„ÉâÂº∑Â∫¶"}),e.jsx("span",{className:`text-sm font-bold ${f<40?"text-red-600 dark:text-red-400":f<80?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"}`,children:S()})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full ${_()} transition-all duration-500 rounded-full`,style:{width:`${f}%`}})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-700 dark:to-blue-900/20 rounded-lg p-4 transition-colors",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 transition-colors",children:"„Éë„Çπ„ÉØ„Éº„ÉâË¶Å‰ª∂"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:`flex items-center transition-colors ${g.minLength?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"8ÊñáÂ≠ó‰ª•‰∏ä"})]}),e.jsxs("div",{className:`flex items-center transition-colors ${g.hasUpperCase?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Â§ßÊñáÂ≠ó„ÇíÂê´„ÇÄ"})]}),e.jsxs("div",{className:`flex items-center transition-colors ${g.hasLowerCase?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Â∞èÊñáÂ≠ó„ÇíÂê´„ÇÄ"})]}),e.jsxs("div",{className:`flex items-center transition-colors ${g.hasNumbers?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Êï∞Â≠ó„ÇíÂê´„ÇÄ"})]}),e.jsxs("div",{className:`flex items-center transition-colors ${g.hasSpecialChar?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"}`,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"ÁâπÊÆäÊñáÂ≠ó„ÇíÂê´„ÇÄ (!@#$%^&*)"})]})]})]}),l.length>0&&e.jsxs("div",{className:`flex items-center text-sm transition-colors ${m?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:m?"„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åô":"„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì"})]}),w&&e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors",children:[e.jsx(pe,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:w})]}),e.jsx("button",{type:"submit",disabled:v||!g.isValid||!m,className:`
              w-full bg-orange-600 dark:bg-orange-700 text-white py-3 px-4 rounded-lg 
              hover:bg-orange-700 dark:hover:bg-orange-600 
              focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800 
              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium
            `,children:v?"„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥‰∏≠...":"„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂ§âÊõ¥"})]}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 mb-3",children:e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 font-medium",children:"„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥Âæå„ÄÅ„ÉÅ„Éº„É†„Å´ÂèÇÂä†ÂÆå‰∫Ü„Åß„ÅôÔºÅ"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Ëá™ÂãïÁöÑ„Å´„Ç∑„Çπ„ÉÜ„É†„Å´„É≠„Ç∞„Ç§„É≥„Åï„Çå„Åæ„Åô"})]})]})})}function Tl({onContinue:t}){const[s,r]=a.useState(!0),[n,l]=a.useState(null),[i,c]=a.useState(null),[j,x]=a.useState(0),v=new URL(window.location.href).searchParams.get("token")??"";a.useEffect(()=>{(async()=>{try{if(!v){l("ÊãõÂæÖ„Éà„Éº„ÇØ„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºàURL„Å´ token „Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºâ"),r(!1);return}console.log("üîç Fetching invitation with token:",v),console.log("üì° Supabase URL:","http://127.0.0.1:54321");const u=await fetch(`http://127.0.0.1:54321/rest/v1/invitation_tokens?token=eq.${v}&select=email,name,role,team_id,organization_id,invited_by,expires_at`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json",Prefer:"return=representation"}});if(console.log("üì¨ Response status:",u.status),!u.ok){const m=await u.text();console.error("‚ùå API Error:",m),l(`ÊãõÂæÖÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü (${u.status})`),r(!1);return}const f=await u.json();if(console.log("üì¶ Received data:",f),!f||f.length===0){console.warn("‚ö†Ô∏è No invitation found for token"),l("ÊãõÂæÖ„É™„É≥„ÇØ„ÅåÁÑ°Âäπ„Åæ„Åü„ÅØÊúüÈôêÂàá„Çå„Åß„Åô"),r(!1);return}const d=f[0];console.log("‚úÖ Invitation found:",d);let o;if(d.team_id){console.log("üè¢ Fetching team info for:",d.team_id);const m=await fetch(`http://127.0.0.1:54321/rest/v1/teams?id=eq.${d.team_id}&select=name`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json"}});if(m.ok){const b=await m.json();b&&b.length>0&&(o=b[0].name,console.log("‚úÖ Team found:",o))}}let g;if(d.organization_id){console.log("üè¢ Fetching organization info for:",d.organization_id);const m=await fetch(`http://127.0.0.1:54321/rest/v1/organizations?id=eq.${d.organization_id}&select=name`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json"}});if(m.ok){const b=await m.json();b&&b.length>0&&(g=b[0].name,console.log("‚úÖ Organization found:",g))}}c({email:d.email,name:d.name,role:d.role,team_name:o,organization_name:g,expires_at:d.expires_at}),r(!1),setTimeout(()=>x(1),100),setTimeout(()=>x(2),400),setTimeout(()=>x(3),800),setTimeout(()=>{tt({particleCount:100,spread:70,origin:{y:.6}})},1200)}catch(u){console.error("‚ùå Error fetching invitation:",u),l("ÊãõÂæÖÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),r(!1)}})()},[v]);const N=()=>{i&&(tt({particleCount:50,angle:60,spread:55,origin:{x:0}}),tt({particleCount:50,angle:120,spread:55,origin:{x:1}}),setTimeout(()=>{t()},500))},w=h=>{switch(h){case"athlete":return"„Ç¢„Çπ„É™„Éº„Éà";case"staff":return"„Çπ„Çø„ÉÉ„Éï";case"global_admin":return"ÁÆ°ÁêÜËÄÖ";default:return h}},p=h=>{const u=new Date,d=new Date(h).getTime()-u.getTime(),o=Math.floor(d/(1e3*60*60)),g=Math.floor(d%(1e3*60*60)/(1e3*60));return o>0?`„ÅÇ„Å®${o}ÊôÇÈñì`:g>0?`„ÅÇ„Å®${g}ÂàÜ`:"Èñì„ÇÇ„Å™„ÅèÊúüÈôêÂàá„Çå"};return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 dark:border-blue-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg",children:"ÊãõÂæÖÊÉÖÂ†±„ÇíÁ¢∫Ë™ç‰∏≠..."})]})}):n||!i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-900 dark:to-red-900 flex items-center justify-center p-4 transition-colors",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"bg-red-100 dark:bg-red-900 rounded-full p-4 w-16 h-16 mx-auto mb-4",children:e.jsx(gt,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"ÊãõÂæÖ„É™„É≥„ÇØ„ÅåÁÑ°Âäπ„Åß„Åô"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:n||"ÊãõÂæÖ„É™„É≥„ÇØ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑ„Åã„ÄÅÊúüÈôêÂàá„Çå„Åß„Åô"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ÁÆ°ÁêÜËÄÖ„Å´Êñ∞„Åó„ÅÑÊãõÂæÖ„É™„É≥„ÇØ„Çí„É™„ÇØ„Ç®„Çπ„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden",children:e.jsxs("div",{className:"max-w-2xl w-full",children:[e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden transform transition-all duration-700 ${j>=1?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 px-8 py-12 text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-900 opacity-10",children:e.jsx("div",{className:"absolute top-0 left-0 w-full h-full",style:{backgroundImage:"radial-gradient(circle, white 1px, transparent 1px)",backgroundSize:"30px 30px"}})}),e.jsxs("div",{className:`transform transition-all duration-700 delay-200 ${j>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-full p-4 w-20 h-20 mx-auto mb-6 shadow-lg",children:e.jsx(ts,{className:"w-12 h-12 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("h1",{className:"text-4xl font-bold text-white mb-3",children:["„Çà„ÅÜ„Åì„Åù„ÄÅ",i.name,"„Åï„ÇìÔºÅ"]}),(i.organization_name||i.team_name)&&e.jsxs("div",{className:"space-y-2",children:[i.organization_name&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:i.organization_name}),i.team_name&&e.jsx("span",{children:"-"}),i.team_name&&e.jsx("span",{className:"font-semibold",children:i.team_name}),e.jsx("span",{children:"„Åå„ÅÇ„Å™„Åü„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô"})]}),!i.organization_name&&i.team_name&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:i.team_name}),e.jsx("span",{children:"„Åå„ÅÇ„Å™„Åü„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô"})]})]}),e.jsx("p",{className:"text-blue-100 dark:text-blue-200 text-lg mt-2",children:"Bekuta „Å∏„ÅÆÊãõÂæÖ"})]})]}),e.jsx("div",{className:"px-8 py-10",children:e.jsxs("div",{className:`transform transition-all duration-700 delay-400 ${j>=3?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(Xt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"„ÅÇ„Å™„Åü„ÅÆÂΩπÂâ≤"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[w(i.role),"„Å®„Åó„Å¶ÂèÇÂä†„Åó„Åæ„Åô"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(Xt,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:i.email})]})]}),e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(gt,{className:"w-6 h-6 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"ÊãõÂæÖ„ÅÆÊúâÂäπÊúüÈôê"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:p(i.expires_at)})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-8",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3 text-center",children:"Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó"}),e.jsxs("ol",{className:"space-y-2 text-gray-600 dark:text-gray-300 text-sm",children:[e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),e.jsx("span",{children:"„É°„Éº„É´„Å´Ë®òËºâ„Åï„Çå„Åü‰∏ÄÊôÇ„Éë„Çπ„ÉØ„Éº„Éâ„Åß„É≠„Ç∞„Ç§„É≥"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),e.jsx("span",{children:"„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆ„Åü„ÇÅÊñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ„Å´Â§âÊõ¥"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),e.jsx("span",{children:"„ÉÅ„Éº„É†„Å´ÂèÇÂä†ÂÆå‰∫ÜÔºÅ"})]})]})]}),e.jsxs("button",{onClick:N,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 text-white py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 dark:hover:from-blue-600 dark:hover:to-indigo-600 transition-all duration-300 font-semibold text-lg flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx("span",{children:"„É≠„Ç∞„Ç§„É≥„Åó„Å¶Âßã„ÇÅ„Çã"}),e.jsx(cs,{className:"w-5 h-5"})]})]})})]}),e.jsx("p",{className:"text-center text-sm text-gray-600 dark:text-gray-400 mt-6",children:"ÂïèÈ°å„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà„ÅØ„ÄÅÊãõÂæÖ„ÇíÈÄÅ„Å£„ÅüÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ"})]})})}function El(t,s){return t===21?{title:"üéâ ACWRÂàÜÊûê„ÅåÂà©Áî®ÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅ",message:"3ÈÄ±Èñì„ÅÆ„Éá„Éº„ÇøËìÑÁ©çÂÆå‰∫Ü„ÄÇ„Åì„Çå„Åã„ÇâACWR„ÅßÊÄ™Êàë„É™„Çπ„ÇØ„ÇíÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇ",type:"milestone",showConfetti:!0}:t===28?{title:"‚ú® Êé®Â•®ÊúüÈñìÈÅîÊàêÔºÅ",message:"4ÈÄ±Èñì„ÅÆÂÆåÂÖ®„Å™„Éá„Éº„Çø„ÅåÊèÉ„ÅÑ„Åæ„Åó„Åü„ÄÇÈ´òÁ≤æÂ∫¶„Å™ACWRÂàÜÊûê„ÅåÂèØËÉΩ„Åß„Åô„ÄÇ",type:"milestone",showConfetti:!0}:t===7?{title:"üéØ 1ÈÄ±ÁõÆÂÆå‰∫ÜÔºÅ",message:"È†ÜË™ø„Åß„Åô„ÄÇ„ÅÇ„Å®2ÈÄ±Èñì„ÅßACWRÂàÜÊûê„ÅåÂßã„Åæ„Çä„Åæ„Åô„ÄÇ",type:"milestone"}:t===14?{title:"üìà 2ÈÄ±ÁõÆÂÆå‰∫ÜÔºÅ",message:"Êäò„ÇäËøî„ÅóÂú∞ÁÇπ„ÇíÈÄöÈÅé„ÄÇ„ÅÇ„Å®1ÈÄ±Èñì„ÅßACWRÂàÜÊûêÈñãÂßã„Åß„Åô„ÄÇ",type:"milestone"}:s===3?{title:"üî• 3Êó•ÈÄ£Á∂öË®òÈå≤ÔºÅ",message:"Á∂ôÁ∂ö„ÅØÂäõ„Å™„Çä„ÄÇ„Åì„ÅÆË™øÂ≠ê„Åß„Éá„Éº„Çø„ÇíËìÑÁ©ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",type:"success"}:s===7?{title:"üí™ 1ÈÄ±ÈñìÈÄ£Á∂öË®òÈå≤ÔºÅ",message:"Á¥†Êô¥„Çâ„Åó„ÅÑÁøíÊÖ£Âåñ„Åß„Åô„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Ë®òÈå≤„ÅåÊ≠£Á¢∫„Å™ÂàÜÊûê„Å´„Å§„Å™„Åå„Çä„Åæ„Åô„ÄÇ",type:"success"}:s===14?{title:"‚≠ê 2ÈÄ±ÈñìÈÄ£Á∂öË®òÈå≤ÔºÅ",message:"È©öÁï∞ÁöÑ„Å™Á∂ôÁ∂öÂäõ„Åß„Åô„ÄÇ„ÇÇ„ÅÜ„Åô„ÅêACWRÂàÜÊûê„ÅåÂßã„Åæ„Çä„Åæ„Åô„ÄÇ",type:"success"}:t%5===0&&t<21?{title:"Ë®òÈå≤Á∂ôÁ∂ö‰∏≠",message:`${t}Êó•ÁõÆ„ÅÆË®òÈå≤ÂÆå‰∫Ü„ÄÇACWRÂàÜÊûê„Åæ„Åß„ÅÇ„Å®${21-t}Êó•„Åß„Åô„ÄÇ`,type:"encouragement"}:null}function nr({isOpen:t,onClose:s,onOverwrite:r,onCancel:n,title:l,date:i,existingValues:c,newValues:j}){return a.useEffect(()=>{if(!t)return;const x=document.body.style.overflow,y=document.body.style.touchAction;return document.body.style.overflow="hidden",document.body.style.touchAction="none",()=>{document.body.style.overflow=x,document.body.style.touchAction=y}},[t]),t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 overscroll-contain",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[85vh] overflow-y-auto",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"„Éá„Éº„Çø„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô"})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",type:"button",children:e.jsx(Me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"„Åì„ÅÆÊó•‰ªò„Å´„ÅØÊó¢„Å´„Éá„Éº„Çø„ÅåÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Ë®òÈå≤„Çø„Ç§„Éó"}),e.jsx("p",{className:"text-base text-gray-900 dark:text-white",children:l})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Êó•‰ªò"}),e.jsx("p",{className:"text-base text-gray-900 dark:text-white",children:new Date(i).toLocaleDateString("ja-JP")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"ÁèæÂú®„ÅÆÂÄ§"}),e.jsx("div",{className:"space-y-1",children:c.map((x,y)=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:x.label}),e.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:x.value})]},y))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Êñ∞„Åó„ÅÑÂÄ§"}),e.jsx("div",{className:"space-y-1",children:j.map((x,y)=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:x.label}),e.jsx("p",{className:"text-base font-semibold text-blue-600 dark:text-blue-400",children:x.value})]},y))})]})]})]})}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"‰∏äÊõ∏„Åç„Åô„Çã„Å®„ÄÅÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ"})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-lg",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",type:"button",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",type:"button",children:"‰∏äÊõ∏„Åç„Åô„Çã"})]})]})}):null}const ur=(t,s,r)=>Math.max(s,Math.min(r,t));function sn({value:t,onChange:s,label:r="ÊàêÈï∑ÂÆüÊÑü",hint:n="‰ªäÊó•„ÅÆÁ∑¥Áøí„Åß„ÅÆÊàêÈï∑ÂÆüÊÑü„ÅØÔºü"}){const l=a.useRef(null),i=a.useRef(!1),[c,j]=a.useState(!1),x=ur(Math.round(t),0,100),y=a.useMemo(()=>x===0?0:x<=20?1:x<=40?2:x<=60?3:x<=80?4:5,[x]),v=a.useMemo(()=>{switch(y){case 0:return"„Å™„Åó";case 1:return"„Å°„Çá„ÅÑ";case 2:return"Â∞ë„Åó";case 3:return"„Åù„Åì„Åù„Åì";case 4:return"„Åã„Å™„Çä";case 5:return"„ÇÅ„Å°„ÇÉ";default:return""}},[y]),N=a.useMemo(()=>{const m=18+202*(x/100),b=2.5+(14-2.5)*(x/100),_=24,S=70,C=_+m,R=10+b*1.2;return{x0:_,y:S,x1:C,stroke:b,head:R}},[x]),w=f=>{const d=l.current;if(!d)return;const o=d.getBoundingClientRect(),g=24,m=24,b=ur(f-o.left,g,o.width-m),_=o.width-g-m,S=Math.round((b-g)/_*100);s(ur(S,0,100))},p=f=>{var d,o;i.current=!0,j(!0),(o=(d=f.currentTarget).setPointerCapture)==null||o.call(d,f.pointerId),w(f.clientX)},h=f=>{i.current&&w(f.clientX)},u=()=>{i.current=!1,j(!1)};return a.useEffect(()=>{const f=()=>u();return window.addEventListener("pointerup",f),window.addEventListener("pointercancel",f),()=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",f)}},[]),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:r}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-300 mt-1",children:n})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:v})})]}),e.jsx("div",{ref:l,className:`mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none ${c?"ring-2 ring-blue-500":""}`,onPointerDown:p,onPointerMove:h,style:{touchAction:"none",WebkitTapHighlightColor:"transparent"},children:e.jsxs("svg",{viewBox:"0 0 300 140",className:"w-full h-20",children:[e.jsx("line",{x1:"24",y1:"70",x2:"276",y2:"70",stroke:"currentColor",opacity:"0.10",strokeWidth:"2"}),(()=>{const f=N.x1,d=N.y,o=Math.max(14,N.stroke*2.2),g=Math.max(10,N.stroke*1.2),m=f-o;return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:N.x0,y1:d,x2:m,y2:d,stroke:"currentColor",className:"text-blue-600 dark:text-blue-400",strokeWidth:N.stroke,strokeLinecap:"butt"}),e.jsx("polygon",{points:`
                  ${f},${d}
                  ${m},${d-g}
                  ${m},${d+g}
                `,fill:"currentColor",className:"text-blue-600 dark:text-blue-400"}),e.jsx("circle",{cx:f,cy:d,r:18,fill:"transparent",pointerEvents:"all"})]})})()]})})]})}const Ps=(t,s,r)=>Math.max(s,Math.min(r,t));function rn({value:t,onChange:s,label:r="ÁêÜËß£Â∫¶",hint:n="‰ªäÊó•„ÅÆÁ∑¥Áøí„ÅÆÁêÜËß£Â∫¶(ÁõÆÁöÑ/„Ç≥„ÉÑ)„ÅØÔºü"}){const l=a.useRef(null),i=a.useRef(!1),[c,j]=a.useState(!1),x=Ps(Math.round(t),0,100),y=a.useMemo(()=>x===0?0:x<=20?1:x<=40?2:x<=60?3:x<=80?4:5,[x]),v=a.useMemo(()=>{switch(y){case 0:return"ÂàÜ„Åã„Çâ„Çì";case 1:return"„ÅÜ„Å£„Åô„Çâ";case 2:return"Â∞ë„Åó";case 3:return"„Å†„ÅÑ„Åü„ÅÑ";case 4:return"„Åã„Å™„Çä";case 5:return"ËÖπËêΩ„Å°";default:return""}},[y]),N=a.useMemo(()=>{const f=[18,30,44,60,78],d=1+x/100*.18,o=x/100*5;return f.map((g,m)=>{const b=Ps(o-m,0,1);return{height:Math.round(g*d),lit:b}})},[x]),w=f=>{const d=l.current;if(!d)return;const o=d.getBoundingClientRect(),g=16,m=16,b=Ps(f-o.left,g,o.width-m),_=o.width-g-m,S=Math.round((b-g)/_*100);s(Ps(S,0,100))},p=f=>{var d,o;i.current=!0,j(!0),(o=(d=f.currentTarget).setPointerCapture)==null||o.call(d,f.pointerId),w(f.clientX)},h=f=>{i.current&&w(f.clientX)},u=()=>{i.current=!1,j(!1)};return a.useEffect(()=>{const f=()=>u();return window.addEventListener("pointerup",f),window.addEventListener("pointercancel",f),()=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",f)}},[]),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:r}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-300 mt-1",children:n})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:v})})]}),e.jsx("div",{ref:l,className:`mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none ${c?"ring-2 ring-blue-500":""}`,onPointerDown:p,onPointerMove:h,style:{touchAction:"none",WebkitTapHighlightColor:"transparent"},children:e.jsx("div",{className:"flex items-end justify-center gap-3 h-24",children:N.map((f,d)=>{const o=.25+f.lit*.75,g=10+f.lit*8;return e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx("div",{className:"rounded-full bg-blue-600 dark:bg-blue-400",style:{height:f.height,width:g,opacity:o,transition:"height 120ms ease, width 120ms ease, opacity 120ms ease"}})},d)})})})]})}function Rs({open:t,message:s,type:r="success",durationMs:n=1800,onClose:l}){if(a.useEffect(()=>{if(!t)return;const j=window.setTimeout(l,n);return()=>window.clearTimeout(j)},[t,n,l]),!t)return null;const i=r==="success",c=r==="error";return e.jsx("div",{className:"fixed bottom-5 left-1/2 -translate-x-1/2 z-[80] px-4",children:e.jsxs("div",{className:["flex items-center gap-3 rounded-xl shadow-xl border px-4 py-3 w-[min(92vw,420px)]","bg-white dark:bg-gray-900",i?"border-green-200 dark:border-green-900/40":c?"border-red-200 dark:border-red-900/40":"border-gray-200 dark:border-gray-700"].join(" "),role:"status","aria-live":"polite",children:[i?e.jsx(Xt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):c?e.jsx(ge,{className:"w-5 h-5 text-red-600 dark:text-red-400"}):e.jsx(Xt,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"}),e.jsx("div",{className:"flex-1 text-sm text-gray-900 dark:text-gray-100",children:s}),e.jsx("button",{type:"button",onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200","aria-label":"Èñâ„Åò„Çã",children:e.jsx(Me,{className:"w-4 h-4"})})]})})}const Al=()=>{const t=new Date,s=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${s}-${r}-${n}`};function Rl({userId:t,onSubmit:s,onCheckExisting:r,onUpdate:n,loading:l,lastRecord:i,weeklyAverage:c,daysWithData:j=0,consecutiveDays:x=0}){var G,ne;const y=Al(),[v,N]=a.useState(0),[w,p]=a.useState(0),[h,u]=a.useState(y),[f,d]=a.useState(50),[o,g]=a.useState(50),[m,b]=a.useState(!1),[_,S]=a.useState(""),[C,R]=a.useState(""),[A,T]=a.useState(null),[M,k]=a.useState(!1),[F,O]=a.useState(null),[z,P]=a.useState(null),[$,q]=a.useState(!1),[E,D]=a.useState("success"),[B,H]=a.useState(""),W=(oe,de)=>{D(oe),H(de),q(!0)},U=()=>{N(0),p(0),d(50),g(50),u(y)},Z=()=>{const oe=El(j+1,x+1);oe&&(T(oe),oe.showConfetti&&tt({particleCount:100,spread:70,origin:{y:.6}}))},Y=async oe=>{if(oe.preventDefault(),!(m||l)){if(S(""),v===0&&w>0){S("RPE 0Ôºà‰ºëÈ§äÊó•Ôºâ„ÅÆÂ†¥Âêà„ÅØ„ÄÅÊôÇÈñì„ÇÇ 0 ÂàÜ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),W("error","ÂÖ•ÂäõÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰ºëÈ§äÊó•„ÅÆ„É´„Éº„É´Ôºâ");return}if(v>0&&w===0){S("RPE „Åå 1 ‰ª•‰∏ä„ÅÆ„Å®„Åç„ÅØ„ÄÅÁ∑¥ÁøíÊôÇÈñì„ÇÇ 1 ÂàÜ‰ª•‰∏ä„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),W("error","ÂÖ•ÂäõÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÊôÇÈñì„Åå 0 ÂàÜÔºâ");return}try{const de=await r(h);if(de){O(de),P({rpe:v,duration_min:w,date:h,arrow_score:f,signal_score:o}),k(!0);return}}catch(de){console.error("Error checking existing training record:",de),S("Êó¢Â≠ò„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),W("error","Êó¢Â≠ò„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");return}b(!0);try{await s({rpe:v,duration_min:w,date:h,arrow_score:f,signal_score:o}),Z(),W("success","Á∑¥ÁøíË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü ‚úÖ"),U()}catch(de){if(console.error("Error submitting training record:",de),de instanceof Error)if(de.message.includes("duplicate key value violates unique constraint")){const ue=`${new Date(h).toLocaleDateString("ja-JP")}„ÅÆË®òÈå≤„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô„ÄÇ`;S(ue),W("error",ue)}else S(de.message||"Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ"),W("error",de.message||"Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");else S("Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ"),W("error","Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{b(!1)}}},ee=async()=>{if(!(!F||!z)&&!(m||l)){b(!0),k(!1),S("");try{await n(F.id,{rpe:z.rpe,duration_min:z.duration_min,arrow_score:z.arrow_score,signal_score:z.signal_score}),Z(),W("success","‰∏äÊõ∏„Åç„Åó„Å¶‰øùÂ≠ò„Åó„Åæ„Åó„Åü ‚úÖ"),U(),O(null),P(null)}catch(oe){console.error("Error updating record:",oe),S("Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),W("error","Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{b(!1)}}},ae=()=>{k(!1),O(null),P(null)},V=(oe,de)=>{if(oe===0||de===0){R("");return}const ue=oe*de;c&&ue>c.load*2?R("„ÅÑ„Å§„ÇÇ„ÅÆ2ÂÄç‰ª•‰∏ä„ÅÆË≤†Ëç∑„Åß„Åô„ÄÇÂÖ•ÂäõÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"):c&&ue>c.load*1.5?R("„ÅÑ„Å§„ÇÇ„Çà„ÇäÈ´ò„ÅÑË≤†Ëç∑„Åß„Åô„ÄÇ"):ue>1e3?R("ÈùûÂ∏∏„Å´È´ò„ÅÑË≤†Ëç∑„Åß„Åô„ÄÇÂÖ•ÂäõÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"):R("")},te=oe=>{const de=Number(oe.target.value);N(de),V(de,w)},se=oe=>{const de=Number(oe.target.value);p(de),V(v,de)},I=["0 - ‰ºëÈ§ä„Éª„Åæ„Å£„Åü„ÅèÈÅãÂãï„Åó„Å¶„ÅÑ„Å™„ÅÑ","1 - ÈùûÂ∏∏„Å´Ê•Ω„Åß„ÅÇ„Çã","2 - Ê•Ω„Åß„ÅÇ„Çã","3 - Â∞ë„Åó„Åç„Å§„ÅÑ","4 - „ÇÑ„ÇÑ„Åç„Å§„ÅÑ","5 - „Åç„Å§„ÅÑ","6 - „Åï„Çâ„Å´„Åç„Å§„ÅÑ","7 - „Å®„Å¶„ÇÇ„Åç„Å§„ÅÑ","8 - „Åã„Å™„Çä„Åç„Å§„ÅÑ","9 - ÈùûÂ∏∏„Å´„Åç„Å§„ÅÑ","10 - ÊúÄÂ§ßÈôê„Å´„Åç„Å§„ÅÑ (ÈôêÁïå)"];a.useEffect(()=>{if(!A)return;const oe=setTimeout(()=>T(null),5e3);return()=>clearTimeout(oe)},[A]);const J=v*w;return e.jsxs(e.Fragment,{children:[e.jsx(Rs,{open:$,type:E,message:B,onClose:()=>q(!1)}),e.jsx(nr,{isOpen:M,onClose:ae,onOverwrite:ee,onCancel:ae,title:"Á∑¥ÁøíË®òÈå≤",date:h,existingValues:[{label:"RPE",value:((G=F==null?void 0:F.rpe)==null?void 0:G.toString())||"-"},{label:"ÊôÇÈñì",value:`${(F==null?void 0:F.duration_min)||0}ÂàÜ`},{label:"Áü¢Âç∞",value:`${(F==null?void 0:F.arrow_score)??"-"} / 100`},{label:"ÈõªÊ≥¢",value:`${(F==null?void 0:F.signal_score)??"-"} / 100`}],newValues:[{label:"RPE",value:((ne=z==null?void 0:z.rpe)==null?void 0:ne.toString())||"-"},{label:"ÊôÇÈñì",value:`${(z==null?void 0:z.duration_min)||0}ÂàÜ`},{label:"Áü¢Âç∞",value:`${(z==null?void 0:z.arrow_score)??"-"} / 100`},{label:"ÈõªÊ≥¢",value:`${(z==null?void 0:z.signal_score)??"-"} / 100`}]}),e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[A&&e.jsx("div",{className:`rounded-lg border-2 p-4 animate-in slide-in-from-top-2 duration-300 ${A.type==="milestone"?"bg-green-50 dark:bg-green-900/20 border-green-500 dark:border-green-700":A.type==="success"?"bg-blue-50 dark:bg-blue-900/20 border-blue-500 dark:border-blue-700":"bg-purple-50 dark:bg-purple-900/20 border-purple-500 dark:border-purple-700"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[A.type==="milestone"?e.jsx(Ne,{className:"w-6 h-6 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}):e.jsx(ts,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-base mb-1 ${A.type==="milestone"?"text-green-700 dark:text-green-300":A.type==="success"?"text-blue-700 dark:text-blue-300":"text-purple-700 dark:text-purple-300"}`,children:A.title}),e.jsx("p",{className:`text-sm ${A.type==="milestone"?"text-green-600 dark:text-green-400":A.type==="success"?"text-blue-600 dark:text-blue-400":"text-purple-600 dark:text-purple-400"}`,children:A.message})]})]})}),i&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"text-blue-600 dark:text-blue-400 mb-1",children:"ÂâçÂõû„ÅÆË®òÈå≤"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["RPE ",i.rpe??"-"," √ó ",i.duration_min??"-","ÂàÜ = Ë≤†Ëç∑"," ",(i.rpe??0)*(i.duration_min??0)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Êó•‰ªò"]}),e.jsx("input",{type:"date",value:h,onChange:oe=>u(oe.target.value),disabled:m||l,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Ut,{className:"w-4 h-4 mr-2"}),"RPEÔºàÈÅãÂãïÂº∑Â∫¶Ôºâ"]}),e.jsx("input",{type:"range",min:"0",max:"10",value:v,onChange:te,disabled:m||l,className:"w-full"}),e.jsx("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-200",children:I[v]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Á∑¥ÁøíÊôÇÈñìÔºàÂàÜÔºâ"]}),e.jsx("input",{type:"number",min:"0",max:"480",value:w,onChange:se,disabled:m||l,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60",style:{fontSize:"16px"}}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"‚Äª ‰ºëÈ§äÊó•„ÅØ„ÄåRPE=0 / ÊôÇÈñì=0„Äç"})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"‰ªäÊó•„ÅÆË≤†Ëç∑"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:J})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:[e.jsx(sn,{value:f,onChange:d}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:["Áü¢Âç∞ÔºàÊàêÈï∑ÂÆüÊÑüÔºâ: ",f,"/100"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:[e.jsx(rn,{value:o,onChange:g}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:["ÈõªÊ≥¢ÔºàÊÑèÂõ≥ÁêÜËß£Ôºâ: ",o,"/100"]})]})]}),C&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg text-yellow-700 dark:text-yellow-300",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:C})]}),_&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:_})]}),e.jsxs("button",{type:"submit",disabled:l||m,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[e.jsx(It,{className:"w-4 h-4 mr-2"}),m?"‰øùÂ≠ò‰∏≠...":"Ë®òÈå≤„Åô„Çã"]})]})]})}function gr({daysWithData:t,isDarkMode:s}){const l=Math.min(t/28*100,100),i=t>=21,c=t>=28,x=(()=>{if(c)return{icon:Ne,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",progressColor:"bg-green-500",title:"ACWRÂàÜÊûêÔºöÂà©Áî®ÂèØËÉΩ",message:"ÂçÅÂàÜ„Å™„Éá„Éº„Çø„ÅåËìÑÁ©ç„Åï„Çå„Åæ„Åó„Åü„ÄÇÁ≤æÂ∫¶„ÅÆÈ´ò„ÅÑACWRÂàÜÊûê„ÅåÂèØËÉΩ„Åß„Åô„ÄÇ"};if(i)return{icon:pe,color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",progressColor:"bg-yellow-500",title:"ACWRÂàÜÊûêÔºöÂà©Áî®ÂèØËÉΩÔºàÁ≤æÂ∫¶Âêë‰∏ä‰∏≠Ôºâ",message:`„Éá„Éº„Çø„ÅåÂ¢ó„Åà„Çã„Åª„Å©Á≤æÂ∫¶„Åå‰∏ä„Åå„Çä„Åæ„Åô„ÄÇ„ÅÇ„Å®${28-t}Êó•„ÅßÊé®Â•®ÊúüÈñì„Å´Âà∞ÈÅî„Åó„Åæ„Åô„ÄÇ`};{const N=Math.floor(t/7)+1;return{icon:_e,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",progressColor:"bg-blue-500",title:`„Éá„Éº„ÇøÂèéÈõÜ‰∏≠Ôºà${N}ÈÄ±ÁõÆÔºâ`,message:`ACWRÂàÜÊûê„Åæ„Åß„ÅÇ„Å®${21-t}Êó•„ÄÇÁ∂ôÁ∂ö„Åó„Å¶„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜÔºÅ`}}})(),y=x.icon,v=()=>[{day:7,label:"1ÈÄ±ÁõÆ",reached:t>=7},{day:14,label:"2ÈÄ±ÁõÆ",reached:t>=14},{day:21,label:`3ÈÄ±ÁõÆ
(ÊúÄ‰Ωé„É©„Ç§„É≥)`,reached:t>=21},{day:28,label:`4ÈÄ±ÁõÆ
(Êé®Â•®)`,reached:t>=28}];return e.jsxs("div",{className:`rounded-lg border ${x.borderColor} ${x.bgColor} p-4 sm:p-6`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(y,{className:`${x.color} flex-shrink-0 mt-0.5`,size:24}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold ${x.color} text-base sm:text-lg mb-1`,children:x.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:x.message})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["Ë®òÈå≤Êó•Êï∞: ",t,"Êó•"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[Math.round(l),"%"]})]}),e.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:`absolute inset-y-0 left-0 ${x.progressColor} rounded-full transition-all duration-500 ease-out`,style:{width:`${l}%`}}),v().map(N=>{const w=N.day/28*100;return e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white dark:bg-gray-600",style:{left:`${w}%`}},N.day)})]}),e.jsx("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:v().map(N=>e.jsxs("div",{className:`flex flex-col items-center ${N.reached?"text-gray-700 dark:text-gray-300 font-medium":""}`,children:[e.jsx("span",{className:"whitespace-pre-line text-center leading-tight",children:N.label}),N.reached&&e.jsx(Ne,{size:12,className:"text-green-500 mt-0.5"})]},N.day))})]}),!c&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ke,{size:16,className:"text-gray-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ACWR„ÅØÊÄ•ÊÄßË≤†Ëç∑ÔºàÁõ¥Ëøë1ÈÄ±ÈñìÔºâ„Å®ÊÖ¢ÊÄßË≤†Ëç∑ÔºàÈÅéÂéª4ÈÄ±ÈñìÔºâ„ÅÆÊØîÁéá„Åß„Åô„ÄÇ Á∂ôÁ∂öÁöÑ„Å™Ë®òÈå≤„Åß„ÄÅ„Çà„ÇäÊ≠£Á¢∫„Å™ÊÄ™Êàë„É™„Çπ„ÇØË©ï‰æ°„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åô„ÄÇ"})]})})]})}function $l({data:t,daysWithData:s=0,isDarkMode:r=!1,teamAverageData:n=[],showTeamAverage:l=!1}){const[i,c]=a.useState("month"),[j,x]=a.useState(l),y=21,v=s>=y,N=a.useMemo(()=>{if(t.length===0)return[];const d=new Date;let o;switch(i){case"week":o=new Date(d),o.setDate(d.getDate()-7);break;case"month":o=new Date(d),o.setDate(d.getDate()-30);break;case"quarter":o=new Date(d),o.setDate(d.getDate()-90);break;case"all":default:return t}return t.filter(g=>{const m=new Date(g.date);return m>=o&&m<=d})},[t,i]),w=a.useMemo(()=>{if(n.length===0)return[];const d=new Date;let o;switch(i){case"week":o=new Date(d),o.setDate(d.getDate()-7);break;case"month":o=new Date(d),o.setDate(d.getDate()-30);break;case"quarter":o=new Date(d),o.setDate(d.getDate()-90);break;case"all":default:return n}return n.filter(g=>{const m=new Date(g.date);return m>=o&&m<=d})},[n,i]);if(t.length===0)return e.jsxs("div",{className:"space-y-4",children:[s>0&&e.jsx(gr,{daysWithData:s,isDarkMode:r}),e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-base sm:text-lg mb-2",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-sm",children:"Á∑¥ÁøíË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶ACWR„Ç∞„É©„Éï„ÇíË°®Á§∫„Åó„Åæ„Åó„Çá„ÅÜ"})]})})]});if(!v)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(gr,{daysWithData:s,isDarkMode:r}),e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ACWRÂàÜÊûêÊ∫ñÂÇô‰∏≠"}),e.jsxs("p",{className:"text-sm",children:["„ÅÇ„Å®",y-s,"Êó•ÂàÜ„ÅÆ„Éá„Éº„Çø„ÅßACWRÂàÜÊûê„ÅåÂßã„Åæ„Çä„Åæ„Åô"]})]})})]});const p=d=>{const o=new Date(d);return`${o.getMonth()+1}/${o.getDate()}`},h=d=>{const o=new Date(d),g=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"];return`${o.getMonth()+1}/${o.getDate()}(${g[o.getDay()]})`},u=({active:d,payload:o,label:g})=>{if(!d||!o||o.length===0)return null;const m=o.find(k=>(k==null?void 0:k.name)==="ÂÄã‰∫∫ ACWR")||o.find(k=>(k==null?void 0:k.dataKey)==="acwr"),b=o.find(k=>(k==null?void 0:k.name)==="„ÉÅ„Éº„É†Âπ≥Âùá"),_=m==null?void 0:m.payload,S=typeof(m==null?void 0:m.value)=="number"&&Number.isFinite(m.value)?m.value:typeof(_==null?void 0:_.acwr)=="number"?_.acwr:null,C=new Date(g),R=C.getDay()===0||C.getDay()===6,A=j?w.find(k=>k.date===g):null,T=A&&typeof A.acwr=="number"&&Number.isFinite(A.acwr)?A.acwr:typeof(b==null?void 0:b.value)=="number"&&Number.isFinite(b.value)?b.value:null;if(!_)return null;const M=typeof S=="number"&&typeof T=="number"?S-T:null;return e.jsxs("div",{className:"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base",children:h(g)}),R&&e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium",children:"ÈÄ±Êú´"})]}),e.jsxs("div",{className:"space-y-1 text-xs sm:text-sm",children:[e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"ÂÄã‰∫∫ ACWR:"}),e.jsx("span",{className:"font-semibold",style:{color:zt(_.riskLevel)},children:typeof S=="number"?S.toFixed(2):"-"})]}),j&&T!=null&&e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"„ÉÅ„Éº„É†Âπ≥Âùá:"}),e.jsx("span",{className:"font-semibold text-purple-600",children:T.toFixed(2)})]}),j&&M!=null&&e.jsxs("p",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"Â∑Æ:"}),e.jsxs("span",{className:`font-semibold ${M>.3?"text-red-600":"text-gray-600"}`,children:[M>0?"+":"",M.toFixed(2)]})]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"ÊÄ•ÊÄßË≤†Ëç∑:"}),e.jsx("span",{className:"font-semibold",children:_.acuteLoad??"-"})]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"ÊÖ¢ÊÄßË≤†Ëç∑:"}),e.jsx("span",{className:"font-semibold",children:_.chronicLoad??"-"})]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"„É™„Çπ„ÇØ:"}),e.jsx("span",{className:"font-semibold",style:{color:zt(_.riskLevel)},children:Fl(_.riskLevel)})]})]})]})},f=d=>{const{cx:o,cy:g,payload:m}=d;if(o&&g&&m){const b=new Date(m.date),_=b.getDay()===0||b.getDay()===6;return e.jsx("circle",{cx:o,cy:g,r:_?5:4,fill:zt(m.riskLevel),strokeWidth:2,stroke:_?"#3B82F6":"white",opacity:_?.9:1})}return null};return e.jsxs("div",{className:"w-full space-y-4",children:[s<28&&e.jsx(gr,{daysWithData:s,isDarkMode:r}),e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ë°®Á§∫ÊúüÈñì"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rr,{className:"w-4 h-4 text-gray-500"}),e.jsx("div",{className:"flex space-x-1",children:[{value:"week",label:"1ÈÄ±Èñì"},{value:"month",label:"1„É∂Êúà"},{value:"quarter",label:"3„É∂Êúà"},{value:"all",label:"ÂÖ®ÊúüÈñì"}].map(d=>e.jsx("button",{onClick:()=>c(d.value),className:`px-3 py-1 rounded-lg text-xs font-medium transition-colors ${i===d.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:d.label},d.value))})]}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ë°®Á§∫‰∏≠:"})," ",N.length,"Êó•ÂàÜ„ÅÆ„Éá„Éº„Çø",i!=="all"&&e.jsxs("span",{className:"ml-2",children:["(",i==="week"?"ÈÅéÂéª7Êó•Èñì":i==="month"?"ÈÅéÂéª30Êó•Èñì":"ÈÅéÂéª90Êó•Èñì",")"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full border-2 border-blue-600"}),e.jsx("span",{className:"text-xs",children:"ÈÄ±Êú´„ÅØÈùí„ÅÑÊû†„ÅßÂº∑Ë™ø"})]})]})}),n.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>x(!j),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${j?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:j?"„ÉÅ„Éº„É†Âπ≥Âùá„ÇíÈùûË°®Á§∫":"„ÉÅ„Éº„É†Âπ≥Âùá„Å®ÊØîËºÉ"}),j&&e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Á¥´Ëâ≤„ÅÆÁÇπÁ∑ö„Åå„ÉÅ„Éº„É†Âπ≥Âùá„Åß„Åô"})]})]}),e.jsx("div",{className:"h-64 sm:h-96",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(St,{data:N,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Ge,{dataKey:"date",tickFormatter:p,stroke:"#6b7280",fontSize:10,interval:"preserveStartEnd"}),e.jsx(De,{domain:[0,"dataMax + 0.5"],stroke:"#6b7280",fontSize:10,width:40}),e.jsx(Ze,{content:e.jsx(u,{})}),e.jsx(Ie,{y:1.5,stroke:"#EF4444",strokeDasharray:"5 5"}),e.jsx(Ie,{y:1.3,stroke:"#F59E0B",strokeDasharray:"5 5"}),e.jsx(Ie,{y:.8,stroke:"#10B981",strokeDasharray:"5 5"}),e.jsx(fe,{type:"monotone",dataKey:"acwr",stroke:"#6366f1",strokeWidth:2,dot:e.jsx(f,{}),activeDot:{r:6,stroke:"#6366f1",strokeWidth:2,fill:"white"},name:"ÂÄã‰∫∫ ACWR"}),j&&w.length>0&&e.jsx(fe,{type:"monotone",data:w,dataKey:"acwr",stroke:"#9333ea",strokeWidth:2,strokeDasharray:"5 5",dot:{r:3,fill:"#9333ea",stroke:"#9333ea"},activeDot:{r:5,stroke:"#9333ea",strokeWidth:2,fill:"white"},name:"„ÉÅ„Éº„É†Âπ≥Âùá"})]})})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsx("span",{children:"È´ò„É™„Çπ„ÇØ (>1.5)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),e.jsx("span",{children:"Ê≥®ÊÑè (1.3-1.5)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),e.jsx("span",{children:"ËâØÂ•Ω (0.8-1.3)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{children:"‰ΩéË≤†Ëç∑ (<0.8)"})]})]})})]})}function Fl(t){switch(t){case"high":return"È´ò„É™„Çπ„ÇØ";case"caution":return"Ê≥®ÊÑè";case"good":return"ËâØÂ•Ω";case"low":return"‰ΩéË≤†Ëç∑";default:return"‰∏çÊòé"}}function Ll({record:t,onClose:s,onUpdate:r,onDelete:n,allowDateEdit:l=!1,allowDelete:i=!1}){const[c,j]=a.useState({rpe:t.rpe,duration_min:t.duration_min,date:t.date}),[x,y]=a.useState(!1),[v,N]=a.useState(""),[w,p]=a.useState(!1),h=async d=>{d.preventDefault(),y(!0),N("");try{const o={rpe:c.rpe,duration_min:c.duration_min};l&&c.date!==t.date&&(o.date=c.date),await r(t.id,o),s()}catch(o){console.error("Error updating record:",o),N(o.message||"Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{y(!1)}},u=async()=>{if(n){y(!0),N("");try{await n(t.id),s()}catch(d){console.error("Error deleting record:",d),N(d.message||"ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{y(!1)}}},f=["0 - „Åæ„Å£„Åü„ÅèÊ•Ω„Åß„ÅÇ„Çã","1 - ÈùûÂ∏∏„Å´Ê•Ω„Åß„ÅÇ„Çã","2 - Ê•Ω„Åß„ÅÇ„Çã","3 - Â∞ë„Åó„Åç„Å§„ÅÑ","4 - „ÇÑ„ÇÑ„Åç„Å§„ÅÑ","5 - „Åç„Å§„ÅÑ","6 - „Åï„Çâ„Å´„Åç„Å§„ÅÑ","7 - „Å®„Å¶„ÇÇ„Åç„Å§„ÅÑ","8 - „Åã„Å™„Çä„Åç„Å§„ÅÑ","9 - ÈùûÂ∏∏„Å´„Åç„Å§„ÅÑ","10 - ÊúÄÂ§ßÈôê„Å´„Åç„Å§„ÅÑ (ÈôêÁïå)"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-blue-600 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-500 rounded-full p-2",children:e.jsx(_e,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Á∑¥ÁøíË®òÈå≤„ÇíÁ∑®ÈõÜ"}),e.jsxs("p",{className:"text-blue-100",children:[new Date(t.date).toLocaleDateString("ja-JP"),"„ÅÆË®òÈå≤"]})]})]}),e.jsx("button",{onClick:s,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"ÁèæÂú®„ÅÆÂÄ§"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"RPE"}),e.jsx("div",{className:"font-bold text-lg text-blue-600",children:t.rpe})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"ÊôÇÈñì"}),e.jsxs("div",{className:"font-bold text-lg text-green-600",children:[t.duration_min,"ÂàÜ"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Ë≤†Ëç∑"}),e.jsx("div",{className:"font-bold text-lg text-purple-600",children:t.load})]})]})]}),e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[l&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Á∑¥ÁøíÊó•"]}),e.jsx("input",{type:"date",value:c.date,onChange:d=>j(o=>({...o,date:d.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[e.jsx(Ut,{className:"w-4 h-4 mr-2"}),"RPEÔºàÈÅãÂãïÂº∑Â∫¶Ôºâ"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"range",min:"0",max:"10",value:c.rpe,onChange:d=>j(o=>({...o,rpe:Number(d.target.value)})),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{WebkitAppearance:"none",background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${c.rpe/10*100}%, #9ca3af ${c.rpe/10*100}%, #9ca3af 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:c.rpe}),e.jsx("div",{className:"text-sm text-blue-700",children:f[c.rpe]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Á∑¥ÁøíÊôÇÈñìÔºàÂàÜÔºâ"]}),e.jsx("input",{type:"number",min:"1",max:"480",value:c.duration_min,onChange:d=>j(o=>({...o,duration_min:Number(d.target.value)})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Êñ∞„Åó„ÅÑË≤†Ëç∑ÂÄ§"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:c.rpe*c.duration_min})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("span",{children:["Â§âÊõ¥Ââç: ",t.load]}),e.jsx("span",{className:`font-medium ${c.rpe*c.duration_min>t.load?"text-red-600":c.rpe*c.duration_min<t.load?"text-blue-600":"text-gray-600"}`,children:c.rpe*c.duration_min>t.load?"Â¢óÂä†":c.rpe*c.duration_min<t.load?"Ê∏õÂ∞ë":"Â§âÊõ¥„Å™„Åó"})]})]}),v&&e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:[e.jsx(pe,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:v})]}),e.jsxs("div",{className:"flex space-x-3",children:[i&&n&&e.jsxs("button",{type:"button",onClick:()=>p(!0),className:"bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsx("span",{children:"ÂâäÈô§"})]}),e.jsx("button",{type:"button",onClick:s,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg transition-colors",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsxs("button",{type:"submit",disabled:x,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[x?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(ms,{className:"w-4 h-4 mr-2"}),x?"Êõ¥Êñ∞‰∏≠...":"Êõ¥Êñ∞"]})]})]})]}),w&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 rounded-2xl",children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ht,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Ë®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:[new Date(t.date).toLocaleDateString("ja-JP"),"„ÅÆÁ∑¥ÁøíË®òÈå≤„ÅåÂÆåÂÖ®„Å´ÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ „Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:u,disabled:x,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50",children:"ÂâäÈô§„Åô„Çã"})]})]})})})]})})}const Pl=Ae.memo(function({records:s,onUpdate:r,onDelete:n,loading:l=!1,allowEdit:i=!0,allowDelete:c=!1,allowDateEdit:j=!1,showLimited:x=!1,limitCount:y=10}){const[v,N]=a.useState(null),[w,p]=a.useState(!1),[h,u]=a.useState(!1),f=a.useMemo(()=>x&&!h?s.slice(-y):s,[s,x,h,y]),d=a.useMemo(()=>[...f].sort((b,_)=>new Date(_.date).getTime()-new Date(b.date).getTime()),[f]),o=a.useCallback(b=>{N(b),p(!0)},[]),g=a.useCallback(()=>{p(!1),N(null)},[]),m=b=>b>=8?"text-red-600 dark:text-red-400":b>=6?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400";return l?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(b=>e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded-lg"})},b))}):s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Á∑¥ÁøíË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"ÊúÄÂàù„ÅÆÁ∑¥ÁøíË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Á∑¥ÁøíË®òÈå≤"}),x&&s.length>y&&e.jsxs("button",{onClick:()=>u(!h),className:"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 flex items-center space-x-1",children:[e.jsx("span",{children:h?`ÊúÄÊñ∞${y}‰ª∂„ÅÆ„ÅøË°®Á§∫`:`ÂÖ®${s.length}‰ª∂„ÇíË°®Á§∫`}),h?e.jsx(tl,{className:"w-4 h-4"}):e.jsx(qr,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"space-y-3",children:d.map(b=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(_e,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:new Date(b.date).toLocaleDateString("ja-JP")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"RPE"}),e.jsx("div",{className:`font-bold ${m(b.rpe)}`,children:b.rpe})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"ÊôÇÈñì"}),e.jsxs("div",{className:"font-bold text-blue-600 dark:text-blue-400",children:[b.duration_min,"ÂàÜ"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"Ë≤†Ëç∑"}),e.jsx("div",{className:"font-bold text-purple-600 dark:text-purple-400",children:b.load})]})]})]}),i&&e.jsx("button",{onClick:()=>o(b),className:"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors ml-2",title:"Á∑®ÈõÜ",children:e.jsx(Xs,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"hidden sm:flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-4 gap-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 mr-2"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:new Date(b.date).toLocaleDateString("ja-JP")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"RPE"}),e.jsx("div",{className:`text-xl font-bold ${m(b.rpe)}`,children:b.rpe})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ÊôÇÈñì"}),e.jsxs("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:[b.duration_min,"ÂàÜ"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Ë≤†Ëç∑"}),e.jsx("div",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:b.load})]})]}),i&&e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>o(b),className:"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors",title:"Á∑®ÈõÜ",children:e.jsx(Xs,{className:"w-4 h-4"})}),c&&e.jsx("button",{onClick:()=>o(b),className:"bg-red-50 hover:bg-red-100 text-red-600 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-300 p-2 rounded-lg transition-colors",title:"ÂâäÈô§",children:e.jsx(ht,{className:"w-4 h-4"})})]})]})]},b.id))}),x&&s.length>y&&!h&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs("button",{className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",onClick:()=>u(!0),children:["„Åï„Çâ„Å´",s.length-y,"‰ª∂„ÅÆË®òÈå≤„ÇíË°®Á§∫"]})}),w&&v&&e.jsx(Ll,{record:v,onClose:g,onUpdate:r,onDelete:c?n:void 0,allowDateEdit:j,allowDelete:c})]})});function ql({alerts:t,onViewAll:s,className:r=""}){const[n,l]=a.useState(!1);a.useEffect(()=>{const y=localStorage.getItem("alertSummaryDismissed"),v=y?parseInt(y,10):0,N=Date.now(),w=60*60*1e3;v&&N-v<w?l(!0):v&&N-v>=w&&localStorage.removeItem("alertSummaryDismissed")},[]);const i=()=>{l(!0),localStorage.setItem("alertSummaryDismissed",Date.now().toString())},c=t.filter(y=>!y.is_dismissed),j=c.filter(y=>y.priority==="high"),x=c.filter(y=>!y.is_read);return n||c.length===0?null:e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center",children:[e.jsx(ge,{className:"w-5 h-5 text-orange-500 mr-2"}),"„Ç¢„É©„Éº„ÉàÊ¶ÇË¶Å"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:s,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"ÂÖ®„Å¶Ë°®Á§∫"}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"1ÊôÇÈñìÈùûË°®Á§∫",children:e.jsx(Me,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:j.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"È´òÂÑ™ÂÖàÂ∫¶"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Êú™Ë™≠"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:c.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"ÂêàË®à"})]})]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 flex items-center",children:[e.jsx(ge,{className:"w-4 h-4 text-red-500 mr-1"}),"Á∑äÊÄ•ÂØæÂøú„ÅåÂøÖË¶Å"]}),j.slice(0,3).map(y=>{const v=ks(y);return e.jsx("div",{className:`${v.bgColor} ${v.borderColor} border rounded p-3`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-sm",children:v.icon}),e.jsx("h5",{className:`font-medium text-sm ${v.textColor}`,children:y.title}),!y.is_read&&e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"})]}),e.jsx("p",{className:`text-xs ${v.textColor} line-clamp-2`,children:y.message}),y.acwr_value&&e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"ACWR: "}),e.jsx("span",{className:`text-xs font-bold ${v.textColor}`,children:y.acwr_value})]})]}),e.jsx("div",{className:"ml-2",children:e.jsx(gt,{className:"w-3 h-3 text-gray-400"})})]})},y.id)}),j.length>3&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:s,className:"text-xs text-red-600 hover:text-red-700 font-medium",children:["‰ªñ ",j.length-3,"‰ª∂„ÅÆÈ´òÂÑ™ÂÖàÂ∫¶„Ç¢„É©„Éº„Éà"]})})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Wt,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:"„Ç¢„É©„Éº„Éà„ÅØ5ÂàÜ„Åî„Å®„Å´Ëá™ÂãïÊõ¥Êñ∞„Åï„Çå„Åæ„Åô"})]})})]})}function zl({onSubmit:t,onCheckExisting:s,onUpdate:r,loading:n,lastRecord:l}){const i=a.useMemo(()=>_t(),[]),[c,j]=a.useState(""),[x,y]=a.useState(i),[v,N]=a.useState(""),[w,p]=a.useState(!1),[h,u]=a.useState(""),[f,d]=a.useState(!1),[o,g]=a.useState(null),[m,b]=a.useState(null),[_,S]=a.useState(!1),[C,R]=a.useState("success"),[A,T]=a.useState(""),M=(P,$)=>{R(P),T($),S(!0)},k=()=>{j(""),N(""),y(i)};a.useEffect(()=>{l&&c.trim()===""&&j(String(l.weight_kg??""))},[l,c]),a.useEffect(()=>{(async()=>{u("");try{const $=await s(x);g($),$?(j(String($.weight_kg??"")),N($.notes??""),M("success","„Åì„ÅÆÊó•„ÅÆ‰ΩìÈáçË®òÈå≤„ÅØÊó¢„Å´„ÅÇ„Çä„Åæ„ÅôÔºàÁ∑®ÈõÜ„Åß„Åç„Åæ„ÅôÔºâ")):N("")}catch($){console.error("Error checking existing weight record:",$),g(null),u("Êó¢Â≠ò„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),M("error","Êó¢Â≠ò„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}})()},[x]);const F=async P=>{if(P.preventDefault(),w||n)return;u("");const $=parseFloat(c);if(isNaN($)||$<=0||$>=500){u("‰ΩìÈáç„ÅØ0„Äú500kg„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),M("error","ÂÖ•ÂäõÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰ΩìÈáç„ÅÆÁØÑÂõ≤Ôºâ");return}let q=null;try{q=await s(x)}catch(E){console.error("Error checking existing weight record:",E),u("Êó¢Â≠ò„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),M("error","Êó¢Â≠ò„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");return}if(q){g(q),b({weight_kg:$,date:x,notes:v.trim()||void 0}),d(!0);return}p(!0);try{await t({weight_kg:$,date:x,notes:v.trim()||void 0}),M("success","‰ΩìÈáçË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü ‚úÖ"),k()}catch(E){console.error("Error submitting weight record:",E);const D=E instanceof Error&&E.message||"Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ";u(D),M("error",D)}finally{p(!1)}},O=async()=>{if(!(!o||!m)&&!(w||n)){p(!0),d(!1),u("");try{await r(o.id,{weight_kg:m.weight_kg,notes:m.notes}),M("success","‰∏äÊõ∏„Åç„Åó„Å¶‰øùÂ≠ò„Åó„Åæ„Åó„Åü ‚úÖ"),k(),g(null),b(null)}catch(P){console.error("Error updating record:",P),u("Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),M("error","Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{p(!1)}}},z=()=>{d(!1),g(null),b(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Rs,{open:_,type:C,message:A,onClose:()=>S(!1)}),e.jsx(nr,{isOpen:f,onClose:z,onOverwrite:O,onCancel:z,title:"‰ΩìÈáçË®òÈå≤",date:x,existingValues:[{label:"‰ΩìÈáç",value:`${(o==null?void 0:o.weight_kg)||0} kg`}],newValues:[{label:"‰ΩìÈáç",value:`${(m==null?void 0:m.weight_kg)||0} kg`}]}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Ê∏¨ÂÆöÊó•"]}),e.jsx("input",{type:"date",value:x,onChange:P=>y(P.target.value),max:i,disabled:w||n,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60",style:{fontSize:"16px"}}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:x===i?"‰ªäÊó•„ÅÆ‰ΩìÈáçË®òÈå≤":"ÈÅéÂéª„ÅÆ‰ΩìÈáçË®òÈå≤"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"‰ΩìÈáçÔºàkgÔºâ"]}),e.jsx("input",{type:"number",step:"0.1",min:"1",max:"499",value:c,onChange:P=>j(P.target.value),disabled:w||n,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60",placeholder:"65.5",required:!0,style:{fontSize:"16px"}}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Â∞èÊï∞ÁÇπÁ¨¨1‰Ωç„Åæ„ÅßÂÖ•ÂäõÂèØËÉΩÔºà‰æã: 65.5kgÔºâ"}),l&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["ÂâçÂõû: ",Number(l.weight_kg).toFixed(1)," kgÔºà",new Date(l.date).toLocaleDateString("ja-JP"),"Ôºâ"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[e.jsx(Et,{className:"w-4 h-4 mr-2"}),"„É°„É¢Ôºà‰ªªÊÑèÔºâ"]}),e.jsx("textarea",{value:v,onChange:P=>N(P.target.value),disabled:w||n,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60",placeholder:"‰ΩìË™ø„ÇÑÈ£ü‰∫ã„ÅÆË®òÈå≤„Å™„Å©...",rows:3,maxLength:500,style:{fontSize:"16px"}}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[v.length,"/500ÊñáÂ≠ó"]})]}),h&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:h})]})}),e.jsx("button",{type:"submit",disabled:w||n||!c,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center touch-target",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Ë®òÈå≤‰∏≠..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-5 h-5 mr-2"}),"‰ΩìÈáç„ÇíË®òÈå≤"]})})]})]})}function Ol({data:t}){const s=t.sort((x,y)=>new Date(x.date).getTime()-new Date(y.date).getTime()).map(x=>({date:x.date,weight:Number(x.weight_kg),displayDate:new Date(x.date).toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}));if(s.length===0)return e.jsx("div",{className:"h-64 sm:h-80 flex items-center justify-center text-gray-500 dark:text-gray-400",children:"‰ΩìÈáç„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"});const r=s.map(x=>x.weight),n=Math.min(...r),l=Math.max(...r),i=l-n,c=Math.max(0,n-i*.1),j=l+i*.1;return e.jsxs("div",{className:"h-64 sm:h-80",children:[e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(St,{data:s,margin:{top:5,right:20,left:0,bottom:5},children:[e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#e5e7eb",className:"dark:stroke-gray-700"}),e.jsx(Ge,{dataKey:"displayDate",stroke:"#6b7280",style:{fontSize:"12px"},tick:{fill:"currentColor"},className:"dark:text-gray-400"}),e.jsx(De,{stroke:"#6b7280",style:{fontSize:"12px"},tick:{fill:"currentColor"},className:"dark:text-gray-400",domain:[c,j],tickFormatter:x=>`${x.toFixed(1)}`,label:{value:"‰ΩìÈáç (kg)",angle:-90,position:"insideLeft",fill:"#6b7280"}}),e.jsx(Ze,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"},labelStyle:{color:"#374151",fontWeight:600},formatter:x=>[`${x.toFixed(1)} kg`,"‰ΩìÈáç"],labelFormatter:x=>{const y=s.find(v=>v.displayDate===x);return y?new Date(y.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}):x}}),e.jsx(lt,{wrapperStyle:{paddingTop:"20px"},iconType:"line"}),e.jsx(fe,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"‰ΩìÈáç (kg)"})]})}),s.length>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-6 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["ÊúÄÂ∞è: ",n.toFixed(1)," kg"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["ÊúÄÂ§ß: ",l.toFixed(1)," kg"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Â§âÂåñ: ",(l-n).toFixed(1)," kg"]})]})]})]})}function Bl({records:t,onUpdate:s,onDelete:r,loading:n}){const[l,i]=a.useState(null),[c,j]=a.useState(""),[x,y]=a.useState(""),v=h=>{i(h.id),j(h.weight_kg.toString()),y(h.notes||"")},N=async h=>{const u=parseFloat(c);if(isNaN(u)||u<=0||u>=500){alert("‰ΩìÈáç„ÅØ0„Äú500kg„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");return}try{await s(h,{weight_kg:u,notes:x.trim()||void 0}),i(null),j(""),y("")}catch(f){console.error("Error updating weight record:",f),alert("Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}},w=()=>{i(null),j(""),y("")},p=async(h,u)=>{if(confirm(`${new Date(u).toLocaleDateString("ja-JP")}„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`))try{await r(h)}catch(f){console.error("Error deleting weight record:",f),alert("ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}};return n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ve,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"‰ΩìÈáçË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"‰∏ä„ÅÆ„Éï„Ç©„Éº„É†„Åã„ÇâË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"‰ΩìÈáçË®òÈå≤Â±•Ê≠¥"}),e.jsx("div",{className:"space-y-3",children:t.map(h=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:l===h.id?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"Ê∏¨ÂÆöÊó•"}),e.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),new Date(h.date).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"‰ΩìÈáçÔºàkgÔºâ"}),e.jsx("input",{type:"number",step:"0.1",min:"1",max:"499",value:c,onChange:u=>j(u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white",style:{fontSize:"16px"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"„É°„É¢"}),e.jsx("textarea",{value:x,onChange:u=>y(u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white resize-none",rows:2,maxLength:500,style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>N(h.id),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"‰øùÂ≠ò"}),e.jsx("button",{onClick:w,className:"flex-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors text-sm font-medium",children:"„Ç≠„É£„É≥„Çª„É´"})]})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),new Date(h.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:h.weight_kg}),e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-400 ml-1",children:"kg"})]}),h.notes&&e.jsxs("div",{className:"flex items-start text-sm text-gray-600 dark:text-gray-400 mt-2",children:[e.jsx(Et,{className:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"whitespace-pre-wrap",children:h.notes})]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>v(h),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors",title:"Á∑®ÈõÜ",children:e.jsx(zr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(h.id,h.date),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:"ÂâäÈô§",children:e.jsx(ht,{className:"w-4 h-4"})})]})]})},h.id))})]})}function Wl({acwrData:t,weightData:s}){const r=t.map(l=>{const i=s.find(c=>c.date===l.date);return{date:new Date(l.date).toLocaleDateString("ja-JP",{month:"numeric",day:"numeric"}),fullDate:l.date,acwr:Number(l.acwr),weight:i?Number(i.weight_kg):null}});if(r.length===0)return e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"});const n=({active:l,payload:i})=>{if(l&&i&&i.length){const c=i[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:c.fullDate}),i.map((j,x)=>e.jsxs("p",{className:"text-sm",style:{color:j.color},children:[j.name,": ",j.value!==null?Number(j.value).toFixed(2):"-"]},x))]})}return null};return e.jsx("div",{className:"w-full h-96",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(St,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),e.jsx(Ge,{dataKey:"date",stroke:"#6B7280",tick:{fill:"#6B7280"}}),e.jsx(De,{yAxisId:"left",stroke:"#3B82F6",tick:{fill:"#3B82F6"},label:{value:"ACWR",angle:-90,position:"insideLeft",fill:"#3B82F6"}}),e.jsx(De,{yAxisId:"right",orientation:"right",stroke:"#10B981",tick:{fill:"#10B981"},label:{value:"‰ΩìÈáç (kg)",angle:90,position:"insideRight",fill:"#10B981"}}),e.jsx(Ze,{content:e.jsx(n,{})}),e.jsx(lt,{wrapperStyle:{paddingTop:"20px"}}),e.jsx(fe,{yAxisId:"left",type:"monotone",dataKey:"acwr",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",r:4},name:"ACWR",connectNulls:!0}),e.jsx(fe,{yAxisId:"right",type:"monotone",dataKey:"weight",stroke:"#10B981",strokeWidth:2,dot:{fill:"#10B981",r:4},name:"‰ΩìÈáç (kg)",connectNulls:!0})]})})})}function Il({acwrData:t,weightData:s}){const n=(()=>{const i=[];if(s.length<2||t.length<2)return[{type:"info",title:"„Éá„Éº„Çø„ÇíËìÑÁ©ç‰∏≠",description:"„ÇÇ„ÅÜÂ∞ë„Åó„Éá„Éº„Çø„ÅåËìÑÁ©ç„Åï„Çå„Çã„Å®„ÄÅ‰ΩìÈáç„Å®ACWR„ÅÆÈñ¢ÈÄ£ÊÄß„ÇíÂàÜÊûê„Åß„Åç„Åæ„Åô„ÄÇ",icon:e.jsx(Wt,{className:"w-5 h-5"})}];const c=[...s].sort((w,p)=>new Date(w.date).getTime()-new Date(p.date).getTime()),j=c.slice(-7);if(j.length>=2){const w=Number(j[0].weight_kg),h=Number(j[j.length-1].weight_kg)-w,u=(h/w*100).toFixed(1);if(Math.abs(h)>=2){const d=t.slice(-7).filter(o=>o.riskLevel==="high"||o.riskLevel==="caution").length;h<0&&d>=2?i.push({type:"warning",title:"Ê≥®ÊÑè: ‰ΩìÈáçÊ∏õÂ∞ë„Å®È´òË≤†Ëç∑„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ",description:`ÊúÄËøë1ÈÄ±Èñì„Åß‰ΩìÈáç„Åå${Math.abs(h).toFixed(1)}kgÊ∏õÂ∞ë„Åó„ÄÅÂêåÊôÇ„Å´ACWR„É™„Çπ„ÇØ„ÅåÈ´ò„ÅÑÊó•„Åå${d}Êó•„ÅÇ„Çä„Åæ„Åó„Åü„ÄÇÁñ≤Âä¥ËìÑÁ©ç„Å´Ê≥®ÊÑè„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`,icon:e.jsx(ge,{className:"w-5 h-5"})}):Math.abs(h)>=2&&i.push({type:"info",title:`‰ΩìÈáç„Åå${h>0?"Â¢óÂä†":"Ê∏õÂ∞ë"}ÂÇæÂêë`,description:`ÊúÄËøë1ÈÄ±Èñì„Åß${u}%Ôºà${h>0?"+":""}${h.toFixed(1)}kgÔºâÂ§âÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`,icon:h>0?e.jsx(Ke,{className:"w-5 h-5"}):e.jsx(ar,{className:"w-5 h-5"})})}}const x=t.slice(-30),y=x.filter(w=>w.riskLevel==="good").length,v=x.filter(w=>w.riskLevel==="high").length;if(y>=20&&s.length>=10){const w=c.slice(-10),p=w.reduce((u,f)=>u+Number(f.weight_kg),0)/w.length;w.reduce((u,f)=>u+Math.pow(Number(f.weight_kg)-p,2),0)/w.length<1&&i.push({type:"success",title:"ËâØÂ•Ω„Å™„Éê„É©„É≥„Çπ",description:"‰ΩìÈáç„ÅåÂÆâÂÆö„Åó„ÄÅACWR„ÇÇËâØÂ•Ω„Å™ÁØÑÂõ≤„ÇíÁ∂≠ÊåÅ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆ„Éö„Éº„Çπ„ÇíÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",icon:e.jsx(mr,{className:"w-5 h-5"})})}v>=5&&i.push({type:"warning",title:"È´òË≤†Ëç∑„ÅÆÊó•„ÅåÂ§ö„ÇÅ",description:`ÈÅéÂéª30Êó•Èñì„Åß${v}Êó•„ÅåÈ´ò„É™„Çπ„ÇØ„Åß„Åó„Åü„ÄÇ‰ºëÈ§ä„Å®Ê†ÑÈ§äË£úÁµ¶„ÇíÊÑèË≠ò„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,icon:e.jsx(ge,{className:"w-5 h-5"})});const N=c.map(w=>Number(w.weight_kg));if(N.length>=14){const w=N.slice(0,7),p=N.slice(-7),h=w.reduce((m,b)=>m+b,0)/w.length,u=p.reduce((m,b)=>m+b,0)/p.length,f=t.slice(0,7).map(m=>Number(m.acwr)),d=t.slice(-7).map(m=>Number(m.acwr)),o=f.reduce((m,b)=>m+b,0)/f.length,g=d.reduce((m,b)=>m+b,0)/d.length;u<h-1&&g>o+.2&&i.push({type:"discovery",title:"Áô∫Ë¶ã: ‰ΩìÈáçÊ∏õÂ∞ëÊôÇ„Å´ACWR‰∏äÊòá",description:"‰ΩìÈáç„ÅåÊ∏õÂ∞ë„Åó„Å¶„ÅÑ„ÇãÊúüÈñì„ÅØ„ÄÅACWR„ÅåÈ´ò„Åè„Å™„ÇãÂÇæÂêë„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÊ†ÑÈ§äË£úÁµ¶„ÇíÊÑèË≠ò„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",icon:e.jsx(mr,{className:"w-5 h-5"})})}return i.length===0&&i.push({type:"info",title:"È†ÜË™ø„Åß„Åô",description:"ÁèæÂú®„ÅÆ„Å®„Åì„Çç„ÄÅÁâπ„Å´Ê≥®ÊÑè„Åô„Åπ„ÅçÁÇπ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„ÅÆ„Éö„Éº„Çπ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",icon:e.jsx(Wt,{className:"w-5 h-5"})}),i})(),l=i=>{switch(i){case"warning":return{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",icon:"text-yellow-600 dark:text-yellow-400",title:"text-yellow-900 dark:text-yellow-200",desc:"text-yellow-700 dark:text-yellow-300"};case"success":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",icon:"text-green-600 dark:text-green-400",title:"text-green-900 dark:text-green-200",desc:"text-green-700 dark:text-green-300"};case"discovery":return{bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200 dark:border-purple-800",icon:"text-purple-600 dark:text-purple-400",title:"text-purple-900 dark:text-purple-200",desc:"text-purple-700 dark:text-purple-300"};default:return{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",icon:"text-blue-600 dark:text-blue-400",title:"text-blue-900 dark:text-blue-200",desc:"text-blue-700 dark:text-blue-300"}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(mr,{className:"w-5 h-5 mr-2 text-yellow-500"}),"„Ç§„É≥„Çµ„Ç§„Éà"]}),n.map((i,c)=>{const j=l(i.type);return e.jsx("div",{className:`${j.bg} ${j.border} border rounded-lg p-4 transition-colors`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`${j.icon} mr-3 mt-0.5`,children:i.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-semibold ${j.title} mb-1`,children:i.title}),e.jsx("p",{className:`text-sm ${j.desc}`,children:i.description})]})]})},c)})]})}function Ul(t,s){const r=s/100;return t/(r*r)}function Hl(t){return t<18.5?{category:"underweight",label:"‰Ωé‰ΩìÈáç",healthRisk:"increased"}:t<25?{category:"normal",label:"Ê®ôÊ∫ñ‰ΩìÈáç",healthRisk:"normal"}:t<30?{category:"overweight",label:"ÈÅé‰ΩìÈáç",healthRisk:"increased"}:{category:"obese",label:"ËÇ•Ê∫Ä",healthRisk:"high"}}function hr(t){const s=t/100;return{min:18.5*s*s,max:24.9*s*s}}function Vl(t,s){if(!s)return null;const r=t/100;return s==="male"?{min:20*r*r,max:25*r*r}:{min:19*r*r,max:24*r*r}}function Kl(t,s,r){if(!r)return null;const n=t/100;let l,i;return s<20?(l=r==="male"?19:18,i=r==="male"?24:23):s<30?(l=r==="male"?20:19,i=r==="male"?25:24):s<50?(l=r==="male"?21:20,i=r==="male"?26:25):(l=r==="male"?22:21,i=r==="male"?27:26),{min:l*n*n,max:i*n*n}}function Jl(t,s,r,n){const l=Ul(t,s),{category:i,label:c,healthRisk:j}=Hl(l);let x;const y=n==="male"||n==="female"?n:null;return r&&y?x=Kl(s,r,y)||hr(s):y?x=Vl(s,y)||hr(s):x=hr(s),{bmi:l,category:i,categoryLabel:c,healthRisk:j,idealWeightRange:x}}function Yl(t){const s=new Date(t),r=new Date;let n=r.getFullYear()-s.getFullYear();const l=r.getMonth()-s.getMonth();return(l<0||l===0&&r.getDate()<s.getDate())&&n--,n}function Gl({weightKg:t,heightCm:s,dateOfBirth:r,gender:n}){const l=r?Yl(r):void 0,i=Jl(t,s,l,n),c=y=>{switch(y){case"underweight":return"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20 dark:text-yellow-400";case"normal":return"text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400";case"overweight":return"text-orange-600 bg-orange-50 dark:bg-orange-900/20 dark:text-orange-400";case"obese":return"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400";default:return"text-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-gray-400"}},j=()=>i.healthRisk==="high"?e.jsx(pe,{className:"w-5 h-5 text-red-500"}):i.healthRisk==="increased"?e.jsx(pe,{className:"w-5 h-5 text-yellow-500"}):e.jsx(Le,{className:"w-5 h-5 text-green-500"}),x=t>=i.idealWeightRange.min&&t<=i.idealWeightRange.max;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"BMIÂàÜÊûê"}),j()]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ÁèæÂú®„ÅÆBMI"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:i.bmi.toFixed(1)})]}),e.jsx("div",{className:`px-4 py-2 rounded-lg font-medium text-sm ${c(i.category)}`,children:i.categoryLabel})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:[l&&n?`${l}Ê≠≥„Éª${n==="male"?"Áî∑ÊÄß":n==="female"?"Â•≥ÊÄß":""}„ÅÆ`:"","ÈÅ©Ê≠£‰ΩìÈáçÁØÑÂõ≤"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ÊúÄÂ∞è"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[i.idealWeightRange.min.toFixed(1)," kg"]})]}),e.jsx("div",{className:"flex-1 mx-4",children:e.jsxs("div",{className:"relative h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full bg-green-500 rounded-full",style:{left:"0%",width:"100%"}}),!x&&e.jsx("div",{className:"absolute h-full w-1 bg-red-500",style:{left:`${Math.min(100,Math.max(0,(t-i.idealWeightRange.min)/(i.idealWeightRange.max-i.idealWeightRange.min)*100))}%`}})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ÊúÄÂ§ß"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[i.idealWeightRange.max.toFixed(1)," kg"]})]})]})]}),e.jsx("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:t<i.idealWeightRange.min?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3",children:["ÈÅ©Ê≠£ÁØÑÂõ≤„Åæ„Åß ",e.jsxs("strong",{children:[(i.idealWeightRange.min-t).toFixed(1)," kg"]})," „ÅÆÂ¢óÈáè„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô"]})]}):t>i.idealWeightRange.max?e.jsxs(e.Fragment,{children:[e.jsx(ar,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3",children:["ÈÅ©Ê≠£ÁØÑÂõ≤„Åæ„Åß ",e.jsxs("strong",{children:[(t-i.idealWeightRange.max).toFixed(1)," kg"]})," „ÅÆÊ∏õÈáè„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 flex-1 ml-3",children:"ÈÅ©Ê≠£‰ΩìÈáçÁØÑÂõ≤ÂÜÖ„Åß„Åô"})]})}),l&&n&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"‚Äª Âπ¥ÈΩ¢„ÉªÊÄßÂà•„ÇíËÄÉÊÖÆ„Åó„ÅüÈÅ©Ê≠£‰ΩìÈáçÁØÑÂõ≤„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô"})]})]})}function ma(t){if(!t)return"";let r=t.replace(/[Ôºê-Ôºô]/g,n=>String.fromCharCode(n.charCodeAt(0)-65248)).replace(/\D/g,"");return r.startsWith("81")&&(r="0"+r.slice(2)),r}function Zl(t){return t?/^0[7-9]0\d{8}$/.test(t):!0}function Ql({user:t,onUpdate:s,onClose:r}){var S;const[n,l]=a.useState(t.name??""),[i,c]=a.useState(t.gender||""),[j,x]=a.useState(((S=t.height_cm)==null?void 0:S.toString())||""),[y,v]=a.useState(t.date_of_birth||""),[N,w]=a.useState(t.phone_number||""),[p,h]=a.useState(!1),[u,f]=a.useState(""),[d,o]=a.useState(!1),m=(()=>{if(!y)return null;const C=new Date(y),R=new Date;let A=R.getFullYear()-C.getFullYear();const T=R.getMonth()-C.getMonth();return(T<0||T===0&&R.getDate()<C.getDate())&&A--,A})(),b=async C=>{C.preventDefault(),f(""),o(!1),h(!0);try{const R=n.trim();if(!R)throw new Error("ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");const A=j?Number(j):null;if(A!==null&&(Number.isNaN(A)||A<100||A>250))throw new Error("Ë∫´Èï∑„ÅØ100„Äú250cm„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");if(y){const F=new Date(y),z=new Date().getFullYear()-F.getFullYear();if(Number.isNaN(F.getTime())||z<10||z>150)throw new Error("ÁîüÂπ¥ÊúàÊó•„ÇíÊ≠£„Åó„ÅèÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà10Ê≠≥‰ª•‰∏äÔºâ„ÄÇ")}const T=ma(N);if(!Zl(T))throw new Error("ÈõªË©±Áï™Âè∑„ÅØ070 / 080 / 090„Åã„ÇâÂßã„Åæ„ÇãÊê∫Â∏ØÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà„Éè„Ç§„Éï„É≥OKÔºâ„ÄÇ");const M={name:R,gender:i||null,height_cm:A,date_of_birth:y||null,phone_number:T||null},{error:k}=await L.from("users").update(M).eq("id",t.id);if(k)throw k;o(!0),setTimeout(()=>{s(),r()},1200)}catch(R){console.error("Error updating profile:",R),f(R instanceof Error?R.message:"„Éó„É≠„Éï„Ç£„Éº„É´„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{h(!1)}},_=ma(N);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(en,{className:"w-6 h-6 mr-2"}),"„Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜ"]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",type:"button",children:e.jsx("span",{className:"text-2xl",children:"√ó"})})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÂêçÂâç"}),e.jsx("input",{type:"text",value:n,onChange:C=>l(C.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[e.jsx(jl,{className:"w-4 h-4 mr-2"}),"ÈõªË©±Áï™Âè∑ÔºàÊê∫Â∏Ø„ÅÆ„Åø„Éª‰ªªÊÑèÔºâ"]}),e.jsx("input",{type:"tel",inputMode:"tel",value:N,onChange:C=>w(C.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",placeholder:"090-1234-5678Ôºà+81 „Åß„ÇÇOKÔºâ"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-1",children:[e.jsx("p",{children:"CSV„ÅßÂèñ„ÇäËæº„ÇÄ InBody „Éá„Éº„Çø„ÅÆÊú¨‰∫∫Á¥ê‰ªò„Åë„Å´‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ"}),!!N&&e.jsxs("p",{children:["‰øùÂ≠òÂΩ¢Âºè„Éó„É¨„Éì„É•„ÉºÔºà„Éè„Ç§„Éï„É≥„Å™„ÅóÔºâ: ",e.jsx("span",{className:"font-mono",children:_})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"ÊÄßÂà•Ôºà‰ªªÊÑèÔºâ"]}),e.jsxs("select",{value:i,onChange:C=>c(C.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"ÈÅ∏Êäû„Åó„Å™„ÅÑ"}),e.jsx("option",{value:"male",children:"Áî∑ÊÄß"}),e.jsx("option",{value:"female",children:"Â•≥ÊÄß"}),e.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"}),e.jsx("option",{value:"prefer_not_to_say",children:"ÂõûÁ≠î„Åó„Å™„ÅÑ"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Â•≥ÊÄß„ÇíÈÅ∏Êäû„Åô„Çã„Å®„ÄÅÂü∫Á§é‰ΩìÊ∏©„ÇÑÊúàÁµåÂë®Êúü„ÅÆË®òÈå≤Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åô"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[e.jsx(vl,{className:"w-4 h-4 mr-2"}),"Ë∫´Èï∑ÔºàcmÔºâÔºà‰ªªÊÑèÔºâ"]}),e.jsx("input",{type:"number",step:"0.1",min:"100",max:"250",value:j,onChange:C=>x(C.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",placeholder:"175.5"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ë∫´Èï∑„ÇíÂÖ•Âäõ„Åô„Çã„Å®BMI„ÅåËá™ÂãïË®àÁÆó„Åï„Çå„Åæ„ÅôÔºà100„Äú250cmÔºâ"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"ÁîüÂπ¥ÊúàÊó•Ôºà‰ªªÊÑèÔºâ"]}),e.jsx("input",{type:"date",value:y,onChange:C=>v(C.target.value),max:Ln(10),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white"}),m!==null&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ÁèæÂú®„ÅÆÂπ¥ÈΩ¢: ",m,"Ê≠≥"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Âπ¥ÈΩ¢Âà•„ÅÆÈÅ©Ê≠£‰ΩìÈáçÁØÑÂõ≤„ÇÑ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂü∫Ê∫ñÂÄ§„ÅÆË°®Á§∫„Å´‰ΩøÁî®„Åï„Çå„Åæ„Åô"})]}),u&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:u})]})}),d&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ms,{className:"w-5 h-5 text-green-600 dark:text-green-400 mr-2"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü"})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:p||d,className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"‰øùÂ≠ò‰∏≠..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"w-5 h-5 mr-2"}),"‰øùÂ≠ò"]})}),e.jsx("button",{type:"button",onClick:r,disabled:p,className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"„Ç≠„É£„É≥„Çª„É´"})]})]})]})})})}function Xl({targetElement:t,padding:s=8,zIndex:r=1e4,onClick:n}){const[l,i]=a.useState(null),c=a.useRef(null),j=a.useId();a.useEffect(()=>{if(!t){i(null);return}const y=()=>{const v=t.getBoundingClientRect();i(v)};return y(),window.addEventListener("resize",y),window.addEventListener("scroll",y,!0),()=>{window.removeEventListener("resize",y),window.removeEventListener("scroll",y,!0)}},[t]);const x=y=>{y.target===c.current&&(n==null||n())};return e.jsx("div",{ref:c,className:"fixed inset-0 transition-all duration-300",style:{zIndex:r},onClick:x,"aria-hidden":"true",children:e.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:r+1},children:[e.jsx("defs",{children:e.jsxs("mask",{id:`tutorial-mask-${j}`,children:[e.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),l&&e.jsx("rect",{x:l.left-s,y:l.top-s,width:l.width+s*2,height:l.height+s*2,rx:"8",fill:"black"})]})}),e.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"rgba(0, 0, 0, 0.7)",mask:`url(#tutorial-mask-${j})`}),l&&e.jsx("rect",{x:l.left-s,y:l.top-s,width:l.width+s*2,height:l.height+s*2,rx:"8",fill:"none",stroke:"#3B82F6",strokeWidth:"3",className:"animate-pulse"})]})})}function ei({targetElement:t,position:s="bottom",title:r,description:n,currentStep:l,totalSteps:i,onNext:c,onPrev:j,onSkip:x,onClose:y,showPrev:v=!0,nextLabel:N="Ê¨°„Å∏",zIndex:w=9999}){const p=a.useRef(null),[h,u]=a.useState({});return a.useEffect(()=>{if(t&&p.current){const f=()=>{const d=t.getBoundingClientRect(),o=p.current.getBoundingClientRect(),g=16;let m=0,b=0;if(s==="center")m=window.innerHeight/2-o.height/2,b=window.innerWidth/2-o.width/2;else{switch(s){case"top":m=d.top-o.height-g,b=d.left+(d.width-o.width)/2;break;case"bottom":m=d.bottom+g,b=d.left+(d.width-o.width)/2;break;case"left":m=d.top+(d.height-o.height)/2,b=d.left-o.width-g;break;case"right":m=d.top+(d.height-o.height)/2,b=d.right+g;break}b=Math.max(g,Math.min(b,window.innerWidth-o.width-g)),m=Math.max(g,Math.min(m,window.innerHeight-o.height-g))}u({position:"fixed",top:`${m}px`,left:`${b}px`,zIndex:w})};return f(),window.addEventListener("resize",f),window.addEventListener("scroll",f,!0),()=>{window.removeEventListener("resize",f),window.removeEventListener("scroll",f,!0)}}else!t&&s==="center"&&u({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:w})},[t,s,w]),e.jsxs("div",{ref:p,style:h,className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl border-2 border-blue-500 dark:border-blue-400 w-[90vw] max-w-3xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-300",role:"dialog","aria-labelledby":"tutorial-title","aria-describedby":"tutorial-description",children:[e.jsxs("div",{className:"p-5 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1.5",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",children:[l," / ",i]})}),e.jsx("h3",{id:"tutorial-title",className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900 dark:text-white pr-1",children:r})]}),y&&e.jsx("button",{onClick:y,className:"ml-1 flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„ÇíÈñâ„Åò„Çã",children:e.jsx(Me,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),e.jsx("p",{id:"tutorial-description",className:"text-sm sm:text-base md:text-lg text-gray-600 dark:text-gray-300 mb-5 sm:mb-6 leading-relaxed",children:n}),e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap sm:flex-nowrap",children:[e.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[v&&j&&l>1&&e.jsx("button",{onClick:j,className:"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Êàª„Çã"}),x&&e.jsx("button",{onClick:x,className:"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors",children:"„Çπ„Ç≠„ÉÉ„Éó"})]}),c&&e.jsx("button",{onClick:c,className:"px-5 py-2 sm:px-7 sm:py-2.5 text-sm sm:text-base font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors shadow-sm",children:l===i?"ÂÆå‰∫Ü":N})]})]}),e.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700",children:e.jsx("div",{className:"h-full bg-blue-600 dark:bg-blue-500 transition-all duration-300",style:{width:`${l/i*100}%`}})})]})}function ti({currentStep:t,totalSteps:s,stepTitles:r,className:n=""}){return e.jsx("div",{className:`flex items-center justify-center gap-2 ${n}`,children:Array.from({length:s},(l,i)=>i+1).map(l=>{const i=l<t,c=l===t,j=r==null?void 0:r[l-1];return e.jsxs("div",{className:"flex items-center gap-2",title:j,children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[i?e.jsx(Ne,{className:"w-6 h-6 text-green-500 dark:text-green-400"}):e.jsx(al,{className:`w-6 h-6 ${c?"text-blue-600 dark:text-blue-400 fill-blue-100 dark:fill-blue-900":"text-gray-300 dark:text-gray-600"}`}),c&&e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-blue-600 dark:border-blue-400 animate-ping"})]}),l<s&&e.jsx("div",{className:`w-8 h-0.5 ${i?"bg-green-500 dark:bg-green-400":"bg-gray-300 dark:bg-gray-600"}`})]},l)})})}function Ir({steps:t,isActive:s,onComplete:r,onSkip:n,currentStepIndex:l,onStepChange:i,showProgress:c=!0}){const[j,x]=a.useState(0),[y,v]=a.useState(null),[N,w]=a.useState(!1),p=l??j,h=i??x,u=t[p];a.useEffect(()=>{if(!s||!u){v(null);return}let g=!1;const m=()=>{if(!g)if(u.targetSelector){const S=document.querySelector(u.targetSelector);if(S){v(S);try{S.scrollIntoView({behavior:"smooth",block:"center"})}catch{}}else v(null)}else v(null)};(async()=>{try{u.beforeStep&&await u.beforeStep()}catch(S){console.warn("[Tutorial] beforeStep error",S)}})().then(m);const _=new MutationObserver(m);return _.observe(document.body,{childList:!0,subtree:!0}),()=>{g=!0,_.disconnect()}},[s,u,p]);const f=a.useCallback(async()=>{if(!N&&u)try{w(!0);try{u.afterStep&&await u.afterStep()}catch(g){console.warn("[Tutorial] afterStep error",g)}try{u.action&&await u.action()}catch(g){console.warn("[Tutorial] action error",g)}p<t.length-1?h(p+1):r()}finally{w(!1)}},[p,t.length,u,r,h,N]),d=a.useCallback(()=>{p>0&&!N&&h(p-1)},[p,h,N]),o=a.useCallback(()=>{N||n()},[n,N]);return a.useEffect(()=>{const g=m=>{s&&(m.key==="Escape"?o():m.key==="Enter"?f():m.key==="ArrowLeft"&&p>0?d():m.key==="ArrowRight"&&p<t.length-1&&f())};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[s,p,t.length,f,d,o]),!s||!u?null:e.jsxs(e.Fragment,{children:[e.jsx(Xl,{targetElement:y,onClick:o}),e.jsx("div",{className:"fixed inset-0 z-[10001] pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",onClick:g=>{g.stopPropagation()},children:e.jsx(ei,{targetElement:y,position:u.position||"bottom",title:u.title,description:u.description,currentStep:p+1,totalSteps:t.length,onNext:f,onPrev:p>0?d:void 0,onSkip:o,showPrev:p>0})})}),c&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-[10002] pointer-events-none",children:e.jsx(ti,{currentStep:p+1,totalSteps:t.length,stepTitles:t.map(g=>g.title)})})]})}async function si({userId:t,eventType:s,payload:r={}}){if(!t){console.warn("[logEvent] skipped: missing userId",{eventType:s,payload:r});return}try{const{error:n}=await L.from("events").insert({user_id:t,event_type:s,payload:r});if(n)throw n}catch(n){console.warn("[logEvent] failed:",n)}}function br(t){if(t==null||t==="")return null;const s=typeof t=="number"?t:Number(t);return Number.isFinite(s)?s:null}function Ss(t){if(!t)return null;const s=String(t).match(/^(\d{4}-\d{2}-\d{2})/);return s?s[1]:null}function ua(t){const s=Ss(t);if(!s)throw new Error("Invalid date");return s}function ga(t){return t?typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)?t:Ss(String(t))??null:null}function an(t,s){const r=String((t==null?void 0:t.date)??""),n=String((s==null?void 0:s.date)??"");return r.localeCompare(n)}function ha(t,s){const r=[...t||[]],n=r.findIndex(l=>l.id===s.id);return n>=0?r[n]=s:r.push(s),r.sort(an),r}function ri(t,s){const r=(t||[]).filter(n=>n.id!==s);return r.sort(an),r}function Ur(t){const[s,r]=a.useState([]),[n,l]=a.useState([]),[i,c]=a.useState([]),[j,x]=a.useState(!0),y=!1,v=a.useRef(!1),N=a.useRef(null),w=a.useCallback(async(o,g)=>{await si({userId:t,eventType:o,payload:g})},[t]),p=a.useCallback(async()=>{if(!t)return;const o=`user:${t}`;if(!v.current&&!(N.current===o&&s.length>0)){v.current=!0,N.current=o,x(!0);try{const[g,m]=await Promise.all([L.from("training_records").select("*").eq("user_id",t).order("date",{ascending:!0}),L.from("weight_records").select("*").eq("user_id",t).order("date",{ascending:!0})]);if(g.error)throw g.error;if(m.error)throw m.error;r(g.data||[]),l(m.data||[])}catch(g){console.error("[useTrainingData] Error fetching data:",g),r([]),l([]),c([]),N.current=null}finally{v.current=!1,x(!1)}}},[t,y,s.length]);a.useEffect(()=>{t&&p()},[t,p]),a.useEffect(()=>{const o=(s||[]).map(g=>{const m=ga(g==null?void 0:g.date);if(!m)return null;const b=br(g==null?void 0:g.load),_=br(g==null?void 0:g.rpe),S=br(g==null?void 0:g.duration_min),C=b??(_!=null&&S!=null?_*S:null);return{date:m,load:C}}).filter(Boolean);c(Oa(o))},[s]);const h=a.useCallback(async o=>{const g=Ss(o);if(!g)return null;{const{data:m,error:b}=await L.from("training_records").select("*").eq("user_id",t).eq("date",g).maybeSingle();if(b)throw b;return m}},[t]),u=a.useCallback(async o=>{const g=Ss(o.date);if(!g)throw new Error("Invalid date");const m=ua(o.date),{data:b,error:_}=await L.from("training_records").insert([{user_id:t,date:m,rpe:o.rpe,duration_min:o.duration_min,arrow_score:o.arrow_score,signal_score:o.signal_score}]).select().single();if(_)throw _;return r(S=>ha(S,b)),await w("training_completed",{date:g,rpe:o.rpe,duration_min:o.duration_min,arrow_score:o.arrow_score,signal_score:o.signal_score,overwrite:!1}),b},[t,w]),f=a.useCallback(async(o,g)=>{const m=g.date?Ss(g.date):null,b=g.date?ua(g.date):null,_={...g.rpe!==void 0?{rpe:g.rpe}:{},...g.duration_min!==void 0?{duration_min:g.duration_min}:{},...g.arrow_score!==void 0?{arrow_score:g.arrow_score}:{},...g.signal_score!==void 0?{signal_score:g.signal_score}:{},...b?{date:b}:{}},{data:S,error:C}=await L.from("training_records").update(_).eq("id",o).eq("user_id",t).select().single();if(C)throw C;r(A=>ha(A,S));const R=m??ga(S==null?void 0:S.date)??void 0;return await w("training_completed",{date:R,rpe:g.rpe??(S==null?void 0:S.rpe),duration_min:g.duration_min??(S==null?void 0:S.duration_min),arrow_score:g.arrow_score??(S==null?void 0:S.arrow_score),signal_score:g.signal_score??(S==null?void 0:S.signal_score),overwrite:!0}),S},[t,w]),d=a.useCallback(async o=>{const{error:g}=await L.from("training_records").delete().eq("id",o).eq("user_id",t);if(g)throw g;r(m=>ri(m,o))},[t]);return{records:s,weightRecords:n,acwrData:i,loading:j,fetchAll:p,checkExistingRecord:h,addTrainingRecord:u,updateTrainingRecord:f,deleteTrainingRecord:d}}function Ar(t){if(!t)return null;const r=String(t).slice(0,10).replace(/\//g,"-").match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(r){const l=Number(r[1]),i=Number(r[2]),c=Number(r[3]);if(Number.isFinite(l)&&Number.isFinite(i)&&Number.isFinite(c))return new Date(l,i-1,c)}const n=new Date(String(t)).getTime();return Number.isFinite(n)?new Date(n):null}function xs(t){return t?String(t).slice(0,10).replace(/\//g,"-"):""}function Ys(t,s){var c,j;const r=xs(t.date),n=xs(s.date);if(r&&n)return n.localeCompare(r);const l=((c=Ar(t.date))==null?void 0:c.getTime())??0;return(((j=Ar(s.date))==null?void 0:j.getTime())??0)-l}function ai(t,s){return-Ys(t,s)}function ni(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null),j=a.useCallback(u=>{const f=[...u].sort(Ys);r(f)},[]),x=a.useCallback(async()=>{try{l(!0),c(null);const{data:u,error:f}=await L.from("weight_records").select("*").eq("user_id",t).order("date",{ascending:!1});if(f)throw f;j(u||[])}catch(u){console.error("Error fetching weight records:",u),c(u instanceof Error?u.message:"‰ΩìÈáçË®òÈå≤„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),j([])}finally{l(!1)}},[t,j]);a.useEffect(()=>{t&&x()},[t,x]);const y=a.useCallback(async u=>{try{const f=xs(u),{data:d,error:o}=await L.from("weight_records").select("*").eq("user_id",t).eq("date",f).maybeSingle();if(o)throw o;return d??null}catch(f){return console.error("Error checking existing record:",f),null}},[t]),v=a.useCallback(async u=>{try{const{data:f}=await L.auth.getUser();if(!f.user)throw new Error("Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô");const d={user_id:f.user.id,weight_kg:u.weight_kg,date:xs(u.date),notes:u.notes||null},{data:o,error:g}=await L.from("weight_records").insert(d).select().single();if(g)throw g;r(m=>[o,...m].sort(Ys))}catch(f){throw console.error("Error adding weight record:",f),f}},[]),N=a.useCallback(async(u,f)=>{try{const d={weight_kg:f.weight_kg,notes:f.notes||null},{data:o,error:g}=await L.from("weight_records").update(d).eq("id",u).select().single();if(g)throw g;r(m=>m.map(_=>_.id===u?o:_).sort(Ys))}catch(d){throw console.error("Error updating weight record:",d),d}},[]),w=a.useCallback(async u=>{try{const{error:f}=await L.from("weight_records").delete().eq("id",u);if(f)throw f;r(d=>d.filter(o=>o.id!==u))}catch(f){throw console.error("Error deleting weight record:",f),f}},[]),p=a.useCallback(()=>{if(!s||s.length===0)return null;const u=s.reduce((d,o)=>{if(!d)return o;const g=xs(d.date);return xs(o.date)>g?o:d},null),f=Number(u==null?void 0:u.weight_kg);return Number.isFinite(f)?f:null},[s]),h=a.useCallback((u=30)=>{if(!s||s.length<2)return null;const f=new Date,d=new Date(f.getFullYear(),f.getMonth(),f.getDate());d.setDate(d.getDate()-u);const g=[...s].sort(ai).filter(_=>{const S=Ar(_.date);return S?S.getTime()>=d.getTime():!1});if(g.length<2)return null;const m=Number(g[0].weight_kg),b=Number(g[g.length-1].weight_kg);return!Number.isFinite(m)||!Number.isFinite(b)?null:b-m},[s]);return{records:s,loading:n,error:i,checkExistingRecord:y,addWeightRecord:v,updateWeightRecord:N,deleteWeightRecord:w,getLatestWeight:p,getWeightChange:h,refresh:x}}function li(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null),j=async()=>{try{l(!0),c(null);const{data:f,error:d}=await L.from("sleep_records").select("*").eq("user_id",t).order("date",{ascending:!1});if(d)throw d;r(f||[])}catch(f){console.error("Error fetching sleep records:",f),c(f instanceof Error?f.message:"Áù°Áú†Ë®òÈå≤„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{l(!1)}};a.useEffect(()=>{t&&j()},[t]);const x=async f=>{try{const{data:d,error:o}=await L.from("sleep_records").select("*").eq("user_id",t).eq("date",f).maybeSingle();if(o)throw o;return d}catch(d){return console.error("Error checking existing record:",d),null}},y=async f=>{try{const{data:d}=await L.auth.getUser();if(!d.user)throw new Error("Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô");const o={user_id:d.user.id,date:f.date,sleep_hours:f.sleep_hours,sleep_quality:f.sleep_quality||null,bedtime:f.bedtime||null,waketime:f.waketime||null,notes:f.notes||null},{data:g,error:m}=await L.from("sleep_records").insert(o).select().single();if(m)throw m;r(b=>[g,...b].sort((_,S)=>new Date(S.date).getTime()-new Date(_.date).getTime()))}catch(d){throw console.error("Error adding sleep record:",d),d}},v=async(f,d)=>{try{const o={sleep_hours:d.sleep_hours,sleep_quality:d.sleep_quality!==void 0?d.sleep_quality:null,bedtime:d.bedtime!==void 0?d.bedtime:null,waketime:d.waketime!==void 0?d.waketime:null,notes:d.notes!==void 0?d.notes:null},{data:g,error:m}=await L.from("sleep_records").update(o).eq("id",f).select().single();if(m)throw m;r(b=>b.map(_=>_.id===f?g:_))}catch(o){throw console.error("Error updating sleep record:",o),o}},N=async f=>{try{const{error:d}=await L.from("sleep_records").delete().eq("id",f);if(d)throw d;r(o=>o.filter(g=>g.id!==f))}catch(d){throw console.error("Error deleting sleep record:",d),d}},w=(f=7)=>{if(s.length===0)return null;const d=new Date;d.setDate(d.getDate()-f);const o=s.filter(m=>new Date(m.date)>=d);return o.length===0?null:o.reduce((m,b)=>m+Number(b.sleep_hours),0)/o.length};return{records:s,loading:n,error:i,checkExistingRecord:x,addSleepRecord:y,updateSleepRecord:v,deleteSleepRecord:N,getAverageSleepHours:w,getAverageSleepQuality:(f=7)=>{if(s.length===0)return null;const d=new Date;d.setDate(d.getDate()-f);const o=s.filter(m=>new Date(m.date)>=d&&m.sleep_quality!==null);return o.length===0?null:o.reduce((m,b)=>m+(b.sleep_quality||0),0)/o.length},getLatestSleep:()=>s.length===0?null:s[0],getSleepDeficit:(f=7)=>{const d=w(f);return d===null?null:8-d},refresh:j}}function ii(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null),j=async()=>{try{l(!0),c(null);const{data:d,error:o}=await L.from("motivation_records").select("*").eq("user_id",t).order("date",{ascending:!1});if(o)throw o;r(d||[])}catch(d){console.error("Error fetching motivation records:",d),c(d instanceof Error?d.message:"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Ë®òÈå≤„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{l(!1)}};return a.useEffect(()=>{t&&j()},[t]),{records:s,loading:n,error:i,checkExistingRecord:async d=>{try{const{data:o,error:g}=await L.from("motivation_records").select("*").eq("user_id",t).eq("date",d).maybeSingle();if(g)throw g;return o}catch(o){return console.error("Error checking existing record:",o),null}},addMotivationRecord:async d=>{try{if(!t)throw new Error("„É¶„Éº„Ç∂„ÉºID„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");const o={user_id:t,date:d.date,motivation_level:d.motivation_level,energy_level:d.energy_level,stress_level:d.stress_level,mood:d.mood||null,notes:d.notes||null},{data:g,error:m}=await L.from("motivation_records").upsert(o,{onConflict:"user_id,date"}).select().single();if(m)throw m;r(b=>{const _=b.filter(S=>!(S.user_id===g.user_id&&S.date===g.date));return[g,..._].sort((S,C)=>new Date(C.date).getTime()-new Date(S.date).getTime())})}catch(o){throw console.error("Error adding motivation record:",o),o}},updateMotivationRecord:async(d,o)=>{try{const g={motivation_level:o.motivation_level,energy_level:o.energy_level,stress_level:o.stress_level,mood:o.mood!==void 0?o.mood:null,notes:o.notes!==void 0?o.notes:null},{data:m,error:b}=await L.from("motivation_records").update(g).eq("id",d).select().single();if(b)throw b;r(_=>_.map(S=>S.id===d?m:S))}catch(g){throw console.error("Error updating motivation record:",g),g}},deleteMotivationRecord:async d=>{try{const{error:o}=await L.from("motivation_records").delete().eq("id",d);if(o)throw o;r(g=>g.filter(m=>m.id!==d))}catch(o){throw console.error("Error deleting motivation record:",o),o}},getAverageMotivation:(d=7)=>{if(s.length===0)return null;const o=new Date;o.setDate(o.getDate()-d);const g=s.filter(b=>new Date(b.date)>=o);return g.length===0?null:g.reduce((b,_)=>b+_.motivation_level,0)/g.length},getAverageEnergy:(d=7)=>{if(s.length===0)return null;const o=new Date;o.setDate(o.getDate()-d);const g=s.filter(b=>new Date(b.date)>=o);return g.length===0?null:g.reduce((b,_)=>b+_.energy_level,0)/g.length},getAverageStress:(d=7)=>{if(s.length===0)return null;const o=new Date;o.setDate(o.getDate()-d);const g=s.filter(b=>new Date(b.date)>=o);return g.length===0?null:g.reduce((b,_)=>b+_.stress_level,0)/g.length},getLatestMotivation:()=>s.length===0?null:s[0],getMotivationTrend:(d=7)=>{if(s.length<2)return null;const o=new Date;o.setDate(o.getDate()-d);const g=s.filter(A=>new Date(A.date)>=o).sort((A,T)=>new Date(A.date).getTime()-new Date(T.date).getTime());if(g.length<2)return null;const m=Math.floor(g.length/2),b=g.slice(0,m),_=g.slice(m),S=b.reduce((A,T)=>A+T.motivation_level,0)/b.length,R=_.reduce((A,T)=>A+T.motivation_level,0)/_.length-S;return R>.5?"improving":R<-.5?"declining":"stable"},refresh:j}}function $s(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null);a.useEffect(()=>{j()},[t]);const j=async()=>{try{l(!0);const{data:p,error:h}=await L.from("menstrual_cycles").select("*").eq("user_id",t).order("cycle_start_date",{ascending:!1});if(h)throw h;r(p||[])}catch(p){c(p instanceof Error?p.message:"Failed to fetch menstrual cycles")}finally{l(!1)}},x=async p=>{try{const{data:h}=await L.auth.getUser();if(!h.user)throw new Error("User not authenticated");const{data:u}=await L.from("users").select("team_id").eq("user_id",h.user.id).maybeSingle();let f=null;if(u!=null&&u.team_id){const{data:g}=await L.from("teams").select("organization_id").eq("id",u.team_id).maybeSingle();f=(g==null?void 0:g.organization_id)||null}const{data:d,error:o}=await L.from("menstrual_cycles").insert({...p,user_id:t,organization_id:f}).select().single();if(o)throw o;return d&&r(g=>[d,...g]),d}catch(h){throw c(h instanceof Error?h.message:"Failed to add menstrual cycle"),h}},y=async(p,h)=>{try{const{data:u,error:f}=await L.from("menstrual_cycles").update(h).eq("id",p).select().single();if(f)throw f;return u&&r(d=>d.map(o=>o.id===p?u:o)),u}catch(u){throw c(u instanceof Error?u.message:"Failed to update menstrual cycle"),u}},v=async p=>{try{const{error:h}=await L.from("menstrual_cycles").delete().eq("id",p);if(h)throw h;r(u=>u.filter(f=>f.id!==p))}catch(h){throw c(h instanceof Error?h.message:"Failed to delete menstrual cycle"),h}},N=(p,h)=>{const u=new Date(p.cycle_start_date),f=Math.floor((h.getTime()-u.getTime())/(1e3*60*60*24));if(f<0)return null;if(p.period_duration_days&&f<p.period_duration_days)return"menstrual";if(p.cycle_length_days){const d=Math.floor(p.cycle_length_days/2);if(f<d)return"follicular";const o=d+2;if(f<o)return"ovulatory";if(f<p.cycle_length_days)return"luteal"}return null};return{cycles:s,loading:n,error:i,addCycle:x,updateCycle:y,deleteCycle:v,getCyclePhase:N,getCurrentCyclePhase:()=>{const p=new Date;for(const h of s){const u=N(h,p);if(u)return{cycle:h,phase:u}}return null},refetch:j}}const oi=[{id:"athlete-welcome",title:"Bekuta „Å∏„Çà„ÅÜ„Åì„Åù",description:"Á∑èÂêà„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„Éã„É≥„Ç∞„Ç¢„Éó„É™Bekuta„Å∏„Çà„ÅÜ„Åì„Åù„ÄÇ„Éà„É¨„Éº„Éã„É≥„Ç∞„ÄÅ‰ΩìÈáç„ÄÅÁù°Áú†„ÄÅ„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Çí‰∏ÄÂÖÉÁÆ°ÁêÜ„Åó„ÄÅ„Éá„Éº„Çø„Åß„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÇíÂèØË¶ñÂåñ„Åó„Åæ„Åô„ÄÇ",position:"center"},{id:"athlete-unified-checkin",title:"Áµ±Âêà„Éá„Ç§„É™„Éº„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥",description:"1„Å§„ÅÆÁîªÈù¢„Åß„Äå„Éà„É¨„Éº„Éã„É≥„Ç∞„Äç„Äå‰ΩìÈáç„Äç„ÄåÁù°Áú†„Äç„Äå„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„Äç„ÇíË®òÈå≤„ÄÇÊØéÊó•„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Çí„Ç∑„É≥„Éó„É´„Å´„ÄÅÁ∂ö„Åë„ÇÑ„Åô„ÅèË®≠Ë®à„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="daily-checkin"]',position:"bottom"},{id:"athlete-performance",title:"„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË®òÈå≤",description:"„Éô„É≥„ÉÅ„Éó„É¨„Çπ„ÄÅ„Çπ„ÇØ„ÉØ„ÉÉ„Éà„Å™„Å©„ÅÆÁ≠ãÂäõ„ÄÅÊåÅ‰πÖÂäõ„ÄÅ„Çπ„Éó„É™„É≥„Éà„Å™„Å©„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ∏¨ÂÆö„ÇíË®òÈå≤„ÄÇÊàêÈï∑„ÇíÂèØË¶ñÂåñ„Åó„ÄÅ„Éô„Çπ„ÉàÊõ¥Êñ∞„ÇíÁ•ù„ÅÑ„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="performance-tab"]',position:"bottom"},{id:"athlete-acwr-chart",title:"„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑„ÅÆÂèØË¶ñÂåñ",description:"ÊÄ•ÊÄß„ÉªÊÖ¢ÊÄß„ÉØ„Éº„ÇØ„É≠„Éº„ÉâÊØîÔºàACWRÔºâ„ÅßÊÄ™Êàë„É™„Çπ„ÇØ„ÇíÁßëÂ≠¶ÁöÑ„Å´ÁÆ°ÁêÜ„ÄÇ0.8„Äú1.3„ÅåÁêÜÊÉ≥ÁöÑ„Åß„ÄÅÊÄ•ÊøÄ„Å™Ë≤†Ëç∑Â¢óÂä†„ÇíÈò≤„Åé„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="acwr-chart"]',position:"top"},{id:"athlete-multi-metric",title:"Á∑èÂêà„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„Çø„Ç§„É†„É©„Ç§„É≥",description:"„Éà„É¨„Éº„Éã„É≥„Ç∞„ÄÅ‰ΩìÈáç„ÄÅÁù°Áú†„ÄÅ„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„ÇíÂêåÊôÇË°®Á§∫„ÄÇÁõ∏Èñ¢Èñ¢‰øÇ„ÇíË¶ã„Å§„Åë„ÄÅ„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÅÆÂÖ®‰ΩìÂÉè„ÇíÊääÊè°„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",targetSelector:'[data-tutorial="multi-metric-timeline"]',position:"top"},{id:"athlete-alerts",title:"„Ç§„É≥„ÉÜ„É™„Ç∏„Çß„É≥„Éà„Ç¢„É©„Éº„Éà",description:"Ë§áÊï∞„ÅÆÊåáÊ®ô„ÇíÁµ±ÂêàÂàÜÊûê„Åó„ÄÅÊÄ™Êàë„É™„Çπ„ÇØ„ÄÅ„Ç™„Éº„Éê„Éº„Éà„É¨„Éº„Éã„É≥„Ç∞„ÄÅÂõûÂæ©‰∏çË∂≥„ÇíÊó©Êúü„Å´Áô∫Ë¶ã„ÄÇ„Ç¢„ÇØ„Ç∑„Éß„É≥ÊèêÊ°à„ÅßÂØæÂøú„ÇÇ„Çµ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="alert-badge"]',position:"bottom"},{id:"athlete-gamification",title:"„Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥",description:"Ê•Ω„Åó„Åè„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„ÇíÁ∂≠ÊåÅÔºÅË®òÈå≤„ÇíÁ∂ö„Åë„Å¶„Çπ„Éà„É™„Éº„ÇØ„Çí‰º∏„Å∞„Åó„ÄÅ„Éù„Ç§„É≥„Éà„ÇíÁç≤Âæó„Åó„Å¶„É¨„Éô„É´„Ç¢„ÉÉ„Éó„ÄÇ„Éê„ÉÉ„Ç∏„ÇíÈõÜ„ÇÅ„Å¶ÈÅîÊàêÊÑü„ÇíÂë≥„Çè„ÅÑ„Åæ„Åó„Çá„ÅÜ„ÄÇ",targetSelector:'[data-tutorial="gamification-tab"]',position:"bottom"},{id:"athlete-complete",title:"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´ÂÆå‰∫ÜÔºÅ",description:"Bekuta„ÅßÁ∑èÂêàÁöÑ„Å™„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥ÁÆ°ÁêÜ„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇÊØéÊó•„Éá„Éº„Çø„ÇíË®òÈå≤„Åó„ÄÅÁßëÂ≠¶ÁöÑ„Å™Ê†πÊã†„Å´Âü∫„Å•„ÅÑ„Åü„Éà„É¨„Éº„Éã„É≥„Ç∞„Åß„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÇíÊúÄÂ§ßÂåñ„Åó„Åæ„Åô„ÄÇ",position:"center"}],di=[{id:"staff-welcome",title:"Bekuta „Çπ„Çø„ÉÉ„Éï„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å∏„Çà„ÅÜ„Åì„Åù",description:"„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞Áä∂Ê≥Å„ÇíÁßëÂ≠¶ÁöÑ„Å´Áõ£Ë¶ñ„Åó„ÄÅÈÅ∏Êâã„ÅÆÊÄ™Êàë„É™„Çπ„ÇØ„Çí„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶ÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇ",position:"center"},{id:"staff-team-selector",title:"„ÉÅ„Éº„É†ÈÅ∏Êäû",description:"ÊãÖÂΩì„Åô„Çã„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû„Åß„Åç„Åæ„Åô„ÄÇË§áÊï∞„ÅÆ„ÉÅ„Éº„É†„ÇíÁÆ°ÁêÜ„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åì„Åì„ÅßÂàá„ÇäÊõø„Åà„Çâ„Çå„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="team-selector"]',position:"bottom"},{id:"staff-alert-summary",title:"„É™„Ç¢„É´„Çø„Ç§„É†„Ç¢„É©„Éº„Éà",description:"„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆÊ≥®ÊÑè„ÅåÂøÖË¶Å„Å™ÈÅ∏Êâã„Åå‰∏ÄÁõÆ„ÅßÂàÜ„Åã„Çä„Åæ„Åô„ÄÇAI„ÅåÂàÜÊûê„Åó„ÅüÂÑ™ÂÖàÂ∫¶„ÅÆÈ´ò„ÅÑ„Ç¢„É©„Éº„Éà„Å´Á¥†Êó©„ÅèÂØæÂøú„Åó„ÄÅÊÄ™Êàë„Çí‰∫ãÂâç„Å´Èò≤„Åé„Åæ„Åó„Çá„ÅÜ„ÄÇ",targetSelector:'[data-tutorial="alert-summary"]',position:"bottom"},{id:"staff-athletes-tab",title:"ÈÅ∏Êâã‰∏ÄË¶ß",description:"„ÉÅ„Éº„É†„ÅÆÂÖ®ÈÅ∏Êâã„Çí‰∏ÄË¶ß„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇÂêÑÈÅ∏Êâã„ÅÆÁä∂ÊÖã„ÇíÊääÊè°„Åó„ÄÅÂÄãÂà•„Å´„Çµ„Éù„Éº„Éà„Åß„Åç„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="athletes-tab"]',position:"bottom"},{id:"staff-athlete-list",title:"ÈÅ∏Êâã„ÅÆË©≥Á¥∞Á¢∫Ë™ç",description:"ÈÅ∏Êâã„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅË©≥Á¥∞„Å™„Éà„É¨„Éº„Éã„É≥„Ç∞Â±•Ê≠¥„Å®ACWR„Ç∞„É©„Éï„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="athlete-list"]',position:"right"},{id:"staff-team-average",title:"„ÉÅ„Éº„É†„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂàÜÊûê",description:"„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆÂπ≥ÂùáACWR„ÅÆÊé®Áßª„ÇíÁßëÂ≠¶ÁöÑ„Å´ÂàÜÊûê„Åß„Åç„Åæ„Åô„ÄÇ„Éà„É¨„Éº„Éã„É≥„Ç∞„Éó„É≠„Ç∞„É©„É†„ÅÆÂäπÊûú„ÇíÂÆöÈáèÁöÑ„Å´Ë©ï‰æ°„Åó„ÄÅÊúÄÈÅ©Âåñ„Å´ÂΩπÁ´ã„Å¶„Åæ„Åó„Çá„ÅÜ„ÄÇ",targetSelector:'[data-tutorial="team-average-tab"]',position:"bottom"},{id:"staff-trends",title:"ÂÇæÂêëÂàÜÊûê",description:"„ÉÅ„Éº„É†„ÅÆÈï∑ÊúüÁöÑ„Å™ÂÇæÂêë„ÇíÂàÜÊûê„Åó„ÄÅ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®àÁîª„ÅÆÊúÄÈÅ©Âåñ„Å´ÂΩπÁ´ã„Å¶„Çâ„Çå„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="trends-tab"]',position:"bottom"},{id:"staff-export",title:"„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà",description:"„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„ÇíCSVÂΩ¢Âºè„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„ÄÅË©≥Á¥∞„Å™ÂàÜÊûê„ÇÑË®òÈå≤‰øùÁÆ°„Åå„Åß„Åç„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="export-button"]',position:"bottom"},{id:"staff-complete",title:"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´ÂÆå‰∫ÜÔºÅ",description:"„Åì„Çå„ÅßBekuta„Çπ„Çø„ÉÉ„Éï„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅÆÂü∫Êú¨ÁöÑ„Å™‰Ωø„ÅÑÊñπ„ÇíÂ≠¶„Å≥„Åæ„Åó„Åü„ÄÇ„Éá„Éº„ÇøÈßÜÂãïÂûã„Ç¢„Éó„É≠„Éº„ÉÅ„ÅßÈÅ∏Êâã„ÅÆÂÆâÂÖ®„ÇíÂÆà„Çä„ÄÅÊúÄÂ§ßÈôê„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂêë‰∏ä„Çí„Çµ„Éù„Éº„Éà„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",position:"center"}],ci=[{id:"admin-welcome",title:"Bekuta ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å∏„Çà„ÅÜ„Åì„Åù",description:"ÁµÑÁπîÂÖ®‰Ωì„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„Çí‰∏ÄÂÖÉÁÆ°ÁêÜ„ÄÇ„É¶„Éº„Ç∂„ÉºÊãõÂæÖ„ÄÅ„ÉÅ„Éº„É†ÁÆ°ÁêÜ„ÄÅ„Ç∑„Çπ„ÉÜ„É†Áõ£Ë¶ñ„ÇíÂäπÁéáÁöÑ„Å´Ë°å„Åà„Åæ„Åô„ÄÇ",position:"center"},{id:"admin-alert-summary",title:"Áµ±Âêà„Ç¢„É©„Éº„ÉàÁõ£Ë¶ñ",description:"ÁµÑÁπîÂÖ®‰Ωì„ÅÆ„Ç¢„É©„Éº„Éà„Çí‰∏ÄÁîªÈù¢„ÅßÁõ£Ë¶ñ„Åß„Åç„Åæ„Åô„ÄÇÈáçÂ§ß„Å™ÊÄ™Êàë„É™„Çπ„ÇØ„ÇÑ„Ç∑„Çπ„ÉÜ„É†ÂïèÈ°å„Å´Á¥†Êó©„ÅèÂØæÂøú„Åó„ÄÅÂÆâÂÖ®„Å™Áí∞Â¢É„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",targetSelector:'[data-tutorial="admin-alert-summary"]',position:"bottom"},{id:"admin-overview-tab",title:"Ê¶ÇË¶Å„Çø„Éñ",description:"„Ç∑„Çπ„ÉÜ„É†ÂÖ®‰Ωì„ÅÆÁµ±Ë®àÊÉÖÂ†±„ÇÑÈáçË¶Å„Å™ÊåáÊ®ô„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="overview-tab"]',position:"bottom"},{id:"admin-invite-tab",title:"„É¶„Éº„Ç∂„ÉºÊãõÂæÖ„Ç∑„Çπ„ÉÜ„É†",description:"Êñ∞„Åó„ÅÑ„É¶„Éº„Ç∂„Éº„ÇíÊãõÂæÖ„Åó„ÄÅBekuta„Ç®„Ç≥„Ç∑„Çπ„ÉÜ„É†„ÇíÊã°Â§ß„Åß„Åç„Åæ„Åô„ÄÇÂÄãÂà•ÊãõÂæÖ„Å®CSV‰∏ÄÊã¨ÊãõÂæÖ„ÅÆ2„Å§„ÅÆÊñπÊ≥ï„Åß„ÄÅÂäπÁéáÁöÑ„Å™„Ç™„É≥„Éú„Éº„Éá„Ç£„É≥„Ç∞„ÅåÂèØËÉΩ„Åß„Åô„ÄÇ",targetSelector:'[data-tutorial="invite-tab"]',position:"bottom"},{id:"admin-single-invite",title:"ÂÄãÂà•„É¶„Éº„Ç∂„ÉºÊãõÂæÖ",description:"1‰∫∫„Åö„Å§ÊãõÂæÖ„Åô„ÇãÂ†¥Âêà„ÅØ„Åì„Å°„Çâ„Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇÂêçÂâç„ÄÅ„É°„Éº„É´„ÄÅÂΩπÂâ≤„ÄÅ„ÉÅ„Éº„É†„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",targetSelector:'[data-tutorial="single-invite"]',position:"right"},{id:"admin-bulk-invite",title:"‰∏ÄÊã¨„É¶„Éº„Ç∂„ÉºÊãõÂæÖ",description:"CSV„Éï„Ç°„Ç§„É´„Åã„ÇâË§áÊï∞„ÅÆ„É¶„Éº„Ç∂„Éº„Çí‰∏ÄÂ∫¶„Å´ÊãõÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Å¶‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",targetSelector:'[data-tutorial="bulk-invite"]',position:"right"},{id:"admin-manage-tab",title:"„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ",description:"Êó¢Â≠ò„ÅÆ„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíÁ∑®ÈõÜ„ÄÅÂâäÈô§„Åß„Åç„Åæ„Åô„ÄÇ„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„ÇÇ„Åì„Åì„Åã„ÇâË°å„Åà„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="manage-tab"]',position:"bottom"},{id:"admin-user-list",title:"„É¶„Éº„Ç∂„Éº‰∏ÄË¶ß",description:"ÂÖ®„É¶„Éº„Ç∂„Éº„ÅÆÊÉÖÂ†±„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇÊ§úÁ¥¢Ê©üËÉΩ„Çí‰Ωø„Å£„Å¶ÁâπÂÆö„ÅÆ„É¶„Éº„Ç∂„Éº„ÇíË¶ã„Å§„Åë„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="user-list"]',position:"top"},{id:"admin-complete",title:"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´ÂÆå‰∫ÜÔºÅ",description:"BekutaÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅÆÂü∫Êú¨Ê©üËÉΩ„Çí„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Åü„ÄÇ„Éá„Éº„ÇøÈßÜÂãïÂûã„ÅÆ„Ç¢„Éó„É≠„Éº„ÉÅ„Åß„ÄÅÁµÑÁπîÂÖ®‰Ωì„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂêë‰∏ä„Å®ÂÆâÂÖ®„Å™„Éà„É¨„Éº„Éã„É≥„Ç∞Áí∞Â¢É„ÇíÂÆüÁèæ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",position:"center"}],xi=[{id:"parent-welcome",title:"‰øùË≠∑ËÄÖ„Éì„É•„Éº„Å∏„Çà„ÅÜ„Åì„Åù",description:"„ÅäÂ≠ê„Åï„Çì„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç„Åó„ÄÅÂøÖË¶Å„Å™„Çµ„Éù„Éº„Éà„Å´Áπã„Åí„Çã„Åü„ÇÅ„ÅÆÁîªÈù¢„Åß„Åô„ÄÇ",position:"center"},{id:"parent-complete",title:"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´ÂÆå‰∫ÜÔºÅ",description:"„Åì„Åì„Åã„ÇâÊó•„ÄÖ„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ",position:"center"}],mi=[{id:"gamification-welcome",title:"„Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ",description:"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„ÇíÁ∂≠ÊåÅ„Åó„Å™„Åå„ÇâÁ∂ôÁ∂öÁöÑ„Å™Ë®òÈå≤„ÇíÊ•Ω„Åó„ÇÇ„ÅÜÔºÅ„Çπ„Éà„É™„Éº„ÇØ„ÄÅ„Éù„Ç§„É≥„Éà„ÄÅ„Éê„ÉÉ„Ç∏„ÄÅÁõÆÊ®ô„ÅßÊàêÈï∑„ÇíÂèØË¶ñÂåñ„Åó„Åæ„Åô„ÄÇ",position:"center"},{id:"gamification-streaks",title:"„Çπ„Éà„É™„Éº„ÇØ - ÈÄ£Á∂öË®òÈå≤",description:"ÊØéÊó•Ë®òÈå≤„ÇíÁ∂ö„Åë„Å¶„Çπ„Éà„É™„Éº„ÇØ„Çí‰º∏„Å∞„Åù„ÅÜÔºÅÁ∑¥Áøí„ÄÅ‰ΩìÈáç„ÄÅÁù°Áú†„ÄÅ„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„ÅÆ4Á®ÆÈ°û„ÄÇÈÄ£Á∂öË®òÈå≤„ÅåÈÄîÂàá„Çå„Åù„ÅÜ„Å™ÊôÇ„ÅØË≠¶Âëä„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="streaks-section"]',position:"right"},{id:"gamification-level",title:"„É¨„Éô„É´ & „Éù„Ç§„É≥„Éà",description:"Ë®òÈå≤„ÇíÂÖ•Âäõ„Åô„Çã„Å®„Éù„Ç§„É≥„Éà„ÇíÁç≤ÂæóÔºÅ„É¨„Éô„É´„Ç¢„ÉÉ„Éó„Åô„Çã„Å®Êñ∞„Åó„ÅÑ„É©„É≥„ÇØ„Çø„Ç§„Éà„É´„ÅåÊâã„Å´ÂÖ•„Çä„Åæ„Åô„ÄÇ„Éì„ÇÆ„Éä„Éº„Åã„Çâ„É¨„Ç∏„Çß„É≥„Éâ„Åæ„Åß„ÄÅ7ÊÆµÈöé„ÅÆ„É©„É≥„ÇØ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="level-section"]',position:"right"},{id:"gamification-badges",title:"„Éê„ÉÉ„Ç∏„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥",description:"ÁâπÂà•„Å™ÈÅîÊàê„Åß„Éê„ÉÉ„Ç∏„ÇíÁç≤ÂæóÔºÅ7Êó•ÈÄ£Á∂öË®òÈå≤„ÄÅ„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„ÉàÊõ¥Êñ∞„ÄÅÂÆåÁíß„Å™ÈÄ±„Å™„Å©„ÄÇ„É¨„Ç¢„É™„ÉÜ„Ç£„ÅØ4ÊÆµÈöéÔºàCommon, Rare, Epic, LegendaryÔºâ„ÄÇ",targetSelector:'[data-tutorial="badges-card"]',position:"bottom"},{id:"gamification-goals",title:"ÁõÆÊ®ôË®≠ÂÆö",description:"Ëá™ÂàÜ„Å†„Åë„ÅÆÁõÆÊ®ô„ÇíË®≠ÂÆö„Åó„Å¶ÈÅîÊàê„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÄÅ‰ΩìÈáç„ÄÅ„Çπ„Éà„É™„Éº„ÇØ„ÄÅÁøíÊÖ£„ÄÅ„Ç´„Çπ„Çø„É†„Å™„Å©Êßò„ÄÖ„Å™ÁõÆÊ®ô„Çø„Ç§„Éó„Åã„ÇâÈÅ∏„Åπ„Åæ„Åô„ÄÇ",targetSelector:'[data-tutorial="goals-section"]',position:"left"},{id:"gamification-rankings",title:"„ÉÅ„Éº„É†„É©„É≥„Ç≠„É≥„Ç∞",description:"„ÉÅ„Éº„É†„É°„É≥„Éê„Éº„Å®Á´∂„ÅÑÂêà„Åä„ÅÜÔºÅÈÄ±ÈñìË®òÈå≤Êï∞„Å®„Éù„Ç§„É≥„Éà„ÅÆ2„Å§„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂàáÁ£ãÁê¢Á£®„Åó„Å¶ÊàêÈï∑„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",targetSelector:'[data-tutorial="rankings-section"]',position:"left"},{id:"gamification-complete",title:"„Åï„ÅÇ„ÄÅÂßã„ÇÅ„Çà„ÅÜÔºÅ",description:"Ê•Ω„Åó„Åø„Å™„Åå„ÇâË®òÈå≤„ÇíÁ∂ö„Åë„Å¶„ÄÅ„Çπ„Éà„É™„Éº„ÇØ„Çí‰º∏„Å∞„Åó„ÄÅ„Éê„ÉÉ„Ç∏„ÇíÈõÜ„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇÁ∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅ",position:"center"}];function Hr(t){switch(t){case"athlete":return oi;case"staff":return di;case"parent":return xi;case"global_admin":return ci;case"gamification":return mi;default:return[]}}function ui({onSubmit:t,onCheckExisting:s,onUpdate:r,loading:n=!1,lastRecord:l}){const[i,c]=a.useState(""),[j,x]=a.useState(_t()),[y,v]=a.useState(3),[N,w]=a.useState(""),[p,h]=a.useState(""),[u,f]=a.useState(!1),[d,o]=a.useState(null),[g,m]=a.useState(null),[b,_]=a.useState(!1),[S,C]=a.useState(!1),[R,A]=a.useState("success"),[T,M]=a.useState(""),k=(D,B)=>{A(D),M(B),C(!0)},F=()=>{c(""),x(_t()),v(3),w("")};a.useEffect(()=>{l&&(l.sleep_hours!=null&&c(String(l.sleep_hours)),l.sleep_quality!=null&&v(l.sleep_quality))},[l]);const O=()=>{const D=parseFloat(i);return isNaN(D)||D<0||D>24?(h("Áù°Áú†ÊôÇÈñì„ÅØ0„Äú24ÊôÇÈñì„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"),null):D},z=async D=>{if(D.preventDefault(),h(""),b||n)return;const B=O();if(B==null)return;const H={sleep_hours:B,date:j,sleep_quality:y,notes:N||void 0};_(!0);try{const W=await s(j);if(W){o(W),m(H),f(!0);return}await t(H),F(),k("success","Ë®òÈå≤„Åó„Åæ„Åó„Åü ‚úÖ")}catch(W){h("Áù°Áú†Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),console.error("Error submitting sleep record:",W),k("error",`‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºö${(W==null?void 0:W.message)??"‰∏çÊòé„Å™„Ç®„É©„Éº"}`)}finally{_(!1)}},P=async()=>{if(!(!d||!g)&&!(b||n)){f(!1),_(!0),h("");try{await r(d.id,g),F(),o(null),m(null),k("success","‰∏äÊõ∏„Åç„Åó„Å¶Ë®òÈå≤„Åó„Åæ„Åó„Åü ‚úÖ")}catch(D){h("Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),console.error("Error updating record:",D),k("error",`‰∏äÊõ∏„Åç„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºö${(D==null?void 0:D.message)??"‰∏çÊòé„Å™„Ç®„É©„Éº"}`)}finally{_(!1)}}},$=()=>{f(!1),o(null),m(null)},q=()=>e.jsx("div",{className:"flex items-center justify-center space-x-2",children:[1,2,3,4,5].map(D=>e.jsx("button",{type:"button",onClick:()=>v(D),className:`transition-colors ${D<=y?"text-yellow-400 hover:text-yellow-500":"text-gray-300 dark:text-gray-600 hover:text-gray-400"}`,children:e.jsx(Dr,{className:`w-6 h-6 ${D<=y?"fill-current":""}`})},D))}),E=n||b;return e.jsxs(e.Fragment,{children:[e.jsx(Rs,{open:S,type:R,message:T,onClose:()=>C(!1)}),e.jsx(nr,{isOpen:u,onClose:$,onOverwrite:P,onCancel:$,title:"Áù°Áú†Ë®òÈå≤",date:j,existingValues:[{label:"Áù°Áú†ÊôÇÈñì",value:`${(d==null?void 0:d.sleep_hours)||0}ÊôÇÈñì`},{label:"Áù°Áú†„ÅÆË≥™",value:`${(d==null?void 0:d.sleep_quality)||0}/5`}],newValues:[{label:"Áù°Áú†ÊôÇÈñì",value:`${(g==null?void 0:g.sleep_hours)||0}ÊôÇÈñì`},{label:"Áù°Áú†„ÅÆË≥™",value:`${(g==null?void 0:g.sleep_quality)||0}/5`}]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[p&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:p}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Êó•‰ªò"}),e.jsx("input",{type:"date",value:j,onChange:D=>x(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:E})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Áù°Áú†ÊôÇÈñìÔºàÊôÇÈñìÔºâ"}),l&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["ÂâçÂõûÔºà",l.date,"ÔºâÔºö",l.sleep_hours,"ÊôÇÈñì"]}),e.jsx("input",{type:"number",step:"0.5",min:"0",max:"24",value:i,onChange:D=>c(D.target.value),placeholder:"‰æã: 7.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:E}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Êé®Â•®: 7-9ÊôÇÈñì"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Áù°Áú†„ÅÆË≥™"}),l&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["ÂâçÂõû„ÅÆË≥™Ôºö",l.sleep_quality??"-"," / 5"]}),q(),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:[y===5&&"ÊúÄÈ´ò„ÅÆÁù°Áú†",y===4&&"ËâØ„ÅÑÁù°Áú†",y===3&&"ÊôÆÈÄö",y===2&&"„ÇÑ„ÇÑ‰∏çË∂≥",y===1&&"Áù°Áú†‰∏çË∂≥"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),e.jsx("textarea",{value:N,onChange:D=>w(D.target.value),placeholder:"Â§ú‰∏≠„Å´ÁõÆ„ÅåË¶ö„ÇÅ„Åü„ÄÅÂØù„Å§„Åç„ÅåÊÇ™„Åã„Å£„Åü „Å™„Å©...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none",disabled:E})]}),e.jsx("button",{type:"submit",disabled:E,className:`w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center ${E?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:E?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Qs,{className:"w-5 h-5 animate-spin"}),"‰øùÂ≠ò‰∏≠‚Ä¶"]}):e.jsxs(e.Fragment,{children:[e.jsx(Es,{className:"w-5 h-5 mr-2"}),"Áù°Áú†„ÇíË®òÈå≤„Åô„Çã"]})})]})]})}function gi({isOpen:t,onClose:s,onOverwrite:r,onCancel:n,existingRecord:l,newValue:i}){return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-yellow-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"„Åù„ÅÆÊó•‰ªò„ÅÆË®òÈå≤„ÅåÊó¢„Å´„ÅÇ„Çä„Åæ„Åô"})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Èñâ„Åò„Çã",children:e.jsx(Me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"„Åì„ÅÆÊó•‰ªò„Å´„ÅØÊó¢„Å´Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"Êó•‰ªò"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:new Date(l.date).toLocaleDateString("ja-JP")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"ÁèæÂú®"}),e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["ÊÑèÊ¨≤ ",l.motivation_level," /10"]}),e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["‰ΩìÂäõ ",l.energy_level," /10"]}),e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["„Çπ„Éà„É¨„Çπ ",l.stress_level," /10"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"Êñ∞Ë¶è"}),e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-semibold",children:["ÊÑèÊ¨≤ ",i.motivation_level," /10"]}),e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 font-semibold",children:["‰ΩìÂäõ ",i.energy_level," /10"]}),e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 font-semibold",children:["„Çπ„Éà„É¨„Çπ ",i.stress_level," /10"]})]})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"‰∏äÊõ∏„Åç„Åô„Çã„Å®„ÄÅÊó¢Â≠ò„Éá„Éº„Çø„ÅØÊõ¥Êñ∞„Åï„Çå„Åæ„Åô„ÄÇ"})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"‰∏äÊõ∏„Åç„Åô„Çã"})]})]})}):null}function hi({onSubmit:t,onCheckExisting:s,onUpdate:r,loading:n=!1,lastRecord:l}){const[i,c]=a.useState(5),[j,x]=a.useState(5),[y,v]=a.useState(5),[N,w]=a.useState(_t()),[p,h]=a.useState(""),[u,f]=a.useState(""),[d,o]=a.useState(!1),[g,m]=a.useState(!1),[b,_]=a.useState(!1),[S,C]=a.useState("success"),[R,A]=a.useState(""),T=(H,W)=>{C(H),A(W),_(!0)},[M,k]=a.useState(!1),[F,O]=a.useState(null),[z,P]=a.useState(null);a.useEffect(()=>{l&&!d&&(c(l.motivation_level),x(l.energy_level),v(l.stress_level),o(!0))},[l,d]);const $=()=>{c(5),x(5),v(5),w(_t()),h(""),o(!1)},q=n||g,E=async H=>{if(H.preventDefault(),f(""),q)return;const W={motivation_level:i,energy_level:j,stress_level:y,date:N,notes:p||void 0};m(!0);try{if(s){const U=await s(N);if(U){O(U),P(W),k(!0);return}}await t(W),$(),T("success","Ë®òÈå≤„Åó„Åæ„Åó„Åü ‚úÖ")}catch(U){f("„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),console.error("Error submitting motivation record:",U),T("error",`‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºö${(U==null?void 0:U.message)??"‰∏çÊòé„Å™„Ç®„É©„Éº"}`)}finally{m(!1)}},D=async()=>{if(!(!F||!z)&&!q){f(""),k(!1),m(!0);try{r?await r(F.id,{motivation_level:z.motivation_level,energy_level:z.energy_level,stress_level:z.stress_level,notes:z.notes}):await t(z),O(null),P(null),$(),T("success","‰∏äÊõ∏„Åç„Åó„Å¶Ë®òÈå≤„Åó„Åæ„Åó„Åü ‚úÖ")}catch(H){f("‰∏äÊõ∏„Åç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),console.error("Error overwriting motivation record:",H),T("error",`‰∏äÊõ∏„Åç„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºö${(H==null?void 0:H.message)??"‰∏çÊòé„Å™„Ç®„É©„Éº"}`)}finally{m(!1)}}},B=(H,W,U,Z,Y,ee,ae,V,te)=>{const se=(H-1)*11.11,I=te??"#3b82f6",J="#9ca3af";return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[Z,U]}),V!==void 0&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["ÂâçÂõû: ",e.jsx("span",{className:"font-semibold",children:V})," / 10",(l==null?void 0:l.date)&&e.jsxs("span",{className:"ml-1",children:["Ôºà",l.date,"Ôºâ"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-12",children:Y}),e.jsx("input",{type:"range",min:"1",max:"10",value:H,onChange:G=>W(parseInt(G.target.value)),disabled:q,className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-60 disabled:cursor-not-allowed",style:{background:`linear-gradient(to right, ${I} 0%, ${I} ${se}%, ${J} ${se}%, ${J} 100%)`}}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-12 text-right",children:ee})]}),e.jsxs("div",{className:"text-center mt-2",children:[e.jsx("span",{className:`text-2xl font-bold ${ae}`,children:H}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" / 10"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsx(Rs,{open:b,type:S,message:R,onClose:()=>_(!1)}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[u&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:u}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Êó•‰ªò"}),e.jsx("input",{type:"date",value:N,onChange:H=>w(H.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:q})]}),B(i,c,"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥",e.jsx(et,{className:"w-4 h-4 inline mr-2 text-blue-500"}),"‰Ωé„ÅÑ","È´ò„ÅÑ","text-blue-500",l==null?void 0:l.motivation_level,"#3b82f6"),B(j,x,"„Ç®„Éç„É´„ÇÆ„Éº„É¨„Éô„É´",e.jsx(Ut,{className:"w-4 h-4 inline mr-2 text-green-500"}),"Áñ≤Âä¥","ÂÖÖÂÆü","text-green-500",l==null?void 0:l.energy_level,"#10b981"),B(y,v,"„Çπ„Éà„É¨„Çπ„É¨„Éô„É´",e.jsx(pe,{className:"w-4 h-4 inline mr-2 text-red-500"}),"„É™„É©„ÉÉ„ÇØ„Çπ","È´ò„Çπ„Éà„É¨„Çπ","text-red-500",l==null?void 0:l.stress_level,"#ef4444"),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),e.jsx("textarea",{value:p,onChange:H=>h(H.target.value),placeholder:"‰ªäÊó•„ÅÆÂá∫Êù•‰∫ã„ÇÑÊ∞óÊåÅ„Å°„ÇíË®òÈå≤...",rows:3,disabled:q,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60"})]}),e.jsx("button",{type:"submit",disabled:q,className:`w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center ${q?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:q?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Qs,{className:"w-5 h-5 animate-spin"}),"‰øùÂ≠ò‰∏≠‚Ä¶"]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-5 h-5 mr-2"}),"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„ÇíË®òÈå≤„Åô„Çã"]})})]}),F&&z&&e.jsx(gi,{isOpen:M,onClose:()=>{k(!1),O(null),P(null)},onCancel:()=>{k(!1),O(null),P(null)},onOverwrite:D,existingRecord:F,newValue:{motivation_level:z.motivation_level,energy_level:z.energy_level,stress_level:z.stress_level,notes:z.notes}})]})}function bi({data:t}){const s=l=>{const i=new Date(l);return`${i.getMonth()+1}/${i.getDate()}`},r=a.useMemo(()=>t.sort((l,i)=>new Date(l.date).getTime()-new Date(i.date).getTime()).slice(-30).map(l=>({date:l.date,sleepHours:Number(l.sleep_hours),sleepQuality:l.sleep_quality,displayDate:s(l.date)})),[t]);if(t.length===0)return e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-base sm:text-lg mb-2",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-sm",children:"Áù°Áú†Ë®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„Ç∞„É©„Éï„ÇíË°®Á§∫„Åó„Åæ„Åó„Çá„ÅÜ"})]})});const n=({active:l,payload:i})=>{if(l&&i&&i.length){const c=i[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:c.displayDate}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-indigo-500 rounded-full mr-2"}),"Áù°Áú†ÊôÇÈñì: ",e.jsxs("span",{className:"font-semibold ml-1",children:[c.sleepHours,"ÊôÇÈñì"]})]}),c.sleepQuality&&e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),"Áù°Áú†„ÅÆË≥™: ",e.jsxs("span",{className:"font-semibold ml-1",children:[c.sleepQuality,"/5"]})]})]})]})}return null};return e.jsx("div",{className:"w-full h-64 sm:h-96",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(St,{data:r,margin:{top:5,right:20,left:0,bottom:5},children:[e.jsx(Ye,{strokeDasharray:"3 3",className:"stroke-gray-300 dark:stroke-gray-700"}),e.jsx(Ge,{dataKey:"displayDate",tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),e.jsx(De,{label:{value:"ÊôÇÈñì",angle:-90,position:"insideLeft"},tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400",domain:[0,12]}),e.jsx(Ze,{content:e.jsx(n,{})}),e.jsx(lt,{}),e.jsx(Ie,{y:7,stroke:"#10b981",strokeDasharray:"3 3",label:{value:"Êé®Â•®ÊúÄ‰Ωé",position:"right",fill:"#10b981"}}),e.jsx(Ie,{y:9,stroke:"#3b82f6",strokeDasharray:"3 3",label:{value:"ÁêÜÊÉ≥",position:"right",fill:"#3b82f6"}}),e.jsx(fe,{type:"monotone",dataKey:"sleepHours",stroke:"#6366f1",strokeWidth:2,dot:{fill:"#6366f1",r:4},activeDot:{r:6},name:"Áù°Áú†ÊôÇÈñì"})]})})})}function fi({data:t}){const s=l=>{const i=new Date(l);return`${i.getMonth()+1}/${i.getDate()}`},r=a.useMemo(()=>t.sort((l,i)=>new Date(l.date).getTime()-new Date(i.date).getTime()).slice(-30).map(l=>({date:l.date,motivation:l.motivation_level,energy:l.energy_level,stress:l.stress_level,displayDate:s(l.date)})),[t]);if(t.length===0)return e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-base sm:text-lg mb-2",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-sm",children:"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Ë®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„Ç∞„É©„Éï„ÇíË°®Á§∫„Åó„Åæ„Åó„Çá„ÅÜ"})]})});const n=({active:l,payload:i})=>{if(l&&i&&i.length){const c=i[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:c.displayDate}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥: ",e.jsxs("span",{className:"font-semibold ml-1",children:[c.motivation,"/10"]})]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),"„Ç®„Éç„É´„ÇÆ„Éº: ",e.jsxs("span",{className:"font-semibold ml-1",children:[c.energy,"/10"]})]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),"„Çπ„Éà„É¨„Çπ: ",e.jsxs("span",{className:"font-semibold ml-1",children:[c.stress,"/10"]})]})]})]})}return null};return e.jsx("div",{className:"w-full h-64 sm:h-96",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(St,{data:r,margin:{top:5,right:20,left:0,bottom:5},children:[e.jsx(Ye,{strokeDasharray:"3 3",className:"stroke-gray-300 dark:stroke-gray-700"}),e.jsx(Ge,{dataKey:"displayDate",tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),e.jsx(De,{domain:[0,10],tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),e.jsx(Ze,{content:e.jsx(n,{})}),e.jsx(lt,{}),e.jsx(Ie,{y:5,stroke:"#94a3b8",strokeDasharray:"3 3",label:{value:"‰∏≠Èñì",position:"right",fill:"#94a3b8"}}),e.jsx(fe,{type:"monotone",dataKey:"motivation",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥"}),e.jsx(fe,{type:"monotone",dataKey:"energy",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",r:3},name:"„Ç®„Éç„É´„ÇÆ„Éº"}),e.jsx(fe,{type:"monotone",dataKey:"stress",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:3},name:"„Çπ„Éà„É¨„Çπ"})]})})})}function pi({latestACWR:t,sleepHours:s,sleepQuality:r,motivationLevel:n,energyLevel:l,stressLevel:i}){const j=(()=>{let N=0,w=0;if(t&&(w++,t.riskLevel==="good"?N+=3:t.riskLevel==="caution"?N+=2:t.riskLevel==="low"?N+=2.5:N+=1),s!==null&&(w++,s>=7&&s<=9?N+=3:s>=6&&s<7?N+=2:N+=1),n!==null&&(w++,n>=7?N+=3:n>=5?N+=2:N+=1),l!==null&&(w++,l>=7?N+=3:l>=5?N+=2:N+=1),i!==null&&(w++,i<=4?N+=3:i<=6?N+=2:N+=1),w===0)return{level:"unknown",color:"gray",label:"„Éá„Éº„Çø„Å™„Åó"};const p=N/w;return p>=2.5?{level:"excellent",color:"green",label:"ÊúÄÈ´ò",icon:Ne}:p>=2?{level:"good",color:"blue",label:"ËâØÂ•Ω",icon:Ke}:p>=1.5?{level:"fair",color:"yellow",label:"Ê≥®ÊÑè",icon:ge}:{level:"poor",color:"red",label:"Ë≠¶Âëä",icon:ar}})(),x=j.icon||ge,v=(()=>{const N=t&&(t.riskLevel==="high"||t.riskLevel==="caution"),w=s!==null&&s<7,p=n!==null&&n<5,h=i!==null&&i>7;return N&&w?{text:"ÊÄ™Êàë„É™„Çπ„ÇØÊ•µÂ§ßÔºöÁ∑¥ÁøíË≤†Ëç∑„ÅåÈ´ò„Åè„ÄÅÁù°Áú†‰∏çË∂≥„Åß„Åô„ÄÇ‰ºëÊÅØ„ÇíÂÑ™ÂÖà„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",color:"text-red-700 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/20"}:p&&h?{text:"„É°„É≥„Çø„É´Ê≥®ÊÑèÔºö„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥‰Ωé‰∏ã„Å®„Çπ„Éà„É¨„ÇπÈÅéÂ§ö„Åß„Åô„ÄÇ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ",color:"text-orange-700 dark:text-orange-400",bg:"bg-orange-50 dark:bg-orange-900/20"}:w?{text:"Áù°Áú†‰∏çË∂≥Ôºö„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ‰Ωé‰∏ã„ÅÆ„É™„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÁù°Áú†ÊôÇÈñì„ÇíÁ¢∫‰øù„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",color:"text-yellow-700 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"}:N?{text:"„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑Ê≥®ÊÑèÔºöÂõûÂæ©„ÇíÂÑ™ÂÖà„Åó„ÄÅË≤†Ëç∑„ÇíË™øÊï¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",color:"text-blue-700 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20"}:{text:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥ËâØÂ•ΩÔºö„Åì„ÅÆ„Åæ„ÅæË®àÁîªÁöÑ„Å™„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",color:"text-green-700 dark:text-green-400",bg:"bg-green-50 dark:bg-green-900/20"}})();return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"‰ªäÊó•„ÅÆ„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥"}),e.jsxs("div",{className:`flex items-center space-x-2 px-4 py-2 bg-${j.color}-100 dark:bg-${j.color}-900/20 rounded-full`,children:[e.jsx(x,{className:`w-5 h-5 text-${j.color}-600 dark:text-${j.color}-400`}),e.jsx("span",{className:`font-semibold text-${j.color}-700 dark:text-${j.color}-400`,children:j.label})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6",children:[t&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Le,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ACWR"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.acwr})]}),s!==null&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Es,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Áù°Áú†"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[s.toFixed(1),"h"]})]}),n!==null&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(et,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ÊÑèÊ¨≤"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[n,"/10"]})]})]}),e.jsx("div",{className:`${v.bg} border border-${j.color}-200 dark:border-${j.color}-800 rounded-lg p-4`,children:e.jsx("p",{className:`text-sm ${v.color}`,children:v.text})})]})}const yi=[{value:"cramps",label:"ÁîüÁêÜÁóõ",icon:Ut},{value:"mood_changes",label:"Ê∞óÂàÜ„ÅÆÂ§âÂåñ",icon:Ja},{value:"fatigue",label:"Áñ≤Âä¥ÊÑü",icon:Ha},{value:"headache",label:"È†≠Áóõ",icon:Va},{value:"bloating",label:"ËÜ®Ê∫ÄÊÑü",icon:tn},{value:"breast_tenderness",label:"ËÉ∏„ÅÆÂºµ„Çä",icon:et},{value:"acne",label:"„Éã„Ç≠„Éì",icon:ts},{value:"back_pain",label:"ËÖ∞Áóõ",icon:Qa}];function ji({selectedDate:t,periodStart:s,setPeriodStart:r,flowIntensity:n,setFlowIntensity:l,symptoms:i,setSymptoms:c,cycleNotes:j,setCycleNotes:x,periodDuration:y,setPeriodDuration:v,cycleLength:N,setCycleLength:w,error:p}){const[h,u]=a.useState(""),f=a.useMemo(()=>{if(!t||!h)return null;const o=new Date(t),g=new Date(h),m=Math.floor((g.getTime()-o.getTime())/(1e3*60*60*24))+1;return Number.isFinite(m)&&m>0?m:null},[t,h]),d=o=>{c(i.includes(o)?i.filter(g=>g!==o):[...i,o])};return e.jsxs("div",{className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Bt,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"ÊúàÁµåÂë®Êúü„ÇíË®òÈå≤"})]}),p&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{children:p})]}),e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-4",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:"‰ªäÊó•„ÅåÊúàÁµåÈñãÂßãÔºàÂá∫Ë°Ä1Êó•ÁõÆÔºâ"}),e.jsx("input",{type:"checkbox",checked:s,onChange:o=>r(o.target.checked),className:"h-5 w-5 accent-pink-600"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"‚ÄªÈñãÂßãÊó•„ÅÆÁôªÈå≤„Çí„Éà„É™„Ç¨„Éº„Å´Âë®Êúü„Çí‰øùÂ≠ò„Åó„Åæ„Åô"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(_e,{className:"inline w-4 h-4 mr-1"}),"ÁîüÁêÜÈñãÂßãÊó•Ôºà‰ªäÊó•„ÅÆÂÖ•ÂäõÊó•Ôºâ"]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-100",children:t})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(_e,{className:"inline w-4 h-4 mr-1"}),"ÁîüÁêÜÁµÇ‰∫ÜÊó•Ôºà‰ªªÊÑèÔºâ"]}),e.jsx("input",{type:"date",value:h,min:t,onChange:o=>{const g=o.target.value;if(u(g),g){const m=new Date(t),b=new Date(g),_=Math.floor((b.getTime()-m.getTime())/(1e3*60*60*24))+1;Number.isFinite(_)&&_>0&&v(_)}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"}),f!=null&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ÁîüÁêÜÊúüÈñì: ",f,"Êó•Èñì"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÁµåË°ÄÈáè"}),e.jsxs("select",{value:n,onChange:o=>l(o.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"light",children:"Â∞ë„Å™„ÅÑ"}),e.jsx("option",{value:"moderate",children:"ÊôÆÈÄö"}),e.jsx("option",{value:"heavy",children:"Â§ö„ÅÑ"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÁóáÁä∂"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:yi.map(o=>{const g=o.icon,m=i.includes(o.value);return e.jsxs("button",{type:"button",onClick:()=>d(o.value),className:`px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 ${m?"border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-105":"border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300 hover:scale-105"}`,children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:o.label})]},o.value)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÊúàÁµåÊúüÈñìÔºàÊó•Ôºâ"}),e.jsx("input",{type:"number",min:1,max:14,value:y,onChange:o=>v(Number(o.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Âë®ÊúüÔºàÊó•Ôºâ"}),e.jsx("input",{type:"number",min:20,max:45,value:N,onChange:o=>w(Number(o.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢"}),e.jsx("textarea",{value:j,onChange:o=>x(o.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"„Åù„ÅÆ‰ªñ„ÅÆ„É°„É¢..."})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"‚Äª ‰øùÂ≠ò„ÅØ‰∏ã„ÅÆ„ÄåÊ¨°„Å∏/ÂÆå‰∫Ü„Äç„Éú„Çø„É≥„ÅßË°å„ÅÑ„Åæ„Åô"})]})}function wi({userId:t,userGender:s,enableCycle:r,onTrainingSubmit:n,onTrainingCheckExisting:l,onTrainingUpdate:i,onWeightSubmit:c,onWeightCheckExisting:j,onWeightUpdate:x,onSleepSubmit:y,onSleepCheckExisting:v,onSleepUpdate:N,onMotivationSubmit:w,onMotivationCheckExisting:p,onMotivationUpdate:h,onCycleSubmit:u,onCycleUpdate:f,onClose:d,lastTrainingRecord:o,lastWeightRecord:g,lastSleepRecord:m,lastMotivationRecord:b}){const _=_t(),S=(r??s==="female")===!0,[C,R]=a.useState(_),[A,T]=a.useState("training"),[M,k]=a.useState((o==null?void 0:o.rpe)??5),[F,O]=a.useState((o==null?void 0:o.duration_min)??60),[z,P]=a.useState((o==null?void 0:o.arrow_score)??50),[$,q]=a.useState((o==null?void 0:o.signal_score)??50),[E,D]=a.useState((g==null?void 0:g.weight_kg)!=null?String(g.weight_kg):""),[B,H]=a.useState(""),[W,U]=a.useState((m==null?void 0:m.sleep_hours)??7),[Z,Y]=a.useState((m==null?void 0:m.sleep_quality)??3),[ee,ae]=a.useState(""),[V,te]=a.useState((b==null?void 0:b.motivation_level)??7),[se,I]=a.useState((b==null?void 0:b.energy_level)??7),[J,G]=a.useState((b==null?void 0:b.stress_level)??5),[ne,oe]=a.useState(""),[de,ue]=a.useState(!1),[ye,je]=a.useState(5),[st,ct]=a.useState(28),[Se,rt]=a.useState("moderate"),[Oe,bt]=a.useState([]),[xe,xt]=a.useState(""),[Te,Fe]=a.useState(new Set),[ft,Pe]=a.useState(!1),[Ht,At]=a.useState(""),[Vt,we]=a.useState(!1),[ss,Ct]=a.useState(!1),[it,Mt]=a.useState(null),[qe,ot]=a.useState(null),[ke,pt]=a.useState(null),us=()=>(S?A==="cycle":A==="conditioning")?"ÂÆå‰∫Ü":"Ê¨°„Å∏",rs=async le=>{Pe(!0),At("");try{if(le==="training"){const he=await l(C);if(he){Mt("training"),ot(he),pt({rpe:M,duration_min:F,date:C,arrow_score:z,signal_score:$}),Ct(!0),Pe(!1);return}await n({rpe:M,duration_min:F,date:C,arrow_score:z??50,signal_score:$??50}),Fe(me=>new Set(me).add("training")),T("weight");return}if(le==="weight"){if(E){const he=await j(C);if(he){Mt("weight"),ot(he),pt({weight_kg:Number(E),date:C,notes:B||void 0}),Ct(!0),Pe(!1);return}await c({weight_kg:Number(E),date:C,notes:B||void 0}),Fe(me=>new Set(me).add("weight"))}T("conditioning");return}if(le==="conditioning"){const[he,me]=await Promise.all([v(C),p(C)]);if(he||me){Mt("conditioning"),ot({sleep:he,motivation:me}),pt({sleep:{sleep_hours:W,sleep_quality:Z,date:C,notes:ee||void 0},motivation:{motivation_level:V,energy_level:se,stress_level:J,date:C,notes:ne||void 0}}),Ct(!0),Pe(!1);return}await y({sleep_hours:W,sleep_quality:Z,date:C,notes:ee||void 0}),await w({motivation_level:V,energy_level:se,stress_level:J,date:C,notes:ne||void 0}),Fe(We=>new Set(We).add("conditioning")),S?T("cycle"):setTimeout(()=>d(),500);return}if(le==="cycle"){if(de){if(!u)throw new Error("onCycleSubmit „ÅåÊú™Ë®≠ÂÆö„Åß„Åô");await u({cycle_start_date:C,period_duration_days:ye,cycle_length_days:st,flow_intensity:Se,symptoms:Oe.length>0?Oe:void 0,notes:xe||void 0})}Fe(he=>new Set(he).add("cycle")),setTimeout(()=>d(),500);return}}catch(he){const me=he instanceof Error?he.message:"‰∏çÊòé„Å™„Ç®„É©„Éº";At(`${le==="training"?"Á∑¥Áøí":le==="weight"?"‰ΩìÈáç":le==="cycle"?"Âë®Êúü":"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥"}Ë®òÈå≤„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${me}`)}finally{Pe(!1)}},Be=async()=>{if(!(!qe||!ke||!it)){Ct(!1),Pe(!0);try{if(it==="training")await i(qe.id,{rpe:ke.rpe,duration_min:ke.duration_min,arrow_score:ke.arrow_score,signal_score:ke.signal_score}),Fe(le=>new Set(le).add("training")),T("weight");else if(it==="weight")await x(qe.id,{weight_kg:ke.weight_kg,notes:ke.notes}),Fe(le=>new Set(le).add("weight")),T("conditioning");else if(it==="conditioning"){const le=qe,he=ke;le.sleep?await N(le.sleep.id,he.sleep):await y(he.sleep),le.motivation?await h(le.motivation.id,he.motivation):await w(he.motivation),Fe(me=>new Set(me).add("conditioning")),S?T("cycle"):setTimeout(()=>d(),500)}ot(null),pt(null),Mt(null)}catch{At("Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{Pe(!1)}}},Rt=()=>{Ct(!1),ot(null),pt(null),Mt(null)},Kt=le=>{switch(le){case"training":return Le;case"weight":return Ve;case"conditioning":return et;case"cycle":return _e;default:return Le}},as=["0 - „Åæ„Å£„Åü„ÅèÊ•Ω„Åß„ÅÇ„Çã","1 - ÈùûÂ∏∏„Å´Ê•Ω„Åß„ÅÇ„Çã","2 - Ê•Ω„Åß„ÅÇ„Çã","3 - Â∞ë„Åó„Åç„Å§„ÅÑ","4 - „ÇÑ„ÇÑ„Åç„Å§„ÅÑ","5 - „Åç„Å§„ÅÑ","6 - „Åã„Å™„Çä„Åç„Å§„ÅÑ","7 - ÈùûÂ∏∏„Å´„Åç„Å§„ÅÑ","8 - Ê•µÂ∫¶„Å´„Åç„Å§„ÅÑ","9 - ÈôêÁïå„Å´Ëøë„ÅÑ","10 - ÈôêÁïå"],ns=()=>{switch(it){case"training":return"Á∑¥ÁøíË®òÈå≤";case"weight":return"‰ΩìÈáçË®òÈå≤";case"conditioning":return"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥";default:return""}},gs=()=>{var le,he;if(!qe||!ke)return{existing:[],pending:[]};switch(it){case"training":return{existing:[{label:"RPE",value:((le=qe.rpe)==null?void 0:le.toString())||"-"},{label:"ÊôÇÈñì",value:`${qe.duration_min||0}ÂàÜ`},{label:"ÊàêÈï∑ÂÆüÊÑü",value:qe.arrow_score!=null?"ÂÖ•Âäõ„ÅÇ„Çä":"‚Äî"},{label:"ÊÑèÂõ≥ÁêÜËß£",value:qe.signal_score!=null?"ÂÖ•Âäõ„ÅÇ„Çä":"‚Äî"}],pending:[{label:"RPE",value:((he=ke.rpe)==null?void 0:he.toString())||"-"},{label:"ÊôÇÈñì",value:`${ke.duration_min||0}ÂàÜ`},{label:"ÊàêÈï∑ÂÆüÊÑü",value:"ÂÖ•Âäõ„ÅÇ„Çä"},{label:"ÊÑèÂõ≥ÁêÜËß£",value:"ÂÖ•Âäõ„ÅÇ„Çä"}]};case"weight":return{existing:[{label:"‰ΩìÈáç",value:`${qe.weight_kg||0} kg`}],pending:[{label:"‰ΩìÈáç",value:`${ke.weight_kg||0} kg`}]};case"conditioning":{const me=qe;return{existing:[{label:"Áù°Áú†ÊôÇÈñì",value:me.sleep?`${me.sleep.sleep_hours??0}ÊôÇÈñì`:"‚Äî"},{label:"Áù°Áú†„ÅÆË≥™",value:me.sleep?`${me.sleep.sleep_quality??0}/5`:"‚Äî"},{label:"„É¢„ÉÅ„Éô",value:me.motivation?`${me.motivation.motivation_level??0}/10`:"‚Äî"},{label:"„Ç®„Éç„É´„ÇÆ„Éº",value:me.motivation?`${me.motivation.energy_level??0}/10`:"‚Äî"},{label:"„Çπ„Éà„É¨„Çπ",value:me.motivation?`${me.motivation.stress_level??0}/10`:"‚Äî"}],pending:[{label:"Áù°Áú†ÊôÇÈñì",value:`${ke.sleep.sleep_hours??0}ÊôÇÈñì`},{label:"Áù°Áú†„ÅÆË≥™",value:`${ke.sleep.sleep_quality??0}/5`},{label:"„É¢„ÉÅ„Éô",value:`${ke.motivation.motivation_level??0}/10`},{label:"„Ç®„Éç„É´„ÇÆ„Éº",value:`${ke.motivation.energy_level??0}/10`},{label:"„Çπ„Éà„É¨„Çπ",value:`${ke.motivation.stress_level??0}/10`}]}}default:return{existing:[],pending:[]}}},yt=({values:le,highlight:he})=>e.jsx("div",{className:"mt-1 flex justify-between text-[10px] leading-none text-gray-500 dark:text-gray-400 select-none",children:le.map(me=>e.jsx("span",{className:me===he?"font-semibold text-gray-700 dark:text-gray-200":"",children:me},me))}),Jt=gs();return e.jsxs(e.Fragment,{children:[e.jsx(nr,{isOpen:ss,onClose:Rt,onOverwrite:Be,onCancel:Rt,title:ns(),date:C,existingValues:Jt.existing,newValues:Jt.pending}),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] ${Vt?"overflow-hidden":"overflow-y-auto"}`,children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"‰ªäÊó•„ÅÆË®òÈå≤"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",type:"button",children:e.jsx(Me,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("input",{type:"date",value:C,onChange:le=>R(le.target.value),className:"bg-transparent border-none text-gray-900 dark:text-white font-medium focus:outline-none"})]}),e.jsx("div",{className:"flex space-x-2",children:(S?["training","weight","conditioning","cycle"]:["training","weight","conditioning"]).map(le=>{const he=Kt(le),me=A===le,We=Te.has(le);return e.jsxs("button",{onClick:()=>T(le),className:`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all flex items-center justify-center space-x-2 ${me?"bg-blue-600 text-white shadow-lg":We?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"}`,type:"button",children:[We?e.jsx(Ne,{className:"w-4 h-4"}):e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:le==="training"?"Á∑¥Áøí":le==="weight"?"‰ΩìÈáç":le==="cycle"?"Âë®Êúü":"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥"})]},le)})})]}),e.jsxs("div",{className:"p-6",children:[A==="training"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-lg",children:e.jsx(Le,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Á∑¥ÁøíË®òÈå≤"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"RPE„Å®Á∑¥ÁøíÊôÇÈñì„ÇíË®òÈå≤"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"RPE (‰∏ªË¶≥ÁöÑÈÅãÂãïÂº∑Â∫¶)"}),e.jsx("input",{type:"range",min:"0",max:"10",value:M,onChange:le=>k(Number(le.target.value)),onPointerDown:()=>we(!0),onPointerUp:()=>we(!1),onPointerCancel:()=>we(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:as[M]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Á∑¥ÁøíÊôÇÈñìÔºö",F,"ÂàÜ",e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["Ôºà",Math.floor(F/60),"ÊôÇÈñì",F%60,"ÂàÜÔºâ"]})]}),e.jsx("div",{className:"py-3 -my-3",children:e.jsx("input",{type:"range",min:"0",max:"480",step:"5",value:F,onChange:le=>O(Number(le.target.value)),onPointerDown:()=>we(!0),onPointerUp:()=>we(!1),onPointerCancel:()=>we(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600"})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:"0ÂàÜ"}),e.jsx("span",{children:"4ÊôÇÈñì"}),e.jsx("span",{children:"8ÊôÇÈñì"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-200",children:[e.jsx("strong",{children:"„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑:"})," ",M*F]})}),e.jsx(sn,{value:z,onChange:P}),e.jsx(rn,{value:$,onChange:q})]}),A==="weight"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg",children:e.jsx(Ve,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"‰ΩìÈáçË®òÈå≤"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"‰ΩìÈáç„ÇíË®òÈå≤"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"‰ΩìÈáç (kg)"}),e.jsx("input",{type:"number",step:"0.1",value:E,onChange:le=>D(le.target.value),placeholder:"‰æã: 65.5",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢ (‰ªªÊÑè)"}),e.jsx("textarea",{value:B,onChange:le=>H(le.target.value),placeholder:"Ê∏¨ÂÆöÊôÇ„ÅÆÁä∂Ê≥Å„Å™„Å©",rows:2,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"})]}),g&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-green-900 dark:text-green-200",children:[e.jsx("strong",{children:"ÂâçÂõû„ÅÆË®òÈå≤:"})," ",Number(g.weight_kg).toFixed(1)," kg"]})})]}),A==="conditioning"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg",children:e.jsx(et,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Áù°Áú†„Å®„É°„É≥„Çø„É´Áä∂ÊÖã„ÇíË®òÈå≤"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Es,{className:"w-4 h-4 inline mr-1"}),"Áù°Áú†ÊôÇÈñìÔºö",e.jsxs("span",{className:"font-semibold",children:[W,"ÊôÇÈñì"]}),e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["Ôºà",Math.floor(W),"ÊôÇÈñì",Math.round(W%1*60),"ÂàÜÔºâ"]})]}),m&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-2",children:["ÂâçÂõûÔºà",m.date,"ÔºâÔºö",m.sleep_hours,"ÊôÇÈñì",(m==null?void 0:m.sleep_quality)!=null?` / Ë≥™ ${m.sleep_quality}/5`:""]}),e.jsx("div",{className:"py-3 -my-3",children:e.jsx("input",{type:"range",min:"0",max:"12",step:"0.25",value:W,onChange:le=>U(Number(le.target.value)),onPointerDown:()=>we(!0),onPointerUp:()=>we(!1),onPointerCancel:()=>we(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:"0h"}),e.jsx("span",{children:"6h"}),e.jsx("span",{children:"12h"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Áù°Áú†„ÅÆË≥™Ôºö",e.jsx("span",{className:"font-semibold",children:Z}),"/5"]}),m&&e.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["ÂâçÂõûÔºà",m.date,"ÔºâÔºö",(m==null?void 0:m.sleep_quality)??"‚Äî","/5"]}),e.jsx("div",{className:"py-3 -my-3",children:e.jsx("input",{type:"range",min:"1",max:"5",step:"1",value:Z,onChange:le=>Y(Number(le.target.value)),onPointerDown:()=>we(!0),onPointerUp:()=>we(!1),onPointerCancel:()=>we(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),e.jsx(yt,{values:[1,2,3,4,5],highlight:Z}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[Z===5&&"ÊúÄÈ´ò„ÅÆÁù°Áú†",Z===4&&"ËâØ„ÅÑÁù°Áú†",Z===3&&"ÊôÆÈÄö",Z===2&&"„ÇÑ„ÇÑ‰∏çË∂≥",Z===1&&"Áù°Áú†‰∏çË∂≥"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Ut,{className:"w-4 h-4 inline mr-1"}),"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Ôºö",e.jsx("span",{className:"font-semibold",children:V}),"/10"]}),b&&e.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["ÂâçÂõûÔºà",b.date,"ÔºâÔºö",b.motivation_level,"/10"]}),e.jsx("div",{className:"py-3 -my-3",children:e.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:V,onChange:le=>te(Number(le.target.value)),onPointerDown:()=>we(!0),onPointerUp:()=>we(!1),onPointerCancel:()=>we(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),e.jsx(yt,{values:[1,2,3,4,5,6,7,8,9,10],highlight:V})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["„Ç®„Éç„É´„ÇÆ„ÉºÔºö",e.jsx("span",{className:"font-semibold",children:se}),"/10"]}),b&&e.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["ÂâçÂõûÔºà",b.date,"ÔºâÔºö",b.energy_level,"/10"]}),e.jsx("div",{className:"py-3 -my-3",children:e.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:se,onChange:le=>I(Number(le.target.value)),onPointerDown:()=>we(!0),onPointerUp:()=>we(!1),onPointerCancel:()=>we(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),e.jsx(yt,{values:[1,2,3,4,5,6,7,8,9,10],highlight:se})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["„Çπ„Éà„É¨„ÇπÔºö",e.jsx("span",{className:"font-semibold",children:J}),"/10"]}),b&&e.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["ÂâçÂõûÔºà",b.date,"ÔºâÔºö",b.stress_level,"/10"]}),e.jsx("div",{className:"py-3 -my-3",children:e.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:J,onChange:le=>G(Number(le.target.value)),onPointerDown:()=>we(!0),onPointerUp:()=>we(!1),onPointerCancel:()=>we(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),e.jsx(yt,{values:[1,2,3,4,5,6,7,8,9,10],highlight:J})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢ (‰ªªÊÑè)"}),e.jsx("textarea",{value:ne,onChange:le=>oe(le.target.value),placeholder:"‰ΩìË™ø„ÅÆË©≥Á¥∞„Å™„Å©",rows:2,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"})]})]}),Ht&&A!=="cycle"&&e.jsx("div",{className:"mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400",children:Ht})}),A==="cycle"&&S&&e.jsx(ji,{selectedDate:C,periodStart:de,setPeriodStart:ue,flowIntensity:Se,setFlowIntensity:rt,symptoms:Oe,setSymptoms:bt,cycleNotes:xe,setCycleNotes:xt,periodDuration:ye,setPeriodDuration:je,cycleLength:st,setCycleLength:ct,error:Ht||null}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{type:"button",onClick:()=>void rs(A),disabled:ft,className:`w-full py-3 rounded-xl font-semibold transition-colors ${ft?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:ft?"‰øùÂ≠ò‰∏≠...":us()})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("button",{onClick:d,className:"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",type:"button",children:"Âæå„ÅßË®òÈå≤„Åô„Çã"})})]})]})})]})}function vi({acwrData:t,weightRecords:s,sleepRecords:r,motivationRecords:n,trainingRecords:l,menstrualCycles:i=[],userGender:c,onOpenDetailView:j,onQuickAdd:x}){const y=a.useMemo(()=>{if(!t||t.length===0)return null;const P=t.filter($=>$==null?void 0:$.date);return P.length===0?t[t.length-1]??null:P.reduce(($,q)=>new Date($.date).getTime()>=new Date(q.date).getTime()?$:q)},[t]),v=a.useMemo(()=>!s||s.length===0?null:s.reduce((P,$)=>new Date(P.date).getTime()>=new Date($.date).getTime()?P:$),[s]),N=a.useMemo(()=>!r||r.length===0?null:r.reduce((P,$)=>new Date(P.date).getTime()>=new Date($.date).getTime()?P:$),[r]),w=a.useMemo(()=>!n||n.length===0?null:n.reduce((P,$)=>new Date(P.date).getTime()>=new Date($.date).getTime()?P:$),[n]),p=a.useMemo(()=>!l||l.length===0?null:l.reduce((P,$)=>new Date(P.date).getTime()>=new Date($.date).getTime()?P:$),[l]),h=()=>{if(s.length<2)return null;const P=Number(s[0].weight_kg),$=Number(s[1].weight_kg),q=P-$;return{value:q,isUp:q>0}},u=()=>{if(r.length===0)return null;const P=r.slice(0,7);return P.reduce((q,E)=>q+Number(E.sleep_hours),0)/P.length},f=P=>{switch(P){case"good":return"text-green-600 dark:text-green-400";case"caution":return"text-yellow-600 dark:text-yellow-400";case"high":return"text-red-600 dark:text-red-400";default:return"text-blue-600 dark:text-blue-400"}},d=P=>{switch(P){case"good":return"bg-green-50 dark:bg-green-900/20";case"caution":return"bg-yellow-50 dark:bg-yellow-900/20";case"high":return"bg-red-50 dark:bg-red-900/20";default:return"bg-blue-50 dark:bg-blue-900/20"}},g=(()=>{let P=0,$=0;if(y&&($++,y.riskLevel==="good"?P+=25:y.riskLevel==="caution"?P+=15:y.riskLevel==="low"?P+=20:P+=10),N){$++;const q=Number(N.sleep_hours),E=N.sleep_quality;q>=7&&q<=9&&E>=7?P+=25:q>=6&&E>=5?P+=15:P+=5}if(w){$++;const q=(w.motivation_level+w.energy_level+(10-w.stress_level))/3;q>=7?P+=25:q>=5?P+=15:P+=5}if(v&&s.length>=2){$++;const q=h();q&&Math.abs(q.value)<.5?P+=25:q&&Math.abs(q.value)<1?P+=15:P+=10}return $===0?0:Math.round(P/$*4)})(),m=h(),b=u(),_=()=>{if(!i||i.length===0)return null;const P=new Date;P.setHours(0,0,0,0);for(const $ of i){const q=new Date($.cycle_start_date);q.setHours(0,0,0,0);const E=$.cycle_end_date?new Date($.cycle_end_date):null;if(E&&E.setHours(0,0,0,0),P>=q&&(!E||P<=E)){const D=Math.floor((P.getTime()-q.getTime())/864e5);if($.period_duration_days&&D<$.period_duration_days)return{phase:"menstrual",cycle:$,daysSinceStart:D};if($.cycle_length_days){const B=Math.floor($.cycle_length_days/2);if(D<B)return{phase:"follicular",cycle:$,daysSinceStart:D};const H=B+2;if(D<H)return{phase:"ovulatory",cycle:$,daysSinceStart:D};if(D<$.cycle_length_days)return{phase:"luteal",cycle:$,daysSinceStart:D}}}}return null},S=()=>{if(!i||i.length===0)return null;const $=[...i].sort((D,B)=>new Date(B.cycle_start_date).getTime()-new Date(D.cycle_start_date).getTime())[0];if(!$.cycle_length_days)return null;const q=new Date($.cycle_start_date),E=new Date(q);return E.setDate(E.getDate()+$.cycle_length_days),E},C=P=>{switch(P){case"menstrual":return"ÊúàÁµåÊúü";case"follicular":return"ÂçµËÉûÊúü";case"ovulatory":return"ÊéíÂçµÊúü";case"luteal":return"ÈªÑ‰ΩìÊúü";default:return"‰∏çÊòé"}},R=P=>{switch(P){case"menstrual":return"text-red-600 dark:text-red-400";case"follicular":return"text-green-600 dark:text-green-400";case"ovulatory":return"text-yellow-600 dark:text-yellow-400";case"luteal":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}},A=P=>{switch(P){case"menstrual":return"bg-red-100 dark:bg-red-900/30";case"follicular":return"bg-green-100 dark:bg-green-900/30";case"ovulatory":return"bg-yellow-100 dark:bg-yellow-900/30";case"luteal":return"bg-blue-100 dark:bg-blue-900/30";default:return"bg-gray-100 dark:bg-gray-700"}},T=P=>{switch(P){case"menstrual":return"‰ΩéÔΩû‰∏≠Âº∑Â∫¶„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíÊé®Â•®";case"follicular":return"È´òÂº∑Â∫¶„Éà„É¨„Éº„Éã„É≥„Ç∞„Å´ÊúÄÈÅ©";case"ovulatory":return"„Éî„Éº„ÇØ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúü";case"luteal":return"ÂõûÂæ©ÈáçË¶ñ„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Çí";default:return""}},M=_(),k=S(),F=c==="female",O=a.useMemo(()=>[...s??[]].sort((P,$)=>new Date($.date).getTime()-new Date(P.date).getTime()),[s]),z=a.useMemo(()=>{const P=O[0];if(!(P!=null&&P.date)||P.weight_kg==null)return null;const $=new Date(P.date),q=new Date($);q.setDate(q.getDate()-30);const E=O.find(D=>(D==null?void 0:D.date)&&new Date(D.date)<=q&&D.weight_kg!=null);return E?Number(P.weight_kg)-Number(E.weight_kg):null},[O]);return Ae.useEffect(()=>{},[c,F,i==null?void 0:i.length]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 rounded-2xl shadow-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-1",children:"Á∑èÂêà„Çπ„Ç≥„Ç¢"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"„Åô„Åπ„Å¶„ÅÆÊåáÊ®ô„ÇíÁµ±Âêà„Åó„ÅüÂÅ•Â∫∑Áä∂ÊÖã"})]}),e.jsxs("div",{className:"bg-white/20 rounded-full px-6 py-3",children:[e.jsx("div",{className:"text-4xl font-bold",children:g}),e.jsx("div",{className:"text-xs text-center text-blue-100",children:"/ 100"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsx(Le,{className:"w-5 h-5 mb-1"}),e.jsx("div",{className:"text-xs text-blue-100",children:"ACWR"}),e.jsx("div",{className:"text-lg font-bold",children:typeof(y==null?void 0:y.acwr)=="number"?y.acwr.toFixed(2):"-"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsx(Ve,{className:"w-5 h-5 mb-1"}),e.jsx("div",{className:"text-xs text-blue-100",children:"‰ΩìÈáç"}),e.jsx("div",{className:"text-lg font-bold",children:v?`${Number(v.weight_kg).toFixed(1)}kg`:"-"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsx(et,{className:"w-5 h-5 mb-1"}),e.jsx("div",{className:"text-xs text-blue-100",children:"Áù°Áú†"}),e.jsx("div",{className:"text-lg font-bold",children:N?`${Number(N.sleep_hours).toFixed(1)}h`:"-"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsx(et,{className:"w-5 h-5 mb-1"}),e.jsx("div",{className:"text-xs text-blue-100",children:"ÊÑèÊ¨≤"}),e.jsx("div",{className:"text-lg font-bold",children:w?`${w.motivation_level}/10`:"-"})]})]})]}),e.jsxs("div",{className:`grid grid-cols-1 gap-6 ${F?"md:grid-cols-2 lg:grid-cols-4":"md:grid-cols-3"}`,children:[e.jsxs("div",{onClick:()=>j("training"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-3 rounded-lg ${y?d(y.riskLevel):"bg-gray-100 dark:bg-gray-700"}`,children:e.jsx(Le,{className:`w-6 h-6 ${y?f(y.riskLevel):"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Á∑¥ÁøíË®òÈå≤"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Training Load"})]})]}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-300",children:typeof(y==null?void 0:y.acwr)=="number"?y.acwr.toFixed(2):"‰∏çÊòé"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ACWR"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[y.riskLevel==="high"&&e.jsx(ge,{className:"w-4 h-4 text-red-600"}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[y.riskLevel==="good"&&"ÁêÜÊÉ≥ÁöÑ„Å™Ë≤†Ëç∑",y.riskLevel==="caution"&&"Ë≤†Ëç∑„Åå„ÇÑ„ÇÑÈ´ò„ÇÅ",y.riskLevel==="high"&&"ÊÄ™Êàë„É™„Çπ„ÇØË≠¶Âëä",y.riskLevel==="low"&&"Ë≤†Ëç∑„Åå„ÇÑ„ÇÑ‰Ωé„ÇÅ"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"ÊÄ•ÊÄßË≤†Ëç∑"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:y.acuteLoad})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"ÊÖ¢ÊÄßË≤†Ëç∑"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:y.chronicLoad})]})]}),p&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:"ÊúÄÁµÇË®òÈå≤"}),e.jsx("span",{children:new Date(p.date).toLocaleDateString("ja-JP")})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Le,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})]})]}),e.jsxs("div",{onClick:()=>j("weight"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg",children:e.jsx(Ve,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"‰ΩìÈáçÁÆ°ÁêÜ"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Weight Tracking"})]})]}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:Number(v.weight_kg).toFixed(1)}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"kg"})]}),m&&e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[m.isUp?e.jsx(Ke,{className:"w-4 h-4 text-red-500"}):e.jsx(ar,{className:"w-4 h-4 text-blue-500"}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["ÂâçÂõûÊØî ",m.isUp?"+":"",m.value.toFixed(1),"kg"]})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-xs text-green-700 dark:text-green-400 mb-1",children:"30Êó•Èñì„ÅÆÂ§âÂåñ"}),e.jsx("p",{className:"text-lg font-bold text-green-800 dark:text-green-300",children:z!==null?`${z.toFixed(1)}kg`:"-"})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:"ÊúÄÁµÇË®òÈå≤"}),e.jsx("span",{children:new Date(v.date).toLocaleDateString("ja-JP")})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ve,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})]})]}),e.jsxs("div",{onClick:()=>j("conditioning"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg",children:e.jsx(et,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sleep & Wellness"})]})]}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),N&&w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Áù°Áú†ÊôÇÈñì"}),e.jsxs("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[Number(N.sleep_hours).toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Áù°Áú†„ÅÆË≥™"}),e.jsxs("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[N.sleep_quality,"/10"]})]})]}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"ÊÑèÊ¨≤"}),e.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:w.motivation_level})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"Ê¥ªÂäõ"}),e.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:w.energy_level})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"„Çπ„Éà„É¨„Çπ"}),e.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:w.stress_level})]})]})}),b&&e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["ÈÄ±Âπ≥ÂùáÁù°Áú†: ",b.toFixed(1),"ÊôÇÈñì"]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:"ÊúÄÁµÇË®òÈå≤"}),e.jsx("span",{children:new Date(N.date).toLocaleDateString("ja-JP")})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(et,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})]})]}),F&&e.jsxs("div",{onClick:()=>j("cycle"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`${M?A(M.phase):"bg-pink-100 dark:bg-pink-900/30"} p-3 rounded-lg`,children:e.jsx(Bt,{className:`w-6 h-6 ${M?R(M.phase):"text-pink-600 dark:text-pink-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ÊúàÁµåÂë®Êúü"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Menstrual Cycle"})]})]}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),M?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-baseline space-x-2",children:e.jsx("span",{className:`text-2xl font-bold ${R(M.phase)}`,children:C(M.phase)})}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Âë®ÊúüÈñãÂßã„Åã„Çâ",M.daysSinceStart+1,"Êó•ÁõÆ"]})]}),e.jsxs("div",{className:`${A(M.phase)} rounded-lg p-3 mb-3`,children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"„Éà„É¨„Éº„Éã„É≥„Ç∞Êé®Â•®"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:T(M.phase)})]}),k&&e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-pink-700 dark:text-pink-400 mb-1",children:"Ê¨°Âõû‰∫àÊ∏¨Êó•"}),e.jsx("p",{className:"text-lg font-bold text-pink-800 dark:text-pink-300",children:k.toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}),e.jsxs("p",{className:"text-xs text-pink-600 dark:text-pink-400 mt-1",children:[Math.ceil((k.getTime()-new Date().getTime())/(1e3*60*60*24)),"Êó•Âæå"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Bt,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Âë®Êúü„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"ÊúàÁµåÂë®Êúü„ÇíË®òÈå≤„Åó„Å¶„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíÊúÄÈÅ©Âåñ"})]})]})]}),e.jsxs("button",{onClick:x,className:"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl p-4 flex items-center justify-center space-x-2 font-medium transition-colors shadow-lg",children:[e.jsx(It,{className:"w-5 h-5"}),e.jsx("span",{children:"‰ªäÊó•„ÅÆË®òÈå≤„ÇíËøΩÂä†"})]})]})}function Ni({acwrData:t,weightRecords:s,sleepRecords:r,motivationRecords:n}){const[l,i]=a.useState({acwr:!0,weight:!0,sleep:!0,motivation:!0,energy:!1}),[c,j]=a.useState("30d"),x=h=>{const f=new Date().getTime()+9*60*60*1e3,d=new Date(f);return d.setUTCDate(d.getUTCDate()-h),Zs(d)},y=h=>h>=x(c==="7d"?7:c==="30d"?30:90),N=(()=>{const h=new Map;return t.filter(u=>y(u.date)).forEach(u=>{h.has(u.date)||h.set(u.date,{date:u.date}),h.get(u.date).acwr=u.acwr,h.get(u.date).acuteLoad=u.acuteLoad}),s.filter(u=>y(u.date)).forEach(u=>{h.has(u.date)||h.set(u.date,{date:u.date}),h.get(u.date).weight=Number(u.weight_kg)}),r.filter(u=>y(u.date)).forEach(u=>{h.has(u.date)||h.set(u.date,{date:u.date}),h.get(u.date).sleep=Number(u.sleep_hours),h.get(u.date).sleepQuality=u.sleep_quality}),n.filter(u=>y(u.date)).forEach(u=>{h.has(u.date)||h.set(u.date,{date:u.date}),h.get(u.date).motivation=u.motivation_level,h.get(u.date).energy=u.energy_level,h.get(u.date).stress=u.stress_level}),Array.from(h.values()).sort((u,f)=>u.date.localeCompare(f.date))})(),w=h=>{i(u=>({...u,[h]:!u[h]}))},p=({active:h,payload:u,label:f})=>!h||!u||!u.length?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:new Date(f).toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}),e.jsx("div",{className:"space-y-1",children:u.map(d=>e.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[e.jsxs("span",{className:"text-sm",style:{color:d.color},children:[d.name,":"]}),e.jsxs("span",{className:"font-semibold text-sm",style:{color:d.color},children:[d.value!==void 0?d.value.toFixed(1):"-",d.dataKey==="weight"&&"kg",(d.dataKey==="sleep"||d.dataKey==="sleepHours")&&"h"]})]},d.dataKey))})]});return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:"Áµ±Âêà„Çø„Ç§„É†„É©„Ç§„É≥"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"„Åô„Åπ„Å¶„ÅÆÊåáÊ®ô„ÇíÊôÇÁ≥ªÂàó„ÅßË°®Á§∫"})]}),e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>j("7d"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${c==="7d"?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"7Êó•"}),e.jsx("button",{onClick:()=>j("30d"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${c==="30d"?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"30Êó•"}),e.jsx("button",{onClick:()=>j("90d"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${c==="90d"?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"90Êó•"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>w("acwr"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${l.acwr?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-2 border-blue-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"}`,children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"ACWR"})]}),e.jsxs("button",{onClick:()=>w("weight"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${l.weight?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-2 border-green-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"}`,children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:"‰ΩìÈáç"})]}),e.jsxs("button",{onClick:()=>w("sleep"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${l.sleep?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 border-2 border-purple-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"}`,children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsx("span",{children:"Áù°Áú†ÊôÇÈñì"})]}),e.jsxs("button",{onClick:()=>w("motivation"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${l.motivation?"bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-400 border-2 border-pink-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥"})]}),e.jsxs("button",{onClick:()=>w("energy"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${l.energy?"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 border-2 border-orange-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"}`,children:[e.jsx(Ut,{className:"w-4 h-4"}),e.jsx("span",{children:"„Ç®„Éç„É´„ÇÆ„Éº"})]})]}),N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-500 dark:text-gray-400",children:[e.jsx(Le,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{children:"ÈÅ∏Êäû„Åó„ÅüÊúüÈñì„Å´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})]}):e.jsx(Je,{width:"100%",height:400,children:e.jsxs(St,{data:N,children:[e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),e.jsx(Ge,{dataKey:"date",tickFormatter:h=>{const u=new Date(h);return`${u.getMonth()+1}/${u.getDate()}`},stroke:"#9CA3AF",style:{fontSize:"12px"}}),e.jsx(De,{stroke:"#9CA3AF",style:{fontSize:"12px"}}),e.jsx(Ze,{content:e.jsx(p,{})}),e.jsx(lt,{wrapperStyle:{fontSize:"12px"},iconType:"line"}),l.acwr&&e.jsx(fe,{type:"monotone",dataKey:"acwr",name:"ACWR",stroke:"#3B82F6",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),l.weight&&e.jsx(fe,{type:"monotone",dataKey:"weight",name:"‰ΩìÈáç (kg)",stroke:"#10B981",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),l.sleep&&e.jsx(fe,{type:"monotone",dataKey:"sleep",name:"Áù°Áú† (h)",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),l.motivation&&e.jsx(fe,{type:"monotone",dataKey:"motivation",name:"ÊÑèÊ¨≤",stroke:"#EC4899",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),l.energy&&e.jsx(fe,{type:"monotone",dataKey:"energy",name:"Ê¥ªÂäõ",stroke:"#F59E0B",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-400 mb-1",children:"Ë®òÈå≤Êï∞"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-300",children:N.length}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Êó•ÂàÜ"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-700 dark:text-green-400 mb-1",children:"Âπ≥ÂùáACWR"}),e.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-300",children:N.filter(h=>h.acwr).length>0?(N.reduce((h,u)=>h+(u.acwr||0),0)/N.filter(h=>h.acwr).length).toFixed(2):"-"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"Âπ≥ÂùáÁù°Áú†"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-300",children:N.filter(h=>h.sleep).length>0?(N.reduce((h,u)=>h+(u.sleep||0),0)/N.filter(h=>h.sleep).length).toFixed(1):"-"}),e.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:"ÊôÇÈñì"})]}),e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-pink-700 dark:text-pink-400 mb-1",children:"Âπ≥ÂùáÊÑèÊ¨≤"}),e.jsx("p",{className:"text-2xl font-bold text-pink-900 dark:text-pink-300",children:N.filter(h=>h.motivation).length>0?(N.reduce((h,u)=>h+(u.motivation||0),0)/N.filter(h=>h.motivation).length).toFixed(1):"-"}),e.jsx("p",{className:"text-xs text-pink-600 dark:text-pink-400",children:"/10"})]})]})]})}function ki({onClick:t,onCameraClick:s}){return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex items-center gap-3",children:[s&&e.jsx("button",{type:"button",onClick:s,className:`h-14 w-14 rounded-full shadow-lg
                     bg-blue-600 text-white
                     flex items-center justify-center
                     active:scale-95 transition`,"aria-label":"È£ü‰∫ã„ÇíÊíÆÂΩ±„ÉªÈÅ∏Êäû",children:e.jsx(el,{className:"w-6 h-6"})}),e.jsx("button",{type:"button",onClick:t,className:`h-14 w-14 rounded-full shadow-lg
                   bg-blue-600 text-white
                   flex items-center justify-center
                   active:scale-95 transition`,"aria-label":"‰ªäÊó•„ÅÆË®òÈå≤„ÇíËøΩÂä†",children:e.jsx(It,{className:"w-7 h-7"})})]})}function _i(){const t=new Date;return new Date(t.getTime()+9*60*60*1e3).toISOString().slice(0,10)}function Si(){const t=new Date,s=new Date(t.getTime()+9*60*60*1e3);return s.setDate(s.getDate()-1),s.toISOString().slice(0,10)}function Ci(t=0){const s=new Date,r=new Date(s.getTime()+9*60*60*1e3),l=(r.getDay()+6)%7;return r.setDate(r.getDate()-l+t*7),r.setHours(0,0,0,0),r.toISOString().slice(0,10)}function ba(t,s){const r=new Date(t+"T00:00:00.000Z");return r.setUTCDate(r.getUTCDate()+s),r.toISOString().slice(0,10)}function fr(t){if(!t)return[];const s=t.next_action_items??[];return Array.isArray(s)&&s.length>0?s:t.next_action&&t.next_action.trim()?[{text:t.next_action.trim(),done:!1,done_at:null}]:[]}const Mi=["Ê†ÑÈ§ä","Áù°Áú†","‰ΩìË™ø","Áñ≤Âä¥","Áóõ„Åø","„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑","Ë©¶Âêà„ÉªÈÄ£Êà¶","ÁßªÂãï","Áî®ÂÖ∑","„É°„É≥„Çø„É´","ÈõÜ‰∏≠","„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥","ÊôÇÈñìÁÆ°ÁêÜ","Â≠¶Ê•≠","‰∫∫ÈñìÈñ¢‰øÇ","Áí∞Â¢É","„É´„Éº„ÉÜ„Ç£„É≥"];function Di({userId:t}){const s=a.useMemo(()=>_i(),[]),r=a.useMemo(()=>Si(),[]),[n,l]=a.useState(0),i=a.useMemo(()=>Ci(n),[n]),c=a.useMemo(()=>ba(i,6),[i]),[j,x]=a.useState(!0),[y,v]=a.useState(null),[N,w]=a.useState(null),[p,h]=a.useState([]),[u,f]=a.useState(!1),[d,o]=a.useState([]),[g,m]=a.useState([{text:"",done:!1,done_at:null}]),[b,_]=a.useState(""),[S,C]=a.useState(""),[R,A]=a.useState([]),[T,M]=a.useState(""),[k,F]=a.useState(!1),[O,z]=a.useState(!1);a.useEffect(()=>{if(!t)return;(async()=>{x(!0);try{const{data:U,error:Z}=await L.from("reflections").select("*").eq("user_id",t).in("reflection_date",[s,r]);if(Z)throw Z;const Y=(U||[]).find(V=>V.reflection_date===s)??null,ee=(U||[]).find(V=>V.reflection_date===r)??null;v(Y),w(ee);const ae=fr(ee);if(o(ae),Y){_(Y.did??""),C(Y.didnt??""),A(Y.cause_tags??[]),M(Y.free_note??"");const V=fr(Y);m(V.length?V:[{text:"",done:!1,done_at:null}])}else m([{text:"",done:!1,done_at:null}])}catch(U){console.error("Failed to load reflections (daily):",U)}finally{x(!1)}})()},[t,s,r]),a.useEffect(()=>{if(!t)return;(async()=>{f(!0);try{const U=ba(i,7),{data:Z,error:Y}=await L.from("reflections").select("id, user_id, reflection_date, did, didnt, cause_tags, next_action_items").eq("user_id",t).gte("reflection_date",i).lt("reflection_date",U).order("reflection_date",{ascending:!0});if(Y)throw Y;h(Z||[])}catch(U){console.error("Failed to load reflections (week):",U)}finally{f(!1)}})()},[t,i]);const P=a.useMemo(()=>{const W=p.filter(I=>(I.did??"").trim().length>0).length,U=p.filter(I=>(I.didnt??"").trim().length>0).length,Z={};p.forEach(I=>{(I.cause_tags??[]).forEach(J=>{const G=(J??"").trim();G&&(Z[G]=(Z[G]??0)+1)})});const Y=Object.entries(Z).sort((I,J)=>J[1]-I[1]).slice(0,3);let ee=0,ae=0;const V={};p.forEach(I=>{(I.next_action_items??[]).forEach(G=>{const ne=((G==null?void 0:G.text)??"").trim();ne&&(ee+=1,G.done&&(ae+=1),V[ne]=V[ne]??{total:0,done:0},V[ne].total+=1,G.done&&(V[ne].done+=1))})});const te=ee?Math.round(ae/ee*100):0,se=Object.entries(V).map(([I,J])=>({text:I,total:J.total,done:J.done,rate:J.total?Math.round(J.done/J.total*100):0})).sort((I,J)=>J.total-I.total).slice(0,3);return{didCount:W,didntCount:U,topTags:Y,goals:ee,done:ae,completionRate:te,topGoals:se,days:p.length}},[p]),$=async W=>{var ae;if(!N)return;const U=[...d],Z=U[W];if(!Z)return;const Y=new Date().toISOString(),ee={...Z,done:!Z.done,done_at:Z.done?null:Y};U[W]=ee,o(U),F(!0);try{const{error:V}=await L.from("reflections").update({next_action_items:U,next_action:((ae=U[0])==null?void 0:ae.text)??null,updated_at:new Date().toISOString()}).eq("id",N.id);if(V)throw V;w(te=>{var se;return te&&{...te,next_action_items:U,next_action:((se=U[0])==null?void 0:se.text)??null}}),h(te=>te.map(se=>se.id===N.id?{...se,next_action_items:U}:se))}catch(V){console.error("Failed to save todo:",V),o(fr(N))}finally{F(!1)}},q=()=>{m(W=>[...W,{text:"",done:!1,done_at:null}])},E=W=>{m(U=>{const Z=U.filter((Y,ee)=>ee!==W);return Z.length?Z:[{text:"",done:!1,done_at:null}]})},D=(W,U)=>{m(Z=>{const Y=[...Z];return Y[W]={...Y[W],text:U},Y})},B=W=>{A(U=>U.includes(W)?U.filter(Z=>Z!==W):[...U,W])},H=async()=>{var W;if(t){z(!0);try{const U=g.map(Y=>({...Y,text:(Y.text??"").trim()})).filter(Y=>Y.text.length>0),Z={user_id:t,reflection_date:s,did:b.trim(),didnt:S.trim(),cause_tags:R,free_note:T.trim(),next_action_items:U,next_action:((W=U[0])==null?void 0:W.text)??null,metadata:{source:"daily_reflection_card"},updated_at:new Date().toISOString()};if(y!=null&&y.id){const{error:Y}=await L.from("reflections").update(Z).eq("id",y.id);if(Y)throw Y;v(ee=>ee&&{...ee,...Z}),h(ee=>ee.map(ae=>ae.id===y.id?{...ae,...Z}:ae))}else{const{data:Y,error:ee}=await L.from("reflections").insert(Z).select("*").single();if(ee)throw ee;v(Y),s>=i&&s<=c&&h(ae=>{const V={id:Y.id,user_id:Y.user_id,reflection_date:Y.reflection_date,did:Y.did,didnt:Y.didnt,cause_tags:Y.cause_tags??Z.cause_tags,next_action_items:Y.next_action_items??Z.next_action_items};return[...ae.filter(se=>se.id!==V.id),V].sort((se,I)=>se.reflection_date.localeCompare(I.reflection_date))})}}catch(U){console.error("Failed to save reflection:",U)}finally{z(!1)}}};return j?e.jsx("div",{className:"rounded-xl p-6 shadow-sm bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."}):e.jsxs("div",{className:"rounded-xl p-6 shadow-sm space-y-6 bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100",children:[e.jsxs("div",{className:`rounded-lg border p-4
        border-amber-200 bg-amber-50 text-amber-950
        dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-100
      `,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"ÈÄ±„ÅÆÂÇæÂêë"}),e.jsxs("div",{className:"text-xs mt-1 text-amber-800 dark:text-amber-200/80",children:[i," „Äú ",c,"Ôºà",P.days,"Êó•ÂàÜÔºâ",u&&e.jsx("span",{className:"ml-2",children:"Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l(W=>W-1),className:`
                text-xs px-3 py-1 rounded-lg border
                border-amber-300 bg-white hover:bg-amber-100
                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800
              `,children:"Ôºú ÂÖàÈÄ±"}),e.jsx("button",{type:"button",onClick:()=>l(0),disabled:n===0,className:`
                text-xs px-3 py-1 rounded-lg border
                border-amber-300 bg-white hover:bg-amber-100 disabled:opacity-50
                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800
              `,children:"‰ªäÈÄ±„Å∏Êàª„Çã"})]})]}),e.jsxs("div",{className:"mt-3 text-sm",children:["„Åß„Åç„ÅüÔºö",P.didCount,"‰ª∂ Ôºè „Åß„Åç„Å™„Åã„Å£„ÅüÔºö",P.didntCount,"‰ª∂"]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Ë°åÂãïÁõÆÊ®ôÔºö",P.goals,"‰ª∂ Ôºè ÂÆå‰∫ÜÔºö",P.done,"‰ª∂Ôºà",P.completionRate,"%Ôºâ"]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200/80",children:"ÂéüÂõ†„Çø„Ç∞ TOP3"}),P.topTags.length===0?e.jsx("div",{className:"text-sm text-amber-800 dark:text-amber-200/80",children:"„Åæ„Å†ÂéüÂõ†„Çø„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}):e.jsx("div",{className:"flex flex-wrap gap-2",children:P.topTags.map(([W,U])=>e.jsxs("span",{className:`
                    px-3 py-1 rounded-full text-xs border
                    border-amber-200 bg-white text-amber-950
                    dark:border-amber-900/60 dark:bg-gray-950 dark:text-amber-100
                  `,children:[W,"Ôºö",U]},W))})]}),P.topGoals.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200/80",children:"„Çà„ÅèÁ´ã„Å¶„ÇãË°åÂãïÁõÆÊ®ô TOP3"}),P.topGoals.map(W=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm flex-1",children:W.text}),e.jsxs("div",{className:"text-xs text-amber-800 dark:text-amber-200/80 w-28 text-right",children:[W.done,"/",W.total,"Ôºà",W.rate,"%Ôºâ"]})]},W.text))]})]}),e.jsxs("div",{className:`rounded-lg border p-4
        border-blue-200 bg-blue-50 text-blue-950
        dark:border-blue-900/40 dark:bg-blue-950/30 dark:text-blue-100
      `,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"‰ªäÊó•„ÅÆ„ÇÑ„Çã„Åì„Å®ÔºàÊò®Êó•„ÅÆÁõÆÊ®ôÔºâ"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-200/80",children:[r," „Å´Ë®≠ÂÆö"]})]}),d.length===0?e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200/80 mt-2",children:"Êò®Êó•„ÅÆ„ÄåË°åÂãïÁõÆÊ®ô„Äç„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊò®Êó•„ÅÆÊåØ„ÇäËøî„Çä„ÅßË°åÂãïÁõÆÊ®ô„ÇíËøΩÂä†„Åô„Çã„Å®„ÄÅ„Åì„Åì„Å´Âá∫„Åæ„Åô„ÄÇ"}):e.jsxs("div",{className:"mt-3 space-y-2",children:[d.map((W,U)=>e.jsxs("label",{className:`
                  flex items-center gap-3 rounded-lg px-3 py-2 border
                  bg-white border-blue-200
                  dark:bg-gray-950 dark:border-blue-900/50
                `,children:[e.jsx("input",{type:"checkbox",checked:!!W.done,onChange:()=>$(U),disabled:k,className:"h-4 w-4 accent-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-sm ${W.done?"line-through text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"}`,children:W.text}),W.done_at&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ÂÆå‰∫Ü: ",new Date(W.done_at).toLocaleString("ja-JP")]})]}),W.done&&e.jsx(Ne,{className:"h-4 w-4 text-green-600"})]},U)),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-200/80 mt-2",children:k?"‰øùÂ≠ò‰∏≠‚Ä¶":"„ÉÅ„Çß„ÉÉ„ÇØ„Åô„Çã„Å®Âç≥‰øùÂ≠ò„Åï„Çå„Åæ„ÅôÔºàÂÆå‰∫Ü‰øùÂ≠òÔºâ"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"‰ªäÊó•„ÅÆÊåØ„ÇäËøî„Çä"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"„Åß„Åç„Åü„Åì„Å®"}),e.jsx("input",{value:b,onChange:W=>_(W.target.value),className:`
              w-full border rounded-lg px-3 py-2
              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400
              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500
              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500
              dark:focus:ring-green-500 dark:focus:border-green-500
            `,placeholder:"‰æãÔºöÂº∑Â∫¶È´ò„ÇÅ„ÅÆÁ∑¥Áøí„ÇíÊúÄÂæå„Åæ„Åß„ÇÑ„ÇäÂàá„Çå„Åü"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"„Åß„Åç„Å™„Åã„Å£„Åü„Åì„Å®"}),e.jsx("input",{value:S,onChange:W=>C(W.target.value),className:`
              w-full border rounded-lg px-3 py-2
              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400
              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500
              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500
              dark:focus:ring-green-500 dark:focus:border-green-500
            `,placeholder:"‰æãÔºöÁù°Áú†ÊôÇÈñì„ÇíÁ¢∫‰øù„Åß„Åç„Å™„Åã„Å£„Åü"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ÂéüÂõ†„Çø„Ç∞"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Mi.map(W=>{const U=R.includes(W);return e.jsx("button",{type:"button",onClick:()=>B(W),className:`
                    px-3 py-1 rounded-full text-xs border transition
                    ${U?"bg-gray-900 text-white border-gray-900":"bg-slate-100 text-slate-800 border-slate-200 hover:bg-slate-200"}
                    dark:${U?"bg-green-600 text-white border-green-600":"bg-slate-700 text-slate-100 border-slate-600 hover:bg-slate-600"}
                  `,children:W},W)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"„Äå„Åß„Åç„Å™„Åã„Å£„Åü„Äç„ÅÆ‰∏ªÂõ†„Çí‰ªÆË™¨„ÅßOK„ÄÇÈÄ±„ÅÆÂÇæÂêë„Å´ÈõÜË®à„Åï„Çå„Åæ„Åô„ÄÇ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"„É°„É¢"}),e.jsx("textarea",{value:T,onChange:W=>M(W.target.value),className:`
              w-full border rounded-lg px-3 py-2
              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400
              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500
              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500
              dark:focus:ring-green-500 dark:focus:border-green-500
            `,rows:3,placeholder:"Ëá™Áî±„É°„É¢"})]}),e.jsxs("div",{className:"rounded-lg border p-4 border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:"ÊòéÊó•„ÅÆË°åÂãïÁõÆÊ®ôÔºàË§áÊï∞Ôºâ"}),e.jsxs("button",{type:"button",onClick:q,className:`
                text-sm px-3 py-1 rounded-lg flex items-center gap-2
                bg-gray-900 text-white hover:bg-gray-800
                dark:bg-green-600 dark:hover:bg-green-700
              `,children:[e.jsx(It,{className:"h-4 w-4"}),"ËøΩÂä†"]})]}),e.jsx("div",{className:"mt-3 space-y-2",children:g.map((W,U)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:W.text,onChange:Z=>D(U,Z.target.value),className:`
                    flex-1 border rounded-lg px-3 py-2
                    bg-white text-gray-900 border-gray-300 placeholder:text-gray-400
                    focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500
                    dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500
                    dark:focus:ring-green-500 dark:focus:border-green-500
                  `,placeholder:"‰æãÔºö„Çπ„Éà„É¨„ÉÉ„ÉÅ„Çí10ÂàÜÈñìË°å„ÅÜ"}),e.jsx("button",{type:"button",onClick:()=>E(U),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",title:"ÂâäÈô§",children:e.jsx(ht,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"})})]},U))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"„Åì„Åì„ÅßË®≠ÂÆö„Åó„Åü„ÄåÊòéÊó•„ÅÆË°åÂãïÁõÆÊ®ô„Äç„ÅØ„ÄÅÁøåÊó•„ÅÆ„Ç´„Éº„Éâ‰∏äÈÉ®„Å´‚Äú‰ªäÊó•„ÅÆ„ÇÑ„Çã„Åì„Å®‚Äù„Å®„Åó„Å¶Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ"})]}),e.jsx("button",{onClick:H,disabled:O,className:`
            w-full rounded-lg px-4 py-3 font-medium
            bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50
            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
            dark:focus:ring-offset-gray-900
          `,children:O?"‰øùÂ≠ò‰∏≠‚Ä¶":"‰ªäÊó•„ÅÆÊåØ„ÇäËøî„Çä„Çí‰øùÂ≠ò"})]})]})}function fa({userId:t,highlight:s}){const[r,n]=a.useState(!1),[l,i]=a.useState(""),[c,j]=a.useState(!1),[x,y]=a.useState(!1),[v,N]=a.useState(!1),w=a.useMemo(()=>c&&!x,[c,x]),p=()=>{n(!1),N(!1),i(""),j(!1)},h=async()=>{if(w){y(!0);try{const{error:u}=await L.from("shared_reports").insert({user_id:t,note:l.trim()?l.trim():null});if(u)throw u;N(!0),setTimeout(()=>{p()},900)}catch(u){console.error("[ShareStatusButton] insert failed:",u),alert("ÂÖ±Êúâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÈÄö‰ø°Áä∂Ê≥Å„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ")}finally{y(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>n(!0),className:["w-full rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-colors","border",s?"bg-blue-600 text-white border-blue-600 hover:bg-blue-700 active:bg-blue-800":"bg-white dark:bg-gray-900 text-gray-900 dark:text-white border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/60 active:bg-gray-100 dark:active:bg-gray-800"].join(" "),children:[e.jsx(Nl,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Áä∂ÊÖã„Çí„Çπ„Çø„ÉÉ„Éï„Å´ÂÖ±Êúâ„Åô„Çã"})]}),r&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>!x&&n(!1)}),e.jsxs("div",{className:"absolute left-1/2 top-1/2 w-[92vw] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-2xl bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:"ÂÖ±ÊúâÂÜÖÂÆπ„ÅÆÁ¢∫Ë™ç"}),e.jsx("button",{type:"button",onClick:()=>!x&&n(!1),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 active:bg-gray-200 dark:active:bg-white/15","aria-label":"Èñâ„Åò„Çã",children:e.jsx(Me,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-200 space-y-1",children:[e.jsx("p",{children:"„Çπ„Çø„ÉÉ„Éï„Å´‰ª•‰∏ã„ÅÆÊÉÖÂ†±„ÅåÂÖ±Êúâ„Åï„Çå„Åæ„ÅôÔºö"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Áõ¥Ëøë„ÅÆÁ∑¥ÁøíË≤†Ëç∑ÔºàsRPE / ACWRÔºâ"}),e.jsx("li",{children:"ÊúÄËøë„ÅÆ‰ΩìÈáç„Éª„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥"}),e.jsx("li",{children:"ÁèæÂú®Âá∫„Å¶„ÅÑ„Çã„Ç¢„É©„Éº„Éà"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"‚ÄªË®òÈå≤„Éá„Éº„ÇøËá™‰Ωì„ÅØ‰øùÂ≠ò„Åõ„Åö„ÄÅÂÖ±Êúâ„É≠„Ç∞„ÅÆ„ÅøÊÆã„Åó„Åæ„Åô„ÄÇ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),e.jsx("textarea",{value:l,onChange:u=>i(u.target.value),rows:3,className:"w-full rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 text-gray-900 dark:text-white px-3 py-2 text-sm placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/60",placeholder:"‰æãÔºöËÜù„Å´ÈÅïÂíåÊÑü„ÄÅÁù°Áú†„ÅåÊµÖ„ÅÑ„ÄÅ‰ªäÊó•„ÅØ„ÇÑ„ÇäÂàá„Çå„Å™„ÅÑÊÑü„Åò „Å™„Å©"})]}),e.jsxs("button",{type:"button",onClick:()=>j(u=>!u),className:["w-full text-left rounded-xl border px-3 py-3 transition","flex items-start gap-3",c?"border-blue-500/60 bg-blue-50 dark:bg-blue-500/10":"border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10"].join(" "),"aria-pressed":c,children:[e.jsx("span",{className:["mt-0.5 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 transition",c?"bg-blue-600 border-blue-600":"bg-transparent border-gray-400/60 dark:border-gray-300/40"].join(" "),children:c&&e.jsx(Xt,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["ÂÖ±Êúâ„Åô„ÇãÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Åü"," ",e.jsx("span",{className:"text-xs text-amber-700 dark:text-amber-300",children:"ÔºàÂøÖÈ†àÔºâ"})]}),!c&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:"„Åì„Åì„Çí„Çø„ÉÉ„Éó„Åó„Å¶Á¢∫Ë™ç„Åô„Çã„Å®„ÄåÂÖ±Êúâ„Åô„Çã„Äç„Éú„Çø„É≥„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åô"})]})]}),!c&&!v&&e.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-700 dark:text-amber-300",children:[e.jsx(ge,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:"ÂÖ±Êúâ„Åô„Çã„Å´„ÅØ„ÄåÂÖ±ÊúâÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„ÅüÔºàÂøÖÈ†àÔºâ„Äç„ÇíON„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]}),e.jsx("button",{type:"button",onClick:h,disabled:!w,className:["w-full rounded-xl px-4 py-3 font-semibold transition-colors",w?"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800":"bg-gray-200 text-gray-500 dark:bg-white/10 dark:text-white/40 cursor-not-allowed"].join(" "),children:v?"ÂÖ±Êúâ„Åó„Åæ„Åó„Åü":x?"ÈÄÅ‰ø°‰∏≠...":"ÂÖ±Êúâ„Åô„Çã"}),v&&e.jsx("div",{className:"text-center text-sm text-gray-700 dark:text-gray-200",children:"„Çπ„Çø„ÉÉ„Éï„Å´ÂÖ±Êúâ„Åó„Åæ„Åó„Åü„ÄÇÁä∂ÊÖã„Çí‰ºù„Åà„Çã„Åì„Å®„ÅØ„ÄÅ„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÇíÂÆà„ÇãË°åÂãï„Åß„Åô„ÄÇ"})]})]})]})]})}function Rr(t){return typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)}function nn(t){if(!Rr(t))return null;const s=new Date(t).getTime();return Number.isFinite(s)?s:null}function qs(t){let s=null,r=-1/0;for(const n of t){const l=nn(n==null?void 0:n.date);l!==null&&(!s||l>r)&&(s=n,r=l)}return s}function Ti(t){const s=t.trainingRecords??[],r=t.weightRecords??[],n=t.sleepRecords??[],l=t.motivationRecords??[],i=a.useMemo(()=>qs(s),[s]),c=a.useMemo(()=>qs(r),[r]),j=a.useMemo(()=>qs(n),[n]),x=a.useMemo(()=>qs(l),[l]),y=a.useMemo(()=>{const w=new Set;for(const p of s)Rr(p==null?void 0:p.date)&&w.add(p.date);return w.size},[s]),v=a.useMemo(()=>{const w=new Set;for(const o of s)Rr(o==null?void 0:o.date)&&w.add(o.date);if(w.size===0)return 0;const p=new Date;p.setHours(0,0,0,0);const h=new Date(p),u=aa(h);w.has(u)||h.setDate(h.getDate()-1);let f=0;const d=new Date(h);for(let o=0;o<365;o++){const g=aa(d);if(w.has(g))f++,d.setDate(d.getDate()-1);else break}return f},[s]),N=a.useMemo(()=>{if(!s.length)return null;const w=new Date;w.setDate(w.getDate()-7);const p=w.getTime();let h=0,u=0,f=0,d=0;for(const o of s){const g=nn(o==null?void 0:o.date);g!==null&&(g<p||(h++,u+=Number.isFinite(Number(o.rpe))?Number(o.rpe):0,f+=Number.isFinite(Number(o.duration_min))?Number(o.duration_min):0,d+=Number.isFinite(Number(o.load))?Number(o.load):0))}return h===0?null:{rpe:u/h,duration:f/h,load:d/h}},[s]);return{lastTrainingRecord:i,lastWeightRecord:c,lastSleepRecord:j,lastMotivationRecord:x,daysWithTrainingData:y,consecutiveTrainingDays:v,weeklyAverage:N}}function Ei(t){const{daysWithData:s,consecutiveDays:r,weeklyAverage:n}=t;return e.jsxs("div",{className:"mb-3 rounded-lg bg-gray-50 dark:bg-gray-700/40 px-3 py-2 text-xs text-gray-600 dark:text-gray-300",children:["Ë®òÈå≤Êó•Êï∞: ",e.jsx("span",{className:"font-semibold",children:s})," Ôºè ÈÄ£Á∂ö: ",e.jsx("span",{className:"font-semibold",children:r}),n&&e.jsxs(e.Fragment,{children:[" ","Ôºè 7Êó•Âπ≥ÂùáRPE:"," ",e.jsx("span",{className:"font-semibold",children:n.rpe.toFixed(1)})," ","Âπ≥ÂùáÊôÇÈñì:"," ",e.jsxs("span",{className:"font-semibold",children:[n.duration.toFixed(0),"ÂàÜ"]})]})]})}function pa(t){return typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)}function lr(t){if(pa(t))return t;if(t instanceof Date&&!isNaN(t.getTime()))return t.toISOString().slice(0,10);if(typeof t=="string"){const s=t.match(/^(\d{4}-\d{2}-\d{2})/);if(s!=null&&s[1]&&pa(s[1]))return s[1]}return null}function kt(t){if(t==null||t==="")return null;const s=typeof t=="number"?t:Number(t);return Number.isFinite(s)?s:null}function Ai(t){const s=kt(t);return s===null?null:Math.round(s)}function Ri(t){if(!t)return null;const s=lr(t.date);return s?{id:typeof t.id=="string"?t.id:void 0,date:s,rpe:kt(t.rpe),duration_min:Ai(t.duration_min??t.duration_time??t.duration),arrow_score:kt(t.arrow_score),signal_score:kt(t.signal_score)}:null}function $i(t){return t?{...t}:null}function Fi(t){if(!t)return null;const s=lr(t.date);return s?{id:typeof t.id=="string"?t.id:void 0,date:s,sleep_hours:kt(t.sleep_hours),sleep_quality:kt(t.sleep_quality)}:null}function Li(t){if(!t)return null;const s=lr(t.date);if(!s)return null;const r=kt(t.motivation_level??t.motivation);return{id:typeof t.id=="string"?t.id:void 0,date:s,motivation_level:r,energy_level:kt(t.energy_level),stress_level:kt(t.stress_level),notes:t.notes??null}}const pr=(t,s,r)=>Math.min(r,Math.max(s,t));function Pi(t,s={}){const r=Li(t);if(!r)return null;const n=pr(r.motivation_level??s.motivation??5,1,10),l=pr(r.energy_level??s.energy??5,1,10),i=pr(r.stress_level??s.stress??5,1,10);return{date:r.date,motivation_level:n,energy_level:l,stress_level:i,notes:r.notes??null}}function qi(t){if(!t)return null;const s=lr(t.date);return s?{id:typeof t.id=="string"?t.id:void 0,date:s,weight_kg:kt(t.weight_kg)}:null}function zi({lastTrainingRecord:t,lastWeightRecord:s,lastSleepRecord:r,lastMotivationRecord:n}){const l=t?Ri(t):null,i=l?$i(l):null,c=s?qi(s):null,j=r?Fi(r):null,x=n?Pi(n):null;return{normalizedLastTrainingRecord:l,normalizedLastTrainingRecordForCheckIn:i,normalizedLastWeightRecord:c,normalizedLastSleepRecord:j,normalizedLastMotivationRecord:x}}function yr(t){if(t==null)return null;const s=Number(t);return Number.isFinite(s)?s:null}function ya(t){const s=String(t||"").trim();if(!s)return 0;const r=s.includes("T")?s:s.replace(/\//g,"-"),l=new Date(r+(r.includes("T")?"":"T00:00:00")).getTime();return Number.isFinite(l)?l:0}function Oi(t,s){if(t==null||s==null)return null;const r=t*(s/100);return Number.isFinite(r)?r:null}function Bi(t,s){if(t==null||s==null)return null;const r=t-s;return Number.isFinite(r)?r:null}function Wi(t){const[s,r]=a.useState([]),[n,l]=a.useState(!1),[i,c]=a.useState(null),j=a.useMemo(()=>s.length===0?null:s.reduce((x,y)=>x?ya(y.measured_at)>ya(x.measured_at)?y:x:y,null),[s]);return a.useEffect(()=>{if(!t)return;let x=!1;return(async()=>{l(!0),c(null);try{const{data:y,error:v}=await L.from("inbody_records").select("id, measured_at, height, weight, body_fat_percent, user_id").eq("user_id",t).order("measured_at",{ascending:!0});if(v)throw v;if(x)return;const N=(y??[]).map(w=>{const p=yr(w.height),h=yr(w.weight),u=yr(w.body_fat_percent),f=Oi(h,u),d=Bi(h,f);return{id:w.id,measured_at:String(w.measured_at),height:p,weight:h,body_fat_percent:u,fat_mass:f,fat_free_mass:d}});r(N)}catch(y){console.error("[useInbodyData]",y),c((y==null?void 0:y.message)??"InBody„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),r([])}finally{x||l(!1)}})(),()=>{x=!0}},[t]),{records:s,latest:j,loading:n,error:i}}function Ii(t){const s=new Date(t+"T00:00:00");return Number.isNaN(s.getTime())?t:s.toLocaleDateString("ja-JP")}function Ui({latest:t,loading:s,error:r}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"InBodyÔºàÊúÄÊñ∞Ôºâ"}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),t!=null&&t.measured_at?Ii(t.measured_at):"‚Äî"]})]}),s?e.jsx("div",{className:"animate-pulse h-20 bg-gray-100 dark:bg-gray-700 rounded-lg"}):r?e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:r}):t?e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx(Ve,{className:"w-4 h-4 mr-1"})," ‰ΩìÈáç"]}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:t.weight!=null?`${t.weight.toFixed(1)} kg`:"‚Äî"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx(nl,{className:"w-4 h-4 mr-1"})," Èô§ËÑÇËÇ™Èáè"]}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:t.fat_free_mass!=null?`${t.fat_free_mass.toFixed(1)} kg`:"‚Äî"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx(Bt,{className:"w-4 h-4 mr-1"})," ‰ΩìËÑÇËÇ™Èáè"]}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:t.fat_mass!=null?`${t.fat_mass.toFixed(1)} kg`:"‚Äî"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx(yl,{className:"w-4 h-4 mr-1"})," ‰ΩìËÑÇËÇ™Áéá"]}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:t.body_fat_percent!=null?`${t.body_fat_percent.toFixed(1)} %`:"‚Äî"})]})]}):e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"InBody„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàCSVÂèñ„ÇäËæº„ÅøÂæå„Å´Ë°®Á§∫„Åï„Çå„Åæ„ÅôÔºâ"})]})}function ja(t){const s=String(t||"").trim();if(!s)return"";const r=s.includes("T")?s:s.replace(/\//g,"-"),n=new Date(r+(r.includes("T")?"":"T00:00:00"));return Number.isNaN(n.getTime())?s:n.toLocaleDateString("ja-JP")}function ln(t){if(t==null)return null;const s=Number(t);return!Number.isFinite(s)||s<=0?null:s/100}function Hi(t,s){const r=ln(s);if(t==null||r==null)return null;const n=t/(r*r);return Number.isFinite(n)?n:null}function Vi(t,s){const r=ln(s);if(t==null||r==null)return null;const n=t/(r*r);return Number.isFinite(n)?n:null}function wa(t){if(t==null)return null;const s=Math.round(t*100)/100;return Number.isFinite(s)?s:null}function zs(t){if(t==null)return null;const s=Math.round(t*10)/10;return Number.isFinite(s)?s:null}const Ki={general:{male:{bmi:{low:18.5,high:25},pbf:{low:12,high:20}},female:{bmi:{low:18.5,high:25},pbf:{low:20,high:30}}},athlete:{male:{bmi:{low:20,high:27},pbf:{low:8,high:15}},female:{bmi:{low:18,high:25},pbf:{low:18,high:25}}}};function Ji({records:t,gender:s}){const[r,n]=a.useState(!0),[l,i]=a.useState("general"),c=r&&(s==="male"||s==="female"),j=a.useMemo(()=>c?Ki[l][s]:null,[c,l,s]),x=a.useMemo(()=>{var p;const w=[...t??[]].sort((h,u)=>h.measured_at>u.measured_at?1:-1);for(let h=w.length-1;h>=0;h--){const u=(p=w[h])==null?void 0:p.height;if(u!=null&&Number.isFinite(u))return u}return null},[t]),y=a.useMemo(()=>[...t??[]].sort((p,h)=>p.measured_at>h.measured_at?1:-1).map(p=>{const h=p.height??x,u=p.weight??null,f=p.fat_free_mass??null,d=p.body_fat_percent??null,o=wa(Vi(f,h));return{date:p.measured_at,dateLabel:ja(p.measured_at),weight:zs(u),fat_free_mass:zs(f),body_fat_percent:zs(d),ffmi:o}}),[t,x]),v=a.useMemo(()=>[...t??[]].sort((p,h)=>p.measured_at>h.measured_at?1:-1).map((p,h)=>{const u=p.height??x,f=p.body_fat_percent??null,d=Hi(p.weight??null,u);return{idx:h,date:p.measured_at,dateLabel:ja(p.measured_at),pbf:zs(f),bmi:wa(d)}}).filter(p=>p.pbf!=null&&p.bmi!=null),[t,x]),N=y.some(w=>w.weight!=null||w.fat_free_mass!=null||w.body_fat_percent!=null||w.ffmi!=null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-4 gap-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"InBody Êé®ÁßªÔºàÂ∑¶Âè≥2Ëª∏Ôºâ"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Â∑¶Ôºö‰ΩìÈáç / Èô§ËÑÇËÇ™Èáè„ÄÄÂè≥Ôºö‰ΩìËÑÇËÇ™Áéá / FFMIÔºàÂè≥Ëª∏„ÅÆÊúÄÂ∞è„ÅØ0Ôºâ"})]})}),N?e.jsx("div",{className:"h-72 sm:h-80",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(St,{data:y,children:[e.jsx(Ye,{strokeDasharray:"3 3"}),e.jsx(Ge,{dataKey:"dateLabel",tick:{fontSize:12}}),e.jsx(De,{yAxisId:"left",tick:{fontSize:12},width:52,domain:["auto","auto"]}),e.jsx(De,{yAxisId:"right",orientation:"right",tick:{fontSize:12},width:52,domain:[0,"auto"]}),e.jsx(Ze,{formatter:(w,p)=>{const h=typeof w=="number"?w:null;return h==null?["‚Äî",p]:p==="weight"?[`${h.toFixed(1)} kg`,"‰ΩìÈáç"]:p==="fat_free_mass"?[`${h.toFixed(1)} kg`,"Èô§ËÑÇËÇ™Èáè"]:p==="body_fat_percent"?[`${h.toFixed(1)} %`,"‰ΩìËÑÇËÇ™Áéá"]:p==="ffmi"?[`${h.toFixed(2)}`,"FFMI"]:[String(w),p]},labelFormatter:w=>`Ê∏¨ÂÆöÊó•Ôºö${w}`}),e.jsx(lt,{}),e.jsx(fe,{type:"monotone",dataKey:"weight",name:"‰ΩìÈáç",yAxisId:"left",dot:{r:2},connectNulls:!0}),e.jsx(fe,{type:"monotone",dataKey:"fat_free_mass",name:"Èô§ËÑÇËÇ™Èáè",yAxisId:"left",dot:{r:2},connectNulls:!0}),e.jsx(fe,{type:"monotone",dataKey:"body_fat_percent",name:"‰ΩìËÑÇËÇ™Áéá",yAxisId:"right",dot:{r:2},connectNulls:!0}),e.jsx(fe,{type:"monotone",dataKey:"ffmi",name:"FFMI",yAxisId:"right",dot:{r:2},connectNulls:!0})]})})}):e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Ë°®Á§∫„Åß„Åç„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà‰ΩìÈáç/‰ΩìËÑÇËÇ™Áéá/Ë∫´Èï∑„ÅåÂøÖË¶Å„Åß„ÅôÔºâ"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"„Éû„Éà„É™„ÇØ„ÇπÔºàBMI √ó ‰ΩìËÑÇËÇ™ÁéáÔºâ"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ê®™Ôºö‰ΩìËÑÇËÇ™ÁéáÔºà%Ôºâ„ÄÄÁ∏¶ÔºöBMI"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"rounded",checked:r,onChange:w=>n(w.target.checked)}),"Â∏Ø„ÇíË°®Á§∫"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Âü∫Ê∫ñ"}),e.jsxs("select",{className:"text-xs px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100",value:l,onChange:w=>i(w.target.value),disabled:!c,children:[e.jsx("option",{value:"general",children:"‰∏ÄËà¨"}),e.jsx("option",{value:"athlete",children:"Á´∂ÊäÄËÄÖ"})]})]}),s!=="male"&&s!=="female"?e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"ÊÄßÂà•Êú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅÂ∏Ø„ÅØOFF"}):e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["ÊÄßÂà•Ôºö",s==="male"?"Áî∑ÊÄß":"Â•≥ÊÄß"]})]})]}),v.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Êï£Â∏ÉÂõ≥„Å´ÂøÖË¶Å„Å™„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà‰ΩìÈáç„ÉªË∫´Èï∑„Éª‰ΩìËÑÇËÇ™Áéá„ÅåÂøÖË¶Å„Åß„ÅôÔºâ"}):e.jsx("div",{className:"h-72 sm:h-80",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(Ra,{children:[e.jsx(Ye,{strokeDasharray:"3 3"}),e.jsx(Ge,{type:"number",dataKey:"pbf",name:"‰ΩìËÑÇËÇ™Áéá",unit:"%",tick:{fontSize:12},domain:["auto","auto"]}),e.jsx(De,{type:"number",dataKey:"bmi",name:"BMI",tick:{fontSize:12},domain:["auto","auto"]}),c&&j&&e.jsx(Qr,{x1:j.pbf.low,x2:j.pbf.high,y1:j.bmi.low,y2:j.bmi.high,fill:"rgba(59,130,246,0.18)",fillOpacity:1,stroke:"rgba(59,130,246,0.9)",strokeWidth:1.5,ifOverflow:"extendDomain"}),c&&j&&e.jsxs(e.Fragment,{children:[e.jsx(Qr,{x1:j.pbf.low,x2:j.pbf.high,y1:j.bmi.low,y2:j.bmi.high,fill:"rgba(59,130,246,0.12)",stroke:"rgba(59,130,246,0.55)",strokeWidth:1}),e.jsx(Ie,{x:j.pbf.low,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`PBF ${j.pbf.low}%`,position:"insideTopLeft",fontSize:11}}),e.jsx(Ie,{x:j.pbf.high,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`PBF ${j.pbf.high}%`,position:"insideTopRight",fontSize:11}}),e.jsx(Ie,{y:j.bmi.low,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`BMI ${j.bmi.low}`,position:"insideLeft",fontSize:11}}),e.jsx(Ie,{y:j.bmi.high,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`BMI ${j.bmi.high}`,position:"insideLeft",fontSize:11}})]}),e.jsx(Ze,{cursor:{strokeDasharray:"3 3"},formatter:(w,p)=>{const h=typeof w=="number"?w:null;return p==="pbf"?[`${h==null?void 0:h.toFixed(1)} %`,"‰ΩìËÑÇËÇ™Áéá"]:p==="bmi"?[`${h==null?void 0:h.toFixed(2)}`,"BMI"]:[String(w),p]},labelFormatter:(w,p)=>{var u;const h=(u=p==null?void 0:p[0])==null?void 0:u.payload;return h!=null&&h.dateLabel?`Ê∏¨ÂÆöÊó•Ôºö${h.dateLabel}`:""}}),e.jsx($a,{name:"ÈÅéÂéª‚ÜíÊúÄÊñ∞",data:v})]})})})]})]})}function Yi(t){return Math.round(370+21.6*t)}function Gi(t){const{weightKg:s,heightCm:r,age:n,gender:l}=t,i=10*s+6.25*r-5*n;return Math.round(l==="male"?i+5:i-161)}function Zi(t){return t>=600?700:t>=400?500:t>=150?300:200}function Qi(){return 1.55}function Xi(t){var N,w,p,h,u,f,d,o,g,m;const s=typeof t.intakeCalories=="number"?t.intakeCalories:null;let r=null,n="none";const l=((N=t.snapshot)==null?void 0:N.bmr)??null;if(typeof l=="number"&&Number.isFinite(l)&&l>0)r=l,n="snapshot";else{const b=((w=t.fallback)==null?void 0:w.leanMassKg)??null;if(typeof b=="number"&&b>0)r=Yi(b),n="leanMass";else{const _=((p=t.fallback)==null?void 0:p.weightKg7dAvg)??null,S=((h=t.fallback)==null?void 0:h.heightCm)??null,C=((u=t.fallback)==null?void 0:u.age)??null,R=((f=t.fallback)==null?void 0:f.gender)??null;typeof _=="number"&&_>0&&typeof S=="number"&&S>0&&typeof C=="number"&&C>0&&(R==="male"||R==="female")&&(r=Gi({weightKg:_,heightCm:S,age:C,gender:R}),n="mifflin")}}let i=null,c="none";const j=((d=t.snapshot)==null?void 0:d.tdee)??null;if(typeof j=="number"&&Number.isFinite(j)&&j>0)i=j,c="snapshot";else if(r){const b=((o=t.snapshot)==null?void 0:o.activity_factor)??null??Qi(),_=((g=t.fallback)==null?void 0:g.todayLoad)??((m=t.snapshot)==null?void 0:m.srpe)??0,S=Zi(Number(_??0));i=Math.round(r*b+S),c="estimated"}const x=s!=null&&i!=null?Math.round(s-i):null;let y="unknown",v="Êú™Âà§ÂÆö";return x!=null&&(x<=-350?(y="low",v="‰∏çË∂≥Ê∞óÂë≥"):x>=350?(y="high",v="ÈÅéÂ§öÊ∞óÂë≥"):(y="ok",v="Ê¶Ç„Å≠ÈÅ©Ê≠£")),{date:t.date,bmr:r,tdee:i,intake:s,balance:x,status:y,statusLabel:v,meta:{bmrSource:n,tdeeSource:c}}}function eo(t,s){const[r,n]=a.useState([]),[l,i]=a.useState("idle"),[c,j]=a.useState(null),[x,y]=a.useState(0),v=a.useRef({cal:0,p:0,f:0,c:0}),N=a.useCallback(()=>{y(p=>p+1)},[]);a.useEffect(()=>{if(!t||!s)return;let p=!1;async function h(){i("loading"),j(null);try{const{data:u,error:f}=await L.from("nutrition_logs").select("id, record_date, meal_type, meal_slot, total_calories, p, f, c, is_edited, advice_markdown, image_url, image_path, analysis_status, analysis_error, created_at").eq("user_id",t).eq("record_date",s).order("meal_type",{ascending:!0}).order("meal_slot",{ascending:!0}).order("created_at",{ascending:!0});if(f)throw f;p||(n(u??[]),i("ready"))}catch(u){console.error("[useTodayNutritionTotals] fetch error:",u),p||(n([]),i("error"),j(String((u==null?void 0:u.message)??u)))}}return h(),()=>{p=!0}},[t,s,x]);const w=a.useMemo(()=>{if(l==="loading")return v.current;const p={cal:0,p:0,f:0,c:0};let h=!1;for(const f of r)(f.total_calories==null||f.p==null||f.f==null||f.c==null)&&(h=!0),p.cal+=Number(f.total_calories??0),p.p+=Number(f.p??0),p.f+=Number(f.f??0),p.c+=Number(f.c??0);p.p=Math.round(p.p*10)/10,p.f=Math.round(p.f*10)/10,p.c=Math.round(p.c*10)/10;const u={...p,hasAnyLog:r.length>0,hasUnparsed:h};return v.current=u,u},[r,l]);return{logs:r,totals:w,loading:l==="loading",status:l,error:c,refetch:N}}function Lt(t,s=0){const r=Number(t);return Number.isFinite(r)?r:s}function to(t,s){if(!Number.isFinite(s)||s<=0)return 0;const r=t/s*100;return Math.min(100,Math.max(0,r))}function so(t,s){if(!Number.isFinite(s)||s<=0)return"na";const r=t/s;return r<.7?"low":r<=1.1?"ok":"high"}function ro(t){switch(t){case"low":return"bg-blue-600";case"ok":return"bg-emerald-600";case"high":return"bg-orange-600";default:return"bg-gray-400"}}function ao(t){switch(t){case"low":return"text-blue-700 dark:text-blue-300";case"ok":return"text-emerald-700 dark:text-emerald-300";case"high":return"text-orange-700 dark:text-orange-300";default:return"text-gray-500 dark:text-gray-400"}}function no({totals:t,targets:s,loading:r=!1,subtitle:n,onOpen:l}){const i=a.useMemo(()=>{if(!s)return null;const c=Lt(t==null?void 0:t.cal,0),j=Lt(t==null?void 0:t.p,0),x=Lt(t==null?void 0:t.f,0),y=Lt(t==null?void 0:t.c,0);return[{key:"cal",label:"„Ç´„É≠„É™„Éº",unit:"kcal",now:Math.round(c),goal:Math.round(Lt(s==null?void 0:s.cal,0))},{key:"p",label:"„Åü„Çì„Å±„ÅèË≥™",unit:"g",now:Math.round(j*10)/10,goal:Math.round(Lt(s==null?void 0:s.p,0)*10)/10},{key:"f",label:"ËÑÇË≥™",unit:"g",now:Math.round(x*10)/10,goal:Math.round(Lt(s==null?void 0:s.f,0)*10)/10},{key:"c",label:"ÁÇ≠Ê∞¥ÂåñÁâ©",unit:"g",now:Math.round(y*10)/10,goal:Math.round(Lt(s==null?void 0:s.c,0)*10)/10}]},[t,s]);return e.jsxs("div",{className:["bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-5 transition-colors",l?"cursor-pointer hover:shadow-md":""].join(" "),onClick:l,role:l?"button":void 0,tabIndex:l?0:-1,onKeyDown:c=>{l&&(c.key==="Enter"||c.key===" ")&&l()},children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"‰ªäÊó•„ÅÆÊ†ÑÈ§äÈÄ≤Êçó"}),n&&e.jsx("p",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:n})]})}),r?e.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶"}):i?e.jsx("div",{className:"mt-4 space-y-3",children:i.map(c=>{const j=so(c.now,c.goal),x=to(c.now,c.goal);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-200",children:c.label}),e.jsxs("span",{className:`text-[11px] ${ao(j)}`,children:[Math.round(x),"%"]})]}),e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[c.now,"/",c.goal," ",c.unit]})]}),e.jsx("div",{className:"mt-1.5 h-2.5 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:`h-full ${ro(j)}`,style:{width:`${x}%`}})})]},c.key)})}):e.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"ÁõÆÊ®ôÂÄ§„ÇíË°®Á§∫„Åô„Çã„Å´„ÅØ‰ΩìÈáç„Éá„Éº„Çø„ÅåÂøÖË¶Å„Åß„Åô"}),l&&e.jsx("div",{className:"mt-3 text-[11px] text-gray-500 dark:text-gray-400",children:"„Çø„ÉÉ„Éó„ÅßË©≥Á¥∞„ÇíË¶ã„Çã"})]})}function jr(t,s,r){return typeof t!="number"||!Number.isFinite(t)?s:Math.min(Math.max(t,s),r)}function Cs(t){return Math.round(t*10)/10}function Ee(t){return Math.round(t)}function Re(t,s=0){return typeof t=="number"&&Number.isFinite(t)?t:s}function lo(t,s){const r=Re(t,0),n=Re(s,NaN);if(!Number.isFinite(n))return null;const l=r*(1-n/100);return l>0?Cs(l):null}function io(t){const s=Re(t,NaN);if(!Number.isFinite(s))return null;const r=370+21.6*s;return r>0?Ee(r):null}function oo({weightKg:t,heightCm:s,age:r,sex:n}){const l=Re(t,NaN),i=Re(s,NaN),c=Re(r,NaN);if(![l,i,c].every(Number.isFinite))return null;const j=10*l+6.25*i-5*c,x=(n||"").toLowerCase(),v=j+(x==="male"?5:x==="female"?-161:-78);return v>0?Ee(v):null}function co(t){switch((t||"").toLowerCase()){case"sedentary":case"low":return 1.2;case"light":return 1.375;case"moderate":return 1.55;case"high":return 1.725;case"athlete":case"very_high":return 1.9;default:return 1.55}}function xo(t,s){const r=Re(t,NaN);if(!Number.isFinite(r))return null;const n=co(s),l=r*n;return l>0?Ee(l):null}function mo(t,s="moderate"){const r=Re(t,NaN);if(!Number.isFinite(r)||r<=0)return null;const n=(s||"").toLowerCase();return Ee(r*(n==="sedentary"||n==="low"?28:n==="light"?30:n==="moderate"?33:n==="high"?36:n==="athlete"||n==="very_high"?40:33))}function uo({weightKg:t,bodyFatPercent:s,ffmKg:r,heightCm:n,age:l,sex:i,activityLevel:c="moderate",goalType:j="maintain",targetCaloriesOverride:x=null,proteinPerKg:y=null,proteinPerFFM:v=null,fatPerKg:N=null,minFatG:w=40,minCarbG:p=0,deficitKcal:h=0,surplusKcal:u=0,minCaloriesByBMRRatio:f=1.05,maxCalories:d=6e3}){const o=Re(t,NaN);if(!Number.isFinite(o)||o<=0)throw new Error("weightKg is required");const g=[];Number.isFinite(s)||g.push("bodyFatPercent"),Number.isFinite(r)||g.push("ffmKg"),Number.isFinite(n)||g.push("heightCm"),Number.isFinite(l)||g.push("age"),i||g.push("sex");const m=Number.isFinite(r)?Cs(r):lo(o,s),b=m?io(m):null,_=oo({weightKg:o,heightCm:n,age:l,sex:i}),S=b??_??null,C=b?"katch":_?"mifflin":"none",R=S?xo(S,c):null,A=R?"bmr_x_activity":"none";let T=null;if(Number.isFinite(x))T=Ee(x);else if(R)j==="loss_maintain_muscle"?T=Ee(R-(h||300)):j==="gain"?T=Ee(R+(u||200)):T=Ee(R);else{const W=mo(o,c);T=Ee(W??o*33)}let M=T;if(S){const W=Ee(S*Re(f,1.05));M=jr(M,W,d)}else M=jr(M,800,d);const k=j==="loss_maintain_muscle"?2:j==="gain"?1.8:1.6,F=Number.isFinite(v)&&m?Ee(m*v):Number.isFinite(y)?Ee(o*y):Ee(m&&j==="loss_maintain_muscle"?m*2.4:o*k),O=j==="loss_maintain_muscle"?.8:j==="gain"?1:.9,z=jr(Ee(o*(Number.isFinite(N)?N:O)),w,200),P=F*4+z*9,$=M-P;let q=Math.max(0,Ee($/4));const E=Math.max(0,Ee(Re(p,0)));let D=M,B=null;E>0&&q<E&&(q=E,D=Ee(P+q*4),B="minCarbG_applied");const H=(()=>{const W=!!m,U=[n,l].every(Number.isFinite)&&!!i;return W||U?"high":c?"mid":"low"})();return{ffmKg:m,bmrKcal:S,tdeeKcal:R,activityLevel:c,goalType:j,meta:{bmrMethod:C,tdeeMethod:A,confidence:H,missing:g,targetCalRaw:T,targetCalAdjusted:D,adjustedReason:B},target:{cal:D,p:F,f:z,c:q}}}function Jc({today:t,target:s}){const r=t||{cal:0,p:0,f:0,c:0},n=s||{cal:0,p:0,f:0,c:0};return{cal:Ee(Re(n.cal,0)-Re(r.cal,0)),p:Cs(Re(n.p,0)-Re(r.p,0)),f:Cs(Re(n.f,0)-Re(r.f,0)),c:Cs(Re(n.c,0)-Re(r.c,0))}}const js=1e4,go=50;function $r(t){return t.length===0?0:t.reduce((s,r)=>s+r,0)/t.length}function ho(t){if(t.length<=1)return 0;const s=$r(t),r=t.reduce((n,l)=>n+(l-s)*(l-s),0)/t.length;return Math.sqrt(r)}function va(){const t=new Date;return new Date(t.getTime()+9*60*60*1e3).toISOString().slice(0,10)}function bo(t){const s=new Date,r=new Date(s.getTime()+9*60*60*1e3),n=new Date(r);return n.setDate(n.getDate()-t),n.toISOString().slice(0,10)}function fo(t){return new Promise(s=>setTimeout(s,t))}function po(t,s,r){return Math.max(s,Math.min(r,t))}function yo(t){switch(t){case"good":return{title:"GOOD",sub:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥ËâØÂ•Ω",icon:ts};case"fatigue":return{title:"FATIGUE",sub:"Â∞ë„Åó„ÅäÁñ≤„Çå„É¢„Éº„Éâ",icon:er};case"danger":return{title:"DANGER",sub:"Âà∂Âæ°„ÅåÂäπ„Åç„Å´„Åè„ÅÑÁä∂ÊÖã",icon:Mr};case"stop":return{title:"STOP",sub:"‰ºëÊÅØ„ÅåÂøÖË¶Å",icon:Mr};default:return{title:"CALIBRATING",sub:"Âà§ÂÆöÊ∫ñÂÇô‰∏≠",icon:er}}}function jo(t){switch(t){case"good":return"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200";case"fatigue":return"bg-amber-50 text-amber-700 ring-1 ring-amber-200";case"danger":case"stop":return"bg-rose-50 text-rose-700 ring-1 ring-rose-200";default:return"bg-slate-50 text-slate-600 ring-1 ring-slate-200"}}function wo({userId:t,onBackHome:s}){const[r,n]=a.useState("standby"),l=a.useRef(!1),[i,c]=a.useState(!1),[j,x]=a.useState(js),[y,v]=a.useState(0),[N,w]=a.useState(0),[p,h]=a.useState(0),[u,f]=a.useState([]),[d,o]=a.useState("calibrating"),[g,m]=a.useState(""),[b,_]=a.useState(!1),[S,C]=a.useState(!1),[R,A]=a.useState(""),T=a.useRef(0),M=a.useRef([]),k=a.useRef(null),F=a.useRef(null),O=a.useRef(null),z=a.useRef(null),P=a.useMemo(()=>{const V=1-j/js;return po(V,0,1)},[j]);function $(){k.current&&(window.clearInterval(k.current),k.current=null)}function q(){$(),c(!1),l.current=!1,x(js),v(0),M.current=[],T.current=0,O.current=null,_(!1),C(!1),A("")}function E(){q(),n("measure"),c(!0),l.current=!0,T.current=performance.now(),k.current=window.setInterval(()=>{if(!l.current)return;const te=performance.now()-T.current,se=Math.max(0,js-te);x(se),se<=0&&($(),W())},go)}function D(V){if(!l.current)return;V.cancelable&&V.preventDefault();const te=performance.now();M.current.push(te),v(M.current.length),B(V)}function B(V){const te=F.current;if(!te)return;const se=te.getBoundingClientRect(),I=document.createElement("div");I.style.position="absolute",I.style.borderRadius="999px",I.style.pointerEvents="none",I.style.width="54px",I.style.height="54px",I.style.left=`${V.clientX-se.left-27}px`,I.style.top=`${V.clientY-se.top-27}px`,I.style.background="rgba(59,130,246,.20)",I.style.transform="scale(0)",I.style.transition="transform 420ms ease, opacity 420ms ease",te.appendChild(I),requestAnimationFrame(()=>{I.style.transform="scale(5)",I.style.opacity="0"}),setTimeout(()=>I.remove(),450)}async function H(){if(t)try{const{data:V,error:te}=await L.from("ftt_events").insert({user_id:t,did_save:!1}).select("id").single();if(te){console.error("[FTT events insert error]",te);return}O.current=(V==null?void 0:V.id)??null}catch(V){console.error("[FTT events insert exception]",V)}}async function W(){n("result"),c(!1),l.current=!1,$();const V=M.current,te=V.length,se=[];for(let G=1;G<V.length;G++)se.push(V[G]-V[G-1]);const I=ho(se);w(te),h(I),f(se);const J=await Z(te,I);o(J.condition),m(J.message),await H()}async function U(V){const{minSamples:te,windowDays:se}=V;if(!t)return{ok:!1,reason:"no_user",sampleCount:0};const I=va(),J=`${t}:${I}`,G=z.current;if(G&&G.key===J&&G.windowDays===se&&G.minSamples===te)return G.sampleCount<te?{ok:!1,reason:"not_enough_samples",sampleCount:G.sampleCount}:{ok:!0,baselineSpeed:G.baselineSpeed,baselineSD:G.baselineSD,sampleCount:G.sampleCount};const ne=bo(se),{data:oe,error:de}=await L.from("ftt_records").select("date,total_count,interval_sd_ms,measured_at").eq("user_id",t).gte("date",ne).order("measured_at",{ascending:!1}).limit(200);if(de)return z.current={key:J,windowDays:se,minSamples:te,sampleCount:0,baselineSpeed:0,baselineSD:0,fetchedAt:Date.now()},{ok:!1,reason:"fetch_error",sampleCount:0};const ye=(oe??[]).filter(Se=>{const rt=Number(Se==null?void 0:Se.total_count),Oe=Number(Se==null?void 0:Se.interval_sd_ms);return Number.isFinite(rt)&&rt>0&&Number.isFinite(Oe)&&Oe>=0}),je=ye.length;if(je<te)return z.current={key:J,windowDays:se,minSamples:te,sampleCount:je,baselineSpeed:0,baselineSD:0,fetchedAt:Date.now()},{ok:!1,reason:"not_enough_samples",sampleCount:je};const st=$r(ye.map(Se=>Number(Se.total_count))),ct=$r(ye.map(Se=>Number(Se.interval_sd_ms)));return z.current={key:J,windowDays:se,minSamples:te,sampleCount:je,baselineSpeed:st,baselineSD:ct,fetchedAt:Date.now()},{ok:!0,baselineSpeed:st,baselineSD:ct,sampleCount:je}}async function Z(V,te){if(!t)return{condition:"calibrating",message:"„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ"};const ne=await U({minSamples:5,windowDays:30});if(!ne.ok)return ne.reason==="not_enough_samples"?{condition:"calibrating",message:"„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥‰∏≠Ôºà„ÅÇ„Å®Êï∞Âõû„ÅßÂà§ÂÆö„ÅåÂá∫„Åæ„ÅôÔºâ„ÄÇ"}:{condition:"calibrating",message:"„Éô„Éº„Çπ„É©„Ç§„É≥ÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºàÂàùÂõû„ÅØÂà§ÂÆö„Åó„Åæ„Åõ„ÇìÔºâ„ÄÇ"};const oe=ne.baselineSpeed,de=ne.baselineSD,ue=V<oe*.9,ye=de>0?te>de*(1+.25):!1;return ue&&ye?{condition:"stop",message:"ÂøÉË∫´„Å®„ÇÇ„Å´ÈôêÁïå„Åß„Åô„ÄÇÂãáÊ∞ó„ÇíÊåÅ„Å£„Å¶‰ºëÊÅØ„Çí„Å®„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}:ye?{condition:"danger",message:"‰Ωì„ÅØÂãï„Åç„Åæ„Åô„ÅåÂà∂Âæ°„ÅåÂäπ„ÅÑ„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÊÄ™Êàë„É™„Çπ„ÇØ„ÅåÈ´ò„ÅÑÁä∂ÊÖã„Åß„Åô„ÄÇ„Ç¢„ÉÉ„Éó„ÇíÂøµÂÖ•„Çä„Å´„ÄÇ"}:ue?{condition:"fatigue",message:"ËÑ≥„ÅåÂ∞ë„Åó„ÅäÁñ≤„Çå„É¢„Éº„Éâ„ÄÇ‰ªäÊó•„ÅØË≥™„ÅÆÈ´ò„ÅÑÁù°Áú†„ÇíÂÑ™ÂÖà„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}:{condition:"good",message:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥ËâØÂ•Ω„ÄÇÈ´ò„ÅÑ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ"}}async function Y(){if(S||b)return;if(!t){A("„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ");return}C(!0),A("ÈÄÅ‰ø°„Ç≠„É•„ÉºÂæÖÊ©ü‰∏≠‚Ä¶ÔºàË≤†Ëç∑ÂàÜÊï£Ôºâ");const V=Math.floor(Math.random()*5e3);await fo(V);try{A("„ÇØ„É©„Ç¶„Éâ„Å´‰øùÂ≠ò‰∏≠‚Ä¶");const te=va(),{error:se}=await L.from("ftt_records").upsert({user_id:t,date:te,duration_sec:Math.round(js/1e3),total_count:N,interval_sd_ms:p,raw_intervals_ms:u,condition_result:d,meta:{ua:typeof navigator<"u"?navigator.userAgent:null,tz:Intl.DateTimeFormat().resolvedOptions().timeZone,source:"ftt_check"}},{onConflict:"user_id,date"});if(se){console.error("[FTT records upsert error]",se),A(`‰øùÂ≠òÂ§±Êïó: ${se.message}`),C(!1);return}const I=O.current;if(I){const{error:J}=await L.from("ftt_events").update({did_save:!0}).eq("id",I).eq("user_id",t);J&&console.error("[FTT events update error]",J)}_(!0),A("‚úÖ ‰øùÂ≠òÂÆå‰∫Ü"),C(!1)}catch(te){console.error("[FTT save exception]",te),A(`‰øùÂ≠òÂ§±Êïó: ${(te==null?void 0:te.message)??"unknown error"}`),C(!1)}}a.useEffect(()=>()=>{l.current=!1,$()},[]);const ee=r==="standby"?"10Áßí„Çø„ÉÉ„Éó„Åß„ÄÅËÑ≥„ÅÆ„Ç≠„É¨„Å®ÂÆâÂÆöÊÄß„Çí„ÉÅ„Çß„ÉÉ„ÇØ":r==="measure"?"„Åß„Åç„Çã„Å†„ÅëÈÄü„Åè„ÄÅ‰∏ÄÂÆö„ÅÆ„É™„Ç∫„É†„Åß":"ÁµêÊûú„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÄÅÂøÖË¶Å„Å™„Çâ‰øùÂ≠ò",ae=er;return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900",children:e.jsxs("div",{className:"mx-auto max-w-md px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center",children:e.jsx(ae,{className:"h-5 w-5 text-slate-700"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-extrabold tracking-tight",children:"FTT Check"}),e.jsx("div",{className:"text-sm text-slate-500",children:ee})]})]}),s&&e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:[e.jsx(Ia,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Êàª„Çã"})]})]})}),e.jsxs("div",{className:"rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-100 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(er,{className:"h-4 w-4"}),r==="standby"?"Standby":r==="measure"?"Measuring":"Result"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Bekuta"})]}),e.jsxs("div",{className:"p-5",children:[r==="standby"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:e.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"1"}),e.jsx("span",{children:"„Çπ„Éû„Éõ„ÇíÊú∫„Å´ÁΩÆ„ÅÑ„Å¶Âõ∫ÂÆö"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"2"}),e.jsx("span",{children:"Âà©„ÅçÊâã„ÅÆ‰∫∫Â∑Æ„ÅóÊåá 1Êú¨„Åß„Çø„ÉÉ„Éó"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"3"}),e.jsx("span",{children:"10ÁßíÈñì„ÄÅÈÄü„Åè„Éª‰∏ÄÂÆö„ÅÆ„É™„Ç∫„É†„Åß"})]})]})}),e.jsx("button",{onClick:E,className:"w-full rounded-2xl bg-slate-900 text-white py-3.5 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition",children:"START"}),e.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:"‚Äª Âü∫Êú¨„ÅØ1Êó•1Âõû„ÄÇ„Éü„Çπ„Å£„Åü„ÇâRETRY„Åß„ÇÑ„ÇäÁõ¥„Åõ„Åæ„ÅôÔºàÊ∏¨ÂÆö„É≠„Ç∞„ÅØÊÆã„Çä„Åæ„ÅôÔºâ„ÄÇ"})]}),r==="measure"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Remaining"}),e.jsx("div",{className:"text-4xl font-extrabold tracking-tight tabular-nums",children:(j/1e3).toFixed(2)})]}),e.jsxs("div",{className:"text-sm text-slate-600 font-semibold flex items-center gap-2",children:[e.jsx(cl,{className:"h-4 w-4"}),"TAPS ",e.jsx("span",{className:"font-extrabold tabular-nums",children:y})]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-100 overflow-hidden ring-1 ring-slate-200",children:e.jsx("div",{className:"h-full rounded-full bg-blue-500",style:{width:`${P*100}%`,transition:"width 50ms linear"}})}),e.jsxs("div",{ref:F,onPointerDown:D,className:"relative h-72 rounded-3xl bg-gradient-to-b from-slate-50 to-white ring-1 ring-slate-200 shadow-sm overflow-hidden select-none",style:{touchAction:"manipulation",WebkitUserSelect:"none",WebkitTouchCallout:"none"},children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute -top-12 -right-12 h-40 w-40 rounded-full bg-blue-100/50 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-16 -left-16 h-44 w-44 rounded-full bg-emerald-100/40 blur-2xl"})]}),e.jsxs("div",{className:"h-full flex flex-col items-center justify-center gap-3 select-none",children:[e.jsxs("div",{className:"relative h-24 w-24 flex items-center justify-center",children:[e.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/40 animate-ftt-ripple"}),e.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/30 animate-ftt-ripple delay-300"}),e.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/20 animate-ftt-ripple delay-600"}),e.jsx("span",{className:"relative z-10 h-3 w-3 rounded-full bg-slate-800 shadow-[0_0_0_6px_rgba(15,23,42,0.08)]"})]}),e.jsx("div",{className:"text-sm font-extrabold tracking-widest text-slate-800",children:"TAP FAST"}),e.jsx("div",{className:"text-xs text-slate-500",children:"‰∫∫Â∑Æ„ÅóÊåá1Êú¨„Åß"})]})]}),e.jsxs("button",{onClick:()=>{q(),n("standby")},className:"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2",children:[e.jsx(da,{className:"h-4 w-4"}),"CANCEL"]})]}),r==="result"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:[e.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Speed (Total)"}),e.jsx("div",{className:"mt-1 text-3xl font-extrabold tabular-nums",children:N})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:[e.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Stability (SD)"}),e.jsxs("div",{className:"mt-1 text-3xl font-extrabold tabular-nums",children:[p.toFixed(1),e.jsx("span",{className:"text-sm font-bold text-slate-500 ml-1",children:"ms"})]})]})]}),(()=>{const V=yo(d),te=V.icon;return e.jsxs("div",{className:`rounded-2xl px-4 py-3 ${jo(d)} flex items-center gap-3`,children:[e.jsx("div",{className:"h-9 w-9 rounded-xl bg-white/70 flex items-center justify-center",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-extrabold tracking-wide",children:V.title}),e.jsx("div",{className:"text-xs opacity-80",children:V.sub})]}),e.jsxs("div",{className:"text-xs font-bold opacity-80 tabular-nums",children:["intervals: ",u.length]})]})})(),e.jsx("div",{className:"text-sm text-slate-700 leading-relaxed",children:g}),e.jsxs("button",{disabled:S||b,onClick:Y,className:["w-full rounded-2xl py-3.5 font-extrabold tracking-wide flex items-center justify-center gap-2 transition active:scale-[0.99]",b?"bg-emerald-600 text-white":S?"bg-slate-200 text-slate-600 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-500"].join(" "),children:[e.jsx(ms,{className:"h-4 w-4"}),b?"SAVED ‚úÖ":S?"SAVING...":"SAVE DATA"]}),e.jsx("div",{className:["min-h-[18px] text-xs text-center",b?"text-emerald-700":R.includes("Â§±Êïó")?"text-rose-700":"text-slate-500"].join(" "),children:R}),e.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:"‚Äª Ë®àÊ∏¨ÁµÇ‰∫ÜÊôÇÁÇπ„Åß„ÄåÊú™‰øùÂ≠ò„É≠„Ç∞Ôºàftt_eventsÔºâ„Äç„ÅåÊÆã„Çä„Åæ„Åô„ÄÇ ‰øùÂ≠ò„Éú„Çø„É≥„Åß„Äå„Åù„ÅÆÊó•„ÅÆÊ≠£Âºè„Éá„Éº„ÇøÔºàftt_recordsÔºâ„Äç„Å®„Åó„Å¶Êé°Áî®„Åï„Çå„Åæ„Åô„ÄÇ"}),e.jsxs("button",{onClick:()=>{q(),n("standby")},className:"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2",children:[e.jsx(da,{className:"h-4 w-4"}),"RETRY"]})]})]})]}),e.jsx("div",{className:"mt-6 text-center text-xs text-slate-400",children:"‚Äúfast & steady‚Äù „Åå„Ç≥„ÉÑ„ÄÇ„Çπ„Éî„Éº„Éâ„Å†„Åë„Åß„Å™„ÅèÂÆâÂÆöÊÄß„ÇÇË¶ã„Åæ„Åô„ÄÇ"})]})})}const vo=a.lazy(()=>Qe(()=>import("./GamificationView-DEbO_yrF.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.GamificationView})));function No({user:t}){return e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:e.jsx(vo,{userId:t.id,userTeamId:t.team_id})})}const ko=[{value:"cramps",label:"ÁîüÁêÜÁóõ",icon:Ut},{value:"mood_changes",label:"Ê∞óÂàÜ„ÅÆÂ§âÂåñ",icon:Ja},{value:"fatigue",label:"Áñ≤Âä¥ÊÑü",icon:Ha},{value:"headache",label:"È†≠Áóõ",icon:Va},{value:"bloating",label:"ËÜ®Ê∫ÄÊÑü",icon:tn},{value:"breast_tenderness",label:"ËÉ∏„ÅÆÂºµ„Çä",icon:et},{value:"acne",label:"„Éã„Ç≠„Éì",icon:ts},{value:"back_pain",label:"ËÖ∞Áóõ",icon:Qa}];function _o({userId:t,onSuccess:s}){const{addCycle:r}=$s(t),[n,l]=a.useState(!1),[i,c]=a.useState(null),[j,x]=a.useState(!1),[y,v]=a.useState("success"),[N,w]=a.useState(""),p=(m,b)=>{v(m),w(b),x(!0)},[h,u]=a.useState({cycle_start_date:"",period_end_date:"",flow_intensity:"",symptoms:[],notes:""}),f=(m,b)=>{const _=new Date(m),S=new Date(b);return Math.floor((S.getTime()-_.getTime())/(1e3*60*60*24))+1},d=async m=>{if(m.preventDefault(),!n){l(!0),c(null);try{if(!h.cycle_start_date)throw new Error("ÁîüÁêÜÈñãÂßãÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");const b={cycle_start_date:h.cycle_start_date,symptoms:h.symptoms};if(h.period_end_date){const _=f(h.cycle_start_date,h.period_end_date);if(_<=0)throw new Error("ÁîüÁêÜÁµÇ‰∫ÜÊó•„ÅØÈñãÂßãÊó•‰ª•Èôç„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ");b.period_duration_days=_}h.flow_intensity&&(b.flow_intensity=h.flow_intensity),h.notes&&(b.notes=h.notes),await r(b),u({cycle_start_date:"",period_end_date:"",flow_intensity:"",symptoms:[],notes:""}),p("success","Âë®Êúü„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü ‚úÖ"),s&&s()}catch(b){const _=b instanceof Error?b.message:"Âë®Êúü„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü";c(_),p("error",`‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºö${_}`)}finally{l(!1)}}},o=m=>{u(b=>({...b,symptoms:b.symptoms.includes(m)?b.symptoms.filter(_=>_!==m):[...b.symptoms,m]}))},g=h.cycle_start_date&&h.period_end_date?f(h.cycle_start_date,h.period_end_date):null;return e.jsxs(e.Fragment,{children:[e.jsx(Rs,{open:j,type:y,message:N,onClose:()=>x(!1)}),e.jsxs("form",{onSubmit:d,className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Bt,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"ÊúàÁµåÂë®Êúü„ÇíË®òÈå≤"})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{children:i})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(_e,{className:"inline w-4 h-4 mr-1"}),"ÁîüÁêÜÈñãÂßãÊó• *"]}),e.jsx("input",{type:"date",required:!0,value:h.cycle_start_date,onChange:m=>u({...h,cycle_start_date:m.target.value}),disabled:n,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(_e,{className:"inline w-4 h-4 mr-1"}),"ÁîüÁêÜÁµÇ‰∫ÜÊó•"]}),e.jsx("input",{type:"date",value:h.period_end_date,min:h.cycle_start_date||void 0,onChange:m=>u({...h,period_end_date:m.target.value}),disabled:n,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60"}),g!=null&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ÁîüÁêÜÊúüÈñì: ",g,"Êó•Èñì"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÁµåË°ÄÈáè"}),e.jsxs("select",{value:h.flow_intensity,onChange:m=>u({...h,flow_intensity:m.target.value}),disabled:n,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60",children:[e.jsx("option",{value:"",children:"ÈÅ∏Êäû..."}),e.jsx("option",{value:"light",children:"Â∞ë„Å™„ÅÑ"}),e.jsx("option",{value:"moderate",children:"ÊôÆÈÄö"}),e.jsx("option",{value:"heavy",children:"Â§ö„ÅÑ"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÁóáÁä∂"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:ko.map(m=>{const b=m.icon,_=h.symptoms.includes(m.value);return e.jsxs("button",{type:"button",onClick:()=>o(m.value),disabled:n,className:`px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 disabled:opacity-60 disabled:cursor-not-allowed ${_?"border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-[1.02]":"border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300"}`,children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:m.label})]},m.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢"}),e.jsx("textarea",{value:h.notes,onChange:m=>u({...h,notes:m.target.value}),rows:3,disabled:n,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60",placeholder:"„Åù„ÅÆ‰ªñ„ÅÆ„É°„É¢..."})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full py-3 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?"‰øùÂ≠ò‰∏≠...":"Âë®Êúü„Éá„Éº„Çø„Çí‰øùÂ≠ò"})]})]})}function on(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null);a.useEffect(()=>{j()},[t]);const j=async()=>{try{l(!0);const{data:p,error:h}=await L.from("basal_body_temperature").select("*").eq("user_id",t).order("measurement_date",{ascending:!1});if(h)throw h;r(p||[])}catch(p){c(p instanceof Error?p.message:"Failed to fetch basal body temperature")}finally{l(!1)}};return{temperatures:s,loading:n,error:i,addTemperature:async p=>{try{const{data:h}=await L.auth.getUser();if(!h.user)throw new Error("User not authenticated");const{data:u}=await L.from("users").select("team_id").eq("user_id",h.user.id).maybeSingle();let f=null;if(u!=null&&u.team_id){const{data:g}=await L.from("teams").select("organization_id").eq("id",u.team_id).maybeSingle();f=(g==null?void 0:g.organization_id)||null}const{data:d,error:o}=await L.from("basal_body_temperature").insert({...p,user_id:t,organization_id:f}).select().single();if(o)throw o;return d&&r(g=>[d,...g]),d}catch(h){throw c(h instanceof Error?h.message:"Failed to add basal body temperature"),h}},updateTemperature:async(p,h)=>{try{const{data:u,error:f}=await L.from("basal_body_temperature").update(h).eq("id",p).select().single();if(f)throw f;return u&&r(d=>d.map(o=>o.id===p?u:o)),u}catch(u){throw c(u instanceof Error?u.message:"Failed to update basal body temperature"),u}},deleteTemperature:async p=>{try{const{error:h}=await L.from("basal_body_temperature").delete().eq("id",p);if(h)throw h;r(u=>u.filter(f=>f.id!==p))}catch(h){throw c(h instanceof Error?h.message:"Failed to delete basal body temperature"),h}},getTemperatureTrend:(p=7)=>{const h=s.slice(0,p).sort((m,b)=>new Date(m.measurement_date).getTime()-new Date(b.measurement_date).getTime());if(h.length<3)return"stable";const u=h.slice(0,Math.floor(h.length/2)),f=h.slice(Math.floor(h.length/2)),d=u.reduce((m,b)=>m+Number(b.temperature_celsius),0)/u.length,g=f.reduce((m,b)=>m+Number(b.temperature_celsius),0)/f.length-d;return g>.1?"rising":g<-.1?"falling":"stable"},getAverageTemperature:(p=7)=>{const h=s.slice(0,p);return h.length===0?null:h.reduce((f,d)=>f+Number(d.temperature_celsius),0)/h.length},refetch:j}}function So({userId:t,onSuccess:s}){const{addTemperature:r}=on(t),[n,l]=a.useState(!1),[i,c]=a.useState(null),j=_t(),x=new Date().toTimeString().slice(0,5),[y,v]=a.useState({measurement_date:j,temperature_celsius:"",measurement_time:x,notes:""}),N=async w=>{w.preventDefault(),l(!0),c(null);try{const p={measurement_date:y.measurement_date,temperature_celsius:parseFloat(y.temperature_celsius)};y.measurement_time&&(p.measurement_time=y.measurement_time),y.notes&&(p.notes=y.notes),await r(p),v({measurement_date:j,temperature_celsius:"",measurement_time:x,notes:""}),s&&s()}catch(p){c(p instanceof Error?p.message:"‰ΩìÊ∏©„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{l(!1)}};return e.jsxs("form",{onSubmit:N,className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ca,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Âü∫Á§é‰ΩìÊ∏©„ÇíË®òÈå≤"})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{children:i})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"„Éí„É≥„Éà:"})," Âü∫Á§é‰ΩìÊ∏©„ÅØËµ∑Â∫äÂæå„Åô„Åê„ÄÅ„Éô„ÉÉ„Éâ„Åã„ÇâÂá∫„ÇãÂâç„ÇÑË∫´‰ΩìÊ¥ªÂãï„Çí„Åô„ÇãÂâç„Å´Ê∏¨ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(_e,{className:"inline w-4 h-4 mr-1"}),"Ê∏¨ÂÆöÊó• *"]}),e.jsx("input",{type:"date",required:!0,value:y.measurement_date,max:j,onChange:w=>v({...y,measurement_date:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(gt,{className:"inline w-4 h-4 mr-1"}),"Ê∏¨ÂÆöÊôÇÂàª"]}),e.jsx("input",{type:"time",value:y.measurement_time,onChange:w=>v({...y,measurement_time:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(ca,{className:"inline w-4 h-4 mr-1"}),"‰ΩìÊ∏©Ôºà‚ÑÉÔºâ *"]}),e.jsx("input",{type:"number",step:"0.01",min:"35.0",max:"42.0",required:!0,value:y.temperature_celsius,onChange:w=>v({...y,temperature_celsius:w.target.value}),placeholder:"‰æã: 36.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ê≠£Â∏∏ÁØÑÂõ≤: 36.1 - 37.0‚ÑÉ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢"}),e.jsx("textarea",{value:y.notes,onChange:w=>v({...y,notes:w.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"‰ΩìÊ∏©„Å´ÂΩ±Èüø„Åô„ÇãË¶ÅÂõ†Ôºà‰ΩìË™ø‰∏çËâØ„ÄÅÂØù‰∏çË∂≥„Å™„Å©Ôºâ..."})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?"‰øùÂ≠ò‰∏≠...":"‰ΩìÊ∏©„Çí‰øùÂ≠ò"})]})}function Co({userId:t,days:s=90}){const{cycles:r,getCurrentCyclePhase:n}=$s(t),{temperatures:l}=on(t),i=n(),j=(()=>{const y=new Date,v=new Date(y);v.setDate(v.getDate()-s);const N=new Map;for(let w=new Date(v);w<=y;w.setDate(w.getDate()+1)){const p=Zs(w);N.set(p,{date:p,displayDate:`${w.getMonth()+1}/${w.getDate()}`,temperature:null,cyclePhase:null})}return l.forEach(w=>{const p=N.get(w.measurement_date);p&&(p.temperature=Number(w.temperature_celsius))}),r.forEach(w=>{const p=new Date(w.cycle_start_date),h=w.cycle_end_date?new Date(w.cycle_end_date):y;for(let u=new Date(p);u<=h&&u<=y;u.setDate(u.getDate()+1)){const f=Zs(u),d=N.get(f);d&&r.find(g=>{const m=new Date(g.cycle_start_date+"T00:00:00"),b=g.cycle_end_date?new Date(g.cycle_end_date+"T00:00:00"):y;return u>=m&&u<=b})&&(d.cyclePhase=1)}}),Array.from(N.values())})(),x=y=>{switch(y){case"menstrual":return"text-red-600 dark:text-red-400";case"follicular":return"text-green-600 dark:text-green-400";case"ovulatory":return"text-yellow-600 dark:text-yellow-400";case"luteal":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Âë®Êúü„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„Å®‰ΩìÊ∏©"})]}),i&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"ÁèæÂú®„ÅÆ„Éï„Çß„Éº„Ç∫: "}),e.jsx("span",{className:`font-semibold capitalize ${x(i.phase)}`,children:i.phase})]})]}),e.jsx(Je,{width:"100%",height:400,children:e.jsxs(St,{data:j,children:[e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),e.jsx(Ge,{dataKey:"displayDate",stroke:"#6B7280",style:{fontSize:"12px"}}),e.jsx(De,{yAxisId:"temp",domain:[35.5,37.5],stroke:"#3B82F6",style:{fontSize:"12px"},label:{value:"‰ΩìÊ∏©Ôºà‚ÑÉÔºâ",angle:-90,position:"insideLeft"}}),e.jsx(De,{yAxisId:"cycle",orientation:"right",domain:[0,1],ticks:[0,1],stroke:"#EC4899",style:{fontSize:"12px"},label:{value:"Âë®Êúü",angle:90,position:"insideRight"}}),e.jsx(Ze,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px",color:"#F3F4F6"},formatter:(y,v)=>v==="temperature"?[y?`${y.toFixed(2)}‚ÑÉ`:"„Éá„Éº„Çø„Å™„Åó","‰ΩìÊ∏©"]:v==="cyclePhase"?[y?"„Ç¢„ÇØ„ÉÜ„Ç£„Éñ":"Âë®Êúü„Å™„Åó","Âë®Êúü"]:[y,v]}),e.jsx(lt,{}),e.jsx(Ie,{yAxisId:"temp",y:36.5,stroke:"#6B7280",strokeDasharray:"3 3"}),e.jsx(fe,{yAxisId:"temp",type:"monotone",dataKey:"temperature",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",r:3},connectNulls:!0,name:"‰ΩìÊ∏©"}),e.jsx(fe,{yAxisId:"cycle",type:"stepAfter",dataKey:"cyclePhase",stroke:"#EC4899",strokeWidth:2,dot:!1,name:"ÊúàÁµåÂë®Êúü"})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"ÊúàÁµåÊúü"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"ÂçµËÉûÊúü"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"ÊéíÂçµÊúü"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"ÈªÑ‰ΩìÊúü"})]})]})]})}function Mo({userId:t}){const{cycles:s,getCurrentCyclePhase:r}=$s(t),[n,l]=a.useState(new Date),i=r(),c=new Date;c.setHours(0,0,0,0);let j=null;if(i){const o=new Date(i.cycle.cycle_start_date);o.setHours(0,0,0,0),j=Math.floor((c.getTime()-o.getTime())/(1e3*60*60*24))+1}const x=o=>{for(const g of s){const m=new Date(g.cycle_start_date),b=g.cycle_end_date?new Date(g.cycle_end_date):new Date;if(o>=m&&o<=b){const _=Math.floor((o.getTime()-m.getTime())/864e5)+1;let S=null,C=!1,R=!1;return _>=1&&_<=5?(S="menstrual",R=!0):_>=6&&_<=13?(S="follicular",C=!0):_>=14&&_<=16?(S="ovulatory",C=!0):_>=17&&_<=28&&(S="luteal",R=!0),{phase:S,day:_,isHighPerformance:C,isInjuryRisk:R}}}return{phase:null,day:0,isHighPerformance:!1,isInjuryRisk:!1}},y=()=>{if(s.length===0)return null;const o=[...s].sort((C,R)=>new Date(R.cycle_start_date).getTime()-new Date(C.cycle_start_date).getTime()),g=o[0];if(!g.cycle_end_date)return null;const m=o.reduce((C,R)=>{if(!R.cycle_end_date)return C;const A=new Date(R.cycle_start_date),T=new Date(R.cycle_end_date);return C+Math.floor((T.getTime()-A.getTime())/(1e3*60*60*24))},0)/o.filter(C=>C.cycle_end_date).length,b=new Date(g.cycle_end_date),_=new Date(b);_.setDate(_.getDate()+1);const S=new Date(_);return S.setDate(S.getDate()+Math.round(m)),{start:_,end:S}},N=(()=>{const o=n.getFullYear(),g=n.getMonth(),m=new Date(o,g,1),b=new Date(o,g+1,0),_=new Date(m);_.setDate(_.getDate()-m.getDay());const S=[],C=new Date(_);for(;C<=b||C.getDay()!==0;)S.push(new Date(C)),C.setDate(C.getDate()+1);return S})(),w=y(),p=o=>{switch(o){case"menstrual":return"bg-red-100 dark:bg-red-900/30 border-red-400 dark:border-red-600";case"follicular":return"bg-green-100 dark:bg-green-900/30 border-green-400 dark:border-green-600";case"ovulatory":return"bg-yellow-100 dark:bg-yellow-900/30 border-yellow-400 dark:border-yellow-600";case"luteal":return"bg-blue-100 dark:bg-blue-900/30 border-blue-400 dark:border-blue-600";default:return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}},h=o=>{switch(o){case"menstrual":return"ÊúàÁµåÊúü";case"follicular":return"ÂçµËÉûÊúü";case"ovulatory":return"ÊéíÂçµÊúü";case"luteal":return"ÈªÑ‰ΩìÊúü";default:return""}},u=o=>w?o>=w.start&&o<=w.end:!1,f=()=>{l(new Date(n.getFullYear(),n.getMonth()+1))},d=()=>{l(new Date(n.getFullYear(),n.getMonth()-1))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Âë®Êúü„Ç´„É¨„É≥„ÉÄ„Éº"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Ka,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white min-w-[120px] text-center",children:[n.getFullYear(),"Âπ¥ ",n.getMonth()+1,"Êúà"]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Tt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})]}),i&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-lg border border-pink-200 dark:border-pink-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ÁèæÂú®„ÅÆ„Éï„Çß„Éº„Ç∫"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[h(i.phase)," - Âë®Êúü",j??"-","Êó•ÁõÆ"]})]}),i.phase==="follicular"||i.phase==="ovulatory"?e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"„Éè„Ç§„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúü"})]}):i.phase==="luteal"||i.phase==="menstrual"?e.jsxs("div",{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"ÊÄ™Êàë„É™„Çπ„ÇØÊ≥®ÊÑè"})]}):null]})}),w&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Wt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Ê¨°Âõû„ÅÆÂë®Êúü‰∫àÊ∏¨"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[w.start.getMonth()+1,"Êúà",w.start.getDate(),"Êó• -"," ",w.end.getMonth()+1,"Êúà",w.end.getDate(),"Êó• Ôºà„Ç´„É¨„É≥„ÉÄ„Éº‰∏ä„ÅÆÁÇπÁ∑öÊû†„ÅßË°®Á§∫Ôºâ"]})]})]})}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"].map((o,g)=>e.jsx("div",{className:`text-center text-sm font-semibold py-2 ${g===0?"text-red-600 dark:text-red-400":g===6?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"}`,children:o},o))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:N.map((o,g)=>{const m=x(o),b=u(o),_=o.getTime()===c.getTime(),S=o.getMonth()===n.getMonth();return e.jsx("div",{className:`
                relative aspect-square p-1 border rounded-lg transition-all
                ${p(m.phase)}
                ${b?"border-dashed border-2":"border"}
                ${S?"":"opacity-40"}
                ${_?"ring-2 ring-purple-500 dark:ring-purple-400":""}
              `,children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("span",{className:`text-sm font-medium ${_?"text-purple-700 dark:text-purple-300 font-bold":m.phase?"text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:o.getDate()}),m.phase&&e.jsxs("div",{className:"flex gap-0.5 mt-1",children:[m.isHighPerformance&&e.jsx(Ke,{className:"w-3 h-3 text-green-600 dark:text-green-400"}),m.isInjuryRisk&&e.jsx(ge,{className:"w-3 h-3 text-orange-600 dark:text-orange-400"})]}),b&&!m.phase&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium mt-1",children:"‰∫àÊ∏¨"})]})},g)})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Âë®Êúü„Éï„Çß„Éº„Ç∫"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ÊúàÁµåÊúüÔºà1-5Êó•ÁõÆÔºâ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-100 dark:bg-green-900/30 border border-green-400 dark:border-green-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ÂçµËÉûÊúüÔºà6-13Êó•ÁõÆÔºâ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ÊéíÂçµÊúüÔºà14-16Êó•ÁõÆÔºâ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-100 dark:bg-blue-900/30 border border-blue-400 dark:border-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ÈªÑ‰ΩìÊúüÔºà17-28Êó•ÁõÆÔºâ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Ç¨„Ç§„Éâ"}),e.jsxs("div",{className:"flex items-start gap-2 bg-green-50 dark:bg-green-900/20 p-2 rounded",children:[e.jsx(Ke,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5"}),e.jsxs("div",{className:"text-xs text-green-800 dark:text-green-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"„Éè„Ç§„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúü"}),e.jsx("p",{children:"ÂçµËÉûÊúü„ÉªÊéíÂçµÊúüÔºöÈ´òÂº∑Â∫¶„Éà„É¨„Éº„Éã„É≥„Ç∞„Å´ÈÅ©„Åó„ÅüÊôÇÊúü"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 bg-orange-50 dark:bg-orange-900/20 p-2 rounded",children:[e.jsx(ge,{className:"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5"}),e.jsxs("div",{className:"text-xs text-orange-800 dark:text-orange-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"ÊÄ™Êàë„É™„Çπ„ÇØÊ≥®ÊÑèÊúü"}),e.jsx("p",{children:"ÊúàÁµåÊúü„ÉªÈªÑ‰ΩìÊúüÔºöÁÑ°ÁêÜ„Åõ„ÅöË™øÊï¥„Éà„É¨„Éº„Éã„É≥„Ç∞Êé®Â•®"})]})]})]})]})]})}function Do(t,s,r){const[n,l]=a.useState([]),[i,c]=a.useState([]),[j,x]=a.useState([]),[y,v]=a.useState([]),[N,w]=a.useState(!0),[p,h]=a.useState(null);a.useEffect(()=>{u()},[]),a.useEffect(()=>{f()},[s]),a.useEffect(()=>{t&&d()},[t,s]);const u=async()=>{try{const{data:T,error:M}=await L.from("performance_categories").select("*").eq("is_active",!0).order("sort_order");if(M)throw M;l(T||[])}catch(T){console.error("Error fetching categories:",T),h("„Ç´„ÉÜ„Ç¥„É™„Éº„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},f=async()=>{try{let T=L.from("performance_test_types").select(`
          *,
          performance_categories:category_id (
            id,
            name,
            display_name
          )
        `).eq("is_active",!0);if(s){const{data:F}=await L.from("performance_categories").select("id").eq("name",s).single();F&&(T=T.eq("category_id",F.id))}const{data:M,error:k}=await T.order("sort_order");if(k)throw k;c(M||[])}catch(T){console.error("Error fetching test types:",T),h("Ê∏¨ÂÆöÁ®ÆÁõÆ„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},d=async()=>{try{w(!0);let T=L.from("performance_records").select(`
          *,
          performance_test_types:test_type_id (
            id,
            category_id,
            name,
            display_name,
            description,
            unit,
            higher_is_better,
            fields,
            sort_order,
            is_active,
            created_at
          )
      `).eq("user_id",t).order("date",{ascending:!1});if(s){const{data:O}=await L.from("performance_categories").select("id").eq("name",s).maybeSingle();if(O){const{data:z}=await L.from("performance_test_types").select("id").eq("category_id",O.id);z&&z.length>0&&(T=T.in("test_type_id",z.map(P=>P.id)))}}const{data:M,error:k}=await T;if(k)throw k;const F=(M||[]).map(O=>({...O,test_type:O.performance_test_types}));x(F),o(F)}catch(T){console.error("Error fetching records:",T),h("Ë®òÈå≤„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{w(!1)}},o=T=>{const M=new Map;T.forEach(k=>{if(!k.test_type)return;const F=k.values.primary_value,O=typeof F=="string"?parseFloat(F):F;if(O==null||isNaN(O))return;const z=M.get(k.test_type_id);(!z||(k.test_type.higher_is_better?O>z.value:O<z.value))&&M.set(k.test_type_id,{test_type_id:k.test_type_id,test_name:k.test_type.name,test_display_name:k.test_type.display_name,value:O,date:k.date,record:k})}),v(Array.from(M.values()))},g=async(T,M)=>{try{const{data:k,error:F}=await L.from("performance_records").select(`
          *,
          performance_test_types:test_type_id (
            id,
            name,
            display_name,
            unit,
            higher_is_better,
            fields
          )
        `).eq("user_id",t).eq("test_type_id",T).eq("date",M).maybeSingle();if(F)throw F;return k?{...k,test_type:k.performance_test_types}:null}catch(k){return console.error("Error checking existing record:",k),null}},m=async T=>{try{const{data:M,error:k}=await L.from("performance_records").insert([{user_id:t,...T}]).select().single();if(k)throw k;await d();const F=i.find(P=>P.id===T.test_type_id),O=T.values.primary_value,z=F&&S(T.test_type_id,O,F.higher_is_better);return{data:M,isNewPersonalBest:z??!1}}catch(M){throw console.error("Error adding record:",M),M}},b=async(T,M)=>{try{const{data:k,error:F}=await L.from("performance_records").update(M).eq("id",T).eq("user_id",t).select().single();if(F)throw F;return await d(),k}catch(k){throw console.error("Error updating record:",k),k}},_=async T=>{try{const{error:M}=await L.from("performance_records").delete().eq("id",T).eq("user_id",t);if(M)throw M;await d()}catch(M){throw console.error("Error deleting record:",M),M}},S=(T,M,k)=>{const F=y.find(O=>O.test_type_id===T);return F?k?M>F.value:M<F.value:!0},C=T=>j.filter(M=>M.test_type_id===T).sort((M,k)=>new Date(k.date).getTime()-new Date(M.date).getTime());return{categories:n,testTypes:i,records:j,personalBests:y,loading:N,error:p,addRecord:m,updateRecord:b,deleteRecord:_,checkIfPersonalBest:S,checkExistingRecord:g,getRecordsByTestType:C,getPersonalBest:T=>y.find(M=>M.test_type_id===T),getImprovementPercentage:(T,M)=>{const k=C(T);if(k.length<2)return null;const O=k[k.length-1].values.primary_value;return!O||O===0?null:(M-O)/Math.abs(O)*100},refresh:d}}function To({userId:t}){const{cycles:s,getCyclePhase:r}=$s(t),{records:n}=Ur(t),{records:l}=Do(t,"jump"),c=(()=>{const v={menstrual:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},follicular:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},ovulatory:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},luteal:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0}};return n.forEach(N=>{const w=new Date(N.date);for(const p of s){const h=r(p,w);if(h&&h in v){v[h].count++,v[h].totalLoad+=N.load,v[h].totalRPE+=N.rpe;break}}}),l.forEach(N=>{const w=new Date(N.test_date);for(const p of s){const h=r(p,w);if(h&&h in v){v[h].performances++,v[h].totalScore+=N.score;break}}}),Object.entries(v).map(([N,w])=>({phase:N==="menstrual"?"ÊúàÁµåÊúü":N==="follicular"?"ÂçµËÉûÊúü":N==="ovulatory"?"ÊéíÂçµÊúü":"ÈªÑ‰ΩìÊúü",avgLoad:w.count>0?(w.totalLoad/w.count).toFixed(1):0,avgRPE:w.count>0?(w.totalRPE/w.count).toFixed(1):0,avgPerformance:w.performances>0?(w.totalScore/w.performances).toFixed(1):0,sessionCount:w.count}))})(),j=c.some(v=>v.sessionCount>0),y=(()=>{var u,f;if(!j)return[];const v=[],N=[...c].sort((d,o)=>Number(o.avgLoad)-Number(d.avgLoad)),w=[...c].sort((d,o)=>Number(o.avgPerformance)-Number(d.avgPerformance));((u=N[0])==null?void 0:u.avgLoad)>0&&v.push(`${N[0].phase}„Å´ÊúÄ„ÇÇÈ´ò„ÅÑ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑ÔºàÂπ≥Âùá${N[0].avgLoad}Ôºâ`),((f=w[0])==null?void 0:f.avgPerformance)>0&&v.push(`${w[0].phase}„Å´ÊúÄÈ´ò„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ`);const p=c.find(d=>d.phase==="Follicular"),h=c.find(d=>d.phase==="Luteal");return p&&h&&Number(p.avgRPE)<Number(h.avgRPE)&&v.push("ÂçµËÉûÊúü„ÅØ‰∏ªË¶≥ÁöÑÈÅãÂãïÂº∑Â∫¶„Åå‰Ωé„ÅÑ - „Éà„É¨„Éº„Éã„É≥„Ç∞Âº∑Â∫¶„Çí‰∏ä„Åí„Çã„Åì„Å®„ÇíÊ§úË®é„Åó„Å¶„Åè„Å†„Åï„ÅÑ"),v})();return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ke,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Âë®Êúü„Å®„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÅÆÁõ∏Èñ¢"})]}),j?e.jsxs(e.Fragment,{children:[e.jsx(Je,{width:"100%",height:300,children:e.jsxs(pn,{data:c,children:[e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),e.jsx(Ge,{dataKey:"phase",stroke:"#6B7280",style:{fontSize:"12px"}}),e.jsx(De,{stroke:"#6B7280",style:{fontSize:"12px"}}),e.jsx(Ze,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px",color:"#F3F4F6"}}),e.jsx(lt,{}),e.jsx(_s,{dataKey:"avgLoad",fill:"#3B82F6",name:"Âπ≥ÂùáË≤†Ëç∑"}),e.jsx(_s,{dataKey:"avgRPE",fill:"#EF4444",name:"Âπ≥ÂùáRPE"}),e.jsx(_s,{dataKey:"avgPerformance",fill:"#10B981",name:"Âπ≥Âùá„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ"})]})}),y.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"„Ç§„É≥„Çµ„Ç§„Éà"}),e.jsx("ul",{className:"space-y-2 text-sm text-purple-800 dark:text-purple-200",children:y.map((v,N)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-500 mt-1",children:"‚Ä¢"}),e.jsx("span",{children:v})]},N))})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:e.jsxs("p",{children:[n.length,"Âõû„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Å®",l.length,"Âõû„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà„Å´Âü∫„Å•„Åè"]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Le,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Áõ∏Èñ¢„ÇíË°®Á§∫„Åô„Çã„Å´„ÅØ„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"}),e.jsx("p",{className:"text-sm mt-2",children:"Âë®Êúü„Å®„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„ÇíË®òÈå≤„ÅóÁ∂ö„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºÅ"})]})]})}function Eo({userId:t,gender:s}){const[r,n]=a.useState("calendar");return s!=="female"?e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6 text-center",children:[e.jsx(Bt,{className:"w-12 h-12 text-yellow-600 dark:text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"„Åì„ÅÆÊ©üËÉΩ„ÅØÂ•≥ÊÄß„É¶„Éº„Ç∂„ÉºÂ∞ÇÁî®„Åß„Åô"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö„ÅßÊÄßÂà•„Çí„ÄåÂ•≥ÊÄß„Äç„Å´Ë®≠ÂÆö„Åô„Çã„Å®„ÄÅÊúàÁµåÂë®Êúü„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(_o,{userId:t}),e.jsx(So,{userId:t})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Âë®Êúü„ÅÆË°®Á§∫ÂΩ¢Âºè"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n("calendar"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="calendar"?"bg-pink-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"„Ç´„É¨„É≥„ÉÄ„Éº"}),e.jsx("button",{onClick:()=>n("chart"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="chart"?"bg-pink-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"„Ç∞„É©„Éï"})]})]}),r==="calendar"?e.jsx(Mo,{userId:t}):e.jsx(Co,{userId:t,days:90}),e.jsx(To,{userId:t})]})}function Ao(){const[t,s]=a.useState(()=>window.matchMedia("(prefers-color-scheme: dark)").matches);return a.useEffect(()=>{t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[t]),a.useEffect(()=>{const r=window.matchMedia("(prefers-color-scheme: dark)"),n=l=>{s(l.matches)};return r.addEventListener("change",n),()=>r.removeEventListener("change",n)},[]),{isDarkMode:t}}function Ro(t){const s="=".repeat((4-t.length%4)%4),r=(t+s).replace(/-/g,"+").replace(/_/g,"/"),n=atob(r),l=new Uint8Array(n.length);for(let i=0;i<n.length;++i)l[i]=n.charCodeAt(i);return l}async function Fr(){return"serviceWorker"in navigator?await navigator.serviceWorker.register("/sw.js"):null}async function $o(t){if(!("serviceWorker"in navigator)||!("PushManager"in window))throw new Error("Push not supported");const s=await navigator.serviceWorker.ready,r=await s.pushManager.getSubscription();if(r)return r;if(await Notification.requestPermission()!=="granted")throw new Error("Notification permission denied");return await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ro(t)})}async function Fo(t){var c,j;const{data:{user:s}}=await L.auth.getUser();if(!s)throw new Error("Not logged in");await Fr();const r=await $o(t),n=r.toJSON(),l={user_id:s.id,endpoint:r.endpoint,p256dh:((c=n.keys)==null?void 0:c.p256dh)??"",auth:((j=n.keys)==null?void 0:j.auth)??"",user_agent:navigator.userAgent},{error:i}=await L.from("push_subscriptions").upsert(l,{onConflict:"user_id,endpoint"});if(i)throw i;return r}async function Lo(){const{data:{user:t}}=await L.auth.getUser();if(!t)throw new Error("Not logged in");if("serviceWorker"in navigator){const n=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(n)try{await n.unsubscribe()}catch(l){console.warn("unsubscribe failed:",l)}}const{error:s}=await L.from("push_subscriptions").delete().eq("user_id",t.id);if(s)throw s;return!0}const Na="BOs4Yup3ijgFAgBaqEaRv10Lx6SuRLNuJdiJ1zZiDyIcPh6YgoUneI4iD3czij1Qz_g50DRRd9AtxvQoNb-emvc";function Po({userId:t,userEmail:s}){const[r,n]=a.useState({alerts:!0,password_reset:!0,weekly_summary:!1}),[l,i]=a.useState(!1),[c,j]=a.useState(!1),[x,y]=a.useState(!1),[v,N]=a.useState(!0),[w,p]=a.useState(!1),[h,u]=a.useState(null);a.useEffect(()=>{(async()=>(N(!0),await Promise.all([f(),g()]),N(!1)))()},[t]);const f=async()=>{try{const{data:b,error:_}=await L.from("users").select("email_notifications").eq("id",t).single();if(_)throw _;const S=(b==null?void 0:b.email_notifications)??{};n(C=>({...C,...S}))}catch(b){console.error("Error loading email preferences:",b)}},d=async()=>{p(!0),u(null);try{const{error:b}=await L.from("users").update({email_notifications:r}).eq("id",t);if(b)throw b;u({type:"success",text:"„É°„Éº„É´ÈÄöÁü•Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü"})}catch(b){console.error("Error saving preferences:",b),u({type:"error",text:b.message||"Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"})}finally{p(!1),setTimeout(()=>u(null),3e3)}},o=b=>{n(_=>({..._,[b]:!_[b]}))},g=async()=>{try{const b=await Fr();i(!!b);const{data:_,error:S}=await L.from("push_subscriptions").select("id").eq("user_id",t).limit(1).maybeSingle();if(S)throw S;j(!!_)}catch(b){console.error("Error init push:",b),i(!1)}},m=async()=>{y(!0),u(null);try{c?(await Lo(),j(!1),u({type:"success",text:"„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•„ÇíOFF„Å´„Åó„Åæ„Åó„Åü"})):(await Fr(),await Fo(Na),j(!0),u({type:"success",text:"„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•„ÇíON„Å´„Åó„Åæ„Åó„Åü"}))}catch(b){console.error("Push toggle error:",b),u({type:"error",text:b.message||"„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•„ÅÆË®≠ÂÆö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"})}finally{y(!1),setTimeout(()=>u(null),3e3)}};return v?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ot,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"ÈÄöÁü•Ë®≠ÂÆö"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ot,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ:"})," ",s]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:"„É°„Éº„É´ÈÄöÁü•„ÅØ„Åì„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´ÈÄÅ‰ø°„Åï„Çå„Åæ„Åô"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 space-y-6 transition-colors",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(Ms,{className:"w-6 h-6 text-purple-600 dark:text-purple-400 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"„Ç¢„Éó„É™„ÇíÈñã„ÅÑ„Å¶„ÅÑ„Å™„ÅÑÊôÇ„ÇÇ„ÄÅÂøÖË¶Å„Å™„Å®„Åç„Å†„Åë„Åù„Å£„Å®Â£∞„Çí„Åã„Åë„Åæ„Åô"})]}),e.jsx("button",{onClick:m,disabled:!l||x,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${c?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"} ${!l||x?"opacity-50 cursor-not-allowed":""}`,title:l?"":"„Åì„ÅÆÁ´ØÊú´„Åß„ÅØ„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•„ÇíÂà©Áî®„Åß„Åç„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô",children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${c?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"‚Äª iPhone„ÅØ„Äå„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Äç„Åó„ÅüBekuta„Åã„ÇâON„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(Ms,{className:"w-6 h-6 text-red-600 dark:text-red-400 mt-1 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"„Ç¢„É©„Éº„ÉàÈÄöÁü•Ôºà„É°„Éº„É´Ôºâ"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"È´ò„É™„Çπ„ÇØ„ÅÆACWRÂÄ§„ÇÑÊÄ™Êàë„ÅÆ‰∫àÊ∏¨„Ç¢„É©„Éº„Éà„Çí„É°„Éº„É´„ÅßÂèó‰ø°"})]}),e.jsx("button",{onClick:()=>o("alerts"),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${r.alerts?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r.alerts?"translate-x-6":"translate-x-1"}`})})]})})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(es,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 mt-1 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„ÉàÈÄöÁü•Ôºà„É°„Éº„É´Ôºâ"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"„Éë„Çπ„ÉØ„Éº„Éâ„Åå„É™„Çª„ÉÉ„Éà„Åï„Çå„ÅüÈöõ„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£ÈÄöÁü•"})]}),e.jsx("button",{onClick:()=>o("password_reset"),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${r.password_reset?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r.password_reset?"translate-x-6":"translate-x-1"}`})})]})})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(_e,{className:"w-6 h-6 text-green-600 dark:text-green-400 mt-1 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"ÈÄ±Ê¨°„Çµ„Éû„É™„ÉºÔºà„É°„Éº„É´Ôºâ"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ÊØéÈÄ±ÊúàÊõúÊó•„Å´ÂÖàÈÄ±„ÅÆÁä∂Ê≥Å„Çí„Åæ„Å®„ÇÅ„Åü„É¨„Éù„Éº„Éà„ÇíÂèó‰ø°"})]}),e.jsx("button",{onClick:()=>o("weekly_summary"),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${r.weekly_summary?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r.weekly_summary?"translate-x-6":"translate-x-1"}`})})]})})]})]}),h&&e.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg ${h.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-600 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400"} transition-colors`,children:[h.type==="success"?e.jsx(Ne,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(pe,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:h.text})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:d,disabled:w,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white py-2 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center space-x-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"‰øùÂ≠ò‰∏≠..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{children:"„É°„Éº„É´Ë®≠ÂÆö„Çí‰øùÂ≠ò"})]})})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4 transition-colors",children:e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Ê≥®ÊÑè:"})," „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Å´Èñ¢„Åô„ÇãÈáçË¶Å„Å™ÈÄöÁü•Ôºà„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„ÉàÁ≠âÔºâ„ÅØ„ÄÅË®≠ÂÆö„Å´Èñ¢„Çè„Çâ„ÅöÈÄÅ‰ø°„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ"]})})]})}function qo({user:t,onOpenProfileEdit:s}){return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö"}),e.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Á∑®ÈõÜ"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ÂêçÂâç"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.name??"-"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.email??"-"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ÊÄßÂà•"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.gender==="male"?"Áî∑ÊÄß":t.gender==="female"?"Â•≥ÊÄß":t.gender==="other"?"„Åù„ÅÆ‰ªñ":t.gender==="prefer_not_to_say"?"ÂõûÁ≠î„Åó„Å™„ÅÑ":"Êú™Ë®≠ÂÆö"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Ë∫´Èï∑"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.height_cm?`${t.height_cm} cm`:"Êú™Ë®≠ÂÆö"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ÁîüÂπ¥ÊúàÊó•"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.date_of_birth?new Date(t.date_of_birth).toLocaleDateString("ja-JP"):"Êú™Ë®≠ÂÆö"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ÈõªË©±Áï™Âè∑"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.phone_number?t.phone_number:"Êú™Ë®≠ÂÆö"})]})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:e.jsx(Po,{userId:t.id,userEmail:t.email??""})})]})}async function zo(t){const{userId:s,date:r,rpe:n,durationMin:l}=t,i=(n??0)*(l??0),{data:c,error:j}=await L.from("nutrition_metabolism_snapshots").select("bmr").eq("user_id",s).order("calculated_at",{ascending:!1}).limit(1).maybeSingle();if(j)throw j;const x=c==null?void 0:c.bmr;if(!x)return;const y=i===0?1.2:i<300?1.4:i<600?1.6:i<900?1.8:2,v=Math.round(x*y),{error:N}=await L.from("daily_energy_snapshots").upsert({user_id:s,date:r,bmr:x,srpe:i,activity_factor:y,tdee:v},{onConflict:"user_id,date"});if(N)throw N}const Oo=a.lazy(()=>Qe(()=>import("./AthleteNutritionDashboardView-WwDb9dzp.js"),__vite__mapDeps([3,1,2])).then(t=>({default:t.default}))),Bo=a.lazy(()=>Qe(()=>import("./ExportPanel-De4YFCm4.js"),__vite__mapDeps([4,1,5,2])).then(t=>({default:t.ExportPanel})));a.lazy(()=>Qe(()=>import("./GamificationView-DEbO_yrF.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.GamificationView})));const Wo=a.lazy(()=>Qe(()=>import("./MessagingPanel-B_3knzbj.js"),__vite__mapDeps([6,1,2])).then(t=>({default:t.MessagingPanel}))),Io=a.lazy(()=>Qe(()=>import("./AthletePerformanceView-DMqG799r.js"),__vite__mapDeps([7,1,8,2])).then(t=>({default:t.default})));function Uo({user:t,alerts:s,onLogout:r,onHome:n,onNavigateToPrivacy:l,onNavigateToTerms:i,onNavigateToCommercial:c,onNavigateToHelp:j,onUserUpdated:x}){var ze,Gt,Ls,fs,dr,$t,nt,Dt,ps,Vr,Kr,Jr,Yr;a.useRef(!1),a.useEffect(()=>{},[t.id,t.role,t.gender,t.team_id]),a.useRef(!1),a.useEffect(()=>{},[]);const y=a.useMemo(()=>_t(),[]),[v,N]=a.useState(null),[w,p]=a.useState(!1),[h,u]=a.useState(!1),[f,d]=a.useState(!1),[o,g]=a.useState(!1),[m,b]=a.useState("unified"),_=!!t.ftt_enabled,S=!!t.nutrition_enabled;a.useEffect(()=>{const K=navigator.connection,Ce=!!(K!=null&&K.saveData),wt=K==null?void 0:K.effectiveType;if(Ce||(wt==="slow-2g"||wt==="2g"||wt==="3g"))return;let Ft=!1;const ds=()=>{Qe(()=>import("./AthletePerformanceView-DMqG799r.js"),__vite__mapDeps([7,1,8,2]))};if("requestIdleCallback"in window){const gn=window.requestIdleCallback(()=>{Ft||ds()},{timeout:4e3});return()=>{var Gr;Ft=!0,(Gr=window.cancelIdleCallback)==null||Gr.call(window,gn)}}const un=setTimeout(()=>{Ft||ds()},2500);return()=>{Ft=!0,clearTimeout(un)}},[]);const C=a.useCallback(K=>{K==="ftt"&&!_||K==="nutrition"&&!S||b(K)},[_,S]);a.useEffect(()=>{!_&&m==="ftt"&&b("unified")},[_,m]),a.useEffect(()=>{!S&&m==="nutrition"&&b("unified")},[S,m]);const[R,A]=a.useState(null),[T,M]=a.useState(!1),k=a.useMemo(()=>t.gender==="female"||t.gender==="male"?t.gender:null,[t.gender]),F=a.useMemo(()=>t.gender==="female"||t.gender==="male"||t.gender==="other"||t.gender==="prefer_not_to_say"?t.gender:null,[t.gender]);a.useEffect(()=>{},[t.gender,k,F]),a.useEffect(()=>{m==="cycle"&&k!=="female"&&b("unified")},[m,k]);const{records:O,loading:z,checkExistingRecord:P,addTrainingRecord:$,updateTrainingRecord:q,deleteTrainingRecord:E,acwrData:D}=Ur(t.id),{records:B,loading:H,checkExistingRecord:W,addWeightRecord:U,updateWeightRecord:Z,deleteWeightRecord:Y,getLatestWeight:ee,getWeightChange:ae}=ni(t.id),{records:V,loading:te,checkExistingRecord:se,addSleepRecord:I,updateSleepRecord:J,getAverageSleepHours:G,getAverageSleepQuality:ne,getLatestSleep:oe}=li(t.id),{records:de,loading:ue,checkExistingRecord:ye,addMotivationRecord:je,updateMotivationRecord:st,getAverageMotivation:ct,getAverageEnergy:Se,getAverageStress:rt,getLatestMotivation:Oe}=ii(t.id),{records:bt,latest:xe,loading:xt,error:Te}=Wi(t.id),{cycles:Fe,addCycle:ft,updateCycle:Pe}=$s(t.id),{isActive:Ht,shouldShowTutorial:At,startTutorial:Vt,completeTutorial:we,skipTutorial:ss,currentStepIndex:Ct,setCurrentStepIndex:it}=Pr(),{isDarkMode:Mt}=Ao(),{logs:qe,totals:ot,loading:ke,error:pt,refetch:us}=eo(t.id,y),rs=a.useMemo(()=>{const K=ot??{},Ce=Number((K==null?void 0:K.cal)??(K==null?void 0:K.kcal)??(K==null?void 0:K.calories)??(K==null?void 0:K.total_calories)??0)||0,wt=Number((K==null?void 0:K.p)??(K==null?void 0:K.protein_g)??(K==null?void 0:K.protein)??0)||0,os=Number((K==null?void 0:K.f)??(K==null?void 0:K.fat_g)??(K==null?void 0:K.fat)??0)||0,Ft=Number((K==null?void 0:K.c)??(K==null?void 0:K.carbs_g)??(K==null?void 0:K.carbs)??0)||0;return{cal:Ce,p:wt,f:os,c:Ft}},[ot]),Be=Ti({trainingRecords:O,weightRecords:B,sleepRecords:V,motivationRecords:de}),Rt=Be.daysWithTrainingData,Kt=Be.consecutiveTrainingDays,as=Be.weeklyAverage,{normalizedLastTrainingRecord:ns,normalizedLastTrainingRecordForCheckIn:gs,normalizedLastWeightRecord:yt,normalizedLastSleepRecord:Jt,normalizedLastMotivationRecord:le}=zi({lastTrainingRecord:Be.lastTrainingRecord,lastWeightRecord:Be.lastWeightRecord,lastSleepRecord:Be.lastSleepRecord,lastMotivationRecord:Be.lastMotivationRecord}),he=a.useMemo(()=>V.map(K=>({...K,sleep_quality:K.sleep_quality??0})),[V]),me=a.useMemo(()=>he.map(K=>({sleep_hours:K.sleep_hours,sleep_quality:K.sleep_quality,date:K.date})),[he]),We=a.useMemo(()=>s.filter(K=>K.user_id===t.id),[s,t.id]),Yt=a.useMemo(()=>We.filter(K=>K.priority==="high"),[We]),ls=a.useMemo(()=>B.find(K=>K.date===y),[B,y]),hs=a.useMemo(()=>{const K=Number((xe==null?void 0:xe.weight)??(xe==null?void 0:xe.weight_kg))||Number(t==null?void 0:t.weight_kg)||0;if(!K||K<=0)return null;const Ce=Number((xe==null?void 0:xe.body_fat_percent)??(xe==null?void 0:xe.body_fat_perc)),wt=Number.isFinite(Ce)&&Ce>0?Ce:null,os=Number(t==null?void 0:t.height_cm),Ft=Number.isFinite(os)&&os>0?os:null,ds=uo({weightKg:K,bodyFatPercent:wt,heightCm:Ft,age:null,sex:null,activityLevel:"moderate",goalType:"maintain"});return(ds==null?void 0:ds.target)??null},[t==null?void 0:t.weight_kg,t==null?void 0:t.height_cm,xe==null?void 0:xe.weight,xe==null?void 0:xe.weight_kg,xe==null?void 0:xe.body_fat_percent,xe==null?void 0:xe.body_fat_perc]),mt=a.useMemo(()=>O.find(K=>K.date===y)??null,[O,y]),Fs=a.useMemo(()=>mt?(mt.rpe??0)*(mt.duration_min??0):0,[mt]),bs=0;a.useMemo(()=>Xi({date:y,snapshot:v?{bmr:v.bmr,tdee:v.tdee,srpe:v.srpe,activity_factor:Number(v.activity_factor)}:null,intakeCalories:bs,fallback:{todayLoad:Fs}}),[y,v,bs,Fs]),a.useEffect(()=>{T||z||At()&&(Vt(),M(!0))},[z,T,At,Vt]);const at=a.useMemo(()=>D.length>0?D[D.length-1]:null,[D]),Xe=a.useMemo(()=>ee(),[ee]),is=a.useMemo(()=>B.length===0?null:B.reduce((K,Ce)=>!K||new Date(Ce.date)>new Date(K.date)?Ce:K,null),[B]),dt=a.useCallback(async K=>{await $({rpe:K.rpe,duration_min:K.duration_min,date:K.date,arrow_score:K.arrow_score??50,signal_score:K.signal_score??50}),await zo({userId:t.id,date:K.date,rpe:K.rpe,durationMin:K.duration_min})},[$,t.id]),jt=a.useCallback(async(K,Ce)=>{await q(K,Ce)},[q]),or=a.useCallback(async(K,Ce)=>{await q(K,Ce)},[q]),Q=a.useCallback(async K=>{await $({rpe:K.rpe,duration_min:K.duration_min,date:K.date,arrow_score:K.arrow_score??50,signal_score:K.signal_score??50})},[$]),re=a.useCallback(async(K,Ce)=>{await q(K,{rpe:Ce.rpe,duration_min:Ce.duration_min,arrow_score:Ce.arrow_score??50,signal_score:Ce.signal_score??50})},[q]),ce=y,be=a.useRef(null);a.useRef(null);const ie="absolute -left-[9999px] top-0 w-px h-px opacity-0",ve=a.useCallback(K=>{b("nutrition")},[y]);return a.useCallback(K=>{switch(K){case"jump":return"„Ç∏„É£„É≥„ÉóÊ∏¨ÂÆö";case"endurance":return"ÂÖ®Ë∫´ÊåÅ‰πÖÂäõÊ∏¨ÂÆö";case"strength":return"Á≠ãÂäõÊ∏¨ÂÆö";case"sprint":return"„Çπ„Éó„É™„É≥„ÉàÊ∏¨ÂÆö";case"agility":return"„Ç¢„Ç∏„É™„ÉÜ„Ç£Ê∏¨ÂÆö";default:return"„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ∏¨ÂÆö"}},[]),a.useEffect(()=>{},[(ze=Be.lastTrainingRecord)==null?void 0:ze.date,(Gt=Be.lastSleepRecord)==null?void 0:Gt.date,(Ls=Be.lastMotivationRecord)==null?void 0:Ls.date,Be.daysWithTrainingData,Be.consecutiveTrainingDays]),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[e.jsx("header",{className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 shadow-lg transition-colors",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{type:"button",onClick:n,className:"flex items-baseline gap-2 active:opacity-70 cursor-pointer",style:{WebkitTapHighlightColor:"transparent"},children:[e.jsx("span",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Bekuta"}),e.jsx("span",{className:"text-xs font-medium text-blue-100 hidden sm:inline",children:"by ARCA"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:Vt,className:"p-2 rounded-lg text-white/90 hover:bg-white/10 hover:text-white transition-colors","aria-label":"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´",title:"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´",children:e.jsx(Ds,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:()=>g(K=>!K),className:"p-2 rounded-lg text-white hover:bg-white/10 transition-colors","aria-label":"„É°„Éã„É•„Éº",title:"„É°„Éã„É•„Éº",children:o?e.jsx(Me,{className:"w-6 h-6"}):e.jsx(Ga,{className:"w-6 h-6"})})]})]})})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 transition-colors",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-2",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.name,"„Åï„Çì ¬∑"," ",m==="unified"?"„Åô„Åπ„Å¶„ÅÆË®òÈå≤„Çí‰∏ÄÁõÆ„ÅßÁ¢∫Ë™ç":m==="overview"?"‰ªäÊó•„ÅÆÁ∑¥Áøí„Éá„Éº„Çø„ÇíË®òÈå≤":m==="weight"?"‰ΩìÈáç„ÅÆÂ§âÂåñ„ÇíÁÆ°ÁêÜ":m==="insights"?"„Éá„Éº„Çø„Åã„ÇâÊñ∞„Åó„ÅÑÁô∫Ë¶ã„Çí":m==="performance"?"„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÇíÊ∏¨ÂÆö":m==="conditioning"?"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥ÁÆ°ÁêÜ":m==="cycle"?"ÊúàÁµåÂë®Êúü„Å®„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÇíË®òÈå≤":m==="nutrition"?"Ê†ÑÈ§äÔºöAI‰∏ãÊõ∏„Åç‚Üí„ÅÇ„Å™„Åü„ÅåÁ¢∫ÂÆö":m==="gamification"?"„Çπ„Éà„É™„Éº„ÇØ„ÄÅ„Éê„ÉÉ„Ç∏„ÄÅÁõÆÊ®ô„ÇíÁÆ°ÁêÜ":"Ë®≠ÂÆö„Å®„ÅäÁü•„Çâ„Åõ"]})})}),o&&e.jsxs("div",{className:"fixed inset-0 z-50",onClick:()=>g(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50"}),e.jsx("div",{className:"absolute top-20 right-4 bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-72 max-h-[calc(100vh-6rem)] overflow-y-auto",onClick:K=>K.stopPropagation(),children:e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{type:"button",onClick:()=>{b("unified"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="unified"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(ml,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Éõ„Éº„É†"})]}),e.jsxs("button",{type:"button",onClick:()=>{b("weight"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="weight"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"‰ΩìÈáçÁÆ°ÁêÜ"})]}),e.jsxs("button",{type:"button",onClick:()=>{b("conditioning"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="conditioning"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥ÁÆ°ÁêÜ"})]}),k==="female"&&e.jsxs("button",{type:"button",onClick:()=>{b("cycle"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="cycle"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(Bt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"ÊúàÁµåÂë®Êúü"})]}),e.jsxs("button",{type:"button",onClick:()=>{b("overview"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="overview"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Á∑¥ÁøíË®òÈå≤"})]}),_&&e.jsxs("button",{type:"button",onClick:()=>{b("ftt"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="ftt"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Éã„É•„Éº„É≠„ÉÅ„Çß„ÉÉ„ÇØÔºà10ÁßíÔºâ"})]}),S&&e.jsxs("button",{type:"button",onClick:()=>{C("nutrition"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="nutrition"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(ol,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Ê†ÑÈ§ä"})]}),e.jsxs("button",{type:"button",onClick:()=>{b("performance"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="performance"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(Ut,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ"})]}),e.jsxs("button",{type:"button",onClick:()=>{b("gamification"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="gamification"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,"data-tutorial":"gamification-tab",children:[e.jsx(tr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),e.jsxs("button",{type:"button",onClick:()=>{b("settings"),g(!1)},className:`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${m==="settings"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(Za,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Ë®≠ÂÆö"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),j&&e.jsxs("button",{type:"button",onClick:()=>{g(!1),j()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Ds,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Éò„É´„Éó„Éª„Éû„Éã„É•„Ç¢„É´"})]}),l&&e.jsxs("button",{type:"button",onClick:()=>{g(!1),l()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº"})]}),i&&e.jsxs("button",{type:"button",onClick:()=>{g(!1),i()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Et,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Âà©Áî®Ë¶èÁ¥Ñ"})]}),c&&e.jsxs("button",{type:"button",onClick:()=>{g(!1),c()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"ÁâπÂÆöÂïÜÂèñÂºïÊ≥ï„Å´Âü∫„Å•„ÅèË°®Ë®ò"})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),e.jsxs("button",{type:"button",onClick:async()=>{g(!1),await r()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(Cr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„É≠„Ç∞„Ç¢„Ç¶„Éà"})]})]})]})})]}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-4 sm:pt-4 sm:pb-8",children:m==="unified"?e.jsxs(e.Fragment,{children:[e.jsx(vi,{acwrData:D,weightRecords:B,sleepRecords:he,motivationRecords:de,trainingRecords:O,menstrualCycles:Fe,userGender:F,onOpenDetailView:K=>{K==="training"?b("overview"):K==="weight"?b("weight"):K==="conditioning"?b("conditioning"):K==="cycle"&&k==="female"&&b("cycle")},onQuickAdd:()=>u(!0)}),S&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{type:"button",onClick:()=>b("nutrition"),className:"w-full text-left","aria-label":"Ê†ÑÈ§ä„ÅÆË©≥Á¥∞„Å∏",children:e.jsx("div",{className:"rounded-xl hover:opacity-95 active:opacity-90 transition",children:e.jsx(no,{totals:ot,targets:hs,loading:ke,subtitle:ce})})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Di,{userId:t.id})}),e.jsx("div",{className:"mt-4",children:e.jsx(fa,{userId:t.id,highlight:Yt.length>0})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ni,{acwrData:D,weightRecords:B,sleepRecords:me,motivationRecords:de})}),Yt.length>0&&e.jsx("div",{className:"mt-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-6 h-6 text-red-600 dark:text-red-400 mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900 dark:text-red-200",children:"Á∑äÊÄ•Ê≥®ÊÑè"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:"ÊÄ™Êàë„ÅÆ„É™„Çπ„ÇØ„ÅåÈ´ò„Åæ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ∑¥ÁøíÂº∑Â∫¶„ÅÆË™øÊï¥„ÇíÊ§úË®é„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]})]})})]}):m==="nutrition"?S?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:e.jsx(Oo,{user:t,date:y,nutritionLogs:qe,nutritionTotals:rs,nutritionLoading:ke,nutritionError:pt,onBackHome:()=>b("unified"),latestInbody:xe??null,trainingRecords:O??[],latestWeightKg:Xe??null,onRefreshNutrition:us})}):null:m==="ftt"?_?e.jsx(wo,{userId:t.id,onBackHome:()=>b("unified")}):null:m==="overview"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[We.length>0&&e.jsx(ql,{alerts:We,onViewAll:()=>{}}),e.jsx("div",{className:"mt-3",children:e.jsx(fa,{userId:t.id,highlight:Yt.length>0})}),Yt.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-6 h-6 text-red-600 mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Á∑äÊÄ•Ê≥®ÊÑè"}),e.jsx("p",{className:"text-sm text-red-700",children:"ÊÄ™Êàë„ÅÆ„É™„Çπ„ÇØ„ÅåÈ´ò„Åæ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ∑¥ÁøíÂº∑Â∫¶„ÅÆË™øÊï¥„ÇíÊ§úË®é„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]})]})}),ls&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:"‰ªäÊó•„ÅÆ‰ΩìÈáç"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[Number(ls.weight_kg).toFixed(1)," kg"]})]}),e.jsx("button",{type:"button",onClick:()=>b("weight"),className:"text-sm text-green-600 dark:text-green-400 hover:underline",children:"‰ΩìÈáçÁÆ°ÁêÜ„Å∏ ‚Üí"})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors","data-tutorial":"training-form",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"Á∑¥ÁøíË®òÈå≤"}),e.jsx(_e,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]}),e.jsx(Ei,{daysWithData:Rt,consecutiveDays:Kt,weeklyAverage:as}),e.jsx(Rl,{userId:t.id,onSubmit:dt,onCheckExisting:P,onUpdate:jt,loading:z,lastRecord:ns,weeklyAverage:as,daysWithData:Rt,consecutiveDays:Kt})]}),at&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"ÁèæÂú®„ÅÆACWR"}),e.jsx(Ke,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 dark:text-gray-500"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl sm:text-3xl font-bold mb-2",style:{color:zt(at.riskLevel)},children:at.acwr}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:la(at.riskLevel??"unknown")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4 text-sm",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm",children:"ÊÄ•ÊÄßË≤†Ëç∑"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base dark:text-white",children:at.acuteLoad})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm",children:"ÊÖ¢ÊÄßË≤†Ëç∑"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base dark:text-white",children:at.chronicLoad})]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors","data-tutorial":"acwr-chart",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"ACWRÊé®Áßª„Ç∞„É©„Éï"}),z?e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx($l,{data:D,daysWithData:Rt,isDarkMode:Mt})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mt-6 transition-colors",children:e.jsx(Pl,{records:O,onUpdate:or,onDelete:E,loading:z,allowEdit:!0,allowDelete:!0,allowDateEdit:!1,showLimited:!0,limitCount:10})})]}):m==="weight"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[at&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"ÁèæÂú®„ÅÆACWR"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:zt(at.riskLevel)},children:at.acwr}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:la(at.riskLevel??"unknown")})]}),e.jsx("button",{type:"button",onClick:()=>b("overview"),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"Á∑¥ÁøíË®òÈå≤„Å∏ ‚Üí"})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"‰ΩìÈáç„Çµ„Éû„É™„Éº"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"ÁèæÂú®„ÅÆ‰ΩìÈáç"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:ee()!==null?`${ee().toFixed(1)} kg`:"Êú™Ë®òÈå≤"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"30Êó•Â§âÂåñ"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:ae(30)!==null?e.jsxs(e.Fragment,{children:[ae(30)>0?"+":"",ae(30).toFixed(1)," kg"]}):"-"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Ë®òÈå≤Êï∞"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:B.length})]})]})]})]}),xt?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):Te?e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300",children:["InBody„Éá„Éº„Çø„ÅÆÂèñÂæó„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„ÅüÔºö",Te]})}):xe?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ui,{latest:xe,loading:xt,error:Te}),e.jsx(Ji,{records:bt,gender:k})]}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"InBody„Éá„Éº„Çø„ÅØ„Åæ„Å†ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"})}),t.height_cm&&Xe&&e.jsx(Gl,{weightKg:Xe,heightCm:t.height_cm,dateOfBirth:t.date_of_birth,gender:F}),!t.height_cm&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 transition-colors",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Ë∫´Èï∑„ÇíË®≠ÂÆö„Åô„Çã„Å®BMI„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇË®≠ÂÆö„Çø„Éñ„Åã„Çâ„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"‰ΩìÈáçË®òÈå≤"}),e.jsx(Ve,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]}),e.jsx(zl,{onSubmit:U,onCheckExisting:W,onUpdate:Z,loading:H,lastRecord:is})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mb-6 transition-colors",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"‰ΩìÈáçÊé®Áßª„Ç∞„É©„Éï"}),H?e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-80",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx(Ol,{data:B})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:e.jsx(Bl,{records:B,onUpdate:Z,onDelete:Y,loading:H})})]})]}):m==="insights"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"‰ΩìÈáç„Å®ACWR„ÅÆÁõ∏Èñ¢„Ç∞„É©„Éï"}),z||H?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx(Wl,{acwrData:D,weightData:B})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:e.jsx(Il,{acwrData:D,weightData:B})})]}):m==="performance"?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:e.jsx(Io,{user:t,onBackHome:()=>b("unified")})}):m==="conditioning"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(pi,{latestACWR:at,sleepHours:(fs=oe())!=null&&fs.sleep_hours?Number(oe().sleep_hours):null,sleepQuality:((dr=oe())==null?void 0:dr.sleep_quality)??null,motivationLevel:(($t=Oe())==null?void 0:$t.motivation_level)??null,energyLevel:((nt=Oe())==null?void 0:nt.energy_level)??null,stressLevel:((Dt=Oe())==null?void 0:Dt.stress_level)??null}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Áù°Áú†Ë®òÈå≤"}),e.jsx(Es,{className:"w-6 h-6 text-indigo-500"})]}),e.jsx(ui,{onSubmit:I,onCheckExisting:se,onUpdate:J,loading:te,lastRecord:Jt})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Áù°Áú†Êé®Áßª„Ç∞„É©„Éï"}),te?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsx(bi,{data:V})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"7Êó•Âπ≥ÂùáÁù°Áú†ÊôÇÈñì"}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:[((ps=G(7))==null?void 0:ps.toFixed(1))||"-","h"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"7Êó•Âπ≥ÂùáÁù°Áú†„ÅÆË≥™"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[((Vr=ne(7))==null?void 0:Vr.toFixed(1))||"-","/5"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Ë®òÈå≤"}),e.jsx(et,{className:"w-6 h-6 text-blue-500"})]}),e.jsx(hi,{onSubmit:je,onCheckExisting:ye,onUpdate:st,loading:ue,lastRecord:le??void 0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Êé®Áßª„Ç∞„É©„Éï"}),ue?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx(fi,{data:de})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"Âπ≥ÂùáÊÑèÊ¨≤"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[((Kr=ct(7))==null?void 0:Kr.toFixed(1))||"-","/10"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"Âπ≥Âùá‰ΩìÂäõ"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[((Jr=Se(7))==null?void 0:Jr.toFixed(1))||"-","/10"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"Âπ≥Âùá„Çπ„Éà„É¨„Çπ"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[((Yr=rt(7))==null?void 0:Yr.toFixed(1))||"-","/10"]})]})]})]})]}):m==="cycle"?e.jsx(Eo,{userId:t.id,gender:k}):m==="gamification"?e.jsx(No,{user:t}):m==="messages"?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:e.jsx(Wo,{userId:t.id,userName:t.name,onClose:()=>b("unified")})}):m==="settings"?e.jsx(qo,{user:t,onOpenProfileEdit:()=>d(!0)}):null}),w&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:e.jsx(Bo,{user:t,trainingRecords:O,acwrData:D,onClose:()=>p(!1)})}),f&&e.jsx(Ql,{user:t,onUpdate:async()=>{await(x==null?void 0:x())},onClose:()=>d(!1)}),e.jsx(Ir,{steps:Hr("athlete"),isActive:Ht,onComplete:we,onSkip:ss,currentStepIndex:Ct,onStepChange:it}),h&&e.jsx(wi,{userId:t.id,userGender:k,onTrainingSubmit:Q,onTrainingCheckExisting:P,onTrainingUpdate:re,onWeightSubmit:U,onWeightCheckExisting:W,onWeightUpdate:Z,onSleepSubmit:I,onSleepCheckExisting:se,onSleepUpdate:J,onMotivationSubmit:je,onMotivationCheckExisting:ye,onMotivationUpdate:st,onCycleSubmit:ft,onCycleUpdate:Pe,onClose:()=>u(!1),lastTrainingRecord:gs??null,lastWeightRecord:yt?{weight_kg:Number(yt.weight_kg),date:yt.date}:null,lastSleepRecord:Jt??null,lastMotivationRecord:le??null}),m==="unified"&&e.jsx(ki,{onClick:()=>u(!0),onCameraClick:S?()=>{var K;return(K=be.current)==null?void 0:K.click()}:void 0}),e.jsx("input",{ref:be,type:"file",accept:"image/*",className:ie,onChange:K=>{var wt;const Ce=(wt=K.target.files)==null?void 0:wt[0];K.target.value="",Ce&&ve(Ce)}})]})}const Os=21;function Ho({athletes:t,onAthleteSelect:s,athleteACWRMap:r={},weekCardMap:n={}}){const[l,i]=a.useState(""),[c,j]=a.useState("all"),[x,y]=a.useState("all"),v=d=>(d==null?void 0:d.nickname)||(d==null?void 0:d.name)||"ÂêçÂâçÊú™Ë®≠ÂÆö",N=a.useMemo(()=>{const d=l.trim().toLowerCase();return t.filter(o=>{const g=r[o.id],m=(g==null?void 0:g.daysOfData)??(typeof o.training_days_28d=="number"?o.training_days_28d:null),_=m!==null&&m>=Os&&typeof(g==null?void 0:g.currentACWR)=="number"&&Number.isFinite(g.currentACWR)&&g.currentACWR>0?(g==null?void 0:g.riskLevel)??"unknown":"unknown",S=c==="all"?!0:_==="high",C=n[o.id],R=x==="all"?!0:!!(C!=null&&C.is_sharing_active),A=`${v(o)}`.toLowerCase(),T=d===""?!0:A.includes(d);return S&&R&&T})},[t,l,c,x,r,n]),w=d=>{switch(d){case"high":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700",children:"È´ò„É™„Çπ„ÇØ"});case"caution":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-700",children:"Ê≥®ÊÑè"});case"good":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",children:"ËâØÂ•Ω"});case"low":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-sky-100 text-sky-700",children:"‰ΩéË≤†Ëç∑"});default:return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-500",children:"‰∏çÊòé"})}},p=d=>{if(!d)return"Ë®òÈå≤„Å™„Åó";const o=d.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(o){const g=Number(o[2]),m=Number(o[3]);return Number.isFinite(g)&&Number.isFinite(m)?`${g}/${m}`:d}try{const g=new Date(d);return Number.isNaN(g.getTime())?d:`${g.getMonth()+1}/${g.getDate()}`}catch{return d}},h=d=>d==null||Number.isNaN(d)?"-":d.toFixed(1),u=d=>d==null||Number.isNaN(d)?"-":String(Math.round(d)),f=d=>!!(d!=null&&d.is_sharing_active)?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[e.jsx(xa,{className:"w-3 h-3"}),"ÂÖ±ÊúâON"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-600 border border-gray-200",children:[e.jsx(Ya,{className:"w-3 h-3"}),"ÂÖ±ÊúâOFF"]});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:l,onChange:d=>i(d.target.value),placeholder:"ÂêçÂâç„ÅßÊ§úÁ¥¢",className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx(Le,{className:"w-4 h-4 text-gray-400 absolute left-2.5 top-2.5"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>j("all"),className:`px-3 py-1.5 rounded-full text-xs font-medium border ${c==="all"?"bg-green-50 text-green-700 border-green-200":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50"}`,children:"ÂÖ®Âì°Ë°®Á§∫"}),e.jsxs("button",{type:"button",onClick:()=>j("high"),className:`px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 ${c==="high"?"bg-red-50 text-red-700 border-red-200":"bg-white text-gray-600 border-gray-200 hover:bg-red-50 hover:text-red-700"}`,children:[e.jsx(ge,{className:"w-3 h-3"}),"È´ò„É™„Çπ„ÇØ„ÅÆ„Åø"]}),e.jsxs("button",{type:"button",onClick:()=>y(x==="on"?"all":"on"),className:`px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 ${x==="on"?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-white text-gray-600 border-gray-200 hover:bg-emerald-50 hover:text-emerald-700"}`,title:"ÂÖ±ÊúâON„ÅÆÈÅ∏Êâã„Å†„ÅëË°®Á§∫",children:[e.jsx(xa,{className:"w-3 h-3"}),"ÂÖ±ÊúâON„ÅÆ„Åø"]})]})]}),e.jsx("div",{className:"divide-y divide-gray-100 border border-gray-100 rounded-xl bg-white",children:N.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"Êù°‰ª∂„Å´Âêà„ÅÜÈÅ∏Êâã„Åå„ÅÑ„Åæ„Åõ„Çì"}):N.map(d=>{const o=r[d.id],g=(o==null?void 0:o.daysOfData)??(typeof d.training_days_28d=="number"?d.training_days_28d:null),m=g!==null&&g>=Os&&typeof(o==null?void 0:o.currentACWR)=="number"&&Number.isFinite(o.currentACWR)&&o.currentACWR>0,b=m?(o==null?void 0:o.riskLevel)??"unknown":"unknown",_=m?o.currentACWR.toFixed(2):"Ê∫ñÂÇô‰∏≠",S=g!==null?Math.max(Os-g,0):null,C=n[d.id],R=!!(C!=null&&C.is_sharing_active),A=!R;return e.jsxs("button",{type:"button",onClick:()=>{A||s(d)},disabled:A,className:`w-full flex items-stretch justify-between px-4 sm:px-5 py-3 sm:py-4 text-left transition-colors ${A?"opacity-60 cursor-not-allowed bg-white":"hover:bg-gray-50"}`,title:A?"„Åì„ÅÆÈÅ∏Êâã„ÅØÁèæÂú®„ÄÅÂÖ±Êúâ„ÅåOFF„Åß„ÅôÔºàüîíÔºâ":"Ë©≥Á¥∞„ÇíÈñã„Åè",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:v(d)}),d.nickname&&d.name&&e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:["(",d.name,")"]}),f(C)]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-[11px] sm:text-xs text-gray-500",children:[e.jsxs("span",{children:["Áõ¥Ëøë28Êó•Ôºö ",d.training_days_28d??0,"Êó• / ",d.training_sessions_28d??0,"Âõû"]}),e.jsxs("span",{children:["ÊúÄÁµÇÂÖ•ÂäõÔºö ",p(d.last_training_date??null)]})]}),R&&C&&e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] sm:text-xs",children:[C.action_total>0?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:[e.jsx(Xt,{className:"w-3 h-3"}),"Ë°åÂãï ",C.action_done,"/",C.action_total]}):e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-50 text-gray-600 border border-gray-200",children:"Ë°åÂãï -"}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200",children:["Áù°Áú† ",h(C.sleep_hours_avg),"h / Ë≥™ ",h(C.sleep_quality_avg)]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:["„É¢„ÉÅ ",u(C.motivation_avg),"„Éª„Ç®„Éç ",u(C.energy_avg),"„Éª„Çπ„Éà ",u(C.stress_avg)]})]}),!R&&e.jsx("div",{className:"mt-2 text-[11px] sm:text-xs text-gray-500",children:"üîí ÂÖ±Êúâ„ÅåOFF„ÅÆ„Åü„ÇÅ„ÄÅË©≥Á¥∞„Éá„Éº„Çø„ÅØË°®Á§∫„Åß„Åç„Åæ„Åõ„Çì"})]}),e.jsxs("div",{className:"flex flex-col items-end justify-center ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500",children:"ACWR"}),e.jsx("span",{className:`text-sm sm:text-base font-semibold ${m?"text-gray-900":"text-gray-400"}`,children:_})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w(b),e.jsx(Tt,{className:"w-4 h-4 text-gray-300"})]}),!m&&e.jsxs("p",{className:"mt-1 text-[10px] sm:text-xs text-gray-400 text-right",children:["ACWRÊ∫ñÂÇôÔºö",g??0,"/",Os,"Êó•",S!==null&&S>0?`Ôºà„ÅÇ„Å®${S}Êó•Ôºâ`:""]})]})]},d.id)})})]})}const ka=t=>Array.from(new Set(t)).slice(0,2),_a={high:3,caution:2,low:1};function Vo(t){const{id:s,name:r,acwrInfo:n,weekCard:l,noData:i}=t,c=!!(l!=null&&l.is_sharing_active),j=(n==null?void 0:n.currentACWR)??null,x=(l==null?void 0:l.sleep_hours_avg)??null,y=(i==null?void 0:i.daysSinceLast)??null,v=[];let N=!1;if(y!=null&&y>=14&&(N=!0,v.push("Êú™ÂÖ•Âäõ")),c&&typeof j=="number"&&j>=1.5&&(N=!0,v.push("Ë≤†Ëç∑ÊÄ•Â¢ó")),c&&typeof x=="number"&&x<=5&&(N=!0,v.push("Áù°Áú†‚Üì")),N)return{id:s,name:r,riskLevel:"high",reasons:ka(v),acwr:j};let w=!1;return y!=null&&y>=7&&(w=!0,v.push("Êú™ÂÖ•Âäõ")),c&&typeof j=="number"&&j>=1.3&&(w=!0,v.push("Ë≤†Ëç∑„ÇÑ„ÇÑÈ´ò")),c&&typeof x=="number"&&x<=5.5&&(w=!0,v.push("Áù°Áú†‚Üì")),w?{id:s,name:r,riskLevel:"caution",reasons:ka(v),acwr:j}:{id:s,name:r,riskLevel:"low",reasons:[],acwr:j}}function Ko(t){switch(t){case"high":return"bg-red-50 text-red-700 border-red-200";case"caution":return"bg-amber-50 text-amber-700 border-amber-200";case"low":return"bg-emerald-50 text-emerald-700 border-emerald-200";default:return"bg-gray-50 text-gray-500 border-gray-200"}}function Jo(t){switch(t){case"high":return"È´ò„É™„Çπ„ÇØ";case"caution":return"Ê≥®ÊÑè";case"low":return"ÂÆâÂÆö";default:return"‰∏çÊòé"}}function Yo(t){const{athletes:s,riskMap:r,weekCardMap:n={}}=t;return[...s].sort((l,i)=>{var o,g,m,b,_,S,C,R;const c=((o=n[l.id])==null?void 0:o.is_sharing_active)??!0,j=((g=n[i.id])==null?void 0:g.is_sharing_active)??!0;if(!c&&j)return 1;if(c&&!j)return-1;const x=(m=r[l.id])==null?void 0:m.riskLevel,y=(b=r[i.id])==null?void 0:b.riskLevel,v=x?_a[x]:0,N=y?_a[y]:0;if(v!==N)return N-v;const w=(_=r[l.id])==null?void 0:_.acwr,p=(S=r[i.id])==null?void 0:S.acwr,h=typeof w=="number"&&Number.isFinite(w)?w:-1/0,u=typeof p=="number"&&Number.isFinite(p)?p:-1/0;if(h!==u)return u-h;const f=((C=r[l.id])==null?void 0:C.reasons.length)??0,d=((R=r[i.id])==null?void 0:R.reasons.length)??0;return f!==d?d-f:(l.name||"").localeCompare(i.name||"","ja")})}function Go(t){const s=t.reasons||[],r=s.includes("Êú™ÂÖ•Âäõ"),n=s.includes("Ë≤†Ëç∑ÊÄ•Â¢ó")||s.includes("Ë≤†Ëç∑„ÇÑ„ÇÑÈ´ò"),l=s.includes("Áù°Áú†‚Üì");return t.riskLevel==="high"?[r?"ÂÖ•Âäõ„ÅåÊ≠¢„Åæ„Å£„Å¶„ÅÑ„ÇãÁêÜÁî±„ÇíÁ¢∫Ë™çÔºà‰ΩìË™ø/Âøô„Åó„Åï/ÂÖ•ÂäõÂ∞éÁ∑öÔºâ":"‰∏ªË¶≥Áñ≤Âä¥„ÉªÁóõ„Åø„ÉªÈÅïÂíåÊÑü„ÅÆÊúâÁÑ°„ÇíÁ¢∫Ë™ç",n?"Á∑¥ÁøíÂæåRPE„ÅÆÁ¢∫Ë™çÔºãÊ¨°Âõû„ÅØÂº∑Â∫¶orÈáè„Çí‰∏ÄÊÆµËêΩ„Å®„ÅôÊ§úË®é":"‰ªäÊó•„ÄúÊòéÊó•„ÅÆÂõûÂæ©ÊåáÊ®ôÔºàÁù°Áú†/È£üÊ¨≤/Ê∞óÂàÜÔºâ„ÇíÁ¢∫Ë™ç",l?"‰ªäÂ§ú„ÅÆÁù°Áú†Á¢∫‰øùÔºàÂ∞±ÂØùÊôÇÂàª„ÅÆÊèêÊ°à„Éª„Çπ„Éû„Éõ/„Ç´„Éï„Çß„Ç§„É≥Ôºâ":"48ÊôÇÈñì„ÅÆÁµåÈÅéË¶≥ÂØüÔºàÁóáÁä∂„Åå„ÅÇ„Çå„Å∞Á∑¥ÁøíÂÜÖÂÆπË™øÊï¥Ôºâ"]:t.riskLevel==="caution"?[n?"Ê¨°Âõû„ÅÆË≤†Ëç∑„ÇíÂæÆË™øÊï¥ÔºàÈáè/Âº∑Â∫¶„ÅÆ„Å©„Å°„Çâ„Åã„ÇíËªΩ„ÅèÔºâ":"ÂõûÂæ©Áä∂Ê≥Å„Çí‰∏ÄË®Ä„Éí„Ç¢„É™„É≥„Ç∞",l?"Áù°Áú†„ÅÆÁ¢∫‰øùÔºàÊúÄ‰Ωé6hÁõÆÊ®ô„ÄÅÂ∞±ÂØùÂâç„É´„Éº„ÉÜ„Ç£„É≥Ôºâ":"Á∑¥ÁøíÂæå„ÅÆ„É™„Ç´„Éê„É™„ÉºÔºàË£úÈ£ü/ÂÖ•Êµ¥/„Çπ„Éà„É¨„ÉÉ„ÉÅÔºâ„Çí‰øÉ„Åô",r?"ÂÖ•Âäõ„ÅÆÁøíÊÖ£„Å•„ÅëÔºà„Çø„Ç§„Éü„É≥„Ç∞Âõ∫ÂÆöÔºöÁ∑¥ÁøíÂæå/Â∞±ÂØùÂâç„Å™„Å©Ôºâ":"Áä∂ÊÖã„Åå‰∏äÂêë„Åë„Å∞ÈÄöÂ∏∏ÈÅãÁî®„Å∏"]:["Áä∂ÊÖã„ÅØÂÆâÂÆö„ÄÇËâØ„ÅÑÁøíÊÖ£„ÇíÁ∂ôÁ∂ö","ËâØ„Åã„Å£„ÅüÁÇπ„Çí‰∏ÄË®Ä„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÔºàÁ∂ôÁ∂ö„ÅÆÂº∑ÂåñÔºâ","‰ªäÈÄ±„ÅÆÁõÆÊ®ô„ÇíÂÜçÁ¢∫Ë™ç„Åó„Å¶ÈÄ≤„ÇÅ„Çã"]}function Bs(t){if(!t)return"";if(typeof t=="string"){const r=t.includes("T")?t.split("T")[0]:t;if(/^\d{4}-\d{2}-\d{2}$/.test(r))return r}const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toISOString().slice(0,10)}function wr(t){const s=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!s)return t||"";const r=Number(s[2]),n=Number(s[3]);return!Number.isFinite(r)||!Number.isFinite(n)?t:`${r}/${n}`}function vr(t){return t==null||!Number.isFinite(t)?{arrow:"‚Äì",tone:"text-gray-500"}:t>0?{arrow:"‚Üë",tone:"text-red-600"}:t<0?{arrow:"‚Üì",tone:"text-emerald-600"}:{arrow:"‚Üí",tone:"text-gray-600"}}function Zo({athlete:t,onClose:s,risk:r,weekCard:n}){var $;const{records:l,weightRecords:i,acwrData:c,loading:j}=Ur(t.id),[x,y]=a.useState("overview"),v=c.length>0?c[c.length-1]:null,N=l.slice(-7),w=c.length>=2?c[c.length-2]:null,p=(v==null?void 0:v.acwr)!=null&&Number.isFinite(Number(v.acwr))?Number(v.acwr):null,h=(w==null?void 0:w.acwr)!=null&&Number.isFinite(Number(w.acwr))?Number(w.acwr):null,u=p!=null&&h!=null?p-h:null,f=vr(u),d=a.useMemo(()=>(Array.isArray(i)?i:[]).map(E=>{const D=E.weight_kg??E.weight??E.body_weight??null,B=Bs(E.date);if(!B)return null;const H=D!=null?Number(D):null;return H==null||!Number.isFinite(H)?null:{rawDate:B,date:wr(B),weight:H}}).filter(Boolean),[i]),o=d.length>0?d[d.length-1]:null,g=d.length>=2?d[d.length-2]:null,m=(o==null?void 0:o.weight)!=null&&Number.isFinite(o.weight)?o.weight:null,b=(g==null?void 0:g.weight)!=null&&Number.isFinite(g.weight)?g.weight:null,_=m!=null&&b!=null?m-b:null,S=vr(_),C=l.slice(-7),R=l.slice(-14,-7),A=q=>q.reduce((E,D)=>{const B=Number(D.rpe??D.session_rpe),H=Number(D.duration_min??D.duration_minutes??D.duration);return!Number.isFinite(B)||!Number.isFinite(H)?E:E+B*H},0),T=C.length>0?A(C):null,M=R.length>0?A(R):null,k=T!=null&&M!=null?T-M:null,F=vr(k),O=a.useMemo(()=>{if(!Array.isArray(l)||l.length===0)return[];const q={};Array.isArray(c)&&c.forEach(D=>{const B=Bs(D==null?void 0:D.date);if(!B)return;const H=D.acwr??D.ACWR??D.value??null,W=H!=null?Number(H):null;W!=null&&Number.isFinite(W)&&(q[B]=W)});const E=l.map(D=>{const B=Bs(D.date);if(!B)return null;const H=D.rpe??D.session_rpe??null,W=D.duration_min??D.duration_minutes??D.duration??null,U=H!=null?Number(H):null,Z=W!=null?Number(W):null;let Y=null;U!=null&&Z!=null&&Number.isFinite(U)&&Number.isFinite(Z)&&(Y=U*Z);const ee=q[B]!=null?q[B]:null;return Y==null&&ee==null&&U==null?null:{rawDate:B,date:wr(B),rpe:U!=null&&Number.isFinite(U)?U:null,load:Y,acwr:ee}}).filter(Boolean);return E.sort((D,B)=>D.rawDate<B.rawDate?-1:D.rawDate>B.rawDate?1:0),console.log("[AthleteDetailModal] rpeLoadAcwrChartData sample:",E.slice(0,5)),E},[l,c]),z=a.useMemo(()=>{const q=new Map;for(const D of O)q.set(D.rawDate,{...D});for(const D of d){const B=q.get(D.rawDate)??{rawDate:D.rawDate,date:D.date};q.set(D.rawDate,{...B,weight:D.weight,date:B.date??D.date})}const E=Array.from(q.values());return E.sort((D,B)=>D.rawDate<B.rawDate?-1:D.rawDate>B.rawDate?1:0),E},[O,d]);if(j)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})});const P=v?wr(Bs(v.date)):"";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),t.nickname||t.name||"ÈÅ∏Êâã"]}),e.jsx("p",{className:"text-sm text-blue-100 mt-1",children:t.email})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]}),r&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 mb-4",children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${Ko(r.riskLevel)}`,children:Jo(r.riskLevel)}),typeof r.acwr=="number"&&e.jsxs("span",{className:"text-xs text-gray-600",children:["ACWR ",e.jsx("b",{children:r.acwr.toFixed(2)})]}),(n==null?void 0:n.is_sharing_active)===!1&&e.jsx("span",{className:"text-xs px-2 py-1 rounded-full border bg-gray-50 text-gray-600 border-gray-200",children:"üîí ÂÖ±ÊúâOFF"})]}),(($=r.reasons)==null?void 0:$.length)>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:r.reasons.slice(0,2).map(q=>e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full border bg-gray-50 text-gray-700 border-gray-200",children:q},q))})]})}),e.jsxs("div",{className:"mt-3 text-sm text-gray-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Ê¨°„ÅÆ‰∏ÄÊâã"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:Go(r).map(q=>e.jsx("li",{children:q},q))})]})]}),e.jsx("div",{className:"border-b border-gray-200 px-6 pt-3",children:e.jsxs("div",{className:"flex gap-4 overflow-x-auto text-sm",children:[e.jsx("button",{onClick:()=>y("overview"),className:`pb-3 border-b-2 ${x==="overview"?"border-blue-500 text-blue-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Ê¶ÇË¶Å"}),e.jsxs("button",{onClick:()=>y("weight"),className:`pb-3 border-b-2 flex items-center gap-1 ${x==="weight"?"border-green-500 text-green-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Ve,{className:"w-4 h-4"}),"‰ΩìÈáçÊé®Áßª"]}),e.jsxs("button",{onClick:()=>y("rpe"),className:`pb-3 border-b-2 flex items-center gap-1 ${x==="rpe"?"border-purple-500 text-purple-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ia,{className:"w-4 h-4"}),"RPE / Ë≤†Ëç∑ / ACWR"]})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:[x==="overview"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-blue-700 mb-1",children:"ÊúÄÊñ∞ ACWR"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(v==null?void 0:v.acwr)!=null?Number(v.acwr).toFixed(2):"--"}),e.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[e.jsx("span",{className:`${f.tone} font-semibold`,children:f.arrow}),e.jsxs("span",{className:"text-gray-600",children:["ÂâçÂõûÊØîÔºö",e.jsx("b",{className:"ml-1",children:u!=null?`${u>=0?"+":""}${u.toFixed(2)}`:"--"})]})]}),v&&e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:P})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-green-700 mb-1",children:"Áõ¥Ëøë7Êó•Èñì„ÅÆË®òÈå≤Êï∞"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:N.length})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-gray-700 mb-1",children:"Á∑è„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.length})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-green-700 mb-1",children:"ÊúÄÊñ∞ ‰ΩìÈáç"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:m!=null?m.toFixed(1):"--"}),e.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[e.jsx("span",{className:`${S.tone} font-semibold`,children:S.arrow}),e.jsxs("span",{className:"text-gray-600",children:["ÂâçÂõûÊØîÔºö",e.jsx("b",{className:"ml-1",children:_!=null?`${_>=0?"+":""}${_.toFixed(1)}kg`:"--"})]})]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"Áõ¥Ëøë7Êó• Load"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:T!=null?Math.round(T):"--"}),e.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[e.jsx("span",{className:`${F.tone} font-semibold`,children:F.arrow}),e.jsxs("span",{className:"text-gray-600",children:["ÂâçÈÄ±ÊØîÔºö",e.jsx("b",{className:"ml-1",children:k!=null?`${k>=0?"+":""}${Math.round(k)}`:"--"})]})]})]})]})}),x==="weight"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-green-500"}),"‰ΩìÈáçÊé®Áßª Ôºã Ë≤†Ëç∑ÔºàRPE√óÊôÇÈñìÔºâ"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["‰ΩìÈáçÔºö",d.length,"‰ª∂ / „Éà„É¨„Éº„Éã„É≥„Ç∞Ôºö",O.length,"‰ª∂"]}),z.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ"}):e.jsx("div",{className:"h-72",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(Xr,{data:z,children:[e.jsx(Ye,{strokeDasharray:"3 3"}),e.jsx(Ge,{dataKey:"date"}),e.jsx(De,{yAxisId:"left",orientation:"left",tick:{fontSize:12},tickFormatter:q=>`${Math.round(q)}`}),e.jsx(De,{yAxisId:"right",orientation:"right",tick:{fontSize:12},tickFormatter:q=>`${q.toFixed(1)}`}),e.jsx(Ze,{formatter:(q,E)=>typeof q!="number"?q:E==="‰ΩìÈáç"?[q.toFixed(1),E]:[Math.round(q),E]}),e.jsx(lt,{}),e.jsx(_s,{yAxisId:"left",dataKey:"load",name:"Ë≤†Ëç∑ÔºàRPE√óÊôÇÈñìÔºâ",fill:"#60a5fa",opacity:.85}),e.jsx(fe,{yAxisId:"right",type:"monotone",dataKey:"weight",name:"‰ΩìÈáç",stroke:"#22c55e",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0})]})})}),e.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["„ÉªÈùí„ÅÑÊ£íÔºöË≤†Ëç∑ÔºàRPE√óÊôÇÈñì or load„Ç´„É©„É†Ôºâ",e.jsx("br",{}),"„ÉªÁ∑ë„ÅÆÁ∑öÔºö‰ΩìÈáçÔºàkgÔºâ",e.jsx("br",{}),"‚Äª Êó•‰ªò„ÅØYYYY-MM-DD„ÇíÊñáÂ≠óÂàóÂá¶ÁêÜ„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅJST„Åß„ÇÇ„Ç∫„É¨„Åæ„Åõ„Çì„ÄÇ"]})]}),x==="rpe"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ia,{className:"w-4 h-4 text-purple-500"}),"RPE„Éª„Çª„ÉÉ„Ç∑„Éß„É≥Ë≤†Ëç∑„ÉªACWR"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["„Éá„Éº„Çø‰ª∂Êï∞Ôºö",O.length," ‰ª∂"]}),O.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"RPE „Åæ„Åü„ÅØÁ∑¥ÁøíÊôÇÈñì„ÅåË®òÈå≤„Åï„Çå„Åü„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ"}):e.jsx("div",{className:"h-72",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(Xr,{data:O,children:[e.jsx(Ye,{strokeDasharray:"3 3"}),e.jsx(Ge,{dataKey:"date"}),e.jsx(De,{yAxisId:"left",orientation:"left",tick:{fontSize:12},tickFormatter:q=>`${Math.round(q)}`}),e.jsx(De,{yAxisId:"right",orientation:"right",tick:{fontSize:12},domain:[0,10],tickFormatter:q=>q.toFixed(1)}),e.jsx(Ze,{formatter:(q,E)=>typeof q!="number"?q:E==="ACWR"?[q.toFixed(2),E]:E==="RPE"?[q.toFixed(1),E]:[Math.round(q),E]}),e.jsx(lt,{}),e.jsx(_s,{yAxisId:"left",dataKey:"load",name:"Ë≤†Ëç∑ÔºàRPE√óÊôÇÈñìÔºâ",fill:"#60a5fa",opacity:.85}),e.jsx(fe,{yAxisId:"right",type:"monotone",dataKey:"rpe",name:"RPE",stroke:"#f97316",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0}),e.jsx(fe,{yAxisId:"right",type:"monotone",dataKey:"acwr",name:"ACWR",stroke:"#a855f7",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0}),e.jsx(Ie,{yAxisId:"right",y:.8,stroke:"#22c55e",strokeDasharray:"4 4",ifOverflow:"extendDomain"}),e.jsx(Ie,{yAxisId:"right",y:1.3,stroke:"#f97316",strokeDasharray:"4 4",ifOverflow:"extendDomain"})]})})}),e.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["„ÉªÊ£íÔºöË≤†Ëç∑ÔºàRPE √ó Á∑¥ÁøíÊôÇÈñì or loadÔºâ",e.jsx("br",{}),"„Éª„Ç™„É¨„É≥„Ç∏ÔºöRPEÔºàÂè≥Ëª∏Ôºâ",e.jsx("br",{}),"„ÉªÁ¥´ÔºöACWRÔºàÂè≥Ëª∏Ôºâ"]})]})]})]})})}const Qo=t=>t.averageRPE??t.avg_rpe??t.rpe_avg??null,Xo=t=>t.averageLoad??t.avg_load??t.load_avg??null;function ed({showRPE:t,showLoad:s,onToggle:r}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"hidden sm:inline text-xs text-gray-500 mr-1",children:"Âè≥Ëª∏„ÅÆË°®Á§∫"}),e.jsxs("button",{type:"button",onClick:()=>r("rpe"),className:["inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold","shadow-sm transition","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",t?"bg-white border-blue-200 text-blue-700":"bg-gray-50 border-gray-200 text-gray-500 hover:bg-white"].join(" "),"aria-pressed":t,children:[e.jsx("span",{className:["inline-flex h-5 w-9 items-center rounded-full p-0.5 transition",t?"bg-blue-600":"bg-gray-300"].join(" "),children:e.jsx("span",{className:["h-4 w-4 rounded-full bg-white shadow transition",t?"translate-x-4":"translate-x-0"].join(" ")})}),"Âπ≥ÂùáRPE"]}),e.jsxs("button",{type:"button",onClick:()=>r("load"),className:["inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold","shadow-sm transition","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",s?"bg-white border-emerald-200 text-emerald-700":"bg-gray-50 border-gray-200 text-gray-500 hover:bg-white"].join(" "),"aria-pressed":s,children:[e.jsx("span",{className:["inline-flex h-5 w-9 items-center rounded-full p-0.5 transition",s?"bg-emerald-600":"bg-gray-300"].join(" "),children:e.jsx("span",{className:["h-4 w-4 rounded-full bg-white shadow transition",s?"translate-x-4":"translate-x-0"].join(" ")})}),"Âπ≥ÂùáLoad"]})]})}function td({data:t,teamName:s,showAvgRPE:r=!0,showAvgLoad:n=!1}){const[l,i]=a.useState("month"),[c,j]=a.useState(r),[x,y]=a.useState(n),v=a.useMemo(()=>{if(!t||t.length===0)return[];const _=new Date;let S;switch(l){case"week":S=new Date(_),S.setDate(_.getDate()-7);break;case"month":S=new Date(_),S.setDate(_.getDate()-30);break;case"quarter":S=new Date(_),S.setDate(_.getDate()-90);break;case"all":default:return t}return t.filter(C=>{const R=new Date(C.date);return R>=S&&R<=_})},[t,l]),N=a.useMemo(()=>(v||[]).map(_=>({..._,avgRPE:Qo(_),avgLoad:Xo(_)})),[v]),w=a.useMemo(()=>(N||[]).filter(_=>!(!_||typeof _.date!="string"||typeof _.averageACWR!="number"||!Number.isFinite(_.averageACWR))).map(_=>({..._,averageACWR:Math.max(0,_.averageACWR),avgRPE:typeof _.avgRPE=="number"&&Number.isFinite(_.avgRPE)?_.avgRPE:null,avgLoad:typeof _.avgLoad=="number"&&Number.isFinite(_.avgLoad)?_.avgLoad:null})),[N]),p=a.useMemo(()=>w.some(_=>typeof _.avgRPE=="number"),[w]),h=a.useMemo(()=>w.some(_=>typeof _.avgLoad=="number"),[w]),u=!!c&&p,f=!!x&&h,d=u||f;if(!t||t.length===0)return e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-base sm:text-lg mb-2",children:"„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-sm",children:"ÈÅ∏Êâã„ÅÆÁ∑¥ÁøíË®òÈå≤„ÅåËìÑÁ©ç„Åï„Çå„Çã„Å®Âπ≥ÂùáACWR„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})});if(w.length===0)return e.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ÊúâÂäπ„Å™ACWR„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-sm",children:"Ôºà‰∏çÊ≠£„Å™Êï∞ÂÄ§„ÉªÊ¨†Êêç„Éá„Éº„Çø„ÇíÈô§Â§ñ„Åó„Åæ„Åó„ÅüÔºâ"})]})});const o=_=>{const S=new Date(_);return`${S.getMonth()+1}/${S.getDate()}`},g=_=>{const S=new Date(_),R=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"][S.getDay()];return`${S.getMonth()+1}/${S.getDate()}(${R})`},m=({active:_,payload:S,label:C})=>{var R;if(_&&S&&S.length){const A=(R=S==null?void 0:S[0])==null?void 0:R.payload,T=new Date(C),M=T.getDay()===0||T.getDay()===6,k=A==null?void 0:A.averageACWR,F=A==null?void 0:A.avgRPE,O=A==null?void 0:A.avgLoad;return e.jsxs("div",{className:"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base",children:g(C)}),M&&e.jsx("span",{className:"bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-medium",children:"ÈÄ±Êú´"})]}),e.jsxs("div",{className:"space-y-1 text-xs sm:text-sm",children:[e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"Âπ≥ÂùáACWR:"}),e.jsx("span",{className:"font-semibold",style:{color:zt(A==null?void 0:A.riskLevel)},children:typeof k=="number"?k.toFixed(2):"-"})]}),u&&e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"Âπ≥ÂùáRPE:"}),e.jsx("span",{className:"font-semibold",children:typeof F=="number"?F.toFixed(2):"-"})]}),f&&e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"Âπ≥ÂùáLoad:"}),e.jsx("span",{className:"font-semibold",children:typeof O=="number"?Math.round(O):"-"})]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"Âπ≥Âùá„Å´‰ΩøÁî®:"}),e.jsxs("span",{className:"font-semibold",children:[A==null?void 0:A.athleteCount," / ",(A==null?void 0:A.rosterCount)??"-","Âêç"]})]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{children:"„É™„Çπ„ÇØ„É¨„Éô„É´:"}),e.jsx("span",{className:"font-semibold",style:{color:zt(A==null?void 0:A.riskLevel)},children:sd(A==null?void 0:A.riskLevel)})]})]})]})}return null},b=_=>{const{cx:S,cy:C,payload:R}=_;if(S&&C&&R){const A=new Date(R.date),T=A.getDay()===0||A.getDay()===6;return e.jsx("circle",{cx:S,cy:C,r:T?5:4,fill:zt(R.riskLevel),strokeWidth:2,stroke:T?"#8B5CF6":"white",opacity:T?.9:1})}return null};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 truncate",children:[e.jsxs("span",{className:"hidden sm:inline",children:[s," - "]}),"„ÉÅ„Éº„É†Âπ≥ÂùáACWRÊé®Áßª"]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:["Â∑¶Ëª∏ÔºöACWR",d?" / Âè≥Ëª∏ÔºöRPE„ÉªLoad":""]})]}),e.jsx(ed,{showRPE:c,showLoad:x,onToggle:_=>{_==="rpe"&&j(S=>!S),_==="load"&&y(S=>!S)}})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rr,{className:"w-4 h-4 text-gray-500"}),e.jsx("div",{className:"flex space-x-1",children:[{value:"week",label:"1ÈÄ±Èñì"},{value:"month",label:"1„É∂Êúà"},{value:"quarter",label:"3„É∂Êúà"},{value:"all",label:"ÂÖ®ÊúüÈñì"}].map(_=>e.jsx("button",{onClick:()=>i(_.value),className:`px-3 py-1 rounded-lg text-xs font-medium transition-colors ${l===_.value?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:_.label},_.value))})]}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-600 font-medium",children:"Ë°®Á§∫ÊúüÈñì:"}),e.jsx("span",{className:"text-purple-800 ml-1",children:l==="week"?"ÈÅéÂéª7Êó•Èñì":l==="month"?"ÈÅéÂéª30Êó•Èñì":l==="quarter"?"ÈÅéÂéª90Êó•Èñì":"ÂÖ®ÊúüÈñì"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-600 font-medium",children:"„Éá„Éº„ÇøÊï∞:"}),e.jsxs("span",{className:"text-purple-800 ml-1",children:[w.length,"Êó•"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full border-2 border-purple-600"}),e.jsx("span",{className:"text-xs text-purple-600",children:"ÈÄ±Êú´„ÅØÁ¥´„ÅÆÊû†„ÅßÂº∑Ë™ø"})]})]})}),c&&!p||x&&!h?e.jsx("div",{className:"text-xs bg-amber-50 border border-amber-200 text-amber-800 rounded-lg px-3 py-2",children:"Ë°®Á§∫ON„ÅÆÊåáÊ®ô„Åå„Éá„Éº„Çø„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàÂπ≥ÂùáRPE/Âπ≥ÂùáLoad„ÅÆÂàó„ÅåÊú™ÂèñÂæó„ÅÆÂèØËÉΩÊÄßÔºâ„ÄÇ"}):null]}),e.jsx("div",{className:"h-64 sm:h-96",children:e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(St,{data:w,margin:{top:20,right:36,left:20,bottom:20},children:[e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Ge,{dataKey:"date",tickFormatter:o,stroke:"#6b7280",fontSize:10,interval:"preserveStartEnd"}),e.jsx(De,{yAxisId:"acwr",domain:[0,_=>Number.isFinite(_)?_+.5:2],stroke:"#6b7280",fontSize:10,width:40}),e.jsx(De,{yAxisId:"aux",orientation:"right",domain:[0,_=>Number.isFinite(_)?_:10],stroke:"#6b7280",fontSize:10,width:40,hide:!d}),e.jsx(Ze,{content:e.jsx(m,{})}),e.jsx(lt,{}),e.jsx(Ie,{yAxisId:"acwr",y:1.5,stroke:"#EF4444",strokeDasharray:"5 5"}),e.jsx(Ie,{yAxisId:"acwr",y:1.3,stroke:"#F59E0B",strokeDasharray:"5 5"}),e.jsx(Ie,{yAxisId:"acwr",y:.8,stroke:"#10B981",strokeDasharray:"5 5"}),e.jsx(fe,{type:"monotone",dataKey:"averageACWR",name:"Âπ≥ÂùáACWR",yAxisId:"acwr",stroke:"#8B5CF6",strokeWidth:3,dot:e.jsx(b,{}),activeDot:{r:6,stroke:"#8B5CF6",strokeWidth:2,fill:"white"},connectNulls:!0}),u&&e.jsx(fe,{type:"monotone",dataKey:"avgRPE",name:"Âπ≥ÂùáRPE",yAxisId:"aux",stroke:"#0EA5E9",strokeWidth:2,dot:!1,connectNulls:!0}),f&&e.jsx(fe,{type:"monotone",dataKey:"avgLoad",name:"Âπ≥ÂùáLoad",yAxisId:"aux",stroke:"#22C55E",strokeWidth:2,dot:!1,connectNulls:!0})]})})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsx("span",{children:"È´ò„É™„Çπ„ÇØ (>1.5)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),e.jsx("span",{children:"Ê≥®ÊÑè (1.3-1.5)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),e.jsx("span",{children:"ËâØÂ•Ω (0.8-1.3)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{children:"‰ΩéË≤†Ëç∑ (<0.8)"})]})]})})]})}function sd(t){switch(t){case"high":return"È´ò„É™„Çπ„ÇØ";case"caution":return"Ê≥®ÊÑè";case"good":return"ËâØÂ•Ω";case"low":return"‰ΩéË≤†Ëç∑";default:return"‰∏çÊòé"}}const Sa={high:3,medium:2,low:1};function Ws(t){return t==="high"||t==="medium"||t==="low"}function Ca(t,s){return Sa[s]-Sa[t]}function dn({alerts:t,onMarkAsRead:s,onDismiss:r,onMarkAllAsRead:n,onClose:l,userRole:i,selectedUserId:c,userNameMap:j={}}){const[x,y]=a.useState("all"),[v,N]=a.useState(!1),[w,p]=a.useState({}),h=C=>{const R=new Date,A=new Date(C),T=Math.floor((R.getTime()-A.getTime())/(1e3*60));if(T<1)return"„Åü„Å£„Åü‰ªä";if(T<60)return`${T}ÂàÜÂâç`;const M=Math.floor(T/60);return M<24?`${M}ÊôÇÈñìÂâç`:`${Math.floor(M/24)}Êó•Ââç`},u=C=>{p(R=>({...R,[C]:!R[C]}))},f=C=>C.user_id??C.target_user_id??C.athlete_id,d=a.useMemo(()=>t.filter(C=>!(!v&&C.is_dismissed)),[t,v]),o=a.useMemo(()=>c?d.filter(C=>f(C)===c):d,[d,c]),g=a.useMemo(()=>o.filter(C=>!C.is_read&&!C.is_dismissed).length,[o]),m=a.useMemo(()=>o.filter(C=>C.priority==="high"&&!C.is_dismissed).length,[o]),b=a.useMemo(()=>{const C=new Map;for(const A of o){const T=f(A);T&&(C.has(T)||C.set(T,[]),C.get(T).push(A))}const R=[];for(const[A,T]of C.entries()){const k=T.map(P=>Ws(P.priority)?P.priority:"low").sort(Ca)[0]??"low",F=T.filter(P=>(Ws(P.priority)?P.priority:"low")===k).sort((P,$)=>new Date($.created_at).getTime()-new Date(P.created_at).getTime()),O=T.filter(P=>(Ws(P.priority)?P.priority:"low")==="medium").sort((P,$)=>new Date($.created_at).getTime()-new Date(P.created_at).getTime()),z=T.filter(P=>(Ws(P.priority)?P.priority:"low")==="low").sort((P,$)=>new Date($.created_at).getTime()-new Date(P.created_at).getTime());R.push({userId:A,topPriority:k,topAlerts:F,included:{medium:k==="high"?O:[],low:k!=="low"?z:[]},totalCount:T.length,unreadCount:T.filter(P=>!P.is_read).length})}return R.sort((A,T)=>{var O,z;const M=Ca(A.topPriority,T.topPriority);if(M!==0)return M;if(T.unreadCount!==A.unreadCount)return T.unreadCount-A.unreadCount;const k=new Date(((O=A.topAlerts[0])==null?void 0:O.created_at)??0).getTime();return new Date(((z=T.topAlerts[0])==null?void 0:z.created_at)??0).getTime()-k})},[o]),_=a.useMemo(()=>b.filter(C=>x==="unread"?C.unreadCount>0:x==="high"||x==="medium"||x==="low"?C.topPriority===x:!0),[b,x]),S=!!c;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-blue-500 rounded-full p-3",children:e.jsx(Ke,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:S?"ÈÅ∏Êâã„Ç¢„É©„Éº„ÉàË©≥Á¥∞":"„Ç¢„É©„Éº„ÉàÈÄöÁü•"}),e.jsxs("p",{className:"text-blue-100",children:[g>0?`${g}‰ª∂„ÅÆÊú™Ë™≠ÈÄöÁü•`:"ÂÖ®„Å¶Á¢∫Ë™çÊ∏à„Åø",m>0&&e.jsxs("span",{className:"ml-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs",children:["È´òÂÑ™ÂÖàÂ∫¶ ",m,"‰ª∂"]})]})]})]}),e.jsx("button",{onClick:l,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:e.jsx(Me,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center space-x-2",children:[e.jsx(rr,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:x,onChange:C=>y(C.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:S?"ÂÖ®„Å¶Ôºà„Åì„ÅÆÈÅ∏ÊâãÔºâ":"ÂÖ®„Å¶ÔºàÈÅ∏ÊâãÂçò‰ΩçÔºâ"}),e.jsx("option",{value:"unread",children:S?"Êú™Ë™≠„ÅÆ„ÅøÔºà„Åì„ÅÆÈÅ∏ÊâãÔºâ":"Êú™Ë™≠„ÅÇ„ÇäÔºàÈÅ∏ÊâãÔºâ"}),e.jsx("option",{value:"high",children:"È´ò„É™„Çπ„ÇØ"}),e.jsx("option",{value:"medium",children:"‰∏≠„É™„Çπ„ÇØ"}),e.jsx("option",{value:"low",children:"‰Ωé„É™„Çπ„ÇØ"})]}),e.jsxs("label",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:C=>N(C.target.checked),className:"rounded"}),e.jsx("span",{children:"ÈùûË°®Á§∫„ÇíÂê´„ÇÄ"})]})]}),e.jsx("div",{className:"flex space-x-2",children:g>0&&e.jsxs("button",{onClick:n,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center space-x-1",children:[e.jsx(qt,{className:"w-4 h-4"}),e.jsx("span",{children:"ÂÖ®„Å¶Êó¢Ë™≠"})]})})]})}),e.jsx("div",{className:"overflow-y-auto max-h-[60vh] p-6",children:_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(Ke,{className:"w-16 h-16 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:x==="unread"?"Êú™Ë™≠„ÅÆÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì":"ÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-gray-600",children:x==="unread"?"ÂÖ®„Å¶„ÅÆÈÄöÁü•„ÇíÁ¢∫Ë™çÊ∏à„Åø„Åß„Åô„ÄÇ":"„Ç∑„Çπ„ÉÜ„É†„ÅåÁ∂ôÁ∂öÁöÑ„Å´Áõ£Ë¶ñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"})]}):e.jsx("div",{className:"space-y-4",children:_.map(C=>{const R=C.topAlerts[0],A=ks(R||{priority:C.topPriority}),T=j[C.userId]??"ÂØæË±°„É¶„Éº„Ç∂„Éº",M=!!w[C.userId];return e.jsxs("div",{className:`${A.bgColor} ${A.borderColor} border rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:A.icon}),e.jsx("h3",{className:`font-semibold ${A.textColor}`,children:i!=="athlete"?T:R==null?void 0:R.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${A.bgColor} ${A.textColor} border ${A.borderColor}`,children:C.topPriority==="high"?"È´ò„É™„Çπ„ÇØ":C.topPriority==="medium"?"‰∏≠„É™„Çπ„ÇØ":"‰Ωé„É™„Çπ„ÇØ"}),C.unreadCount>0&&e.jsxs("span",{className:"ml-1 inline-flex items-center text-xs",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full mr-2"}),e.jsxs("span",{className:"text-gray-600",children:["Êú™Ë™≠ ",C.unreadCount]})]}),C.included.medium.length+C.included.low.length>0&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["Èñ¢ÈÄ£Ë¶ÅÂõ† ",C.included.medium.length+C.included.low.length,"‰ª∂"]})]}),e.jsxs("div",{className:"space-y-2",children:[C.topAlerts.slice(0,2).map(k=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${A.bgColor} ${A.textColor} border ${A.borderColor}`,children:cr(k.type)}),e.jsx("span",{className:`font-semibold ${A.textColor}`,children:k.title})]}),e.jsx("p",{className:`${A.textColor} mt-1`,children:k.message}),k.acwr_value&&e.jsx("div",{className:"bg-white bg-opacity-50 rounded p-2 mt-2",children:e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ACWRÂÄ§:"}),e.jsx("span",{className:`font-bold ml-1 ${A.textColor}`,children:k.acwr_value})]}),k.threshold_exceeded&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ÈñæÂÄ§:"}),e.jsx("span",{className:"font-medium ml-1",children:k.threshold_exceeded})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(gt,{className:"w-3 h-3"}),e.jsx("span",{children:h(k.created_at)})]}),i!=="athlete"&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(en,{className:"w-3 h-3"}),e.jsx("span",{children:T})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[!k.is_read&&e.jsx("button",{onClick:()=>s(k.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${A.iconColor}`,title:"Êó¢Ë™≠„Å´„Åô„Çã",children:e.jsx(Qt,{className:"w-4 h-4"})}),!k.is_dismissed&&e.jsx("button",{onClick:()=>r(k.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${A.iconColor}`,title:"ÈùûË°®Á§∫„Å´„Åô„Çã",children:e.jsx(Zt,{className:"w-4 h-4"})})]})]},k.id)),C.topAlerts.length>2&&e.jsxs("div",{className:"text-xs text-gray-600",children:["„Åª„Åã ",C.topAlerts.length-2," ‰ª∂„ÅÆÂêåÂÑ™ÂÖàÂ∫¶„Ç¢„É©„Éº„Éà„Åå„ÅÇ„Çä„Åæ„Åô"]})]})]}),C.included.medium.length+C.included.low.length>0&&e.jsx("button",{onClick:()=>u(C.userId),className:"ml-4 text-gray-700 hover:text-gray-900 flex items-center space-x-1",title:"Èñ¢ÈÄ£Ë¶ÅÂõ†„ÇíË°®Á§∫",children:M?e.jsx(qr,{className:"w-5 h-5"}):e.jsx(Tt,{className:"w-5 h-5"})})]}),C.included.medium.length+C.included.low.length>0&&M&&e.jsxs("div",{className:"mt-4 bg-white bg-opacity-60 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-3",children:"Èñ¢ÈÄ£Ë¶ÅÂõ†ÔºàÂèÇËÄÉÔºâ"}),C.included.medium.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["‰∏≠„É™„Çπ„ÇØÔºà",C.included.medium.length,"Ôºâ"]}),e.jsx("div",{className:"space-y-3",children:C.included.medium.map(k=>{const F=ks(k);return e.jsxs("div",{className:`${F.bgColor} ${F.borderColor} border rounded p-3`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-base",children:F.icon}),e.jsx("span",{className:`text-sm font-semibold ${F.textColor}`,children:k.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${F.bgColor} ${F.textColor} border ${F.borderColor}`,children:cr(k.type)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!k.is_read&&e.jsx("button",{onClick:()=>s(k.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${F.iconColor}`,title:"Êó¢Ë™≠„Å´„Åô„Çã",children:e.jsx(Qt,{className:"w-4 h-4"})}),!k.is_dismissed&&e.jsx("button",{onClick:()=>r(k.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${F.iconColor}`,title:"ÈùûË°®Á§∫„Å´„Åô„Çã",children:e.jsx(Zt,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:`${F.textColor} mt-2 text-sm`,children:k.message}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mt-2",children:[e.jsx(gt,{className:"w-3 h-3"}),e.jsx("span",{children:h(k.created_at)})]})]},k.id)})})]}),C.included.low.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["‰Ωé„É™„Çπ„ÇØÔºà",C.included.low.length,"Ôºâ"]}),e.jsx("div",{className:"space-y-3",children:C.included.low.map(k=>{const F=ks(k);return e.jsxs("div",{className:`${F.bgColor} ${F.borderColor} border rounded p-3`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-base",children:F.icon}),e.jsx("span",{className:`text-sm font-semibold ${F.textColor}`,children:k.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${F.bgColor} ${F.textColor} border ${F.borderColor}`,children:cr(k.type)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!k.is_read&&e.jsx("button",{onClick:()=>s(k.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${F.iconColor}`,title:"Êó¢Ë™≠„Å´„Åô„Çã",children:e.jsx(Qt,{className:"w-4 h-4"})}),!k.is_dismissed&&e.jsx("button",{onClick:()=>r(k.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${F.iconColor}`,title:"ÈùûË°®Á§∫„Å´„Åô„Çã",children:e.jsx(Zt,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:`${F.textColor} mt-2 text-sm`,children:k.message}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mt-2",children:[e.jsx(gt,{className:"w-3 h-3"}),e.jsx("span",{children:h(k.created_at)})]})]},k.id)})})]})]})]},C.userId)})})}),e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Ë°®Á§∫‰∏≠: ",_.length,S?"Ôºà„Åì„ÅÆÈÅ∏ÊâãÔºâ":"‰∫∫"," / ÂØæË±°: ",b.length,S?"":"‰∫∫","Ôºà„Ç¢„É©„Éº„ÉàÁ∑èÊï∞: ",o.length,"‰ª∂Ôºâ"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{children:"È´òÂÑ™ÂÖàÂ∫¶"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-100 border border-yellow-200 rounded"}),e.jsx("span",{children:"‰∏≠ÂÑ™ÂÖàÂ∫¶"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-200 rounded"}),e.jsx("span",{children:"‰ΩéÂÑ™ÂÖàÂ∫¶"})]})]})]})})]})})}const rd=Object.freeze(Object.defineProperty({__proto__:null,AlertPanel:dn},Symbol.toStringTag,{value:"Module"}));class ws extends Ae.Component{constructor(){super(...arguments);Zr(this,"state",{hasError:!1,message:""})}static getDerivedStateFromError(r){return{hasError:!0,message:String((r==null?void 0:r.message)||r)}}componentDidCatch(r){console.error(`[ChartErrorBoundary] ${this.props.name}`,r)}render(){return this.state.hasError?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:["„ÉÅ„É£„Éº„ÉàÊèèÁîª„Ç®„É©„ÉºÔºö",this.props.name,e.jsx("div",{className:"text-xs mt-1 opacity-80",children:this.state.message})]}):this.props.children}}const ad=t=>Math.round(t*100)/100,Is=t=>{if(t==null)return null;const s=typeof t=="number"?t:Number(t);return Number.isFinite(s)?s:null},nd=t=>t==null||!Number.isFinite(t)||t<=0?"unknown":t>=1.5?"high":t>=1.3?"caution":t>=.8?"good":"low",Ma=t=>new Date(t.toLocaleString("en-US",{timeZone:"Asia/Tokyo"})).toISOString().slice(0,10);function ld(t){const[s,r]=a.useState([]),[n,l]=a.useState({}),[i,c]=a.useState(!1),j=a.useRef(0);return a.useEffect(()=>{if(!t){r([]),l({}),c(!1);return}const x=++j.current;c(!0),r([]),l({}),(async()=>{try{const y=new Date,v=new Date(y);v.setDate(v.getDate()-90);const N=Ma(v),w=Ma(y),{data:p,error:h}=await L.from("team_acwr_daily").select("team_id,date,average_acwr,athlete_count").eq("team_id",t).gte("date",N).lte("date",w).order("date",{ascending:!0});if(h)throw h;if(j.current!==x)return;const u=(p||[]).map(d=>{const o=Is(d.average_acwr),g=Is(d.athlete_count);return{date:d.date,averageACWR:o!=null?ad(o):NaN,athleteCount:g!=null?Math.max(0,Math.round(g)):0,riskLevel:nd(o),averageRPE:null,averageLoad:null}}).filter(d=>Number.isFinite(d.averageACWR));let f=u;try{const{data:d,error:o}=await L.from("team_training_daily").select("team_id,date,average_rpe,average_load,athlete_count").eq("team_id",t).gte("date",N).lte("date",w).order("date",{ascending:!0});if(o)throw o;if(j.current!==x)return;const g=new Map;(d||[]).forEach(m=>g.set(m.date,m)),f=u.map(m=>{const b=g.get(m.date);return{...m,averageRPE:Is(b==null?void 0:b.average_rpe)??null,averageLoad:Is(b==null?void 0:b.average_load)??null}})}catch{f=u}if(j.current!==x)return;r(f),l({})}catch(y){console.error("[useTeamACWR] fetch failed",y),j.current===x&&(r([]),l({}))}finally{j.current===x&&c(!1)}})()},[t]),{teamACWRData:s,athleteACWRMap:n,loading:i}}const He={async getUserOrganizations(t){const{data:s,error:r}=await L.rpc("get_user_organizations",{user_uuid:t});if(r)throw r;return s},async getOrganizationHierarchy(t){const{data:s,error:r}=await L.rpc("get_organization_hierarchy",{org_id:t});if(r)throw r;return s},async getOrganizations(){const{data:t,error:s}=await L.from("organizations").select("*").order("name");if(s)throw console.error("Organizations query error:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),new Error(`Failed to load organizations: ${s.message} (${s.code})`);return t},async getOrganizationById(t){const{data:s,error:r}=await L.from("organizations").select("*").eq("id",t).maybeSingle();if(r)throw r;return s},async createOrganization(t){const{data:s,error:r}=await L.from("organizations").insert(t).select().single();if(r)throw r;return s},async updateOrganization(t,s){const{data:r,error:n}=await L.from("organizations").update(s).eq("id",t).select().single();if(n)throw n;return r},async deleteOrganization(t){const{error:s}=await L.from("organizations").delete().eq("id",t);if(s)throw s},async getOrganizationTeams(t){const{data:s,error:r}=await L.from("teams").select("*").eq("organization_id",t).order("name");if(r)throw console.error("Organization teams query error:",{message:r.message,details:r.details,hint:r.hint,code:r.code}),new Error(`Failed to load organization teams: ${r.message}`);return s},async getTeamById(t){const{data:s,error:r}=await L.from("teams").select("*").eq("id",t).maybeSingle();if(r)throw r;return s},async createTeam(t){const s={name:t.name,organization_id:t.organization_id,department_id:t.department_id};console.log("Creating team with data:",s);const{data:r,error:n}=await L.from("teams").insert(s).select().single();if(n)throw console.error("Team creation error:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),n;return console.log("Team created successfully:",r),r},async updateTeam(t,s){const{data:r,error:n}=await L.from("teams").update(s).eq("id",t).select().single();if(n)throw n;return r},async deleteTeam(t){const{error:s}=await L.from("teams").delete().eq("id",t);if(s)throw s},async getOrganizationMembers(t){const{data:s,error:r}=await L.from("organization_members").select(`
        *,
        users:user_id (
          id,
          user_id,
          name,
          email,
          role
        )
      `).eq("organization_id",t).order("created_at",{ascending:!1});if(r)throw r;return s},async addOrganizationMember(t){const{data:s,error:r}=await L.from("organization_members").insert(t).select().single();if(r)throw r;return s},async updateOrganizationMemberRole(t,s){const{data:r,error:n}=await L.from("organization_members").update({role:s}).eq("id",t).select().single();if(n)throw n;return r},async removeOrganizationMember(t){const{error:s}=await L.from("organization_members").delete().eq("id",t);if(s)throw s},async getOrganizationStats(){const{data:t,error:s}=await L.from("organization_stats").select("*").order("name");if(s)throw s;return t},async checkOrphanedRecords(){const{data:t,error:s}=await L.rpc("check_orphaned_records");if(s)throw s;return t},async assignTeamToOrganization(t,s){const{data:r,error:n}=await L.from("teams").update({organization_id:s}).eq("id",t).select().single();if(n)throw n;return r}};function ir(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null);a.useEffect(()=>{if(!t){l(!1);return}j()},[t]);const j=async()=>{var N,w;try{l(!0),c(null);const{data:{session:p}}=await(await Qe(async()=>{const{supabase:u}=await Promise.resolve().then(()=>Tn);return{supabase:u}},void 0)).supabase.auth.getSession();console.log("Auth state when loading organizations:",{hasSession:!!p,userId:(N=p==null?void 0:p.user)==null?void 0:N.id,email:(w=p==null?void 0:p.user)==null?void 0:w.email});const h=await He.getOrganizations();console.log("Organizations loaded successfully:",h.length),r(h)}catch(p){const h=p instanceof Error?p.message:"Failed to load organizations";c(h),console.error("Error loading organizations:",{error:p,message:h,stack:p instanceof Error?p.stack:void 0})}finally{l(!1)}};return{organizations:s,loading:n,error:i,createOrganization:async(N,w)=>{try{const p=await He.createOrganization({name:N,description:w||""});return r(h=>[...h,p].sort((u,f)=>u.name.localeCompare(f.name))),p}catch(p){const h=p instanceof Error?p.message:"Failed to create organization";throw c(h),new Error(h)}},updateOrganization:async(N,w)=>{try{const p=await He.updateOrganization(N,w);return r(h=>h.map(u=>u.id===N?p:u).sort((u,f)=>u.name.localeCompare(f.name))),p}catch(p){const h=p instanceof Error?p.message:"Failed to update organization";throw c(h),new Error(h)}},deleteOrganization:async N=>{try{await He.deleteOrganization(N),r(w=>w.filter(p=>p.id!==N))}catch(w){const p=w instanceof Error?w.message:"Failed to delete organization";throw c(p),new Error(p)}},reload:j}}function cn(t){const[s,r]=a.useState([]),[n,l]=a.useState(!0),[i,c]=a.useState(null),j=a.useCallback(async()=>{if(t)try{l(!0),c(null);const N=await He.getOrganizationTeams(t);console.log("Teams loaded:",N),r(N)}catch(N){c(N instanceof Error?N.message:"Failed to load teams"),console.error("Error loading teams:",N)}finally{l(!1)}},[t]);return a.useEffect(()=>{if(!t){r([]),l(!1);return}j()},[t,j]),{teams:s,loading:n,error:i,createTeam:async N=>{if(!t)throw new Error("Organization ID is required");try{const w=await He.createTeam({organization_id:t,name:N});return console.log("New team created, reloading teams..."),await j(),console.log("Teams reloaded after creation"),w}catch(w){const p=w instanceof Error?w.message:"Failed to create team";throw c(p),new Error(p)}},updateTeam:async(N,w)=>{try{const p=await He.updateTeam(N,w);return await j(),p}catch(p){const h=p instanceof Error?p.message:"Failed to update team";throw c(h),new Error(h)}},deleteTeam:async N=>{try{await He.deleteTeam(N),r(w=>w.filter(p=>p.id!==N))}catch(w){const p=w instanceof Error?w.message:"Failed to delete team";throw c(p),new Error(p)}},reload:j}}const id=(t,s)=>{const r=[];for(let n=0;n<t.length;n+=s)r.push(t.slice(n,n+s));return r},Us=(t,s,r)=>Math.max(s,Math.min(r,t)),Hs=(t,s)=>s>0?t/s:0;function od(t){const s=new Date(`${t}T00:00:00+09:00`),n=(s.getDay()+6)%7,l=new Date(s);l.setDate(s.getDate()-n);const i=new Date(l);i.setDate(l.getDate()+6);const c=j=>new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(j);return{start:c(l),end:c(i)}}function dd(t){const{baseDate:s,athleteIds:r}=t,[n,l]=a.useState([]),[i,c]=a.useState(!1),[j,x]=a.useState(null),y=a.useMemo(()=>s?od(s):{start:"",end:""},[s]),v=a.useMemo(()=>(Array.isArray(r)?r:[]).slice().sort().join(","),[r]);return a.useEffect(()=>{const N=v?v.split(",").filter(Boolean):[];if(!y.start||!y.end||N.length===0){l([]),c(!1),x(null);return}let w=!1;return(async()=>{try{c(!0),x(null);const p=[];for(const o of id(N,50)){const{data:g,error:m}=await L.from("training_records").select("user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score").in("user_id",o).gte("date",y.start).lte("date",y.end);if(m)throw m;p.push(...g??[])}if(w)return;const h=new Map;for(const o of p){const g=o.intent_signal??o.signal_score??50,m=o.growth_vector??o.arrow_score??50,b=typeof o.load=="number"&&isFinite(o.load)?o.load:(o.rpe??0)*(o.duration_min??0),_=Us(Number(g)||50,0,100),S=Us(Number(m)||50,0,100),C=Us(Number(b)||0,0,999999),R=Us(Number(o.rpe)||0,0,10),A=o.date,T=h.get(A)??{sumX:0,sumY:0,sumLoad:0,sumRpe:0,n:0};T.sumX+=_,T.sumY+=S,T.sumLoad+=C,T.sumRpe+=R,T.n+=1,h.set(A,T)}const u=[],f=new Date(`${y.start}T00:00:00+09:00`);for(let o=0;o<7;o++){const g=new Date(f);g.setDate(f.getDate()+o);const m=new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(g);u.push(m)}const d=u.map(o=>{const g=h.get(o);return!g||g.n===0?{date:o,x:50,y:50,load:0,rpe:0,n:0}:{date:o,x:Math.round(Hs(g.sumX,g.n)*10)/10,y:Math.round(Hs(g.sumY,g.n)*10)/10,load:Math.round(Hs(g.sumLoad,g.n)),rpe:Math.round(Hs(g.sumRpe,g.n)*10)/10,n:g.n}});l(d)}catch(p){console.error("[useWeeklyGrowthCycle] error",p),w||(x((p==null?void 0:p.message)??"ÈÄ±„Éá„Éº„ÇøÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),l([]))}finally{w||c(!1)}})(),()=>{w=!0}},[y.start,y.end,v]),{weekRange:y,teamDaily:n,loading:i,error:j}}const cd=(t,s,r)=>Math.max(s,Math.min(r,t));function xd(t,s){return!isFinite(t)||t<=0||!isFinite(s)||s<=0?5:5+cd(t/s,0,1)*13}function md(t){const{teamDaily:s,weekLabel:r}=t,n=a.useMemo(()=>s!=null&&s.length?Math.max(...s.map(c=>c.load??0),0):0,[s]),l=a.useMemo(()=>(s??[]).map(c=>({...c,name:c.n>0?c.date:`${c.date}Ôºà„Éá„Éº„Çø„Å™„ÅóÔºâ`,opacity:c.n>0?.55:.12})),[s]),i=a.useMemo(()=>(s??[]).map(c=>({date:c.date.slice(5),load:c.load,growth:c.y,understanding:c.x,n:c.n})),[s]);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:["ÈÄ±„Çµ„Ç§„ÇØ„É´Ôºà",r,"Ôºâ"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"‰∏äÔºöÊó•Âà•Âπ≥Âùá„ÅÆ„Éû„Éà„É™„ÇØ„ÇπÔºàÁÇπ„Çµ„Ç§„Ç∫ÔºùË≤†Ëç∑ loadÔºâ / ‰∏ãÔºöÈÄ±„ÅÆÊé®ÁßªÔºàload„ÉªÊàêÈï∑„ÉªÁêÜËß£Ôºâ"})]}),e.jsx("div",{style:{width:"100%",height:360},children:e.jsx(Je,{children:e.jsxs(Ra,{margin:{top:10,right:14,bottom:10,left:10},children:[e.jsx(Ye,{}),e.jsx(Ge,{type:"number",dataKey:"x",domain:[0,100],ticks:[0,25,50,75,100]}),e.jsx(De,{type:"number",dataKey:"y",domain:[0,100],ticks:[0,25,50,75,100]}),e.jsx(Ze,{cursor:{strokeDasharray:"3 3"},content:({active:c,payload:j})=>{if(!c||!(j!=null&&j.length))return null;const x=j[0].payload;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 shadow",children:[e.jsx("div",{className:"font-semibold mb-1",children:x.date}),e.jsxs("div",{className:"text-sm",children:["ÁêÜËß£Â∫¶: ",Math.round(x.x)]}),e.jsxs("div",{className:"text-sm",children:["ÊàêÈï∑Â∫¶: ",Math.round(x.y)]}),e.jsxs("div",{className:"text-sm",children:["Ë≤†Ëç∑(load): ",Math.round(x.load)]}),e.jsxs("div",{className:"text-sm",children:["Âπ≥ÂùáRPE: ",x.rpe]}),e.jsxs("div",{className:"text-sm",children:["‰ª∂Êï∞: ",x.n]})]})}}),e.jsx(lt,{}),e.jsx($a,{name:"Êó•Âà•Âπ≥Âùá",data:l,fill:"#3b82f6",shape:c=>{const{cx:j,cy:x,payload:y}=c,v=xd((y==null?void 0:y.load)??0,n);return e.jsx("circle",{cx:j,cy:x,r:v,fill:"#3b82f6",fillOpacity:(y==null?void 0:y.opacity)??.55,stroke:"#1d4ed8",strokeWidth:1})}})]})})}),e.jsx("div",{style:{width:"100%",height:260},children:e.jsx(Je,{children:e.jsxs(St,{data:i,margin:{top:10,right:14,bottom:10,left:10},children:[e.jsx(Ye,{}),e.jsx(Ge,{dataKey:"date"}),e.jsx(De,{}),e.jsx(Ze,{}),e.jsx(lt,{}),e.jsx(fe,{type:"monotone",dataKey:"load",name:"Ë≤†Ëç∑(load)"}),e.jsx(fe,{type:"monotone",dataKey:"growth",name:"ÊàêÈï∑(Âπ≥Âùá)"}),e.jsx(fe,{type:"monotone",dataKey:"understanding",name:"ÁêÜËß£(Âπ≥Âùá)"})]})})}),e.jsx("div",{className:"text-xs text-gray-500",children:"‚Äª„ÄåÊàêÈï∑/ÁêÜËß£„Äç„ÅØ 0‚Äì100 „ÅÆÂπ≥ÂùáÂÄ§„ÄÇn=0 „ÅÆÊó•„ÅØÁÇπ„ÅåËñÑ„Åè„ÄÅload„ÅØ0„Å´„Å™„Çä„Åæ„Åô„ÄÇ"})]})}const ud=(t,s)=>{const r=[];for(let n=0;n<t.length;n+=s)r.push(t.slice(n,n+s));return r},vs=(t,s,r)=>Math.max(s,Math.min(r,t));function gd(t){const{date:s,athletes:r}=t,[n,l]=a.useState([]),[i,c]=a.useState(!1),[j,x]=a.useState(null),y=a.useMemo(()=>!Array.isArray(r)||r.length===0?"":r.map(u=>{const f=u.nickname||u.name||u.email||"ÂêçÂâçÊú™Ë®≠ÂÆö";return`${u.id}:${f}`}).sort().join("|"),[r]),v=a.useMemo(()=>!Array.isArray(r)||r.length===0?"":r.map(u=>u.id).filter(Boolean).sort().join(","),[r]),N=a.useMemo(()=>v?v.split(",").filter(Boolean):[],[v]),w=a.useMemo(()=>{const u={};if(!y)return u;for(const f of y.split("|")){const[d,...o]=f.split(":"),g=o.join(":")||"ÂêçÂâçÊú™Ë®≠ÂÆö";d&&(u[d]=g)}return u},[y]),p=a.useRef(0);a.useEffect(()=>{if(!s||N.length===0){l([]),x(null),c(!1);return}let u=!1;const f=++p.current;return(async()=>{try{c(!0),x(null);const d=[];for(const m of ud(N,50)){const{data:b,error:_}=await L.from("training_records").select("user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score").in("user_id",m).eq("date",s);if(_)throw _;d.push(...b??[])}if(u||f!==p.current)return;const o=new Map;for(const m of d){const b=m.intent_signal??m.signal_score??50,_=m.growth_vector??m.arrow_score??50,S=typeof m.load=="number"&&isFinite(m.load)?m.load:(m.rpe??0)*(m.duration_min??0),C=vs(Number(b)||50,0,100),R=vs(Number(_)||50,0,100),A=vs(Number(S)||0,0,999999),T=vs(Number(m.rpe)||0,0,10),M=vs(Number(m.duration_min)||0,0,1e5),k=o.get(m.user_id)??{sumX:0,sumY:0,sumLoad:0,sumRpe:0,sumDur:0,n:0};k.sumX+=C,k.sumY+=R,k.sumLoad+=A,k.sumRpe+=T,k.sumDur+=M,k.n+=1,o.set(m.user_id,k)}const g=Array.from(o.entries()).map(([m,b])=>{const _=b.n||1;return{user_id:m,name:w[m]||"ÂêçÂâçÊú™Ë®≠ÂÆö",x:Math.round(b.sumX/_*10)/10,y:Math.round(b.sumY/_*10)/10,load:Math.round(b.sumLoad/_),rpe:Math.round(b.sumRpe/_*10)/10,duration_min:Math.round(b.sumDur/_)}});l(g)}catch(d){console.error("[useDailyGrowthMatrix] error",d),u||(x((d==null?void 0:d.message)??"ÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),l([]))}finally{u||c(!1)}})(),()=>{u=!0}},[s,v,y]);const h=a.useMemo(()=>{if(!n||n.length===0)return null;const u=f=>f.reduce((d,o)=>d+o,0)/f.length;return{x:u(n.map(f=>f.x)),y:u(n.map(f=>f.y)),load:u(n.map(f=>f.load))}},[n]);return{points:n,teamAvg:h,loading:i,error:j}}const hd=a.lazy(()=>Qe(()=>import("./TeamExportPanel-DTTY_LaL.js"),__vite__mapDeps([9,1,5,2])).then(t=>({default:t.TeamExportPanel}))),bd=a.lazy(()=>Qe(()=>import("./ReportView-B9g3UWGc.js"),__vite__mapDeps([10,1,2])).then(t=>({default:t.ReportView}))),fd=a.lazy(async()=>{const t=await Qe(()=>import("./CoachRankingsView-BOTKQU3S.js"),__vite__mapDeps([11,1,8,2]));return{default:t.CoachRankingsView??t.default}}),pd=a.lazy(async()=>{const t=await Qe(()=>import("./GrowthUnderstandingQuadrantSummary-DcM4W1MG.js"),__vite__mapDeps([12,1,2]));return{default:t.GrowthUnderstandingQuadrantSummary??t.default}}),yd=a.lazy(async()=>{const t=await Qe(()=>import("./GrowthUnderstandingMatrix-BIRu8EdZ.js"),__vite__mapDeps([13,1,2]));return{default:t.GrowthUnderstandingMatrix??t.default}}),jd=14,Da=t=>t.toISOString().slice(0,10),Vs=t=>new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(t),wd=()=>{const t=new Date,r=(t.getDay()+6)%7,n=new Date(t);n.setDate(t.getDate()-r),n.setHours(0,0,0,0);const l=new Date(n);return l.setDate(n.getDate()+6),{start:Da(n),end:Da(l)}},vd=t=>Math.round(t*100)/100,Nd=t=>t>=1.5?"high":t>=1.3?"caution":t>=.8?"good":"low",kd=(t,s,r)=>{const n=Math.min(5,Math.max(1,Math.floor(r*.2)));return t==null||s<n?"unknown":t>=1.5?"danger":t>=1.3?"warn":"ok"},_d=t=>t==="danger"?"High":t==="warn"?"Caution":t==="ok"?"Good":"Unknown",Sd=(t,s,r)=>t==="unknown"?`„Éá„Éº„Çø‰∏çË∂≥ÔºöÊúâÂäπ‰∫∫Êï∞„ÅåÂ∞ë„Å™„ÅÑÔºà${s}/${r}Ôºâ`:t==="danger"?"Ê≥®ÊÑèÔºöË≤†Ëç∑„ÅåÈ´ò„ÅÑÂèØËÉΩÊÄß„ÄÇÂ£∞„Åã„Åë„ÉªÁ∑¥ÁøíÂæåRPEÁ¢∫Ë™çÊé®Â•®":t==="warn"?"Ê≥®ÊÑèÔºö„ÇÑ„ÇÑÈ´ò„ÇÅ„ÄÇÂõûÂæ©Áä∂Ê≥Å„ÅÆÁ¢∫Ë™çÊé®Â•®":"ÂÆâÂÆöÔºöÈÄöÂ∏∏ÈÅãÁî®„ÅßOK",Ks={danger:{box:"border-red-200 bg-red-50",badge:"bg-red-100 text-red-700 border-red-200",dot:"bg-red-500"},warn:{box:"border-amber-200 bg-amber-50",badge:"bg-amber-100 text-amber-700 border-amber-200",dot:"bg-amber-500"},ok:{box:"border-emerald-200 bg-emerald-50",badge:"bg-emerald-100 text-emerald-700 border-emerald-200",dot:"bg-emerald-500"},unknown:{box:"border-gray-200 bg-gray-50",badge:"bg-gray-100 text-gray-700 border-gray-200",dot:"bg-gray-400"}},Ta=(t,s)=>{const r=[];for(let n=0;n<t.length;n+=s)r.push(t.slice(n,n+s));return r};function Cd({user:t,alerts:s,onNavigateToPrivacy:r,onNavigateToTerms:n,onNavigateToCommercial:l,onNavigateToHelp:i}){const[c,j]=a.useState([]),[x,y]=a.useState(null),[v,N]=a.useState([]),[w,p]=a.useState(!1),[h,u]=a.useState(null),[f,d]=a.useState(!0),[o,g]=a.useState({}),[m,b]=a.useState(!1),[_,S]=a.useState(()=>wd()),[C,R]=a.useState([]),[A,T]=a.useState(!1),[M,k]=a.useState([]),[F,O]=a.useState(()=>Vs(new Date)),[z,P]=a.useState(null),[$,q]=a.useState("athletes"),[E,D]=a.useState(!1),[B,H]=a.useState(!1),[W,U]=a.useState(!0),[Z,Y]=a.useState(!1),ee=a.useRef(null),ae=a.useRef(0),V=a.useRef("");a.useEffect(()=>{ee.current=(x==null?void 0:x.id)??null},[x==null?void 0:x.id]),a.useEffect(()=>{V.current=v.map(Q=>Q.id).slice().sort().join(",")},[v]);const te=Vs(new Date),[se,I]=a.useState(()=>{if(typeof window>"u")return!1;try{const Q=`noDataDismissed-${t.id}-${te}`;return localStorage.getItem(Q)==="1"}catch{return!1}}),{isActive:J,shouldShowTutorial:G,startTutorial:ne,completeTutorial:oe,skipTutorial:de,currentStepIndex:ue,setCurrentStepIndex:ye}=Pr(),je=ir(t.id),st=Array.isArray(je==null?void 0:je.organizations)?je.organizations:[],ct=Array.isArray(st)?st:[];x!=null&&x.organization_id||ct.length>0&&ct[0].id,a.useEffect(()=>{G()&&!f&&ne()},[G,ne,f]);const Se=ld((x==null?void 0:x.id)||null),rt=!!Se.loading,Oe=Se.teamACWRData??Se.data??[],bt=Array.isArray(Oe)?Oe:[],xe=Array.isArray(v)?v:[],xt=Array.isArray(s)?s:[],Te=Array.isArray(C)?C:[],Fe=a.useMemo(()=>{const Q=x==null?void 0:x.id;return Q?xt.filter(re=>(re==null?void 0:re.team_id)==null?!0:re.team_id===Q):xt},[xt,x==null?void 0:x.id]),ft=a.useMemo(()=>Fe.filter(Q=>(Q==null?void 0:Q.priority)==="high"),[Fe]),Pe=a.useMemo(()=>xe.map(Q=>Q.id),[xe]),Ht=a.useMemo(()=>xe.map(Q=>({id:Q.id,name:Q.name,nickname:Q.nickname,email:Q.email})),[xe]),{points:At,teamAvg:Vt,loading:we,error:ss}=gd({date:te,athletes:Ht}),[Ct,it]=a.useState([]),[Mt,qe]=a.useState(!1),[ot,ke]=a.useState(null),pt=a.useRef(0),us=a.useMemo(()=>Pe.slice().sort().join(","),[Pe]);a.useEffect(()=>{if($!=="team-average")return;if(!(x!=null&&x.id)||!_.start||!_.end||Pe.length===0){it([]),qe(!1),ke(null);return}const Q=++pt.current;let re=!1;return(async()=>{try{qe(!0),ke(null);const ce=[];for(const ie of Ta(Pe,50)){const{data:ve,error:ze}=await L.from("training_records").select("user_id,date,rpe,duration_min,load,arrow_score,signal_score").in("user_id",ie).gte("date",_.start).lte("date",_.end);if(ze)throw ze;ce.push(...ve??[])}if(re||Q!==pt.current)return;const be=ce.map(ie=>{const ve=typeof ie.arrow_score=="number"&&Number.isFinite(ie.arrow_score)?ie.arrow_score:null,ze=typeof ie.signal_score=="number"&&Number.isFinite(ie.signal_score)?ie.signal_score:null,Gt=typeof ie.load=="number"&&Number.isFinite(ie.load)?ie.load:(Number(ie.rpe)||0)*(Number(ie.duration_min)||0);return{arrow_score:ve,signal_score:ze,load:Number.isFinite(Gt)?Gt:0}});it(be)}catch(ce){console.error("[weeklyQuadrant] error",ce),ke((ce==null?void 0:ce.message)??"ÈÄ±„Çµ„Éû„É™„ÉºÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),it([])}finally{re||qe(!1)}})(),()=>{re=!0}},[$,x==null?void 0:x.id,_.start,_.end,us]);const{weekRange:rs,teamDaily:Be,loading:Rt,error:Kt}=dd({baseDate:F,athleteIds:Pe});a.useEffect(()=>{as()},[t.id]),a.useEffect(()=>{x!=null&&x.id&&(N([]),R([]),k([]),g({}),b(!1),ns(x.id),gs(x.id,_.start,_.end))},[x==null?void 0:x.id,_.start,_.end]),a.useEffect(()=>{if(typeof window>"u")return;const Q=`noDataDismissed-${t.id}-${te}`;I(localStorage.getItem(Q)==="1")},[t.id,te]);const as=async()=>{try{d(!0);const{data:Q,error:re}=await L.from("staff_team_links").select(`
            team_id,
            teams (
              id,
              name,
              created_at,
              organization_id
            )
          `).eq("staff_user_id",t.id);if(re)throw re;const ce=(Q||[]).map(be=>be.teams).filter(Boolean);j(ce||[]),ce&&ce.length>0?y(ce[0]):y(null)}catch(Q){console.error("Error fetching staff teams:",Q),j([]),y(null)}finally{d(!1)}},ns=async Q=>{try{p(!0),u(null);const re=Q,{data:ce,error:be}=await L.from("staff_team_athletes_with_activity").select("*").eq("team_id",Q);if(be)throw be;if(ee.current!==re)return;const ie=ce||[];N(ie);const ve=ie.map(ze=>ze.id);yt(Q,ve)}catch(re){console.error(re),u("ÈÅ∏Êâã„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{p(!1)}},gs=async(Q,re,ce)=>{try{T(!0);const[be,ie]=await Promise.all([L.rpc("get_coach_week_athlete_cards",{p_team_id:Q,p_start_date:re,p_end_date:ce}),L.rpc("get_coach_week_cause_tags",{p_team_id:Q,p_start_date:re,p_end_date:ce})]);if(be.error)throw be.error;if(ie.error)throw ie.error;R(be.data||[]),k(ie.data||[])}catch(be){console.error("Failed to fetch week summary",be),R([]),k([])}finally{T(!1)}},yt=async(Q,re)=>{if(!re||re.length===0){ee.current===Q&&(g({}),b(!1));return}const ce=++ae.current,be=re.slice().sort().join(",");try{b(!0);const ie=new Date,ve=new Date(ie);ve.setDate(ve.getDate()-90);const ze=Vs(ve),Gt=Vs(ie),Ls=Ta(re,50),fs=[];for(const nt of Ls){const{data:Dt,error:ps}=await L.from("athlete_acwr_daily").select("user_id,date,acwr").in("user_id",nt).gte("date",ze).lte("date",Gt).order("date",{ascending:!1});if(ps)throw ps;fs.push(...Dt||[])}if(ee.current!==Q||ce!==ae.current||V.current!==be)return;const $t={};for(const nt of fs){if($t[nt.user_id])continue;const Dt=typeof nt.acwr=="number"&&Number.isFinite(nt.acwr)?nt.acwr:null;$t[nt.user_id]={currentACWR:Dt!=null?vd(Dt):null,riskLevel:Dt!=null?Nd(Dt):void 0,daysOfData:28}}for(const nt of re)$t[nt]||($t[nt]={currentACWR:null,riskLevel:void 0,daysOfData:null});g($t)}catch(ie){console.error("[fetchAthleteACWRFromDaily] failed",ie),ee.current===Q&&g({})}finally{ee.current===Q&&b(!1)}},Jt=async Q=>console.log("Mark as read:",Q),le=async Q=>console.log("Dismiss alert:",Q),he=async()=>console.log("Mark all as read"),me=bt.length>0?bt[bt.length-1]:null,We=a.useMemo(()=>{const Q=new Date,re=1e3*60*60*24;return xe.filter(ce=>ce.last_training_date).map(ce=>{const be=new Date(ce.last_training_date),ie=Math.floor((Q.getTime()-be.getTime())/re);return{athlete:ce,daysSinceLast:ie}}).filter(ce=>ce.daysSinceLast>=jd).sort((ce,be)=>be.daysSinceLast-ce.daysSinceLast)},[xe]),Yt=(me==null?void 0:me.averageACWR)??null,ls=(me==null?void 0:me.athleteCount)??0,hs=xe.length,mt=kd(typeof Yt=="number"?Yt:null,ls,hs),Fs=Q=>{const re=xe.find(be=>be.id===Q.user_id);if(!re){window.alert("ÈÅ∏ÊâãÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü");return}const ce=Te.find(be=>be.athlete_user_id===re.id);if(ce&&!ce.is_sharing_active){window.alert("„Åì„ÅÆÈÅ∏Êâã„ÅØÁèæÂú®„ÄÅË©≥Á¥∞„Éá„Éº„Çø„ÅÆÂÖ±Êúâ„ÅåOFF„Åß„ÅôÔºàüîíÔºâ");return}P(re)},bs=a.useMemo(()=>{const Q=[];if(We.slice(0,3).forEach(({athlete:ie,daysSinceLast:ve})=>{Q.push({user_id:ie.id,name:ie.name||ie.email||"unknown",category:"risk",reason:"Ë®òÈå≤„ÅåÈÄîÂàá„Çå„Å¶„ÅÑ„Åæ„Åô",meta:`${ve}Êó•Êú™ÂÖ•Âäõ`})}),!Te||Te.length===0)return Q.slice(0,5);Te.forEach(ie=>{var ze;if(!ie.is_sharing_active)return;const ve=(ze=o==null?void 0:o[ie.athlete_user_id])==null?void 0:ze.currentACWR;typeof ve=="number"&&ve>=1.5&&Q.push({user_id:ie.athlete_user_id,name:ie.athlete_name||"unknown",category:"risk",reason:"ACWRÈ´òÂÄ§",meta:`ACWR ${ve.toFixed(2)}`})}),Te.forEach(ie=>{ie.is_sharing_active&&ie.sleep_hours_avg!=null&&ie.sleep_hours_avg<=5.5&&Q.push({user_id:ie.athlete_user_id,name:ie.athlete_name||"unknown",category:"checkin",reason:"Áù°Áú†„ÅåÁü≠„ÇÅ",meta:`${ie.sleep_hours_avg.toFixed(1)}h`})}),Te.forEach(ie=>{ie.action_total>0&&(ie.action_done_rate??0)>=90&&Q.push({user_id:ie.athlete_user_id,name:ie.athlete_name||"unknown",category:"praise",reason:"Ë°åÂãïÁõÆÊ®ô„ÅåËâØ„ÅÑ",meta:`${Math.round(ie.action_done_rate??0)}%`})});const re={risk:3,checkin:2,praise:1},ce=new Map;for(const ie of Q){const ve=ce.get(ie.user_id);(!ve||re[ie.category]>re[ve.category])&&ce.set(ie.user_id,ie)}const be=Array.from(ce.values());return be.sort((ie,ve)=>re[ve.category]-re[ie.category]),be.slice(0,5)},[We,Te,o]),at=()=>{if(typeof window<"u"){const Q=`noDataDismissed-${t.id}-${te}`;localStorage.setItem(Q,"1")}I(!0)},Xe=a.useMemo(()=>{const Q={};for(const re of Te)Q[re.athlete_user_id]=re;return Q},[Te]),is=a.useMemo(()=>{const Q={};for(const re of We)Q[re.athlete.id]={daysSinceLast:re.daysSinceLast};return Q},[We]),dt=a.useMemo(()=>{const Q={};for(const re of xe)Q[re.id]=Vo({id:re.id,name:re.name||re.email||"unknown",acwrInfo:(o==null?void 0:o[re.id])??null,weekCard:(Xe==null?void 0:Xe[re.id])??null,noData:(is==null?void 0:is[re.id])??null});return Q},[xe,o,Xe,is]),jt=a.useMemo(()=>Yo({athletes:xe,riskMap:dt,weekCardMap:Xe}),[xe,dt,Xe]);a.useEffect(()=>{if(!jt||jt.length===0)return;const Q=jt.filter(re=>{var ce;return(ce=dt==null?void 0:dt[re.id])==null?void 0:ce.riskLevel}).length;Q>=Math.floor(jt.length*.7)?console.log("[sortedAthletes]",jt.map(re=>{var ce,be,ie,ve,ze;return{name:re.name,risk:(ce=dt[re.id])==null?void 0:ce.riskLevel,sharing:(be=Xe[re.id])==null?void 0:be.is_sharing_active,acwr:(ie=o[re.id])==null?void 0:ie.currentACWR,reasons:((ze=(ve=dt[re.id])==null?void 0:ve.reasons)==null?void 0:ze.length)??0}})):console.log(`[sortedAthletes] risk not ready: ${Q}/${jt.length}`)},[jt,dt,Xe,o]);const or=Q=>{const re=Te.find(ce=>ce.athlete_user_id===Q.id);if(!(re!=null&&re.is_sharing_active)){window.alert("„Åì„ÅÆÈÅ∏Êâã„ÅØÁèæÂú®„ÄÅË©≥Á¥∞„Éá„Éº„Çø„ÅÆÂÖ±Êúâ„ÅåOFF„Åß„ÅôÔºàüîíÔºâ");return}P(Q)};return f?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"„Ç≥„Éº„ÉÅ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[ft.length>0&&e.jsxs("button",{onClick:()=>D(!0),className:"p-2 text-gray-600 hover:text-red-600 transition-colors relative",title:"„Ç¢„É©„Éº„Éà",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center",children:ft.length})]}),e.jsx("button",{onClick:ne,className:"p-2 text-gray-600 hover:text-green-600 transition-colors",title:"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´",children:e.jsx(Ds,{className:"w-5 h-5"})})]})]}),c.length>0&&e.jsx("div",{className:"pb-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3 pt-3",children:[e.jsx($e,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("select",{value:(x==null?void 0:x.id)||"",onChange:Q=>{const re=c.find(ce=>ce.id===Q.target.value);re&&y(re)},className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:c.map(Q=>e.jsx("option",{value:Q.id,children:Q.name},Q.id))})]})})]})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($e,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ÊãÖÂΩì„ÉÅ„Éº„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-gray-600",children:"ÁÆ°ÁêÜËÄÖ„Å´„ÉÅ„Éº„É†„ÅÆÂâ≤„ÇäÂΩì„Å¶„Çí‰æùÈ†º„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]}):e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[x&&e.jsxs("div",{className:"space-y-4",children:[!rt&&me&&e.jsx("div",{className:`rounded-xl border p-4 sm:p-5 ${Ks[mt].box}`,children:e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs font-semibold ${Ks[mt].badge}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${Ks[mt].dot}`}),"Today Summary"]}),e.jsx("span",{className:`inline-flex items-center px-3 py-1.5 rounded-full border text-sm font-bold ${Ks[mt].badge}`,children:_d(mt)})]}),e.jsx("div",{className:"text-sm sm:text-base text-gray-900 font-semibold",children:Sd(mt,ls,hs)}),e.jsxs("div",{className:"mt-2 text-xs sm:text-sm text-gray-700 flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("span",{children:["„ÉÅ„Éº„É†ACWRÔºö",e.jsx("b",{children:me.averageACWR})]}),e.jsxs("span",{children:["ÊúâÂäπ‰∫∫Êï∞Ôºö",e.jsx("b",{children:ls})," / Âú®Á±çÔºö",e.jsx("b",{children:hs})]})]})]})})}),!rt&&!me&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4 sm:p-5",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Today Summary"}),e.jsxs("div",{className:"text-sm text-gray-700",children:["„Åæ„Å†„ÉÅ„Éº„É†ACWR„ÇíÁÆóÂá∫„Åß„Åç„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",e.jsx("br",{}),"ÔºàÈÅ∏Êâã„ÅÆRPE„Å®Á∑¥ÁøíÊôÇÈñì„ÅÆÂÖ•Âäõ„ÅåÂ¢ó„Åà„Çã„Å®Ë°®Á§∫„Åï„Çå„Åæ„ÅôÔºâ"]})]}),bs.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"‰ªäÊó•„ÅÆ„Éï„Ç©„Éº„Ç´„ÇπÔºàÊúÄÂ§ß5‰∫∫Ôºâ"}),e.jsx("div",{className:"text-xs text-gray-500",children:"„Çø„ÉÉ„Éó„ÅßÈÅ∏ÊâãË©≥Á¥∞"})]}),e.jsx("ul",{className:"space-y-2",children:bs.map(Q=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>Fs({user_id:Q.user_id}),className:"w-full text-left rounded-lg border border-gray-200 hover:bg-gray-50 px-3 py-2 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",children:Q.name}),e.jsxs("div",{className:"text-xs text-gray-700",children:[Q.reason,Q.meta?e.jsxs("span",{className:"text-gray-500",children:["Ôºà",Q.meta,"Ôºâ"]}):null]})]}),e.jsx("span",{className:`shrink-0 text-[11px] px-2 py-1 rounded-full border ${Q.category==="risk"?"bg-red-50 text-red-700 border-red-200":Q.category==="checkin"?"bg-amber-50 text-amber-700 border-amber-200":"bg-emerald-50 text-emerald-700 border-emerald-200"}`,children:Q.category==="risk"?"Ê≥®ÊÑè":Q.category==="checkin"?"Â£∞„Åã„Åë":"Áß∞Ë≥õ"})]})},Q.user_id))})]})]}),We.length>0&&!se&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-amber-200 p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1",children:"Á∑¥ÁøíË®òÈå≤„ÅåÈÄîÂàá„Çå„Å¶„ÅÑ„ÇãÈÅ∏Êâã"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"ÊúÄÁµÇË®òÈå≤Êó•„Åã„Çâ‰∏ÄÂÆöÊúüÈñì„ÄÅË®òÈå≤„Åå„Å™„ÅÑÈÅ∏Êâã„ÅÆ‰∏ÄË¶ß„Åß„Åô"})]}),e.jsx("button",{onClick:at,className:"text-xs sm:text-sm text-blue-600 hover:text-blue-700 font-medium px-2 py-1 rounded-lg hover:bg-blue-50",children:"‰ªäÊó•ÂàÜ„ÅØÊó¢Ë™≠„Å´„Åô„Çã"})]}),e.jsx("ul",{className:"space-y-1 sm:space-y-1.5 text-sm sm:text-base",children:We.map(({athlete:Q,daysSinceLast:re})=>e.jsxs("li",{className:"flex items-baseline justify-between border-t border-gray-100 pt-1.5 first:border-t-0 first:pt-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate mr-2",children:Q.name||Q.email}),e.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 whitespace-nowrap",children:["ÊúÄÁµÇÊó• ",Q.last_training_date||"-","Ôºà",re,"Êó•ÈñìÔºâ"]})]},Q.id))})]}),x&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 truncate",children:[e.jsxs("span",{className:"hidden sm:inline",children:[x.name," - "]}),e.jsx("span",{className:"sm:hidden",children:"„ÉÅ„Éº„É†"}),"Ê¶ÇË¶Å"]}),e.jsx(Ke,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 ml-2"})]}),rt?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):me?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-purple-600 mb-1",children:me.averageACWR}),e.jsx("div",{className:"text-xs sm:text-sm text-purple-700",children:"„ÉÅ„Éº„É†Âπ≥ÂùáACWR"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 mb-1",children:me.athleteCount}),e.jsx("div",{className:"text-xs sm:text-sm text-blue-700",children:"„Éá„Éº„ÇøÊúâÂäπÈÅ∏ÊâãÊï∞"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-gray-600 mb-1",children:xe.length}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-700",children:"Á∑èÈÅ∏ÊâãÊï∞"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-red-600 mb-1",children:Fe.filter(Q=>Q.priority==="high").length}),e.jsx("div",{className:"text-xs sm:text-sm text-red-700",children:"È´ò„É™„Çπ„ÇØÈÅ∏Êâã"})]})]}):e.jsxs("div",{className:"py-6 text-center text-sm text-gray-500",children:["„Åæ„Å†ACWR„ÇíË®àÁÆó„Åß„Åç„ÇãÂçÅÂàÜ„Å™„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",e.jsx("br",{}),"ÔºàÈÅ∏Êâã„ÅÆRPE„Å®Á∑¥ÁøíÊôÇÈñì„ÇíÂÖ•Âäõ„Åô„Çã„Å®Ë°®Á§∫„Åï„Çå„Åæ„ÅôÔºâ"]})]}),x&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm",children:[e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("nav",{className:"hidden sm:flex px-4 sm:px-6 overflow-x-auto",children:[e.jsx("button",{onClick:()=>q("athletes"),className:`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${$==="athletes"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,"data-tutorial":"athletes-tab",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"ÈÅ∏Êâã‰∏ÄË¶ß"]})}),e.jsx("button",{onClick:()=>q("team-average"),className:`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap ${$==="team-average"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,"data-tutorial":"team-average-tab",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"„ÉÅ„Éº„É†Âπ≥ÂùáACWR"]})}),e.jsx("button",{onClick:()=>q("rankings"),className:`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap ${$==="rankings"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(tr,{className:"w-4 h-4 mr-2"}),"„É©„É≥„Ç≠„É≥„Ç∞"]})}),e.jsx("button",{onClick:()=>q("reports"),className:`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap ${$==="reports"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Et,{className:"w-4 h-4 mr-2"}),"„É¨„Éù„Éº„Éà"]})})]}),e.jsx("div",{className:"sm:hidden px-4 py-3",children:e.jsxs("select",{value:$,onChange:Q=>q(Q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"athletes",children:"ÈÅ∏Êâã‰∏ÄË¶ß"}),e.jsx("option",{value:"team-average",children:"„ÉÅ„Éº„É†Âπ≥ÂùáACWR"}),e.jsx("option",{value:"rankings",children:"„É©„É≥„Ç≠„É≥„Ç∞"}),e.jsx("option",{value:"reports",children:"„É¨„Éù„Éº„Éà"})]})})]}),e.jsxs("div",{className:"p-4 sm:p-6",children:[$==="athletes"&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-600 mb-3 flex items-center gap-2",children:[e.jsx(Ya,{className:"w-4 h-4"}),"ÂÖ±ÊúâOFFÔºàüîíÔºâ„ÅÆÈÅ∏Êâã„ÅØ„ÄÅË©≥Á¥∞„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åë„Åæ„Åõ„Çì",m&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"ÔºàACWRÂèñÂæó‰∏≠‚Ä¶Ôºâ"})]}),w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):h?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 text-sm text-red-700",children:[e.jsx("div",{className:"font-semibold mb-1",children:"ÈÅ∏Êâã‰∏ÄË¶ß„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"}),e.jsx("div",{className:"mb-3",children:h}),e.jsx("button",{className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",onClick:()=>(x==null?void 0:x.id)&&ns(x.id),children:"ÂÜçÂèñÂæó"})]}):xe.length===0?e.jsxs("div",{className:"bg-white border rounded-xl p-6 text-center text-gray-600",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:"ÈÅ∏Êâã„Åå„Åæ„Å†„ÅÑ„Åæ„Åõ„Çì"}),e.jsx("div",{className:"text-sm",children:"„ÉÅ„Éº„É†„Å´ÈÅ∏Êâã„ÅåÊâÄÂ±û„Åó„Å¶„ÅÑ„Çã„ÅãÔºàteam_id / view Êù°‰ª∂Ôºâ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]}):e.jsx(Ho,{athletes:jt,onAthleteSelect:or,athleteACWRMap:o,weekCardMap:Xe,athleteRiskMap:dt})]}),$==="team-average"&&e.jsxs("div",{className:"space-y-4",children:[rt?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx(ws,{name:"TeamACWRChart",children:e.jsx(td,{data:bt,teamName:(x==null?void 0:x.name)??"",showAvgRPE:W,showAvgLoad:Z})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"ÈÄ±„Çµ„Ç§„ÇØ„É´Ë°®Á§∫Ôºà7Êó•Ôºâ"}),e.jsx("div",{className:"text-xs text-gray-500",children:"ÊåáÂÆöÊó•„ÇíÂê´„ÇÄÈÄ±ÔºàÊúà„ÄúÊó•Ôºâ„Çí„ÄåÊàêÈï∑√óÁêÜËß£„Äç„ÅÆÂãï„ÅçÔºãË≤†Ëç∑„ÅßÂèØË¶ñÂåñ„Åó„Åæ„Åô"})]}),e.jsx("input",{type:"date",value:F,onChange:Q=>O(Q.target.value),className:"px-3 py-2 rounded-lg border border-gray-300",title:"„Åì„ÅÆÊó•‰ªò„ÇíÂê´„ÇÄÈÄ±ÔºàÊúà„ÄúÊó•Ôºâ„ÇíË°®Á§∫"})]}),e.jsx("div",{className:"mt-3",children:Rt?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):Kt?e.jsx("div",{className:"text-sm text-red-600",children:Kt}):e.jsx(ws,{name:"WeeklyGrowthCycleView",children:e.jsx(md,{teamDaily:Be,weekLabel:`${rs.start} „Äú ${rs.end}`})})})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:Mt?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):ot?e.jsx("div",{className:"text-sm text-red-600",children:ot}):e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}),children:e.jsx(ws,{name:"GrowthUnderstandingQuadrantSummary",children:e.jsx(pd,{data:Ct})})})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:we?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):ss?e.jsx("div",{className:"text-sm text-red-600",children:ss}):e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}),children:e.jsx(ws,{name:"GrowthUnderstandingMatrix",children:e.jsx(yd,{points:At,teamAvg:Vt})})})})]}),$==="rankings"&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:e.jsx(ws,{name:"CoachRankingsView",children:e.jsx(fd,{team:x,onOpenAthlete:(Q,re,ce)=>{setModalAthlete({userId:Q,testTypeId:re,metric:ce}),setOpenModal(!0)}})})}),$==="reports"&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:e.jsx(bd,{team:x})})]})]})]})}),z&&e.jsx(Zo,{athlete:z,onClose:()=>P(null),risk:dt[z.id],weekCard:Xe[z.id]}),E&&e.jsx(dn,{alerts:Fe,onMarkAsRead:Jt,onDismiss:le,onMarkAllAsRead:he,onClose:()=>D(!1),userRole:t.role}),B&&x&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:e.jsx(hd,{team:x,onClose:()=>H(!1)})}),e.jsx(Ir,{steps:Hr("staff"),isActive:J,onComplete:oe,onSkip:de,currentStepIndex:ue,onStepChange:ye})]})}function Gs(t){return t==="global_admin"}function Md(t){const s={athlete:"„Ç¢„Çπ„É™„Éº„Éà",staff:"„Çπ„Çø„ÉÉ„Éï",admin:"ÁÆ°ÁêÜËÄÖ"}[t.role]||t.role;return`
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bekuta„Å∏„ÅÆÊãõÂæÖ</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    .card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 50px 30px;
      text-align: center;
      position: relative;
    }
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 30px 30px;
    }
    .icon {
      background: white;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      position: relative;
    }
    .icon svg {
      width: 40px;
      height: 40px;
    }
    .header h1 {
      color: white;
      font-size: 32px;
      margin: 0 0 10px 0;
      font-weight: bold;
    }
    .header p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 18px;
      margin: 0;
    }
    .content {
      padding: 40px 30px;
    }
    .greeting {
      font-size: 24px;
      color: #1a202c;
      margin: 0 0 20px 0;
      font-weight: 600;
    }
    .message {
      color: #4a5568;
      line-height: 1.6;
      margin-bottom: 30px;
      font-size: 16px;
    }
    .info-box {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-left: 4px solid #667eea;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    .info-item {
      margin: 12px 0;
      display: flex;
      align-items: start;
    }
    .info-label {
      font-weight: 600;
      color: #2d3748;
      min-width: 120px;
      font-size: 14px;
    }
    .info-value {
      color: #4a5568;
      font-size: 14px;
    }
    .setup-box {
      background: linear-gradient(135deg, #e6f7ff 0%, #d0edff 100%);
      border: 2px solid #3b82f6;
      padding: 25px;
      margin: 20px 0;
      border-radius: 12px;
      text-align: center;
    }
    .setup-label {
      font-size: 16px;
      color: #1e40af;
      font-weight: 600;
      margin-bottom: 15px;
    }
    .setup-note {
      font-size: 13px;
      color: #1e40af;
      margin-top: 12px;
      line-height: 1.5;
    }
    .cta-button {
      display: block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
      padding: 18px 40px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 18px;
      margin: 30px 0;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      text-align: center;
    }
    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
    }
    .steps {
      background: #f7fafc;
      padding: 25px;
      border-radius: 12px;
      margin: 25px 0;
    }
    .steps h3 {
      color: #2d3748;
      font-size: 18px;
      margin: 0 0 20px 0;
      text-align: center;
    }
    .step {
      display: flex;
      align-items: start;
      margin: 15px 0;
      color: #4a5568;
    }
    .step-number {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 12px;
      flex-shrink: 0;
      font-size: 14px;
    }
    .urgency {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      padding: 15px 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
      border: 2px solid #fdcb6e;
    }
    .urgency-icon {
      font-size: 24px;
      margin-bottom: 5px;
    }
    .urgency-text {
      color: #7d6608;
      font-weight: 600;
      margin: 0;
      font-size: 14px;
    }
    .footer {
      padding: 30px;
      text-align: center;
      color: #718096;
      font-size: 14px;
      background: #f7fafc;
      border-top: 1px solid #e2e8f0;
    }
    .footer a {
      color: #667eea;
      text-decoration: none;
    }
    @media only screen and (max-width: 600px) {
      .container {
        padding: 20px 10px;
      }
      .header {
        padding: 30px 20px;
      }
      .header h1 {
        font-size: 24px;
      }
      .content {
        padding: 30px 20px;
      }
      .greeting {
        font-size: 20px;
      }
      .cta-button {
        padding: 16px 30px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2 L2 7 L12 12 L22 7 L12 2z"/>
            <polyline points="2 17 12 22 22 17"/>
            <polyline points="2 12 12 17 22 12"/>
          </svg>
        </div>
        <h1>„Çà„ÅÜ„Åì„Åù„ÄÅ${t.name}„Åï„ÇìÔºÅ</h1>
        ${t.teamName?`<p>${t.teamName} „Åå„ÅÇ„Å™„Åü„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô</p>`:"<p>„ÉÅ„Éº„É†„Åå„ÅÇ„Å™„Åü„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô</p>"}
      </div>

      <div class="content">
        <p class="greeting">Bekuta „Å∏„ÅÆÊãõÂæÖ</p>

        <p class="message">
          ${t.inviterName?`${t.inviterName}„Åã„Çâ„ÄÅ`:""}BekutaÔºà„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†Ôºâ„Å∏„ÅîÊãõÂæÖ„Åó„Åæ„Åô„ÄÇ<br/>
          „Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÄÅ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑„ÇíÁßëÂ≠¶ÁöÑ„Å´ÁÆ°ÁêÜ„Åó„ÄÅÊÄ™Êàë„ÅÆ„É™„Çπ„ÇØ„ÇíÊúÄÂ∞èÈôê„Å´Êäë„Åà„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ
        </p>

        <div class="info-box">
          <div class="info-item">
            <span class="info-label">„ÅÇ„Å™„Åü„ÅÆÂΩπÂâ≤</span>
            <span class="info-value">${s}</span>
          </div>
          <div class="info-item">
            <span class="info-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</span>
            <span class="info-value">${t.email}</span>
          </div>
          ${t.teamName?`
          <div class="info-item">
            <span class="info-label">„ÉÅ„Éº„É†</span>
            <span class="info-value">${t.teamName}</span>
          </div>
          `:""}
        </div>

        <div class="setup-box">
          <div class="setup-label">üîê „Åæ„Åö„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
          <div class="setup-note">
            „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆ„Åü„ÇÅ„ÄÅÊúÄÂàù„Å´„ÄåBekuta„Åß‰Ωø„ÅÜ„Éë„Çπ„ÉØ„Éº„Éâ„Äç„ÇíËá™ÂàÜ„ÅßË®≠ÂÆö„Åó„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ<br>
            ‰∏ã„ÅÆ„Éú„Çø„É≥„Åã„Çâ„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö„Éö„Éº„Ç∏„ÇíÈñã„Åç„ÄÅË®≠ÂÆö„ÅåÁµÇ„Çè„Å£„Åü„Çâ Bekuta „ÅÆ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Åß
            <br>„Äå„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Äç„Å®„ÄåË®≠ÂÆö„Åó„Åü„Éë„Çπ„ÉØ„Éº„Éâ„Äç„Åß„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          </div>
        </div>

        <div class="urgency">
          <div class="urgency-icon">‚è∞</div>
          <p class="urgency-text">
            „Åì„ÅÆ„É™„É≥„ÇØ„ÅØ ${t.expiresInHours}ÊôÇÈñìÂæå„Å´ÊúüÈôêÂàá„Çå„Å´„Å™„Çä„Åæ„Åô„ÄÇ<br/>
            ÊúüÈôê„ÅåÂàá„Çå„ÅüÂ†¥Âêà„ÅØ„ÄÅÁÆ°ÁêÜËÄÖ„Å´Êñ∞„Åó„ÅÑÊãõÂæÖ„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„Çí‰æùÈ†º„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          </p>
        </div>

        <a href="${t.passwordSetupLink}" class="cta-button">
          üîë „Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åô„Çã
        </a>

        <div class="steps">
          <h3>Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó</h3>
          <div class="step">
            <div class="step-number">1</div>
            <div>‰∏ä„ÅÆ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö„Éö„Éº„Ç∏„ÇíÈñã„Åè</div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div>„ÅÇ„Å™„ÅüÂ∞ÇÁî®„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶‰øùÂ≠ò„Åô„Çã</div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div>Bekuta „ÅÆ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÇíÈñã„Åç„ÄÅ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Å®Ë®≠ÂÆö„Åó„Åü„Éë„Çπ„ÉØ„Éº„Éâ„Åß„É≠„Ç∞„Ç§„É≥</div>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <div>„ÉÅ„Éº„É†„Å´ÂèÇÂä†ÂÆå‰∫ÜÔºÅ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤„ÇíÈñãÂßã</div>
          </div>
        </div>

        <p class="message" style="font-size: 14px; color: #718096;">
          „Éú„Çø„É≥„ÅåÊ©üËÉΩ„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆURL„Çí„Ç≥„Éî„Éº„Åó„Å¶„Éñ„É©„Ç¶„Ç∂„Å´Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºö<br>
          <span style="word-break: break-all; color: #667eea;">${t.passwordSetupLink}</span>
        </p>
      </div>

      <div style="margin-top: 18px; font-size: 13px; color: #4a5568; line-height: 1.6;">
        „ÇÇ„Åó„É™„É≥„ÇØ„ÅåÈñã„Åë„Å™„ÅÑÔºèÊúüÈôêÂàá„Çå„ÅÆÂ†¥Âêà„ÅØ„ÄÅ„Åì„Å°„Çâ„Åã„ÇâÂÜçÁô∫Ë°å„Åß„Åç„Åæ„ÅôÔºö<br />
        <a href="${t.inviteExpiredUrl}" style="color:#667eea; text-decoration: underline;">
          ÊãõÂæÖ„É™„É≥„ÇØ„ÅÆÂÜçÁô∫Ë°å„Éö„Éº„Ç∏„ÇíÈñã„Åè
        </a>
      </div>

      <div class="footer">
        <p>„Åì„ÅÆ„É°„Éº„É´„Å´ÂøÉÂΩì„Åü„Çä„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅÁÑ°Ë¶ñ„Åó„Å¶„ÅÑ„Åü„Å†„ÅÑ„Å¶Êßã„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>
        <p style="margin-top: 15px;">
          Ë≥™Âïè„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅÊãõÂæÖ„ÇíÈÄÅ„Å£„ÅüÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ
        </p>
        <p style="margin-top: 15px; font-size: 12px; color: #a0aec0;">
          ¬© ${new Date().getFullYear()} Bekuta. All rights reserved.
        </p>
      </div>
    </div>
  </div>
</body>
</html>
  `.trim()}function Dd(t){const s={athlete:"„Ç¢„Çπ„É™„Éº„Éà",staff:"„Çπ„Çø„ÉÉ„Éï",admin:"ÁÆ°ÁêÜËÄÖ"}[t.role]||t.role;return`
Bekuta „Å∏„ÅÆÊãõÂæÖ

„Çà„ÅÜ„Åì„Åù„ÄÅ${t.name}„Åï„ÇìÔºÅ

${t.inviterName?`${t.inviterName}„Åã„Çâ„ÄÅ`:""}BekutaÔºà„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†Ôºâ„Å∏„ÅîÊãõÂæÖ„Åó„Åæ„Åô„ÄÇ

„Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÄÅ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑„ÇíÁßëÂ≠¶ÁöÑ„Å´ÁÆ°ÁêÜ„Åó„ÄÅ
ÊÄ™Êàë„ÅÆ„É™„Çπ„ÇØ„ÇíÊúÄÂ∞èÈôê„Å´Êäë„Åà„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ÊãõÂæÖÊÉÖÂ†±
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

„ÅÇ„Å™„Åü„ÅÆÂΩπÂâ≤: ${s}
„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ: ${t.email}
${t.teamName?`„ÉÅ„Éº„É†: ${t.teamName}
`:""}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üîê „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆ„Åü„ÇÅ„ÄÅ„Åæ„Åö Bekuta „Åß‰Ωø„ÅÜ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
Ë®≠ÂÆöÂæå„ÅØ„ÄÅBekuta „ÅÆ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Åß
„Äå„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Äç„Å®„ÄåË®≠ÂÆö„Åó„Åü„Éë„Çπ„ÉØ„Éº„Éâ„Äç„Åß„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åô„ÄÇ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

1. ‰ª•‰∏ã„ÅÆURL„Å´„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö„Éö„Éº„Ç∏„ÇíÈñã„Åè
   ${t.passwordSetupLink}

2. „ÅÇ„Å™„ÅüÂ∞ÇÁî®„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„ÄÅ„Äå‰øùÂ≠ò„Äç„Åô„Çã

3. Bekuta „ÅÆ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÇíÈñã„Åç„ÄÅ
   „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Å®Ë®≠ÂÆö„Åó„Åü„Éë„Çπ„ÉØ„Éº„Éâ„Åß„É≠„Ç∞„Ç§„É≥„Åô„Çã

4. „ÉÅ„Éº„É†„Å´ÂèÇÂä†ÂÆå‰∫ÜÔºÅ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤„ÇíÈñãÂßã

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚è∞ „Åì„ÅÆ„É™„É≥„ÇØ„ÅØ ${t.expiresInHours}ÊôÇÈñìÂæå„Å´ÊúüÈôêÂàá„Çå„Å´„Å™„Çä„Åæ„Åô„ÄÇ
   ÊúüÈôê„ÅåÂàá„Çå„ÅüÂ†¥Âêà„ÅØ„ÄÅÊãõÂæÖ„ÇíÈÄÅ„Å£„ÅüÁÆ°ÁêÜËÄÖ„Å´
   Êñ∞„Åó„ÅÑÊãõÂæÖ„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„ÅÆÁô∫Ë°å„Çí‰æùÈ†º„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

  „É™„É≥„ÇØ„ÅåÈñã„Åë„Å™„ÅÑÔºèÊúüÈôêÂàá„Çå„ÅÆÂ†¥Âêà„ÅØ„ÄÅ„Åì„Å°„Çâ„Åã„ÇâÂÜçÁô∫Ë°å„Åß„Åç„Åæ„ÅôÔºö
  ${t.inviteExpiredUrl}

„Åì„ÅÆ„É°„Éº„É´„Å´ÂøÉÂΩì„Åü„Çä„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅÁÑ°Ë¶ñ„Åó„Å¶„ÅÑ„Åü„Å†„ÅÑ„Å¶Êßã„ÅÑ„Åæ„Åõ„Çì„ÄÇ
Ë≥™Âïè„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅÊãõÂæÖ„ÇíÈÄÅ„Å£„ÅüÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ

¬© ${new Date().getFullYear()} Bekuta
  `.trim()}function Td({teams:t,onUserInvited:s,restrictToOrganizationId:r,allowAdminInvite:n=!0}){const[l,i]=a.useState([]),[c,j]=a.useState([]),[x,y]=a.useState(!1),[v,N]=a.useState({name:"",email:"",role:"athlete",organizationId:r||"",teamId:""}),[w,p]=a.useState(!1),[h,u]=a.useState(null),[f,d]=a.useState([]),[o,g]=a.useState({}),[m,b]=a.useState(null);a.useEffect(()=>{(async()=>{try{y(!0);const k=(await He.getOrganizations()||[]).map(F=>({id:F.id,name:F.name,description:F.description??void 0}));i(k),r&&N(F=>({...F,organizationId:r}))}catch(M){console.error("Failed to load organizations:",M)}finally{y(!1)}})()},[r]),a.useEffect(()=>{(async()=>{if(!v.organizationId){j([]);return}try{const M=await He.getOrganizationTeams(v.organizationId);j(M)}catch(M){console.error("Failed to load organization teams:",M),j([])}})()},[v.organizationId]);const _=async T=>{var M,k,F;T.preventDefault(),p(!0),u(null);try{const{data:{session:O}}=await L.auth.getSession();if(!O)throw new Error("Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô");const{data:z}=await L.from("users").select("name").eq("id",O.user.id).single(),P=(M=c.find(V=>V.id===v.teamId))==null?void 0:M.name,$=(k=l.find(V=>V.id===v.organizationId))==null?void 0:k.name;console.log("üöÄ Starting user creation process...");const q="http://127.0.0.1:54321",E={name:v.name,email:v.email,role:v.role,teamId:v.role==="athlete"||v.role==="staff"?v.teamId:void 0,organizationId:v.organizationId||void 0,redirectUrl:`${window.location.origin}/reset-password`};console.log("üì§ Sending user creation request...");const D=await fetch(`${q}/functions/v1/create-user`,{method:"POST",headers:{Authorization:`Bearer ${O.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(E)}),B=await D.json();if(!D.ok)throw new Error(B.error||"„É¶„Éº„Ç∂„Éº„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");console.log("‚úÖ User created successfully");const H=B.passwordSetupLink;if(console.log("üîó Password setup link received"),!H)throw new Error("Edge Function„Åã„Çâ„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö„É™„É≥„ÇØ„ÅåËøî„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü");console.log("‚úÖ Skipping token storage - using Supabase native password reset flow"),console.log("üìß Preparing to send invitation email...");const W=`${window.location.origin}/invite-expired`,U=Md({name:v.name,email:v.email,role:v.role,teamName:P||$,passwordSetupLink:H,inviteExpiredUrl:W,inviterName:z==null?void 0:z.name,expiresInHours:24}),Z=Dd({name:v.name,email:v.email,role:v.role,teamName:P||$,passwordSetupLink:H,inviteExpiredUrl:W,inviterName:z==null?void 0:z.name,expiresInHours:24});let Y=!1,ee="";try{console.log("üìß Sending invitation email to:",v.email);const V=await fetch(`${q}/functions/v1/send-email`,{method:"POST",headers:{Authorization:`Bearer ${O.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({to:v.email,subject:`„ÄêBekuta„Äë ${P||$||"Bekuta"}ÂàùÂõû„É≠„Ç∞„Ç§„É≥Ë®≠ÂÆö„ÅÆ„ÅîÊ°àÂÜÖ`,html:U,text:Z})}),te=await V.json();Y=V.ok,Y?console.log("‚úÖ Email sent successfully to:",v.email):(ee=te.error||"Unknown error",console.error("‚ùå Email sending failed:",{status:V.status,error:ee,result:te}))}catch(V){ee=V.message||"Network error",console.error("‚ùå Email sending exception:",V)}const ae={name:v.name,email:v.email,role:v.role,teamName:P,organizationName:$,user_id:(F=B.user)==null?void 0:F.user_id,invitedAt:new Date().toLocaleString("ja-JP"),emailSent:Y,inviteUrl:H};d(V=>[ae,...V]),u({type:"success",text:Y?`${v.name}„Åï„ÇìÔºà${v.email}Ôºâ„ÇíÊãõÂæÖ„Åó„Åæ„Åó„Åü„ÄÇÊãõÂæÖ„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ`:`${v.name}„Åï„ÇìÔºà${v.email}Ôºâ„ÇíÊãõÂæÖ„Åó„Åæ„Åó„Åü„ÄÇ„É°„Éº„É´ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åü„Åü„ÇÅ„ÄÅÊãõÂæÖURL„ÇíÁõ¥Êé•ÂÖ±Êúâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`}),N({name:"",email:"",role:"athlete",organizationId:"",teamId:""}),s()}catch(O){console.error("User invitation error:",O),u({type:"error",text:O.message||"„É¶„Éº„Ç∂„Éº„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"})}finally{p(!1)}},S=T=>{switch(T){case"athlete":return"ÈÅ∏Êâã";case"staff":return"„Çπ„Çø„ÉÉ„Éï";case"global_admin":return"ÁÆ°ÁêÜËÄÖ";default:return T}},C=async(T,M)=>{try{await navigator.clipboard.writeText(T),b(M),setTimeout(()=>b(null),2e3)}catch(k){console.error("Failed to copy password:",k)}},R=async(T,M)=>{try{await navigator.clipboard.writeText(T),b(M+1e3),setTimeout(()=>b(null),2e3)}catch(k){console.error("Failed to copy URL:",k)}},A=()=>{if(f.length===0)return;const M=[["ÂêçÂâç","„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ","ÂΩπÂâ≤","ÁµÑÁπî","„ÉÅ„Éº„É†","„É¶„Éº„Ç∂„ÉºID","ÂàùÂõû„Éë„Çπ„ÉØ„Éº„Éâ","ÊãõÂæÖURL","ÊãõÂæÖÊó•ÊôÇ","„É°„Éº„É´ÈÄÅ‰ø°"].join(","),...f.map(P=>[P.name,P.email,S(P.role),P.organizationName||"-",P.teamName||"-",P.user_id||"ÁîüÊàê‰∏≠",P.temporaryPassword||"-",P.inviteUrl||"-",P.invitedAt,P.emailSent?"ÈÄÅ‰ø°Ê∏à„Åø":"Êú™ÈÄÅ‰ø°"].join(","))].join(`
`),k="\uFEFF",F=new Blob([k+M],{type:"text/csv;charset=utf-8;"}),O=document.createElement("a"),z=URL.createObjectURL(F);O.setAttribute("href",z),O.setAttribute("download",`ÊãõÂæÖÊ∏à„Åø„É¶„Éº„Ç∂„Éº_${_t()}.csv`),O.style.visibility="hidden",document.body.appendChild(O),O.click(),document.body.removeChild(O)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(As,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Êñ∞Ë¶è„É¶„Éº„Ç∂„ÉºÊãõÂæÖ"})]}),f.length>0&&e.jsxs("button",{onClick:A,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm",children:[e.jsx(Sr,{className:"w-4 h-4"}),e.jsx("span",{children:"ÊãõÂæÖÂ±•Ê≠¥„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Ot,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"„É¶„Éº„Ç∂„ÉºÊãõÂæÖ„Éï„Ç©„Éº„É†"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ÂêçÂâç"}),e.jsx("input",{type:"text",value:v.name,onChange:T=>N(M=>({...M,name:T.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Áî∞‰∏≠Â§™ÈÉé",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsx("input",{type:"email",value:v.email,onChange:T=>N(M=>({...M,email:T.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"tanaka@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ÂΩπÂâ≤"}),e.jsxs("select",{value:v.role,onChange:T=>{const M=T.target.value;N(k=>({...k,role:M,teamId:M==="global_admin"?"":k.teamId}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"athlete",children:"ÈÅ∏Êâã"}),e.jsx("option",{value:"staff",children:"„Çπ„Çø„ÉÉ„Éï"}),n&&e.jsx("option",{value:"global_admin",children:"ÁÆ°ÁêÜËÄÖ"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx(Nt,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"ÁµÑÁπî"})]}),e.jsxs("select",{value:v.organizationId,onChange:T=>N(M=>({...M,organizationId:T.target.value,teamId:""})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:x||!!r,children:[e.jsx("option",{value:"",children:x?"Ë™≠„ÅøËæº„Åø‰∏≠...":"ÁµÑÁπî„ÇíÈÅ∏Êäû"}),l.filter(T=>!r||T.id===r).map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„É¶„Éº„Ç∂„Éº„ÅØ„Åì„ÅÆÁµÑÁπî„ÅÆ„É°„É≥„Éê„Éº„Å®„Åó„Å¶ÁôªÈå≤„Åï„Çå„Åæ„Åô"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"„ÉÅ„Éº„É†"}),e.jsxs("select",{value:v.teamId,onChange:T=>N(M=>({...M,teamId:T.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:v.role==="athlete",disabled:v.role==="global_admin"||!v.organizationId,children:[e.jsx("option",{value:"",children:v.role==="global_admin"?"ÁÆ°ÁêÜËÄÖ„ÅØ„ÉÅ„Éº„É†‰∏çË¶Å":v.organizationId?"„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû":"ÂÖà„Å´ÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),c.map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))]}),v.role==="global_admin"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ÁÆ°ÁêÜËÄÖ„ÅØÂÖ®„Å¶„ÅÆ„ÉÅ„Éº„É†„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åô"}),v.role!=="global_admin"&&!v.organizationId&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"ÂÖà„Å´ÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]}),h&&e.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg ${h.type==="success"?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"}`,children:[h.type==="success"?e.jsx(Ne,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(pe,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:h.text})]}),e.jsxs("button",{type:"submit",disabled:w,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:[w?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):e.jsx(Ot,{className:"w-5 h-5 mr-2"}),w?"ÊãõÂæÖ„É°„Éº„É´ÈÄÅ‰ø°‰∏≠...":"ÊãõÂæÖ„É°„Éº„É´„ÇíÈÄÅ‰ø°"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Wt,{className:"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"„É¶„Éº„Ç∂„ÉºÊãõÂæÖ„Å´„Å§„ÅÑ„Å¶"}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-2",children:[e.jsx("p",{children:"1. „É¶„Éº„Ç∂„Éº„ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Å´„Ç¶„Çß„É´„Ç´„É†„É°„Éº„É´„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åô„ÄÇ"}),e.jsx("p",{children:"2. „É°„Éº„É´„Å´„ÅØ„Äå„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆöÁî®„É™„É≥„ÇØ„Äç„ÅåË®òËºâ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ"}),e.jsx("p",{children:"3. „É¶„Éº„Ç∂„Éº„ÅØ„É™„É≥„ÇØÂÖà„ÅßËá™ÂàÜ„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Åæ„Åô„ÄÇ"}),e.jsx("p",{children:"4.  „Éë„Çπ„ÉØ„Éº„Éâ„ÅØ„Ç∑„Çπ„ÉÜ„É†‰∏ä„Å´„ÇÇË°®Á§∫„Åï„Çå„Åæ„Åõ„Çì„ÄÇÂÜçÁô∫Ë°å„ÅØÂÜçÂ∫¶„Äå„Éë„Çπ„ÉØ„Éº„Éâ„É™„Çª„ÉÉ„Éà„Äç„ÇíË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}),e.jsx("p",{children:"5. ÊãõÂæÖ„É™„É≥„ÇØ„ÅÆÊúâÂäπÊúüÈôê„ÅØ24ÊôÇÈñì„Åß„Åô„ÄÇÊúâÂäπÊúüÈôêÂàá„Çå„ÅÆÂ†¥Âêà„ÅØÂÜçÂ∫¶ÊãõÂæÖ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"ÂΩπÂâ≤„ÅÆË™¨Êòé"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("strong",{children:"ÈÅ∏Êâã:"})," Ëá™ÂàÜ„ÅÆÁ∑¥ÁøíË®òÈå≤„ÅÆÂÖ•Âäõ„Å®Èñ≤Ë¶ß„ÅÆ„ÅøÂèØËÉΩ"]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("strong",{children:"„Çπ„Çø„ÉÉ„Éï:"})," ÊãÖÂΩì„ÉÅ„Éº„É†„ÅÆÈÅ∏Êâã„Éá„Éº„Çø„ÇíÈñ≤Ë¶ß„ÉªÁÆ°ÁêÜÂèØËÉΩ"]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full mt-2 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("strong",{children:"ÁÆ°ÁêÜËÄÖ:"})," ÂÖ®„Å¶„ÅÆ„Éá„Éº„Çø„Å®„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ„ÅåÂèØËÉΩ"]})]})]})]}),f.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"ÊúÄËøë„ÅÆÊãõÂæÖÂ±•Ê≠¥"}),e.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:[f.length,"‰ª∂"]})]}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:f.slice(0,10).map((T,M)=>e.jsxs("div",{className:"bg-gray-50 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:T.name}),e.jsx("span",{className:"text-xs text-gray-500",children:T.invitedAt})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsx("p",{children:T.email}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("span",{children:S(T.role)}),T.organizationName&&e.jsxs("span",{className:"flex items-center gap-1",children:["‚Ä¢ ",e.jsx(Nt,{className:"w-3 h-3"})," ",T.organizationName]}),T.teamName&&e.jsxs("span",{children:["‚Ä¢ ",T.teamName]}),T.user_id&&e.jsx("span",{className:"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:T.user_id}),T.emailSent?e.jsxs("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs flex items-center space-x-1",children:[e.jsx(Ot,{className:"w-3 h-3"}),e.jsx("span",{children:"„É°„Éº„É´ÈÄÅ‰ø°Ê∏à„Åø"})]}):e.jsxs("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-xs flex items-center space-x-1",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{children:"„É°„Éº„É´Êú™ÈÄÅ‰ø°"})]})]}),T.temporaryPassword&&e.jsxs("div",{className:"flex items-center space-x-2 bg-yellow-50 border border-yellow-200 p-2 rounded",children:[e.jsx("span",{className:"text-xs font-medium text-yellow-800",children:"ÂàùÂõû„Éë„Çπ„ÉØ„Éº„Éâ:"}),e.jsx("code",{className:"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-yellow-300",children:o[M]?T.temporaryPassword:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),e.jsx("button",{onClick:()=>g(k=>({...k,[M]:!k[M]})),className:"p-1 hover:bg-yellow-100 rounded transition-colors",title:o[M]?"„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÈö†„Åô":"„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË°®Á§∫",children:o[M]?e.jsx(Zt,{className:"w-4 h-4 text-yellow-700"}):e.jsx(Qt,{className:"w-4 h-4 text-yellow-700"})}),e.jsx("button",{onClick:()=>C(T.temporaryPassword,M),className:"p-1 hover:bg-yellow-100 rounded transition-colors",title:"„Éë„Çπ„ÉØ„Éº„Éâ„Çí„Ç≥„Éî„Éº",children:e.jsx(oa,{className:`w-4 h-4 ${m===M?"text-green-600":"text-yellow-700"}`})})]}),T.inviteUrl&&e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 p-2 rounded",children:[e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"ÊãõÂæÖURL:"}),e.jsx("code",{className:"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-blue-300 truncate",children:T.inviteUrl}),e.jsx("button",{onClick:()=>R(T.inviteUrl,M),className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"ÊãõÂæÖURL„Çí„Ç≥„Éî„Éº",children:e.jsx(oa,{className:`w-4 h-4 ${m===M+1e3?"text-green-600":"text-blue-700"}`})}),e.jsx("a",{href:T.inviteUrl,className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"ÊãõÂæÖ„Éö„Éº„Ç∏„ÇíÈñã„ÅèÔºàÂêå„Åò„Çø„Éñ„ÅßÈñã„Åç„Åæ„ÅôÔºâ",children:e.jsx(ul,{className:"w-4 h-4 text-blue-700"})})]})]})]},M))})]})]})]})]})}function Ed({teams:t,onUsersInvited:s,restrictToOrganizationId:r,allowAdminInvite:n=!0}){const[l,i]=a.useState(null),[c,j]=a.useState(!1),[x,y]=a.useState([]),[v,N]=a.useState(!1),w=()=>{const m=["name","email","role","organizationName","team_name"],b=[["Áî∞‰∏≠Â§™ÈÉé","tanaka@example.com","athlete","ÊÑõÂ∑•Â§ßÂêçÈõªÈ´òÊ†°","„Çµ„ÉÉ„Ç´„ÉºÈÉ®"],["‰ΩêËó§Ëä±Â≠ê","sato@example.com","staff","ÊÑõÂ∑•Â§ßÂêçÈõªÈ´òÊ†°","„Éê„Çπ„Ç±„ÉÉ„Éà„Éú„Éº„É´ÈÉ®"],n?["ÁÆ°ÁêÜËÄÖ","admin@example.com","global_admin","ÊÑõÂ∑•Â§ßÂêçÈõªÈ´òÊ†°",""]:null].filter(Boolean),_=["# Bekuta „É¶„Éº„Ç∂„Éº‰∏ÄÊã¨ÊãõÂæÖ„ÉÜ„É≥„Éó„É¨„Éº„Éà","# Ê≥®ÊÑè‰∫ãÈ†Ö:",n?"# - role „ÅØ athlete, staff, global_admin „ÅÆ„ÅÑ„Åö„Çå„Åã„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ":"# - role „ÅØ athlete, staff „ÅÆ„ÅÑ„Åö„Çå„Åã„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ","# - organizationName „ÅØÁÆ°ÁêÜÁîªÈù¢„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÁµÑÁπîÂêç„Å®ÂÆåÂÖ®„Å´Âêå„ÅòÊñáÂ≠óÂàó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ","# - athlete „ÅÆÂ†¥Âêà„ÅØ team_name „ÇíÂøÖ„ÅöÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ","# - staff „ÅÆÂ†¥Âêà„ÇÇ team_name „ÇíÊåáÂÆö„Åô„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„ÅôÔºàÊåáÂÆö„Åó„Åü„ÉÅ„Éº„É†„ÇíÁÆ°ÁêÜ„Åó„Åæ„ÅôÔºâ","# - global_admin „ÅÆÂ†¥Âêà„ÅØ team_name „ÅØÁ©∫ÁôΩ„Åß„ÇÇÊßã„ÅÑ„Åæ„Åõ„Çì","",m.join(","),...b.map(T=>T.join(","))].filter(Boolean).join(`
`),S="\uFEFF",C=new Blob([S+_],{type:"text/csv;charset=utf-8;"}),R=document.createElement("a"),A=URL.createObjectURL(C);R.setAttribute("href",A),R.setAttribute("download","„É¶„Éº„Ç∂„Éº‰∏ÄÊã¨ÊãõÂæÖ„ÉÜ„É≥„Éó„É¨„Éº„Éà.csv"),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)},p=m=>{const b=m.split(`
`).map(F=>F.trim()).filter(F=>F&&!F.startsWith("#"));if(b.length<2)throw new Error("CSV„Å´„Éá„Éº„ÇøË°å„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Éò„ÉÉ„ÉÄ„ÉºÔºã1Ë°å‰ª•‰∏äÂøÖË¶Å„Åß„ÅôÔºâ");const _=b[0].split(",").map(F=>F.trim().replace(/^"|"$/g,"")),S=F=>_.findIndex(O=>F.some(z=>O.toLowerCase()===z.toLowerCase())),C=S(["name"]),R=S(["email"]),A=S(["role"]),T=S(["organizationname","organization","organization_name"]),M=S(["team_name","team"]);if(C===-1||R===-1||A===-1||T===-1)throw new Error("CSV„Å´„ÅØ name, email, role, organizationName „ÅÆ4Âàó„ÅåÂøÖË¶Å„Åß„Åô");const k=[];for(let F=1;F<b.length;F++){const O=b[F].split(",").map($=>$.trim().replace(/^"|"$/g,""));if(!O[C]||!O[R]||!O[A]||!O[T])continue;const z=O[A].toLowerCase();(n?["athlete","staff","global_admin"]:["athlete","staff"]).includes(z)&&k.push({name:O[C],email:O[R],role:z,organizationName:O[T],teamName:M!==-1&&O[M]||void 0})}if(k.length===0)throw new Error("CSV„Å´ÊúâÂäπ„Å™„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");return k},h=async m=>{var T;const{data:{session:b}}=await L.auth.getSession();if(!b)throw new Error("Ë™çË®º„ÅåÂøÖË¶Å„Åß„ÅôÔºà„É≠„Ç∞„Ç§„É≥„ÅóÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ");let _=L.from("organizations").select("id, name");r&&(_=_.eq("id",r));const{data:S,error:C}=await _;if(C||!S||S.length===0)throw new Error("ÁµÑÁπî„É™„Çπ„Éà„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");const R="http://127.0.0.1:54321",A=[];for(const M of m){try{const k=S.find(E=>E.name===M.organizationName);if(!k){A.push({...M,status:"error",message:`ÁµÑÁπî "${M.organizationName}" „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`});continue}if(r&&k.id!==r){A.push({...M,status:"error",message:`„Åì„ÅÆÁîªÈù¢„Åã„Çâ„ÅØÁµÑÁπîID "${r}" „ÅÆ„É¶„Éº„Ç∂„Éº„ÅÆ„ÅøÊãõÂæÖ„Åß„Åç„Åæ„ÅôÔºàCSV‰∏ä„ÅÆÁµÑÁπî: ${M.organizationName}Ôºâ`});continue}let F;if(M.teamName){const E=t.find(D=>D.name===M.teamName&&D.organization_id===k.id);if(!E){A.push({...M,status:"error",message:`ÁµÑÁπî "${k.name}" „Å´„ÉÅ„Éº„É† "${M.teamName}" „ÅØÂ≠òÂú®„Åó„Åæ„Åõ„Çì`});continue}F=E.id}if(M.role==="athlete"&&!F){A.push({...M,status:"error",message:"athleteÔºàÈÅ∏ÊâãÔºâ„Å´„ÅØ team_nameÔºà„ÉÅ„Éº„É†ÂêçÔºâ„ÅÆÊåáÂÆö„ÅåÂøÖÈ†à„Åß„Åô"});continue}console.log("üöÄ Creating user:",M.email);const O=await fetch(`${R}/functions/v1/create-user`,{method:"POST",headers:{Authorization:`Bearer ${b.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({name:M.name,email:M.email,role:M.role,teamId:F,organizationId:k.id,redirectUrl:`${window.location.origin}/reset-password`})}),z=await O.json();if(!O.ok){console.error("‚ùå create-user error:",z),A.push({...M,status:"error",message:z.error||"„É¶„Éº„Ç∂„Éº‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"});continue}const P=z.passwordSetupLink;if(!P){A.push({...M,status:"error",message:"Edge Function „Åã„Çâ„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö„É™„É≥„ÇØ„ÅåËøî„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü"});continue}let $=!1,q="";try{console.log("üìß Sending invitation email to:",M.email);const E=await fetch(`${R}/functions/v1/send-email`,{method:"POST",headers:{Authorization:`Bearer ${b.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({to:M.email,type:"invitation",data:{name:M.name,email:M.email,role:M.role,teamName:M.teamName,passwordSetupLink:P,expiresInHours:24}})}),D=await E.json();$=E.ok,$?console.log("‚úÖ Email sent successfully to:",M.email):(q=D.error||"Unknown error",console.error("‚ùå Invitation email failed:",{status:E.status,error:q,result:D}))}catch(E){q=E.message||"Network error",console.error("‚ùå Invitation email exception:",E)}A.push({...M,status:$?"success":"error",message:$?"ÊãõÂæÖ„É°„Éº„É´ÈÄÅ‰ø°ÂÆå‰∫Ü":`„É¶„Éº„Ç∂„Éº‰ΩúÊàêÂÆå‰∫ÜÔºà„É°„Éº„É´ÈÄÅ‰ø°Â§±Êïó: ${q}Ôºâ`,user_id:(T=z.user)==null?void 0:T.user_id,teamId:F})}catch(k){console.error("‚ùå Bulk invite error for row:",M,k),A.push({...M,status:"error",message:k.message||"„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü"})}await new Promise(k=>setTimeout(k,2e3))}return A},u=m=>{var _;const b=((_=m.target.files)==null?void 0:_[0])||null;i(b),N(!1),y([])},f=async()=>{if(l){j(!0);try{const m=await l.text(),b=p(m),_=await h(b);y(_),N(!0),_.filter(C=>C.status==="success").length>0&&s()}catch(m){console.error("Bulk invitation error:",m),alert(`‰∏ÄÊã¨ÊãõÂæÖ„Ç®„É©„Éº: ${m.message}`)}finally{j(!1)}}},d=()=>{if(x.length===0)return;const m=["ÂêçÂâç","„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ","ÂΩπÂâ≤","ÁµÑÁπî","„ÉÅ„Éº„É†","„É¶„Éº„Ç∂„ÉºID","Áä∂ÊÖã","„É°„ÉÉ„Çª„Éº„Ç∏"],b=[`# ‰∏ÄÊã¨ÊãõÂæÖÁµêÊûú - ${new Date().toLocaleString("ja-JP")}`,`# ÊàêÂäü: ${x.filter(A=>A.status==="success").length}‰ª∂`,`# Â§±Êïó: ${x.filter(A=>A.status==="error").length}‰ª∂`,"",m.join(","),...x.map(A=>[A.name,A.email,A.role==="athlete"?"ÈÅ∏Êâã":A.role==="staff"?"„Çπ„Çø„ÉÉ„Éï":"ÁÆ°ÁêÜËÄÖ",A.organizationName,A.teamName||"-",A.user_id||"-",A.status==="success"?"ÊàêÂäü":"Â§±Êïó",A.message].join(","))].join(`
`),_="\uFEFF",S=new Blob([_+b],{type:"text/csv;charset=utf-8;"}),C=document.createElement("a"),R=URL.createObjectURL(S);C.setAttribute("href",R),C.setAttribute("download",`‰∏ÄÊã¨ÊãõÂæÖÁµêÊûú_${_t()}.csv`),C.style.visibility="hidden",document.body.appendChild(C),C.click(),document.body.removeChild(C)},o=x.filter(m=>m.status==="success").length,g=x.filter(m=>m.status==="error").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($e,{className:"w-6 h-6 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"„É¶„Éº„Ç∂„Éº‰∏ÄÊã¨ÊãõÂæÖ"})]}),e.jsxs("button",{onClick:w,className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm",children:[e.jsx(Sr,{className:"w-4 h-4"}),e.jsx("span",{children:"CSV„ÉÜ„É≥„Éó„É¨„Éº„Éà"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Xa,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"CSV„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíÂê´„ÇÄCSV„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("input",{type:"file",accept:".csv",onChange:u,className:"hidden",id:"csv-upload"}),e.jsxs("label",{htmlFor:"csv-upload",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg cursor-pointer transition-colors inline-flex items-center space-x-2",children:[e.jsx(il,{className:"w-5 h-5"}),e.jsx("span",{children:"CSV„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû"})]}),l&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-700",children:["ÈÅ∏Êäû„Åï„Çå„Åü„Éï„Ç°„Ç§„É´:"," ",e.jsx("strong",{children:l.name})]})}),l&&e.jsxs("button",{onClick:f,disabled:c,className:"mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):e.jsx(Ot,{className:"w-5 h-5 mr-2"}),c?"ÊãõÂæÖÂá¶ÁêÜ‰∏≠...":"‰∏ÄÊã¨ÊãõÂæÖÂÆüË°å"]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"CSV„Éï„Ç°„Ç§„É´ÂΩ¢Âºè"}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-2",children:[e.jsx("p",{children:"CSV„Éï„Ç°„Ç§„É´„Å´„ÅØ‰ª•‰∏ã„ÅÆÂàó„ÅåÂøÖË¶Å„Åß„ÅôÔºö"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"name:"})," „É¶„Éº„Ç∂„ÉºÂêç"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"email:"})," „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"role:"})," athlete, staff, global_admin „ÅÆ„ÅÑ„Åö„Çå„Åã"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"organizationName:"})," ÁµÑÁπîÂêçÔºàÁÆ°ÁêÜÁîªÈù¢„Å´Ë°®Á§∫„Åï„Çå„ÇãÂêçÁß∞„Å®ÂÆåÂÖ®‰∏ÄËá¥Ôºâ"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"team_name:"})," „ÉÅ„Éº„É†ÂêçÔºàathlete „ÅØÂøÖÈ†à / staff Êé®Â•®Ôºâ"]})]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-amber-900 mb-3",children:"Ê≥®ÊÑè‰∫ãÈ†Ö"}),e.jsxs("div",{className:"text-sm text-amber-700 space-y-1",children:[e.jsx("p",{children:"‚Ä¢ ÂêÑ„É¶„Éº„Ç∂„Éº„Å´ÊãõÂæÖ„É°„Éº„É´„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åô"}),e.jsx("p",{children:"‚Ä¢ „É¶„Éº„Ç∂„Éº„ÅØ„É°„Éº„É´ÂÜÖ„ÅÆ„É™„É≥„ÇØ„Åã„Çâ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Åæ„Åô"}),e.jsx("p",{children:"‚Ä¢ ÁµÑÁπîÂêç„Å®„ÉÅ„Éº„É†Âêç„ÅØ„Ç∑„Çπ„ÉÜ„É†‰∏ä„ÅÆÂêçÁß∞„Å®ÂÆåÂÖ®„Å´‰∏ÄËá¥„Åó„Å¶„ÅÑ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô"}),e.jsx("p",{children:"‚Ä¢ Âá¶ÁêÜ„Å´„ÅØÊôÇÈñì„Åå„Åã„Åã„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô"})]})]}),v&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Âá¶ÁêÜÁµêÊûú"}),e.jsxs("button",{onClick:d,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center space-x-1",children:[e.jsx(Sr,{className:"w-3 h-3"}),e.jsx("span",{children:"ÁµêÊûú„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-green-50 rounded p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o}),e.jsx("div",{className:"text-sm text-green-700",children:"ÊàêÂäü"})]}),e.jsxs("div",{className:"bg-red-50 rounded p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:g}),e.jsx("div",{className:"text-sm text-red-700",children:"Â§±Êïó"})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:x.map((m,b)=>e.jsx("div",{className:`p-3 rounded border ${m.status==="success"?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[m.status==="success"?e.jsx(Ne,{className:"w-4 h-4 text-green-600"}):e.jsx(pe,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium",children:m.name}),m.user_id&&e.jsx("span",{className:"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:m.user_id})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[m.email," ‚Ä¢ ",m.role," ","‚Ä¢ ",m.organizationName,m.teamName&&` ‚Ä¢ ${m.teamName}`]}),e.jsx("div",{className:`text-xs mt-1 ${m.status==="success"?"text-green-600":"text-red-600"}`,children:m.message})]})})},b))})]})]})]})]})}function Ad({data:t,itemsPerPage:s=20,renderItem:r,renderHeader:n,loading:l=!1,emptyMessage:i="„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}){const[c,j]=a.useState(1),x=Math.ceil(t.length/s),y=(c-1)*s,v=y+s,N=a.useMemo(()=>t.slice(y,v),[t,y,v]),w=o=>{o>=1&&o<=x&&j(o)},p=()=>w(1),h=()=>w(x),u=()=>w(c-1),f=()=>w(c+1),d=()=>{const g=[],m=[];for(let b=Math.max(2,c-2);b<=Math.min(x-1,c+2);b++)g.push(b);return c-2>2?m.push(1,"..."):m.push(1),m.push(...g),c+2<x-1?m.push("...",x):x>1&&m.push(x),m};return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:i})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:[y+1," - ",Math.min(v,t.length)," / ",t.length,"‰ª∂„ÇíË°®Á§∫"]}),e.jsxs("div",{children:["„Éö„Éº„Ç∏ ",c," / ",x]})]}),n&&n(),e.jsx("div",{className:"space-y-2",children:N.map((o,g)=>r(o,y+g))}),x>1&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 py-4",children:[e.jsx("button",{onClick:p,disabled:c===1,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"ÊúÄÂàù„ÅÆ„Éö„Éº„Ç∏",children:e.jsx(sl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:u,disabled:c===1,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"Ââç„ÅÆ„Éö„Éº„Ç∏",children:e.jsx(Ka,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex items-center space-x-1",children:d().map((o,g)=>e.jsx(Ae.Fragment,{children:o==="..."?e.jsx("span",{className:"px-3 py-2 text-gray-500",children:"..."}):e.jsx("button",{onClick:()=>w(o),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${c===o?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:o})},g))}),e.jsx("button",{onClick:f,disabled:c===x,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"Ê¨°„ÅÆ„Éö„Éº„Ç∏",children:e.jsx(Tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:h,disabled:c===x,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"ÊúÄÂæå„ÅÆ„Éö„Éº„Ç∏",children:e.jsx(rl,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ë°®Á§∫‰ª∂Êï∞:"}),e.jsxs("select",{value:s,onChange:o=>{parseInt(o.target.value),j(1)},className:"border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:10,children:"10‰ª∂"}),e.jsx("option",{value:20,children:"20‰ª∂"}),e.jsx("option",{value:50,children:"50‰ª∂"}),e.jsx("option",{value:100,children:"100‰ª∂"})]})]})]})}function Rd({user:t,teams:s,onClose:r,onUserUpdated:n}){const[l,i]=a.useState({name:t.name,email:t.email,role:t.role,teamId:t.team_id||""}),[c,j]=a.useState(!1),[x,y]=a.useState(null),[v,N]=a.useState([]),[w,p]=a.useState(!1);a.useEffect(()=>{t.role==="staff"&&h()},[t.id,t.role]);const h=async()=>{try{const{data:f,error:d}=await L.from("staff_team_links").select(`
          team_id,
          teams (
            id,
            name
          )
        `).eq("staff_user_id",t.id);if(d){console.error("Error fetching staff teams:",d);return}const o=f==null?void 0:f.map(g=>g.teams).filter(Boolean);N(o||[]),p((o||[]).length>1),o&&o.length>0&&i(g=>({...g,teamId:o[0].id}))}catch(f){console.error("Error fetching staff teams:",f)}},u=async f=>{f.preventDefault(),j(!0),y(null);try{const{data:{session:d}}=await L.auth.getSession();if(!d)throw new Error("Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô");const g=await fetch("http://127.0.0.1:54321/functions/v1/update-user",{method:"POST",headers:{Authorization:`Bearer ${d.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,name:l.name,email:l.email,role:l.role,teamId:l.teamId||void 0})}),m=await g.json();if(!g.ok)throw new Error(m.error||"„É¶„Éº„Ç∂„Éº„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");y({type:"success",text:"„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü„ÄÇ"}),setTimeout(()=>{n()},1e3)}catch(d){console.error("Error updating user:",d),y({type:"error",text:`Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${d.message}`})}finally{j(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-blue-600 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"„É¶„Éº„Ç∂„ÉºÁ∑®ÈõÜ"}),e.jsx("button",{onClick:r,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6",children:[w&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ge,{className:"w-5 h-5 text-amber-600 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-amber-900 mb-2 flex items-center",children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Ë§áÊï∞„ÉÅ„Éº„É†ÁÆ°ÁêÜ„Çπ„Çø„ÉÉ„Éï"]}),e.jsxs("div",{className:"text-sm text-amber-700 space-y-2",children:[e.jsx("p",{children:"„Åì„ÅÆ„Çπ„Çø„ÉÉ„Éï„ÅØË§áÊï∞„ÅÆ„ÉÅ„Éº„É†„ÇíÁÆ°ÁêÜ„Åó„Å¶„ÅÑ„Åæ„ÅôÔºö"}),e.jsx("div",{className:"bg-amber-100 rounded p-2",children:v.map((f,d)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-amber-600 rounded-full mr-2"}),e.jsx("span",{className:"font-medium",children:f.name})]},f.id))}),e.jsxs("div",{className:"bg-white border border-amber-300 rounded p-3 mt-3",children:[e.jsx("p",{className:"font-medium text-amber-900 mb-1",children:"‚ö†Ô∏è Á∑®ÈõÜÊôÇ„ÅÆÊ≥®ÊÑè"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[e.jsx("li",{children:"‚Ä¢ „ÉÅ„Éº„É†Â§âÊõ¥„ÅØÊúÄÂàù„ÅÆ„ÉÅ„Éº„É†„ÅÆ„ÅøË®≠ÂÆö„Åï„Çå„Åæ„Åô"}),e.jsx("li",{children:"‚Ä¢ Ë§áÊï∞„ÉÅ„Éº„É†ÁÆ°ÁêÜ„ÇíÁ∂≠ÊåÅ„Åô„Çã„Å´„ÅØSupabaseÂÅ¥„ÅßË®≠ÂÆö„ÅåÂøÖË¶Å"}),e.jsx("li",{children:"‚Ä¢ ÂΩπÂâ≤Â§âÊõ¥ÊôÇ„ÅØÂÖ®„Å¶„ÅÆ„ÉÅ„Éº„É†Èñ¢ÈÄ£‰ªò„Åë„ÅåÂâäÈô§„Åï„Çå„Åæ„Åô"})]})]})]})]})]})}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ÂêçÂâç"}),e.jsx("input",{type:"text",value:l.name,onChange:f=>i(d=>({...d,name:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsx("input",{type:"email",value:l.email,onChange:f=>i(d=>({...d,email:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ÂΩπÂâ≤",w&&e.jsx("span",{className:"ml-2 text-xs text-amber-600 font-normal",children:"‚ö†Ô∏è Â§âÊõ¥„Åô„Çã„Å®Ë§áÊï∞„ÉÅ„Éº„É†ÁÆ°ÁêÜ„ÅåËß£Èô§„Åï„Çå„Åæ„Åô"})]}),e.jsxs("select",{value:l.role,onChange:f=>{const d=f.target.value;i(o=>({...o,role:d,teamId:d==="global_admin"?"":o.teamId}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${w?"border-amber-300 bg-amber-50":"border-gray-300"}`,children:[e.jsx("option",{value:"athlete",children:"ÈÅ∏Êâã"}),e.jsx("option",{value:"staff",children:"„Çπ„Çø„ÉÉ„Éï"}),e.jsx("option",{value:"global_admin",children:"ÁÆ°ÁêÜËÄÖ"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["„ÉÅ„Éº„É†",w&&l.role==="staff"&&e.jsx("span",{className:"ml-2 text-xs text-amber-600 font-normal",children:"‚ö†Ô∏è ÊúÄÂàù„ÅÆ„ÉÅ„Éº„É†„ÅÆ„ÅøË®≠ÂÆö„Åï„Çå„Åæ„Åô"})]}),e.jsxs("select",{value:l.teamId,onChange:f=>i(d=>({...d,teamId:f.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${w&&l.role==="staff"?"border-amber-300 bg-amber-50":"border-gray-300"}`,required:l.role==="athlete",disabled:l.role==="global_admin",children:[e.jsx("option",{value:"",children:l.role==="global_admin"?"ÁÆ°ÁêÜËÄÖ„ÅØ„ÉÅ„Éº„É†‰∏çË¶Å":"„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû"}),s.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]}),l.role==="global_admin"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ÁÆ°ÁêÜËÄÖ„ÅØÂÖ®„Å¶„ÅÆ„ÉÅ„Éº„É†„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åô"}),l.role==="staff"&&!w&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„Çπ„Çø„ÉÉ„Éï„ÅØÈÅ∏Êäû„Åó„Åü„ÉÅ„Éº„É†„ÇíÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô"}),w&&l.role==="staff"&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Ë§áÊï∞„ÉÅ„Éº„É†ÁÆ°ÁêÜ„ÇíÁ∂≠ÊåÅ„Åô„Çã„Å´„ÅØ„ÄÅSupabaseÂÅ¥„ÅßÂÜçË®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô"})]}),x&&e.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg ${x.type==="success"?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"}`,children:[x.type==="success"?e.jsx(Ne,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(pe,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:x.text})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsxs("button",{type:"submit",disabled:c,className:`flex-1 py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center ${w?"bg-amber-600 hover:bg-amber-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(ms,{className:"w-4 h-4 mr-2"}),c?"Êõ¥Êñ∞‰∏≠...":w?"Ê≥®ÊÑè„Åó„Å¶Êõ¥Êñ∞":"Êõ¥Êñ∞"]})]})]})]})]})})}function $d({user:t,onClose:s,onUserDeleted:r}){const[n,l]=a.useState(!1),[i,c]=a.useState(""),[j,x]=a.useState(null),y=async()=>{if(i!==t.name){x({type:"error",text:"„É¶„Éº„Ç∂„ÉºÂêç„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì„ÄÇ"});return}l(!0),x(null);try{const{data:{session:v}}=await L.auth.getSession();if(!v)throw new Error("Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô");const w=await fetch("http://127.0.0.1:54321/functions/v1/delete-user",{method:"POST",headers:{Authorization:`Bearer ${v.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:t.id})}),p=await w.json();if(!w.ok)throw new Error(p.error||"„É¶„Éº„Ç∂„Éº„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");x({type:"success",text:"„É¶„Éº„Ç∂„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ"}),setTimeout(()=>{r()},1e3)}catch(v){console.error("Error deleting user:",v),x({type:"error",text:`ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${v.message}`})}finally{l(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"bg-red-600 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-6 h-6 mr-3"}),e.jsx("h2",{className:"text-xl font-bold",children:"„É¶„Éº„Ç∂„ÉºÂâäÈô§"})]}),e.jsx("button",{onClick:s,className:"bg-red-500 hover:bg-red-400 rounded-full p-2 transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ge,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900 mb-2",children:"Ë≠¶Âëä: „Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì"}),e.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[e.jsx("p",{children:"‚Ä¢ „É¶„Éº„Ç∂„Éº„Ç¢„Ç´„Ç¶„É≥„Éà„ÅåÂÆåÂÖ®„Å´ÂâäÈô§„Åï„Çå„Åæ„Åô"}),e.jsx("p",{children:"‚Ä¢ Èñ¢ÈÄ£„Åô„ÇãÁ∑¥ÁøíË®òÈå≤„ÇÇÂÖ®„Å¶ÂâäÈô§„Åï„Çå„Åæ„Åô"}),e.jsx("p",{children:"‚Ä¢ „ÉÅ„Éº„É†„Å®„ÅÆÈñ¢ÈÄ£‰ªò„Åë„ÇÇÂâäÈô§„Åï„Çå„Åæ„Åô"})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ÂâäÈô§ÂØæË±°„É¶„Éº„Ç∂„Éº"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ÂêçÂâç:"})," ",t.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"„É°„Éº„É´:"})," ",t.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ÂΩπÂâ≤:"})," ",t.role==="athlete"?"ÈÅ∏Êâã":t.role==="staff"?"„Çπ„Çø„ÉÉ„Éï":"ÁÆ°ÁêÜËÄÖ"]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ÂâäÈô§„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅ„ÄÅ„É¶„Éº„Ç∂„ÉºÂêç„Äå",e.jsx("strong",{children:t.name}),"„Äç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"]}),e.jsx("input",{type:"text",value:i,onChange:v=>c(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:t.name})]}),j&&e.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg mb-4 ${j.type==="success"?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"}`,children:[j.type==="success"?e.jsx(Ne,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(ge,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:j.text})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsxs("button",{onClick:y,disabled:n||i!==t.name,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[n?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(ht,{className:"w-4 h-4 mr-2"}),n?"ÂâäÈô§‰∏≠...":"ÂâäÈô§„Åô„Çã"]})]})]})]})})}function Fd({teams:t,restrictToOrganizationId:s}){const[r,n]=a.useState([]),[l,i]=a.useState([]),[c,j]=a.useState(!0),[x,y]=a.useState(null),[v,N]=a.useState(!1),[w,p]=a.useState(!1),[h,u]=a.useState(null),[f,d]=a.useState(""),[o,g]=a.useState("all"),m=a.useCallback(async()=>{j(!0),u(null);try{if(s){const{data:k,error:F}=await L.from("organization_members").select("user_id").eq("organization_id",s);if(F)throw F;const O=(k==null?void 0:k.map($=>$.user_id))||[];if(O.length===0){n([]);return}const{data:z,error:P}=await L.from("users").select("*").in("id",O).neq("role","global_admin").order("created_at",{ascending:!1});if(P)throw P;n(z||[])}else{const{data:k,error:F}=await L.from("users").select("*").order("created_at",{ascending:!1});if(F)throw F;n(k||[])}}catch(k){console.error("Error fetching users:",k),u("„É¶„Éº„Ç∂„Éº„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+k.message)}finally{j(!1)}},[s]);a.useEffect(()=>{m()},[m]),a.useEffect(()=>{let k=r;f&&(k=k.filter(F=>F.name.toLowerCase().includes(f.toLowerCase())||F.email.toLowerCase().includes(f.toLowerCase())||F.user_id&&F.user_id.toLowerCase().includes(f.toLowerCase()))),o!=="all"&&(k=k.filter(F=>F.role===o)),i(k)},[r,f,o]);const b=()=>{N(!1),y(null),m()},_=()=>{p(!1),y(null),m()},S=k=>{y(k),N(!0)},C=k=>{y(k),p(!0)},R=k=>{if(!k)return"-";const F=t.find(O=>O.id===k);return F?F.name:"‰∏çÊòé„Å™„ÉÅ„Éº„É†"},A=k=>{switch(k){case"athlete":return"ÈÅ∏Êâã";case"staff":return"„Çπ„Çø„ÉÉ„Éï";case"global_admin":return"ÁÆ°ÁêÜËÄÖ";default:return k}},T=k=>{switch(k){case"global_admin":return"bg-purple-100 text-purple-800";case"staff":return"bg-green-100 text-green-800";case"athlete":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},M=(k,F)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"block sm:hidden space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"font-mono text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:k.user_id||"N/A"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${T(k.role)}`,children:A(k.role)})]}),e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:k.name}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:k.email}),e.jsx("p",{className:"text-xs text-gray-500",children:R(k.team_id)})]}),e.jsxs("div",{className:"flex space-x-2 ml-2",children:[e.jsx("button",{onClick:()=>S(k),className:"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors",title:"Á∑®ÈõÜ",children:e.jsx(Xs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(k),className:"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors",title:"ÂâäÈô§",children:e.jsx(ht,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"hidden sm:grid grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"„É¶„Éº„Ç∂„ÉºID"}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 text-gray-700 px-2 py-1 rounded inline-block",children:k.user_id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ÂêçÂâç"}),e.jsx("div",{className:"font-semibold text-gray-900",children:k.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"„É°„Éº„É´"}),e.jsx("div",{className:"text-sm text-gray-700 break-all",children:k.email})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ÂΩπÂâ≤"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${T(k.role)}`,children:A(k.role)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"„ÉÅ„Éº„É†"}),e.jsx("div",{className:"text-sm text-gray-700",children:R(k.team_id)})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>S(k),className:"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors",title:"Á∑®ÈõÜ",children:e.jsx(Xs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(k),className:"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors",title:"ÂâäÈô§",children:e.jsx(ht,{className:"w-4 h-4"})})]})]})]},k.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($e,{className:"w-6 h-6 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[r.length,"Âêç„ÅÆ„É¶„Éº„Ç∂„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô"]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Br,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"ÂêçÂâç„ÄÅ„É°„Éº„É´„ÄÅ„Åæ„Åü„ÅØ„É¶„Éº„Ç∂„ÉºID„ÅßÊ§úÁ¥¢...",value:f,onChange:k=>d(k.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("div",{className:"relative",children:[e.jsx(rr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:o,onChange:k=>g(k.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none",children:[e.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂΩπÂâ≤"}),e.jsx("option",{value:"global_admin",children:"ÁÆ°ÁêÜËÄÖ"}),e.jsx("option",{value:"staff",children:"„Çπ„Çø„ÉÉ„Éï"}),e.jsx("option",{value:"athlete",children:"ÈÅ∏Êâã"})]})]})})]}),(f||o!=="all")&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:["„Éï„Ç£„É´„Çø„ÉºÁµêÊûú: ",l.length,"Âêç",f&&e.jsxs("span",{className:"ml-2",children:["„Äå",f,"„Äç„ÅßÊ§úÁ¥¢"]}),o!=="all"&&e.jsxs("span",{className:"ml-2",children:["ÂΩπÂâ≤: ",A(o)]})]}),e.jsx("button",{onClick:()=>{d(""),g("all")},className:"text-blue-600 hover:text-blue-700 underline",children:"„Éï„Ç£„É´„Çø„Éº„Çí„ÇØ„É™„Ç¢"})]})})]}),h&&e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:[e.jsx(pe,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:h})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.filter(k=>k.role==="global_admin").length}),e.jsx("div",{className:"text-sm text-purple-700",children:"ÁÆ°ÁêÜËÄÖ"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.filter(k=>k.role==="staff").length}),e.jsx("div",{className:"text-sm text-green-700",children:"„Çπ„Çø„ÉÉ„Éï"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.filter(k=>k.role==="athlete").length}),e.jsx("div",{className:"text-sm text-blue-700",children:"ÈÅ∏Êâã"})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:r.length}),e.jsx("div",{className:"text-sm text-gray-700",children:"ÂêàË®à"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h3",{className:"font-medium text-gray-900",children:"„É¶„Éº„Ç∂„Éº‰∏ÄË¶ß"})}),e.jsx("div",{className:"p-4",children:e.jsx(Ad,{data:l,itemsPerPage:10,renderItem:M,loading:c,emptyMessage:f||o!=="all"?"„Éï„Ç£„É´„Çø„ÉºÊù°‰ª∂„Å´Ë©≤ÂΩì„Åô„Çã„É¶„Éº„Ç∂„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ":"„É¶„Éº„Ç∂„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ"})})]}),x&&v&&e.jsx(Rd,{user:x,teams:t,onClose:()=>{N(!1),y(null)},onUserUpdated:b}),x&&w&&e.jsx($d,{user:x,onClose:()=>{p(!1),y(null)},onUserDeleted:_})]})}function Ld(){const[t,s]=a.useState("high"),[r,n]=a.useState(!1),[l,i]=a.useState(null),[c,j]=a.useState(null),[x,y]=a.useState(null),[v,N]=a.useState(!1),[w,p]=a.useState(null),h=a.useMemo(()=>{const g="http://127.0.0.1:54321";return g?`${g}/functions/v1/calculate-metabolism`:"/functions/v1/calculate-metabolism"},[]),u=async()=>{var g,m;n(!0),i(null);try{const{data:b}=await L.auth.getUser(),_=(g=b==null?void 0:b.user)==null?void 0:g.id;if(!_)throw new Error("„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„Éº„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì");const{data:S}=await L.auth.getSession(),C=(m=S==null?void 0:S.session)==null?void 0:m.access_token;if(!C)throw new Error("„Ç¢„ÇØ„Çª„Çπ„Éà„Éº„ÇØ„É≥ÂèñÂæóÂ§±Êïó");const R=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify({activity_level:t})}),A=await R.json();if(!R.ok)throw new Error((A==null?void 0:A.error)??"Edge Function error");j(A),await f(_)}catch(b){i(String((b==null?void 0:b.message)??b)),j(null)}finally{n(!1)}},f=async g=>{N(!0),p(null);try{const{data:m,error:b}=await L.from("nutrition_metabolism_7d_avg").select("*").eq("user_id",g).single();if(b)throw b;y(m)}catch(m){p(String((m==null?void 0:m.message)??m)),y(null)}finally{N(!1)}},d=a.useMemo(()=>!c||!x?null:c.tdee-x.avg_tdee,[c,x]),o=a.useMemo(()=>d===null?null:d>150?"‰ªäÊó•„ÅØÊ¥ªÂãïÈáè„Åå„Åã„Å™„ÇäÈ´ò„ÇÅ":d>50?"‰ªäÊó•„ÅØ„ÇÑ„ÇÑÊ¥ªÂãïÈáèÂ§ö„ÇÅ":d<-150?"‰ªäÊó•„ÅØÊ¥ªÂãïÈáè„Åå‰Ωé„ÇÅ":d<-50?"‰ªäÊó•„ÅØ„ÇÑ„ÇÑÊ¥ªÂãïÈáèÂ∞ë„Å™„ÇÅ":"Âπ≥ÂùáÁöÑ„Å™Ê¥ªÂãïÈáè",[d]);return a.useEffect(()=>{u()},[]),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Ê†ÑÈ§ä„Éá„Éê„ÉÉ„Ç∞ÔºàÈùûÂÖ¨ÈñãÔºâ"})]}),e.jsxs("button",{onClick:u,disabled:r,className:"inline-flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(wl,{className:`w-4 h-4 ${r?"animate-spin":""}`}),"ÂÜçÂèñÂæó"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 mb-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Wt,{className:"w-4 h-4 text-gray-400"}),"InBody ‚Üí LBM ‚Üí BMR ‚Üí TDEEÔºàÊ§úË®ºÁî®Ôºâ"]}),e.jsxs("div",{className:"sm:ml-auto flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Ê¥ªÂãï„É¨„Éô„É´"}),e.jsxs("select",{value:t,onChange:g=>s(g.target.value),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"low",children:"low"}),e.jsx("option",{value:"medium",children:"medium"}),e.jsx("option",{value:"high",children:"high"}),e.jsx("option",{value:"elite",children:"elite"})]}),e.jsx("button",{onClick:u,disabled:r,className:"px-3 py-2 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:"ÂèçÊò†"})]})]}),l&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700 flex items-start gap-2",children:[e.jsx(ge,{className:"w-4 h-4 mt-0.5"}),e.jsx("div",{children:l})]}),c&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"‰ΩìÈáç"}),e.jsxs("div",{className:"text-2xl font-bold",children:[c.weight," kg"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"‰ΩìËÑÇËÇ™Áéá"}),e.jsxs("div",{className:"text-2xl font-bold",children:[c.body_fat_percent??"‚Äî","%"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Èô§ËÑÇËÇ™‰ΩìÈáçÔºàLBMÔºâ"}),e.jsxs("div",{className:"text-2xl font-bold",children:[c.lean_mass??"‚Äî"," kg"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"BMR"}),e.jsxs("div",{className:"text-2xl font-bold",children:[c.bmr," kcal"]})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg sm:col-span-2",children:[e.jsx("div",{className:"text-xs text-indigo-700",children:"TDEE"}),e.jsxs("div",{className:"text-3xl font-extrabold text-indigo-900",children:[c.tdee," kcal"]})]})]}),v&&e.jsx("div",{className:"text-sm text-gray-500",children:"7Êó•Âπ≥Âùá„ÇíË®àÁÆó‰∏≠..."}),w&&e.jsxs("div",{className:"text-sm text-yellow-700",children:["7Êó•Âπ≥ÂùáÂèñÂæóÂ§±Êïó: ",w]}),x&&c&&d!==null&&e.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Áõ¥Ëøë7Êó•Âπ≥Âùá„Å®„ÅÆÂ∑ÆÔºàÊ¥ªÂãïÈáèÔºâ"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"‰ªäÊó•"}),e.jsxs("div",{className:"font-bold",children:[c.tdee," kcal"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"7Êó•Âπ≥Âùá"}),e.jsxs("div",{className:"font-bold",children:[x.avg_tdee," kcal"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Â∑ÆÂàÜ"}),e.jsxs("div",{className:`font-bold ${d>0?"text-red-600":d<0?"text-blue-600":"text-gray-700"}`,children:[d>0&&"+",d," kcal"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-2",children:["Ë©ï‰æ°Ôºö",e.jsx("span",{className:"font-semibold",children:o})]})]})]})}function Pd(t=new Date){const s=t.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}).split("/");return`${s[0]}-${s[1].padStart(2,"0")}-${s[2].padStart(2,"0")}`}async function qd(t){return new Promise((s,r)=>{const n=new FileReader;n.onload=()=>{const l=n.result;s(l.split(",")[1])},n.onerror=r,n.readAsDataURL(t)})}function zd(){const[t,s]=a.useState("ÊúùÈ£ü"),[r,n]=a.useState(1),[l,i]=a.useState(Pd()),[c,j]=a.useState(null),[x,y]=a.useState(!1),[v,N]=a.useState(""),w="nutrition-images",p=a.useMemo(()=>c?URL.createObjectURL(c):"",[c]),h=async()=>{var u,f;if(!c)return N("ÁîªÂÉè„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ");y(!0),N("");try{const{data:d}=await L.auth.getUser(),o=(u=d==null?void 0:d.user)==null?void 0:u.id;if(!o)throw new Error("Êú™„É≠„Ç∞„Ç§„É≥");const g=c.name.split(".").pop()||"jpg",m=crypto.randomUUID(),b=`nutrition/${o}/${l}/${m}.${g}`,{error:_}=await L.storage.from(w).upload(b,c,{contentType:c.type});if(_)throw _;const{data:S}=L.storage.from(w).getPublicUrl(b),{data:C,error:R}=await L.from("nutrition_logs").insert({user_id:o,record_date:l,meal_type:t,meal_slot:r,image_path:b,image_url:S.publicUrl}).select().single();if(R)throw R;const A=await qd(c),{data:T}=await L.auth.getSession(),M=await fetch("http://127.0.0.1:54321/functions/v1/nutrition-analyze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(f=T==null?void 0:T.session)==null?void 0:f.access_token}`},body:JSON.stringify({meal_type:t,image_base64:A,mime_type:c.type,user_name:"user"})}),k=await M.json();if(!M.ok)throw new Error(k.error);await L.from("nutrition_logs").update({total_calories:k.result.total_calories,p:k.result.nutrients.p,f:k.result.nutrients.f,c:k.result.nutrients.c,menu_items:k.result.menu_items,advice_markdown:k.result.advice_markdown}).eq("id",C.id),N("‚úÖ „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÔºÜAIËß£Êûê ÂÆå‰∫ÜÔºÅ"),j(null)}catch(d){console.error(d),N(`‚ùå ${d.message}`)}finally{y(!1)}};return e.jsxs("div",{className:"bg-white border rounded-xl p-4 space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold",children:"üì∏ È£ü‰∫ãÂÜôÁúü„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Êó•‰ªò"}),e.jsx("input",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:l,onChange:u=>i(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"È£ü‰∫ã„Çø„Ç§„Éó"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:t,onChange:u=>{const f=u.target.value;s(f),f!=="Ë£úÈ£ü"&&n(1)},children:[e.jsx("option",{value:"ÊúùÈ£ü",children:"ÊúùÈ£ü"}),e.jsx("option",{value:"ÊòºÈ£ü",children:"ÊòºÈ£ü"}),e.jsx("option",{value:"Â§ïÈ£ü",children:"Â§ïÈ£ü"}),e.jsx("option",{value:"Ë£úÈ£ü",children:"Ë£úÈ£ü"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"„Çπ„É≠„ÉÉ„Éà"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:r,disabled:t!=="Ë£úÈ£ü",onChange:u=>n(Number(u.target.value)),children:[e.jsx("option",{value:1,children:"1"}),e.jsx("option",{value:2,children:"2"})]}),e.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:"‚Äª Ë£úÈ£ü„ÅÆ„Åø 1 / 2„ÄÅÊúùÊòºÂ§ï„ÅØ 1 Âõ∫ÂÆö"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:u=>{var f;return j(((f=u.target.files)==null?void 0:f[0])??null)}}),p&&e.jsx("img",{src:p,className:"max-h-60 rounded border"})]}),e.jsx("button",{onClick:h,disabled:x||!c,className:"px-4 py-2 bg-indigo-600 text-white rounded disabled:opacity-50",children:x?"Ëß£Êûê‰∏≠...":"„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÔºÜËß£Êûê"}),v&&e.jsx("div",{className:"text-sm",children:v})]})}function Od({userId:t}){const{organizations:s,loading:r,error:n,createOrganization:l,updateOrganization:i,deleteOrganization:c}=ir(t),[j,x]=a.useState(),[y,v]=a.useState(!1),[N,w]=a.useState(!1),[p,h]=a.useState(null);return r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):n?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800 mb-2",children:"ÁµÑÁπî„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:n}),e.jsxs("details",{className:"text-xs text-red-600",children:[e.jsx("summary",{className:"cursor-pointer hover:text-red-800 font-medium mb-1",children:"„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±"}),e.jsxs("div",{className:"mt-2 bg-red-100 p-2 rounded border border-red-200 font-mono",children:[e.jsxs("p",{children:["User ID: ",t]}),e.jsxs("p",{children:["Error: ",n]}),e.jsxs("p",{className:"mt-2 text-red-700",children:["ËÄÉ„Åà„Çâ„Çå„ÇãÂéüÂõ†:",e.jsx("br",{}),"‚Ä¢ „Éá„Éº„Çø„Éô„Éº„Çπ„ÅÆRLS„Éù„É™„Ç∑„Éº„Åß„Ç¢„ÇØ„Çª„Çπ„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Çã",e.jsx("br",{}),"‚Ä¢ „É¶„Éº„Ç∂„Éº„ÅÆrole„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ",e.jsx("br",{}),"‚Ä¢ auth.uid()„Å®users.id„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞„Å´ÂïèÈ°å„Åå„ÅÇ„Çã"]})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Nt,{className:"h-6 w-6"}),"ÁµÑÁπîÁÆ°ÁêÜ"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"ÁµÑÁπî„Å®„ÉÅ„Éº„É†„ÅÆ‰ΩúÊàê„ÉªÁÆ°ÁêÜ"})]}),e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(It,{className:"h-4 w-4"}),"ÁµÑÁπî„ÇíËøΩÂä†"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ÁµÑÁπî‰∏ÄË¶ß"})}),e.jsx("div",{className:"divide-y",children:s.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"ÁµÑÁπî„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):s.map(u=>e.jsx(Bd,{organization:u,isSelected:j===u.id,onSelect:()=>x(u.id),onEdit:()=>h(u),onDelete:async()=>{if(confirm(`${u.name}„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºüÈñ¢ÈÄ£„Åô„Çã„ÉÅ„Éº„É†„ÇÇÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ`))try{await c(u.id),j===u.id&&x(void 0)}catch(f){alert("ÁµÑÁπî„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(f instanceof Error?f.message:"Unknown error"))}}},u.id))})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:j?e.jsx(Wd,{organizationId:j,onCreateClick:()=>w(!0)}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Â∑¶ÂÅ¥„Åã„ÇâÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})})]}),y&&e.jsx(Ud,{onClose:()=>v(!1),onCreate:async(u,f)=>{try{await l(u,f);const d=document.createElement("div");d.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",d.innerHTML=`
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>ÁµÑÁπî„Äå${u}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü</span>
              `,document.body.appendChild(d),setTimeout(()=>{d.style.opacity="0",d.style.transition="opacity 0.3s",setTimeout(()=>d.remove(),300)},3e3),v(!1)}catch(d){alert("ÁµÑÁπî„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(d instanceof Error?d.message:"Unknown error"))}}}),p&&e.jsx(Hd,{organization:p,onClose:()=>h(null),onUpdate:async u=>{try{await i(p.id,u);const f=document.createElement("div");f.className="fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",f.innerHTML=`
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>ÁµÑÁπî„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü</span>
              `,document.body.appendChild(f),setTimeout(()=>{f.style.opacity="0",f.style.transition="opacity 0.3s",setTimeout(()=>f.remove(),300)},3e3),h(null)}catch(f){alert("ÁµÑÁπî„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(f instanceof Error?f.message:"Unknown error"))}}}),N&&j&&e.jsx(Vd,{organizationId:j,onClose:()=>w(!1)})]})}function Bd({organization:t,isSelected:s,onSelect:r,onEdit:n,onDelete:l}){return e.jsx("div",{className:`p-4 cursor-pointer transition-colors ${s?"bg-blue-50 border-l-4 border-blue-600":"hover:bg-gray-50"}`,onClick:r,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:t.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["‰ΩúÊàêÊó•: ",new Date(t.created_at).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{onClick:n,className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",title:"Á∑®ÈõÜ",children:e.jsx(pl,{className:"h-4 w-4"})}),e.jsx("button",{onClick:l,className:"p-1 text-gray-600 hover:text-red-600 transition-colors",title:"ÂâäÈô§",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})})}function Wd({organizationId:t,onCreateClick:s}){const{teams:r,loading:n,deleteTeam:l}=cn(t);return console.log("TeamPanel render:",{organizationId:t,loading:n,teamsCount:r.length,teams:r}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),"„ÉÅ„Éº„É†‰∏ÄË¶ß (",r.length,")"]}),e.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(It,{className:"h-4 w-4"}),"„ÉÅ„Éº„É†„ÇíËøΩÂä†"]})]}),e.jsx("div",{className:"divide-y max-h-[500px] overflow-y-auto",children:n?e.jsx("div",{className:"p-6 text-center",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):r.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"„ÉÅ„Éº„É†„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):r.map(i=>e.jsx(Id,{team:i,onDelete:async()=>{if(confirm(`${i.name}„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºüÊâÄÂ±û„Åô„ÇãÈÅ∏Êâã„Å®„Ç≥„Éº„ÉÅ„ÅÆ„Éá„Éº„Çø„ÇÇÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ`))try{await l(i.id)}catch(c){alert("„ÉÅ„Éº„É†„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(c instanceof Error?c.message:"Unknown error"))}}},i.id))})]})}function Id({team:t,onDelete:s}){return e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-3 w-3"}),"ÈÅ∏Êâã: ",t.member_count||0,"Âêç"]}),e.jsxs("span",{className:"flex items-center gap-1",children:["„Ç≥„Éº„ÉÅ: ",t.staff_count||0,"Âêç"]})]})]}),e.jsx("button",{onClick:s,className:"p-1 text-gray-600 hover:text-red-600 transition-colors ml-4",title:"ÂâäÈô§",children:e.jsx(ht,{className:"h-4 w-4"})})]})})}function Ud({onClose:t,onCreate:s}){const[r,n]=a.useState(""),[l,i]=a.useState(""),[c,j]=a.useState(!1),x=async y=>{if(y.preventDefault(),!!r.trim()){j(!0);try{await s(r.trim(),l.trim())}finally{j(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ÁµÑÁπî„ÇíËøΩÂä†"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ÁµÑÁπîÂêç ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",value:r,onChange:y=>n(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"‰æã: Ê†™Âºè‰ºöÁ§æ„Çµ„É≥„Éó„É´",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ë™¨Êòé"}),e.jsx("textarea",{value:l,onChange:y=>i(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"ÁµÑÁπî„ÅÆË™¨Êòé„ÇíÂÖ•ÂäõÔºà‰ªªÊÑèÔºâ"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:c,children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:c||!r.trim(),children:c?"‰ΩúÊàê‰∏≠...":"‰ΩúÊàê"})]})]})})})}function Hd({organization:t,onClose:s,onUpdate:r}){const[n,l]=a.useState(t.name),[i,c]=a.useState(t.description||""),[j,x]=a.useState(!1),y=async v=>{if(v.preventDefault(),!!n.trim()){x(!0);try{await r({name:n.trim(),description:i.trim()})}finally{x(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ÁµÑÁπî„ÇíÁ∑®ÈõÜ"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ÁµÑÁπîÂêç ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",value:n,onChange:v=>l(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ë™¨Êòé"}),e.jsx("textarea",{value:i,onChange:v=>c(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:j,children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:j||!n.trim(),children:j?"Êõ¥Êñ∞‰∏≠...":"Êõ¥Êñ∞"})]})]})})})}function Vd({organizationId:t,onClose:s}){const{createTeam:r}=cn(t),[n,l]=a.useState(""),[i,c]=a.useState(!1),j=async x=>{if(x.preventDefault(),!!n.trim()){c(!0);try{const y=await r(n.trim());console.log("Team created successfully, closing modal:",y);const v=document.createElement("div");v.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",v.innerHTML=`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>„ÉÅ„Éº„É†„Äå${n.trim()}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü</span>
      `,document.body.appendChild(v),setTimeout(()=>{v.style.opacity="0",v.style.transition="opacity 0.3s",setTimeout(()=>v.remove(),300)},3e3),s()}catch(y){alert("„ÉÅ„Éº„É†„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(y instanceof Error?y.message:"Unknown error"))}finally{c(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"„ÉÅ„Éº„É†„ÇíËøΩÂä†"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["„ÉÅ„Éº„É†Âêç ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",value:n,onChange:x=>l(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"‰æã: U-15„Çµ„ÉÉ„Ç´„Éº„ÉÅ„Éº„É†",required:!0,autoFocus:!0})]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:i,children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",disabled:i||!n.trim(),children:i?"‰ΩúÊàê‰∏≠...":"‰ΩúÊàê"})]})]})})})}function Kd({organizationId:t,organizationName:s}){var T,M;const[r,n]=a.useState([]),[l,i]=a.useState(!0),[c,j]=a.useState(null),[x,y]=a.useState(new Set),[v,N]=a.useState(!1),[w,p]=a.useState(null),[h,u]=a.useState([]),[f,d]=a.useState("");a.useEffect(()=>{o(),g()},[t]);const o=async()=>{try{i(!0),j(null);const{data:k,error:F}=await L.from("teams").select("*").eq("organization_id",t).order("name");if(F)throw F;if(!k||k.length===0){n([]);return}const O=await Promise.all(k.map(async z=>{const{data:P,error:$}=await L.from("users").select("*").eq("team_id",z.id).eq("role","athlete").order("name");if($)throw $;const{data:q,error:E}=await L.from("staff_team_links").select(`
              staff_user_id,
              users!staff_team_links_staff_user_id_fkey (
                id,
                name,
                email,
                role
              )
            `).eq("team_id",z.id);if(E)throw E;const D=(q==null?void 0:q.map(B=>B.users).filter(Boolean))||[];return{...z,athletes:P||[],coaches:D}}));n(O)}catch(k){console.error("Error loading teams and members:",k),j(k instanceof Error?k.message:"ÁµÑÁπî„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{i(!1)}},g=async()=>{try{const{data:k,error:F}=await L.from("organization_members").select("user_id").eq("organization_id",t);if(F)throw F;if(!k||k.length===0){console.log("No organization members found"),u([]);return}const O=k.map($=>$.user_id),{data:z,error:P}=await L.from("users").select("id, name, email, role, team_id").in("id",O);if(P)throw P;console.log("Organization members loaded:",z),console.log("Total members:",(z==null?void 0:z.length)||0),u(z||[])}catch(k){console.error("Error loading organization members:",k)}},m=k=>{y(F=>{const O=new Set(F);return O.has(k)?O.delete(k):O.add(k),O})},b=k=>{p(k),N(!0),d("")},_=async(k,F)=>{if(w)try{if(F==="athlete"){console.log("‚ûï Adding athlete to team using update_athlete_team function");const{data:O,error:z}=await L.rpc("update_athlete_team",{athlete_id:k,new_team_id:w.id});if(console.log("üìä Function response:",{data:O,error:z}),z)throw z}else{const{error:O}=await L.from("staff_team_links").insert({staff_user_id:k,team_id:w.id});if(O)throw O}console.log("üîÑ Reloading teams and members..."),await o(),await g(),N(!1),p(null),alert("„É°„É≥„Éê„Éº„Çí„ÉÅ„Éº„É†„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü")}catch(O){console.error("‚ùå Error assigning member:",O),alert("„É°„É≥„Éê„Éº„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(O instanceof Error?O.message:"‰∏çÊòé„Å™„Ç®„É©„Éº"))}},S=async(k,F,O)=>{if(confirm("„Åì„ÅÆ„É°„É≥„Éê„Éº„Çí„ÉÅ„Éº„É†„Åã„ÇâÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü"))try{if(console.log("üóëÔ∏è Removing member:",{userId:k,memberRole:F,teamId:O}),F==="athlete"){console.log("üîÑ Calling update_athlete_team function with null team_id");const{data:z,error:P}=await L.rpc("update_athlete_team",{athlete_id:k,new_team_id:null});if(console.log("üìä Function response:",{data:z,error:P}),P)throw P;console.log("‚úÖ Athlete removed successfully")}else{console.log("üîÑ Deleting staff_team_link");const{error:z}=await L.from("staff_team_links").delete().eq("staff_user_id",k).eq("team_id",O);if(z)throw z;console.log("‚úÖ Staff removed successfully")}console.log("üîÑ Reloading teams and members..."),await o(),alert("„É°„É≥„Éê„Éº„Çí„ÉÅ„Éº„É†„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü")}catch(z){console.error("‚ùå Error removing member:",z),alert("„É°„É≥„Éê„Éº„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(z instanceof Error?z.message:"‰∏çÊòé„Å™„Ç®„É©„Éº"))}},C=h.filter(k=>k.role==="athlete").length,R=h.filter(k=>k.role==="athlete"&&!k.team_id).length,A=h.filter(k=>k.role==="staff").length;return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):c?e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 dark:text-red-200",children:c})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:s}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"ÁµÑÁπîÂÖ®‰Ωì„ÅÆ„ÉÅ„Éº„É†„Å®„É°„É≥„Éê„Éº„ÅÆÊ¶ÇË¶Å"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-1",children:"ÁôªÈå≤„ÉÅ„Éº„É†Êï∞"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-100",children:r.length})]}),e.jsx($e,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})]})}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-1",children:"ÈÅ∏ÊâãÁ∑èÊï∞"}),e.jsx("p",{className:"text-3xl font-bold text-green-900 dark:text-green-100",children:C}),R>0&&e.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["‚ö†Ô∏è „ÉÅ„Éº„É†Êú™ÊâÄÂ±û: ",R,"Âêç"]})]}),e.jsx(Tr,{className:"h-8 w-8 text-green-600 dark:text-green-400"})]})}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300 mb-1",children:"„Ç≥„Éº„ÉÅÁ∑èÊï∞"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900 dark:text-purple-100",children:A})]}),e.jsx(ys,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})]})})]}),R>0&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"}),e.jsxs("h3",{className:"text-sm font-semibold text-orange-900 dark:text-orange-100",children:["„ÉÅ„Éº„É†Êú™ÊâÄÂ±û„ÅÆÈÅ∏Êâã (",R,"Âêç)"]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:h.filter(k=>k.role==="athlete"&&!k.team_id).map(k=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-orange-200 dark:border-orange-600",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:k.name}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:k.email})]},k.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"„ÉÅ„Éº„É†Âà•„É°„É≥„Éê„Éº‰∏ÄË¶ß"})}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"„Åì„ÅÆÁµÑÁπî„Å´„ÅØ„ÉÅ„Éº„É†„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):r.map(k=>{const F=x.has(k.id);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("button",{onClick:()=>m(k.id),className:"flex-1 flex items-center gap-3 text-left",children:[F?e.jsx(qr,{className:"h-5 w-5 text-gray-400"}):e.jsx(Tt,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:k.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ÈÅ∏Êâã ",k.athletes.length,"Âêç / „Ç≥„Éº„ÉÅ ",k.coaches.length,"Âêç"]})]})]}),e.jsxs("button",{onClick:()=>b(k),className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{children:"„É°„É≥„Éê„ÉºËøΩÂä†"})]})]}),F&&e.jsx("div",{className:"px-4 pb-4 bg-gray-50 dark:bg-gray-700/30",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(Tr,{className:"h-4 w-4"}),"ÈÅ∏Êâã (",k.athletes.length,")"]}),e.jsx("div",{className:"space-y-2",children:k.athletes.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"ÈÅ∏Êâã„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):k.athletes.map(O=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:O.name}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:O.email})]}),e.jsx("button",{onClick:()=>S(O.id,"athlete",k.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"ÂâäÈô§",children:e.jsx(ys,{className:"h-4 w-4"})})]},O.id))})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4"}),"„Ç≥„Éº„ÉÅ (",k.coaches.length,")"]}),e.jsx("div",{className:"space-y-2",children:k.coaches.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"„Ç≥„Éº„ÉÅ„ÅåÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):k.coaches.map(O=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:O.name}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:O.email})]}),e.jsx("button",{onClick:()=>S(O.id,"staff",k.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"ÂâäÈô§",children:e.jsx(ys,{className:"h-4 w-4"})})]},O.id))})]})]})})]},k.id)})})]}),v&&w&&e.jsx(Jd,{team:w,allTeams:r,organizationMembers:h,currentTeamMembers:[...((T=r.find(k=>k.id===w.id))==null?void 0:T.athletes)||[],...((M=r.find(k=>k.id===w.id))==null?void 0:M.coaches)||[]],searchQuery:f,onSearchChange:d,onClose:()=>{N(!1),p(null),d("")},onAssign:_})]})}function Jd({team:t,allTeams:s,organizationMembers:r,currentTeamMembers:n,searchQuery:l,onSearchChange:i,onClose:c,onAssign:j}){const[x,y]=a.useState(!1),v=new Set(n.map(u=>u.id)),N=r.filter(u=>{var f,d;if(v.has(u.id)||u.role==="athlete"&&u.team_id&&u.team_id!==t.id)return!1;if(l){const o=l.toLowerCase(),g=(f=u.name)==null?void 0:f.toLowerCase().includes(o),m=(d=u.email)==null?void 0:d.toLowerCase().includes(o);return g||m}return!0});console.log("Search query:",l),console.log("Organization members:",r),console.log("Available members after filter:",N);const w=N.filter(u=>u.role==="athlete"),p=N.filter(u=>u.role==="staff"),h=async(u,f,d)=>{if(f==="athlete"&&d&&d!==t.id){const o=r.find(m=>m.id===u),g=s.find(m=>m.id===d);if(!confirm(`${o==null?void 0:o.name}„ÅØÁèæÂú®„Äå${g==null?void 0:g.name}„Äç„Å´ÊâÄÂ±û„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆ„ÉÅ„Éº„É†„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü`))return}y(!0);try{await j(u,f)}finally{y(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[t.name," „Å´„É°„É≥„Éê„Éº„ÇíËøΩÂä†"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ÁµÑÁπîÂÜÖ„ÅÆ„É°„É≥„Éê„Éº„Åã„Çâ„ÉÅ„Éº„É†„Å´Ââ≤„ÇäÂΩì„Å¶„Çã„É°„É≥„Éê„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]}),e.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(Br,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:l,onChange:u=>i(u.target.value),placeholder:"ÂêçÂâç„Åæ„Åü„ÅØ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅßÊ§úÁ¥¢...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:N.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:l?"Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì":"„Åì„ÅÆ„ÉÅ„Éº„É†„Å´ËøΩÂä†„Åß„Åç„Çã„É°„É≥„Éê„Éº„Åå„ÅÑ„Åæ„Åõ„Çì"}):e.jsxs("div",{className:"space-y-6",children:[w.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(Tr,{className:"h-4 w-4"}),"ÈÅ∏Êâã (",w.length,")"]}),e.jsx("div",{className:"space-y-2",children:w.map(u=>{const f=u.team_id?s.find(d=>d.id===u.team_id):null;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:u.name}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:u.email}),f&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["ÁèæÂú®: ",f.name]})]}),e.jsx("button",{onClick:()=>h(u.id,"athlete",u.team_id||void 0),disabled:x,className:"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap",children:f?"ÁßªÂãï":"ËøΩÂä†"})]},u.id)})})]}),p.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"„Çπ„Çø„ÉÉ„Éï (",p.length,")"]}),e.jsx("div",{className:"space-y-2",children:p.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:u.name}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:u.email})]}),e.jsx("button",{onClick:()=>h(u.id,"staff"),disabled:x,className:"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap",children:"ËøΩÂä†"})]},u.id))})]})]})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end border-t dark:border-gray-700",children:e.jsx("button",{onClick:c,disabled:x,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Èñâ„Åò„Çã"})})]})})}const Ue=L,ut={async getSubscriptionPlans(){const{data:t,error:s}=await Ue.from("subscription_plans").select("*").eq("is_active",!0).order("sort_order");if(s)throw s;return t},async getSubscriptionPlanById(t){const{data:s,error:r}=await Ue.from("subscription_plans").select("*").eq("id",t).maybeSingle();if(r)throw r;return s},async createSubscriptionPlan(t){const{data:s,error:r}=await Ue.from("subscription_plans").insert(t).select().single();if(r)throw r;return s},async getOrganizationSubscription(t){const{data:s,error:r}=await Ue.from("organization_subscriptions").select(`
        *,
        plan:plan_id (*)
      `).eq("organization_id",t).maybeSingle();if(r)throw r;return s},async createOrganizationSubscription(t){const{data:s,error:r}=await Ue.from("organization_subscriptions").insert(t).select().single();if(r)throw r;return s},async updateOrganizationSubscription(t,s){const{data:r,error:n}=await Ue.from("organization_subscriptions").update(s).eq("organization_id",t).select().single();if(n)throw n;return r},async getUserSubscription(t){const{data:s,error:r}=await Ue.from("user_subscriptions").select(`
        *,
        plan:plan_id (*)
      `).eq("user_id",t).maybeSingle();if(r)throw r;return s},async getCurrentUsage(t){const s=new Date,r=new Date(s.getFullYear(),s.getMonth(),1),n=new Date(s.getFullYear(),s.getMonth()+1,0),{data:l,error:i}=await Ue.from("usage_tracking").select("*").eq("organization_id",t).gte("period_start",r.toISOString()).lte("period_end",n.toISOString()).maybeSingle();if(i)throw i;return l},async calculateCurrentUsage(t){const s=new Date,r=new Date(s);r.setDate(r.getDate()-30);const{data:n,error:l}=await L.from("users").select("id",{count:"exact",head:!1}).eq("role","athlete").eq("team_id",t).gte("created_at",r.toISOString());if(l)throw l;const{data:i,error:c}=await L.from("organization_members").select("id",{count:"exact",head:!1}).eq("organization_id",t);if(c)throw c;const{error:j}=await L.from("training_records").select("id",{count:"exact",head:!0}).gte("date",Pn(30));if(j)throw j;return{active_athletes:(n==null?void 0:n.length)||0,total_users:(i==null?void 0:i.length)||0,storage_used_mb:0,api_calls:0,data_exports:0}},async createUsageRecord(t){const{data:s,error:r}=await Ue.from("usage_tracking").insert(t).select().single();if(r)throw r;return s},async getBillingHistory(t,s){let r=Ue.from("billing_history").select("*").order("billing_date",{ascending:!1});t?r=r.eq("organization_id",t):s&&(r=r.eq("user_id",s));const{data:n,error:l}=await r;if(l)throw l;return n},async createBillingRecord(t){const{data:s,error:r}=await Ue.from("billing_history").insert(t).select().single();if(r)throw r;return s},async updateBillingRecord(t,s){const{data:r,error:n}=await Ue.from("billing_history").update(s).eq("id",t).select().single();if(n)throw n;return r},async getPermissionDefinitions(){const{data:t,error:s}=await Ue.from("permission_definitions").select("*").eq("is_active",!0).order("category",{ascending:!0}).order("name",{ascending:!0});if(s)throw s;return t},async getRolePermissions(t){const{data:s,error:r}=await Ue.from("role_permissions").select(`
        *,
        permission:permission_id (*)
      `).eq("role",t);if(r)throw r;return s},async getAllRolePermissions(){const{data:t,error:s}=await Ue.from("role_permissions").select(`
        *,
        permission:permission_id (*)
      `).order("role");if(s)throw s;return t},async checkPlanLimits(t){const s=await this.getOrganizationSubscription(t);if(!s||!s.plan)return{withinLimits:!1,message:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì",limits:{}};const r=s.plan,n=await this.calculateCurrentUsage(t),l=r.athlete_limit===null||n.active_athletes<=r.athlete_limit,i=n.storage_used_mb<=r.storage_gb*1024;return{withinLimits:l&&i,message:l&&i?"„Éó„É©„É≥Âà∂ÈôêÂÜÖ„Åß„Åô":"‰ΩøÁî®Èáè„Åå„Éó„É©„É≥Âà∂Èôê„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô",limits:{athletes:{current:n.active_athletes,limit:r.athlete_limit,exceeded:!l},storage:{current:n.storage_used_mb,limit:r.storage_gb*1024,exceeded:!i}},plan:r,usage:n}},async hasFeature(t,s){const r=await this.getOrganizationSubscription(t);if(!r||!r.plan)return!1;const n=r.plan;return!!(n.features&&n.features[s]===!0)},async upgradePlan(t,s,r){if(!await this.getOrganizationSubscription(t))throw new Error("ÁèæÂú®„ÅÆ„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");const l=new Date,i=new Date(l);r==="monthly"?i.setMonth(i.getMonth()+1):i.setFullYear(i.getFullYear()+1);const c={plan_id:s,billing_cycle:r,current_period_start:l.toISOString(),current_period_end:i.toISOString(),status:"active",updated_at:l.toISOString()};return await this.updateOrganizationSubscription(t,c)},async cancelSubscription(t,s=!1){const r=s?{status:"cancelled",updated_at:new Date().toISOString()}:{cancel_at_period_end:!0,updated_at:new Date().toISOString()};return await this.updateOrganizationSubscription(t,r)},async reactivateSubscription(t){const s={status:"active",cancel_at_period_end:!1,updated_at:new Date().toISOString()};return await this.updateOrganizationSubscription(t,s)}};function Yd(t){const[s,r]=a.useState(null),[n,l]=a.useState([]),[i,c]=a.useState(null),[j,x]=a.useState([]),[y,v]=a.useState(null),[N,w]=a.useState(!0),[p,h]=a.useState(null);a.useEffect(()=>{if(!t){w(!1);return}u()},[t]);const u=async()=>{if(t)try{w(!0),h(null);const[b,_,S,C,R]=await Promise.all([ut.getOrganizationSubscription(t),ut.getSubscriptionPlans(),ut.getCurrentUsage(t),ut.getBillingHistory(t),ut.checkPlanLimits(t)]);r(b),l(_),c(S),x(C),v(R)}catch(b){console.warn("Subscription feature not yet implemented:",b),h(null),r(null),l([]),c(null),x([]),v(null)}finally{w(!1)}};return{subscription:s,plans:n,usage:i,billingHistory:j,limits:y,loading:N,error:p,upgradePlan:async(b,_)=>{if(!t)throw new Error("Organization ID is required");try{const S=await ut.upgradePlan(t,b,_);return await u(),S}catch(S){const C=S instanceof Error?S.message:"„Éó„É©„É≥„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü";throw h(C),new Error(C)}},cancelSubscription:async(b=!1)=>{if(!t)throw new Error("Organization ID is required");try{const _=await ut.cancelSubscription(t,b);return await u(),_}catch(_){const S=_ instanceof Error?_.message:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÅÆ„Ç≠„É£„É≥„Çª„É´„Å´Â§±Êïó„Åó„Åæ„Åó„Åü";throw h(S),new Error(S)}},reactivateSubscription:async()=>{if(!t)throw new Error("Organization ID is required");try{const b=await ut.reactivateSubscription(t);return await u(),b}catch(b){const _=b instanceof Error?b.message:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÅÆÂÜçÈñã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü";throw h(_),new Error(_)}},hasFeature:async b=>{if(!t)return!1;try{return await ut.hasFeature(t,b)}catch(_){return console.error("Error checking feature:",_),!1}},refreshUsage:async()=>{if(t)try{const[b,_]=await Promise.all([ut.getCurrentUsage(t),ut.checkPlanLimits(t)]);c(b),v(_)}catch(b){console.error("Error refreshing usage:",b)}},reload:u}}function Gd({organizationId:t,organizationName:s}){var F,O,z,P,$,q,E,D,B,H,W;const{subscription:r,plans:n,billingHistory:l,limits:i,loading:c,error:j,upgradePlan:x,cancelSubscription:y,reactivateSubscription:v}=Yd(t),[N,w]=a.useState(null),[p,h]=a.useState("monthly"),[u,f]=a.useState(!1),[d,o]=a.useState(!1),[g,m]=a.useState(!1);if(c)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(j)return e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800 dark:text-red-200",children:j})});const b=r==null?void 0:r.plan,_=(r==null?void 0:r.status)==="trial",S=(r==null?void 0:r.status)==="cancelled",C=r==null?void 0:r.cancel_at_period_end,R=async()=>{if(N){m(!0);try{await x(N.id,p),f(!1),w(null)}catch(U){alert(U instanceof Error?U.message:"„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{m(!1)}}},A=async U=>{m(!0);try{await y(U),o(!1)}catch(Z){alert(Z instanceof Error?Z.message:"„Ç≠„É£„É≥„Çª„É´„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{m(!1)}},T=async()=>{m(!0);try{await v()}catch(U){alert(U instanceof Error?U.message:"ÂÜçÈñã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{m(!1)}},M=U=>new Date(U).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}),k=U=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(U);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(zr,{className:"h-6 w-6"}),"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥ÁÆ°ÁêÜ"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[s,"„ÅÆ„Éó„É©„É≥„Å®Ë´ãÊ±Ç"]})]}),i&&!i.withinLimits&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900 dark:text-yellow-200",children:"‰ΩøÁî®Èáè„Åå„Éó„É©„É≥Âà∂Èôê„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô"}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300 mt-1",children:"ÁèæÂú®„ÅÆ„Éó„É©„É≥„ÅÆÂà∂Èôê„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Çí„ÅîÊ§úË®é„Åè„Å†„Åï„ÅÑ„ÄÇ"}),((F=i.limits.athletes)==null?void 0:F.exceeded)&&e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-400 mt-1",children:["„Ç¢„Çπ„É™„Éº„ÉàÊï∞: ",i.limits.athletes.current," / ",i.limits.athletes.limit||"ÁÑ°Âà∂Èôê"]})]})]})}),C&&e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-orange-900 dark:text-orange-200",children:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„Åå„Ç≠„É£„É≥„Çª„É´‰∫àÂÆö„Åß„Åô"}),e.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-300 mt-1",children:[M(r.current_period_end),"„Å´„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÅåÁµÇ‰∫Ü„Åó„Åæ„Åô"]})]})]}),e.jsx("button",{onClick:T,disabled:g,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 whitespace-nowrap",children:"ÂÜçÈñã„Åô„Çã"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ÁèæÂú®„ÅÆ„Éó„É©„É≥"}),b?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.name}),_&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-xs font-semibold rounded-full",children:"„Éà„É©„Ç§„Ç¢„É´‰∏≠"}),S&&e.jsx("span",{className:"px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 text-xs font-semibold rounded-full",children:"„Ç≠„É£„É≥„Çª„É´Ê∏à„Åø"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:b.description})]}),e.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:k(r.billing_cycle==="yearly"?b.price_yearly:b.price_monthly)}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["/ ",r.billing_cycle==="yearly"?"Âπ¥":"Êúà"]})]}),r.billing_cycle==="yearly"&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["Âπ¥Èñì„Éó„É©„É≥„Åß ",k(b.price_monthly*12-b.price_yearly)," „ÅäÂæó"]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ë´ãÊ±Ç„Çµ„Ç§„ÇØ„É´"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.billing_cycle==="yearly"?"Âπ¥Ê¨°":"ÊúàÊ¨°"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ê¨°ÂõûË´ãÊ±ÇÊó•"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:M(r.current_period_end)})]}),_&&r.trial_end&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"„Éà„É©„Ç§„Ç¢„É´ÁµÇ‰∫Ü"}),e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:M(r.trial_end)})]})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsx("button",{onClick:()=>f(!0),disabled:S,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"„Éó„É©„É≥„ÇíÂ§âÊõ¥"}),!S&&!C&&e.jsx("button",{onClick:()=>o(!0),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„Çí„Ç≠„É£„É≥„Çª„É´"})]})]}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"‰ΩøÁî®Áä∂Ê≥Å"]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç¢„Çπ„É™„Éº„Éà"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[((O=i.usage)==null?void 0:O.active_athletes)||0," / ",(b==null?void 0:b.athlete_limit)||"ÁÑ°Âà∂Èôê"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${(P=(z=i.limits)==null?void 0:z.athletes)!=null&&P.exceeded?"bg-red-600":"bg-blue-600"}`,style:{width:b!=null&&b.athlete_limit?`${Math.min(((($=i.usage)==null?void 0:$.active_athletes)||0)/b.athlete_limit*100,100)}%`:"0%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"„Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Èáè"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[((((q=i.usage)==null?void 0:q.storage_used_mb)||0)/1024).toFixed(2)," GB / ",(b==null?void 0:b.storage_gb)||0," GB"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${(D=(E=i.limits)==null?void 0:E.storage)!=null&&D.exceeded?"bg-red-600":"bg-green-600"}`,style:{width:b!=null&&b.storage_gb?`${Math.min((((B=i.usage)==null?void 0:B.storage_used_mb)||0)/1024/b.storage_gb*100,100)}%`:"0%"}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:((H=i.usage)==null?void 0:H.total_users)||0}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Á∑è„É¶„Éº„Ç∂„ÉºÊï∞"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:((W=i.usage)==null?void 0:W.data_exports)||0}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Ë´ãÊ±ÇÂ±•Ê≠¥"]}),l.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"Êó•‰ªò"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"ÈáëÈ°ç"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"„Çπ„ÉÜ„Éº„Çø„Çπ"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"ÊîØÊâïÊñπÊ≥ï"})]})}),e.jsx("tbody",{children:l.slice(0,10).map(U=>e.jsxs("tr",{className:"border-b dark:border-gray-700 last:border-0",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 dark:text-white",children:M(U.billing_date)}),e.jsx("td",{className:"py-3 px-4 text-sm font-medium text-gray-900 dark:text-white",children:k(U.amount)}),e.jsx("td",{className:"py-3 px-4 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${U.status==="paid"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":U.status==="pending"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200"}`,children:U.status==="paid"?"ÊîØÊâïÊ∏à":U.status==="pending"?"‰øùÁïô‰∏≠":"Â§±Êïó"})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:U.payment_method||"-"})]},U.id))})]})}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-4",children:"Ë´ãÊ±ÇÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})]}),u&&e.jsx(Zd,{plans:n,currentPlan:b,selectedPlan:N,billingCycle:p,onSelectPlan:w,onSelectCycle:h,onConfirm:R,onClose:()=>{f(!1),w(null)},processing:g}),d&&e.jsx(Qd,{onCancel:A,onClose:()=>o(!1),processing:g})]})}function Zd({plans:t,currentPlan:s,selectedPlan:r,billingCycle:n,onSelectPlan:l,onSelectCycle:i,onConfirm:c,onClose:j,processing:x}){const y=N=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(N),v=(N,w)=>N.features&&N.features[w];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"„Éó„É©„É≥„ÇíÈÅ∏Êäû"}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(Me,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>i("monthly"),className:`px-6 py-2 rounded-lg font-medium transition-colors ${n==="monthly"?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"ÊúàÊ¨°"}),e.jsx("button",{onClick:()=>i("yearly"),className:`px-6 py-2 rounded-lg font-medium transition-colors ${n==="yearly"?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Âπ¥Ê¨°Ôºà„ÅäÂæóÔºâ"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:t.map(N=>{const w=(s==null?void 0:s.id)===N.id,p=(r==null?void 0:r.id)===N.id,h=n==="yearly"?N.price_yearly:N.price_monthly;return e.jsxs("div",{onClick:()=>l(N),className:`border-2 rounded-lg p-4 cursor-pointer transition-all ${p?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":w?"border-gray-400 dark:border-gray-600":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700"}`,children:[w&&e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-xs font-semibold rounded",children:"ÁèæÂú®„ÅÆ„Éó„É©„É≥"})}),e.jsx("h4",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:N.name}),e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:y(h)}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["/ ",n==="yearly"?"Âπ¥":"Êúà"]})]}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[N.athlete_limit?`${N.athlete_limit}‰∫∫`:"ÁÑ°Âà∂Èôê","„ÅÆ„Ç¢„Çπ„É™„Éº„Éà"]})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[N.storage_gb,"GB „Çπ„Éà„É¨„Éº„Ç∏"]})]}),v(N,"advanced_analytics")&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"È´òÂ∫¶„Å™ÂàÜÊûê"})]}),v(N,"priority_support")&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"ÂÑ™ÂÖà„Çµ„Éù„Éº„Éà"})]})]})]},N.id)})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:j,disabled:x,className:"px-6 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:c,disabled:!r||x,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Âá¶ÁêÜ‰∏≠...":"Â§âÊõ¥„ÇíÁ¢∫ÂÆö"})]})]})})})}function Qd({onCancel:t,onClose:s,processing:r}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„Çí„Ç≠„É£„É≥„Çª„É´"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„Çí„Ç≠„É£„É≥„Çª„É´„Åó„Åæ„Åô„ÅãÔºü"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>t(!1),disabled:r,className:"w-full px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 text-left",children:[e.jsx("div",{className:"font-semibold",children:"ÊúüÈñìÁµÇ‰∫ÜÊôÇ„Å´„Ç≠„É£„É≥„Çª„É´"}),e.jsx("div",{className:"text-sm opacity-90",children:"ÁèæÂú®„ÅÆË´ãÊ±ÇÊúüÈñì„ÅÆÁµÇ„Çè„Çä„Åæ„ÅßÂà©Áî®ÂèØËÉΩ„Åß„Åô"})]}),e.jsxs("button",{onClick:()=>t(!0),disabled:r,className:"w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 text-left",children:[e.jsx("div",{className:"font-semibold",children:"Âç≥Â∫ß„Å´„Ç≠„É£„É≥„Çª„É´"}),e.jsx("div",{className:"text-sm opacity-90",children:"„Åô„Åê„Å´„Ç¢„ÇØ„Çª„Çπ„Åå„Åß„Åç„Å™„Åè„Å™„Çä„Åæ„ÅôÔºàËøîÈáë„Å™„ÅóÔºâ"})]}),e.jsx("button",{onClick:s,disabled:r,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Èñâ„Åò„Çã"})]})]})})})}function Xd({organizationId:t}){const{organizations:s,updateOrganization:r}=ir(void 0),n=s.find(y=>y.id===t),[l,i]=a.useState("general"),[c,j]=a.useState(!1);if(!n)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"ÁµÑÁπî„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"})});const x=[{id:"general",name:"‰∏ÄËà¨Ë®≠ÂÆö",icon:dl},{id:"notifications",name:"ÈÄöÁü•",icon:Ms},{id:"security",name:"„Çª„Ç≠„É•„É™„ÉÜ„Ç£",icon:es},{id:"appearance",name:"Â§ñË¶≥",icon:bl}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Za,{className:"h-6 w-6"}),"ÁµÑÁπîË®≠ÂÆö"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[n.name,"„ÅÆË©≥Á¥∞Ë®≠ÂÆö"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:[e.jsx("div",{className:"border-b dark:border-gray-700",children:e.jsx("nav",{className:"flex px-6",children:x.map(y=>{const v=y.icon;return e.jsxs("button",{onClick:()=>i(y.id),className:`py-4 px-1 mr-8 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors ${l===y.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300"}`,children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:y.name})]},y.id)})})}),e.jsxs("div",{className:"p-6",children:[l==="general"&&e.jsx(ec,{organization:n,onUpdate:r,saving:c,setSaving:j}),l==="notifications"&&e.jsx(tc,{organization:n,onUpdate:r,saving:c,setSaving:j}),l==="security"&&e.jsx(sc,{organization:n,onUpdate:r,saving:c,setSaving:j}),l==="appearance"&&e.jsx(rc,{organization:n,onUpdate:r,saving:c,setSaving:j})]})]})]})}function ec({organization:t,onUpdate:s,saving:r,setSaving:n}){const[l,i]=a.useState(t.name),[c,j]=a.useState(t.description||""),x=t.settings||{},[y,v]=a.useState(x.timezone||"Asia/Tokyo"),[N,w]=a.useState(x.language||"ja"),p=async()=>{n(!0);try{await s(t.id,{name:l,description:c,settings:{...x,timezone:y,language:N}}),alert("Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü")}catch(h){alert(h instanceof Error?h.message:"Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{n(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÁµÑÁπîÂêç"}),e.jsx("input",{type:"text",value:l,onChange:h=>i(h.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Ë™¨Êòé"}),e.jsx("textarea",{value:c,onChange:h=>j(h.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„Çø„Ç§„É†„Çæ„Éº„É≥"}),e.jsxs("select",{value:y,onChange:h=>v(h.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"Asia/Tokyo",children:"Êó•Êú¨Ê®ôÊ∫ñÊôÇ (JST)"}),e.jsx("option",{value:"America/New_York",children:"Êù±ÈÉ®Ê®ôÊ∫ñÊôÇ (EST)"}),e.jsx("option",{value:"America/Los_Angeles",children:"Â§™Âπ≥Ê¥ãÊ®ôÊ∫ñÊôÇ (PST)"}),e.jsx("option",{value:"Europe/London",children:"„Ç∞„É™„Éã„ÉÉ„Ç∏Ê®ôÊ∫ñÊôÇ (GMT)"}),e.jsx("option",{value:"UTC",children:"ÂçîÂÆö‰∏ñÁïåÊôÇ (UTC)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Ë®ÄË™û"}),e.jsxs("select",{value:N,onChange:h=>w(h.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"ja",children:"Êó•Êú¨Ë™û"}),e.jsx("option",{value:"en",children:"English"})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:p,disabled:r,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:r?"‰øùÂ≠ò‰∏≠...":"Ë®≠ÂÆö„Çí‰øùÂ≠ò"})})]})}function tc({organization:t,onUpdate:s,saving:r,setSaving:n}){const l=t.settings||{},i=l.notifications||{},[c,j]=a.useState(i.emailAlerts!==!1),[x,y]=a.useState(i.highPriorityOnly||!1),[v,N]=a.useState(i.weeklyReport||!1),[w,p]=a.useState(i.usageLimitWarnings!==!1),h=async()=>{n(!0);try{await s(t.id,{settings:{...l,notifications:{emailAlerts:c,highPriorityOnly:x,weeklyReport:v,usageLimitWarnings:w}}}),alert("ÈÄöÁü•Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü")}catch(u){alert(u instanceof Error?u.message:"Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{n(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"„É°„Éº„É´„Ç¢„É©„Éº„Éà"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ACWR„Ç¢„É©„Éº„Éà„Çí„É°„Éº„É´„ÅßÂèó‰ø°"})]}),e.jsx("input",{type:"checkbox",checked:c,onChange:u=>j(u.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"È´òÂÑ™ÂÖàÂ∫¶„ÅÆ„Åø"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"È´òÂÑ™ÂÖàÂ∫¶„Ç¢„É©„Éº„Éà„ÅÆ„Åø„ÇíÈÄöÁü•"})]}),e.jsx("input",{type:"checkbox",checked:x,onChange:u=>y(u.target.checked),disabled:!c,className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"ÈÄ±Ê¨°„É¨„Éù„Éº„Éà"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ÊØéÈÄ±ÊúàÊõúÊó•„Å´„Çµ„Éû„É™„Éº„É¨„Éù„Éº„Éà„ÇíÂèó‰ø°"})]}),e.jsx("input",{type:"checkbox",checked:v,onChange:u=>N(u.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"‰ΩøÁî®ÈáèÂà∂ÈôêË≠¶Âëä"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"„Éó„É©„É≥Âà∂Èôê„Å´Ëøë„Å•„ÅÑ„ÅüÈöõ„Å´ÈÄöÁü•"})]}),e.jsx("input",{type:"checkbox",checked:w,onChange:u=>p(u.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:h,disabled:r,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:r?"‰øùÂ≠ò‰∏≠...":"Ë®≠ÂÆö„Çí‰øùÂ≠ò"})})]})}function sc({organization:t,onUpdate:s,saving:r,setSaving:n}){const l=t.settings||{},i=l.security||{},[c,j]=a.useState(i.dataRetentionDays||365),[x,y]=a.useState(i.requireMFA||!1),[v,N]=a.useState(i.allowExport!==!1),w=async()=>{n(!0);try{await s(t.id,{settings:{...l,security:{dataRetentionDays:c,requireMFA:x,allowExport:v}}}),alert("„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü")}catch(p){alert(p instanceof Error?p.message:"Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{n(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„Éá„Éº„Çø‰øùÊåÅÊúüÈñìÔºàÊó•Êï∞Ôºâ"}),e.jsx("input",{type:"number",value:c,onChange:p=>j(parseInt(p.target.value)),min:"30",max:"3650",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Âè§„ÅÑ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤„ÅØËá™ÂãïÁöÑ„Å´„Ç¢„Éº„Ç´„Ç§„Éñ„Åï„Çå„Åæ„Åô"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Â§öË¶ÅÁ¥†Ë™çË®º„ÇíË¶ÅÊ±Ç"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ÂÖ®„É°„É≥„Éê„Éº„Å´MFA„ÇíÂº∑Âà∂ÔºàÈñãÁô∫‰∏≠Ôºâ"})]}),e.jsx("input",{type:"checkbox",checked:x,onChange:p=>y(p.target.checked),disabled:!0,className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„ÉàË®±ÂèØ"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"„É°„É≥„Éê„Éº„Åå„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åß„Åç„Çã"})]}),e.jsx("input",{type:"checkbox",checked:v,onChange:p=>N(p.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:w,disabled:r,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:r?"‰øùÂ≠ò‰∏≠...":"Ë®≠ÂÆö„Çí‰øùÂ≠ò"})})]})}function rc({organization:t,onUpdate:s,saving:r,setSaving:n}){const l=t.settings||{},i=l.appearance||{},[c,j]=a.useState(i.primaryColor||"#3B82F6"),[x,y]=a.useState(i.acwrThresholdLow||.8),[v,N]=a.useState(i.acwrThresholdHigh||1.3),w=async()=>{n(!0);try{await s(t.id,{settings:{...l,appearance:{primaryColor:c,acwrThresholdLow:x,acwrThresholdHigh:v}}}),alert("Â§ñË¶≥Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü")}catch(p){alert(p instanceof Error?p.message:"Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{n(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„Éó„É©„Ç§„Éû„É™„Éº„Ç´„É©„Éº"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"color",value:c,onChange:p=>j(p.target.value),className:"h-10 w-20 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),e.jsx("input",{type:"text",value:c,onChange:p=>j(p.target.value),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ÁµÑÁπî„ÅÆ„Éñ„É©„É≥„Éâ„Ç´„É©„ÉºÔºàÈñãÁô∫‰∏≠Ôºâ"})]}),e.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"ACWRÈñæÂÄ§„Ç´„Çπ„Çø„Éû„Ç§„Ç∫"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"‰Ωé„É™„Çπ„ÇØÈñæÂÄ§Ôºà‰∏ãÈôêÔºâ"}),e.jsx("input",{type:"number",value:x,onChange:p=>y(parseFloat(p.target.value)),step:"0.1",min:"0.5",max:"1.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"„Åì„ÅÆÂÄ§Êú™Ê∫Ä„ÅØ‰Ωé„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑„Å®„Åó„Å¶Ë≠¶Âëä"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"È´ò„É™„Çπ„ÇØÈñæÂÄ§Ôºà‰∏äÈôêÔºâ"}),e.jsx("input",{type:"number",value:v,onChange:p=>N(parseFloat(p.target.value)),step:"0.1",min:"1.2",max:"2.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"„Åì„ÅÆÂÄ§„ÇíË∂Ö„Åà„Çã„Å®È´ò„É™„Çπ„ÇØ„Å®„Åó„Å¶Ë≠¶Âëä"})]})]})]}),e.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:w,disabled:r,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:r?"‰øùÂ≠ò‰∏≠...":"Ë®≠ÂÆö„Çí‰øùÂ≠ò"})})]})}const ac=t=>t==="global_admin",Pt={async getMyRequests(t){const{data:s,error:r}=await L.from("team_access_requests").select(`
        *,
        team:teams (
          id,
          name
        )
      `).eq("requester_id",t).order("created_at",{ascending:!1});if(r)throw r;return s},async getPendingRequestsForMyTeams(t){const{data:s,error:r}=await L.from("users").select("role").eq("id",t).maybeSingle();if(r)throw r;if(ac(s==null?void 0:s.role)){const{data:x,error:y}=await L.from("team_access_requests").select(`
          *,
          requester:users!team_access_requests_requester_id_fkey (
            id,
            name,
            email
          ),
          team:teams (
            id,
            name,
            organization_id
          )
        `).eq("status","pending").order("created_at",{ascending:!1});if(y)throw y;return x}const{data:n,error:l}=await L.from("staff_team_links").select("team_id").eq("staff_user_id",t);if(l)throw l;const i=(n==null?void 0:n.map(x=>x.team_id).filter(Boolean))||[];if(i.length===0)return[];const{data:c,error:j}=await L.from("team_access_requests").select(`
        *,
        requester:users!team_access_requests_requester_id_fkey (
          id,
          name,
          email
        ),
        team:teams (
          id,
          name
        )
      `).eq("status","pending").in("team_id",i).order("created_at",{ascending:!1});if(j)throw j;return c},async getRequestsForOrganization(t){const{data:s,error:r}=await L.from("team_access_requests").select(`
        *,
        requester:users!team_access_requests_requester_id_fkey (
          id,
          name,
          email
        ),
        team:teams (
          id,
          name
        ),
        reviewer:users!team_access_requests_reviewed_by_fkey (
          id,
          name
        )
      `).eq("organization_id",t).order("created_at",{ascending:!1});if(r)throw r;return s},async getAvailableTeamsToRequest(t,s){const{data:r,error:n}=await L.from("users").select("team_id").eq("id",t).maybeSingle();if(n)throw n;const{data:l,error:i}=await L.from("staff_team_links").select("team_id").eq("staff_user_id",t);if(i)throw i;const c=(l??[]).map(p=>p.team_id).filter(Boolean);r!=null&&r.team_id&&c.push(r.team_id);const{data:j,error:x}=await L.from("team_access_requests").select("team_id").eq("requester_id",t).eq("status","pending");if(x)throw x;const y=(j??[]).map(p=>p.team_id).filter(Boolean),v=Array.from(new Set([...c,...y])).filter(Boolean),{data:N,error:w}=await L.from("teams").select("id, name, organization_id").eq("organization_id",s).order("name");if(w)throw w;return v.length?(N??[]).filter(p=>!v.includes(p.id)):N??[]},async createRequest(t,s,r,n=""){const{data:l,error:i}=await L.from("team_access_requests").insert({requester_id:t,team_id:s,organization_id:r,status:"pending",request_message:n}).select().single();if(i)throw i;return l},async approveRequest(t,s,r=""){const{error:n}=await L.rpc("approve_team_access_request",{request_id:t,reviewer_user_id:s,notes:r});if(n)throw n},async rejectRequest(t,s,r=""){const{error:n}=await L.rpc("reject_team_access_request",{request_id:t,reviewer_user_id:s,notes:r});if(n)throw n},async cancelRequest(t){const{error:s}=await L.from("team_access_requests").delete().eq("id",t).eq("status","pending");if(s)throw s},async getRequestById(t){const{data:s,error:r}=await L.from("team_access_requests").select(`
        *,
        requester:users!team_access_requests_requester_id_fkey (
          id,
          name,
          email
        ),
        team:teams (
          id,
          name
        ),
        reviewer:users!team_access_requests_reviewed_by_fkey (
          id,
          name
        )
      `).eq("id",t).maybeSingle();if(r)throw r;return s}};function nc(t,s){const[r,n]=a.useState([]),[l,i]=a.useState([]),[c,j]=a.useState([]),[x,y]=a.useState([]),[v,N]=a.useState(!0),[w,p]=a.useState(null),h=a.useCallback(async()=>{try{const S=await Pt.getMyRequests(t);n(S)}catch(S){throw console.error("Error loading my requests:",S),S}},[t]),u=a.useCallback(async()=>{try{const S=await Pt.getPendingRequestsForMyTeams(t);i(S)}catch(S){throw console.error("Error loading pending requests:",S),S}},[t]),f=a.useCallback(async()=>{if(s)try{const S=await Pt.getRequestsForOrganization(s);j(S)}catch(S){throw console.error("Error loading organization requests:",S),S}},[s]),d=a.useCallback(async()=>{if(s)try{const S=await Pt.getAvailableTeamsToRequest(t,s);y(S)}catch(S){throw console.error("Error loading available teams:",S),S}},[t,s]),o=a.useCallback(async()=>{N(!0),p(null);try{const S=await Promise.allSettled([h(),u(),s?f():Promise.resolve(),s?d():Promise.resolve()]);S.forEach((R,A)=>{R.status==="rejected"&&console.error(`Failed to load ${["myRequests","pendingRequests","organizationRequests","availableTeams"][A]}:`,R.reason)}),S.filter((R,A)=>A<2&&R.status==="rejected").length===2&&p("Failed to load team access requests")}catch(S){p(S instanceof Error?S.message:"Failed to load team access requests")}finally{N(!1)}},[h,u,f,d,s]);a.useEffect(()=>{o()},[o]);const g=a.useCallback(async(S,C="")=>{if(!s)throw new Error("Organization ID is required");try{await Pt.createRequest(t,S,s,C),await o()}catch(R){throw new Error(R instanceof Error?R.message:"Failed to create request")}},[t,s,o]),m=a.useCallback(async(S,C="")=>{try{await Pt.approveRequest(S,t,C),await o()}catch(R){throw new Error(R instanceof Error?R.message:"Failed to approve request")}},[t,o]),b=a.useCallback(async(S,C="")=>{try{await Pt.rejectRequest(S,t,C),await o()}catch(R){throw new Error(R instanceof Error?R.message:"Failed to reject request")}},[t,o]),_=a.useCallback(async S=>{try{await Pt.cancelRequest(S),await o()}catch(C){throw new Error(C instanceof Error?C.message:"Failed to cancel request")}},[o]);return{myRequests:r,pendingRequests:l,organizationRequests:c,availableTeams:x,loading:v,error:w,createRequest:g,approveRequest:m,rejectRequest:b,cancelRequest:_,refresh:o}}function lc({userId:t,organizationId:s,isAdmin:r=!1}){var z,P;const{myRequests:n,pendingRequests:l,organizationRequests:i,availableTeams:c,loading:j,error:x,createRequest:y,approveRequest:v,rejectRequest:N,cancelRequest:w}=nc(t,s),[p,h]=a.useState(!1),[u,f]=a.useState(""),[d,o]=a.useState(""),[g,m]=a.useState(""),[b,_]=a.useState(null),[S,C]=a.useState(!1),[R,A]=a.useState("my"),T=async()=>{if(u){C(!0);try{await y(u,d),h(!1),f(""),o("")}catch($){alert($ instanceof Error?$.message:"„É™„ÇØ„Ç®„Çπ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{C(!1)}}},M=async $=>{C(!0);try{await v($.id,g),_(null),m("")}catch(q){alert(q instanceof Error?q.message:"ÊâøË™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{C(!1)}},k=async $=>{C(!0);try{await N($.id,g),_(null),m("")}catch(q){alert(q instanceof Error?q.message:"Âç¥‰∏ã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{C(!1)}},F=async $=>{if(confirm("„Åì„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Çí„Ç≠„É£„É≥„Çª„É´„Åó„Åæ„Åô„ÅãÔºü")){C(!0);try{await w($)}catch(q){alert(q instanceof Error?q.message:"„Ç≠„É£„É≥„Çª„É´„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{C(!1)}}};console.log("TeamAccessRequestManagement render:",{userId:t,organizationId:s,availableTeamsCount:c.length,loading:j,error:x});const O=$=>{switch($){case"pending":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:[e.jsx(gt,{className:"h-3 w-3"}),"ÊâøË™çÂæÖ„Å°"]});case"approved":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:[e.jsx(qt,{className:"h-3 w-3"}),"ÊâøË™çÊ∏à„Åø"]});case"rejected":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:[e.jsx(Me,{className:"h-3 w-3"}),"Âç¥‰∏ã"]});default:return null}};return j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x?e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:x})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx($e,{className:"h-6 w-6"}),"„ÉÅ„Éº„É†„Ç¢„ÇØ„Çª„ÇπÁÆ°ÁêÜ"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"‰ªñ„ÅÆ„ÉÅ„Éº„É†„Å∏„ÅÆ„Ç¢„ÇØ„Çª„ÇπÊ®©„Çí„É™„ÇØ„Ç®„Çπ„Éà„ÉªÁÆ°ÁêÜ"})]}),c.length>0&&e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(It,{className:"h-4 w-4"}),"Êñ∞Ë¶è„É™„ÇØ„Ç®„Çπ„Éà"]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>A("my"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${R==="my"?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["Ëá™ÂàÜ„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà (",n.length,")"]}),e.jsxs("button",{onClick:()=>A("pending"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${R==="pending"?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["ÊâøË™çÂæÖ„Å° (",l.length,")"]}),r&&e.jsxs("button",{onClick:()=>A("all"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${R==="all"?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["„Åô„Åπ„Å¶ (",i.length,")"]})]})}),R==="my"&&e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"„É™„ÇØ„Ç®„Çπ„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}):n.map($=>{var q;return e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:(q=$.team)==null?void 0:q.name}),O($.status)]}),$.request_message&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:$.request_message}),$.review_notes&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"„É¨„Éì„É•„Éº„É°„É¢:"})," ",$.review_notes]})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date($.created_at).toLocaleString("ja-JP")})]}),$.status==="pending"&&e.jsx("button",{onClick:()=>F($.id),disabled:S,className:"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50",children:"„Ç≠„É£„É≥„Çª„É´"})]})},$.id)})}),R==="pending"&&e.jsx("div",{className:"space-y-4",children:l.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ÊâøË™çÂæÖ„Å°„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}):l.map($=>{var q,E;return e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:(q=$.requester)==null?void 0:q.name}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["„Åå ",(E=$.team)==null?void 0:E.name," „Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„Çí„É™„ÇØ„Ç®„Çπ„Éà"]})]}),$.request_message&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:$.request_message}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date($.created_at).toLocaleString("ja-JP")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_($),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"ÊâøË™ç"}),e.jsx("button",{onClick:()=>{_($),m("")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Âç¥‰∏ã"})]})]})},$.id)})}),R==="all"&&r&&e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"„É™„ÇØ„Ç®„Çπ„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}):i.map($=>{var q,E;return e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:(q=$.requester)==null?void 0:q.name}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["‚Üí ",(E=$.team)==null?void 0:E.name]}),O($.status)]}),$.request_message&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:$.request_message}),$.review_notes&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"„É¨„Éì„É•„Éº:"})," ",$.review_notes,$.reviewer&&` by ${$.reviewer.name}`]})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date($.created_at).toLocaleString("ja-JP")})]})})},$.id)})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"„ÉÅ„Éº„É†„Ç¢„ÇØ„Çª„Çπ„Çí„É™„ÇØ„Ç®„Çπ„Éà"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû"}),e.jsxs("select",{value:u,onChange:$=>f($.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),c.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„ÉÉ„Çª„Éº„Ç∏Ôºà‰ªªÊÑèÔºâ"}),e.jsx("textarea",{value:d,onChange:$=>o($.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"„É™„ÇØ„Ç®„Çπ„Éà„ÅÆÁêÜÁî±„ÇÑË©≥Á¥∞„ÇíÂÖ•Âäõ..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>h(!1),disabled:S,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:T,disabled:S||!u,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:S?"ÈÄÅ‰ø°‰∏≠...":"„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°"})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"„É™„ÇØ„Ç®„Çπ„Éà„ÅÆ„É¨„Éì„É•„Éº"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"„É™„ÇØ„Ç®„Çπ„ÉàËÄÖ:"})," ",(z=b.requester)==null?void 0:z.name]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"„ÉÅ„Éº„É†:"})," ",(P=b.team)==null?void 0:P.name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),e.jsx("textarea",{value:g,onChange:$=>m($.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"„É¨„Éì„É•„Éº„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{_(null),m("")},disabled:S,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:()=>k(b),disabled:S,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:"Âç¥‰∏ã"}),e.jsx("button",{onClick:()=>M(b),disabled:S,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:"ÊâøË™ç"})]})]})})]})}const vt={async getMyTransferRequests(t){const{data:s,error:r}=await L.from("athlete_transfer_requests").select(`
        *,
        athlete:users!athlete_transfer_requests_athlete_id_fkey (
          id,
          name,
          email
        ),
        from_team:teams!athlete_transfer_requests_from_team_id_fkey (
          id,
          name
        ),
        to_team:teams!athlete_transfer_requests_to_team_id_fkey (
          id,
          name
        )
      `).or(`athlete_id.eq.${t},requested_by.eq.${t}`).order("created_at",{ascending:!1});if(r)throw r;return s},async getPendingRequestsForMyTeams(t){const{data:s,error:r}=await L.from("staff_team_links").select("team_id").eq("staff_user_id",t);if(r)throw r;const n=(s==null?void 0:s.map(c=>c.team_id))||[];if(n.length===0)return[];const{data:l,error:i}=await L.from("athlete_transfer_requests").select(`
        *,
        athlete:users!athlete_transfer_requests_athlete_id_fkey (
          id,
          name,
          email
        ),
        from_team:teams!athlete_transfer_requests_from_team_id_fkey (
          id,
          name
        ),
        to_team:teams!athlete_transfer_requests_to_team_id_fkey (
          id,
          name
        ),
        requester:users!athlete_transfer_requests_requested_by_fkey (
          id,
          name
        )
      `).eq("status","pending").in("from_team_id",n).order("created_at",{ascending:!1});if(i)throw i;return l},async getRequestsForOrganization(t){const{data:s,error:r}=await L.from("athlete_transfer_requests").select(`
        *,
        athlete:users!athlete_transfer_requests_athlete_id_fkey (
          id,
          name,
          email
        ),
        from_team:teams!athlete_transfer_requests_from_team_id_fkey (
          id,
          name
        ),
        to_team:teams!athlete_transfer_requests_to_team_id_fkey (
          id,
          name
        ),
        requester:users!athlete_transfer_requests_requested_by_fkey (
          id,
          name
        ),
        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (
          id,
          name
        )
      `).eq("organization_id",t).order("created_at",{ascending:!1});if(r)throw r;return s},async getAthletesInMyTeams(t){const{data:s,error:r}=await L.from("staff_team_links").select("team_id").eq("staff_user_id",t);if(r)throw r;const n=(s==null?void 0:s.map(c=>c.team_id))||[];if(n.length===0)return[];const{data:l,error:i}=await L.from("users").select(`
        id,
        name,
        email,
        team_id,
        team:teams (
          id,
          name
        )
      `).eq("role","athlete").in("team_id",n).order("name");if(i)throw i;return l},async getAvailableDestinationTeams(t,s){const{data:r,error:n}=await L.from("teams").select("id, name, organization_id").eq("organization_id",t).neq("id",s).order("name");if(n)throw n;return r},async createTransferRequest(t,s,r,n,l,i=""){const{data:c,error:j}=await L.from("athlete_transfer_requests").insert({athlete_id:t,from_team_id:s,to_team_id:r,organization_id:n,requested_by:l,status:"pending",request_reason:i}).select().single();if(j)throw j;return c},async approveTransfer(t,s,r=""){const{error:n}=await L.rpc("approve_athlete_transfer",{request_id:t,reviewer_user_id:s,notes:r});if(n)throw n},async rejectTransfer(t,s,r=""){const{error:n}=await L.rpc("reject_athlete_transfer",{request_id:t,reviewer_user_id:s,notes:r});if(n)throw n},async cancelTransferRequest(t){const{error:s}=await L.from("athlete_transfer_requests").delete().eq("id",t).eq("status","pending");if(s)throw s},async getTransferHistory(t){const{data:s,error:r}=await L.from("team_transfer_history").select(`
        *,
        athlete:users!team_transfer_history_athlete_id_fkey (
          id,
          name
        ),
        from_team:teams!team_transfer_history_from_team_id_fkey (
          id,
          name
        ),
        to_team:teams!team_transfer_history_to_team_id_fkey (
          id,
          name
        ),
        transferred_by_user:users!team_transfer_history_transferred_by_fkey (
          id,
          name
        )
      `).eq("athlete_id",t).order("transfer_date",{ascending:!1});if(r)throw r;return s},async getTeamTransferHistory(t){const{data:s,error:r}=await L.from("team_transfer_history").select(`
        *,
        athlete:users!team_transfer_history_athlete_id_fkey (
          id,
          name
        ),
        from_team:teams!team_transfer_history_from_team_id_fkey (
          id,
          name
        ),
        to_team:teams!team_transfer_history_to_team_id_fkey (
          id,
          name
        ),
        transferred_by_user:users!team_transfer_history_transferred_by_fkey (
          id,
          name
        )
      `).or(`from_team_id.eq.${t},to_team_id.eq.${t}`).order("transfer_date",{ascending:!1});if(r)throw r;return s},async getRequestById(t){const{data:s,error:r}=await L.from("athlete_transfer_requests").select(`
        *,
        athlete:users!athlete_transfer_requests_athlete_id_fkey (
          id,
          name,
          email
        ),
        from_team:teams!athlete_transfer_requests_from_team_id_fkey (
          id,
          name
        ),
        to_team:teams!athlete_transfer_requests_to_team_id_fkey (
          id,
          name
        ),
        requester:users!athlete_transfer_requests_requested_by_fkey (
          id,
          name
        ),
        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (
          id,
          name
        )
      `).eq("id",t).maybeSingle();if(r)throw r;return s}};function ic(t,s){const[r,n]=a.useState([]),[l,i]=a.useState([]),[c,j]=a.useState([]),[x,y]=a.useState([]),[v,N]=a.useState(!0),[w,p]=a.useState(null),h=a.useCallback(async()=>{try{const R=await vt.getMyTransferRequests(t);n(R)}catch(R){throw console.error("Error loading my transfer requests:",R),R}},[t]),u=a.useCallback(async()=>{try{const R=await vt.getPendingRequestsForMyTeams(t);i(R)}catch(R){throw console.error("Error loading pending transfer requests:",R),R}},[t]),f=a.useCallback(async()=>{if(s)try{const R=await vt.getRequestsForOrganization(s);j(R)}catch(R){throw console.error("Error loading organization transfer requests:",R),R}},[s]),d=a.useCallback(async()=>{try{const R=await vt.getAthletesInMyTeams(t);y(R)}catch(R){throw console.error("Error loading my athletes:",R),R}},[t]),o=a.useCallback(async()=>{N(!0),p(null);try{await Promise.all([h(),u(),d(),s?f():Promise.resolve()])}catch(R){p(R instanceof Error?R.message:"Failed to load transfer requests")}finally{N(!1)}},[h,u,d,f,s]);a.useEffect(()=>{o()},[o]);const g=a.useCallback(async(R,A,T,M="")=>{if(!s)throw new Error("Organization ID is required");try{await vt.createTransferRequest(R,A,T,s,t,M),await o()}catch(k){throw new Error(k instanceof Error?k.message:"Failed to create transfer request")}},[t,s,o]),m=a.useCallback(async(R,A="")=>{try{await vt.approveTransfer(R,t,A),await o()}catch(T){throw new Error(T instanceof Error?T.message:"Failed to approve transfer")}},[t,o]),b=a.useCallback(async(R,A="")=>{try{await vt.rejectTransfer(R,t,A),await o()}catch(T){throw new Error(T instanceof Error?T.message:"Failed to reject transfer")}},[t,o]),_=a.useCallback(async R=>{try{await vt.cancelTransferRequest(R),await o()}catch(A){throw new Error(A instanceof Error?A.message:"Failed to cancel transfer request")}},[o]),S=a.useCallback(async R=>{try{return await vt.getTransferHistory(R)}catch(A){throw new Error(A instanceof Error?A.message:"Failed to get transfer history")}},[]),C=a.useCallback(async R=>{if(!s)throw new Error("Organization ID is required");try{return await vt.getAvailableDestinationTeams(s,R)}catch(A){throw new Error(A instanceof Error?A.message:"Failed to get available teams")}},[s]);return{myRequests:r,pendingRequests:l,organizationRequests:c,myAthletes:x,loading:v,error:w,createTransferRequest:g,approveTransfer:m,rejectTransfer:b,cancelTransferRequest:_,getTransferHistory:S,getAvailableDestinationTeams:C,refresh:o}}function oc({userId:t,organizationId:s,isAdmin:r=!1}){var ee,ae,V,te,se;const{myRequests:n,pendingRequests:l,organizationRequests:i,myAthletes:c,loading:j,error:x,createTransferRequest:y,approveTransfer:v,rejectTransfer:N,cancelTransferRequest:w,getTransferHistory:p,getAvailableDestinationTeams:h}=ic(t,s),[u,f]=a.useState(!1),[d,o]=a.useState(null),[g,m]=a.useState(""),[b,_]=a.useState(""),[S,C]=a.useState(""),[R,A]=a.useState(null),[T,M]=a.useState(!1),[k,F]=a.useState("my"),[O,z]=a.useState([]),[P,$]=a.useState(!1),[q,E]=a.useState([]),D=async I=>{o(I);try{const J=await h(I.team_id);z(J),f(!0)}catch(J){alert(J instanceof Error?J.message:"Âà©Áî®ÂèØËÉΩ„Å™„ÉÅ„Éº„É†„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},B=async()=>{if(!(!d||!g)){M(!0);try{await y(d.id,d.team_id,g,b),f(!1),o(null),m(""),_(""),z([])}catch(I){alert(I instanceof Error?I.message:"ÁßªÁ±ç„É™„ÇØ„Ç®„Çπ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{M(!1)}}},H=async I=>{var J;if(confirm(`${(J=I.athlete)==null?void 0:J.name}„ÅÆÁßªÁ±ç„ÇíÊâøË™ç„Åó„Åæ„Åô„ÅãÔºü`)){M(!0);try{await v(I.id,S),A(null),C("")}catch(G){alert(G instanceof Error?G.message:"ÊâøË™ç„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{M(!1)}}},W=async I=>{M(!0);try{await N(I.id,S),A(null),C("")}catch(J){alert(J instanceof Error?J.message:"Âç¥‰∏ã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{M(!1)}},U=async I=>{if(confirm("„Åì„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Çí„Ç≠„É£„É≥„Çª„É´„Åó„Åæ„Åô„ÅãÔºü")){M(!0);try{await w(I)}catch(J){alert(J instanceof Error?J.message:"„Ç≠„É£„É≥„Çª„É´„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{M(!1)}}},Z=async I=>{try{const J=await p(I);E(J),$(!0)}catch(J){alert(J instanceof Error?J.message:"Â±•Ê≠¥„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},Y=I=>{switch(I){case"pending":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:[e.jsx(gt,{className:"h-3 w-3"}),"ÊâøË™çÂæÖ„Å°"]});case"approved":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:[e.jsx(qt,{className:"h-3 w-3"}),"ÊâøË™çÊ∏à„Åø"]});case"completed":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:[e.jsx(qt,{className:"h-3 w-3"}),"ÂÆå‰∫Ü"]});case"rejected":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:[e.jsx(Me,{className:"h-3 w-3"}),"Âç¥‰∏ã"]});default:return null}};return j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x?e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:x})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Er,{className:"h-6 w-6"}),"ÈÅ∏ÊâãÁßªÁ±çÁÆ°ÁêÜ"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"ÈÅ∏Êâã„ÅÆ„ÉÅ„Éº„É†ÈñìÁßªÁ±ç„Çí„É™„ÇØ„Ç®„Çπ„Éà„ÉªÁÆ°ÁêÜ"})]})}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>F("my"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${k==="my"?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["Ëá™ÂàÜ„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà (",n.length,")"]}),e.jsxs("button",{onClick:()=>F("pending"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${k==="pending"?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["ÊâøË™çÂæÖ„Å° (",l.length,")"]}),r&&e.jsxs("button",{onClick:()=>F("all"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${k==="all"?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["„Åô„Åπ„Å¶ (",i.length,")"]})]})}),k==="my"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ÊãÖÂΩìÈÅ∏Êâã"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(I=>{var J;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:I.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:(J=I.team)==null?void 0:J.name}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>D(I),className:"flex-1 px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"ÁßªÁ±çÁî≥Ë´ã"}),e.jsx("button",{onClick:()=>Z(I.id),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsx(xl,{className:"h-4 w-4"})})]})]},I.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ÁßªÁ±ç„É™„ÇØ„Ç®„Çπ„ÉàÂ±•Ê≠¥"}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"„É™„ÇØ„Ç®„Çπ„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}):n.map(I=>{var J,G,ne;return e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:(J=I.athlete)==null?void 0:J.name}),Y(I.status)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:(G=I.from_team)==null?void 0:G.name}),e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{children:(ne=I.to_team)==null?void 0:ne.name})]}),I.request_reason&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ÁêÜÁî±: ",I.request_reason]}),I.review_notes&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"„É¨„Éì„É•„Éº:"})," ",I.review_notes]})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(I.created_at).toLocaleString("ja-JP")})]}),I.status==="pending"&&e.jsx("button",{onClick:()=>U(I.id),disabled:T,className:"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50",children:"„Ç≠„É£„É≥„Çª„É´"})]})},I.id)})})]})]}),k==="pending"&&e.jsx("div",{className:"space-y-4",children:l.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ÊâøË™çÂæÖ„Å°„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}):l.map(I=>{var J,G,ne,oe;return e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:(J=I.athlete)==null?void 0:J.name}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"„ÅÆÁßªÁ±ç„É™„ÇØ„Ç®„Çπ„Éà"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsx("span",{children:(G=I.from_team)==null?void 0:G.name}),e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{children:(ne=I.to_team)==null?void 0:ne.name})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["„É™„ÇØ„Ç®„Çπ„ÉàËÄÖ: ",(oe=I.requester)==null?void 0:oe.name]}),I.request_reason&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ÁêÜÁî±: ",I.request_reason]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(I.created_at).toLocaleString("ja-JP")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(I),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"ÊâøË™ç"}),e.jsx("button",{onClick:()=>{A(I),C("")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Âç¥‰∏ã"})]})]})},I.id)})}),k==="all"&&r&&e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"„É™„ÇØ„Ç®„Çπ„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}):i.map(I=>{var J,G,ne,oe;return e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:(J=I.athlete)==null?void 0:J.name}),Y(I.status)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsx("span",{children:(G=I.from_team)==null?void 0:G.name}),e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{children:(ne=I.to_team)==null?void 0:ne.name})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["„É™„ÇØ„Ç®„Çπ„ÉàËÄÖ: ",(oe=I.requester)==null?void 0:oe.name]}),I.request_reason&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ÁêÜÁî±: ",I.request_reason]}),I.review_notes&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"„É¨„Éì„É•„Éº:"})," ",I.review_notes,I.reviewer&&` by ${I.reviewer.name}`]})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(I.created_at).toLocaleString("ja-JP")})]})})},I.id)})}),u&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ÁßªÁ±ç„É™„ÇØ„Ç®„Çπ„Éà„Çí‰ΩúÊàê"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÈÅ∏Êâã"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ÁèæÂú®„ÅÆ„ÉÅ„Éº„É†: ",(ee=d.team)==null?void 0:ee.name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÁßªÁ±çÂÖà„ÉÅ„Éº„É†"}),e.jsxs("select",{value:g,onChange:I=>m(I.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),O.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ÁßªÁ±çÁêÜÁî±"}),e.jsx("textarea",{value:b,onChange:I=>_(I.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ÁßªÁ±ç„ÅÆÁêÜÁî±„ÇíÂÖ•Âäõ..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{f(!1),o(null),m(""),_(""),z([])},disabled:T,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:B,disabled:T||!g,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:T?"ÈÄÅ‰ø°‰∏≠...":"„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°"})]})]})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ÁßªÁ±ç„É™„ÇØ„Ç®„Çπ„Éà„ÅÆ„É¨„Éì„É•„Éº"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"ÈÅ∏Êâã:"})," ",(ae=R.athlete)==null?void 0:ae.name]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:(V=R.from_team)==null?void 0:V.name}),e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{children:(te=R.to_team)==null?void 0:te.name})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[e.jsx("span",{className:"font-medium",children:"„É™„ÇØ„Ç®„Çπ„ÉàËÄÖ:"})," ",(se=R.requester)==null?void 0:se.name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É¨„Éì„É•„Éº„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),e.jsx("textarea",{value:S,onChange:I=>C(I.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"„É¨„Éì„É•„Éº„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{A(null),C("")},disabled:T,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{onClick:()=>W(R),disabled:T,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:"Âç¥‰∏ã"}),e.jsx("button",{onClick:()=>H(R),disabled:T,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:"ÊâøË™ç"})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ÁßªÁ±çÂ±•Ê≠¥"}),e.jsx("button",{onClick:()=>$(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:e.jsx(Me,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:q.length===0?e.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"ÁßªÁ±çÂ±•Ê≠¥„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}):q.map(I=>{var J;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-1",children:[I.from_team?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:I.from_team.name}),e.jsx(cs,{className:"h-4 w-4"})]}):e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Êñ∞Ë¶èÁôªÈå≤"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:I.to_team.name})]}),I.transfer_reason&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:I.transfer_reason}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[new Date(I.transfer_date).toLocaleString("ja-JP")," by"," ",(J=I.transferred_by_user)==null?void 0:J.name]})]},I.id)})})]})})]})}function xn(t){return t.trim().toLowerCase()}function dc({organizationId:t,organizationName:s}){const[r,n]=a.useState([]),[l,i]=a.useState([]),[c,j]=a.useState([]),[x,y]=a.useState(!0),[v,N]=a.useState(!1),[w,p]=a.useState(!1),[h,u]=a.useState(null),[f,d]=a.useState(""),[o,g]=a.useState({}),[m,b]=a.useState({});a.useEffect(()=>{_(),S(),C()},[t]);const _=async()=>{try{y(!0);const $=await He.getOrganizationMembers(t);n($||[])}catch($){console.error("Error loading members:",$),alert("„É°„É≥„Éê„Éº„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{y(!1)}},S=async()=>{try{const{data:$,error:q}=await L.from("users").select("*").order("name");if(q)throw q;i($||[])}catch($){console.error("Error loading users:",$)}},C=async()=>{try{const $=await He.getOrganizationTeams(t);j($||[])}catch($){console.error("Error loading organization teams:",$)}},R=async($,q)=>{try{const{error:E}=await L.rpc("assign_user_to_team",{p_user_id:$,p_team_id:q,p_organization_id:t,p_assignment_type:"primary"});if(E)throw E;await _(),p(!1),u(null),alert("„ÉÅ„Éº„É†„Å∏„ÅÆÂâ≤„ÇäÂΩì„Å¶„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü")}catch(E){console.error("Error assigning to team:",E),alert("„ÉÅ„Éº„É†„Å∏„ÅÆÂâ≤„ÇäÂΩì„Å¶„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(E instanceof Error?E.message:"‰∏çÊòé„Å™„Ç®„É©„Éº"))}},A=async($,q)=>{try{await He.addOrganizationMember({user_id:$,organization_id:t,role:q}),await _(),N(!1),alert("„É°„É≥„Éê„Éº„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü")}catch(E){console.error("Error adding member:",E),alert("„É°„É≥„Éê„Éº„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+(E instanceof Error?E.message:"‰∏çÊòé„Å™„Ç®„É©„Éº"))}},T=async($,q)=>{try{await He.updateOrganizationMemberRole($,q),await _(),alert("Ê®©Èôê„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü")}catch(E){console.error("Error updating role:",E),alert("Ê®©Èôê„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},M=async $=>{if(confirm("„Åì„ÅÆ„É°„É≥„Éê„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü"))try{await He.removeOrganizationMember($),await _(),alert("„É°„É≥„Éê„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü")}catch(q){console.error("Error removing member:",q),alert("„É°„É≥„Éê„Éº„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},k=async $=>{const q=xn($);if(q&&o[q]!=="sending"){g(E=>({...E,[q]:"sending"})),b(E=>({...E,[q]:""}));try{const{data:E,error:D}=await L.functions.invoke("request-password-reset",{body:{email:q,redirectUrl:`${window.location.origin}/reset-password`}});if(D){console.error("[OrganizationMembersManagement] request-password-reset error:",D),g(B=>({...B,[q]:"error"})),b(B=>({...B,[q]:"ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ"}));return}console.log("[OrganizationMembersManagement] request-password-reset result:",E),g(B=>({...B,[q]:"success"})),b(B=>({...B,[q]:"ÂÜçË®≠ÂÆö„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„ÅüÔºàËø∑ÊÉë„É°„Éº„É´„ÇÇÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ„ÄÇ"})),window.setTimeout(()=>{g(B=>({...B,[q]:"idle"})),b(B=>({...B,[q]:""}))},5e3)}catch(E){console.error("[OrganizationMembersManagement] exception:",E),g(D=>({...D,[q]:"error"})),b(D=>({...D,[q]:(E==null?void 0:E.message)||"ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ"}))}}},F=$=>{switch($){case"organization_admin":return e.jsx(es,{className:"h-4 w-4 text-blue-600"});case"member":return e.jsx($e,{className:"h-4 w-4 text-gray-600"});default:return e.jsx($e,{className:"h-4 w-4 text-gray-600"})}},O=$=>{switch($){case"organization_admin":return"ÁµÑÁπîÁÆ°ÁêÜËÄÖ";case"member":return"‰∏ÄËà¨„É°„É≥„Éê„Éº";default:return $}},z=$=>{switch($){case"organization_admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"member":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200";default:return"bg-gray-100 text-gray-800"}},P=a.useMemo(()=>r.filter($=>{var D,B;if(!f)return!0;const q=$.users;if(!q)return!1;const E=f.toLowerCase();return((D=q.name)==null?void 0:D.toLowerCase().includes(E))||((B=q.email)==null?void 0:B.toLowerCase().includes(E))}),[r,f]);return x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx($e,{className:"h-6 w-6"}),"ÁµÑÁπî„É°„É≥„Éê„ÉºÁÆ°ÁêÜ"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[s,"„ÅÆ„É°„É≥„Éê„Éº„Å®Ê®©Èôê„ÇíÁÆ°ÁêÜ"]})]}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(It,{className:"h-4 w-4"}),"„É°„É≥„Éê„Éº„ÇíËøΩÂä†"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Br,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:f,onChange:$=>d($.target.value),placeholder:"ÂêçÂâç„Åæ„Åü„ÅØ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅßÊ§úÁ¥¢...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:[e.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["„É°„É≥„Éê„Éº‰∏ÄË¶ß (",P.length,")"]})})}),e.jsx("div",{className:"divide-y dark:divide-gray-700",children:P.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:f?"Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì":"„É°„É≥„Éê„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):P.map($=>e.jsx(cc,{member:$,onUpdateRole:T,onRemove:M,onAssignTeam:q=>{u(q),p(!0)},onResendPasswordLink:k,sendStateByEmail:o,sendMsgByEmail:m,getRoleIcon:F,getRoleLabel:O,getRoleBadgeColor:z},$.id))})]}),v&&e.jsx(xc,{organizationId:t,existingMembers:r,availableUsers:l,onClose:()=>N(!1),onAdd:A,getRoleIcon:F,getRoleLabel:O}),w&&h&&e.jsx(mc,{member:h,teams:c,onClose:()=>{p(!1),u(null)},onAssign:R})]})}function cc({member:t,onUpdateRole:s,onRemove:r,onAssignTeam:n,onResendPasswordLink:l,sendStateByEmail:i,sendMsgByEmail:c,getRoleIcon:j,getRoleLabel:x,getRoleBadgeColor:y}){var u,f,d,o;const v=t.users;if(!v)return null;const N=xn(v.email||""),w=i[N]||"idle",p=c[N]||"",h=w==="sending";return e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-200 font-semibold",children:((f=(u=v.name)==null?void 0:u[0])==null?void 0:f.toUpperCase())||((o=(d=v.email)==null?void 0:d[0])==null?void 0:o.toUpperCase())||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:v.name||"Unknown User"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${y(t.role)}`,children:[j(t.role),x(t.role)]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:v.email}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["ËøΩÂä†Êó•: ",new Date(t.created_at).toLocaleDateString("ja-JP")]}),p&&e.jsxs("div",{className:`mt-2 text-xs rounded-md px-2 py-1 inline-flex items-start gap-1 border ${w==="success"?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200":w==="error"?"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200":"bg-gray-50 border-gray-200 text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200"}`,children:[w==="success"?e.jsx(Ne,{className:"h-3.5 w-3.5 mt-0.5"}):w==="error"?e.jsx(ge,{className:"h-3.5 w-3.5 mt-0.5"}):null,e.jsx("span",{children:p})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>n(t),className:"px-3 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1",title:"„ÉÅ„Éº„É†„Å´Ââ≤„ÇäÂΩì„Å¶",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"„ÉÅ„Éº„É†Ââ≤ÂΩì"})]}),e.jsx("button",{onClick:()=>l(v.email),disabled:!v.email||h,className:`px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors
                       disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1`,title:"„Éë„Çπ„ÉØ„Éº„ÉâÂÜçË®≠ÂÆö„É™„É≥„ÇØ„ÇíÂÜçÈÄÅ",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{className:"hidden sm:inline",children:"ÈÄÅ‰ø°‰∏≠"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"ÂÜçÈÄÅ"})]})}),e.jsxs("select",{value:t.role,onChange:g=>s(t.id,g.target.value),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"organization_admin",children:"ÁµÑÁπîÁÆ°ÁêÜËÄÖ"}),e.jsx("option",{value:"member",children:"‰∏ÄËà¨„É°„É≥„Éê„Éº"})]}),e.jsx("button",{onClick:()=>r(t.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"ÂâäÈô§",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})})}function xc({organizationId:t,existingMembers:s,availableUsers:r,onClose:n,onAdd:l,getRoleIcon:i,getRoleLabel:c}){const[j,x]=a.useState(""),[y,v]=a.useState("organization_admin"),[N,w]=a.useState(!1),[p,h]=a.useState(""),u=new Set(s.map(m=>m.user_id)),d=r.filter(m=>!u.has(m.id)).filter(m=>{var _,S;if(!p)return!0;const b=p.toLowerCase();return((_=m.name)==null?void 0:_.toLowerCase().includes(b))||((S=m.email)==null?void 0:S.toLowerCase().includes(b))}),o=async m=>{if(m.preventDefault(),!j){alert("„É¶„Éº„Ç∂„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ");return}w(!0);try{await l(j,y)}finally{w(!1)}},g=[{value:"organization_admin",label:"ÁµÑÁπîÁÆ°ÁêÜËÄÖ",description:"ÁµÑÁπîÂÜÖ„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„Å®Ë®≠ÂÆö„ÇíÁÆ°ÁêÜ„Åß„Åç„Åæ„ÅôÔºàÁõ£Áù£„ÄÅGM„ÄÅÁµ±Êã¨„Ç≥„Éº„ÉÅ„Å™„Å©Ôºâ"},{value:"member",label:"‰∏ÄËà¨„É°„É≥„Éê„Éº",description:"ÈÄöÂ∏∏„ÅÆ„Ç≥„Éº„ÉÅ/ÈÅ∏Êâã„Å®„Åó„Å¶Ê¥ªÂãï„Åó„Åæ„ÅôÔºàÁÆ°ÁêÜÊ®©Èôê„Å™„ÅóÔºâ"}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:o,children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"„É°„É≥„Éê„Éº„ÇíËøΩÂä†"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ÁµÑÁπî„Å´„É°„É≥„Éê„Éº„ÇíËøΩÂä†„Åó„Å¶Ê®©Èôê„ÇíË®≠ÂÆö„Åó„Åæ„Åô"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["„É¶„Éº„Ç∂„Éº„ÇíÊ§úÁ¥¢ ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",value:p,onChange:m=>h(m.target.value),placeholder:"ÂêçÂâç„Åæ„Åü„ÅØ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅßÊ§úÁ¥¢...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-3"}),e.jsx("div",{className:"border dark:border-gray-600 rounded-lg max-h-60 overflow-y-auto",children:d.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:p?"Ë©≤ÂΩì„Åô„Çã„É¶„Éº„Ç∂„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì":"ËøΩÂä†ÂèØËÉΩ„Å™„É¶„Éº„Ç∂„Éº„Åå„ÅÑ„Åæ„Åõ„Çì"}):e.jsx("div",{className:"divide-y dark:divide-gray-700",children:d.map(m=>e.jsxs("label",{className:`flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${j===m.id?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("input",{type:"radio",name:"user",value:m.id,checked:j===m.id,onChange:b=>x(b.target.value),className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:m.name||"Unknown User"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:m.email}),m.role&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["ÁèæÂú®„ÅÆ„Ç∑„Çπ„ÉÜ„É†„É≠„Éº„É´: ",m.role]})]})]},m.id))})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:["Ê®©Èôê„ÇíÈÅ∏Êäû ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"space-y-3",children:g.map(m=>e.jsxs("label",{className:`flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-colors ${y===m.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("input",{type:"radio",name:"role",value:m.value,checked:y===m.value,onChange:b=>v(b.target.value),className:"mt-1 h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i(m.value),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:m.label})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:m.description})]})]},m.value))})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:N,children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:N||!j,children:N?"ËøΩÂä†‰∏≠...":"„É°„É≥„Éê„Éº„ÇíËøΩÂä†"})]})]})})})}function mc({member:t,teams:s,onClose:r,onAssign:n}){const[l,i]=a.useState(""),[c,j]=a.useState(!1),x=t.users;if(!x)return null;const y=async v=>{if(v.preventDefault(),!l){alert("„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ");return}j(!0);try{await n(x.id,l)}finally{j(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"„ÉÅ„Éº„É†„Å´Ââ≤„ÇäÂΩì„Å¶"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[x.name,"„Åï„Çì„Çí„ÉÅ„Éº„É†„Å´Ââ≤„ÇäÂΩì„Å¶„Åæ„Åô"]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:l,onChange:v=>i(v.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû..."}),s.map(v=>e.jsx("option",{value:v.id,children:v.name},v.id))]}),s.length===0&&e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-2",children:"„Åì„ÅÆÁµÑÁπî„Å´„ÅØ„Åæ„Å†„ÉÅ„Éº„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂÖà„Å´„ÉÅ„Éº„É†„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Ê≥®ÊÑè:"})," „Åì„ÅÆ„É¶„Éº„Ç∂„Éº„ÅØÈÅ∏Êäû„Åó„Åü„ÉÅ„Éº„É†„Å´‰∏ªË¶Å„É°„É≥„Éê„Éº„Å®„Åó„Å¶Ââ≤„ÇäÂΩì„Å¶„Çâ„Çå„Åæ„Åô„ÄÇ"]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:c,children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center gap-2",disabled:c||!l||s.length===0,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Ââ≤„ÇäÂΩì„Å¶‰∏≠..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{children:"„ÉÅ„Éº„É†„Å´Ââ≤„ÇäÂΩì„Å¶"})]})})]})]})})})}const Nr=2e3;function uc(t){const s=[];let r=[],n="",l=!1;for(let i=0;i<t.length;i++){const c=t[i],j=t[i+1];if(c==='"'){l&&j==='"'?(n+='"',i++):l=!l;continue}if(!l&&(c===","||c==="	")){r.push(n),n="";continue}if(!l&&(c===`
`||c==="\r")){c==="\r"&&j===`
`&&i++,r.push(n),n="",s.push(r),r=[];continue}n+=c}for(r.push(n),s.push(r);s.length&&s[s.length-1].every(i=>(i??"").trim()==="");)s.pop();return s}function gc(t){return(t??"").trim().replace(/^\uFEFF/,"").replace(/\u3000/g," ").replace(/\s+/g," ").replace(/^\s*\d+\s*[\.\)\-:]\s*/g,"").toLowerCase().replace(/\s+/g," ").replace(/[^a-z0-9\u3040-\u30ff\u4e00-\u9faf %/_-]/g,"")}function hc(t){return(t??"").toString().replace(/\D/g,"")}function kr(t){const s=(t??"").toString().trim();if(!s)return null;const r=Number(s.replace(/,/g,""));return Number.isFinite(r)?r:null}function bc(t){const s=(t??"").toString().trim();if(!s)return null;const r=s.match(/(\d{4})[\/\.-](\d{1,2})[\/\.-](\d{1,2})/);if(r){const l=r[1],i=String(Number(r[2])).padStart(2,"0"),c=String(Number(r[3])).padStart(2,"0");return`${l}-${i}-${c}`}const n=new Date(s);if(!Number.isNaN(n.getTime())){const l=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0");return`${l}-${i}-${c}`}return null}function fc(t){if(!t.length)return{rows:[],headers:[]};const s=t[0].map(n=>(n??"").trim()),r=t.slice(1).map(n=>{const l={};for(let i=0;i<s.length;i++)l[s[i]]=(n[i]??"").toString();return l});return{headers:s,rows:r}}function Ns(t,s){const n=t.map(l=>({raw:l,norm:gc(l)})).find(l=>s.includes(l.norm));return(n==null?void 0:n.raw)??null}function pc(){const[t,s]=a.useState(""),[r,n]=a.useState(""),[l,i]=a.useState(!1),[c,j]=a.useState(!1),[x,y]=a.useState([]),[v,N]=a.useState([]),[w,p]=a.useState(""),h=x.length,u=v.length,f=a.useMemo(()=>h>0&&!c,[h,c]),d=async g=>{s(g.name),p(""),y([]),N([]),i(!0);try{const m=await g.text();n(m);const b=uc(m),{headers:_,rows:S}=fc(b);if(!_.length){p("CSV„ÅÆ„Éò„ÉÉ„ÉÄ„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ");return}const C=Ns(_,["mobile number","mobile","phone","phone number","phone_number","tel","telephone","Êê∫Â∏Ø","Êê∫Â∏ØÁï™Âè∑","ÈõªË©±","ÈõªË©±Áï™Âè∑"]),R=Ns(_,["test date / time","test date/time","test date time","test date","measured_at","date","Ê∏¨ÂÆöÊó•","Ê∏¨ÂÆöÊó•ÊôÇ","inbodyÊ∏¨ÂÆöÊó•","inbody Ê∏¨ÂÆöÊó•"]),A=Ns(_,["height","height_cm","Ë∫´Èï∑"]),T=Ns(_,["weight","‰ΩìÈáç"]),M=Ns(_,["pbf (percent body fat)","pbf","percent body fat","percent_body_fat","body fat percent","body_fat_percent","‰ΩìËÑÇËÇ™Áéá"]),k=[C?null:"Mobile Number(ÈõªË©±Áï™Âè∑)",R?null:"Test Date / Time(Ê∏¨ÂÆöÊó•)",A?null:"Height(Ë∫´Èï∑)",T?null:"Weight(‰ΩìÈáç)",M?null:"PBF(‰ΩìËÑÇËÇ™Áéá)"].filter(Boolean);if(k.length){p(`CSV„Éò„ÉÉ„ÉÄ„Éº„Å´ÂøÖÈ†à„Ç´„É©„É†„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô: ${k.join(", ")}`);return}if(S.length>Nr){p(`Ë°åÊï∞„ÅåÂ§ö„Åô„Åé„Åæ„ÅôÔºà‰∏äÈôê ${Nr} Ë°åÔºâ„ÄÇCSV„ÇíÂàÜÂâ≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);return}const F=[],O=[];S.forEach((z,P)=>{const $=P+1,q=hc(z[C]),E=bc(z[R]),D=kr(z[A]),B=kr(z[T]),H=kr(z[M]);if(!q){O.push({rowIndex:$,message:"ÈõªË©±Áï™Âè∑„ÅåÁ©∫ or ‰∏çÊ≠£„Åß„ÅôÔºàÊï∞Â≠ó„ÅÆ„ÅøÊäΩÂá∫„Åß„Åç„Åæ„Åõ„ÇìÔºâ",raw:z});return}if(!E){O.push({rowIndex:$,message:"Ê∏¨ÂÆöÊó•(Test Date / Time)„ÅåËß£Èáà„Åß„Åç„Åæ„Åõ„ÇìÔºà‰æã: 2025-12-21Ôºâ",raw:z});return}if(D==null||D<=0||D>250){O.push({rowIndex:$,message:"Ë∫´Èï∑„Åå‰∏çÊ≠£„Åß„ÅôÔºà0„Äú250cm„ÅÆÁØÑÂõ≤„ÅßÔºâ",raw:z});return}if(B==null||B<=0||B>300){O.push({rowIndex:$,message:"‰ΩìÈáç„Åå‰∏çÊ≠£„Åß„ÅôÔºà0„Äú300kg„ÅÆÁØÑÂõ≤„ÅßÔºâ",raw:z});return}if(H==null||H<0||H>80){O.push({rowIndex:$,message:"‰ΩìËÑÇËÇ™Áéá(PBF)„Åå‰∏çÊ≠£„Åß„ÅôÔºà0„Äú80%„ÅÆÁØÑÂõ≤„ÅßÔºâ",raw:z});return}F.push({rowIndex:$,phone_number:q,measured_at:E,height:D,weight:B,body_fat_percent:H,raw:z})}),y(F),N(O),p(`Ëß£ÊûêÂÆå‰∫ÜÔºöÊúâÂäπ ${F.length} Ë°å / „Ç®„É©„Éº ${O.length} Ë°å`)}catch(m){console.error(m),p(`CSV„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${String((m==null?void 0:m.message)??m)}`)}finally{i(!1)}},o=async()=>{if(f){j(!0),p("");try{const{data:g,error:m}=await L.functions.invoke("import-inbody-csv",{body:{csv:r,source:"csv",note:null}});if(m)throw m;const b=(g==null?void 0:g.inserted_or_updated)??0,_=(g==null?void 0:g.rejected)??0;p(`‚úÖ Âèñ„ÇäËæº„ÅøÊàêÂäüÔºö${b} Ë°å„Çí upsertÔºàrejected: ${_}Ôºâ`)}catch(g){console.error(g),p(`‚ùå Âèñ„ÇäËæº„ÅøÂ§±Êïó: ${String((g==null?void 0:g.message)??g)}`)}finally{j(!1)}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Et,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"InBody CSV ‰∏ÄÊã¨Âèñ„ÇäËæº„Åø"})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-1",children:"ÂøÖÈ†à„Ç´„É©„É†"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Mobile NumberÔºàÈõªË©±Áï™Âè∑Ôºâ‚Äª„Äå1. Mobile Number„Äç„Åß„ÇÇOK"}),e.jsx("li",{children:"Test Date / TimeÔºà‚ÄªÊôÇÂàªËæº„ÅøOK / „Éó„É¨„Éì„É•„Éº„ÅØÊó•‰ªò„Å†„ÅëË°®Á§∫Ôºâ"}),e.jsx("li",{children:"HeightÔºàË∫´Èï∑Ôºâ"}),e.jsx("li",{children:"WeightÔºà‰ΩìÈáçÔºâ"}),e.jsx("li",{children:"PBFÔºàPercent Body Fat / ‰ΩìËÑÇËÇ™ÁéáÔºâ"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"‚ÄªÁï™Âè∑‰ªò„Åç„Éò„ÉÉ„ÉÄÔºà‰æã: 1. Mobile NumberÔºâ„ÇÇËá™Âãï„ÅßÂê∏Âèé„Åó„Åæ„Åô„ÄÇ"})]}),e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-blue-400 transition-colors cursor-pointer bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Xa,{className:"w-7 h-7 mx-auto text-gray-500 mb-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"CSV„Éï„Ç°„Ç§„É´„ÇíÈÅ∏ÊäûÔºà„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åß„ÇÇOKÔºâ"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["‰∏äÈôê ",Nr," Ë°å"]}),t&&e.jsxs("div",{className:"text-xs text-gray-700 mt-2",children:["ÈÅ∏Êäû‰∏≠: ",t]})]})}),e.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:g=>{var b;const m=(b=g.target.files)==null?void 0:b[0];m&&d(m)}})]}),w&&e.jsxs("div",{className:"mt-4 flex items-start gap-2 text-sm",children:[w.startsWith("‚úÖ")?e.jsx(Xt,{className:"w-5 h-5 text-green-600 mt-0.5"}):w.startsWith("‚ùå")?e.jsx(ge,{className:"w-5 h-5 text-red-600 mt-0.5"}):e.jsx(ge,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsx("div",{className:"text-gray-700 whitespace-pre-wrap",children:w})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:o,disabled:!f,className:`px-4 py-2 rounded-lg text-white text-sm font-medium transition-colors ${f?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 cursor-not-allowed"}`,children:c?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4 animate-spin"}),"Âèñ„ÇäËæº„Åø‰∏≠..."]}):"DB„Å∏‰∏ÄÊã¨Âèñ„ÇäËæº„ÅøÔºàEdgeÔºâ"}),l&&e.jsxs("span",{className:"text-sm text-gray-600 inline-flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4 animate-spin"}),"Ëß£Êûê‰∏≠..."]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ÊúâÂäπ ",e.jsx("span",{className:"font-semibold text-gray-900",children:h})," Ë°å / „Ç®„É©„Éº"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:u})," Ë°å"]})]})]}),v.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ge,{className:"w-5 h-5 text-red-600"}),e.jsx("h4",{className:"text-md font-semibold text-gray-900",children:"„Ç®„É©„ÉºË°åÔºàÂèñ„ÇäËæº„ÅøÂØæË±°Â§ñÔºâ"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"py-2 pr-3",children:"Ë°å"}),e.jsx("th",{className:"py-2 pr-3",children:"ÁêÜÁî±"}),e.jsx("th",{className:"py-2 pr-3",children:"„Éá„Éº„ÇøÔºàÊäúÁ≤ãÔºâ"})]})}),e.jsx("tbody",{children:v.slice(0,50).map(g=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-3 font-mono",children:g.rowIndex}),e.jsx("td",{className:"py-2 pr-3 text-red-700",children:g.message}),e.jsxs("td",{className:"py-2 pr-3 text-gray-600",children:[JSON.stringify(g.raw).slice(0,140),JSON.stringify(g.raw).length>140?"...":""]})]},`${g.rowIndex}-${g.message}`))})]})}),v.length>50&&e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"‚ÄªË°®Á§∫„ÅØÊúÄÂàù„ÅÆ50Ë°å„ÅÆ„Åø"})]}),x.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"„Éó„É¨„Éì„É•„ÉºÔºàÂÖàÈ†≠10Ë°åÔºâ"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"py-2 pr-3",children:"Ë°å"}),e.jsx("th",{className:"py-2 pr-3",children:"ÈõªË©±"}),e.jsx("th",{className:"py-2 pr-3",children:"Ê∏¨ÂÆöÊó•"}),e.jsx("th",{className:"py-2 pr-3",children:"Ë∫´Èï∑"}),e.jsx("th",{className:"py-2 pr-3",children:"‰ΩìÈáç"}),e.jsx("th",{className:"py-2 pr-3",children:"‰ΩìËÑÇËÇ™Áéá"})]})}),e.jsx("tbody",{children:x.slice(0,10).map(g=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-3 font-mono",children:g.rowIndex}),e.jsx("td",{className:"py-2 pr-3 font-mono",children:g.phone_number}),e.jsx("td",{className:"py-2 pr-3 font-mono",children:g.measured_at}),e.jsx("td",{className:"py-2 pr-3",children:g.height}),e.jsx("td",{className:"py-2 pr-3",children:g.weight}),e.jsx("td",{className:"py-2 pr-3",children:g.body_fat_percent})]},g.rowIndex))})]})}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"‚ÄªÂÆüÈöõ„ÅÆ‰øùÂ≠ò„ÅØ Edge ÂÅ¥„ÅåÊó•ÊôÇÔºàmeasured_at_tsÔºâ„ÇÇÊâ±„ÅÑ„Åæ„Åô"})]})]})}function yc({user:t,alerts:s,onNavigateToPrivacy:r,onNavigateToTerms:n,onNavigateToCommercial:l,onNavigateToHelp:i}){if(!t||!Gs(t.role))return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"bg-white border rounded-xl p-6",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Ê®©Èôê„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"„Åì„ÅÆ„Éö„Éº„Ç∏„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„Åø„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åô„ÄÇ"})]})});const[c,j]=a.useState([]),[x,y]=a.useState("system"),[v,N]=a.useState("overview"),[w,p]=a.useState("invite"),[h,u]=a.useState(""),[f,d]=a.useState("overview"),[o,g]=a.useState([]),[m,b]=a.useState(!1),[_,S]=a.useState("single"),[C,R]=a.useState(),[A,T]=a.useState(!0),[M,k]=a.useState(!1),[F,O]=a.useState(!1),[z,P]=a.useState(!1),{isActive:$,shouldShowTutorial:q,startTutorial:E,completeTutorial:D,skipTutorial:B,currentStepIndex:H,setCurrentStepIndex:W}=Pr(),{organizations:U,loading:Z}=ir(t.id);a.useEffect(()=>{q()&&!A&&E()},[q,E,A]),a.useEffect(()=>{const G=localStorage.getItem("admin_selected_organization");G&&U.some(ne=>ne.id===G)?R(G):U.length>0&&!C&&(R(U[0].id),localStorage.setItem("admin_selected_organization",U[0].id))},[U]);const Y=G=>{R(G),localStorage.setItem("admin_selected_organization",G)},ee=U.find(G=>G.id===C),ae=s.filter(G=>G.priority==="high"),V=s.filter(G=>G.type==="no_data"||G.type==="reminder");a.useEffect(()=>{const G=localStorage.getItem("criticalAlertDismissed"),ne=G?parseInt(G,10):0,oe=Date.now(),de=30*60*1e3;ne&&oe-ne<de?O(!0):ne&&oe-ne>=de&&localStorage.removeItem("criticalAlertDismissed")},[]);const te=()=>{O(!0),localStorage.setItem("criticalAlertDismissed",Date.now().toString())},se=async()=>{try{b(!0);const{data:G,error:ne}=await L.from("inbody_records").select("user_id").not("user_id","is",null);if(ne)throw ne;const oe=Array.from(new Set((G??[]).map(je=>je.user_id))).filter(Boolean),{data:de,error:ue}=await L.from("app_users").select("id, nickname, email").in("id",oe);if(ue){console.warn("fetchInbodyUsers: failed to fetch app_users info:",ue),g(oe.map(je=>({user_id:je})));return}const ye=(de??[]).map(je=>({user_id:je.id,name:je.nickname||je.email||je.id}))??[];g(ye)}catch(G){console.error("fetchInbodyUsers error:",G)}finally{b(!1)}};a.useEffect(()=>{I()},[]),a.useEffect(()=>{x==="system"&&v==="nutrition-dev"&&se()},[x,v]);const I=async()=>{try{const{data:G,error:ne}=await L.from("teams").select("*").order("name");if(ne)throw ne;j(G||[])}catch(G){console.error("Error fetching teams:",G)}finally{T(!1)}},J=async()=>{var G;try{if(!h){alert("user_id „ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ");return}const{data:ne}=await L.auth.getSession(),oe=(G=ne.session)==null?void 0:G.access_token;if(!oe){alert("„Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„ÇìÔºàÊú™„É≠„Ç∞„Ç§„É≥ÔºüÔºâ");return}const de=await fetch("https://cymnqmbdwaveccoooics.supabase.co/functions/v1/calculate-metabolism",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${oe}`},body:JSON.stringify({user_id:h,activity_level:"medium"})}),ue=await de.json();if(console.log("üß™ calculate-metabolism result:",ue),!de.ok){alert(`Â§±Êïó: ${de.status}
`+JSON.stringify(ue,null,2));return}alert(JSON.stringify(ue,null,2))}catch(ne){console.error(ne),alert("„Ç®„É©„ÉºÁô∫ÁîüÔºàconsole„ÇíÁ¢∫Ë™çÔºâ")}};return A?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[ae.length>0&&e.jsxs("button",{onClick:()=>k(!0),className:"p-2 text-gray-600 hover:text-red-600 transition-colors relative",title:"„Ç¢„É©„Éº„Éà",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),e.jsx("button",{onClick:E,className:"p-2 text-gray-600 hover:text-purple-600 transition-colors",title:"„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´",children:e.jsx(Ds,{className:"w-5 h-5"})})]})]}),!Z&&U.length>1&&e.jsx("div",{className:"pb-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3 pt-3",children:[e.jsx(Nt,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("select",{value:C||"",onChange:G=>Y(G.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:U.map(G=>e.jsx("option",{value:G.id,children:G.name},G.id))})]})})]})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[ae.length>0&&!F&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-6 h-6 text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"È´ò„É™„Çπ„ÇØ„Ç¢„É©„Éº„Éà"}),e.jsxs("p",{className:"text-sm text-red-700",children:[ae.length,"‰ª∂„ÅÆÊ≥®ÊÑè„ÅåÂøÖË¶Å„Åß„Åô"]})]}),e.jsx("button",{onClick:te,className:"ml-3 p-1 text-red-400 hover:text-red-600 transition-colors flex-shrink-0",title:"30ÂàÜÈñìÈùûË°®Á§∫",children:e.jsx(Me,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Js,{className:"w-6 h-6 text-blue-600 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"„Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:s.length}),e.jsx("div",{className:"text-sm text-blue-700",children:"Á∑è„Ç¢„É©„Éº„ÉàÊï∞"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 mb-1",children:ae.length}),e.jsx("div",{className:"text-sm text-red-700",children:"È´òÂÑ™ÂÖàÂ∫¶"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 mb-1",children:V.length}),e.jsx("div",{className:"text-sm text-yellow-700",children:"„Ç∑„Çπ„ÉÜ„É†ÈÄöÁü•"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-1",children:c.length}),e.jsx("div",{className:"text-sm text-green-700",children:"ÁôªÈå≤„ÉÅ„Éº„É†Êï∞"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm mb-8",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>y("system"),className:`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${x==="system"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,"data-tutorial":"system-tab",children:[e.jsx(Js,{className:"w-4 h-4"}),e.jsx("span",{children:"„Ç∑„Çπ„ÉÜ„É†"})]}),e.jsxs("button",{onClick:()=>y("users"),className:`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${x==="users"?"border-green-500 text-green-600 bg-green-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,"data-tutorial":"users-tab",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{children:"„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ"})]}),e.jsxs("button",{onClick:()=>y("organization"),className:`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${x==="organization"?"border-orange-500 text-orange-600 bg-orange-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,"data-tutorial":"organization-tab",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{children:"ÁµÑÁπîÁÆ°ÁêÜ"})]})]})}),(x==="system"||x==="users"||x==="organization")&&e.jsx("div",{className:"border-b border-gray-100 bg-gray-50",children:e.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:[x==="system"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>N("overview"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${v==="overview"?"border-blue-500 text-blue-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Js,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Ê¶ÇË¶Å"})]}),e.jsxs("button",{onClick:()=>N("nutrition-dev"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${v==="nutrition-dev"?"border-blue-500 text-blue-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(hl,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Ê†ÑÈ§äDev"})]})]}),x==="users"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>p("invite"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${w==="invite"?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(As,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ÊãõÂæÖ"})]}),e.jsxs("button",{onClick:()=>p("manage"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${w==="manage"?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Er,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ÁÆ°ÁêÜ"})]}),e.jsxs("button",{onClick:()=>p("inbody"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${w==="inbody"?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Et,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"InBody(CSV)"})]})]}),x==="organization"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>d("overview"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${f==="overview"?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(fl,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Ê¶ÇË¶Å"})]}),e.jsxs("button",{onClick:()=>d("list"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${f==="list"?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Nt,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ÁµÑÁπî‰∏ÄË¶ß"})]}),e.jsxs("button",{onClick:()=>d("members"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${f==="members"?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(kl,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"„É°„É≥„Éê„Éº"})]}),e.jsxs("button",{onClick:()=>d("settings"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${f==="settings"?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(_l,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Ë®≠ÂÆö"})]}),e.jsxs("button",{onClick:()=>d("subscription"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${f==="subscription"?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(zr,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥"})]}),e.jsxs("button",{onClick:()=>d("transfers"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${f==="transfers"?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Er,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ÈÅ∏ÊâãÁßªÁ±ç"})]}),e.jsxs("button",{onClick:()=>d("team-access"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${f==="team-access"?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Sl,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"„ÉÅ„Éº„É†„Ç¢„ÇØ„Çª„Çπ"})]})]})]})}),e.jsx("div",{className:"p-6",children:x==="system"?e.jsx("div",{className:"space-y-6",children:v==="overview"?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"„Ç∑„Çπ„ÉÜ„É†Áõ£Ë¶ñ"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("p",{className:"text-gray-600 text-center",children:"„É™„Ç¢„É´„Çø„Ç§„É†„Åß„Ç∑„Çπ„ÉÜ„É†ÂÖ®‰Ωì„ÅÆACWR„Éá„Éº„Çø„ÇíÁõ£Ë¶ñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ „Ç¢„É©„Éº„Éà„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´ÈÄöÁü•„Åï„Çå„Åæ„Åô„ÄÇ"})})]}):v==="nutrition-dev"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Ê†ÑÈ§ä„Çµ„Éù„Éº„ÉàÔºàDevÔºâ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ÈùûÂÖ¨Èñã„ÅÆÈñãÁô∫Áî®ÁîªÈù¢„Åß„ÅôÔºà‰∏ÄËà¨„É¶„Éº„Ç∂„Éº„Å´„ÅØË¶ã„Åõ„Å™„ÅÑÊÉ≥ÂÆöÔºâ„ÄÇ"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(zd,{}),e.jsx(Ld,{})]}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"„ÉÜ„Çπ„ÉàÂØæË±° user_id"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ê∏¨ÂÆö„Éá„Éº„ÇøÔºàinbody_recordsÔºâ„ÅåÂÖ•„Å£„Å¶„ÅÑ„ÇãÈÅ∏Êâã„ÅÆ user_id „ÇíË≤º„Å£„Å¶„Åè„Å†„Åï„ÅÑ"})]}),o.length>0&&e.jsxs("select",{value:h,onChange:G=>u(G.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"ÔºàInBody„ÅÇ„Çä„É¶„Éº„Ç∂„Éº„ÇíÈÅ∏ÊäûÔºâ"}),o.map(G=>e.jsxs("option",{value:G.user_id,children:[G.name," ‚Äî ",G.user_id.slice(0,8),"‚Ä¶"]},G.user_id))]}),e.jsx("input",{value:h,onChange:G=>u(G.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"‰æã: f7f3aea1-764f-4013-b51d-c7bca2ed6d20"}),e.jsx("button",{onClick:J,disabled:!h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"üß™ ‰ª£Ë¨ùË®àÁÆó Edge Function „ÉÜ„Çπ„Éà"}),e.jsx("p",{className:"text-xs text-gray-500",children:"‚Äª console / alert „Å´ÁµêÊûú„ÇíË°®Á§∫„Åó„Åæ„Åô"})]})]}):null}):x==="users"?e.jsx("div",{children:w==="invite"?e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>S("single"),className:`py-3 px-1 border-b-2 font-medium text-sm ${_==="single"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"ÂÄãÂà•ÊãõÂæÖ"}),e.jsx("button",{onClick:()=>S("bulk"),className:`py-3 px-1 border-b-2 font-medium text-sm ${_==="bulk"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"‰∏ÄÊã¨ÊãõÂæÖ (CSV)"})]})}),_==="single"?e.jsx("div",{"data-tutorial":"single-invite",children:e.jsx(Td,{teams:c,onUserInvited:()=>{}})}):e.jsx("div",{"data-tutorial":"bulk-invite",children:e.jsx(Ed,{teams:c,onUsersInvited:()=>{}})})]}):w==="manage"?e.jsx("div",{"data-tutorial":"user-list",children:e.jsx(Fd,{teams:c})}):w==="inbody"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"InBody „Éá„Éº„ÇøÂèñ„ÇäËæº„Åø"}),e.jsx("p",{className:"text-sm text-gray-600",children:"CSV„Åã„Çâ inbody_records „Å´ upsert „Åó„Åæ„ÅôÔºàphone_number + measured_at „ÅßÈáçË§áÊõ¥Êñ∞Ôºâ„ÄÇ"})]}),e.jsx(pc,{})]}):null}):x==="organization"?e.jsx("div",{children:f==="overview"?C&&ee?e.jsx(Kd,{organizationId:C,organizationName:ee.name}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"ÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("button",{onClick:()=>d("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"ÁµÑÁπî‰∏ÄË¶ß„Å∏"})]}):f==="list"?e.jsx(Od,{userId:t.id}):f==="members"?e.jsx("div",{children:C&&ee?e.jsx(dc,{organizationId:C,organizationName:ee.name}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"ÁµÑÁπî„É°„É≥„Éê„Éº„ÇíÁÆ°ÁêÜ„Åô„Çã„Å´„ÅØ„ÄÅ„Åæ„ÅöÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("button",{onClick:()=>d("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"ÁµÑÁπî‰∏ÄË¶ß„Å∏"})]})}):f==="settings"?e.jsx("div",{children:C?e.jsx(Xd,{organizationId:C}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Ë®≠ÂÆö„ÇíË°®Á§∫„Åô„Çã„Å´„ÅØ„ÄÅ„Åæ„ÅöÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("button",{onClick:()=>d("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"ÁµÑÁπî‰∏ÄË¶ß„Å∏"})]})}):f==="subscription"?e.jsx("div",{children:C?e.jsx(Gd,{organizationId:C,organizationName:"„Éá„É¢ÁµÑÁπî"}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÇíË°®Á§∫„Åô„Çã„Å´„ÅØ„ÄÅ„Åæ„ÅöÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("button",{onClick:()=>d("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"ÁµÑÁπî‰∏ÄË¶ß„Å∏"})]})}):f==="transfers"?e.jsx("div",{children:C?e.jsx(oc,{userId:t.id,organizationId:C,isAdmin:Gs(t.role)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"ÈÅ∏ÊâãÁßªÁ±çÁÆ°ÁêÜ„ÇíË°®Á§∫„Åô„Çã„Å´„ÅØ„ÄÅ„Åæ„ÅöÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("button",{onClick:()=>d("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"ÁµÑÁπî‰∏ÄË¶ß„Å∏"})]})}):f==="team-access"?e.jsx("div",{children:C?e.jsx(lc,{userId:t.id,organizationId:C,isAdmin:Gs(t.role)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"„ÉÅ„Éº„É†„Ç¢„ÇØ„Çª„Çπ„É™„ÇØ„Ç®„Çπ„Éà„ÇíË°®Á§∫„Åô„Çã„Å´„ÅØ„ÄÅ„Åæ„ÅöÁµÑÁπî„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("button",{onClick:()=>d("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"ÁµÑÁπî‰∏ÄË¶ß„Å∏"})]})}):null}):null})]})]})}),e.jsx(Ir,{steps:Hr("global_admin"),isActive:$,onComplete:D,onSkip:B,currentStepIndex:H,onStepChange:W})]})}function jc(t,s={}){const r=s.enabled??!0,n=s.pollMs??0,l=s.pauseWhenHidden??!0,i=a.useRef(!0);a.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[t]);const[c,j]=a.useState([]),[x,y]=a.useState([]),[v,N]=a.useState(!0),[w,p]=a.useState(null),{state:h,registerPollJob:u}=Lr(),f=a.useMemo(()=>{var M,k;return((k=(M=globalThis.crypto)==null?void 0:M.randomUUID)==null?void 0:k.call(M))??Math.random().toString(36).slice(2)},[]),d=a.useRef(null),o=a.useRef(null),g=a.useRef(!1),m=a.useRef(!1),b=a.useCallback(()=>{var k;const M=d.current;if(M){try{(k=M.unsubscribe)==null||k.call(M)}catch{}try{L.removeChannel(M)}catch{}d.current=null}},[]),_=a.useCallback(()=>{o.current&&(o.current(),o.current=null)},[]),S=a.useCallback(async()=>{const{data:M,error:k}=await L.from("badges").select("*").order("sort_order");if(k)throw k;i.current&&j(M??[])},[]),C=a.useCallback(async()=>{if(!(!t||!r)&&!m.current){m.current=!0;try{const{data:M,error:k}=await L.from("user_badges").select("*, badge:badges(*)").eq("user_id",t).order("earned_at",{ascending:!1});if(k)throw k;if(!i.current)return;y(M??[]),p(null)}catch(M){if(!i.current)return;p((M==null?void 0:M.message)??"„Éê„ÉÉ„Ç∏„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{m.current=!1}}},[t,r]),R=a.useCallback(()=>(x??[]).filter(M=>{if(typeof(M==null?void 0:M.is_new)=="boolean")return M.is_new===!0;const k=M==null?void 0:M.viewed_at,F=(M==null?void 0:M.is_viewed)??(M==null?void 0:M.viewed)??!1;return!k&&!F}),[x]),A=a.useCallback(()=>{const M=(x??[]).length,k=(c??[]).length,F=k>0?Math.round(M/k*100):0;return{earned:M,total:k,percentage:F}},[x,c]),T=a.useCallback(async M=>{if(!M)return;if(!(await L.from("user_badges").update({is_new:!1}).eq("id",M)).error){y(P=>(P??[]).map($=>($==null?void 0:$.id)===M?{...$,is_new:!1}:$)),await C();return}if(!(await L.from("user_badges").update({viewed_at:new Date().toISOString()}).eq("id",M)).error){await C();return}if(!(await L.from("user_badges").update({is_viewed:!0}).eq("id",M)).error){await C();return}const z=await L.from("user_badges").update({viewed:!0}).eq("id",M);if(z.error)throw console.warn("[useBadges] markBadgeAsViewed failed:",z.error),z.error;await C()},[C]);return a.useEffect(()=>{let M=!1;return(async()=>{if(b(),_(),!t||!r){i.current&&N(!1);return}try{i.current&&N(!0),g.current||(await S(),g.current=!0),await C()}catch(F){i.current&&p((F==null?void 0:F.message)??"„Éê„ÉÉ„Ç∏„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{!M&&i.current&&N(!1)}})(),()=>{M=!0,b(),_()}},[t,r,S,C,b,_]),a.useEffect(()=>{b()},[t,r,h.canRealtime,C,b,f]),a.useEffect(()=>{if(_(),!(!!t&&r&&n>0&&!0))return;const k=`badges:${t}:${f}`,F=u({key:k,intervalMs:n,run:async()=>{await C()},enabled:!0,requireVisible:l,requireOnline:!0,immediate:!1});return o.current=F,()=>_()},[t,r,n,l,h.canRealtime,u,C,_,f]),{allBadges:c,userBadges:x,loading:v,error:w,getNewBadges:R,getBadgeProgress:A,markBadgeAsViewed:T,refresh:async()=>{await Promise.all([S(),C()])}}}const Ea=(tt==null?void 0:tt.default)??tt;function wc({badge:t,onClose:s}){a.useEffect(()=>{typeof Ea=="function"&&Ea({particleCount:100,spread:70,origin:{y:.6}})},[t==null?void 0:t.id]);const r=a.useCallback(()=>{s()},[s]);return a.useEffect(()=>{const n=l=>{l.key==="Escape"&&r()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[r]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:r,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl relative",onClick:n=>n.stopPropagation(),children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Èñâ„Åò„Çã",children:e.jsx(Me,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-yellow-100 dark:bg-yellow-900/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Ua,{className:"w-10 h-10 text-yellow-600 dark:text-yellow-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Êñ∞„Åó„ÅÑ„Éê„ÉÉ„Ç∏Áç≤ÂæóÔºÅ"}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx(Dr,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:t.name}),e.jsx(Dr,{className:"w-5 h-5 text-yellow-500"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:t.description}),e.jsx("button",{onClick:r,className:"bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors",children:"„ÇÑ„Å£„ÅüÔºÅ"})]})]})})}function vc({userId:t}){const{userBadges:s,markBadgeAsViewed:r}=jc(t),[n,l]=a.useState(null),i=a.useRef(new Set),c=a.useMemo(()=>{const y=(s??[]).filter(N=>N.is_new),v={„Éñ„É≠„É≥„Ç∫Âà∞ÈÅî:10,„Ç∑„É´„Éê„ÉºÂà∞ÈÅî:20,„Ç¥„Éº„É´„ÉâÂà∞ÈÅî:30,„Éó„É©„ÉÅ„ÉäÂà∞ÈÅî:40,„ÉÄ„Ç§„É§„É¢„É≥„ÉâÂà∞ÈÅî:50,„Éû„Çπ„Çø„ÉºÂà∞ÈÅî:60};return[...y].sort((N,w)=>{var g,m;const p=new Date(N.earned_at).getTime(),h=new Date(w.earned_at).getTime();if(p!==h)return p-h;const u=((g=N.badge)==null?void 0:g.name)??"",f=((m=w.badge)==null?void 0:m.name)??"",d=v[u]??999,o=v[f]??999;return d!==o?d-o:u.localeCompare(f,"ja")})},[s]);a.useEffect(()=>{if(n)return;const y=c.find(v=>!i.current.has(v.id));y&&(i.current.add(y.id),l(y.id))},[c,n]);const j=(s??[]).find(y=>y.id===n)||null,x=async()=>{n&&await r(n),l(null)};return j!=null&&j.badge?e.jsx(wc,{badge:j.badge,onClose:x}):null}function Nc(t){try{return decodeURIComponent(t)}catch{return t}}function kc(t){return!t||t.startsWith("http://")||t.startsWith("https://")||!t.startsWith("/")?"/":t}function _c({onDone:t}){const[s,r]=Ae.useState(!1),[n,l]=Ae.useState(null),i=new URL(window.location.href),c=kc(i.searchParams.get("next")),j=i.searchParams.get("verify"),x=j?Nc(j):null,y=i.searchParams.get("code"),v=window.location.hash,N=v?new URLSearchParams(v.replace("#","")):null,w=N==null?void 0:N.get("type"),p=N==null?void 0:N.get("access_token"),h=N==null?void 0:N.get("refresh_token"),u=Ae.useMemo(()=>x?"„Éú„Çø„É≥„ÇíÊäº„Åô„Åæ„ÅßË™çË®º„É™„É≥„ÇØ„ÇíÈñã„Åã„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„É°„Éº„É´„ÅÆ„É™„É≥„ÇØÂÖàË™≠„ÅøÂØæÁ≠ñ„Å´„Å™„Çä„Åæ„Åô„ÄÇ":y?"„Çª„Ç≠„É•„É™„ÉÜ„Ç£‰∏ä„ÄÅ„Éú„Çø„É≥„ÇíÊäº„Åó„ÅüÊôÇ„Å†„ÅëË™çË®º„ÇíÂÆå‰∫Ü„Åó„Åæ„Åô„ÄÇ":w==="recovery"?"„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÁ¢∫ÂÆö„Åó„Åæ„Åô„ÄÇ":"„É™„É≥„ÇØ„ÅåÂ§±Âäπ„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",[x,y,w]),f=async()=>{l(null),r(!0);try{if(x){window.location.href=x;return}if(y){const{error:d}=await L.auth.exchangeCodeForSession(y);if(d)throw d;window.history.replaceState({},document.title,i.pathname),window.location.href=c;return}if(w==="recovery"&&p&&h){const{error:d}=await L.auth.setSession({access_token:p,refresh_token:h});if(d)throw d;window.history.replaceState({},document.title,i.pathname+i.search),window.location.href=c;return}throw new Error("Ë™çË®ºÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºà„É™„É≥„ÇØ„Åå‰∏çÊ≠£„ÄÅ„Åæ„Åü„ÅØÂÖàË™≠„Åø„ÅßÂ§±Âäπ„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„ÅôÔºâ")}catch(d){console.error("[AuthCallback] failed:",d),l((d==null?void 0:d.message)??"Ë™çË®º„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{r(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 max-w-md w-full space-y-4",children:[e.jsx("h1",{className:"text-lg font-bold",children:"„É≠„Ç∞„Ç§„É≥„ÇíÂÆå‰∫Ü„Åó„Åæ„Åô"}),e.jsx("p",{className:"text-sm text-gray-600",children:u}),n&&e.jsx("p",{className:"text-sm text-red-600",children:n}),e.jsx("button",{onClick:f,disabled:s,className:"w-full bg-blue-600 text-white rounded-lg py-2 disabled:opacity-50",children:s?"Âá¶ÁêÜ‰∏≠‚Ä¶":"Ë™çË®º„ÇíÁ¢∫ÂÆö„Åô„Çã"}),e.jsx("button",{type:"button",onClick:()=>window.location.href="/invite-expired",className:"w-full text-sm text-gray-600 underline",children:"ÊãõÂæÖ„É™„É≥„ÇØÂàá„ÇåÔºàÂÜçÈÄÅÔºâ„Å∏"}),e.jsx("button",{type:"button",onClick:()=>{window.history.replaceState({},"","/"),t()},className:"w-full text-sm text-gray-500 underline",children:"„Éà„ÉÉ„Éó„Å´Êàª„Çã"})]})})}function Aa(t){return t.trim().toLowerCase()}function Sc(){const[t,s]=a.useState(""),[r,n]=a.useState("idle"),[l,i]=a.useState(""),c=a.useMemo(()=>{const x=Aa(t);return x.includes("@")&&x.includes(".")&&r!=="sending"},[t,r]),j=async()=>{const x=Aa(t);if(x){n("sending"),i("");try{const{data:y,error:v}=await L.functions.invoke("request-password-reset",{body:{email:x,redirectUrl:`${window.location.origin}/reset-password`}});if(v){console.error("[InviteExpired] request-password-reset error:",v),n("error"),i("ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ");return}console.log("[InviteExpired] request-password-reset result:",y),n("success"),i("ÂÜçË®≠ÂÆö„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇÂèó‰ø°ÁÆ±„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇËø∑ÊÉë„É°„Éº„É´„ÇÇÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")}catch(y){console.error("[InviteExpired] exception:",y),n("error"),i((y==null?void 0:y.message)||"ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"mt-1",children:e.jsx(ge,{className:"w-6 h-6 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"ÊãõÂæÖ„É™„É≥„ÇØ„ÅÆÊúâÂäπÊúüÈôê„ÅåÂàá„Çå„Åæ„Åó„Åü"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"‰∏ã„ÅÆ„Éï„Ç©„Éº„É†„Åã„Çâ„ÄÅ„Éë„Çπ„ÉØ„Éº„ÉâÂÜçË®≠ÂÆöÔºà= Êñ∞„Åó„ÅÑ„É≠„Ç∞„Ç§„É≥ÊâãÊÆµÔºâ„ÇíÁô∫Ë°å„Åß„Åç„Åæ„Åô„ÄÇ"})]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 text-sm text-amber-900 dark:text-amber-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"„Åì„ÅÜ„ÅÑ„ÅÜÊôÇ„ÅÆÊïëÊ∏à„É´„Éº„Éà„Åß„Åô"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"ÊãõÂæÖ„É°„Éº„É´„ÅÆ„É™„É≥„ÇØ„ÅåÂàá„Çå„Å¶„Åó„Åæ„Å£„Åü"}),e.jsx("li",{children:"‰ºöÁ§æ„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Åß„É™„É≥„ÇØ„ÅåÂÖàË™≠„Åø„Åï„Çå„Å¶ÁÑ°Âäπ„Å´„Å™„Å£„Åü"}),e.jsx("li",{children:"ÊôÇÈñì„ÅåÁµå„Å£„Å¶„Åó„Åæ„Å£„Åü"})]})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"ÁôªÈå≤„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ot,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{value:t,onChange:x=>s(x.target.value),placeholder:"‰æãÔºâtanaka@example.com",className:`w-full pl-10 pr-3 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900
                             text-gray-900 dark:text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500`,type:"email",autoComplete:"email"})]}),e.jsx("button",{onClick:j,disabled:!c,className:`px-4 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium
                           disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2`,type:"button",children:r==="sending"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"ÈÄÅ‰ø°‰∏≠"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"w-4 h-4"}),e.jsx("span",{children:"ÂÜçÈÄÅ"})]})})]})]}),l&&e.jsx("div",{className:`rounded-lg p-3 text-sm border ${r==="success"?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200":"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-2",children:[r==="success"?e.jsx(Ne,{className:"w-4 h-4 mt-0.5"}):e.jsx(ge,{className:"w-4 h-4 mt-0.5"}),e.jsx("p",{children:l})]})}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsx("p",{children:"‚Ä¢ „É°„Éº„É´„ÅåÂ±ä„Åã„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄåËø∑ÊÉë„É°„Éº„É´„Äç„Äå„Éó„É≠„É¢„Éº„Ç∑„Éß„É≥„Äç„ÇÇÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}),e.jsx("p",{children:"‚Ä¢ „Åù„Çå„Åß„ÇÇÂ±ä„Åã„Å™„ÅÑÂ†¥Âêà„ÄÅÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ"})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("button",{type:"button",onClick:()=>{window.history.replaceState({},"","/"),window.location.reload()},className:"text-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white flex items-center space-x-2",children:[e.jsx(Ia,{className:"w-4 h-4"}),e.jsx("span",{children:"„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çã"})]})})]})]})})}function Cc({count:t,hasHighPriority:s=!1,onClick:r,className:n=""}){return t===0?e.jsx("button",{onClick:r,className:`
          relative p-2 text-gray-400 dark:text-gray-500 
          hover:text-gray-600 dark:hover:text-gray-300 
          transition-colors ${n}
        `,children:e.jsx(Ms,{className:"w-6 h-6"})}):e.jsxs("button",{onClick:r,className:`
        relative p-2 transition-colors ${s?"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300":"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300"} ${n}
      `,children:[s?e.jsx(ge,{className:"w-6 h-6 animate-pulse"}):e.jsx(Ms,{className:"w-6 h-6"}),e.jsx("span",{className:`
        absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white 
        transform translate-x-1/2 -translate-y-1/2 rounded-full min-w-[20px] h-5 ${s?"bg-red-600 dark:bg-red-500 animate-pulse":(t>9,"bg-blue-600 dark:bg-blue-500")}
      `,children:t>99?"99+":t})]})}function Mc({effectiveRole:t,userProfile:s,alertsLoading:r,unreadCount:n,hasHighPriorityAlerts:l,onOpenAlertPanel:i,onLogout:c,onHome:j,onNavigateToPrivacy:x,onNavigateToTerms:y,onNavigateToCommercial:v,onNavigateToHelp:N}){const[w,p]=Ae.useState(!1);if(t==="athlete")return null;const h=()=>p(!1);return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 relative z-40 transition-colors",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("button",{type:"button",onClick:()=>{j(),h()},className:"flex items-baseline space-x-2 transition-colors active:opacity-70 cursor-pointer",style:{WebkitTapHighlightColor:"transparent"},children:[e.jsx("span",{className:"text-xl font-bold tracking-tight text-gray-900 dark:text-white",style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"-0.02em"},children:"Bekuta"}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 hidden sm:inline",style:{letterSpacing:"0.05em"},children:"by ARCA"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300 hidden md:block transition-colors",children:[s.name,"„Åï„Çì"]}),!r&&e.jsx(Cc,{count:n,hasHighPriority:l,onClick:i,className:"touch-target"}),e.jsxs("button",{onClick:c,className:`hidden md:flex bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600
                  text-gray-700 dark:text-gray-200 px-3 py-2 rounded-lg
                  border border-gray-300 dark:border-gray-600
                  transition-colors items-center space-x-2 text-sm`,type:"button",children:[e.jsx(Cr,{className:"w-4 h-4"}),e.jsx("span",{children:"„É≠„Ç∞„Ç¢„Ç¶„Éà"})]}),e.jsx("button",{onClick:()=>p(u=>!u),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",type:"button","aria-label":"„É°„Éã„É•„Éº",children:w?e.jsx(Me,{className:"w-6 h-6"}):e.jsx(Ga,{className:"w-6 h-6"})})]})]})})}),w&&e.jsx("div",{className:"md:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg transition-colors relative z-40",children:e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold text-sm",children:(s.name||"U").charAt(0)})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:[s.name,"„Åï„Çì"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:s.email})]})]}),N&&e.jsxs("button",{onClick:()=>{h(),N()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[e.jsx(Ds,{className:"w-5 h-5"}),e.jsx("span",{children:"„Éò„É´„Éó„Éª„Éû„Éã„É•„Ç¢„É´"})]}),x&&e.jsxs("button",{onClick:()=>{h(),x()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[e.jsx(es,{className:"w-5 h-5"}),e.jsx("span",{children:"„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº"})]}),y&&e.jsxs("button",{onClick:()=>{h(),y()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[e.jsx(Et,{className:"w-5 h-5"}),e.jsx("span",{children:"Âà©Áî®Ë¶èÁ¥Ñ"})]}),v&&e.jsxs("button",{onClick:()=>{h(),v()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[e.jsx(Nt,{className:"w-5 h-5"}),e.jsx("span",{children:"ÁâπÂÆöÂïÜÂèñÂºïÊ≥ï„Å´Âü∫„Å•„ÅèË°®Ë®ò"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),e.jsxs("button",{onClick:u=>{h(),c(u)},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[e.jsx(Cr,{className:"w-5 h-5"}),e.jsx("span",{children:"„É≠„Ç∞„Ç¢„Ç¶„Éà"})]})]})})]})}function Dc({subtitle:t}){return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsx("div",{className:"text-4xl font-extrabold tracking-tight text-gray-900 dark:text-white",children:"Bekuta"}),e.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:t??"Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶"}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("div",{className:"h-6 w-6 rounded-full border-2 border-gray-300 dark:border-gray-700 border-t-transparent animate-spin"})})]})})}function Tc({loading:t,ready:s,onRetry:r,children:n,timeoutMs:l=12e3}){const[i,c]=a.useState(!1);return a.useEffect(()=>{if(!t){c(!1);return}const j=setTimeout(()=>c(!0),l);return()=>clearTimeout(j)},[t,l]),s?e.jsx(e.Fragment,{children:n}):i?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950",children:e.jsxs("div",{className:"max-w-md w-full p-6 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Bekuta"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:"Êé•Á∂ö„ÅåÈï∑Âºï„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇÈÄö‰ø°Áä∂Ê≥Å„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÄÅÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}),e.jsxs("div",{className:"mt-5 flex gap-2",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg bg-gray-900 text-white dark:bg-white dark:text-gray-900 text-sm font-semibold",onClick:r,children:"ÂÜçË©¶Ë°å"}),e.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 text-sm",onClick:async()=>{await L.auth.signOut(),window.location.href="/"},children:"„É≠„Ç∞„Ç¢„Ç¶„Éà"})]})]})}):e.jsx(Dc,{subtitle:"„Éû„Ç§„Éö„Éº„Ç∏„ÇíÊ∫ñÂÇô„Åó„Å¶„ÅÑ„Åæ„Åô‚Ä¶"})}function Ec(){const t=new Date,s=r=>String(r).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())} ${s(t.getHours())}:${s(t.getMinutes())}`}function Ac({title:t="„É°„É≥„ÉÜ„Éä„É≥„Çπ‰∏≠",message:s="ÁèæÂú®„ÄÅ„Ç∑„Çπ„ÉÜ„É†„ÅÆÂÆâÂÆöÂåñÂØæÂøú„ÇíË°å„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åî‰∏ç‰æø„Çí„Åä„Åã„Åë„Åó„Åæ„Åô„Åå„ÄÅ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ",etaText:r="",showRetry:n=!0}){const l=a.useMemo(()=>Ec(),[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50 text-slate-900",children:[e.jsxs("div",{className:"pointer-events-none fixed inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-24 -right-24 h-80 w-80 rounded-full bg-blue-200/35 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-28 -left-28 h-96 w-96 rounded-full bg-emerald-200/30 blur-3xl"}),e.jsx("div",{className:"absolute top-1/3 left-1/2 h-72 w-72 -translate-x-1/2 rounded-full bg-violet-200/20 blur-3xl"})]}),e.jsxs("div",{className:"relative mx-auto max-w-2xl px-5 py-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center",children:e.jsx(ts,{className:"h-5 w-5 text-slate-700"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xl font-extrabold tracking-tight",children:["Bekuta",e.jsx("span",{className:"ml-2 text-xs font-semibold text-slate-500 align-middle",children:"maintenance"})]}),e.jsx("div",{className:"text-sm text-slate-500",children:"strength for the future"})]})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["JST ",l]})]}),e.jsxs("div",{className:"mt-8 rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"border-b border-slate-100 px-6 py-5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700",children:[e.jsx(Mr,{className:"h-4 w-4 text-rose-500"}),t]}),e.jsx("div",{className:"text-xs text-slate-400",children:"System Status"})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-5",children:[e.jsx("p",{className:"text-slate-700 leading-relaxed",children:s}),r?e.jsxs("div",{className:"mt-3 text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold",children:"ÁõÆÂÆâÔºö"}),r]}):null,e.jsx("div",{className:"mt-4 text-xs text-slate-500 leading-relaxed",children:"‚Äª „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ„ÅÆÂÅúÊ≠¢„ÉªDBË≤†Ëç∑„ÅÆËªΩÊ∏õ„ÅÆ„Åü„ÇÅ„ÄÅ„É°„É≥„ÉÜ„Éä„É≥„ÇπÁîªÈù¢„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"})]}),e.jsxs("div",{className:"mt-5 flex flex-col sm:flex-row gap-3",children:[n&&e.jsxs("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center justify-center gap-2 rounded-2xl bg-slate-900 text-white px-5 py-3 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition",children:[e.jsx(Or,{className:"h-4 w-4"}),"ÂÜçË™≠„ÅøËæº„Åø"]}),e.jsxs("a",{href:"https://bekuta.netlify.app/",className:"inline-flex items-center justify-center gap-2 rounded-2xl bg-white ring-1 ring-slate-200 px-5 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition",children:[e.jsx(ll,{className:"h-4 w-4"}),"„Éà„ÉÉ„Éó„Å∏"]})]}),e.jsx("div",{className:"mt-6 text-center text-xs text-slate-400",children:"‚ÄúSmall steps, big futures.‚Äù ‚Äî Bekuta"})]})]}),e.jsx("div",{className:"mt-8 text-center text-xs text-slate-400",children:"„ÅäÊÄ•„Åé„ÅÆÂ†¥Âêà„ÅØ„ÄÅ„Çπ„Çø„ÉÉ„Éï„Å∏„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ"})]})]})}function Rc({onAccept:t,onDecline:s}){const[r,n]=a.useState(!1),[l,i]=a.useState(!1),[c,j]=a.useState(null),[x,y]=a.useState(!1),v=r&&l&&c!==null,N=()=>{!v||x||t()},w=async()=>{y(!0),await s()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(es,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Bekuta „Å∏„Çà„ÅÜ„Åì„Åù"}),e.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"„ÅîÂà©Áî®Ââç„Å´ÂøÖ„Åö„ÅäË™≠„Åø„Åè„Å†„Åï„ÅÑ"})]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-4 rounded",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(pe,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsx("p",{className:"font-bold text-orange-900 dark:text-orange-200",children:"Êú¨„Çµ„Éº„Éì„Çπ„Å´„Å§„ÅÑ„Å¶„ÅÆÈáçË¶Å„Å™„ÅäÁü•„Çâ„Åõ"}),e.jsxs("ul",{className:"space-y-1 text-orange-800 dark:text-orange-300",children:[e.jsx("li",{children:"‚Ä¢ ÂΩì„Çµ„Éº„Éì„Çπ„ÅØÂåªÁôÇÊ©üÂô®„Åß„ÅØ„Å™„Åè„ÄÅË®∫Êñ≠„ÉªÊ≤ªÁôÇ„ÇíÁõÆÁöÑ„Å®„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("li",{children:"‚Ä¢ ÊÄ™Êàë„ÅÆ‰∫àÈò≤„Çí‰øùË®º„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("li",{children:"‚Ä¢ ACWR„ÅØÂèÇËÄÉÂÄ§„Åß„ÅÇ„Çä„ÄÅÊúÄÁµÇÂà§Êñ≠„ÅØÊú¨‰∫∫„ÉªÊåáÂ∞éËÄÖ„ÉªÂåªÁôÇÂ∞ÇÈñÄÂÆ∂„ÅåË°å„ÅÑ„Åæ„Åô"}),e.jsx("li",{children:"‚Ä¢ „Çπ„Éù„Éº„ÉÑÊ¥ªÂãï„Å´„ÅØÂõ∫Êúâ„ÅÆ„É™„Çπ„ÇØ„Åå‰º¥„ÅÑ„Åæ„Åô"})]})]})]})}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-5",children:[e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Et,{className:"w-5 h-5 mr-2 text-purple-600 dark:text-purple-400"}),"Âπ¥ÈΩ¢Á¢∫Ë™ç"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-4",children:"„ÅÇ„Å™„Åü„ÅØ18Ê≠≥‰ª•‰∏ä„Åß„Åô„ÅãÔºü"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{onClick:()=>j(!1),className:`flex-1 py-3 px-4 rounded-lg border-2 transition-all ${c===!1?"border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"border-gray-300 dark:border-gray-600 hover:border-green-400"}`,children:[e.jsx(Ne,{className:`w-5 h-5 mx-auto mb-1 ${c===!1?"text-green-500":"text-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:"18Ê≠≥‰ª•‰∏ä„Åß„Åô"})]}),e.jsxs("button",{onClick:()=>j(!0),className:`flex-1 py-3 px-4 rounded-lg border-2 transition-all ${c===!0?"border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":"border-gray-300 dark:border-gray-600 hover:border-yellow-400"}`,children:[e.jsx(pe,{className:`w-5 h-5 mx-auto mb-1 ${c===!0?"text-yellow-500":"text-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:"18Ê≠≥Êú™Ê∫Ä„Åß„Åô"})]})]}),c!==null&&c&&e.jsxs("div",{className:"mt-4 bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 font-medium mb-2",children:"‰øùË≠∑ËÄÖ„ÅÆÂêåÊÑè„ÅåÂøÖË¶Å„Åß„Åô"}),e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mb-3",children:"18Ê≠≥Êú™Ê∫Ä„ÅÆÊñπ„ÅØ„ÄÅ‰øùË≠∑ËÄÖ„ÅÆÊñπ„Å®‰∏ÄÁ∑í„Å´„Åì„ÅÆÁîªÈù¢„Çí„ÅîÁ¢∫Ë™ç„ÅÑ„Åü„Å†„Åç„ÄÅ ‰øùË≠∑ËÄÖ„ÅÆÊñπ„ÅÆÂêåÊÑè„ÇíÂæó„Åü‰∏ä„Åß„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ"}),e.jsx("div",{className:"bg-white dark:bg-yellow-800/20 rounded-lg p-3 text-xs text-yellow-900 dark:text-yellow-100",children:"‰øùË≠∑ËÄÖ„ÅÆÊñπ„Åå„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ„ÄåÂêåÊÑè„Åó„Å™„ÅÑ„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„ÄÅ Âæå„Åª„Å©‰øùË≠∑ËÄÖ„ÅÆÊñπ„Å®‰∏ÄÁ∑í„Å´ÂÜçÂ∫¶„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]})]}),e.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800",children:e.jsxs("label",{className:"flex items-start cursor-pointer group",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:p=>n(p.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`
                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center
                    ${r?"bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500"}
                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800
                  `,children:r&&e.jsx(Ne,{className:"w-4 h-4 text-white",strokeWidth:3})})]}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Âà©Áî®Ë¶èÁ¥Ñ„Å´ÂêåÊÑè„Åó„Åæ„Åô"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:e.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",onClick:p=>p.stopPropagation(),children:"Âà©Áî®Ë¶èÁ¥Ñ„ÇíÁ¢∫Ë™ç„Åô„Çã ‚Üí"})})]})]})}),e.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800",children:e.jsxs("label",{className:"flex items-start cursor-pointer group",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:p=>i(p.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`
                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center
                    ${l?"bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500"}
                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800
                  `,children:l&&e.jsx(Ne,{className:"w-4 h-4 text-white",strokeWidth:3})})]}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº„Å´ÂêåÊÑè„Åó„Åæ„Åô"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:e.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",onClick:p=>p.stopPropagation(),children:"„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº„ÇíÁ¢∫Ë™ç„Åô„Çã ‚Üí"})})]})]})}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 dark:text-white mb-2",children:"ÂèéÈõÜ„Åô„Çã„Éá„Éº„Çø„Å´„Å§„ÅÑ„Å¶"}),e.jsxs("ul",{className:"text-xs text-gray-700 dark:text-gray-300 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ „Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤ÔºàRPE„ÄÅÊôÇÈñì„ÄÅË≤†Ëç∑Ôºâ"}),e.jsx("li",{children:"‚Ä¢ ‰ΩìÈáçË®òÈå≤Ôºà„É°„É¢„ÅØÊú¨‰∫∫„ÅÆ„ÅøÈñ≤Ë¶ßÂèØËÉΩÔºâ"}),e.jsx("li",{children:"‚Ä¢ ÊâÄÂ±û„ÉÅ„Éº„É†„ÅÆ„Çπ„Çø„ÉÉ„Éï„ÅØ„ÅÇ„Å™„Åü„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„ÇíÈñ≤Ë¶ß„Åß„Åç„Åæ„Åô"}),e.jsx("li",{children:"‚Ä¢ „Éá„Éº„Çø„ÅØÊöóÂè∑Âåñ„Åó„Å¶ÂÆâÂÖ®„Å´‰øùÁÆ°„Åï„Çå„Åæ„Åô"})]})]})]})}),e.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700",children:x?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 font-medium mb-2",children:"‰øùË≠∑ËÄÖ„ÅÆÂêåÊÑèÊâøË™ç„ÇíÂæó„Å¶„Åã„ÇâÂà©Áî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çä„Åæ„Åô..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:w,disabled:x,className:"flex-1 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"ÂêåÊÑè„Åó„Å™„ÅÑ"}),e.jsx("button",{onClick:N,disabled:!v||x,className:`flex-1 py-3 px-4 rounded-lg font-medium transition-all ${v&&!x?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-500 cursor-not-allowed"}`,children:c?"‰øùË≠∑ËÄÖ„ÅÆÂêåÊÑè„ÇíÂæó„Å¶Âà©Áî®ÈñãÂßã":"ÂêåÊÑè„Åó„Å¶Âà©Áî®ÈñãÂßã"})]}),e.jsx("p",{className:"text-xs text-center text-gray-500 dark:text-gray-400 mt-3",children:"Âà©Áî®ÈñãÂßãÂæå„ÇÇ„ÅÑ„Å§„Åß„ÇÇË®≠ÂÆö„Åã„Çâ„Åì„Çå„Çâ„ÅÆÊñáÊõ∏„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô"})]})})]})})}function $c({id:t,message:s,type:r="success",duration:n=3e3,onClose:l}){a.useEffect(()=>{const j=setTimeout(()=>{l(t)},n);return()=>clearTimeout(j)},[t,n,l]);const i=()=>{switch(r){case"success":return e.jsx(Ne,{className:"w-5 h-5 text-green-600 dark:text-green-400"});case"error":return e.jsx(pe,{className:"w-5 h-5 text-red-600 dark:text-red-400"});case"info":return e.jsx(Wt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"});default:return e.jsx(Ne,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}},c=()=>{switch(r){case"success":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"info":return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800";default:return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"}};return e.jsxs("div",{className:`${c()} border rounded-lg shadow-lg p-4 flex items-center space-x-3 min-w-[300px] max-w-md animate-slide-in-right`,role:"alert",children:[i(),e.jsx("p",{className:"flex-1 text-sm font-medium text-gray-900 dark:text-white",children:s}),e.jsx("button",{onClick:()=>l(t),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:e.jsx(Me,{className:"w-4 h-4"})})]})}function Fc({toasts:t,onClose:s}){return e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(r=>e.jsx($c,{...r,onClose:s},r.id))})}function Lc({onNavigateToPrivacy:t,onNavigateToTerms:s,onNavigateToCommercial:r}){const n=new Date().getFullYear();return e.jsx("footer",{className:"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8",children:[e.jsx("div",{className:"md:hidden",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["¬© ",n," Ê†™Âºè‰ºöÁ§æARCA. All Rights Reserved."]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Ê≥ïÁöÑÊÉÖÂ†±„ÅØ„É°„Éã„É•„Éº„Åã„Çâ„ÅîË¶ß„ÅÑ„Åü„Å†„Åë„Åæ„Åô"})]})}),e.jsxs("div",{className:"hidden md:grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"Bekuta by ARCA"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 leading-relaxed",children:"„Éá„Éº„Çø„Çµ„Ç§„Ç®„É≥„Çπ„Å´„Çà„Çã„Éà„É¨„Éº„Éã„É≥„Ç∞Ë≤†Ëç∑ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†„ÄÇ ACWR„ÇíÁî®„ÅÑ„Å¶ÊÄ™Êàë„É™„Çπ„ÇØ„ÇíÂèØË¶ñÂåñ„Åó„ÄÅ„Ç¢„Çπ„É™„Éº„Éà„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ„Çí„Çµ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ"}),e.jsxs("div",{className:"mt-4 flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(Pc,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:"ÂåªÁôÇÊ©üÂô®„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"Ê≥ïÁöÑÊÉÖÂ†±"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsxs("button",{onClick:t,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:s,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Et,{className:"w-4 h-4 mr-2"}),"Âà©Áî®Ë¶èÁ¥Ñ"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:r,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Nt,{className:"w-4 h-4 mr-2"}),"ÁâπÂÆöÂïÜÂèñÂºïÊ≥ï„Å´Âü∫„Å•„ÅèË°®Ë®ò"]})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"„ÅäÂïè„ÅÑÂêà„Çè„Åõ"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("a",{href:"mailto:info@arca.fit",className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Ot,{className:"w-4 h-4 mr-2"}),"info@arca.fit"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Âñ∂Ê•≠Êó•2-3Êó•‰ª•ÂÜÖ„Å´Ëøî‰ø°„ÅÑ„Åü„Åó„Åæ„Åô"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"ÈÅãÂñ∂‰∫ãÊ•≠ËÄÖ"}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Ê†™Âºè‰ºöÁ§æARCA",e.jsx("br",{}),"‰ª£Ë°®ÂèñÁ∑†ÂΩπ ÂâçÁî∞ÂÖÖÁØÑ"]})]})]})]}),e.jsx("div",{className:"hidden md:block mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-4 rounded",children:e.jsxs("p",{className:"text-xs text-yellow-800 dark:text-yellow-200 leading-relaxed",children:[e.jsx("strong",{children:"ÂÖçË≤¨‰∫ãÈ†Ö:"})," Êú¨„Çµ„Éº„Éì„Çπ„ÅØÂåªÁôÇÊ©üÂô®„Åß„ÅØ„Å™„Åè„ÄÅË®∫Êñ≠„ÉªÊ≤ªÁôÇ„ÇíÁõÆÁöÑ„Å®„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ ÊÄ™Êàë„ÅÆ‰∫àÈò≤„Çí‰øùË®º„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„Å™„Åè„ÄÅACWR„Åù„ÅÆ‰ªñ„ÅÆÊåáÊ®ô„ÅØÂèÇËÄÉÂÄ§„Åß„Åô„ÄÇ ÊúÄÁµÇÁöÑ„Å™Âà§Êñ≠„ÅØÂà©Áî®ËÄÖÊú¨‰∫∫„ÄÅÊåáÂ∞éËÄÖ„ÄÅÂåªÁôÇÂ∞ÇÈñÄÂÆ∂„ÅåË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"]})})}),e.jsx("div",{className:"hidden md:block mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["¬© ",n," Ê†™Âºè‰ºöÁ§æARCA. All Rights Reserved."]}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:"Version 1.0.0"}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:"Êó•Êú¨Ê≥ïÊ∫ñÊã†"})]})]})}),e.jsx("div",{className:"hidden md:block mt-4",children:e.jsxs("details",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("summary",{className:"cursor-pointer hover:text-gray-700 dark:hover:text-gray-300",children:"„Ç™„Éº„Éó„É≥„ÇΩ„Éº„Çπ„É©„Ç§„Çª„É≥„Çπ"}),e.jsxs("div",{className:"mt-2 pl-4 space-y-1",children:[e.jsx("p",{children:"‚Ä¢ React - MIT License"}),e.jsx("p",{children:"‚Ä¢ Recharts - MIT License"}),e.jsx("p",{children:"‚Ä¢ Supabase - Apache License 2.0"}),e.jsx("p",{children:"‚Ä¢ Lucide Icons - ISC License"}),e.jsx("p",{children:"‚Ä¢ Tailwind CSS - MIT License"})]})]})})]})})}function Pc({className:t}){return e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}const qc=12e4;function zc({userId:t}){var b,_;const{state:s,registerPollJob:r}=Lr(),[n,l]=a.useState([]),[i,c]=a.useState(!1),[j,x]=a.useState(null),y=a.useRef(((_=(b=globalThis.crypto)==null?void 0:b.randomUUID)==null?void 0:_.call(b))??Math.random().toString(36).slice(2)),v=a.useRef(null),N=a.useRef(null),[w,p]=a.useState(!1),h=a.useCallback(()=>{var C;const S=v.current;if(S){try{(C=S.unsubscribe)==null||C.call(S)}catch{}try{L.removeChannel(S)}catch{}v.current=null}},[]),u=a.useCallback(async()=>{if(!t)return;const{data:S,error:C}=await L.from("team_achievement_notifications").select(`
        id, team_id, user_id, achievement_id, is_read, created_at,
        achievement:team_achievements (
          id, team_id, achievement_type, title, description, achieved_at, metadata, celebrated
        )
      `).eq("user_id",t).eq("is_read",!1).order("created_at",{ascending:!0});if(C){console.error("[team_achievement_notifications] load error:",C);return}if(!S)return;const R=S.filter(A=>A.achievement);l(R)},[t]);a.useEffect(()=>{t&&s.canRun&&u()},[t,s.canRun,u]),a.useEffect(()=>{h()},[t,s.canRealtime,w,u,h]),a.useEffect(()=>{if(N.current&&(N.current(),N.current=null),!t)return;const S=`team_achievements:${t}:${y.current}`,C=r({key:S,intervalMs:qc,run:async()=>{await u()},enabled:!0,requireVisible:!0,requireOnline:!0,immediate:!0});return N.current=C,()=>{N.current&&(N.current(),N.current=null)}},[t,w,r,u]),a.useEffect(()=>{},[t,s.canRealtime,w]),a.useEffect(()=>{n.length>0&&!i&&(x(n[0]),c(!0),f())},[n,i]);const f=()=>{const C=Date.now()+2500,R={startVelocity:25,spread:360,ticks:60,zIndex:9999},A=setInterval(()=>{const T=C-Date.now();if(T<=0)return clearInterval(A);const M=50*(T/2500);tt({...R,particleCount:M,origin:{x:.2,y:.2}}),tt({...R,particleCount:M,origin:{x:.8,y:.2}})},200)},d=async()=>{if(!j)return;const{error:S}=await L.rpc("mark_team_notification_read",{p_notification_id:j.id});S&&console.error("[mark_team_notification_read] error:",S),c(!1),l(C=>C.filter(R=>R.id!==j.id)),x(null)},o=S=>{switch(S){case"team_streak":case"streak_7":return $e;case"team_personal_best":case"pb":return Ua;case"team_acwr_safe":return Ke;case"team_goals_complete":case"goal":return tr;default:return tr}};if(!i||!j)return null;const g=j.achievement;if(!g)return null;const m=o(g.achievement_type);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-2xl shadow-2xl max-w-md w-full p-8 border-4 border-yellow-400 dark:border-yellow-600 animate-bounce-in",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:d,className:"p-2 hover:bg-yellow-200 dark:hover:bg-yellow-800 rounded-lg transition-colors",children:e.jsx(Me,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-yellow-400 dark:bg-yellow-600 rounded-full mb-4 animate-pulse",children:e.jsx(m,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900 dark:text-white",children:"„ÉÅ„Éº„É†ÈÅîÊàêÔºÅ"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-yellow-800 dark:text-yellow-200 mb-1",children:g.title}),g.description?e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:g.description}):null]}),e.jsx("button",{onClick:d,className:"w-full py-3 bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 text-white font-semibold rounded-lg transition-colors",children:"„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ"})]})]})})}const Oc=a.lazy(()=>Qe(()=>import("./OrganizationAdminView-B7CghIAN.js"),__vite__mapDeps([14,1,2])).then(t=>({default:t.OrganizationAdminView}))),Bc=a.lazy(()=>Qe(()=>Promise.resolve().then(()=>rd),void 0).then(t=>({default:t.AlertPanel})));function Wc(){const{user:t,userProfile:s,loading:r,requiresPasswordChange:n,signIn:l,signOut:i,changePassword:c,acceptTerms:j,refreshUserProfile:x}=An();Ae.useEffect(()=>{let E=!0;(async()=>{const{error:B}=await L.auth.getSession();E&&B&&await _r(B)})();const{data:D}=L.auth.onAuthStateChange(async(B,H)=>{if(E&&!H&&(B==="TOKEN_REFRESHED"||B==="SIGNED_IN")){const{error:W}=await L.auth.getSession();W&&await _r(W)}});return()=>{E=!1,D.subscription.unsubscribe()}},[]);const y=(s==null?void 0:s.role)==="staff"||(s==null?void 0:s.role)==="global_admin"||(s==null?void 0:s.role)==="athlete"?s.role:"athlete",[v,N]=Ae.useState(!1),{isOrganizationAdmin:w,getOrganizationAdminRoles:p}=Jn(s==null?void 0:s.id),{alerts:h,loading:u,unreadCount:f,markAsRead:d,dismissAlert:o,markAllAsRead:g,getAlertsByPriority:m}=Kn((s==null?void 0:s.id)||"",y),{toasts:b,removeToast:_}=Yn(),[S,C]=Ae.useState(!1),[R,A]=Ae.useState(!1),[T,M]=Ae.useState("app"),[k,F]=Ae.useState("staff"),[O,z]=Ae.useState(!1);if(Ae.useEffect(()=>{N(n)},[n]),Ae.useEffect(()=>{const E=new URL(window.location.href),D=E.pathname,B=E.searchParams;if(D.startsWith("/auth/callback")){M("auth-callback");return}if(D.startsWith("/invite-expired")){M("invite-expired");return}if(D.startsWith("/reset-password")){M("reset-password");return}if(D.startsWith("/welcome")||B.get("token")){M("welcome");return}},[]),Ae.useEffect(()=>{const E=window.location.hash;if(!E)return;const D=new URLSearchParams(E.replace("#",""));if(D.get("type")!=="recovery")return;const B=D.get("access_token"),H=D.get("refresh_token");!B||!H||(async()=>{var U;const{data:W}=await L.auth.setSession({access_token:B,refresh_token:H});(U=W.session)!=null&&U.user&&(N(!0),window.history.replaceState({},document.title,window.location.pathname),M("reset-password"))})()},[]),Ae.useEffect(()=>{t&&s&&!v&&!s.terms_accepted&&!O?A(!0):A(!1)},[t,s,v,O]),T==="auth-callback")return e.jsx(_c,{onDone:()=>{M("app"),window.history.replaceState({},"","/")}});const P=!1,q=window.location.pathname.startsWith("/auth/callback");return P&&!q?e.jsx(Ac,{etaText:"ÔºàÂÆâÂÆöÂåñ„ÇíÁ¢∫Ë™ç‰∏≠„Åß„Åô„ÄÇ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑÔºâ"}):T==="invite-expired"?e.jsx(Sc,{}):T==="welcome"?e.jsx(Tl,{onContinue:()=>{M("app"),window.history.replaceState({},"","/")}}):t?e.jsx(Tc,{loading:r||!!t&&!s,ready:!!t&&!!s,onRetry:x,children:(()=>{if(!s)return null;if(v)return e.jsx(Dl,{onPasswordChange:async B=>{await c(B),N(!1),window.history.replaceState({},"","/")},userName:s.name});if(R)return e.jsx(Rc,{onAccept:async()=>{await j(),z(!0),A(!1)},onDecline:i});const E=m("high").length>0,D=async B=>{B.preventDefault(),await i(),M("app"),window.history.replaceState({},"","/")};return e.jsx(Zn,{userId:s.id,role:y,children:e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[e.jsx(Mc,{effectiveRole:y,userProfile:{id:s.id,name:s.name,email:s.email},alertsLoading:u,unreadCount:f,hasHighPriorityAlerts:E,onOpenAlertPanel:()=>C(!0),onLogout:D,onHome:()=>{console.log("üè† Bekuta logo clicked"),M("app"),F("staff"),C(!1)},onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}),e.jsxs("div",{className:"relative",children:[e.jsx(vc,{userId:s.id}),y==="athlete"?e.jsx(Uo,{user:s,alerts:h,onLogout:i,onUserUpdated:x,onHome:()=>{console.log("üè† Athlete Bekuta home tapped"),window.location.assign("https://bekuta.netlify.app/")},onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}):Gs(y)?e.jsx(yc,{user:s,alerts:h,onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}):e.jsxs(e.Fragment,{children:[w()&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b dark:border-gray-700 transition-colors sticky top-0 z-30",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2",children:e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1 max-w-md",children:[e.jsxs("button",{type:"button",onClick:()=>F("staff"),className:`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 ${k==="staff"?"bg-white dark:bg-gray-600 text-green-600 dark:text-green-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{children:"„Ç≥„Éº„ÉÅ"})]}),e.jsxs("button",{type:"button",onClick:()=>F("org-admin"),className:`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 ${k==="org-admin"?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{children:"ÁµÑÁπîÁÆ°ÁêÜ"})]})]})})}),k==="staff"?e.jsx(Cd,{user:s,alerts:h,onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}):p().length>0&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:e.jsx(Oc,{user:s,alerts:h,organizationId:p()[0].organizationId,organizationName:p()[0].organizationName,onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")})})]})]}),S&&!u&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:e.jsx(Bc,{alerts:h,onMarkAsRead:d,onDismiss:o,onMarkAllAsRead:g,onClose:()=>C(!1),userRole:y})}),s&&e.jsx(zc,{userId:s.id}),e.jsx(Fc,{toasts:b,onClose:_}),e.jsx(Lc,{onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial")})]})})})()}):e.jsx(Cl,{onLogin:l})}console.log("üöÄ main.tsx is executing");console.log("üìç Current URL:",window.location.href);console.log("üîç Checking for root element...");const mn=document.getElementById("root");if(!mn)throw console.error("‚ùå Root element not found!"),document.body.innerHTML='<div style="padding: 40px; font-family: sans-serif;"><h1>Error: Root element not found</h1><p>The #root div is missing from index.html</p></div>',new Error("Root element not found");console.log("‚úÖ Root element found, creating React root...");try{const t=Pa(mn);console.log("‚úÖ React root created, rendering App..."),t.render(e.jsx(a.StrictMode,{children:e.jsx(Hn,{children:e.jsx(Wc,{})})})),console.log("‚úÖ App render initiated successfully")}catch(t){console.error("‚ùå Error during React initialization:",t),document.body.innerHTML=`<div style="padding: 40px; font-family: sans-serif;">
    <h1>React Initialization Error</h1>
    <pre>${t}</pre>
  </div>`}export{wl as $,ge as A,Js as B,zr as C,Sr as D,_e as E,ol as F,gt as G,Ds as H,il as I,Lr as J,pe as K,Qs as L,Ua as M,Ke as N,Kd as O,tr as P,Dr as Q,ts as R,kl as S,lc as T,$e as U,Ya as V,et as W,Me as X,es as Y,Ut as Z,Kc as _,Nt as a,dl as a0,jc as a1,wc as a2,hl as a3,Br as a4,en as a5,Nl as a6,ni as a7,_t as a8,gi as a9,Ve as aa,It as ab,ar as ac,Et as ad,tt as ae,Do as af,Oa as ag,za as ah,Zs as ai,Vc as aj,rr as ak,ll as al,Or as am,Ne as an,Ot as ao,An as ap,ir as aq,Qt as ar,qr as as,gd as at,As as b,Er as c,_l as d,Sl as e,Td as f,Ed as g,Fd as h,dc as i,e as j,Xd as k,Gd as l,oc as m,Ir as n,Hr as o,ht as p,ms as q,uo as r,L as s,Jc as t,Pr as u,el as v,Xt as w,mr as x,Ia as y,X as z};

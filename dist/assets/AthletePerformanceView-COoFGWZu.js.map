{"version":3,"file":"AthletePerformanceView-COoFGWZu.js","sources":["../../src/lib/performanceCalculations.ts","../../src/components/PerformanceRecordForm.tsx","../../src/components/PerformanceRecordsList.tsx","../../src/components/PerformanceChart.tsx","../../src/components/PerformanceOverview.tsx","../../src/components/PersonalBestCelebration.tsx","../../src/components/views/AthletePerformanceView.tsx"],"sourcesContent":["/**\n * -----------------------------------------------------\n * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã®è¨ˆç®—å¼ãƒ»å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆå®Œå…¨çµ±åˆç‰ˆï¼‰\n * cmj_asï¼ˆè…•æŒ¯ã‚ŠCMJï¼‰å¯¾å¿œæ¸ˆã¿\n * 050_lï¼ˆ0-5-0 å·¦ï¼‰å¯¾å¿œæ¸ˆã¿\n * ç§’ç³»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆå°æ•°2æ¡ï¼‰å¯¾å¿œæ¸ˆã¿\n * VO2ç³»ï¼ˆml/kg/min å°æ•°1æ¡ï¼‰å¯¾å¿œæ¸ˆã¿\n * RSIï¼ˆå°æ•°2æ¡ï¼‰å¯¾å¿œæ¸ˆã¿\n * -----------------------------------------------------\n */\n\n/**\n * VO2max æ¨å®šè¨ˆç®—\n */\nexport const calculateVO2max = {\n  cooperTest: (distance: number): number => {\n    if (distance <= 0) return 0;\n    return Math.max(0, (distance - 504.9) / 44.73);\n  },\n\n  run1500m: (minutes: number, seconds: number): number => {\n    return minutes * 60 + seconds;\n  },\n\n  yoyoIR1: (distance: number): number => {\n    if (distance <= 0) return 0;\n    return distance * 0.0084 + 36.4;\n  },\n\n  yoyoIR2: (distance: number): number => {\n    if (distance <= 0) return 0;\n    return distance * 0.0136 + 45.3;\n  },\n\n  shuttleRun20m: (count: number): number => {\n    if (count <= 0) return 0;\n\n    const vo2maxTable: Record<number, number> = {\n      8: 27.8, 9: 28.0, 10: 28.3, 11: 28.5, 12: 28.7, 13: 28.9,\n      14: 29.2, 15: 29.4, 16: 29.6, 17: 29.8, 18: 30.1, 19: 30.3,\n      20: 30.5, 21: 30.7, 22: 31.0, 23: 31.2, 24: 31.4, 25: 31.6,\n      26: 31.9, 27: 32.1, 28: 32.3, 29: 32.5, 30: 32.8, 31: 33.0,\n      32: 33.2, 33: 33.4, 34: 33.7, 35: 33.9, 36: 34.1, 37: 34.3,\n      38: 34.6, 39: 34.8, 40: 35.0, 41: 35.2, 42: 35.5, 43: 35.7,\n      44: 35.9, 45: 36.1, 46: 36.4, 47: 36.6, 48: 36.8, 49: 37.0,\n      50: 37.3, 51: 37.5, 52: 37.7, 53: 37.9, 54: 38.2, 55: 38.4,\n      56: 38.6, 57: 38.8, 58: 39.1, 59: 39.3, 60: 39.5,\n      61: 39.7, 62: 40.0, 63: 40.2, 64: 40.4, 65: 40.6,\n      66: 40.9, 67: 41.1, 68: 41.3, 69: 41.5, 70: 41.8,\n      71: 42.0, 72: 42.2, 73: 42.4, 74: 42.7, 75: 42.9,\n      76: 43.1, 77: 43.3, 78: 43.6, 79: 43.8, 80: 44.0,\n      81: 44.2, 82: 44.5, 83: 44.7, 84: 44.9, 85: 45.1,\n      86: 45.4, 87: 45.6, 88: 45.8, 89: 46.0, 90: 46.3,\n      91: 46.5, 92: 46.7, 93: 46.9, 94: 47.2, 95: 47.4,\n      96: 47.6, 97: 47.8, 98: 48.1, 99: 48.3, 100: 48.5,\n      101: 48.7, 102: 49.0, 103: 49.2, 104: 49.4, 105: 49.6,\n      106: 49.9, 107: 50.1, 108: 50.3, 109: 50.5, 110: 50.8,\n      111: 51.0, 112: 51.2, 113: 51.4, 114: 51.7, 115: 51.9,\n      116: 52.1, 117: 52.3, 118: 52.6, 119: 52.8, 120: 53.0,\n      121: 53.2, 122: 53.5, 123: 53.7, 124: 53.9, 125: 54.1,\n      126: 54.4, 127: 54.6, 128: 54.8, 129: 55.0, 130: 55.3,\n      131: 55.5, 132: 55.7, 133: 55.9, 134: 56.2, 135: 56.4,\n      136: 56.6, 137: 56.8, 138: 57.1, 139: 57.3, 140: 57.5,\n      141: 57.7, 142: 58.0, 143: 58.2, 144: 58.4, 145: 58.6,\n      146: 58.9, 147: 59.1, 148: 59.5, 149: 59.8, 150: 60.0,\n      151: 60.2, 152: 60.4, 153: 60.7, 154: 60.9, 155: 61.1,\n      156: 61.1, 157: 61.3\n    };\n\n    if (vo2maxTable[count]) return vo2maxTable[count];\n    if (count < 8) return 27.8;\n    if (count > 157) return 61.3 + 0.2 * (count - 157);\n\n    const low = Math.floor(count);\n    const high = Math.ceil(count);\n    return (\n      vo2maxTable[low] +\n      (vo2maxTable[high] - vo2maxTable[low]) * (count - low)\n    );\n  }\n};\n\n/**\n * 1RM è¨ˆç®—\n */\nexport const calculate1RM = {\n  epley: (weight: number, reps: number): number => {\n    if (weight <= 0 || reps <= 0) return 0;\n    if (reps === 1) return weight;\n    return Math.round(weight * (1 + reps / 30) * 10) / 10;\n  },\n\n  brzycki: (weight: number, reps: number): number => {\n    if (weight <= 0 || reps <= 0 || reps >= 37) return 0;\n    if (reps === 1) return weight;\n    return Math.round(weight * (36 / (37 - reps)) * 10) / 10;\n  }\n};\n\n/**\n * primary_value è¨ˆç®—ï¼ˆç¨®ç›®å â†’ è¨ˆç®—å¼ï¼‰\n */\nexport function calculatePrimaryValue(\n  testName: string,\n  values: Record<string, any>\n): number | null {\n  try {\n    switch (testName) {\n      // -------------------------------\n      // ã‚¸ãƒ£ãƒ³ãƒ—ç³»ï¼ˆè·³èºé«˜ï¼‰\n      // -------------------------------\n      case 'cmj':\n      case 'cmj_as':\n        return parseFloat(values.height) || null;\n\n      // -------------------------------\n      // ç«‹ã¡å¹…è·³ã³\n      // -------------------------------\n      case 'standing_long_jump':\n      case 'standing_five_jump':\n        return parseFloat(values.distance) || null;\n\n      // -------------------------------\n      // åå¿œç³»ã‚¸ãƒ£ãƒ³ãƒ—ï¼ˆRSIï¼‰\n      // -------------------------------\n      case 'dj_rsi':\n        if (values.height && values.contact_time) {\n          return (parseFloat(values.height) / 100) /\n            (parseFloat(values.contact_time) / 1000);\n        }\n        return null;\n\n      case 'rj_rsi':\n        if (values.avg_height && values.avg_contact_time) {\n          return (parseFloat(values.avg_height) / 100) /\n            (parseFloat(values.avg_contact_time) / 1000);\n        }\n        return null;\n\n      // -------------------------------\n      // æŒä¹…ç³»\n      // -------------------------------\n      case 'cooper_test':\n        return calculateVO2max.cooperTest(parseFloat(values.distance));\n\n      case '1500m_run':\n        return calculateVO2max.run1500m(\n          parseFloat(values.time_minutes),\n          parseFloat(values.time_seconds)\n        );\n\n      case 'yoyo_ir1':\n        return calculateVO2max.yoyoIR1(parseFloat(values.distance));\n\n      case 'yoyo_ir2':\n        return calculateVO2max.yoyoIR2(parseFloat(values.distance));\n\n      case 'shuttle_run_20m':\n        return calculateVO2max.shuttleRun20m(parseFloat(values.count));\n\n      // -------------------------------\n      // ç­‹åŠ›ç³»ï¼š1RM\n      // -------------------------------\n      case 'bench_press':\n      case 'back_squat':\n      case 'deadlift':\n        return calculate1RM.epley(\n          parseFloat(values.weight),\n          parseFloat(values.reps)\n        );\n\n      case 'bulgarian_squat_r':\n      case 'bulgarian_squat_l':\n        return calculate1RM.epley(\n          parseFloat(values.weight),\n          parseFloat(values.reps)\n        );\n\n      // -------------------------------\n      // æ–°è¦è¿½åŠ ç¨®ç›®\n      // -------------------------------\n      case 'sqj':\n        return parseFloat(values.height) || null;\n\n      case '1000m_run':\n        return (\n          parseFloat(values.time_minutes) * 60 +\n          parseFloat(values.time_seconds)\n        );\n\n      case 'pull_up':\n        return parseFloat(values.count) || null;\n\n      case 'side_step_test':\n        return parseFloat(values.count) || null;\n\n      // -------------------------------\n      // ã‚¢ã‚¸ãƒªãƒ†ã‚£ï¼ˆã‚¿ã‚¤ãƒ ï¼‰\n      // -------------------------------\n      case '050_r':\n      case '050_l':\n      case '050-l':\n      case 'pro_agility_r':\n      case 'pro_agility_l':\n      case 'arrowhead_r':\n      case 'arrowhead_l':\n        return parseFloat(values.time) || null;\n\n      // -------------------------------\n      // Sprint ç³»ï¼ˆã‚¿ã‚¤ãƒ ï¼‰\n      // -------------------------------\n      case 'sprint_5m':\n      case 'sprint_10m':\n      case 'sprint_15m':\n      case 'sprint_20m':\n      case 'sprint_30m':\n      case 'sprint_50m':\n        return parseFloat(values.time) || null;\n\n      default:\n        return null;\n    }\n  } catch (error) {\n    console.error('Error calculating primary value:', error);\n    return null;\n  }\n}\n\n/**\n * values ã‹ã‚‰ primary_value ã‚’æŠ½å‡º\n */\nexport function extractPrimaryValue(values: Record<string, any>) {\n  if (!values) return null;\n\n  if (values.primary_value !== undefined && values.primary_value !== null) {\n    return Number(values.primary_value);\n  }\n\n  const numericKeys = Object.keys(values).filter(\n    (key) => !isNaN(Number(values[key]))\n  );\n\n  return numericKeys.length > 0 ? Number(values[numericKeys[0]]) : null;\n}\n\n/**\n * æœ€æ–°ã® primary_value ã‚’å–å¾—\n */\nexport function getLatestPrimaryValue(records: any[]) {\n  if (!records?.length) return null;\n\n  const latest = [...records].sort(\n    (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n  )[0];\n\n  return extractPrimaryValue(latest.values);\n}\n\n/**\n * å˜ä½\n */\nexport function getCalculatedUnit(testName: string): string {\n  switch (testName) {\n    case 'cmj':\n    case 'cmj_as':\n    case 'standing_long_jump':\n    case 'standing_five_jump':\n      return 'cm';\n\n    case 'cooper_test':\n    case 'yoyo_ir1':\n    case 'yoyo_ir2':\n    case 'shuttle_run_20m':\n      return 'ml/kg/min';\n\n    case '1000m_run':\n    case '1500m_run':\n    case 'arrowhead_r':\n    case 'arrowhead_l':\n    case '050_r':\n    case '050_l':\n    case '050-l':\n    case 'pro_agility_r':\n    case 'pro_agility_l':\n      return 'ç§’';\n\n    case 'bench_press':\n    case 'back_squat':\n    case 'deadlift':\n    case 'bulgarian_squat_r':\n    case 'bulgarian_squat_l':\n      return 'kg';\n\n    case 'dj_rsi':\n    case 'rj_rsi':\n      return 'RSI';\n\n    case 'sprint_5m':\n    case 'sprint_10m':\n    case 'sprint_15m':\n    case 'sprint_20m':\n    case 'sprint_30m':\n    case 'sprint_50m':\n      return 'ç§’';\n\n    default:\n      return '';\n  }\n}\n\n/**\n * è¡¨ç¤ºãƒ©ãƒ™ãƒ«\n */\nexport function getCalculatedValueLabel(testName: string): string {\n  switch (testName) {\n    case 'sqj':\n    case 'cmj':\n    case 'cmj_as':\n      return 'è·³èºé«˜';\n\n    case 'standing_long_jump':\n    case 'standing_five_jump':\n      return 'è·é›¢';\n\n    case 'cooper_test':\n    case 'yoyo_ir1':\n    case 'yoyo_ir2':\n    case 'shuttle_run_20m':\n      return 'æ¨å®šVO2max';\n\n    case '1500m_run':\n    case '1000m_run':\n    case 'arrowhead_r':\n    case 'arrowhead_l':\n    case '050_r':\n    case '050_l':\n    case '050-l':\n    case 'pro_agility_r':\n    case 'pro_agility_l':\n      return 'ã‚¿ã‚¤ãƒ ';\n\n    case 'bench_press':\n    case 'back_squat':\n    case 'deadlift':\n    case 'bulgarian_squat_r':\n    case 'bulgarian_squat_l':\n      return 'æ¨å®š1RM';\n\n    case 'dj_rsi':\n    case 'rj_rsi':\n      return 'RSI';\n\n    default:\n      return 'è¨ˆç®—å€¤';\n  }\n}\n\n/**\n * -----------------------------------------------------\n * è¿½åŠ ï¼šè¡¨ç¤ºç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿\n * - ç§’ï¼šå°æ•°2æ¡\n * - VO2ï¼ˆml/kg/minï¼‰ï¼šå°æ•°1æ¡\n * - RSIï¼šå°æ•°2æ¡\n * - kgï¼šå°æ•°1æ¡\n * -----------------------------------------------------\n */\nexport function formatCalculatedValue(testName: string, value: number | null): string {\n  if (value === null || value === undefined || !Number.isFinite(value)) return '-';\n\n  const name = (testName || '').toLowerCase();\n\n  // RSIï¼šå°æ•°2æ¡\n  if (name.includes('rsi')) {\n    return Number(value).toFixed(2);\n  }\n\n  // VO2ç³»ï¼šå°æ•°1æ¡\n  const vo2Tests = new Set([\n    'cooper_test',\n    'yoyo_ir1',\n    'yoyo_ir2',\n    'shuttle_run_20m',\n  ]);\n  if (vo2Tests.has(name)) {\n    return Number(value).toFixed(1);\n  }\n\n  // ç§’ç³»ï¼šå°æ•°2æ¡\n  const secTests = new Set([\n    '050_r', '050_l', '050-l',\n    'pro_agility_r', 'pro_agility_l',\n    'arrowhead_r', 'arrowhead_l',\n    'sprint_5m', 'sprint_10m', 'sprint_15m', 'sprint_20m', 'sprint_30m', 'sprint_50m',\n  ]);\n  if (secTests.has(name)) return Number(value).toFixed(2);\n\n  // kgç³»ï¼šå°æ•°1æ¡\n  const kgTests = new Set([\n    'bench_press', 'back_squat', 'deadlift',\n    'bulgarian_squat_r', 'bulgarian_squat_l',\n  ]);\n  if (kgTests.has(name)) return Number(value).toFixed(1);\n\n  // ãã®ä»–ã¯ãã®ã¾ã¾\n  return String(value);\n}","import React, { useState, useEffect, useMemo } from 'react';\nimport { getTodayJSTString } from '../lib/date';\nimport { Plus, Calendar, AlertCircle, TrendingUp, Lock, Scale } from 'lucide-react';\nimport {\n  calculatePrimaryValue,\n  getCalculatedUnit,\n  getCalculatedValueLabel,\n  formatCalculatedValue,\n} from '../lib/performanceCalculations';\nimport { useWeightData } from '../hooks/useWeightData';\nimport { PerformanceRecordWithTest } from '../hooks/usePerformanceData';\nimport { DuplicateRecordModal } from './DuplicateRecordModal';\n\ninterface PerformanceTestField {\n  name: string;\n  label: string;\n  unit?: string;\n  type?: 'number' | 'select' | string;\n  required?: boolean;\n  options?: { value: string; label: string }[];\n}\n\ninterface PerformanceTestType {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  unit: string;\n  user_can_input?: boolean;\n  fields: PerformanceTestField[] | any[];\n}\n\ninterface PerformanceRecordFormProps {\n  userId: string;\n  userRole?: string;\n  testTypes: PerformanceTestType[];\n  onSubmit: (data: {\n    test_type_id: string;\n    date: string;\n    values: Record<string, any>;\n    notes?: string;\n    is_official?: boolean;\n  }) => Promise<{ data: any; isNewPersonalBest: boolean }>;\n  onCheckExisting: (testTypeId: string, date: string) => Promise<PerformanceRecordWithTest | null>;\n  onUpdate: (recordId: string, updates: any) => Promise<any>;\n  loading: boolean;\n  lastRecords?: Map<string, any>;\n  personalBests?: Map<string, any>;\n}\n\n// âœ… ç­‹åŠ›ç³»ç¨®ç›®ã‚’ã“ã“ã§ä¸€å…ƒç®¡ç†ï¼ˆãƒ™ãƒ³ãƒãƒ»SQãƒ»DLãƒ»ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³å·¦å³ï¼‰\nconst strengthTestNames = [\n  'bench_press',\n  'back_squat',\n  'deadlift',\n  'bulgarian_squat_r',\n  'bulgarian_squat_l',\n];\n\nexport function PerformanceRecordForm({\n  userId,\n  userRole: _userRole,\n  testTypes,\n  onSubmit,\n  onCheckExisting,\n  onUpdate,\n  loading,\n  lastRecords,\n  personalBests\n}: PerformanceRecordFormProps) {\n  const { getLatestWeight } = useWeightData(userId);\n\n  const [selectedTestTypeId, setSelectedTestTypeId] = useState<string>('');\n  const [selectedDate, setSelectedDate] = useState<string>(getTodayJSTString());\n  const [formValues, setFormValues] = useState<Record<string, any>>({});\n  const [notes, setNotes] = useState<string>('');\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string>('');\n  const [showPersonalBestMessage, setShowPersonalBestMessage] = useState(false);\n  const [latestWeight, setLatestWeight] = useState<number | null>(null);\n  const [relative1RM, setRelative1RM] = useState<number | null>(null);\n  const [showDuplicateModal, setShowDuplicateModal] = useState(false);\n  const [existingRecord, setExistingRecord] = useState<PerformanceRecordWithTest | null>(null);\n  const [pendingData, setPendingData] = useState<any>(null);\n\n  const selectedTestType = useMemo(\n    () => testTypes.find(t => t.id === selectedTestTypeId),\n    [testTypes, selectedTestTypeId]\n  );\n\n  useEffect(() => {\n    if (!selectedTestType) return;\n\n    // åˆæœŸåŒ–\n    const initialValues: Record<string, any> = {};\n    if (Array.isArray(selectedTestType.fields)) {\n      selectedTestType.fields.forEach((field: any) => {\n        initialValues[field.name] = '';\n      });\n    }\n    setFormValues(initialValues);\n\n    // âœ… ç­‹åŠ›æ¸¬å®šç¨®ç›®ã®å ´åˆã€æœ€æ–°ä½“é‡ã‚’å–å¾—\n    const isStrengthTest = strengthTestNames.includes(selectedTestType.name);\n    if (isStrengthTest) {\n      const weight = getLatestWeight();\n      console.log('ğŸ‹ï¸ Strength test selected, latest weight:', weight);\n      setLatestWeight(weight);\n    } else {\n      setLatestWeight(null);\n      setRelative1RM(null);\n    }\n  }, [selectedTestType, getLatestWeight]);\n\n  const computePrimaryValue = (values: Record<string, any>): number | null => {\n    if (!selectedTestType) return null;\n    return calculatePrimaryValue(selectedTestType.name, values);\n  };\n\n  const getDisplayUnit = (): string => {\n    if (!selectedTestType) return '';\n    const calculatedUnit = getCalculatedUnit(selectedTestType.name);\n    return calculatedUnit || selectedTestType.unit;\n  };\n\n  const getValueLabel = (): string => {\n    if (!selectedTestType) return 'è¨ˆç®—å€¤';\n    return getCalculatedValueLabel(selectedTestType.name);\n  };\n\n  // âœ… è¨ˆç®—å€¤ã®è¡¨ç¤ºï¼ˆutilã«çµ±ä¸€ï¼‰\n  const getPrimaryValueDisplay = (): string => {\n    if (!selectedTestType) return '-';\n    const primaryValue = computePrimaryValue(formValues);\n    if (primaryValue === null) return '-';\n    return formatCalculatedValue(selectedTestType.name, primaryValue);\n  };\n\n  const lastRecord = lastRecords?.get(selectedTestTypeId);\n  const personalBest = personalBests?.get(selectedTestTypeId);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!selectedTestType) {\n      setError('æ¸¬å®šç¨®ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    const requiredFields = Array.isArray(selectedTestType.fields)\n      ? selectedTestType.fields.filter((f: any) => f.required)\n      : [];\n\n    for (const field of requiredFields) {\n      if (!formValues[field.name] || formValues[field.name] === '') {\n        setError(`${field.label}ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„`);\n        return;\n      }\n    }\n\n    const primaryValue = computePrimaryValue(formValues);\n    if (primaryValue === null) {\n      setError('è¨ˆç®—ã§ããªã„å€¤ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã™');\n      return;\n    }\n\n    // âœ… primary_value ã‚’DBã«ç¶ºéº—ã«å…¥ã‚Œã‚‹ï¼ˆè¡¨ç¤ºã¨åŒã˜ä¸¸ã‚ã«çµ±ä¸€ï¼‰\n    const unit = getDisplayUnit();\n    let normalizedPrimary: number;\n\n    if (unit === 'ç§’') {\n      normalizedPrimary = Number(primaryValue.toFixed(2));\n    } else if (unit === 'ml/kg/min') {\n      normalizedPrimary = Number(primaryValue.toFixed(1));\n    } else if (unit === 'RSI') {\n      normalizedPrimary = Number(primaryValue.toFixed(2));\n    } else if (unit === 'kg') {\n      normalizedPrimary = Number(primaryValue.toFixed(1));\n    } else {\n      normalizedPrimary = primaryValue;\n    }\n\n    // âœ… ç­‹åŠ›æ¸¬å®šã®å ´åˆã€ç›¸å¯¾1RMã¨æ¸¬å®šæ™‚ä½“é‡ã‚’è¿½åŠ ï¼ˆãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³å«ã‚€ï¼‰\n    const isStrengthTest = strengthTestNames.includes(selectedTestType.name);\n\n    const valuesWithRelative = {\n      ...formValues,\n      primary_value: normalizedPrimary,\n      ...(isStrengthTest && latestWeight ? {\n        relative_1rm: relative1RM,\n        weight_at_test: latestWeight\n      } : {})\n    };\n\n    // é‡è¤‡ãƒã‚§ãƒƒã‚¯\n    const existing = await onCheckExisting(selectedTestTypeId, selectedDate);\n    if (existing) {\n      setExistingRecord(existing);\n      setPendingData({\n        test_type_id: selectedTestTypeId,\n        date: selectedDate,\n        values: valuesWithRelative,\n        notes: notes || undefined,\n        is_official: true\n      });\n      setShowDuplicateModal(true);\n      return;\n    }\n\n    setSubmitting(true);\n\n    try {\n      const result = await onSubmit({\n        test_type_id: selectedTestTypeId,\n        date: selectedDate,\n        values: valuesWithRelative,\n        notes: notes || undefined,\n        is_official: true\n      });\n\n      if (result.isNewPersonalBest) {\n        setShowPersonalBestMessage(true);\n        setTimeout(() => setShowPersonalBestMessage(false), 5000);\n      }\n\n      setFormValues({});\n      setNotes('');\n      setSelectedTestTypeId('');\n      setSelectedDate(getTodayJSTString());\n      setRelative1RM(null);\n      setLatestWeight(null);\n    } catch (err) {\n      console.error('Error submitting performance record:', err);\n      setError('è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleOverwrite = async () => {\n    if (!existingRecord || !pendingData) return;\n\n    setSubmitting(true);\n    setShowDuplicateModal(false);\n\n    try {\n      await onUpdate((existingRecord as any).id, {\n        values: pendingData.values,\n        notes: pendingData.notes\n      });\n\n      setFormValues({});\n      setNotes('');\n      setSelectedTestTypeId('');\n      setSelectedDate(getTodayJSTString());\n      setExistingRecord(null);\n      setPendingData(null);\n      setRelative1RM(null);\n      setLatestWeight(null);\n    } catch (err) {\n      console.error('Error updating record:', err);\n      setError('è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleCancelOverwrite = () => {\n    setShowDuplicateModal(false);\n    setExistingRecord(null);\n    setPendingData(null);\n  };\n\n  const handleValueChange = (fieldName: string, value: string) => {\n    const newValues = {\n      ...formValues,\n      [fieldName]: value\n    };\n    setFormValues(newValues);\n\n    // âœ… ç­‹åŠ›æ¸¬å®šã§é‡é‡ã¾ãŸã¯å›æ•°ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã€ç›¸å¯¾1RMã‚’è¨ˆç®—ï¼ˆãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³å«ã‚€ï¼‰\n    const isStrengthTest = !!selectedTestType && strengthTestNames.includes(selectedTestType.name);\n\n    if (isStrengthTest && (fieldName === 'weight' || fieldName === 'reps') && latestWeight) {\n      const weight = parseFloat(newValues.weight || '0');\n      const reps = parseFloat(newValues.reps || '0');\n\n      console.log('ğŸ’ª Calculating relative 1RM from:', { weight, reps, latestWeight });\n\n      if (weight > 0 && reps > 0) {\n        const oneRM = weight * (1 + reps / 30);\n        const relative = oneRM / latestWeight;\n        console.log('âœ… 1RM:', oneRM.toFixed(1), 'kg, Relative 1RM:', relative.toFixed(2));\n        setRelative1RM(Math.round(relative * 100) / 100);\n      } else {\n        setRelative1RM(null);\n      }\n    }\n  };\n\n  return (\n    <>\n      <DuplicateRecordModal\n        isOpen={showDuplicateModal}\n        onClose={handleCancelOverwrite}\n        onOverwrite={handleOverwrite}\n        onCancel={handleCancelOverwrite}\n        existingRecord={existingRecord!}\n        newValue={pendingData?.values?.primary_value || 0}\n      />\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {showPersonalBestMessage && (\n          <div className=\"bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/30 border-2 border-yellow-400 dark:border-yellow-600 rounded-xl p-4 animate-bounce-subtle\">\n            <div className=\"flex items-center\">\n              <TrendingUp className=\"w-6 h-6 text-yellow-600 dark:text-yellow-400 mr-3\" />\n              <div>\n                <p className=\"font-bold text-yellow-900 dark:text-yellow-100\">ğŸ‰ ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆæ›´æ–°ï¼</p>\n                <p className=\"text-sm text-yellow-700 dark:text-yellow-300\">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼è‡ªå·±æœ€é«˜è¨˜éŒ²ã‚’é”æˆã—ã¾ã—ãŸï¼</p>\n              </div>\n            </div>\n          </div>\n        )}\n\n        <div>\n          <label className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n            <Calendar className=\"w-4 h-4 mr-2\" />\n            æ¸¬å®šæ—¥\n          </label>\n          <input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            max={getTodayJSTString()}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white\"\n            style={{ fontSize: '16px' }}\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n            æ¸¬å®šç¨®ç›®\n          </label>\n          <select\n            value={selectedTestTypeId}\n            onChange={(e) => setSelectedTestTypeId(e.target.value)}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white\"\n            style={{ fontSize: '16px' }}\n          >\n            <option value=\"\">æ¸¬å®šç¨®ç›®ã‚’é¸æŠ</option>\n\n            {testTypes\n              .filter(testType => testType.user_can_input !== false)\n              .map(testType => (\n                <option key={testType.id} value={testType.id}>\n                  {testType.display_name}\n                </option>\n              ))}\n\n            {testTypes\n              .filter(testType => testType.user_can_input === false)\n              .map(testType => (\n                <option key={testType.id} value={testType.id} disabled className=\"text-gray-400\">\n                  ğŸ”’ {testType.display_name}ï¼ˆå°‚é–€æ¥­è€…æ¸¬å®šï¼‰\n                </option>\n              ))}\n          </select>\n\n          {selectedTestType && (\n            <div className=\"mt-2\">\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                {selectedTestType.description}\n              </p>\n              {selectedTestType.user_can_input === false && (\n                <div className=\"mt-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3 flex items-start\">\n                  <Lock className=\"w-4 h-4 text-amber-600 dark:text-amber-400 mr-2 mt-0.5 flex-shrink-0\" />\n                  <div className=\"text-xs text-amber-700 dark:text-amber-300\">\n                    <p className=\"font-semibold\">å°‚é–€æ¥­è€…ã«ã‚ˆã‚‹æ¸¬å®šãŒå¿…è¦ã§ã™</p>\n                    <p className=\"mt-1\">ã“ã®æ¸¬å®šã¯å°‚ç”¨æ©Ÿå™¨ãŒå¿…è¦ãªãŸã‚ã€å€‹äººã§ã®å…¥åŠ›ã¯ã§ãã¾ã›ã‚“ã€‚æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã¯å°‚é–€æ¥­è€…ã«ã‚ˆã£ã¦è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        {selectedTestType && Array.isArray(selectedTestType.fields) && (\n          <>\n            {lastRecord && (\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-sm\">\n                <p className=\"text-blue-600 dark:text-blue-400 mb-1\">å‰å›ã®è¨˜éŒ²</p>\n                <p className=\"text-blue-700 dark:text-blue-300\">\n                  {formatCalculatedValue(selectedTestType.name, Number(lastRecord.values?.primary_value))}\n                  {' '}\n                  {getDisplayUnit()}\n                  {' '}\n                  ({new Date(lastRecord.date).toLocaleDateString('ja-JP')})\n                </p>\n              </div>\n            )}\n\n            {personalBest && (\n              <div className=\"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-3 text-sm\">\n                <p className=\"text-yellow-600 dark:text-yellow-400 mb-1 flex items-center\">\n                  <TrendingUp className=\"w-4 h-4 mr-1\" />\n                  ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆ\n                </p>\n                <p className=\"text-yellow-700 dark:text-yellow-300 font-semibold\">\n                  {formatCalculatedValue(selectedTestType.name, Number(personalBest.value))}\n                  {' '}\n                  {getDisplayUnit()}\n                  {' '}\n                  ({new Date(personalBest.date).toLocaleDateString('ja-JP')})\n                </p>\n              </div>\n            )}\n\n            <div className=\"space-y-4\">\n              {selectedTestType.fields.map((field: any) => (\n                <div key={field.name}>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    {field.label} {field.required && <span className=\"text-red-500\">*</span>}\n                    {field.unit && (\n                      <span className=\"text-gray-500 text-xs ml-1\">\n                        ({field.unit})\n                      </span>\n                    )}\n                  </label>\n\n                  {field.type === 'select' ? (\n                    <select\n                      value={formValues[field.name] || ''}\n                      onChange={(e) => handleValueChange(field.name, e.target.value)}\n                      className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white\"\n                      style={{ fontSize: '16px' }}\n                    >\n                      <option value=\"\">{field.label}ã‚’é¸æŠ</option>\n                      {field.options?.map((option: any) => (\n                        <option key={option.value} value={option.value}>\n                          {option.label}\n                        </option>\n                      ))}\n                    </select>\n                  ) : (\n                    <input\n                      type={field.type === 'text' ? 'text' : 'number'}\n                      inputMode={field.type === 'text' ? 'text' : 'decimal'}\n                      step={field.type === 'text' ? undefined : '0.01'}\n                      min={field.type === 'text' ? undefined : 0}\n                      value={formValues[field.name] || ''}\n                      onChange={(e) => handleValueChange(field.name, e.target.value)}\n                      className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white\"\n                      placeholder={field.label}\n                      style={{ fontSize: '16px' }}\n                    />\n                  )}\n                </div>\n              ))}\n            </div>\n\n            <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4 transition-colors\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">{getValueLabel()}</span>\n                <span className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                  {getPrimaryValueDisplay()} {getDisplayUnit()}\n                </span>\n              </div>\n            </div>\n\n            {/* âœ… ç­‹åŠ›æ¸¬å®šã®å ´åˆã€ç›¸å¯¾1RMã¨æ¸¬å®šæ™‚ä½“é‡ã‚’è¡¨ç¤ºï¼ˆãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³å«ã‚€ï¼‰ */}\n            {selectedTestType && strengthTestNames.includes(selectedTestType.name) && (\n              <div className=\"space-y-3\">\n                {latestWeight && (\n                  <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 transition-colors\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center\">\n                        <Scale className=\"w-4 h-4 text-green-600 dark:text-green-400 mr-2\" />\n                        <span className=\"text-sm font-medium text-green-700 dark:text-green-300\">\n                          æ¸¬å®šæ™‚ã®ä½“é‡\n                        </span>\n                      </div>\n                      <span className=\"text-lg font-bold text-green-600 dark:text-green-400\">\n                        {latestWeight.toFixed(1)} kg\n                      </span>\n                    </div>\n                    <p className=\"text-xs text-green-600 dark:text-green-400\">\n                      æœ€æ–°ã®ä½“é‡è¨˜éŒ²ã‹ã‚‰è‡ªå‹•å–å¾—\n                    </p>\n                  </div>\n                )}\n\n                {relative1RM && latestWeight && (\n                  <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-4 transition-colors\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-sm font-medium text-purple-700 dark:text-purple-300\">\n                        ç›¸å¯¾1RMï¼ˆä½“é‡æ¯”ï¼‰\n                      </span>\n                      <span className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">\n                        {relative1RM.toFixed(2)}\n                      </span>\n                    </div>\n                    <p className=\"text-xs text-purple-600 dark:text-purple-400\">\n                      1RM {getPrimaryValueDisplay()} kg Ã· ä½“é‡ {latestWeight.toFixed(1)} kg = {relative1RM.toFixed(2)}\n                    </p>\n                  </div>\n                )}\n\n                {!latestWeight && (\n                  <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\n                    <div className=\"flex items-start\">\n                      <AlertCircle className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2 mt-0.5 flex-shrink-0\" />\n                      <div>\n                        <p className=\"text-sm font-semibold text-yellow-800 dark:text-yellow-200\">\n                          ä½“é‡è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“\n                        </p>\n                        <p className=\"text-xs text-yellow-700 dark:text-yellow-300 mt-1\">\n                          ç›¸å¯¾1RMï¼ˆä½“é‡æ¯”ï¼‰ã‚’è¨ˆç®—ã™ã‚‹ã«ã¯ã€ä½“é‡è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </>\n        )}\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰\n          </label>\n          <textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            rows={3}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white resize-none\"\n            placeholder=\"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚„æ°—ã¥ã„ãŸã“ã¨ã‚’è¨˜éŒ²...\"\n            style={{ fontSize: '16px' }}\n          />\n        </div>\n\n        {error && (\n          <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n            <div className=\"flex items-center\">\n              <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400 mr-2\" />\n              <span className=\"text-sm text-red-700 dark:text-red-300\">{error}</span>\n            </div>\n          </div>\n        )}\n\n        <button\n          type=\"submit\"\n          disabled={submitting || loading || !selectedTestTypeId || selectedTestType?.user_can_input === false}\n          className=\"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center\"\n          style={{ WebkitTapHighlightColor: 'transparent', touchAction: 'manipulation' }}\n        >\n          {submitting ? (\n            <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n          ) : (\n            <Plus className=\"w-5 h-5 mr-2\" />\n          )}\n          {submitting ? 'è¨˜éŒ²ä¸­...' : 'æ¸¬å®šè¨˜éŒ²ã‚’è¿½åŠ '}\n        </button>\n      </form>\n    </>\n  );\n}","import React from 'react';\nimport {\n  Trophy,\n  Calendar,\n  FileText,\n  TrendingUp,\n  TrendingDown,\n  Shield,\n} from 'lucide-react';\nimport { PerformanceRecordWithTest, PersonalBest } from '../hooks/usePerformanceData';\nimport {\n  getCalculatedUnit,\n  formatCalculatedValue,\n} from '../lib/performanceCalculations';\n\ninterface PerformanceRecordsListProps {\n  records: PerformanceRecordWithTest[];\n  personalBests: PersonalBest[];\n  loading: boolean;\n}\n\nexport function PerformanceRecordsList({\n  records,\n  personalBests,\n  loading\n}: PerformanceRecordsListProps) {\n\n  // âœ… æ–‡å­—åˆ—/æ•°å€¤ã©ã¡ã‚‰ã§ã‚‚å®‰å…¨ã«æ•°å€¤åŒ–\n  const toNumber = (v: any): number | null => {\n    if (v === null || v === undefined || v === '') return null;\n    const n = typeof v === 'string' ? parseFloat(v) : Number(v);\n    return Number.isFinite(n) ? n : null;\n  };\n\n  // âœ… ç¨®ç›®åã‹ã‚‰å˜ä½ã‚’çµ±ä¸€å–å¾—\n  const getUnit = (record: PerformanceRecordWithTest): string => {\n    const name = record.test_type?.name || '';\n    return getCalculatedUnit(name) || record.test_type?.unit || '';\n  };\n\n  // âœ… PBåˆ¤å®šï¼šå°æ•°ä¸¸ã‚/èª¤å·®ã§å¤–ã‚Œãªã„ã‚ˆã†ã«ã€è¡¨ç¤ºä¸¸ã‚å¾Œã®å€¤ã§æ¯”è¼ƒã™ã‚‹\n  const isPersonalBest = (record: PerformanceRecordWithTest): boolean => {\n    const pb = personalBests.find(pb => pb.test_type_id === record.test_type_id);\n    if (!pb) return false;\n\n    const name = record.test_type?.name || '';\n    const recordPV = toNumber(record.values?.primary_value);\n    const pbVal = toNumber(pb.value);\n\n    if (recordPV === null || pbVal === null) return false;\n\n    // dateä¸€è‡´ + è¡¨ç¤ºä¸¸ã‚ä¸€è‡´ï¼ˆ\"2.50\" ã¨ \"2.5\" å•é¡Œã‚’æ½°ã™ï¼‰\n    const recordFmt = formatCalculatedValue(name, recordPV);\n    const pbFmt = formatCalculatedValue(name, pbVal);\n\n    return pb.date === record.date && recordFmt === pbFmt;\n  };\n\n  const getImprovementFromPrevious = (record: PerformanceRecordWithTest): number | null => {\n    if (!record.test_type) return null;\n\n    const sameTestPrev = records\n      .filter(r => r.test_type_id === record.test_type_id)\n      .filter(r => new Date(r.date) < new Date(record.date))\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())[0];\n\n    if (!sameTestPrev) return null;\n\n    const cur = toNumber(record.values?.primary_value);\n    const prev = toNumber(sameTestPrev.values?.primary_value);\n\n    if (cur === null || prev === null || prev === 0) return null;\n\n    // âœ… å¤‰åŒ–ç‡ï¼ˆpreviousãŒè² ã®ã“ã¨ã¯åŸºæœ¬æƒ³å®šã—ãªã„ãŒã€å¿µã®ãŸã‚absï¼‰\n    return ((cur - prev) / Math.abs(prev)) * 100;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (records.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4\">\n          <Trophy className=\"w-8 h-8 text-gray-400\" />\n        </div>\n        <p className=\"text-gray-600 dark:text-gray-400\">ã¾ã æ¸¬å®šè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>\n        <p className=\"text-sm text-gray-500 dark:text-gray-500 mt-1\">\n          æœ€åˆã®è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã€æˆé•·ã‚’è¿½è·¡ã—ã¾ã—ã‚‡ã†ï¼\n        </p>\n      </div>\n    );\n  }\n\n  const groupedRecords = records.reduce((acc, record) => {\n    if (!record.test_type) return acc;\n\n    const displayName = record.test_type.display_name;\n    if (!acc[displayName]) acc[displayName] = [];\n    acc[displayName].push(record);\n    return acc;\n  }, {} as Record<string, PerformanceRecordWithTest[]>);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          æ¸¬å®šè¨˜éŒ²å±¥æ­´\n        </h3>\n        <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n          å…¨ {records.length} ä»¶\n        </span>\n      </div>\n\n      {Object.entries(groupedRecords).map(([testName, testRecords]) => {\n        const first = testRecords[0];\n        const unit = getUnit(first);\n        const higherIsBetter = !!first.test_type?.higher_is_better;\n\n        return (\n          <div key={testName} className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden transition-colors\">\n            <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 dark:text-white\">{testName}</h4>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\n                    {unit} - {higherIsBetter ? 'é«˜ã„æ–¹ãŒè‰¯ã„' : 'ä½ã„æ–¹ãŒè‰¯ã„'}\n                  </p>\n                </div>\n\n                {first.test_type?.user_can_input === false && (\n                  <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300\">\n                    <Shield className=\"w-3 h-3 mr-1\" />\n                    å°‚é–€æ¥­è€…æ¸¬å®š\n                  </span>\n                )}\n              </div>\n            </div>\n\n            <div className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n              {testRecords.map((record) => {\n                const isPB = isPersonalBest(record);\n                const improvement = getImprovementFromPrevious(record);\n                const name = record.test_type?.name || '';\n                const unitEach = getUnit(record);\n\n                const rawPV = toNumber(record.values?.primary_value);\n                const displayPV = formatCalculatedValue(name, rawPV);\n\n                const goodDirection =\n                  improvement !== null &&\n                  (\n                    (improvement > 0 && record.test_type?.higher_is_better) ||\n                    (improvement < 0 && !record.test_type?.higher_is_better)\n                  );\n\n                const relative1rm = toNumber(record.values?.relative_1rm);\n                const weightAtTest = toNumber(record.values?.weight_at_test);\n\n                return (\n                  <div\n                    key={record.id}\n                    className={`p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors ${\n                      isPB ? 'bg-yellow-50 dark:bg-yellow-900/10 border-l-4 border-yellow-400' : ''\n                    }`}\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <Calendar className=\"w-4 h-4 text-gray-400\" />\n                          <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                            {new Date(record.date).toLocaleDateString('ja-JP', {\n                              year: 'numeric',\n                              month: 'long',\n                              day: 'numeric'\n                            })}\n                          </span>\n                          {isPB && (\n                            <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300\">\n                              <Trophy className=\"w-3 h-3 mr-1\" />\n                              PB\n                            </span>\n                          )}\n                        </div>\n\n                        <div className=\"flex items-baseline space-x-2 mb-2\">\n                          <span className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                            {displayPV}\n                          </span>\n                          <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                            {unitEach}\n                          </span>\n\n                          {improvement !== null && (\n                            <span\n                              className={`text-sm font-medium flex items-center ${\n                                goodDirection\n                                  ? 'text-green-600 dark:text-green-400'\n                                  : 'text-red-600 dark:text-red-400'\n                              }`}\n                            >\n                              {goodDirection ? (\n                                <TrendingUp className=\"w-4 h-4 mr-1\" />\n                              ) : (\n                                <TrendingDown className=\"w-4 h-4 mr-1\" />\n                              )}\n                              {Math.abs(improvement).toFixed(1)}%\n                            </span>\n                          )}\n                        </div>\n\n                        {/* âœ… ç­‹åŠ›æ¸¬å®šã®å ´åˆã€ç›¸å¯¾1RMã‚’è¡¨ç¤ºï¼ˆè¡¨ç¤ºã‚‚çµ±ä¸€ï¼‰ */}\n                        {record.test_type &&\n                          ['bench_press', 'back_squat', 'deadlift', 'bulgarian_squat_r', 'bulgarian_squat_l'].includes(record.test_type.name) &&\n                          relative1rm !== null && (\n                            <div className=\"mb-2 inline-flex items-center px-3 py-1.5 rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20\">\n                              <span className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mr-2\">\n                                ç›¸å¯¾1RM:\n                              </span>\n                              <span className=\"text-lg font-bold text-purple-600 dark:text-purple-400\">\n                                {relative1rm.toFixed(2)}\n                              </span>\n                              {weightAtTest !== null && (\n                                <span className=\"text-xs text-purple-600 dark:text-purple-400 ml-2\">\n                                  (ä½“é‡ {weightAtTest.toFixed(1)} kg)\n                                </span>\n                              )}\n                            </div>\n                          )}\n\n                        {record.test_type && Array.isArray(record.test_type.fields) && (\n                          <div className=\"grid grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-400\">\n                            {record.test_type.fields.map((field: any) => {\n                              const value = record.values?.[field.name];\n                              if (value === undefined || value === null || value === '') return null;\n\n                              return (\n                                <div key={field.name}>\n                                  <span className=\"font-medium\">{field.label}:</span> {value} {field.unit}\n                                </div>\n                              );\n                            })}\n                          </div>\n                        )}\n\n                        {record.notes && (\n                          <div className=\"mt-2 flex items-start space-x-2\">\n                            <FileText className=\"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400\">{record.notes}</p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}","import React, { useMemo } from 'react';\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  ReferenceLine,\n} from 'recharts';\nimport { PerformanceRecordWithTest, PersonalBest } from '../hooks/usePerformanceData';\n\ntype TeamMonthlyPoint = {\n  month_start: string; // 'YYYY-MM-DD'ï¼ˆRPCã¯dateã§è¿”ã‚‹æƒ³å®šï¼‰\n  team_n: number | null;\n  team_avg: number | null;\n};\n\ntype MetricKey = 'primary_value' | 'relative_1rm';\n\ninterface PerformanceChartProps {\n  records: PerformanceRecordWithTest[];\n  personalBest?: PersonalBest;\n  testTypeName?: string;\n\n  // â˜…è¿½åŠ ï¼šã©ã®å€¤ã§æç”»ã™ã‚‹ã‹\n  metricKey?: MetricKey;\n\n  // â˜…è¿½åŠ ï¼šè¡¨ç¤ºå˜ä½ï¼ˆprimary_valueãªã‚‰ \"kg\" / relative_1rmãªã‚‰ \"Ã—BW\" ãªã©ï¼‰\n  unitLabel?: string;\n\n  // â˜…è¿½åŠ ï¼šãƒãƒ¼ãƒ æœˆæ¬¡å¹³å‡ï¼ˆlatest-of-monthï¼‰\n  teamMonthly?: TeamMonthlyPoint[];\n}\n\nexport const PerformanceChart = React.memo(function PerformanceChart({\n  records,\n  personalBest,\n  testTypeName,\n  metricKey = 'primary_value',\n  unitLabel,\n  teamMonthly = [],\n}: PerformanceChartProps) {\n  if (!records || records.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400\">\n        ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“\n      </div>\n    );\n  }\n\n  const sortedRecords = useMemo(\n    () =>\n      [...records].sort(\n        (a, b) => new Date(a.date).getTime() - new Date(b.date).getTime()\n      ),\n    [records]\n  );\n\n  const testType = records[0]?.test_type;\n  const higherIsBetter = testType?.higher_is_better ?? true;\n\n  // å˜ä½ï¼ˆpropså„ªå…ˆã€ãªã‘ã‚Œã° testType.unitã€ç›¸å¯¾1RMãªã‚‰Ã—BWï¼‰\n  const resolvedUnit = useMemo(() => {\n    if (unitLabel) return unitLabel;\n    if (metricKey === 'relative_1rm') return 'Ã—BW';\n    return testType?.unit || '';\n  }, [unitLabel, metricKey, testType?.unit]);\n\n  // å°æ•°ç‚¹æ¡ï¼ˆç›¸å¯¾1RMã¯2æ¡ã€rsiã¯2æ¡ã€ãã‚Œä»¥å¤–ã¯1æ¡ï¼‰\n  const digits = useMemo(() => {\n    if (metricKey === 'relative_1rm') return 2;\n    if (testType?.name?.includes('rsi')) return 2;\n    return 1;\n  }, [metricKey, testType?.name]);\n\n  const getMetricValue = (record: PerformanceRecordWithTest): number | null => {\n    const raw =\n      metricKey === 'relative_1rm'\n        ? (record.values as any)?.relative_1rm\n        : (record.values as any)?.primary_value;\n\n    const num = typeof raw === 'string' ? parseFloat(raw) : raw;\n    return Number.isFinite(num) ? num : null;\n  };\n\n  // å€‹äººã®ç‚¹ï¼ˆãã®æ—¥ï¼‰\n  const athletePoints = useMemo(() => {\n    return sortedRecords.map((record) => {\n      const v = getMetricValue(record);\n\n      return {\n        x: record.date, // ISOã®ã¾ã¾ä¿æŒï¼ˆã‚½ãƒ¼ãƒˆãƒ»tooltipã§æ¥½ï¼‰\n        dateLabel: new Date(record.date).toLocaleDateString('ja-JP', {\n          month: 'short',\n          day: 'numeric',\n        }),\n        value: v,\n        team_avg: null as number | null,\n        team_n: null as number | null,\n        unit: resolvedUnit,\n        notes: record.notes || '',\n        kind: 'athlete' as const,\n      };\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [sortedRecords, metricKey, resolvedUnit]);\n\n  // ãƒãƒ¼ãƒ æœˆæ¬¡å¹³å‡ã®ç‚¹ï¼ˆæœˆåˆï¼‰\n  const teamPoints = useMemo(() => {\n    return (teamMonthly ?? [])\n      .filter((m) => m?.team_avg !== null && m?.team_avg !== undefined)\n      .map((m) => {\n        const iso = typeof m.month_start === 'string' ? m.month_start : String(m.month_start);\n        return {\n          x: iso,\n          dateLabel: new Date(iso).toLocaleDateString('ja-JP', {\n            year: 'numeric',\n            month: 'short',\n          }),\n          value: null as number | null,\n          team_avg: m.team_avg as number | null,\n          team_n: m.team_n ?? null,\n          unit: resolvedUnit,\n          notes: '',\n          kind: 'team' as const,\n        };\n      });\n  }, [teamMonthly, resolvedUnit]);\n\n  // ãƒãƒ¼ã‚¸ã—ã¦æ™‚ç³»åˆ—ã«ä¸¦ã¹ã‚‹\n  const chartData = useMemo(() => {\n    const merged = [...athletePoints, ...teamPoints].sort(\n      (a, b) => new Date(a.x).getTime() - new Date(b.x).getTime()\n    );\n\n    return merged.map((d) => ({\n      ...d,\n      date:\n        d.kind === 'team'\n          ? d.dateLabel // ä¾‹ï¼š2026å¹´1æœˆ\n          : new Date(d.x).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' }),\n      fullDate: d.x,\n    }));\n  }, [athletePoints, teamPoints]);\n\n  // Yè»¸ãƒ¬ãƒ³ã‚¸ï¼švalue / team_avg ä¸¡æ–¹ã‹ã‚‰è¨ˆç®—\n  const numericValues = useMemo(() => {\n    const arr: number[] = [];\n    for (const d of chartData as any[]) {\n      if (typeof d.value === 'number' && Number.isFinite(d.value)) arr.push(d.value);\n      if (typeof d.team_avg === 'number' && Number.isFinite(d.team_avg)) arr.push(d.team_avg);\n    }\n    return arr.length ? arr : [0];\n  }, [chartData]);\n\n  const minValue = Math.min(...numericValues);\n  const maxValue = Math.max(...numericValues);\n  const valueRange = maxValue - minValue || 1;\n  const yAxisMin = Math.max(0, minValue - valueRange * 0.1);\n  const yAxisMax = maxValue + valueRange * 0.1;\n\n  const CustomTooltip = ({ active, payload }: any) => {\n    if (active && payload && payload.length) {\n      const data = payload[0].payload;\n\n      return (\n        <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-3\">\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white mb-2\">\n            {new Date(data.fullDate).toLocaleDateString('ja-JP', {\n              year: 'numeric',\n              month: 'long',\n              day: 'numeric',\n            })}\n          </p>\n\n          {data.value !== null && data.value !== undefined && (\n            <p className=\"text-lg font-bold text-blue-600 dark:text-blue-400\">\n              å€‹äºº: {Number(data.value).toFixed(digits)} {resolvedUnit}\n            </p>\n          )}\n\n          {data.team_avg !== null && data.team_avg !== undefined && (\n            <p className=\"text-sm font-semibold text-indigo-600 dark:text-indigo-300 mt-1\">\n              ãƒãƒ¼ãƒ æœˆæ¬¡å¹³å‡: {Number(data.team_avg).toFixed(digits)} {resolvedUnit}\n              {data.team_n ? (\n                <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2\">(n={data.team_n})</span>\n              ) : null}\n            </p>\n          )}\n\n          {data.notes && (\n            <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-2 max-w-xs\">\n              {data.notes}\n            </p>\n          )}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  // ä¸‹éƒ¨ã‚µãƒãƒªç”¨ï¼šå€‹äººã®æœ‰åŠ¹å€¤ã ã‘\n  const athleteOnlyValues = useMemo(() => {\n    return athletePoints\n      .map((d) => (typeof d.value === 'number' && Number.isFinite(d.value) ? d.value : null))\n      .filter((v): v is number => v !== null);\n  }, [athletePoints]);\n\n  const latestAthleteValue = useMemo(() => {\n    // athletePointsã¯æ—¥ä»˜æ˜‡é †ãªã®ã§æœ€å¾ŒãŒæœ€æ–°ï¼ˆvalue nullã®å¯èƒ½æ€§ã¯ã‚ã‚‹ã®ã§é€†èµ°æŸ»ï¼‰\n    for (let i = athletePoints.length - 1; i >= 0; i--) {\n      const v = athletePoints[i]?.value;\n      if (typeof v === 'number' && Number.isFinite(v)) return v;\n    }\n    return null;\n  }, [athletePoints]);\n\n  const bestValue = useMemo(() => {\n    if (!athleteOnlyValues.length) return null;\n    return higherIsBetter ? Math.max(...athleteOnlyValues) : Math.min(...athleteOnlyValues);\n  }, [athleteOnlyValues, higherIsBetter]);\n\n  return (\n    <div className=\"w-full\">\n      {testTypeName && (\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n          {testTypeName} ã®æ¨ç§»\n        </h3>\n      )}\n\n      {personalBest && (\n        <div className=\"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800\">\n          <p className=\"text-sm text-yellow-800 dark:text-yellow-200\">\n            <span className=\"font-semibold\">ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆ:</span>{' '}\n            {personalBest.value.toFixed(digits)} {resolvedUnit}\n            <span className=\"text-xs ml-2\">\n              ({new Date(personalBest.date).toLocaleDateString('ja-JP')})\n            </span>\n          </p>\n        </div>\n      )}\n\n      <ResponsiveContainer width=\"100%\" height={400}>\n        <LineChart data={chartData as any[]} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-gray-200 dark:stroke-gray-700\" />\n          <XAxis dataKey=\"date\" className=\"text-xs\" stroke=\"#9CA3AF\" tick={{ fill: '#9CA3AF' }} />\n          <YAxis\n            domain={[yAxisMin, yAxisMax]}\n            className=\"text-xs\"\n            stroke=\"#9CA3AF\"\n            tick={{ fill: '#9CA3AF' }}\n            label={{\n              value: resolvedUnit || '',\n              angle: -90,\n              position: 'insideLeft',\n              style: { fill: '#9CA3AF', fontSize: '12px' },\n            }}\n          />\n          <Tooltip content={<CustomTooltip />} />\n          <Legend wrapperStyle={{ paddingTop: '20px' }} iconType=\"line\" />\n\n          {personalBest && (\n            <ReferenceLine\n              y={personalBest.value}\n              stroke=\"#F59E0B\"\n              strokeDasharray=\"5 5\"\n              label={{\n                value: 'PB',\n                position: 'right',\n                fill: '#F59E0B',\n                fontSize: 12,\n                fontWeight: 'bold',\n              }}\n            />\n          )}\n\n          {/* â˜…å€‹äººãƒ©ã‚¤ãƒ³ */}\n          <Line\n            type=\"monotone\"\n            dataKey=\"value\"\n            name={metricKey === 'relative_1rm' ? 'å€‹äººï¼ˆç›¸å¯¾ï¼‰' : (testType?.display_name || 'å€‹äºº')}\n            stroke=\"#3B82F6\"\n            strokeWidth={3}\n            dot={{ r: 5, fill: '#3B82F6', strokeWidth: 2, stroke: '#fff' }}\n            activeDot={{ r: 7, fill: '#2563EB', strokeWidth: 2, stroke: '#fff' }}\n            connectNulls={false}\n          />\n\n          {/* â˜…ãƒãƒ¼ãƒ æœˆæ¬¡å¹³å‡ãƒ©ã‚¤ãƒ³ */}\n          {teamMonthly?.length > 0 && (\n            <Line\n              type=\"monotone\"\n              dataKey=\"team_avg\"\n              name={metricKey === 'relative_1rm' ? 'ãƒãƒ¼ãƒ æœˆæ¬¡å¹³å‡ï¼ˆç›¸å¯¾/æœ€æ–°ï¼‰' : 'ãƒãƒ¼ãƒ æœˆæ¬¡å¹³å‡ï¼ˆæœ€æ–°ï¼‰'}\n              stroke=\"#6366F1\"\n              strokeWidth={2}\n              dot={{ r: 3 }}\n              activeDot={{ r: 5 }}\n              connectNulls={true}\n              strokeDasharray=\"4 4\"\n            />\n          )}\n        </LineChart>\n      </ResponsiveContainer>\n\n      {athleteOnlyValues.length > 1 && (\n        <div className=\"mt-4 grid grid-cols-3 gap-4\">\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3\">\n            <p className=\"text-xs text-blue-600 dark:text-blue-400 mb-1\">æœ€æ–°è¨˜éŒ²</p>\n            <p className=\"text-lg font-bold text-blue-700 dark:text-blue-300\">\n              {latestAthleteValue !== null ? Number(latestAthleteValue).toFixed(digits) : '-'} {resolvedUnit}\n            </p>\n          </div>\n\n          <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-3\">\n            <p className=\"text-xs text-green-600 dark:text-green-400 mb-1\">\n              {higherIsBetter ? 'æœ€é«˜' : 'æœ€ä½'}è¨˜éŒ²\n            </p>\n            <p className=\"text-lg font-bold text-green-700 dark:text-green-300\">\n              {bestValue !== null ? Number(bestValue).toFixed(digits) : '-'} {resolvedUnit}\n            </p>\n          </div>\n\n          <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3\">\n            <p className=\"text-xs text-purple-600 dark:text-purple-400 mb-1\">æ¸¬å®šå›æ•°</p>\n            <p className=\"text-lg font-bold text-purple-700 dark:text-purple-300\">\n              {athleteOnlyValues.length} å›\n            </p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n});","import React, { useEffect, useMemo, useState } from 'react';\nimport { Trophy, TrendingUp, Calendar } from 'lucide-react';\nimport { PerformanceRecordWithTest, PersonalBest } from '../hooks/usePerformanceData';\nimport { PerformanceTestType } from '../lib/supabase';\nimport { PerformanceChart } from './PerformanceChart';\nimport { supabase } from '../lib/supabase';\nimport { getCalculatedUnit } from '../lib/performanceCalculations';\n\ntype TeamBenchmarkRow = {\n  test_type_id: string;\n  my_date: string | null;\n  my_value: number | null;\n  team_n: number | null;\n  team_avg: number | null;\n  team_sd: number | null;\n  diff_vs_team_avg: number | null; // ãƒ—ãƒ©ã‚¹=è‰¯ã„ï¼ˆRPCå´ã§èª¿æ•´æ¸ˆã¿ï¼‰\n  team_rank: number | null;\n  team_top_percent: number | null; // 0ã«è¿‘ã„ã»ã©ä¸Šä½ï¼ˆä¾‹: 12.5ï¼‰\n};\n\ntype MetricKey = 'primary_value' | 'relative_1rm';\n\ntype TeamMonthlyPoint = {\n  month_start: string;\n  team_n: number | null;\n  team_avg: number | null;\n};\n\n// âœ… å¿…ãšãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§å®šç¾©ï¼ˆReferenceErrorå›é¿ï¼‰\nfunction buildPersonalBestFromRecords(\n  recs: PerformanceRecordWithTest[],\n  metricKey: MetricKey,\n  higherIsBetter: boolean\n): PersonalBest | undefined {\n  let best: { value: number; date: string } | null = null;\n\n  for (const r of recs) {\n    const raw = (r as any)?.values?.[metricKey];\n    const v = typeof raw === 'string' ? parseFloat(raw) : raw;\n    if (v === null || v === undefined || Number.isNaN(v)) continue;\n\n    if (!best) {\n      best = { value: v, date: r.date };\n      continue;\n    }\n\n    const better = higherIsBetter ? v > best.value : v < best.value;\n    if (better) best = { value: v, date: r.date };\n  }\n\n  return best ? { value: best.value, date: best.date } : undefined;\n}\n\n// âœ… RPCã®è¿”å´ã‚«ãƒ©ãƒ åãŒå¤šå°‘é•ã£ã¦ã‚‚å¸åã™ã‚‹ï¼ˆå®‰å…¨ç­–ï¼‰\nfunction normalizeMonthlyRows(rows: any[]): TeamMonthlyPoint[] {\n  return (rows ?? [])\n    .map((r: any) => {\n      const month_start =\n        r?.month_start ??\n        r?.month ??\n        r?.month_start_date ??\n        r?.month_start_at ??\n        r?.month_begin ??\n        null;\n\n      const team_avg =\n        r?.team_avg ??\n        r?.avg ??\n        r?.mean ??\n        r?.team_mean ??\n        null;\n\n      const team_n =\n        r?.team_n ??\n        r?.n ??\n        r?.count ??\n        null;\n\n      if (!month_start) return null;\n\n      return {\n        month_start: String(month_start),\n        team_avg: team_avg === null || team_avg === undefined ? null : Number(team_avg),\n        team_n: team_n === null || team_n === undefined ? null : Number(team_n),\n      } as TeamMonthlyPoint;\n    })\n    .filter(Boolean) as TeamMonthlyPoint[];\n}\n\ninterface PerformanceOverviewProps {\n  testTypes: PerformanceTestType[];\n  records: PerformanceRecordWithTest[];\n  personalBests: PersonalBest[];\n  getRecordsByTestType: (testTypeId: string) => PerformanceRecordWithTest[];\n  getPersonalBest: (testTypeId: string) => PersonalBest | undefined;\n}\n\nexport function PerformanceOverview({\n  testTypes,\n  records,\n  personalBests,\n  getRecordsByTestType,\n  getPersonalBest,\n}: PerformanceOverviewProps) {\n  const [selectedTestTypeId, setSelectedTestTypeId] = useState<string | null>(null);\n\n  // â˜…ãƒãƒ¼ãƒ æœˆæ¬¡å¹³å‡\n  const [teamMonthlyAbsByTestId, setTeamMonthlyAbsByTestId] = useState<Record<string, TeamMonthlyPoint[]>>({});\n  const [teamMonthlyRelByTestId, setTeamMonthlyRelByTestId] = useState<Record<string, TeamMonthlyPoint[]>>({});\n\n  // â˜…ãƒãƒ¼ãƒ ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯\n  const [teamBenchAbsByTestId, setTeamBenchAbsByTestId] = useState<Record<string, TeamBenchmarkRow>>({});\n  const [teamBenchRelByTestId, setTeamBenchRelByTestId] = useState<Record<string, TeamBenchmarkRow>>({});\n  const [benchLoading, setBenchLoading] = useState(false);\n\n  const strengthTests = ['bench_press', 'back_squat', 'deadlift', 'bulgarian_squat_r', 'bulgarian_squat_l'];\n  const [benchMetricByTestId, setBenchMetricByTestId] = useState<Record<string, MetricKey>>({});\n\n  // é¸æŠä¸­ç¨®ç›®\n  const selectedTestType = useMemo(() => {\n    return selectedTestTypeId ? testTypes.find((t) => t.id === selectedTestTypeId) : null;\n  }, [selectedTestTypeId, testTypes]);\n\n  const selectedRecords = useMemo(() => {\n    return selectedTestTypeId ? getRecordsByTestType(selectedTestTypeId) : [];\n  }, [selectedTestTypeId, getRecordsByTestType]);\n\n  // âœ… é¸æŠä¸­ã® metricï¼ˆç­‹åŠ›ä»¥å¤–ã¯ primaryå›ºå®šï¼‰\n  const selectedMetric: MetricKey = useMemo(() => {\n    if (!selectedTestTypeId) return 'primary_value';\n    if (!selectedTestType) return 'primary_value';\n    if (!strengthTests.includes(selectedTestType.name)) return 'primary_value';\n    return benchMetricByTestId[selectedTestTypeId] ?? 'primary_value';\n  }, [selectedTestTypeId, selectedTestType, benchMetricByTestId]);\n\n  // âœ… PBã‚’ã€Œè¡¨ç¤ºä¸­metricã€ã§ä½œã‚Šç›´ã™ï¼ˆä¸Šã®è¡¨è¨˜ã‚ºãƒ¬å¯¾ç­–ï¼‰\n  const selectedPB = useMemo(() => {\n    if (!selectedTestType || selectedRecords.length === 0) return undefined;\n    const higherIsBetter = selectedTestType.higher_is_better ?? true;\n    return buildPersonalBestFromRecords(selectedRecords, selectedMetric, higherIsBetter);\n  }, [selectedTestType, selectedRecords, selectedMetric]);\n\n  // åˆæœŸï¼šãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å–å¾—ï¼ˆabs/relï¼‰\n  useEffect(() => {\n    if (!records || records.length === 0) return;\n\n    let cancelled = false;\n\n    (async () => {\n      try {\n        setBenchLoading(true);\n\n        const [{ data: abs, error: e1 }, { data: rel, error: e2 }] = await Promise.all([\n          supabase.rpc('get_my_team_benchmarks', { p_days: 90, p_metric: 'primary_value' }),\n          supabase.rpc('get_my_team_benchmarks', { p_days: 90, p_metric: 'relative_1rm' }),\n        ]);\n        if (e1) throw e1;\n        if (e2) throw e2;\n\n        const absMap: Record<string, TeamBenchmarkRow> = {};\n        (abs ?? []).forEach((row: any) => {\n          if (row?.test_type_id) absMap[row.test_type_id] = row as TeamBenchmarkRow;\n        });\n\n        const relMap: Record<string, TeamBenchmarkRow> = {};\n        (rel ?? []).forEach((row: any) => {\n          if (row?.test_type_id) relMap[row.test_type_id] = row as TeamBenchmarkRow;\n        });\n\n        if (!cancelled) {\n          setTeamBenchAbsByTestId(absMap);\n          setTeamBenchRelByTestId(relMap);\n        }\n      } catch (e) {\n        console.warn('[get_my_team_benchmarks error]', e);\n        if (!cancelled) {\n          setTeamBenchAbsByTestId({});\n          setTeamBenchRelByTestId({});\n        }\n      } finally {\n        if (!cancelled) setBenchLoading(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [records?.length]);\n\n  // âœ… æœˆæ¬¡å¹³å‡ï¼šå­˜åœ¨ã™ã‚‹RPCã«åˆã‚ã›ã¦å–å¾—ï¼ˆmetric ã‚ã‚Šï¼‰\n  useEffect(() => {\n    if (!selectedTestTypeId) return;\n\n    let cancelled = false;\n\n    (async () => {\n      try {\n        // â˜…ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆï¼šget_my_team_monthly_averages ã‚’ä½¿ã†ï¼ˆp_metricã‚ã‚Šï¼‰\n        const { data, error } = await supabase.rpc('get_my_team_monthly_averages', {\n          p_test_type_id: selectedTestTypeId,\n          p_metric: selectedMetric,\n          p_months: 6,\n        });\n\n        if (error) throw error;\n        if (cancelled) return;\n\n        const normalized = normalizeMonthlyRows(data ?? []);\n\n        if (selectedMetric === 'relative_1rm') {\n          setTeamMonthlyRelByTestId((prev) => ({ ...prev, [selectedTestTypeId]: normalized }));\n        } else {\n          setTeamMonthlyAbsByTestId((prev) => ({ ...prev, [selectedTestTypeId]: normalized }));\n        }\n      } catch (e) {\n        console.warn('[get_my_team_monthly_averages error]', e);\n        if (cancelled) return;\n\n        if (selectedMetric === 'relative_1rm') {\n          setTeamMonthlyRelByTestId((prev) => ({ ...prev, [selectedTestTypeId]: [] }));\n        } else {\n          setTeamMonthlyAbsByTestId((prev) => ({ ...prev, [selectedTestTypeId]: [] }));\n        }\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [selectedTestTypeId, selectedMetric]);\n\n  if (records.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-8 text-center transition-colors\">\n        <div className=\"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-full mb-4\">\n          <Trophy className=\"w-10 h-10 text-blue-600 dark:text-blue-400\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-2\">æ¸¬å®šã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼</h3>\n        <p className=\"text-gray-600 dark:text-gray-400\">æœ€åˆã®æ¸¬å®šã‚’è¨˜éŒ²ã—ã¦ã€æˆé•·ã‚’è¿½è·¡ã—ã¾ã—ã‚‡ã†ã€‚</p>\n      </div>\n    );\n  }\n\n  const unitFor = (testType: PerformanceTestType) => getCalculatedUnit(testType.name || '') || testType.unit;\n\n  const formatValue = (value: any, testTypeName: string) => {\n    const num = typeof value === 'string' ? parseFloat(value) : value;\n    if (num === null || num === undefined || Number.isNaN(num)) return '-';\n    return num.toFixed(testTypeName.includes('rsi') ? 2 : 1);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Personal Bests Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {testTypes.map((testType) => {\n          const pb = getPersonalBest(testType.id);\n          const testRecords = getRecordsByTestType(testType.id);\n          const latestRecord = testRecords[0];\n\n          const metric: MetricKey =\n            strengthTests.includes(testType.name) ? (benchMetricByTestId[testType.id] ?? 'primary_value') : 'primary_value';\n\n          const bench =\n            metric === 'relative_1rm' ? teamBenchRelByTestId[testType.id] : teamBenchAbsByTestId[testType.id];\n\n          const showBench = !!bench && !!bench.team_n && bench.team_n >= 2;\n\n          const suffix = metric === 'relative_1rm' ? 'Ã—BW' : unitFor(testType);\n          const digits = testType.name.includes('rsi') ? 2 : 1;\n          const fmt = (v: any) => (v === null || v === undefined ? '-' : Number(v).toFixed(digits));\n\n          return (\n            <button\n              key={testType.id}\n              onClick={() => setSelectedTestTypeId(testType.id)}\n              className={`bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 text-left transition-all hover:shadow-md ${\n                selectedTestTypeId === testType.id ? 'ring-2 ring-blue-500 dark:ring-blue-400' : ''\n              }`}\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <h4 className=\"font-semibold text-gray-900 dark:text-white text-sm\">{testType.display_name}</h4>\n                {pb && <Trophy className=\"w-5 h-5 text-yellow-500 flex-shrink-0\" />}\n              </div>\n\n              {pb ? (\n                <>\n                  <div className=\"mb-2\">\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆ</p>\n                    <p className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">\n                      {pb.value.toFixed(testType.name.includes('rsi') ? 2 : 1)}\n                      <span className=\"text-sm ml-1 text-gray-600 dark:text-gray-400\">{unitFor(testType)}</span>\n                    </p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">{new Date(pb.date).toLocaleDateString('ja-JP')}</p>\n                  </div>\n\n                  {latestRecord && latestRecord.date !== pb.date && (\n                    <div className=\"pt-2 border-t border-gray-200 dark:border-gray-700\">\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">æœ€æ–°è¨˜éŒ²</p>\n                      <p className=\"text-lg font-semibold text-blue-600 dark:text-blue-400\">\n                        {formatValue(latestRecord.values.primary_value, testType.name)}\n                        <span className=\"text-xs ml-1 text-gray-600 dark:text-gray-400\">{unitFor(testType)}</span>\n                      </p>\n                    </div>\n                  )}\n                </>\n              ) : testRecords.length > 0 ? (\n                <div>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">æœ€æ–°è¨˜éŒ²</p>\n                  <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                    {formatValue(latestRecord.values.primary_value, testType.name)}\n                    <span className=\"text-sm ml-1 text-gray-600 dark:text-gray-400\">{unitFor(testType)}</span>\n                  </p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">{new Date(latestRecord.date).toLocaleDateString('ja-JP')}</p>\n                </div>\n              ) : (\n                <div className=\"text-center py-4\">\n                  <p className=\"text-sm text-gray-400 dark:text-gray-500\">æœªæ¸¬å®š</p>\n                </div>\n              )}\n\n              {/* ãƒãƒ¼ãƒ æ¯”è¼ƒ */}\n              {testRecords.length > 0 && (\n                <div className=\"mt-3\">\n                  {strengthTests.includes(testType.name) && (\n                    <div className=\"mb-2 inline-flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1 text-[11px]\">\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.preventDefault();\n                          e.stopPropagation();\n                          setBenchMetricByTestId((prev) => ({ ...prev, [testType.id]: 'primary_value' }));\n                        }}\n                        className={`px-2 py-1 rounded-md ${\n                          (benchMetricByTestId[testType.id] ?? 'primary_value') === 'primary_value'\n                            ? 'bg-white dark:bg-gray-800 shadow text-gray-900 dark:text-white'\n                            : 'text-gray-600 dark:text-gray-300'\n                        }`}\n                      >\n                        æ¨å®š1RM\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.preventDefault();\n                          e.stopPropagation();\n                          setBenchMetricByTestId((prev) => ({ ...prev, [testType.id]: 'relative_1rm' }));\n                        }}\n                        className={`px-2 py-1 rounded-md ${\n                          (benchMetricByTestId[testType.id] ?? 'primary_value') === 'relative_1rm'\n                            ? 'bg-white dark:bg-gray-800 shadow text-gray-900 dark:text-white'\n                            : 'text-gray-600 dark:text-gray-300'\n                        }`}\n                      >\n                        ç›¸å¯¾1RM\n                      </button>\n                    </div>\n                  )}\n\n                  {showBench ? (\n                    <div className=\"flex flex-wrap gap-2\">\n                      {bench.team_avg !== null && bench.team_avg !== undefined && (\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200\">\n                          ãƒãƒ¼ãƒ å¹³å‡ {fmt(bench.team_avg)}\n                          {suffix}\n                        </span>\n                      )}\n\n                      {bench.diff_vs_team_avg !== null && bench.diff_vs_team_avg !== undefined && (\n                        <span\n                          className={`inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium ${\n                            bench.diff_vs_team_avg >= 0\n                              ? 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-200'\n                              : 'bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-200'\n                          }`}\n                        >\n                          å¹³å‡å·® {bench.diff_vs_team_avg >= 0 ? '+' : ''}\n                          {fmt(bench.diff_vs_team_avg)}\n                          {suffix}\n                        </span>\n                      )}\n\n                      {bench.team_rank !== null && bench.team_rank !== undefined && bench.team_n && (\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-200\">\n                          {bench.team_n}äººä¸­ {bench.team_rank}ä½\n                        </span>\n                      )}\n\n                      {bench.team_top_percent !== null && bench.team_top_percent !== undefined && (\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200\">\n                          ä¸Šä½ {Number(bench.team_top_percent).toFixed(1)}%\n                        </span>\n                      )}\n\n                      {bench.team_n && bench.team_n < 10 && (\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300\">\n                          å‚è€ƒï¼ˆnå°‘ï¼‰\n                        </span>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"text-[11px] text-gray-500 dark:text-gray-400\">\n                      {benchLoading ? 'ãƒãƒ¼ãƒ æ¯”è¼ƒã‚’è¨ˆç®—ä¸­â€¦' : 'ãƒãƒ¼ãƒ æ¯”è¼ƒã¯ãƒ‡ãƒ¼ã‚¿ä¸è¶³ï¼ˆn<2ï¼‰'}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {testRecords.length > 0 && (\n                <div className=\"mt-3 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400\">\n                  <span className=\"flex items-center\">\n                    <Calendar className=\"w-3 h-3 mr-1\" />\n                    {testRecords.length}å›æ¸¬å®š\n                  </span>\n                  {testRecords.length > 1 && (\n                    <span className=\"flex items-center text-blue-600 dark:text-blue-400\">\n                      <TrendingUp className=\"w-3 h-3 mr-1\" />\n                      ã‚°ãƒ©ãƒ•ã‚’è¦‹ã‚‹\n                    </span>\n                  )}\n                </div>\n              )}\n            </button>\n          );\n        })}\n      </div>\n\n      {/* Selected Test Type Chart */}\n      {selectedTestType && selectedRecords.length > 0 && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {selectedTestType.display_name} ã®æˆé•·ã‚°ãƒ©ãƒ•\n              </h3>\n\n              {(() => {\n                const bench =\n                  selectedMetric === 'relative_1rm'\n                    ? teamBenchRelByTestId[selectedTestType.id]\n                    : teamBenchAbsByTestId[selectedTestType.id];\n\n                const showBench = !!bench && !!bench.team_n && bench.team_n >= 2;\n                if (!showBench) return null;\n\n                const suffix = selectedMetric === 'relative_1rm' ? 'Ã—BW' : unitFor(selectedTestType);\n                const digits = selectedTestType.name.includes('rsi') ? 2 : 1;\n                const fmt = (v: any) => (v === null || v === undefined ? '-' : Number(v).toFixed(digits));\n\n                return (\n                  <p className=\"mt-1 text-xs text-gray-600 dark:text-gray-400\">\n                    ãƒãƒ¼ãƒ å¹³å‡: {fmt(bench.team_avg)}\n                    {suffix} / {bench.team_n}äººä¸­ {bench.team_rank ?? '-'}ä½ï¼ˆä¸Šä½{' '}\n                    {bench.team_top_percent !== null && bench.team_top_percent !== undefined\n                      ? Number(bench.team_top_percent).toFixed(1)\n                      : '-'}\n                    %ï¼‰\n                  </p>\n                );\n              })()}\n            </div>\n\n            <button\n              onClick={() => setSelectedTestTypeId(null)}\n              className=\"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300\"\n            >\n              é–‰ã˜ã‚‹\n            </button>\n          </div>\n\n          <PerformanceChart\n            records={selectedRecords}\n            personalBest={selectedPB}\n            testTypeName={selectedTestType.display_name}\n            metricKey={selectedMetric}\n            unitLabel={selectedMetric === 'relative_1rm' ? 'Ã—BW' : unitFor(selectedTestType)}\n            teamMonthly={\n              selectedMetric === 'relative_1rm'\n                ? (teamMonthlyRelByTestId[selectedTestType.id] ?? [])\n                : (teamMonthlyAbsByTestId[selectedTestType.id] ?? [])\n            }\n          />\n        </div>\n      )}\n\n      {/* Summary Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-xl p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-blue-700 dark:text-blue-300 mb-1\">ç·æ¸¬å®šå›æ•°</p>\n              <p className=\"text-3xl font-bold text-blue-900 dark:text-blue-100\">{records.length}</p>\n            </div>\n            <Calendar className=\"w-10 h-10 text-blue-600 dark:text-blue-400 opacity-50\" />\n          </div>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/30 rounded-xl p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-yellow-700 dark:text-yellow-300 mb-1\">ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆ</p>\n              <p className=\"text-3xl font-bold text-yellow-900 dark:text-yellow-100\">{personalBests.length}</p>\n            </div>\n            <Trophy className=\"w-10 h-10 text-yellow-600 dark:text-yellow-400 opacity-50\" />\n          </div>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 rounded-xl p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-green-700 dark:text-green-300 mb-1\">æ¸¬å®šç¨®ç›®</p>\n              <p className=\"text-3xl font-bold text-green-900 dark:text-green-100\">\n                {testTypes.filter((t) => getRecordsByTestType(t.id).length > 0).length}\n              </p>\n              <p className=\"text-xs text-green-600 dark:text-green-400\">/ {testTypes.length}</p>\n            </div>\n            <TrendingUp className=\"w-10 h-10 text-green-600 dark:text-green-400 opacity-50\" />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useEffect } from 'react';\nimport confetti from 'canvas-confetti';\nimport { Trophy, TrendingUp, Zap } from 'lucide-react';\nimport { formatCalculatedValue } from '../lib/performanceCalculations';\n\ninterface PersonalBestCelebrationProps {\n  // è¡¨ç¤ºåï¼ˆä¾‹ï¼šDJ RSIï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ã‚¸ãƒ£ãƒ³ãƒ—ï¼‰ï¼‰\n  testName: string;\n\n  // âœ… å†…éƒ¨åï¼ˆDBã®nameï¼šdj_rsi / yoyo_ir2 / cooper_test ãªã©ï¼‰\n  testTypeName?: string;\n\n  value: number;\n  unit: string;\n  previousBest?: number;\n  onClose: () => void;\n}\n\nexport function PersonalBestCelebration({\n  testName,\n  testTypeName,\n  value,\n  unit,\n  previousBest,\n  onClose\n}: PersonalBestCelebrationProps) {\n  useEffect(() => {\n    const duration = 3000;\n    const animationEnd = Date.now() + duration;\n    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };\n\n    function randomInRange(min: number, max: number) {\n      return Math.random() * (max - min) + min;\n    }\n\n    const interval: any = setInterval(function () {\n      const timeLeft = animationEnd - Date.now();\n\n      if (timeLeft <= 0) {\n        return clearInterval(interval);\n      }\n\n      const particleCount = 50 * (timeLeft / duration);\n\n      confetti({\n        ...defaults,\n        particleCount,\n        origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }\n      });\n      confetti({\n        ...defaults,\n        particleCount,\n        origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }\n      });\n    }, 250);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  // å‰å›æ¯”ï¼ˆæŒ™å‹•ç¶­æŒï¼šå°ã•ã„ã»ã©è‰¯ã„ç¨®ç›®ã¸ã®å¯¾å¿œã¯åˆ¥é€”ï¼‰\n  const improvement = previousBest ? ((value - previousBest) / previousBest) * 100 : null;\n\n  // âœ… è¡¨ç¤ºå€¤ã¯ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«çµ±ä¸€ï¼ˆå†…éƒ¨åã§åˆ¤å®šã™ã‚‹ï¼‰\n  const keyName = (testTypeName || '').trim() || (testName || '').trim();\n  const displayValue = formatCalculatedValue(keyName, value);\n\n  // âœ… improvement ã¯%ãªã®ã§å°æ•°1æ¡\n  const displayImprovement = improvement !== null ? improvement.toFixed(1) : null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\n      <div className=\"bg-gradient-to-br from-yellow-50 via-yellow-100 to-orange-100 dark:from-yellow-900/40 dark:via-yellow-800/40 dark:to-orange-900/40 rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform animate-scale-up border-4 border-yellow-400 dark:border-yellow-600\">\n        <div className=\"text-center\">\n          <div className=\"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mb-6 animate-bounce-slow shadow-lg\">\n            <Trophy className=\"w-12 h-12 text-white\" />\n          </div>\n\n          <h2 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2 animate-fade-in\">\n            ğŸ‰ ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆæ›´æ–°ï¼\n          </h2>\n\n          <p className=\"text-lg text-gray-700 dark:text-gray-200 mb-6\">\n            {testName}\n          </p>\n\n          <div className=\"bg-white/80 dark:bg-gray-800/80 rounded-xl p-6 mb-6 shadow-inner\">\n            <div className=\"flex items-center justify-center space-x-3 mb-4\">\n              <Zap className=\"w-8 h-8 text-yellow-500 animate-pulse\" />\n              <div className=\"text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-orange-600 dark:from-yellow-400 dark:to-orange-400\">\n                {displayValue}\n              </div>\n              <span className=\"text-2xl text-gray-600 dark:text-gray-300\">{unit}</span>\n            </div>\n\n            {displayImprovement !== null && (\n              <div className=\"flex items-center justify-center space-x-2 text-green-600 dark:text-green-400\">\n                <TrendingUp className=\"w-5 h-5\" />\n                <span className=\"text-lg font-semibold\">\n                  å‰å›æ¯” +{displayImprovement}%\n                </span>\n              </div>\n            )}\n          </div>\n\n          <div className=\"space-y-2 mb-6\">\n            <p className=\"text-gray-700 dark:text-gray-300 font-medium\">\n              ç´ æ™´ã‚‰ã—ã„æˆæœã§ã™ï¼\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n              æ—¥ã€…ã®åŠªåŠ›ãŒå®Ÿã‚’çµã³ã¾ã—ãŸã€‚ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼\n            </p>\n          </div>\n\n          <button\n            onClick={onClose}\n            className=\"w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg\"\n            style={{\n              WebkitTapHighlightColor: 'transparent',\n              touchAction: 'manipulation'\n            }}\n          >\n            ç¶šã‘ã‚‹\n          </button>\n        </div>\n      </div>\n\n      <style>{`\n        @keyframes scale-up {\n          from { transform: scale(0.8); opacity: 0; }\n          to { transform: scale(1); opacity: 1; }\n        }\n        @keyframes bounce-slow {\n          0%, 100% { transform: translateY(0); }\n          50% { transform: translateY(-10px); }\n        }\n        @keyframes fade-in {\n          from { opacity: 0; transform: translateY(-10px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        .animate-scale-up { animation: scale-up 0.4s ease-out; }\n        .animate-bounce-slow { animation: bounce-slow 2s infinite; }\n        .animate-fade-in { animation: fade-in 0.6s ease-out; }\n      `}</style>\n    </div>\n  );\n}","// src/components/views/AthletePerformanceView.tsx\nimport React, { useCallback, useMemo, useState } from \"react\";\nimport type { Database } from \"../../lib/database.types\";\n\nimport { usePerformanceData } from \"../../hooks/usePerformanceData\";\n\nimport { PerformanceRecordForm } from \"../PerformanceRecordForm\";\nimport { PerformanceRecordsList } from \"../PerformanceRecordsList\";\nimport { PerformanceOverview } from \"../PerformanceOverview\";\nimport { PersonalBestCelebration } from \"../PersonalBestCelebration\";\n\nimport { ArrowLeft, Zap } from \"lucide-react\";\n\ntype UserProfile = Database[\"public\"][\"Tables\"][\"users\"][\"Row\"];\n\ntype PerformanceCategory = \"jump\" | \"endurance\" | \"strength\" | \"sprint\" | \"agility\";\n\ntype Props = {\n  user: UserProfile;\n  onBackHome: () => void;\n};\n\nexport default function AthletePerformanceView({ user, onBackHome }: Props) {\n  const [performanceCategory, setPerformanceCategory] = useState<PerformanceCategory>(\"jump\");\n\n  const {\n    testTypes: performanceTestTypes,\n    records: performanceRecords,\n    personalBests,\n    loading: performanceLoading,\n    addRecord: addPerformanceRecord,\n    updateRecord: updatePerformanceRecord,\n    checkExistingRecord,\n    getRecordsByTestType,\n    getPersonalBest,\n  } = usePerformanceData(user.id, performanceCategory);\n\n  const [celebrationData, setCelebrationData] = useState<{\n    testName: string;\n    value: number;\n    unit: string;\n    previousBest?: number;\n  } | null>(null);\n\n  const getCategoryDisplayName = useCallback((category: PerformanceCategory) => {\n    switch (category) {\n      case \"jump\":\n        return \"ã‚¸ãƒ£ãƒ³ãƒ—æ¸¬å®š\";\n      case \"endurance\":\n        return \"å…¨èº«æŒä¹…åŠ›æ¸¬å®š\";\n      case \"strength\":\n        return \"ç­‹åŠ›æ¸¬å®š\";\n      case \"sprint\":\n        return \"ã‚¹ãƒ—ãƒªãƒ³ãƒˆæ¸¬å®š\";\n      case \"agility\":\n        return \"ã‚¢ã‚¸ãƒªãƒ†ã‚£æ¸¬å®š\";\n      default:\n        return \"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š\";\n    }\n  }, []);\n\n  const handlePerformanceUpdate = useCallback(\n    async (\n      recordId: string,\n      updates: {\n        date?: string;\n        values?: Record<string, any>;\n        notes?: string;\n        is_official?: boolean;\n        weather_conditions?: string;\n      }\n    ) => {\n      await updatePerformanceRecord(recordId, updates);\n    },\n    [updatePerformanceRecord]\n  );\n\n  const handlePerformanceRecordSubmit = useCallback(\n    async (recordData: any) => {\n      const result = await addPerformanceRecord(recordData);\n\n      // âœ… PBæ›´æ–°æ™‚ã«ã‚»ãƒ¬ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³\n      if (result?.isNewPersonalBest) {\n        const testType = performanceTestTypes.find((t) => t.id === recordData.test_type_id);\n        const previousBest = getPersonalBest(recordData.test_type_id);\n\n        if (testType) {\n          setCelebrationData({\n            testName: testType.display_name,\n            value: Number(recordData?.values?.primary_value ?? 0),\n            unit: testType.unit,\n            previousBest: previousBest?.value,\n          });\n        }\n      }\n\n      return result;\n    },\n    [addPerformanceRecord, performanceTestTypes, getPersonalBest]\n  );\n\n  // âœ… lastRecords / personalBests ã‚’ Map åŒ–ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã«æ¸¡ã™\n  const { lastPerformanceRecords, personalBestsMap } = useMemo(() => {\n    const lastMap = new Map<string, any>();\n    const pbMap = new Map<string, any>();\n\n    for (const testType of performanceTestTypes) {\n      const recs = getRecordsByTestType(testType.id);\n      if (recs && recs.length > 0) lastMap.set(testType.id, recs[0]);\n\n      const pb = getPersonalBest(testType.id);\n      if (pb) pbMap.set(testType.id, pb);\n    }\n\n    return { lastPerformanceRecords: lastMap, personalBestsMap: pbMap };\n  }, [performanceTestTypes, getRecordsByTestType, getPersonalBest]);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <button\n          type=\"button\"\n          onClick={onBackHome}\n          className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:opacity-90 active:opacity-80 transition\"\n        >\n          <ArrowLeft className=\"w-4 h-4\" />\n          <span className=\"text-sm font-medium\">ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</span>\n        </button>\n\n        <div className=\"flex items-center gap-2\">\n          <Zap className=\"w-5 h-5 text-yellow-500\" />\n          <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white\">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>\n        </div>\n      </div>\n\n      {/* Main */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8\">\n        {/* Left Column */}\n        <div className=\"lg:col-span-1 space-y-6\">\n          {/* Personal Bests Summary */}\n          {personalBests.length > 0 && (\n            <div className=\"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl shadow-sm p-4 border-2 border-yellow-300 dark:border-yellow-700\">\n              <h3 className=\"text-base font-semibold text-gray-900 dark:text-white mb-3 flex items-center\">\n                <Zap className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2\" />\n                ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆ\n              </h3>\n\n              <div className=\"space-y-2\">\n                {personalBests.slice(0, 3).map((pb: any) => {\n                  const unit = performanceTestTypes.find((t) => t.id === pb.test_type_id)?.unit;\n                  const value = Number(pb.value ?? 0);\n                  const isRSI = String(pb.test_name ?? \"\").toLowerCase().includes(\"rsi\");\n\n                  return (\n                    <div key={pb.test_type_id} className=\"bg-white/60 dark:bg-gray-800/60 rounded-lg p-2\">\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400\">{pb.test_display_name}</p>\n                      <p className=\"text-lg font-bold text-yellow-700 dark:text-yellow-300\">\n                        {Number.isFinite(value) ? value.toFixed(isRSI ? 2 : 1) : \"-\"} {unit}\n                      </p>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Category Selection */}\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden transition-colors\">\n            <div className=\"grid grid-cols-5 border-b border-gray-200 dark:border-gray-700\">\n              <button\n                type=\"button\"\n                onClick={() => setPerformanceCategory(\"jump\")}\n                className={`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${\n                  performanceCategory === \"jump\"\n                    ? \"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500\"\n                    : \"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700\"\n                }`}\n              >\n                ã‚¸ãƒ£ãƒ³ãƒ—\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setPerformanceCategory(\"sprint\")}\n                className={`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${\n                  performanceCategory === \"sprint\"\n                    ? \"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500\"\n                    : \"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700\"\n                }`}\n              >\n                ã‚¹ãƒ—ãƒªãƒ³ãƒˆ\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setPerformanceCategory(\"agility\")}\n                className={`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${\n                  performanceCategory === \"agility\"\n                    ? \"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500\"\n                    : \"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700\"\n                }`}\n              >\n                ã‚¢ã‚¸ãƒªãƒ†ã‚£\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setPerformanceCategory(\"endurance\")}\n                className={`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${\n                  performanceCategory === \"endurance\"\n                    ? \"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500\"\n                    : \"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700\"\n                }`}\n              >\n                æŒä¹…åŠ›\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setPerformanceCategory(\"strength\")}\n                className={`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${\n                  performanceCategory === \"strength\"\n                    ? \"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500\"\n                    : \"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700\"\n                }`}\n              >\n                ç­‹åŠ›\n              </button>\n            </div>\n          </div>\n\n          {/* Performance Form */}\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n            <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n              <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white\">\n                {getCategoryDisplayName(performanceCategory)}\n              </h2>\n              <Zap className=\"w-5 h-5 sm:w-6 sm:h-6 text-yellow-500\" />\n            </div>\n\n            <PerformanceRecordForm\n              userId={user.id}\n              userRole={(user as any).role}\n              testTypes={performanceTestTypes}\n              onSubmit={handlePerformanceRecordSubmit}\n              onCheckExisting={checkExistingRecord}\n              onUpdate={handlePerformanceUpdate}\n              loading={performanceLoading}\n              lastRecords={lastPerformanceRecords}\n              personalBests={personalBestsMap}\n            />\n          </div>\n        </div>\n\n        {/* Right Column */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n            <PerformanceOverview\n              testTypes={performanceTestTypes}\n              records={performanceRecords}\n              personalBests={personalBests}\n              getRecordsByTestType={getRecordsByTestType}\n              getPersonalBest={getPersonalBest}\n            />\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n            <PerformanceRecordsList records={performanceRecords} personalBests={personalBests} loading={performanceLoading} />\n          </div>\n        </div>\n      </div>\n\n      {/* âœ… Personal Best Celebration */}\n      {celebrationData && (\n        <PersonalBestCelebration\n          testName={celebrationData.testName}\n          value={celebrationData.value}\n          unit={celebrationData.unit}\n          previousBest={celebrationData.previousBest}\n          onClose={() => setCelebrationData(null)}\n        />\n      )}\n    </div>\n  );\n}"],"names":["calculateVO2max","distance","Math","max","minutes","seconds","count","vo2maxTable","low","floor","high","ceil","calculate1RM","weight","reps","round","getCalculatedUnit","testName","formatCalculatedValue","value","Number","isFinite","name","toLowerCase","includes","toFixed","Set","has","String","strengthTestNames","PerformanceRecordForm","userId","userRole","_userRole","testTypes","onSubmit","onCheckExisting","onUpdate","loading","lastRecords","personalBests","getLatestWeight","useWeightData","selectedTestTypeId","setSelectedTestTypeId","useState","selectedDate","setSelectedDate","getTodayJSTString","formValues","setFormValues","notes","setNotes","submitting","setSubmitting","error","setError","showPersonalBestMessage","setShowPersonalBestMessage","latestWeight","setLatestWeight","relative1RM","setRelative1RM","showDuplicateModal","setShowDuplicateModal","existingRecord","setExistingRecord","pendingData","setPendingData","selectedTestType","useMemo","find","t","id","useEffect","initialValues","Array","isArray","fields","forEach","field","console","log","computePrimaryValue","values","parseFloat","height","contact_time","avg_height","avg_contact_time","time_minutes","time_seconds","time","calculatePrimaryValue","getDisplayUnit","unit","getPrimaryValueDisplay","primaryValue","lastRecord","get","personalBest","handleCancelOverwrite","handleValueChange","fieldName","newValues","oneRM","relative","jsxs","Fragment","children","jsx","DuplicateRecordModal","isOpen","onClose","onOverwrite","async","err","onCancel","newValue","_a","primary_value","e","preventDefault","requiredFields","filter","f","required","label","normalizedPrimary","isStrengthTest","valuesWithRelative","relative_1rm","weight_at_test","existing","test_type_id","date","is_official","isNewPersonalBest","setTimeout","className","TrendingUp","Calendar","type","onChange","target","style","fontSize","testType","user_can_input","map","display_name","disabled","description","Lock","_b","Date","toLocaleDateString","options","option","inputMode","step","min","placeholder","getCalculatedValueLabel","Scale","AlertCircle","rows","WebkitTapHighlightColor","touchAction","Plus","PerformanceRecordsList","records","toNumber","v","n","getUnit","record","test_type","length","Trophy","groupedRecords","reduce","acc","displayName","push","Object","entries","testRecords","first","higherIsBetter","higher_is_better","Shield","isPB","pb","recordPV","pbVal","recordFmt","pbFmt","isPersonalBest","improvement","sameTestPrev","r","sort","a","b","getTime","cur","prev","abs","getImprovementFromPrevious","unitEach","displayPV","goodDirection","_c","_d","relative1rm","_e","weightAtTest","_f","year","month","day","TrendingDown","FileText","PerformanceChart","React","memo","testTypeName","metricKey","unitLabel","teamMonthly","sortedRecords","resolvedUnit","digits","athletePoints","raw","num","getMetricValue","x","dateLabel","team_avg","team_n","kind","teamPoints","m","iso","month_start","chartData","d","fullDate","numericValues","arr","minValue","maxValue","valueRange","yAxisMin","yAxisMax","CustomTooltip","active","payload","data","athleteOnlyValues","latestAthleteValue","i","bestValue","ResponsiveContainer","width","LineChart","margin","top","right","left","bottom","CartesianGrid","strokeDasharray","XAxis","dataKey","stroke","tick","fill","YAxis","domain","angle","position","Tooltip","content","Legend","wrapperStyle","paddingTop","iconType","ReferenceLine","y","fontWeight","Line","strokeWidth","dot","activeDot","connectNulls","PerformanceOverview","getRecordsByTestType","getPersonalBest","teamMonthlyAbsByTestId","setTeamMonthlyAbsByTestId","teamMonthlyRelByTestId","setTeamMonthlyRelByTestId","teamBenchAbsByTestId","setTeamBenchAbsByTestId","teamBenchRelByTestId","setTeamBenchRelByTestId","benchLoading","setBenchLoading","strengthTests","benchMetricByTestId","setBenchMetricByTestId","selectedRecords","selectedMetric","selectedPB","recs","best","isNaN","buildPersonalBestFromRecords","cancelled","e1","rel","e2","Promise","all","supabase","rpc","p_days","p_metric","absMap","row","relMap","warn","p_test_type_id","p_months","normalized","month_start_date","month_start_at","month_begin","avg","mean","team_mean","Boolean","unitFor","formatValue","latestRecord","metric","bench","showBench","suffix","fmt","onClick","stopPropagation","diff_vs_team_avg","team_rank","team_top_percent","PersonalBestCelebration","previousBest","animationEnd","now","defaults","startVelocity","spread","ticks","zIndex","randomInRange","random","interval","setInterval","timeLeft","clearInterval","particleCount","confetti","origin","displayValue","trim","displayImprovement","Zap","AthletePerformanceView","user","onBackHome","performanceCategory","setPerformanceCategory","performanceTestTypes","performanceRecords","performanceLoading","addRecord","addPerformanceRecord","updateRecord","updatePerformanceRecord","checkExistingRecord","usePerformanceData","celebrationData","setCelebrationData","getCategoryDisplayName","useCallback","category","handlePerformanceUpdate","recordId","updates","handlePerformanceRecordSubmit","recordData","result","lastPerformanceRecords","personalBestsMap","lastMap","Map","pbMap","set","ArrowLeft","slice","isRSI","test_name","test_display_name","role"],"mappings":"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"}
import{j as t}from"./index-C7IL5YWP.js";import{d as R,r as l,R as V,L as W,C as E,X as J,Y as B,T as z,e as X,b as Y,c as C}from"./chart-vendor-B8I3tXXj.js";const U=R.memo(function({records:d,personalBest:m,testTypeName:f,metricKey:i="primary_value",unitLabel:g,teamMonthly:x=[]}){var D;if(!d||d.length===0)return t.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:"データがありません"});const v=l.useMemo(()=>[...d].sort((e,a)=>new Date(e.date).getTime()-new Date(a.date).getTime()),[d]),s=(D=d[0])==null?void 0:D.test_type,h=(s==null?void 0:s.higher_is_better)??!0,n=l.useMemo(()=>g||(i==="relative_1rm"?"×BW":(s==null?void 0:s.unit)||""),[g,i,s==null?void 0:s.unit]),c=l.useMemo(()=>{var e;return i==="relative_1rm"||(e=s==null?void 0:s.name)!=null&&e.includes("rsi")?2:1},[i,s==null?void 0:s.name]),L=e=>{var F,A;const a=i==="relative_1rm"?(F=e.values)==null?void 0:F.relative_1rm:(A=e.values)==null?void 0:A.primary_value,r=typeof a=="string"?parseFloat(a):a;return Number.isFinite(r)?r:null},o=l.useMemo(()=>v.map(e=>{const a=L(e);return{x:e.date,dateLabel:new Date(e.date).toLocaleDateString("ja-JP",{month:"short",day:"numeric"}),value:a,team_avg:null,team_n:null,unit:n,notes:e.notes||"",kind:"athlete"}}),[v,i,n]),p=l.useMemo(()=>(x??[]).filter(e=>(e==null?void 0:e.team_avg)!==null&&(e==null?void 0:e.team_avg)!==void 0).map(e=>{const a=typeof e.month_start=="string"?e.month_start:String(e.month_start);return{x:a,dateLabel:new Date(a).toLocaleDateString("ja-JP",{year:"numeric",month:"short"}),value:null,team_avg:e.team_avg,team_n:e.team_n??null,unit:n,notes:"",kind:"team"}}),[x,n]),b=l.useMemo(()=>[...o,...p].sort((a,r)=>new Date(a.x).getTime()-new Date(r.x).getTime()).map(a=>({...a,date:a.kind==="team"?a.dateLabel:new Date(a.x).toLocaleDateString("ja-JP",{month:"short",day:"numeric"}),fullDate:a.x})),[o,p]),k=l.useMemo(()=>{const e=[];for(const a of b)typeof a.value=="number"&&Number.isFinite(a.value)&&e.push(a.value),typeof a.team_avg=="number"&&Number.isFinite(a.team_avg)&&e.push(a.team_avg);return e.length?e:[0]},[b]),j=Math.min(...k),N=Math.max(...k),_=N-j||1,M=Math.max(0,j-_*.1),P=N+_*.1,S=({active:e,payload:a})=>{if(e&&a&&a.length){const r=a[0].payload;return t.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-3",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:new Date(r.fullDate).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}),r.value!==null&&r.value!==void 0&&t.jsxs("p",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:["個人: ",Number(r.value).toFixed(c)," ",n]}),r.team_avg!==null&&r.team_avg!==void 0&&t.jsxs("p",{className:"text-sm font-semibold text-indigo-600 dark:text-indigo-300 mt-1",children:["チーム月次平均: ",Number(r.team_avg).toFixed(c)," ",n,r.team_n?t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:["(n=",r.team_n,")"]}):null]}),r.notes&&t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 max-w-xs",children:r.notes})]})}return null},u=l.useMemo(()=>o.map(e=>typeof e.value=="number"&&Number.isFinite(e.value)?e.value:null).filter(e=>e!==null),[o]),w=l.useMemo(()=>{var e;for(let a=o.length-1;a>=0;a--){const r=(e=o[a])==null?void 0:e.value;if(typeof r=="number"&&Number.isFinite(r))return r}return null},[o]),y=l.useMemo(()=>u.length?h?Math.max(...u):Math.min(...u):null,[u,h]);return t.jsxs("div",{className:"w-full",children:[f&&t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:[f," の推移"]}),m&&t.jsx("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:t.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[t.jsx("span",{className:"font-semibold",children:"パーソナルベスト:"})," ",m.value.toFixed(c)," ",n,t.jsxs("span",{className:"text-xs ml-2",children:["(",new Date(m.date).toLocaleDateString("ja-JP"),")"]})]})}),t.jsx(V,{width:"100%",height:400,children:t.jsxs(W,{data:b,margin:{top:5,right:30,left:20,bottom:5},children:[t.jsx(E,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),t.jsx(J,{dataKey:"date",className:"text-xs",stroke:"#9CA3AF",tick:{fill:"#9CA3AF"}}),t.jsx(B,{domain:[M,P],className:"text-xs",stroke:"#9CA3AF",tick:{fill:"#9CA3AF"},label:{value:n||"",angle:-90,position:"insideLeft",style:{fill:"#9CA3AF",fontSize:"12px"}}}),t.jsx(z,{content:t.jsx(S,{})}),t.jsx(X,{wrapperStyle:{paddingTop:"20px"},iconType:"line"}),m&&t.jsx(Y,{y:m.value,stroke:"#F59E0B",strokeDasharray:"5 5",label:{value:"PB",position:"right",fill:"#F59E0B",fontSize:12,fontWeight:"bold"}}),t.jsx(C,{type:"monotone",dataKey:"value",name:i==="relative_1rm"?"個人（相対）":(s==null?void 0:s.display_name)||"個人",stroke:"#3B82F6",strokeWidth:3,dot:{r:5,fill:"#3B82F6",strokeWidth:2,stroke:"#fff"},activeDot:{r:7,fill:"#2563EB",strokeWidth:2,stroke:"#fff"},connectNulls:!1}),(x==null?void 0:x.length)>0&&t.jsx(C,{type:"monotone",dataKey:"team_avg",name:i==="relative_1rm"?"チーム月次平均（相対/最新）":"チーム月次平均（最新）",stroke:"#6366F1",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0,strokeDasharray:"4 4"})]})}),u.length>1&&t.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[t.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"最新記録"}),t.jsxs("p",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:[w!==null?Number(w).toFixed(c):"-"," ",n]})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[t.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:[h?"最高":"最低","記録"]}),t.jsxs("p",{className:"text-lg font-bold text-green-700 dark:text-green-300",children:[y!==null?Number(y).toFixed(c):"-"," ",n]})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[t.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400 mb-1",children:"測定回数"}),t.jsxs("p",{className:"text-lg font-bold text-purple-700 dark:text-purple-300",children:[u.length," 回"]})]})]})]})});export{U as P};

{"version":3,"file":"GrowthUnderstandingMatrix-G4SRsLvV.js","sources":["../../src/components/GrowthUnderstandingMatrix.tsx"],"sourcesContent":["import React from 'react';\nimport { useDailyGrowthMatrix } from '../hooks/useDailyGrowthMatrix';\nimport type { MatrixPoint } from '../hooks/useDailyGrowthMatrix';\nimport {\n  ResponsiveContainer,\n  ScatterChart,\n  Scatter,\n  CartesianGrid,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ReferenceLine,\n  Legend,\n} from 'recharts';\n\nconst clamp = (n: number, min: number, max: number) => Math.max(min, Math.min(max, n));\n\nfunction loadToRadius(load: number, maxLoad: number) {\n  if (!isFinite(load) || load <= 0) return 6;\n  if (!isFinite(maxLoad) || maxLoad <= 0) return 6;\n  const t = clamp(load / maxLoad, 0, 1);\n  return 6 + t * 12;\n}\n\nconst StarShape = (props: any) => {\n  const { cx, cy } = props;\n  if (cx == null || cy == null) return null;\n  return (\n    <text x={cx} y={cy} textAnchor=\"middle\" dominantBaseline=\"central\" fontSize={18}>\n      ★\n    </text>\n  );\n};\n\n// ✅ これが “表示コンポーネント”\nexport function GrowthUnderstandingMatrixChart(props: {\n  points: MatrixPoint[];\n  teamAvg: { x: number; y: number; load: number } | null;\n}) {\n  const { points, teamAvg } = props;\n\n  const maxLoad = React.useMemo(() => {\n    if (!points?.length) return 0;\n    return Math.max(...points.map((p) => (typeof p.load === 'number' ? p.load : 0)), 0);\n  }, [points]);\n\n  const teamPoint = teamAvg\n    ? [\n        {\n          x: teamAvg.x,\n          y: teamAvg.y,\n          name: 'チーム平均',\n          load: teamAvg.load,\n          rpe: null,\n          duration_min: null,\n        },\n      ]\n    : [];\n\n  return (\n    <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n      <div className=\"flex items-end justify-between mb-3\">\n        <div>\n          <div className=\"text-sm sm:text-base font-semibold text-gray-900\">\n            成長度 × 理解度 × 負荷（sRPE）\n          </div>\n          <div className=\"text-xs text-gray-500\">点の大きさ＝load / ★＝チーム平均 / 50ラインで4象限</div>\n        </div>\n      </div>\n\n      <div style={{ width: '100%', height: 420 }}>\n        <ResponsiveContainer>\n          <ScatterChart margin={{ top: 10, right: 16, bottom: 10, left: 10 }}>\n            <CartesianGrid />\n            <XAxis\n              type=\"number\"\n              dataKey=\"x\"\n              domain={[0, 100]}\n              ticks={[0, 25, 50, 75, 100]}\n              label={{ value: '理解度', position: 'insideBottom', offset: -5 }}\n            />\n            <YAxis\n              type=\"number\"\n              dataKey=\"y\"\n              domain={[0, 100]}\n              ticks={[0, 25, 50, 75, 100]}\n              label={{ value: '成長度', angle: -90, position: 'insideLeft' }}\n            />\n\n            <ReferenceLine x={50} strokeDasharray=\"4 4\" />\n            <ReferenceLine y={50} strokeDasharray=\"4 4\" />\n\n            <Tooltip\n              cursor={{ strokeDasharray: '3 3' }}\n              content={({ active, payload }) => {\n                if (!active || !payload?.length) return null;\n                const p: any = payload[0].payload;\n                return (\n                  <div className=\"bg-white border border-gray-200 rounded-lg p-3 shadow\">\n                    <div className=\"font-semibold mb-1\">{p.name}</div>\n                    <div className=\"text-sm\">理解度: {Math.round(p.x)}</div>\n                    <div className=\"text-sm\">成長度: {Math.round(p.y)}</div>\n                    <div className=\"text-sm\">負荷(load): {Math.round(p.load)}</div>\n                    {typeof p.rpe === 'number' && <div className=\"text-sm\">RPE: {p.rpe}</div>}\n                    {typeof p.duration_min === 'number' && <div className=\"text-sm\">時間: {p.duration_min}分</div>}\n                  </div>\n                );\n              }}\n            />\n            <Legend />\n\n            <Scatter\n              name=\"選手\"\n              data={points}\n              shape={(props: any) => {\n                const { cx, cy, payload } = props;\n                const r = loadToRadius(payload?.load ?? 0, maxLoad);\n                return (\n                  <circle\n                    cx={cx}\n                    cy={cy}\n                    r={r}\n                    fill=\"#3b82f6\"\n                    fillOpacity={0.55}\n                    stroke=\"#1d4ed8\"\n                    strokeWidth={1}\n                  />\n                );\n              }}\n            />\n\n            <Scatter name=\"チーム平均\" data={teamPoint} shape={<StarShape />} />\n          </ScatterChart>\n        </ResponsiveContainer>\n      </div>\n    </div>\n  );\n}\n\n// ✅ これが “コンテナ”（StaffView はこれを呼ぶ）\nexport default function GrowthUnderstandingMatrix(props: {\n  date: string;\n  athletes: { id: string; name?: string | null; nickname?: string | null; email?: string | null }[];\n}) {\n  const { date, athletes } = props;\n  const { points, teamAvg, loading, error } = useDailyGrowthMatrix({ date, athletes });\n\n  if (loading) {\n    return (\n      <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n        <div className=\"flex items-center justify-center py-10\">\n          <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-white rounded-xl border border-red-200 p-4 sm:p-5 text-sm text-red-700\">\n        GrowthUnderstandingMatrix：{error}\n      </div>\n    );\n  }\n\n  return <GrowthUnderstandingMatrixChart points={points} teamAvg={teamAvg} />;\n}"],"names":["loadToRadius","load","maxLoad","isFinite","n","min","max","Math","StarShape","props","cx","cy","jsx","x","y","textAnchor","dominantBaseline","fontSize","children","GrowthUnderstandingMatrixChart","points","teamAvg","React","useMemo","length","map","p","teamPoint","name","rpe","duration_min","jsxs","className","style","width","height","ResponsiveContainer","ScatterChart","margin","top","right","bottom","left","CartesianGrid","XAxis","type","dataKey","domain","ticks","label","value","position","offset","YAxis","angle","ReferenceLine","strokeDasharray","Tooltip","cursor","content","active","payload","round","Legend","Scatter","data","shape","r","fill","fillOpacity","stroke","strokeWidth","GrowthUnderstandingMatrix","date","athletes","loading","error","useDailyGrowthMatrix"],"mappings":"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"}
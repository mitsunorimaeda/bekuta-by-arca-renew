const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GamificationView-B4thg2QI.js","assets/chart-vendor-DEPfNMx8.js","assets/supabase-vendor-BgrwFlS9.js","assets/AthleteNutritionDashboardView-5dKSLPKh.js","assets/ExportPanel-znwgpFDe.js","assets/exportUtils-CVEBC2Fl.js","assets/MessagingPanel-D7zdw3YG.js","assets/AthletePerformanceView-BEW3xqkO.js","assets/TeamExportPanel-BGlYlYPU.js","assets/ReportView-nD5fRgZk.js","assets/CoachRankingsView-De1OIxUp.js","assets/GrowthUnderstandingQuadrantSummary-ByKDmVRN.js","assets/GrowthUnderstandingMatrix-Dt-VFs5L.js","assets/OrganizationAdminView-C7TeoVv6.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,r,s)=>((t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s)(t,"symbol"!=typeof r?r+"":r,s);import{r,a as s,R as a,L as n,C as l,X as i,Y as o,T as d,b as c,c as u,d as x,e as m,S as g,f as h,g as p,B as b,h as y,i as f}from"./chart-vendor-DEPfNMx8.js";import{c as v}from"./supabase-vendor-BgrwFlS9.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var j={exports:{}},w={},N=r,k=Symbol.for("react.element"),_=Symbol.for("react.fragment"),S=Object.prototype.hasOwnProperty,C=N.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,E={key:!0,ref:!0,__self:!0,__source:!0};function D(e,t,r){var s,a={},n=null,l=null;for(s in void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(l=t.ref),t)S.call(t,s)&&!E.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===a[s]&&(a[s]=t[s]);return{$$typeof:k,type:e,key:n,ref:l,props:a,_owner:C.current}}w.Fragment=_,w.jsx=D,w.jsxs=D,j.exports=w;var M,T=j.exports,R=s;M=R.createRoot,R.hydrateRoot;const $={},A=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in $)return;$[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),t?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})},I=globalThis,z=I.__bekuta_supabase??(I.__bekuta_supabase=v("http://127.0.0.1:54321","sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:"undefined"!=typeof window?window.localStorage:void 0},realtime:{params:{eventsPerSecond:0}}}));async function P(e){const t=String(e&&"object"==typeof e&&"message"in e?e.message:e??"");if(t.includes("Invalid Refresh Token")||t.includes("Refresh Token Not Found")||t.includes("refresh_token")){try{await z.auth.signOut()}catch(r){}try{const e=Object.keys(window.localStorage);for(const t of e)t.startsWith("sb-")&&t.endsWith("-auth-token")&&window.localStorage.removeItem(t)}catch(r){}window.location.reload()}}const L=Object.freeze(Object.defineProperty({__proto__:null,recoverFromInvalidRefreshToken:P,supabase:z},Symbol.toStringTag,{value:"Module"}));function q(e){return new Promise(t=>setTimeout(t,e))}async function F(e,t){let r;try{return await Promise.race([e,new Promise(e=>{r=setTimeout(()=>e(null),t)})])}finally{clearTimeout(r)}}function O(){const[e,t]=r.useState(null),[s,a]=r.useState(null),[n,l]=r.useState("booting"),i="ready"!==n,[o,d]=r.useState(!1),c=r.useRef(!0),u=r.useRef(0),x=r.useCallback(async e=>{const t=++u.current,r=[0,300,800,1500];for(let s=0;s<r.length;s++){if(!c.current)return;if(t!==u.current)return;r[s]>0&&await q(r[s]);const n=await F(z.from("users").select("*").eq("id",e).maybeSingle(),8e3);if(!c.current)return;if(t!==u.current)return;if(null===n)continue;const{data:l,error:i}=n;if(i)return console.error("[useAuth] fetchUserProfile error:",i),void a(null);if(l)return void a(l)}a(null)},[]),m=r.useCallback(async e=>{const r=(null==e?void 0:e.user)??null;t(r),r?((e=>{var t;const r=!0===(null==(t=e.user_metadata)?void 0:t.requires_password_change);d(r)})(r),x(r.id)):(a(null),d(!1))},[x]),g=r.useCallback(async()=>{var e;try{const{data:t,error:r}=await z.auth.getUser();if(r)return void console.error("[useAuth] refreshUserProfile getUser error:",r);const s=null==(e=t.user)?void 0:e.id;if(!s)return;await x(s)}catch(t){console.error("[useAuth] refreshUserProfile failed:",t)}},[x]);r.useEffect(()=>{c.current=!0;const{data:e}=z.auth.onAuthStateChange(async(e,t)=>{c.current&&(await m(t),c.current&&l("ready"))});return(async()=>{var e;try{const t=await F(z.auth.getSession(),8e3);if(!c.current)return;(null==(e=null==t?void 0:t.data)?void 0:e.session)&&await m(t.data.session)}catch(t){console.error("[useAuth] init getSession failed:",t)}finally{c.current&&l("ready")}})(),()=>{var t;c.current=!1,null==(t=null==e?void 0:e.subscription)||t.unsubscribe()}},[m]);return{user:e,userProfile:s,loading:i,requiresPasswordChange:o,signIn:async(e,t)=>{var r,s;const{data:a,error:n}=await z.auth.signInWithPassword({email:e.trim(),password:t});if(n)throw n;return(null==(s=null==(r=a.user)?void 0:r.user_metadata)?void 0:s.requires_password_change)&&d(!0),a},signOut:async()=>{try{await z.auth.signOut()}catch(e){console.error("[useAuth] signOut error:",e)}finally{t(null),a(null),d(!1),l("ready")}},changePassword:async e=>{const{error:t}=await z.auth.updateUser({password:e,data:{requires_password_change:!1}});if(t)throw t;d(!1)},acceptTerms:async()=>{if(!e)throw new Error("User not logged in");const t=(new Date).toISOString(),{error:r}=await z.from("users").update({terms_accepted:!0,terms_accepted_at:t}).eq("id",e.id);if(r)throw console.error("[useAuth] acceptTerms failed:",r),r;a(e=>e?{...e,terms_accepted:!0,terms_accepted_at:t}:e)},refreshUserProfile:g}}function W(e){return new Date(e.getTime()+324e5)}function B(e){const t=W(e);return`${t.getUTCFullYear()}-${String(t.getUTCMonth()+1).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`}function U(){return W(new Date)}function H(){return B(new Date)}function V(e){return function(e){const t=U();return t.setUTCFullYear(t.getUTCFullYear()-e),B(t)}(e)}function K(e){return function(e){const t=U();return t.setUTCDate(t.getUTCDate()-e),B(t)}(e)}function J(e){return B(e)}function Y(e){return B(e)}function G(){return new Date(Date.now()+324e5).toISOString().replace("Z","+09:00")}const Z=[{type:"high_risk",condition:"acwr_above",threshold:1.5,enabled:!0,description:"ACWR ãŒ 1.5 ã‚’è¶…ãˆãŸå ´åˆï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰"},{type:"caution",condition:"acwr_above",threshold:1.3,enabled:!0,description:"ACWR ãŒ 1.3 ã‚’è¶…ãˆãŸå ´åˆï¼ˆæ³¨æ„ãƒ¬ãƒ™ãƒ«ï¼‰"},{type:"low_load",condition:"acwr_below",threshold:.8,enabled:!0,description:"ACWR ãŒ 0.8 ã‚’ä¸‹å›ã£ãŸå ´åˆï¼ˆä½è² è·ï¼‰"},{type:"no_data",condition:"no_training_days",threshold:5,enabled:!0,description:"5æ—¥é–“ç·´ç¿’è¨˜éŒ²ãŒãªã„å ´åˆ"},{type:"reminder",condition:"no_training_today",threshold:1,enabled:!1,description:"å½“æ—¥ã®ç·´ç¿’è¨˜éŒ²ãŒãªã„å ´åˆï¼ˆ22æ™‚ä»¥é™ï¼‰"},{type:"srpe_high",condition:"srpe_above",threshold:600,enabled:!0,description:"sRPEï¼ˆRPEÃ—åˆ†ï¼‰ãŒ600ã‚’è¶…ãˆãŸå ´åˆï¼ˆå˜ç™ºé«˜è² è·ï¼‰"},{type:"srpe_spike",condition:"srpe_spike_ratio",threshold:1.6,enabled:!0,description:"å½“æ—¥ã®sRPEãŒç›´è¿‘å¹³å‡æ¯”ã§æ€¥å¢—ï¼ˆä¾‹ï¼š1.6å€ä»¥ä¸Šï¼‰"}];function X(e,t,r,s,a){const n=[],l=new Date,i=Y(l),o=r.length>0?r[r.length-1]:null,d=s.length>0?s[s.length-1]:null,c=s.find(e=>e.date===i),u=Array.from(new Set(s.map(e=>e.date))).length>=21,x=e=>{const t=Number((null==e?void 0:e.rpe)??0),r=Number((null==e?void 0:e.duration_min)??0);return t&&r?Math.round(t*r):0},m=new Map;for(const y of s){const e=y.date;e&&m.set(e,(m.get(e)??0)+x(y))}const g=m.get(i)??0,h=Array.from(m.keys()).sort().filter(e=>e<i).slice(-7).map(e=>m.get(e)??0).filter(e=>e>0),p=h.length?Math.round(h.reduce((e,t)=>e+t,0)/h.length):0,b=p>0?Number((g/p).toFixed(2)):0;return a.forEach(r=>{if(!r.enabled)return;let s=!1,a={user_id:e,user_name:t,type:r.type,is_read:!1,is_dismissed:!1,created_at:l.toISOString()};switch(r.condition){case"acwr_above":if(!u)break;o&&o.acwr>r.threshold&&(s=!0,a={...a,priority:"high_risk"===r.type?"high":"medium",title:"high_risk"===r.type?"ğŸš¨ é«˜ãƒªã‚¹ã‚¯è­¦å‘Š":"âš ï¸ æ³¨æ„ãƒ¬ãƒ™ãƒ«",message:`${t}ã•ã‚“ã®ACWRãŒ${o.acwr}ã¨ãªã‚Šã€${r.threshold}ã‚’è¶…ãˆã¾ã—ãŸã€‚æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚`,acwr_value:o.acwr,threshold_exceeded:`${r.threshold}ä»¥ä¸Š`,expires_at:new Date(l.getTime()+1728e5).toISOString()});break;case"acwr_below":if(!u)break;o&&o.acwr<r.threshold&&(s=!0,a={...a,priority:"low",title:"ğŸ“‰ ä½è² è·é€šçŸ¥",message:`${t}ã•ã‚“ã®ACWRãŒ${o.acwr}ã¨ãªã‚Šã€${r.threshold}ã‚’ä¸‹å›ã‚Šã¾ã—ãŸã€‚ç·´ç¿’è² è·ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`,acwr_value:o.acwr,threshold_exceeded:`${r.threshold}æœªæº€`,expires_at:new Date(l.getTime()+2592e5).toISOString()});break;case"no_training_days":if(d){const e=Math.floor((l.getTime()-new Date(d.date).getTime())/864e5);e>=r.threshold&&(s=!0,a={...a,priority:"medium",title:"ğŸ“… ç·´ç¿’è¨˜éŒ²ãªã—",message:`${t}ã•ã‚“ã®ç·´ç¿’è¨˜éŒ²ãŒ${e}æ—¥é–“ã‚ã‚Šã¾ã›ã‚“ã€‚ç¶™ç¶šçš„ãªãƒ‡ãƒ¼ã‚¿è¨˜éŒ²ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`,last_training_date:d.date,days_since_last_training:e,expires_at:new Date(l.getTime()+6048e5).toISOString()})}break;case"no_training_today":l.getHours()>=22&&!c&&(s=!0,a={...a,priority:"low",title:"â° ä»Šæ—¥ã®è¨˜éŒ²å¿˜ã‚Œ",message:`${t}ã•ã‚“ã€ä»Šæ—¥ã®ç·´ç¿’è¨˜éŒ²ã‚’ã¾ã å…¥åŠ›ã—ã¦ã„ã¾ã›ã‚“ã€‚å¿˜ã‚Œãšã«è¨˜éŒ²ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`,expires_at:new Date(l.getTime()+72e5).toISOString()});break;case"srpe_above":g>0&&g>=r.threshold&&(s=!0,a={...a,priority:"medium",title:"ğŸ”¥ é«˜è² è·ï¼ˆsRPEï¼‰",message:`${t}ã•ã‚“ã®ä»Šæ—¥ã®è² è·ï¼ˆsRPEï¼‰ãŒ${g}ã§ã™ã€‚ç–²åŠ´ãŒæºœã¾ã‚Šã‚„ã™ã„ã®ã§ç¡çœ ãƒ»è£œé£Ÿãƒ»å›å¾©ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚`,srpe_value:g,expires_at:new Date(l.getTime()+1728e5).toISOString()});break;case"srpe_spike_ratio":g>0&&p>0&&b>=r.threshold&&(s=!0,a={...a,priority:"high",title:"âš¡ æ€¥å¢—ï¼ˆsRPEï¼‰",message:`${t}ã•ã‚“ã®ä»Šæ—¥ã®è² è·ï¼ˆsRPEï¼‰ãŒæ€¥å¢—ã—ã¦ã„ã¾ã™ï¼ˆ${g} / ç›´è¿‘å¹³å‡${p} = ${b}å€ï¼‰ã€‚æ€ªæˆ‘ãƒªã‚¹ã‚¯ãŒä¸ŠãŒã‚Šã‚„ã™ã„ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚`,srpe_value:g,srpe_avg_7d:p,srpe_spike_ratio:b,expires_at:new Date(l.getTime()+2592e5).toISOString()})}s&&n.push({id:`${e}-${r.type}-${Date.now()}`,...a})}),n}function Q(e){switch(e.priority){case"high":return{bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-600",icon:"ğŸš¨"};case"medium":return{bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-600",icon:"âš ï¸"};case"low":return{bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-600",icon:"ğŸ’¡"};default:return{bgColor:"bg-gray-50",borderColor:"border-gray-200",textColor:"text-gray-800",iconColor:"text-gray-600",icon:"â„¹ï¸"}}}function ee(e){switch(e){case"high_risk":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"low_load":return"ä½è² è·";case"no_data":return"ãƒ‡ãƒ¼ã‚¿ãªã—";case"reminder":return"ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼";case"srpe_high":return"é«˜è² è·ï¼ˆsRPEï¼‰";case"srpe_spike":return"æ€¥å¢—ï¼ˆsRPEï¼‰";default:return"ä¸æ˜"}}function te(e){return e.filter(e=>!e.is_dismissed&&!function(e){return!!e.expires_at&&new Date>new Date(e.expires_at)}(e))}function re(e){const[t,r,s]=e.split("-").map(e=>Number(e));return new Date(Date.UTC(t,(r||1)-1,s||1))}function se(e){return e.toISOString().slice(0,10)}function ae(e,t){const r=new Date(e);return r.setUTCDate(r.getUTCDate()+t),r}function ne(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"good":return"è‰¯å¥½";case"low":return"ä½è² è·";default:return"ä¸æ˜"}}function le(e){if("string"==typeof e)switch(e){case"high":return"#ef4444";case"caution":return"#f59e0b";case"good":return"#22c55e";case"low":return"#3b82f6";default:return"#94a3b8"}const t=e;return null!=t&&Number.isFinite(t)?t>1.5?"#ef4444":t>=1.3?"#f59e0b":t>=.8?"#22c55e":"#3b82f6":"#94a3b8"}function ie(e){const t=new Map;for(const i of e){if(!(null==i?void 0:i.date))continue;const e="number"==typeof i.load&&Number.isFinite(i.load)?i.load:0;t.set(i.date,(t.get(i.date)??0)+e)}const r=Array.from(t.keys()).sort();if(0===r.length)return[];const s=re(r[0]),a=re(r[r.length-1]),n=[];for(let i=s;i<=a;i=ae(i,1)){const e=se(i);n.push({date:e,load:t.get(e)??0})}const l=[];for(let i=0;i<n.length;i++){const e=n[i].date;if(i<27){l.push({date:e,acwr:null,acuteLoad:null,chronicLoad:null,riskLevel:"unknown"});continue}const t=n.slice(i-6,i+1).reduce((e,t)=>e+t.load,0),r=n.slice(i-27,i+1).reduce((e,t)=>e+t.load,0)/4,s=r>0?t/r:null,a=null!=s?Number(s.toFixed(2)):null,o=null==a?"unknown":a>1.5?"high":a>=1.3?"caution":a>=.8?"good":"low";l.push({date:e,acuteLoad:Number(t.toFixed(1)),chronicLoad:r>0?Number(r.toFixed(1)):null,acwr:a,riskLevel:o})}return l}const oe=r.createContext(null);function de({children:e}){const[t,s]=r.useState(()=>"undefined"==typeof document||!document.hidden),[a,n]=r.useState(()=>"undefined"==typeof navigator||navigator.onLine),l=r.useRef(new Map),i=r.useRef(t),o=r.useRef(a);r.useEffect(()=>{i.current=t},[t]),r.useEffect(()=>{o.current=a},[a]),r.useEffect(()=>{const e=()=>s(!document.hidden),t=()=>n(!0),r=()=>n(!1);return document.addEventListener("visibilitychange",e),window.addEventListener("online",t),window.addEventListener("offline",r),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("online",t),window.removeEventListener("offline",r)}},[]);const d=r.useCallback(e=>{l.current.delete(e)},[]),c=r.useCallback(async e=>{try{await e.run(),e.failCount=0,e.nextAt=Date.now()+e.intervalMs}catch(t){e.failCount+=1;const r=2e3,s=Math.min(3e5,r*Math.pow(2,Math.min(8,e.failCount)));e.nextAt=Date.now()+s}},[]);r.useEffect(()=>{const e=window.setInterval(()=>{const e=Date.now(),t=i.current,r=o.current;for(const s of l.current.values())s.enabled&&(s.requireVisible&&!t||s.requireOnline&&!r||e<s.nextAt||c(s))},1e3);return()=>window.clearInterval(e)},[c]);const u=r.useCallback(e=>{const{key:t,intervalMs:r,run:s,enabled:a=!0,requireVisible:n=!0,requireOnline:i=!0,immediate:o=!1}=e,d=l.current.get(t)??{key:t,intervalMs:r,run:s,enabled:a,requireVisible:n,requireOnline:i,nextAt:Date.now(),failCount:0};return d.intervalMs=r,d.run=s,d.enabled=a,d.requireVisible=n,d.requireOnline=i,a&&(d.nextAt=o?Date.now():Date.now()+r),l.current.set(t,d),o&&a&&c(d),()=>{l.current.delete(t)}},[c]),x=r.useMemo(()=>{const e=t&&a;return{isVisible:t,isOnline:a,canRun:e,canRealtime:e}},[t,a]),m=r.useMemo(()=>({state:x,registerPollJob:u,unregisterJob:d}),[x,u,d]);return T.jsx(oe.Provider,{value:m,children:e})}function ce(){const e=r.useContext(oe);if(!e)throw new Error("useRealtimeHub must be used within RealtimeHubProvider");return e}function ue(e,t){var s,a;const[n,l]=r.useState([]),[i,o]=r.useState([]),[d,c]=r.useState(!0),[u,x]=r.useState(0),{registerPollJob:m}=ce(),g=r.useRef((null==(a=null==(s=globalThis.crypto)?void 0:s.randomUUID)?void 0:a.call(s))??Math.random().toString(36).slice(2)),h=r.useRef(null),p=r.useCallback(async()=>{if(!e||!t)return[];let r=[];if("athlete"===t){const{data:t}=await z.from("users").select("id, name").eq("id",e).single();t&&(r=[t])}if("staff"===t){const{data:t,error:s}=await z.from("staff_team_links").select("\n          team_id,\n          teams!inner (\n            users!inner (\n              id,\n              name\n            )\n          )\n        ").eq("staff_user_id",e);s&&console.error("[useAlerts] staff team fetch error:",s);const a=(null==t?void 0:t.flatMap(e=>{var t;return(null==(t=e.teams)?void 0:t.users)||[]}))||[],n=new Map;for(const e of a)(null==e?void 0:e.id)&&(n.has(e.id)||n.set(e.id,{id:e.id,name:e.name??""}));r=Array.from(n.values())}if("global_admin"===t){const{data:e,error:t}=await z.from("users").select("id, name").eq("role","athlete");t&&console.error("[useAlerts] admin athletes fetch error:",t);const s=new Map;for(const r of e||[])(null==r?void 0:r.id)&&(s.has(r.id)||s.set(r.id,{id:r.id,name:r.name??""}));r=Array.from(s.values())}return r},[e,t]),b=r.useCallback(async()=>{if(e&&t)try{const e=await p();if(!e.length)return;const r=(i??[]).filter(e=>"athlete"===t||"no_data"!==e.type),s=e.map(async e=>{const{data:t,error:r}=await z.from("training_records").select("*").eq("user_id",e.id).order("date",{ascending:!0});if(r)throw{user:e,error:r};return{user:e,trainingRecords:t||[]}}),a=await Promise.allSettled(s),n=[];for(const t of a){if("rejected"===t.status){console.error("[useAlerts] training_records fetch failed:",t.reason);continue}const{user:e,trainingRecords:s}=t.value,a=ie(s),l=X(e.id,e.name,a,s,r);n.push(...l)}l(e=>{const t=new Set(e.map(e=>`${e.user_id}-${e.type}-${e.created_at.split("T")[0]}`)),r=n.filter(e=>!t.has(`${e.user_id}-${e.type}-${e.created_at.split("T")[0]}`));if(r.length>0){false;return function(e){const t={high:3,medium:2,low:1};return e.sort((e,r)=>{const s=t[r.priority]-t[e.priority];return 0!==s?s:new Date(r.created_at).getTime()-new Date(e.created_at).getTime()})}(te([...e,...r]))}return te(e)})}catch(r){console.error("Error checking and generating alerts:",r)}},[e,t,i,p]),y=r.useCallback(async()=>{const e=Z.map((e,t)=>({id:`default-${t}`,...e}));o(e)},[]);r.useEffect(()=>{let r=!1;return(async()=>{if(e&&t){c(!0);try{await y()}catch(s){console.error("Error loading alert rules:",s),await y()}finally{r||c(!1)}}else c(!1)})(),()=>{r=!0}},[e,t,y]),r.useEffect(()=>{i.length>0&&e&&t&&b()},[i.length,e,t,b]),r.useEffect(()=>{if(h.current&&(h.current(),h.current=null),!e||!t)return;if(0===i.length)return;const r=`alerts:${e}:${t}:${g.current}`,s=m({key:r,intervalMs:18e5,run:async()=>{await b()},enabled:!0,requireVisible:!0,requireOnline:!0,immediate:!1});return h.current=s,()=>{h.current&&(h.current(),h.current=null)}},[e,t,i.length,m,b]),r.useEffect(()=>{const e=n.filter(e=>!e.is_read&&!e.is_dismissed).length;x(e)},[n]);const f=r.useCallback(async e=>{l(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t))},[]),v=r.useCallback(async e=>{l(t=>t.map(t=>t.id===e?{...t,is_dismissed:!0}:t))},[]),j=r.useCallback(async()=>{l(e=>e.map(e=>({...e,is_read:!0})))},[]),w=r.useCallback(()=>{l(e=>e.filter(e=>!e.is_dismissed))},[]),N=r.useCallback(()=>te(n),[n]),k=r.useCallback(()=>n.filter(e=>!e.is_read&&!e.is_dismissed),[n]),_=r.useCallback(e=>N().filter(t=>t.priority===e),[N]),S=r.useCallback(e=>N().filter(t=>t.user_id===e),[N]);return{alerts:N(),alertRules:i,loading:d,unreadCount:u,markAsRead:f,dismissAlert:v,markAllAsRead:j,clearDismissedAlerts:w,getUnreadAlerts:k,getAlertsByPriority:_,getAlertsByUser:S,refreshAlerts:b}}const xe=r.createContext(void 0);function me({userId:e,role:t,children:s}){const a=function(e,t){const[s,a]=r.useState(null),[n,l]=r.useState(!0),[i,o]=r.useState(null),d=r.useCallback(async()=>{if(e&&t)try{l(!0),o(null);const{data:r,error:s}=await z.from("tutorial_progress").select("*").eq("user_id",e).eq("role",t).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(s)throw s;a(r||{user_id:e,role:t,completed_steps:[],current_step:null,is_completed:!1,skipped:!1})}catch(r){console.error("Error loading tutorial progress:",r),o(r.message??String(r))}finally{l(!1)}else l(!1)},[e,t]);r.useEffect(()=>{d()},[d]);const c=r.useCallback(async r=>{if(!e||!t)return null;try{o(null);const n={...s??{user_id:e,role:t,completed_steps:[],current_step:null,is_completed:!1,skipped:!1},...r,user_id:e,role:t},{data:l,error:i}=await z.from("tutorial_progress").upsert(n,{onConflict:"user_id,role"}).select().single();if(i)throw i;return a(l),l}catch(n){console.error("Error saving tutorial progress:",n),o(n.message??String(n));const l={...s??{user_id:e,role:t,completed_steps:[],current_step:null,is_completed:!1,skipped:!1},...r,user_id:e,role:t};return a(l),l}},[e,t,s]),u=r.useCallback(async e=>{if(!s)return null;const t=[...s.completed_steps];return t.includes(e)||t.push(e),await c({completed_steps:t,current_step:e})},[s,c]),x=r.useCallback(async e=>await c({current_step:e}),[c]),m=r.useCallback(async()=>await c({is_completed:!0,current_step:null}),[c]),g=r.useCallback(async()=>await c({skipped:!0,current_step:null}),[c]),h=r.useCallback(async()=>await c({completed_steps:[],current_step:null,is_completed:!1,skipped:!1}),[c]),p=r.useCallback(()=>!!s&&!s.is_completed&&!s.skipped,[s]);return{progress:s,loading:n,error:i,completeStep:u,setCurrentStep:x,completeTutorial:m,skipTutorial:g,resetTutorial:h,shouldShowTutorial:p,refreshProgress:d}}(e,t),[n,l]=r.useState(!1),[i,o]=r.useState(0),d=r.useCallback(()=>{l(!0),o(0)},[]),c=r.useCallback(()=>{l(!1)},[]),u=r.useCallback(async()=>{await a.completeTutorial(),l(!1)},[a]),x=r.useCallback(async()=>{await a.skipTutorial(),l(!1)},[a]),m={...a,isActive:n,currentStepIndex:i,startTutorial:d,stopTutorial:c,completeTutorial:u,skipTutorial:x,setCurrentStepIndex:o};return T.jsx(xe.Provider,{value:m,children:s})}function ge(){const e=r.useContext(xe);if(void 0===e)throw new Error("useTutorialContext must be used within a TutorialProvider");return e}
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var he={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=(e,t)=>{const s=r.forwardRef(({color:s="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:l,className:i="",children:o,...d},c)=>{return r.createElement("svg",{ref:c,...he,width:a,height:a,stroke:s,strokeWidth:l?24*Number(n)/Number(a):n,className:["lucide",`lucide-${u=e,u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,i].join(" "),...d},[...t.map(([e,t])=>r.createElement(e,t)),...Array.isArray(o)?o:[o]]);var u});return s.displayName=`${e}`,s},be=pe("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),ye=pe("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),fe=pe("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ve=pe("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),je=pe("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),we=pe("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Ne=pe("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),ke=pe("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),_e=pe("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]),Se=pe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Ce=pe("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]),Ee=pe("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),De=pe("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Me=pe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Te=pe("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Re=pe("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),$e=pe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Ae=pe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ie=pe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),ze=pe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Pe=pe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Le=pe("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]),qe=pe("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),Fe=pe("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Oe=pe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),We=pe("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),Be=pe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Ue=pe("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),He=pe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ve=pe("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),Ke=pe("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]),Je=pe("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Ye=pe("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Ge=pe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ze=pe("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),Xe=pe("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Qe=pe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),et=pe("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),tt=pe("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),rt=pe("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]),st=pe("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),at=pe("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),nt=pe("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),lt=pe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),it=pe("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),ot=pe("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),dt=pe("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),ct=pe("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ut=pe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),xt=pe("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),mt=pe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),gt=pe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),ht=pe("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),pt=pe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),bt=pe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),yt=pe("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),ft=pe("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]),vt=pe("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),jt=pe("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),wt=pe("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Nt=pe("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),kt=pe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),_t=pe("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),St=pe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Ct=pe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Et=pe("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),Dt=pe("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Mt=pe("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),Tt=pe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Rt=pe("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),$t=pe("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),At=pe("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),It=pe("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),zt=pe("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Pt=pe("Sliders",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),Lt=pe("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),qt=pe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),Ft=pe("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Ot=pe("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Wt=pe("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),Bt=pe("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),Ut=pe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ht=pe("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Vt=pe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Kt=pe("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Jt=pe("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Yt=pe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Gt=pe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Zt=pe("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),Xt=pe("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Qt=pe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),er=pe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),tr=pe("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]),rr=pe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),sr=pe("Wind",[["path",{d:"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2",key:"1k4u03"}],["path",{d:"M9.6 4.6A2 2 0 1 1 11 8H2",key:"b7d0fd"}],["path",{d:"M12.6 19.4A2 2 0 1 0 14 16H2",key:"1p5cb3"}]]),ar=pe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),nr=pe("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function lr({onLogin:e}){const[t,s]=r.useState(""),[a,n]=r.useState(""),[l,i]=r.useState(!1),[o,d]=r.useState(""),[c,u]=r.useState(!1),[x,m]=r.useState(!1),[g,h]=r.useState(""),[p,b]=r.useState(!1),[y,f]=r.useState("");return T.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4 transition-colors",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md transition-colors",children:[T.jsxs("div",{className:"text-center mb-8",children:[T.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-colors",children:T.jsx(xt,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),T.jsxs("h1",{className:"flex items-baseline justify-center space-x-2 mb-2 transition-colors",children:[T.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"-0.02em"},children:"Bekuta"}),T.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",style:{letterSpacing:"0.05em"},children:"by ARCA"})]}),T.jsx("p",{className:"text-gray-600 dark:text-gray-300 transition-colors",children:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¸ãƒ­ã‚°ã‚¤ãƒ³"})]}),T.jsxs("form",{onSubmit:async r=>{var s,n,l,o,c;if(r.preventDefault(),t.trim()&&a)if(t.includes("@")){i(!0),d("");try{console.log("ğŸ” Login attempt for:",t.trim()),await e(t.trim(),a),console.log("âœ… Login successful")}catch(u){console.error("âŒ Login error:",u),console.error("Error message:",u.message),console.error("Error details:",u),(null==(s=u.message)?void 0:s.includes("Invalid login credentials"))||(null==(n=u.message)?void 0:n.includes("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"))?d("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚\n\nè€ƒãˆã‚‰ã‚Œã‚‹åŸå› ï¼š\nâ€¢ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ãªã„\nâ€¢ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹\nâ€¢ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé–“é•ã£ã¦ã„ã‚‹\n\nç®¡ç†è€…ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚"):(null==(l=u.message)?void 0:l.includes("Email not confirmed"))?d("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚"):(null==(o=u.message)?void 0:o.includes("Too many requests"))?d("ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒå¤šã™ãã¾ã™ã€‚5åˆ†ç¨‹åº¦å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"):(null==(c=u.message)?void 0:c.includes("Missing Supabase environment variables"))?d("ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚¨ãƒ©ãƒ¼ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚"):d(u.message||"ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã™ã‚‹ã‹ã€ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚")}finally{i(!1)}}else d("æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");else d("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")},className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsx("input",{type:"email",id:"email",value:t,onChange:e=>s(e.target.value),className:"\n                w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg \n                focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent \n                transition-colors text-base\n                bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                placeholder-gray-500 dark:placeholder-gray-400\n              ",placeholder:"your-email@example.com",required:!0,disabled:l,autoComplete:"email",style:{fontSize:"16px",WebkitAppearance:"none",WebkitBorderRadius:"0.5rem"}})]}),T.jsxs("div",{children:[T.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"}),T.jsxs("div",{className:"relative",children:[T.jsx("input",{type:c?"text":"password",id:"password",value:a,onChange:e=>n(e.target.value),className:"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent \n                  transition-colors text-base\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                ",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:l,autoComplete:"current-password",style:{fontSize:"16px",WebkitAppearance:"none",WebkitBorderRadius:"0.5rem"}}),T.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),u(e=>!e)},className:"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors touch-target\n                ",disabled:l,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:c?T.jsx(Ye,{className:"w-5 h-5"}):T.jsx(Ge,{className:"w-5 h-5"})})]})]}),o&&T.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors",children:[T.jsx(ye,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),T.jsxs("div",{className:"text-sm",children:[T.jsx("p",{className:"font-medium mb-1",children:"ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼"}),T.jsx("p",{className:"whitespace-pre-line",children:o})]})]}),T.jsx("button",{type:"submit",disabled:l,className:"\n              w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg\n              hover:bg-blue-700 dark:hover:bg-blue-600\n              focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800\n              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium touch-target\n            ",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:l?"ãƒ­ã‚°ã‚¤ãƒ³ä¸­...":"ãƒ­ã‚°ã‚¤ãƒ³"}),T.jsx("div",{className:"mt-4 text-center",children:T.jsx("button",{type:"button",onClick:()=>{m(!0),h(t),f(""),b(!1)},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆ"})})]}),T.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 transition-colors",children:[T.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 transition-colors",children:T.jsxs("div",{className:"flex items-start space-x-2",children:[T.jsx(lt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"åˆå›åˆ©ç”¨ã®æ–¹ã¸"}),T.jsxs("div",{className:"text-blue-700 dark:text-blue-400 space-y-1 text-left text-xs",children:[T.jsx("p",{children:"1. ç®¡ç†è€…ã‹ã‚‰ã€ŒBekuta æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã€ã‚’å—ã‘å–ã‚‹"}),T.jsx("p",{children:"2. ãƒ¡ãƒ¼ãƒ«å†…ã®ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™"}),T.jsx("p",{children:"3. è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€ãã®å¾Œã“ã®ç”»é¢ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³"})]})]})]})}),T.jsx("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg transition-colors",children:T.jsxs("div",{className:"flex items-start space-x-2",children:[T.jsx(ye,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),T.jsxs("div",{className:"text-amber-700 dark:text-amber-400 text-xs text-left",children:[T.jsx("p",{className:"font-medium mb-1",children:"ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å ´åˆ"}),T.jsx("p",{children:"ç®¡ç†è€…ã«ä»¥ä¸‹ã®æƒ…å ±ã‚’ãŠä¼ãˆãã ã•ã„ï¼š"}),T.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[T.jsx("li",{children:"ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsx("li",{children:"ã€Œæ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã€ã¾ãŸã¯ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã€ã‚’å—ã‘å–ã£ã¦ã„ã‚‹ã‹"}),T.jsx("li",{children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼ˆå¤‰æ›´ï¼‰ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã©ã†ã‹"}),T.jsx("li",{children:"ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹"})]})]})]})}),T.jsx("p",{className:"mt-4 text-xs",children:"ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒä¸æ˜ãªå ´åˆã¯ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„"})]})]}),x&&T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md",children:[T.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ"}),p?T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[T.jsx("p",{className:"text-green-800 dark:text-green-300 text-sm",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚"}),T.jsx("p",{className:"text-green-700 dark:text-green-400 text-sm mt-2",children:"ãƒ¡ãƒ¼ãƒ«ã«è¨˜è¼‰ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’æŠ¼ã—ã¦ã€è¡¨ç¤ºã•ã‚ŒãŸç”»é¢ã§æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"})]}),T.jsx("button",{onClick:()=>{m(!1),b(!1),h("")},className:"w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors",children:"é–‰ã˜ã‚‹"})]}):T.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(""),b(!1);const t=g.trim();if(!t||!t.includes("@"))return void f("æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const r="sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH";i(!0);try{console.log("ğŸ” Requesting password reset for:",t);const e=await fetch("http://127.0.0.1:54321/functions/v1/request-password-reset",{method:"POST",headers:{"Content-Type":"application/json",apikey:r,Authorization:`Bearer ${r}`},body:JSON.stringify({email:t,redirectUrl:window.location.origin})}),s=await e.json().catch(()=>({}));if(!e.ok)return console.error("âŒ request-password-reset error:",e.status,s),void(404===e.status?f("ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™»éŒ²ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã‹ã€ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚"):f((null==s?void 0:s.error)||"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"));console.log("âœ… Password reset request accepted:",s),b(!0)}catch(s){console.error("âŒ Password reset request failed:",s),f("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã‚’ç¢ºèªã™ã‚‹ã‹ã€ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚")}finally{i(!1)}},className:"space-y-4",children:[T.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨ã®ãƒªãƒ³ã‚¯ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚",T.jsx("br",{}),T.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€»ä»¥å‰ã¨åŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã¯å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsx("input",{type:"email",value:g,onChange:e=>h(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors",placeholder:"email@example.com",disabled:l})]}),y&&T.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400",children:[T.jsx(ye,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),T.jsx("p",{className:"text-sm whitespace-pre-line",children:y})]}),T.jsxs("div",{className:"flex space-x-3",children:[T.jsx("button",{type:"button",onClick:()=>{m(!1),f(""),h("")},className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",disabled:l,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{type:"submit",disabled:l,className:"flex-1 bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?"é€ä¿¡ä¸­...":"ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡"})]})]})]})})]})}var ir={};!function e(t,r,s,a){var n=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),l="function"==typeof Path2D&&"function"==typeof DOMMatrix;function i(){}function o(e){var s=r.exports.Promise,a=void 0!==s?s:t.Promise;return"function"==typeof a?new a(e):(e(i,i),null)}var d,c,u,x,m,g,h=function(e,t){return{transform:function(r){if(e)return r;if(t.has(r))return t.get(r);var s=new OffscreenCanvas(r.width,r.height);return s.getContext("2d").drawImage(r,0,0),t.set(r,s),s},clear:function(){t.clear()}}}(function(){if(!t.OffscreenCanvas)return!1;try{var e=new OffscreenCanvas(1,1),r=e.getContext("2d");r.fillRect(0,0,1,1);var s=e.transferToImageBitmap();r.createPattern(s,"no-repeat")}catch(a){return!1}return!0}(),new Map),p=(u=Math.floor(1e3/60),x={},m=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(d=function(e){var t=Math.random();return x[t]=requestAnimationFrame(function r(s){m===s||m+u-1<s?(m=s,delete x[t],e()):x[t]=requestAnimationFrame(r)}),t},c=function(e){x[e]&&cancelAnimationFrame(x[e])}):(d=function(e){return setTimeout(e,u)},c=function(e){return clearTimeout(e)}),{frame:d,cancel:c}),b=function(){var t,r,a={};return function(){if(t)return t;if(!s&&n){var l=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{t=new Worker(URL.createObjectURL(new Blob([l])))}catch(i){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("ğŸŠ Could not load worker",i),null}!function(e){function t(t,r){e.postMessage({options:t||{},callback:r})}e.init=function(t){var r=t.transferControlToOffscreen();e.postMessage({canvas:r},[r])},e.fire=function(s,n,l){if(r)return t(s,null),r;var i=Math.random().toString(36).slice(2);return r=o(function(n){function o(t){t.data.callback===i&&(delete a[i],e.removeEventListener("message",o),r=null,h.clear(),l(),n())}e.addEventListener("message",o),t(s,i),a[i]=o.bind(null,{data:{callback:i}})})},e.reset=function(){for(var t in e.postMessage({reset:!0}),a)a[t](),delete a[t]}}(t)}return t}}(),y={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function f(e,t,r){return function(e,t){return t?t(e):e}(e&&null!=e[t]?e[t]:y[t],r)}function v(e){return e<0?0:Math.floor(e)}function j(e,t){return Math.floor(Math.random()*(t-e))+e}function w(e){return parseInt(e,16)}function N(e){return e.map(k)}function k(e){var t=String(e).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:w(t.substring(0,2)),g:w(t.substring(2,4)),b:w(t.substring(4,6))}}function _(e){e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight}function S(e){var t=e.getBoundingClientRect();e.width=t.width,e.height=t.height}function C(e){var t=e.angle*(Math.PI/180),r=e.spread*(Math.PI/180);return{x:e.x,y:e.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*e.startVelocity+Math.random()*e.startVelocity,angle2D:-t+(.5*r-Math.random()*r),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:e.color,shape:e.shape,tick:0,totalTicks:e.ticks,decay:e.decay,drift:e.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*e.gravity,ovalScalar:.6,scalar:e.scalar,flat:e.flat}}function E(e,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var r=t.tick++/t.totalTicks,s=t.x+t.random*t.tiltCos,a=t.y+t.random*t.tiltSin,n=t.wobbleX+t.random*t.tiltCos,i=t.wobbleY+t.random*t.tiltSin;if(e.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-r)+")",e.beginPath(),l&&"path"===t.shape.type&&"string"==typeof t.shape.path&&Array.isArray(t.shape.matrix))e.fill(function(e,t,r,s,a,n,l){var i=new Path2D(e),o=new Path2D;o.addPath(i,new DOMMatrix(t));var d=new Path2D;return d.addPath(o,new DOMMatrix([Math.cos(l)*a,Math.sin(l)*a,-Math.sin(l)*n,Math.cos(l)*n,r,s])),d}(t.shape.path,t.shape.matrix,t.x,t.y,.1*Math.abs(n-s),.1*Math.abs(i-a),Math.PI/10*t.wobble));else if("bitmap"===t.shape.type){var o=Math.PI/10*t.wobble,d=.1*Math.abs(n-s),c=.1*Math.abs(i-a),u=t.shape.bitmap.width*t.scalar,x=t.shape.bitmap.height*t.scalar,m=new DOMMatrix([Math.cos(o)*d,Math.sin(o)*d,-Math.sin(o)*c,Math.cos(o)*c,t.x,t.y]);m.multiplySelf(new DOMMatrix(t.shape.matrix));var g=e.createPattern(h.transform(t.shape.bitmap),"no-repeat");g.setTransform(m),e.globalAlpha=1-r,e.fillStyle=g,e.fillRect(t.x-u/2,t.y-x/2,u,x),e.globalAlpha=1}else if("circle"===t.shape)e.ellipse?e.ellipse(t.x,t.y,Math.abs(n-s)*t.ovalScalar,Math.abs(i-a)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):function(e,t,r,s,a,n,l,i,o){e.save(),e.translate(t,r),e.rotate(n),e.scale(s,a),e.arc(0,0,1,l,i,o),e.restore()}(e,t.x,t.y,Math.abs(n-s)*t.ovalScalar,Math.abs(i-a)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if("star"===t.shape)for(var p=Math.PI/2*3,b=4*t.scalar,y=8*t.scalar,f=t.x,v=t.y,j=5,w=Math.PI/j;j--;)f=t.x+Math.cos(p)*y,v=t.y+Math.sin(p)*y,e.lineTo(f,v),p+=w,f=t.x+Math.cos(p)*b,v=t.y+Math.sin(p)*b,e.lineTo(f,v),p+=w;else e.moveTo(Math.floor(t.x),Math.floor(t.y)),e.lineTo(Math.floor(t.wobbleX),Math.floor(a)),e.lineTo(Math.floor(n),Math.floor(i)),e.lineTo(Math.floor(s),Math.floor(t.wobbleY));return e.closePath(),e.fill(),t.tick<t.totalTicks}function D(e,r){var l,i=!e,d=!!f(r||{},"resize"),c=!1,u=f(r,"disableForReducedMotion",Boolean),x=n&&!!f(r||{},"useWorker")?b():null,m=i?_:S,g=!(!e||!x)&&!!e.__confetti_initialized,y="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function w(t,r,n){for(var i=f(t,"particleCount",v),d=f(t,"angle",Number),c=f(t,"spread",Number),u=f(t,"startVelocity",Number),x=f(t,"decay",Number),g=f(t,"gravity",Number),b=f(t,"drift",Number),y=f(t,"colors",N),w=f(t,"ticks",Number),k=f(t,"shapes"),_=f(t,"scalar"),S=!!f(t,"flat"),D=function(e){var t=f(e,"origin",Object);return t.x=f(t,"x",Number),t.y=f(t,"y",Number),t}(t),M=i,T=[],R=e.width*D.x,$=e.height*D.y;M--;)T.push(C({x:R,y:$,angle:d,spread:c,startVelocity:u,color:y[M%y.length],shape:k[j(0,k.length)],ticks:w,decay:x,gravity:g,drift:b,scalar:_,flat:S}));return l?l.addFettis(T):(l=function(e,t,r,n,l){var i,d,c=t.slice(),u=e.getContext("2d"),x=o(function(t){function o(){i=d=null,u.clearRect(0,0,n.width,n.height),h.clear(),l(),t()}i=p.frame(function t(){!s||n.width===a.width&&n.height===a.height||(n.width=e.width=a.width,n.height=e.height=a.height),n.width||n.height||(r(e),n.width=e.width,n.height=e.height),u.clearRect(0,0,n.width,n.height),(c=c.filter(function(e){return E(u,e)})).length?i=p.frame(t):o()}),d=o});return{addFettis:function(e){return c=c.concat(e),x},canvas:e,promise:x,reset:function(){i&&p.cancel(i),d&&d()}}}(e,T,m,r,n),l.promise)}function k(r){var s=u||f(r,"disableForReducedMotion",Boolean),a=f(r,"zIndex",Number);if(s&&y)return o(function(e){e()});i&&l?e=l.canvas:i&&!e&&(e=function(e){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=e,t}(a),document.body.appendChild(e)),d&&!g&&m(e);var n={width:e.width,height:e.height};function h(){if(x){var t={getBoundingClientRect:function(){if(!i)return e.getBoundingClientRect()}};return m(t),void x.postMessage({resize:{width:t.width,height:t.height}})}n.width=n.height=null}function p(){l=null,d&&(c=!1,t.removeEventListener("resize",h)),i&&e&&(document.body.contains(e)&&document.body.removeChild(e),e=null,g=!1)}return x&&!g&&x.init(e),g=!0,x&&(e.__confetti_initialized=!0),d&&!c&&(c=!0,t.addEventListener("resize",h,!1)),x?x.fire(r,n,p):w(r,n,p)}return k.reset=function(){x&&x.reset(),l&&l.reset()},k}function M(){return g||(g=D(null,{useWorker:!0,resize:!0})),g}r.exports=function(){return M().apply(this,arguments)},r.exports.reset=function(){M().reset()},r.exports.create=D,r.exports.shapeFromPath=function(e){if(!l)throw new Error("path confetti are not supported in this browser");var t,r;"string"==typeof e?t=e:(t=e.path,r=e.matrix);var s=new Path2D(t),a=document.createElement("canvas").getContext("2d");if(!r){for(var n,i,o=1e3,d=o,c=o,u=0,x=0,m=0;m<o;m+=2)for(var g=0;g<o;g+=2)a.isPointInPath(s,m,g,"nonzero")&&(d=Math.min(d,m),c=Math.min(c,g),u=Math.max(u,m),x=Math.max(x,g));n=u-d,i=x-c;var h=Math.min(10/n,10/i);r=[h,0,0,h,-Math.round(n/2+d)*h,-Math.round(i/2+c)*h]}return{type:"path",path:t,matrix:r}},r.exports.shapeFromText=function(e){var t,r=1,s="#000000",a='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';"string"==typeof e?t=e:(t=e.text,r="scalar"in e?e.scalar:r,a="fontFamily"in e?e.fontFamily:a,s="color"in e?e.color:s);var n=10*r,l=n+"px "+a,i=new OffscreenCanvas(n,n),o=i.getContext("2d");o.font=l;var d=o.measureText(t),c=Math.ceil(d.actualBoundingBoxRight+d.actualBoundingBoxLeft),u=Math.ceil(d.actualBoundingBoxAscent+d.actualBoundingBoxDescent),x=d.actualBoundingBoxLeft+2,m=d.actualBoundingBoxAscent+2;c+=4,u+=4,(o=(i=new OffscreenCanvas(c,u)).getContext("2d")).font=l,o.fillStyle=s,o.fillText(t,x,m);var g=1/r;return{type:"bitmap",bitmap:i.transferToImageBitmap(),matrix:[g,0,0,g,-c*g/2,-u*g/2]}}}(function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:this||{}}(),ir,!1);const or=ir.exports;var dr=ir.exports.create;const cr=Object.freeze(Object.defineProperty({__proto__:null,create:dr,default:or},Symbol.toStringTag,{value:"Module"}));function ur({onPasswordChange:e,userName:t}){const[s,a]=r.useState(""),[n,l]=r.useState(""),[i,o]=r.useState(!1),[d,c]=r.useState(!1),[u,x]=r.useState(!1),[m,g]=r.useState(""),[h,p]=r.useState(0),[b,y]=r.useState(0);r.useEffect(()=>{setTimeout(()=>p(1),100),setTimeout(()=>p(2),400)},[]),r.useEffect(()=>{const e=[f.minLength,f.hasUpperCase,f.hasLowerCase,f.hasNumbers,f.hasSpecialChar],t=e.filter(Boolean).length/e.length*100;y(t)},[s]);const f=(e=>{const t=e.length>=8,r=/[A-Z]/.test(e),s=/[a-z]/.test(e),a=/\d/.test(e),n=/[!@#$%^&*(),.?":{}|<>]/.test(e);return{minLength:t,hasUpperCase:r,hasLowerCase:s,hasNumbers:a,hasSpecialChar:n,isValid:t&&r&&s&&a&&n}})(s),v=s===n&&n.length>0;return T.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md transition-all duration-700 "+(h>=1?"opacity-100 scale-100":"opacity-0 scale-95"),children:[T.jsxs("div",{className:"text-center mb-8",children:[T.jsx("div",{className:"bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-all duration-500 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:T.jsx(Lt,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),T.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2 transition-all duration-500 delay-100 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:"ã‚ã¨1ã‚¹ãƒ†ãƒƒãƒ—ï¼"}),T.jsxs("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-2 transition-all duration-500 delay-200 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:["ã‚ˆã†ã“ãã€",t,"ã•ã‚“"]}),T.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-4 transition-all duration-500 delay-300 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[T.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[T.jsx("div",{className:"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold",children:"1"}),T.jsx("div",{className:"w-12 h-1 bg-blue-600 dark:bg-blue-500 rounded"}),T.jsx("div",{className:"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold",children:"2"}),T.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded"}),T.jsx("div",{className:"w-8 h-8 bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 rounded-full flex items-center justify-center text-sm font-bold",children:"3"})]}),T.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„"})]})]}),T.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),g(""),f.isValid)if(v){x(!0);try{or({particleCount:100,spread:70,origin:{y:.6}}),setTimeout(()=>{or({particleCount:50,angle:60,spread:55,origin:{x:0}}),or({particleCount:50,angle:120,spread:55,origin:{x:1}})},250),await e(s)}catch(r){console.error("Password change error:",r);const e=(null==r?void 0:r.message)||(null==r?void 0:r.error_description)||"";e.includes("different from the old password")?g("ä»¥å‰ã¨åŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚åˆ¥ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"):e.includes("Password should be at least")?g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å½¢å¼ãŒè¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚"):e.includes("Auth session missing")?g("ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãƒªãƒ³ã‚¯ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚"):g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")}finally{x(!1)}}else g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚");else g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚")},className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"}),T.jsxs("div",{className:"relative",children:[T.jsx("input",{type:i?"text":"password",id:"newPassword",value:s,onChange:e=>a(e.target.value),className:"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent \n                  transition-colors\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                ",placeholder:"æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›",required:!0}),T.jsx("button",{type:"button",onClick:()=>o(!i),className:"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors\n                ",children:i?T.jsx(Ye,{className:"w-5 h-5"}):T.jsx(Ge,{className:"w-5 h-5"})})]})]}),T.jsxs("div",{children:[T.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª"}),T.jsxs("div",{className:"relative",children:[T.jsx("input",{type:d?"text":"password",id:"confirmPassword",value:n,onChange:e=>l(e.target.value),className:"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent \n                  transition-colors\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                ",placeholder:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†å…¥åŠ›",required:!0}),T.jsx("button",{type:"button",onClick:()=>c(!d),className:"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors\n                ",children:d?T.jsx(Ye,{className:"w-5 h-5"}):T.jsx(Ge,{className:"w-5 h-5"})})]})]}),s&&T.jsxs("div",{className:"mb-4",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦"}),T.jsx("span",{className:"text-sm font-bold "+(b<40?"text-red-600 dark:text-red-400":b<80?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"),children:0===b?"":b<40?"å¼±ã„":b<80?"æ™®é€š":"å¼·ã„"})]}),T.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:T.jsx("div",{className:`h-full ${b<40?"bg-red-500":b<80?"bg-yellow-500":"bg-green-500"} transition-all duration-500 rounded-full`,style:{width:`${b}%`}})})]}),T.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-700 dark:to-blue-900/20 rounded-lg p-4 transition-colors",children:[T.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶"}),T.jsxs("div",{className:"space-y-2 text-sm",children:[T.jsxs("div",{className:"flex items-center transition-colors "+(f.minLength?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[T.jsx(Re,{className:"w-4 h-4 mr-2"}),T.jsx("span",{children:"8æ–‡å­—ä»¥ä¸Š"})]}),T.jsxs("div",{className:"flex items-center transition-colors "+(f.hasUpperCase?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[T.jsx(Re,{className:"w-4 h-4 mr-2"}),T.jsx("span",{children:"å¤§æ–‡å­—ã‚’å«ã‚€"})]}),T.jsxs("div",{className:"flex items-center transition-colors "+(f.hasLowerCase?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[T.jsx(Re,{className:"w-4 h-4 mr-2"}),T.jsx("span",{children:"å°æ–‡å­—ã‚’å«ã‚€"})]}),T.jsxs("div",{className:"flex items-center transition-colors "+(f.hasNumbers?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[T.jsx(Re,{className:"w-4 h-4 mr-2"}),T.jsx("span",{children:"æ•°å­—ã‚’å«ã‚€"})]}),T.jsxs("div",{className:"flex items-center transition-colors "+(f.hasSpecialChar?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[T.jsx(Re,{className:"w-4 h-4 mr-2"}),T.jsx("span",{children:"ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€ (!@#$%^&*)"})]})]})]}),n.length>0&&T.jsxs("div",{className:"flex items-center text-sm transition-colors "+(v?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[T.jsx(Re,{className:"w-4 h-4 mr-2"}),T.jsx("span",{children:v?"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¦ã„ã¾ã™":"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“"})]}),m&&T.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors",children:[T.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),T.jsx("span",{className:"text-sm",children:m})]}),T.jsx("button",{type:"submit",disabled:u||!f.isValid||!v,className:"\n              w-full bg-orange-600 dark:bg-orange-700 text-white py-3 px-4 rounded-lg \n              hover:bg-orange-700 dark:hover:bg-orange-600 \n              focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800 \n              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium\n            ",children:u?"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ä¸­...":"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´"})]}),T.jsxs("div",{className:"mt-6 text-center",children:[T.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 mb-3",children:T.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 font-medium",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å¾Œã€ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ã§ã™ï¼"})}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"è‡ªå‹•çš„ã«ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚Œã¾ã™"})]})]})})}function xr({onContinue:e}){const[t,s]=r.useState(!0),[a,n]=r.useState(null),[l,i]=r.useState(null),[o,d]=r.useState(0),c=new URL(window.location.href).searchParams.get("token")??"";r.useEffect(()=>{(async()=>{try{if(!c)return n("æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆURLã« token ãŒã‚ã‚Šã¾ã›ã‚“ï¼‰"),void s(!1);console.log("ğŸ” Fetching invitation with token:",c),console.log("ğŸ“¡ Supabase URL:","http://127.0.0.1:54321");const e=await fetch(`http://127.0.0.1:54321/rest/v1/invitation_tokens?token=eq.${c}&select=email,name,role,team_id,organization_id,invited_by,expires_at`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json",Prefer:"return=representation"}});if(console.log("ğŸ“¬ Response status:",e.status),!e.ok){const t=await e.text();return console.error("âŒ API Error:",t),n(`æ‹›å¾…æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ (${e.status})`),void s(!1)}const t=await e.json();if(console.log("ğŸ“¦ Received data:",t),!t||0===t.length)return console.warn("âš ï¸ No invitation found for token"),n("æ‹›å¾…ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã¾ãŸã¯æœŸé™åˆ‡ã‚Œã§ã™"),void s(!1);const r=t[0];let a,l;if(console.log("âœ… Invitation found:",r),r.team_id){console.log("ğŸ¢ Fetching team info for:",r.team_id);const e=await fetch(`http://127.0.0.1:54321/rest/v1/teams?id=eq.${r.team_id}&select=name`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json"}});if(e.ok){const t=await e.json();t&&t.length>0&&(a=t[0].name,console.log("âœ… Team found:",a))}}if(r.organization_id){console.log("ğŸ¢ Fetching organization info for:",r.organization_id);const e=await fetch(`http://127.0.0.1:54321/rest/v1/organizations?id=eq.${r.organization_id}&select=name`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json"}});if(e.ok){const t=await e.json();t&&t.length>0&&(l=t[0].name,console.log("âœ… Organization found:",l))}}i({email:r.email,name:r.name,role:r.role,team_name:a,organization_name:l,expires_at:r.expires_at}),s(!1),setTimeout(()=>d(1),100),setTimeout(()=>d(2),400),setTimeout(()=>d(3),800),setTimeout(()=>{or({particleCount:100,spread:70,origin:{y:.6}})},1200)}catch(e){console.error("âŒ Error fetching invitation:",e),n("æ‹›å¾…æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"),s(!1)}})()},[c]);return t?T.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors",children:T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 dark:border-blue-400 mx-auto mb-4"}),T.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg",children:"æ‹›å¾…æƒ…å ±ã‚’ç¢ºèªä¸­..."})]})}):a||!l?T.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-900 dark:to-red-900 flex items-center justify-center p-4 transition-colors",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[T.jsx("div",{className:"bg-red-100 dark:bg-red-900 rounded-full p-4 w-16 h-16 mx-auto mb-4",children:T.jsx(Oe,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),T.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"æ‹›å¾…ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã§ã™"}),T.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:a||"æ‹›å¾…ãƒªãƒ³ã‚¯ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æœŸé™åˆ‡ã‚Œã§ã™"}),T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ç®¡ç†è€…ã«æ–°ã—ã„æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãã ã•ã„"})]})}):T.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden",children:T.jsxs("div",{className:"max-w-2xl w-full",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden transform transition-all duration-700 "+(o>=1?"opacity-100 scale-100":"opacity-0 scale-95"),children:[T.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 px-8 py-12 text-center relative overflow-hidden",children:[T.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-900 opacity-10",children:T.jsx("div",{className:"absolute top-0 left-0 w-full h-full",style:{backgroundImage:"radial-gradient(circle, white 1px, transparent 1px)",backgroundSize:"30px 30px"}})}),T.jsxs("div",{className:"transform transition-all duration-700 delay-200 "+(o>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-full p-4 w-20 h-20 mx-auto mb-6 shadow-lg",children:T.jsx(Lt,{className:"w-12 h-12 text-indigo-600 dark:text-indigo-400"})}),T.jsxs("h1",{className:"text-4xl font-bold text-white mb-3",children:["ã‚ˆã†ã“ãã€",l.name,"ã•ã‚“ï¼"]}),(l.organization_name||l.team_name)&&T.jsxs("div",{className:"space-y-2",children:[l.organization_name&&T.jsxs("div",{className:"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg",children:[T.jsx(rr,{className:"w-5 h-5"}),T.jsx("span",{className:"font-semibold",children:l.organization_name}),l.team_name&&T.jsx("span",{children:"-"}),l.team_name&&T.jsx("span",{className:"font-semibold",children:l.team_name}),T.jsx("span",{children:"ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™"})]}),!l.organization_name&&l.team_name&&T.jsxs("div",{className:"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg",children:[T.jsx(rr,{className:"w-5 h-5"}),T.jsx("span",{className:"font-semibold",children:l.team_name}),T.jsx("span",{children:"ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™"})]})]}),T.jsx("p",{className:"text-blue-100 dark:text-blue-200 text-lg mt-2",children:"Bekuta ã¸ã®æ‹›å¾…"})]})]}),T.jsx("div",{className:"px-8 py-10",children:T.jsxs("div",{className:"transform transition-all duration-700 delay-400 "+(o>=3?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[T.jsxs("div",{className:"space-y-6 mb-8",children:[T.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl",children:[T.jsx("div",{className:"flex-shrink-0 mt-1",children:T.jsx(Te,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"ã‚ãªãŸã®å½¹å‰²"}),T.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[(e=>{switch(e){case"athlete":return"ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ";case"staff":return"ã‚¹ã‚¿ãƒƒãƒ•";case"global_admin":return"ç®¡ç†è€…";default:return e}})(l.role),"ã¨ã—ã¦å‚åŠ ã—ã¾ã™"]})]})]}),T.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl",children:[T.jsx("div",{className:"flex-shrink-0 mt-1",children:T.jsx(Te,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:l.email})]})]}),T.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl",children:[T.jsx("div",{className:"flex-shrink-0 mt-1",children:T.jsx(Oe,{className:"w-6 h-6 text-amber-600 dark:text-amber-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"æ‹›å¾…ã®æœ‰åŠ¹æœŸé™"}),T.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:(e=>{const t=new Date,r=new Date(e).getTime()-t.getTime(),s=Math.floor(r/36e5),a=Math.floor(r%36e5/6e4);return s>0?`ã‚ã¨${s}æ™‚é–“`:a>0?`ã‚ã¨${a}åˆ†`:"é–“ã‚‚ãªãæœŸé™åˆ‡ã‚Œ"})(l.expires_at)})]})]})]}),T.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-8",children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3 text-center",children:"æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—"}),T.jsxs("ol",{className:"space-y-2 text-gray-600 dark:text-gray-300 text-sm",children:[T.jsxs("li",{className:"flex items-start space-x-2",children:[T.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),T.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«ã«è¨˜è¼‰ã•ã‚ŒãŸä¸€æ™‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³"})]}),T.jsxs("li",{className:"flex items-start space-x-2",children:[T.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),T.jsx("span",{children:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«å¤‰æ›´"})]}),T.jsxs("li",{className:"flex items-start space-x-2",children:[T.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),T.jsx("span",{children:"ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ï¼"})]})]})]}),T.jsxs("button",{onClick:()=>{l&&(or({particleCount:50,angle:60,spread:55,origin:{x:0}}),or({particleCount:50,angle:120,spread:55,origin:{x:1}}),setTimeout(()=>{e()},500))},className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 text-white py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 dark:hover:from-blue-600 dark:hover:to-indigo-600 transition-all duration-300 font-semibold text-lg flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105",children:[T.jsx("span",{children:"ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å§‹ã‚ã‚‹"}),T.jsx(je,{className:"w-5 h-5"})]})]})})]}),T.jsx("p",{className:"text-center text-sm text-gray-600 dark:text-gray-400 mt-6",children:"å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„"})]})})}function mr({isOpen:e,onClose:t,onOverwrite:s,onCancel:a,title:n,date:l,existingValues:i,newValues:o}){return r.useEffect(()=>{if(!e)return;const t=document.body.style.overflow,r=document.body.style.touchAction;return document.body.style.overflow="hidden",document.body.style.touchAction="none",()=>{document.body.style.overflow=t,document.body.style.touchAction=r}},[e]),e?T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 overscroll-contain",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[85vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[T.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center",children:T.jsx(fe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™"})]}),T.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",type:"button",children:T.jsx(ar,{className:"w-5 h-5"})})]}),T.jsxs("div",{className:"p-6",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"ã“ã®æ—¥ä»˜ã«ã¯æ—¢ã«ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ"}),T.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 mb-4",children:T.jsxs("div",{className:"space-y-3",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:"è¨˜éŒ²ã‚¿ã‚¤ãƒ—"}),T.jsx("p",{className:"text-base text-gray-900 dark:text-white",children:n})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:"æ—¥ä»˜"}),T.jsx("p",{className:"text-base text-gray-900 dark:text-white",children:new Date(l).toLocaleDateString("ja-JP")})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-gray-200 dark:border-gray-700",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"ç¾åœ¨ã®å€¤"}),T.jsx("div",{className:"space-y-1",children:i.map((e,t)=>T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.label}),T.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:e.value})]},t))})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"æ–°ã—ã„å€¤"}),T.jsx("div",{className:"space-y-1",children:o.map((e,t)=>T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.label}),T.jsx("p",{className:"text-base font-semibold text-blue-600 dark:text-blue-400",children:e.value})]},t))})]})]})]})}),T.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4",children:T.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"ä¸Šæ›¸ãã™ã‚‹ã¨ã€ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"})})]}),T.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-lg",children:[T.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",type:"button",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",type:"button",children:"ä¸Šæ›¸ãã™ã‚‹"})]})]})}):null}const gr=(e,t,r)=>Math.max(t,Math.min(r,e));function hr({value:e,onChange:t,label:s="æˆé•·å®Ÿæ„Ÿ",hint:a="ä»Šæ—¥ã®ç·´ç¿’ã§ã®æˆé•·å®Ÿæ„Ÿã¯ï¼Ÿ"}){const n=r.useRef(null),l=r.useRef(!1),[i,o]=r.useState(!1),d=gr(Math.round(e),0,100),c=r.useMemo(()=>0===d?0:d<=20?1:d<=40?2:d<=60?3:d<=80?4:5,[d]),u=r.useMemo(()=>{switch(c){case 0:return"ãªã—";case 1:return"ã¡ã‚‡ã„";case 2:return"å°‘ã—";case 3:return"ãã“ãã“";case 4:return"ã‹ãªã‚Š";case 5:return"ã‚ã¡ã‚ƒ";default:return""}},[c]),x=r.useMemo(()=>{const e=2.5+d/100*11.5;return{x0:24,y:70,x1:24+(18+d/100*202),stroke:e,head:10+1.2*e}},[d]),m=e=>{const r=n.current;if(!r)return;const s=r.getBoundingClientRect(),a=gr(e-s.left,24,s.width-24),l=s.width-24-24,i=Math.round((a-24)/l*100);t(gr(i,0,100))};return r.useEffect(()=>{const e=()=>(l.current=!1,void o(!1));return window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointercancel",e)}},[]),T.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[T.jsxs("div",{className:"flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:s}),T.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-300 mt-1",children:a})]}),T.jsx("div",{className:"text-right",children:T.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:u})})]}),T.jsx("div",{ref:n,className:"mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none "+(i?"ring-2 ring-blue-500":""),onPointerDown:e=>{var t,r;l.current=!0,o(!0),null==(r=(t=e.currentTarget).setPointerCapture)||r.call(t,e.pointerId),m(e.clientX)},onPointerMove:e=>{l.current&&m(e.clientX)},style:{touchAction:"none",WebkitTapHighlightColor:"transparent"},children:T.jsxs("svg",{viewBox:"0 0 300 140",className:"w-full h-20",children:[T.jsx("line",{x1:"24",y1:"70",x2:"276",y2:"70",stroke:"currentColor",opacity:"0.10",strokeWidth:"2"}),(()=>{const e=x.x1,t=x.y,r=Math.max(14,2.2*x.stroke),s=Math.max(10,1.2*x.stroke),a=e-r;return T.jsxs(T.Fragment,{children:[T.jsx("line",{x1:x.x0,y1:t,x2:a,y2:t,stroke:"currentColor",className:"text-blue-600 dark:text-blue-400",strokeWidth:x.stroke,strokeLinecap:"butt"}),T.jsx("polygon",{points:`\n                  ${e},${t}\n                  ${a},${t-s}\n                  ${a},${t+s}\n                `,fill:"currentColor",className:"text-blue-600 dark:text-blue-400"}),T.jsx("circle",{cx:e,cy:t,r:18,fill:"transparent",pointerEvents:"all"})]})})()]})})]})}const pr=(e,t,r)=>Math.max(t,Math.min(r,e));function br({value:e,onChange:t,label:s="ç†è§£åº¦",hint:a="ä»Šæ—¥ã®ç·´ç¿’ã®ç†è§£åº¦(ç›®çš„/ã‚³ãƒ„)ã¯ï¼Ÿ"}){const n=r.useRef(null),l=r.useRef(!1),[i,o]=r.useState(!1),d=pr(Math.round(e),0,100),c=r.useMemo(()=>0===d?0:d<=20?1:d<=40?2:d<=60?3:d<=80?4:5,[d]),u=r.useMemo(()=>{switch(c){case 0:return"åˆ†ã‹ã‚‰ã‚“";case 1:return"ã†ã£ã™ã‚‰";case 2:return"å°‘ã—";case 3:return"ã ã„ãŸã„";case 4:return"ã‹ãªã‚Š";case 5:return"è…¹è½ã¡";default:return""}},[c]),x=r.useMemo(()=>{const e=1+d/100*.18,t=d/100*5;return[18,30,44,60,78].map((r,s)=>{const a=pr(t-s,0,1);return{height:Math.round(r*e),lit:a}})},[d]),m=e=>{const r=n.current;if(!r)return;const s=r.getBoundingClientRect(),a=pr(e-s.left,16,s.width-16),l=s.width-16-16,i=Math.round((a-16)/l*100);t(pr(i,0,100))};return r.useEffect(()=>{const e=()=>(l.current=!1,void o(!1));return window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointercancel",e)}},[]),T.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[T.jsxs("div",{className:"flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:s}),T.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-300 mt-1",children:a})]}),T.jsx("div",{className:"text-right",children:T.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:u})})]}),T.jsx("div",{ref:n,className:"mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none "+(i?"ring-2 ring-blue-500":""),onPointerDown:e=>{var t,r;l.current=!0,o(!0),null==(r=(t=e.currentTarget).setPointerCapture)||r.call(t,e.pointerId),m(e.clientX)},onPointerMove:e=>{l.current&&m(e.clientX)},style:{touchAction:"none",WebkitTapHighlightColor:"transparent"},children:T.jsx("div",{className:"flex items-end justify-center gap-3 h-24",children:x.map((e,t)=>{const r=.25+.75*e.lit,s=10+8*e.lit;return T.jsx("div",{className:"flex flex-col items-center gap-2",children:T.jsx("div",{className:"rounded-full bg-blue-600 dark:bg-blue-400",style:{height:e.height,width:s,opacity:r,transition:"height 120ms ease, width 120ms ease, opacity 120ms ease"}})},t)})})})]})}function yr({open:e,message:t,type:s="success",durationMs:a=1800,onClose:n}){if(r.useEffect(()=>{if(!e)return;const t=window.setTimeout(n,a);return()=>window.clearTimeout(t)},[e,a,n]),!e)return null;const l="success"===s,i="error"===s;return T.jsx("div",{className:"fixed bottom-5 left-1/2 -translate-x-1/2 z-[80] px-4",children:T.jsxs("div",{className:["flex items-center gap-3 rounded-xl shadow-xl border px-4 py-3 w-[min(92vw,420px)]","bg-white dark:bg-gray-900",l?"border-green-200 dark:border-green-900/40":i?"border-red-200 dark:border-red-900/40":"border-gray-200 dark:border-gray-700"].join(" "),role:"status","aria-live":"polite",children:[l?T.jsx(Te,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):i?T.jsx(fe,{className:"w-5 h-5 text-red-600 dark:text-red-400"}):T.jsx(Te,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"}),T.jsx("div",{className:"flex-1 text-sm text-gray-900 dark:text-gray-100",children:t}),T.jsx("button",{type:"button",onClick:n,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200","aria-label":"é–‰ã˜ã‚‹",children:T.jsx(ar,{className:"w-4 h-4"})})]})})}function fr({userId:e,onSubmit:t,onCheckExisting:s,onUpdate:a,loading:n,lastRecord:l,weeklyAverage:i,daysWithData:o=0,consecutiveDays:d=0}){var c,u;const x=(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})(),[m,g]=r.useState(0),[h,p]=r.useState(0),[b,y]=r.useState(x),[f,v]=r.useState(50),[j,w]=r.useState(50),[N,k]=r.useState(!1),[_,S]=r.useState(""),[C,E]=r.useState(""),[D,M]=r.useState(null),[R,$]=r.useState(!1),[A,I]=r.useState(null),[z,P]=r.useState(null),[L,q]=r.useState(!1),[F,O]=r.useState("success"),[W,B]=r.useState(""),U=(e,t)=>{O(e),B(t),q(!0)},H=()=>{g(0),p(0),v(50),w(50),y(x)},V=()=>{const e=function(e,t){return 21===e?{title:"ğŸ‰ ACWRåˆ†æãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼",message:"3é€±é–“ã®ãƒ‡ãƒ¼ã‚¿è“„ç©å®Œäº†ã€‚ã“ã‚Œã‹ã‚‰ACWRã§æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’ç®¡ç†ã§ãã¾ã™ã€‚",type:"milestone",showConfetti:!0}:28===e?{title:"âœ¨ æ¨å¥¨æœŸé–“é”æˆï¼",message:"4é€±é–“ã®å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ãŒæƒã„ã¾ã—ãŸã€‚é«˜ç²¾åº¦ãªACWRåˆ†æãŒå¯èƒ½ã§ã™ã€‚",type:"milestone",showConfetti:!0}:7===e?{title:"ğŸ¯ 1é€±ç›®å®Œäº†ï¼",message:"é †èª¿ã§ã™ã€‚ã‚ã¨2é€±é–“ã§ACWRåˆ†æãŒå§‹ã¾ã‚Šã¾ã™ã€‚",type:"milestone"}:14===e?{title:"ğŸ“ˆ 2é€±ç›®å®Œäº†ï¼",message:"æŠ˜ã‚Šè¿”ã—åœ°ç‚¹ã‚’é€šéã€‚ã‚ã¨1é€±é–“ã§ACWRåˆ†æé–‹å§‹ã§ã™ã€‚",type:"milestone"}:3===t?{title:"ğŸ”¥ 3æ—¥é€£ç¶šè¨˜éŒ²ï¼",message:"ç¶™ç¶šã¯åŠ›ãªã‚Šã€‚ã“ã®èª¿å­ã§ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ã—ã¾ã—ã‚‡ã†ã€‚",type:"success"}:7===t?{title:"ğŸ’ª 1é€±é–“é€£ç¶šè¨˜éŒ²ï¼",message:"ç´ æ™´ã‚‰ã—ã„ç¿’æ…£åŒ–ã§ã™ã€‚ç¶™ç¶šçš„ãªè¨˜éŒ²ãŒæ­£ç¢ºãªåˆ†æã«ã¤ãªãŒã‚Šã¾ã™ã€‚",type:"success"}:14===t?{title:"â­ 2é€±é–“é€£ç¶šè¨˜éŒ²ï¼",message:"é©šç•°çš„ãªç¶™ç¶šåŠ›ã§ã™ã€‚ã‚‚ã†ã™ãACWRåˆ†æãŒå§‹ã¾ã‚Šã¾ã™ã€‚",type:"success"}:e%5==0&&e<21?{title:"è¨˜éŒ²ç¶™ç¶šä¸­",message:`${e}æ—¥ç›®ã®è¨˜éŒ²å®Œäº†ã€‚ACWRåˆ†æã¾ã§ã‚ã¨${21-e}æ—¥ã§ã™ã€‚`,type:"encouragement"}:null}(o+1,d+1);e&&(M(e),e.showConfetti&&or({particleCount:100,spread:70,origin:{y:.6}}))},K=()=>{$(!1),I(null),P(null)},J=(e,t)=>{if(0===e||0===t)return void E("");const r=e*t;i&&r>2*i.load?E("ã„ã¤ã‚‚ã®2å€ä»¥ä¸Šã®è² è·ã§ã™ã€‚å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"):i&&r>1.5*i.load?E("ã„ã¤ã‚‚ã‚ˆã‚Šé«˜ã„è² è·ã§ã™ã€‚"):E(r>1e3?"éå¸¸ã«é«˜ã„è² è·ã§ã™ã€‚å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚":"")};r.useEffect(()=>{if(!D)return;const e=setTimeout(()=>M(null),5e3);return()=>clearTimeout(e)},[D]);const Y=m*h;return T.jsxs(T.Fragment,{children:[T.jsx(yr,{open:L,type:F,message:W,onClose:()=>q(!1)}),T.jsx(mr,{isOpen:R,onClose:K,onOverwrite:async()=>{if(A&&z&&!N&&!n){k(!0),$(!1),S("");try{await a(A.id,{rpe:z.rpe,duration_min:z.duration_min,arrow_score:z.arrow_score,signal_score:z.signal_score}),V(),U("success","ä¸Šæ›¸ãã—ã¦ä¿å­˜ã—ã¾ã—ãŸ âœ…"),H(),I(null),P(null)}catch(e){console.error("Error updating record:",e),S("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ"),U("error","è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{k(!1)}}},onCancel:K,title:"ç·´ç¿’è¨˜éŒ²",date:b,existingValues:[{label:"RPE",value:(null==(c=null==A?void 0:A.rpe)?void 0:c.toString())||"-"},{label:"æ™‚é–“",value:`${(null==A?void 0:A.duration_min)||0}åˆ†`},{label:"çŸ¢å°",value:`${(null==A?void 0:A.arrow_score)??"-"} / 100`},{label:"é›»æ³¢",value:`${(null==A?void 0:A.signal_score)??"-"} / 100`}],newValues:[{label:"RPE",value:(null==(u=null==z?void 0:z.rpe)?void 0:u.toString())||"-"},{label:"æ™‚é–“",value:`${(null==z?void 0:z.duration_min)||0}åˆ†`},{label:"çŸ¢å°",value:`${(null==z?void 0:z.arrow_score)??"-"} / 100`},{label:"é›»æ³¢",value:`${(null==z?void 0:z.signal_score)??"-"} / 100`}]}),T.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!N&&!n){if(S(""),0===m&&h>0)return S("RPE 0ï¼ˆä¼‘é¤Šæ—¥ï¼‰ã®å ´åˆã¯ã€æ™‚é–“ã‚‚ 0 åˆ†ã«ã—ã¦ãã ã•ã„ã€‚"),void U("error","å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆä¼‘é¤Šæ—¥ã®ãƒ«ãƒ¼ãƒ«ï¼‰");if(m>0&&0===h)return S("RPE ãŒ 1 ä»¥ä¸Šã®ã¨ãã¯ã€ç·´ç¿’æ™‚é–“ã‚‚ 1 åˆ†ä»¥ä¸Šã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"),void U("error","å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆæ™‚é–“ãŒ 0 åˆ†ï¼‰");try{const e=await s(b);if(e)return I(e),P({rpe:m,duration_min:h,date:b,arrow_score:f,signal_score:j}),void $(!0)}catch(r){return console.error("Error checking existing training record:",r),S("æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ"),void U("error","æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ")}k(!0);try{await t({rpe:m,duration_min:h,date:b,arrow_score:f,signal_score:j}),V(),U("success","ç·´ç¿’è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ âœ…"),H()}catch(a){if(console.error("Error submitting training record:",a),a instanceof Error)if(a.message.includes("duplicate key value violates unique constraint")){const e=`${new Date(b).toLocaleDateString("ja-JP")}ã®è¨˜éŒ²ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚`;S(e),U("error",e)}else S(a.message||"è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),U("error",a.message||"è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ");else S("è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),U("error","è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{k(!1)}}},className:"space-y-6",children:[D&&T.jsx("div",{className:"rounded-lg border-2 p-4 animate-in slide-in-from-top-2 duration-300 "+("milestone"===D.type?"bg-green-50 dark:bg-green-900/20 border-green-500 dark:border-green-700":"success"===D.type?"bg-blue-50 dark:bg-blue-900/20 border-blue-500 dark:border-blue-700":"bg-purple-50 dark:bg-purple-900/20 border-purple-500 dark:border-purple-700"),children:T.jsxs("div",{className:"flex items-start gap-3",children:["milestone"===D.type?T.jsx(Re,{className:"w-6 h-6 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}):T.jsx(Lt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("h4",{className:"font-semibold text-base mb-1 "+("milestone"===D.type?"text-green-700 dark:text-green-300":"success"===D.type?"text-blue-700 dark:text-blue-300":"text-purple-700 dark:text-purple-300"),children:D.title}),T.jsx("p",{className:"text-sm "+("milestone"===D.type?"text-green-600 dark:text-green-400":"success"===D.type?"text-blue-600 dark:text-blue-400":"text-purple-600 dark:text-purple-400"),children:D.message})]})]})}),l&&T.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-sm",children:[T.jsx("p",{className:"text-blue-600 dark:text-blue-400 mb-1",children:"å‰å›ã®è¨˜éŒ²"}),T.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["RPE ",l.rpe??"-"," Ã— ",l.duration_min??"-","åˆ† = è² è·"," ",(l.rpe??0)*(l.duration_min??0)]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(De,{className:"w-4 h-4 mr-2"}),"æ—¥ä»˜"]}),T.jsx("input",{type:"date",value:b,onChange:e=>y(e.target.value),disabled:N||n,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(nr,{className:"w-4 h-4 mr-2"}),"RPEï¼ˆé‹å‹•å¼·åº¦ï¼‰"]}),T.jsx("input",{type:"range",min:"0",max:"10",value:m,onChange:e=>{const t=Number(e.target.value);g(t),J(t,h)},disabled:N||n,className:"w-full"}),T.jsx("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-200",children:["0 - ä¼‘é¤Šãƒ»ã¾ã£ãŸãé‹å‹•ã—ã¦ã„ãªã„","1 - éå¸¸ã«æ¥½ã§ã‚ã‚‹","2 - æ¥½ã§ã‚ã‚‹","3 - å°‘ã—ãã¤ã„","4 - ã‚„ã‚„ãã¤ã„","5 - ãã¤ã„","6 - ã•ã‚‰ã«ãã¤ã„","7 - ã¨ã¦ã‚‚ãã¤ã„","8 - ã‹ãªã‚Šãã¤ã„","9 - éå¸¸ã«ãã¤ã„","10 - æœ€å¤§é™ã«ãã¤ã„ (é™ç•Œ)"][m]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(Oe,{className:"w-4 h-4 mr-2"}),"ç·´ç¿’æ™‚é–“ï¼ˆåˆ†ï¼‰"]}),T.jsx("input",{type:"number",min:"0",max:"480",value:h,onChange:e=>{const t=Number(e.target.value);p(t),J(m,t)},disabled:N||n,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60",style:{fontSize:"16px"}}),T.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"â€» ä¼‘é¤Šæ—¥ã¯ã€ŒRPE=0 / æ™‚é–“=0ã€"})]}),T.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"ä»Šæ—¥ã®è² è·"}),T.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:Y})]})}),T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:[T.jsx(hr,{value:f,onChange:v}),T.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:["çŸ¢å°ï¼ˆæˆé•·å®Ÿæ„Ÿï¼‰: ",f,"/100"]})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:[T.jsx(br,{value:j,onChange:w}),T.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:["é›»æ³¢ï¼ˆæ„å›³ç†è§£ï¼‰: ",j,"/100"]})]})]}),C&&T.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg text-yellow-700 dark:text-yellow-300",children:[T.jsx(ye,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm",children:C})]}),_&&T.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300",children:[T.jsx(ye,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm",children:_})]}),T.jsxs("button",{type:"submit",disabled:n||N,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[T.jsx(kt,{className:"w-4 h-4 mr-2"}),N?"ä¿å­˜ä¸­...":"è¨˜éŒ²ã™ã‚‹"]})]})]})}function vr({daysWithData:e,isDarkMode:t}){const r=Math.min(e/28*100,100),s=e>=21,a=e>=28,n=(()=>{if(a)return{icon:Re,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",progressColor:"bg-green-500",title:"ACWRåˆ†æï¼šåˆ©ç”¨å¯èƒ½",message:"ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œã¾ã—ãŸã€‚ç²¾åº¦ã®é«˜ã„ACWRåˆ†æãŒå¯èƒ½ã§ã™ã€‚"};if(s)return{icon:ye,color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",progressColor:"bg-yellow-500",title:"ACWRåˆ†æï¼šåˆ©ç”¨å¯èƒ½ï¼ˆç²¾åº¦å‘ä¸Šä¸­ï¼‰",message:`ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆã‚‹ã»ã©ç²¾åº¦ãŒä¸ŠãŒã‚Šã¾ã™ã€‚ã‚ã¨${28-e}æ—¥ã§æ¨å¥¨æœŸé–“ã«åˆ°é”ã—ã¾ã™ã€‚`};{const t=Math.floor(e/7)+1;return{icon:De,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",progressColor:"bg-blue-500",title:`ãƒ‡ãƒ¼ã‚¿åé›†ä¸­ï¼ˆ${t}é€±ç›®ï¼‰`,message:`ACWRåˆ†æã¾ã§ã‚ã¨${21-e}æ—¥ã€‚ç¶™ç¶šã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼`}}})(),l=n.icon,i=()=>[{day:7,label:"1é€±ç›®",reached:e>=7},{day:14,label:"2é€±ç›®",reached:e>=14},{day:21,label:"3é€±ç›®\n(æœ€ä½ãƒ©ã‚¤ãƒ³)",reached:e>=21},{day:28,label:"4é€±ç›®\n(æ¨å¥¨)",reached:e>=28}];return T.jsxs("div",{className:`rounded-lg border ${n.borderColor} ${n.bgColor} p-4 sm:p-6`,children:[T.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[T.jsx(l,{className:`${n.color} flex-shrink-0 mt-0.5`,size:24}),T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("h3",{className:`font-semibold ${n.color} text-base sm:text-lg mb-1`,children:n.title}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n.message})]})]}),T.jsxs("div",{className:"space-y-3",children:[T.jsxs("div",{className:"flex items-center justify-between text-sm",children:[T.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["è¨˜éŒ²æ—¥æ•°: ",e,"æ—¥"]}),T.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[Math.round(r),"%"]})]}),T.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[T.jsx("div",{className:`absolute inset-y-0 left-0 ${n.progressColor} rounded-full transition-all duration-500 ease-out`,style:{width:`${r}%`}}),i().map(e=>{const t=e.day/28*100;return T.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white dark:bg-gray-600",style:{left:`${t}%`}},e.day)})]}),T.jsx("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:i().map(e=>T.jsxs("div",{className:"flex flex-col items-center "+(e.reached?"text-gray-700 dark:text-gray-300 font-medium":""),children:[T.jsx("span",{className:"whitespace-pre-line text-center leading-tight",children:e.label}),e.reached&&T.jsx(Re,{size:12,className:"text-green-500 mt-0.5"})]},e.day))})]}),!a&&T.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:T.jsxs("div",{className:"flex items-start gap-2",children:[T.jsx(Vt,{size:16,className:"text-gray-400 flex-shrink-0 mt-0.5"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ACWRã¯æ€¥æ€§è² è·ï¼ˆç›´è¿‘1é€±é–“ï¼‰ã¨æ…¢æ€§è² è·ï¼ˆéå»4é€±é–“ï¼‰ã®æ¯”ç‡ã§ã™ã€‚ ç¶™ç¶šçš„ãªè¨˜éŒ²ã§ã€ã‚ˆã‚Šæ­£ç¢ºãªæ€ªæˆ‘ãƒªã‚¹ã‚¯è©•ä¾¡ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚"})]})})]})}function jr({data:e,daysWithData:t=0,isDarkMode:s=!1,teamAverageData:x=[],showTeamAverage:m=!1}){const[g,h]=r.useState("month"),[p,b]=r.useState(m),y=t>=21,f=r.useMemo(()=>{if(0===e.length)return[];const t=new Date;let r;switch(g){case"week":r=new Date(t),r.setDate(t.getDate()-7);break;case"month":r=new Date(t),r.setDate(t.getDate()-30);break;case"quarter":r=new Date(t),r.setDate(t.getDate()-90);break;default:return e}return e.filter(e=>{const s=new Date(e.date);return s>=r&&s<=t})},[e,g]),v=r.useMemo(()=>{if(0===x.length)return[];const e=new Date;let t;switch(g){case"week":t=new Date(e),t.setDate(e.getDate()-7);break;case"month":t=new Date(e),t.setDate(e.getDate()-30);break;case"quarter":t=new Date(e),t.setDate(e.getDate()-90);break;default:return x}return x.filter(r=>{const s=new Date(r.date);return s>=t&&s<=e})},[x,g]);if(0===e.length)return T.jsxs("div",{className:"space-y-4",children:[t>0&&T.jsx(vr,{daysWithData:t,isDarkMode:s}),T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400",children:T.jsxs("div",{className:"text-center px-4",children:[T.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-sm",children:"ç·´ç¿’è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ACWRã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†"})]})})]});if(!y)return T.jsxs("div",{className:"space-y-4",children:[T.jsx(vr,{daysWithData:t,isDarkMode:s}),T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:T.jsxs("div",{className:"text-center px-4",children:[T.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ACWRåˆ†ææº–å‚™ä¸­"}),T.jsxs("p",{className:"text-sm",children:["ã‚ã¨",21-t,"æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã§ACWRåˆ†æãŒå§‹ã¾ã‚Šã¾ã™"]})]})})]});const j=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}(${["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][t.getDay()]})`},w=({active:e,payload:t,label:r})=>{if(!e||!t||0===t.length)return null;const s=t.find(e=>"å€‹äºº ACWR"===(null==e?void 0:e.name))||t.find(e=>"acwr"===(null==e?void 0:e.dataKey)),a=t.find(e=>"ãƒãƒ¼ãƒ å¹³å‡"===(null==e?void 0:e.name)),n=null==s?void 0:s.payload,l="number"==typeof(null==s?void 0:s.value)&&Number.isFinite(s.value)?s.value:"number"==typeof(null==n?void 0:n.acwr)?n.acwr:null,i=new Date(r),o=0===i.getDay()||6===i.getDay(),d=p?v.find(e=>e.date===r):null,c=d&&"number"==typeof d.acwr&&Number.isFinite(d.acwr)?d.acwr:"number"==typeof(null==a?void 0:a.value)&&Number.isFinite(a.value)?a.value:null;if(!n)return null;const u="number"==typeof l&&"number"==typeof c?l-c:null;return T.jsxs("div",{className:"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs",children:[T.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[T.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base",children:j(r)}),o&&T.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium",children:"é€±æœ«"})]}),T.jsxs("div",{className:"space-y-1 text-xs sm:text-sm",children:[T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"å€‹äºº ACWR:"}),T.jsx("span",{className:"font-semibold",style:{color:le(n.riskLevel)},children:"number"==typeof l?l.toFixed(2):"-"})]}),p&&null!=c&&T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"ãƒãƒ¼ãƒ å¹³å‡:"}),T.jsx("span",{className:"font-semibold text-purple-600",children:c.toFixed(2)})]}),p&&null!=u&&T.jsxs("p",{className:"flex justify-between text-xs",children:[T.jsx("span",{children:"å·®:"}),T.jsxs("span",{className:"font-semibold "+(u>.3?"text-red-600":"text-gray-600"),children:[u>0?"+":"",u.toFixed(2)]})]}),T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"æ€¥æ€§è² è·:"}),T.jsx("span",{className:"font-semibold",children:n.acuteLoad??"-"})]}),T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"æ…¢æ€§è² è·:"}),T.jsx("span",{className:"font-semibold",children:n.chronicLoad??"-"})]}),T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"ãƒªã‚¹ã‚¯:"}),T.jsx("span",{className:"font-semibold",style:{color:le(n.riskLevel)},children:wr(n.riskLevel)})]})]})]})},N=e=>{const{cx:t,cy:r,payload:s}=e;if(t&&r&&s){const e=new Date(s.date),a=0===e.getDay()||6===e.getDay();return T.jsx("circle",{cx:t,cy:r,r:a?5:4,fill:le(s.riskLevel),strokeWidth:2,stroke:a?"#3B82F6":"white",opacity:a?.9:1})}return null};return T.jsxs("div",{className:"w-full space-y-4",children:[t<28&&T.jsx(vr,{daysWithData:t,isDarkMode:s}),T.jsxs("div",{className:"mb-4 space-y-3",children:[T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx(De,{className:"w-5 h-5 text-gray-500"}),T.jsx("span",{className:"text-sm font-medium text-gray-700",children:"è¡¨ç¤ºæœŸé–“"})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),T.jsx("div",{className:"flex space-x-1",children:[{value:"week",label:"1é€±é–“"},{value:"month",label:"1ãƒ¶æœˆ"},{value:"quarter",label:"3ãƒ¶æœˆ"},{value:"all",label:"å…¨æœŸé–“"}].map(e=>T.jsx("button",{onClick:()=>h(e.value),className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors "+(g===e.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))})]}),T.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:T.jsxs("div",{className:"flex items-center justify-between text-sm text-blue-700",children:[T.jsxs("div",{children:[T.jsx("span",{className:"font-medium",children:"è¡¨ç¤ºä¸­:"})," ",f.length,"æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿","all"!==g&&T.jsxs("span",{className:"ml-2",children:["(","week"===g?"éå»7æ—¥é–“":"month"===g?"éå»30æ—¥é–“":"éå»90æ—¥é–“",")"]})]}),T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full border-2 border-blue-600"}),T.jsx("span",{className:"text-xs",children:"é€±æœ«ã¯é’ã„æ ã§å¼·èª¿"})]})]})}),x.length>0&&T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("button",{onClick:()=>b(!p),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(p?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"),children:p?"ãƒãƒ¼ãƒ å¹³å‡ã‚’éè¡¨ç¤º":"ãƒãƒ¼ãƒ å¹³å‡ã¨æ¯”è¼ƒ"}),p&&T.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ç´«è‰²ã®ç‚¹ç·šãŒãƒãƒ¼ãƒ å¹³å‡ã§ã™"})]})]}),T.jsx("div",{className:"h-64 sm:h-96",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:f,margin:{top:20,right:30,left:20,bottom:20},children:[T.jsx(l,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),T.jsx(i,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},stroke:"#6b7280",fontSize:10,interval:"preserveStartEnd"}),T.jsx(o,{domain:[0,"dataMax + 0.5"],stroke:"#6b7280",fontSize:10,width:40}),T.jsx(d,{content:T.jsx(w,{})}),T.jsx(c,{y:1.5,stroke:"#EF4444",strokeDasharray:"5 5"}),T.jsx(c,{y:1.3,stroke:"#F59E0B",strokeDasharray:"5 5"}),T.jsx(c,{y:.8,stroke:"#10B981",strokeDasharray:"5 5"}),T.jsx(u,{type:"monotone",dataKey:"acwr",stroke:"#6366f1",strokeWidth:2,dot:T.jsx(N,{}),activeDot:{r:6,stroke:"#6366f1",strokeWidth:2,fill:"white"},name:"å€‹äºº ACWR"}),p&&v.length>0&&T.jsx(u,{type:"monotone",data:v,dataKey:"acwr",stroke:"#9333ea",strokeWidth:2,strokeDasharray:"5 5",dot:{r:3,fill:"#9333ea",stroke:"#9333ea"},activeDot:{r:5,stroke:"#9333ea",strokeWidth:2,fill:"white"},name:"ãƒãƒ¼ãƒ å¹³å‡"})]})})}),T.jsx("div",{className:"mt-4 flex justify-center",children:T.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs",children:[T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),T.jsx("span",{children:"é«˜ãƒªã‚¹ã‚¯ (>1.5)"})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),T.jsx("span",{children:"æ³¨æ„ (1.3-1.5)"})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),T.jsx("span",{children:"è‰¯å¥½ (0.8-1.3)"})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),T.jsx("span",{children:"ä½è² è· (<0.8)"})]})]})})]})}function wr(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"good":return"è‰¯å¥½";case"low":return"ä½è² è·";default:return"ä¸æ˜"}}function Nr({record:e,onClose:t,onUpdate:s,onDelete:a,allowDateEdit:n=!1,allowDelete:l=!1}){const[i,o]=r.useState({rpe:e.rpe,duration_min:e.duration_min,date:e.date}),[d,c]=r.useState(!1),[u,x]=r.useState(""),[m,g]=r.useState(!1);return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:T.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[T.jsx("div",{className:"bg-blue-600 text-white p-6 rounded-t-2xl",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("div",{className:"bg-blue-500 rounded-full p-2",children:T.jsx(De,{className:"w-6 h-6"})}),T.jsxs("div",{children:[T.jsx("h2",{className:"text-xl font-bold",children:"ç·´ç¿’è¨˜éŒ²ã‚’ç·¨é›†"}),T.jsxs("p",{className:"text-blue-100",children:[new Date(e.date).toLocaleDateString("ja-JP"),"ã®è¨˜éŒ²"]})]})]}),T.jsx("button",{onClick:t,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:T.jsx(ar,{className:"w-5 h-5"})})]})}),T.jsxs("div",{className:"p-6",children:[T.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[T.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"ç¾åœ¨ã®å€¤"}),T.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center text-sm",children:[T.jsxs("div",{children:[T.jsx("div",{className:"text-gray-600",children:"RPE"}),T.jsx("div",{className:"font-bold text-lg text-blue-600",children:e.rpe})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-gray-600",children:"æ™‚é–“"}),T.jsxs("div",{className:"font-bold text-lg text-green-600",children:[e.duration_min,"åˆ†"]})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-gray-600",children:"è² è·"}),T.jsx("div",{className:"font-bold text-lg text-purple-600",children:e.load})]})]})]}),T.jsxs("form",{onSubmit:async r=>{r.preventDefault(),c(!0),x("");try{const r={rpe:i.rpe,duration_min:i.duration_min};n&&i.date!==e.date&&(r.date=i.date),await s(e.id,r),t()}catch(a){console.error("Error updating record:",a),x(a.message||"æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{c(!1)}},className:"space-y-6",children:[n&&T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[T.jsx(De,{className:"w-4 h-4 mr-2"}),"ç·´ç¿’æ—¥"]}),T.jsx("input",{type:"date",value:i.date,onChange:e=>o(t=>({...t,date:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[T.jsx(nr,{className:"w-4 h-4 mr-2"}),"RPEï¼ˆé‹å‹•å¼·åº¦ï¼‰"]}),T.jsxs("div",{className:"space-y-3",children:[T.jsx("input",{type:"range",min:"0",max:"10",value:i.rpe,onChange:e=>o(t=>({...t,rpe:Number(e.target.value)})),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{WebkitAppearance:"none",background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${i.rpe/10*100}%, #9ca3af ${i.rpe/10*100}%, #9ca3af 100%)`}}),T.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[T.jsx("span",{children:"0"}),T.jsx("span",{children:"5"}),T.jsx("span",{children:"10"})]}),T.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[T.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:i.rpe}),T.jsx("div",{className:"text-sm text-blue-700",children:["0 - ã¾ã£ãŸãæ¥½ã§ã‚ã‚‹","1 - éå¸¸ã«æ¥½ã§ã‚ã‚‹","2 - æ¥½ã§ã‚ã‚‹","3 - å°‘ã—ãã¤ã„","4 - ã‚„ã‚„ãã¤ã„","5 - ãã¤ã„","6 - ã•ã‚‰ã«ãã¤ã„","7 - ã¨ã¦ã‚‚ãã¤ã„","8 - ã‹ãªã‚Šãã¤ã„","9 - éå¸¸ã«ãã¤ã„","10 - æœ€å¤§é™ã«ãã¤ã„ (é™ç•Œ)"][i.rpe]})]})]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[T.jsx(Oe,{className:"w-4 h-4 mr-2"}),"ç·´ç¿’æ™‚é–“ï¼ˆåˆ†ï¼‰"]}),T.jsx("input",{type:"number",min:"1",max:"480",value:i.duration_min,onChange:e=>o(t=>({...t,duration_min:Number(e.target.value)})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base",style:{fontSize:"16px"}})]}),T.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[T.jsxs("div",{className:"flex justify-between items-center mb-2",children:[T.jsx("span",{className:"text-sm text-gray-600",children:"æ–°ã—ã„è² è·å€¤"}),T.jsx("span",{className:"text-lg font-semibold text-gray-900",children:i.rpe*i.duration_min})]}),T.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[T.jsxs("span",{children:["å¤‰æ›´å‰: ",e.load]}),T.jsx("span",{className:"font-medium "+(i.rpe*i.duration_min>e.load?"text-red-600":i.rpe*i.duration_min<e.load?"text-blue-600":"text-gray-600"),children:i.rpe*i.duration_min>e.load?"å¢—åŠ ":i.rpe*i.duration_min<e.load?"æ¸›å°‘":"å¤‰æ›´ãªã—"})]})]}),u&&T.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:[T.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),T.jsx("span",{className:"text-sm",children:u})]}),T.jsxs("div",{className:"flex space-x-3",children:[l&&a&&T.jsxs("button",{type:"button",onClick:()=>g(!0),className:"bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center space-x-2",children:[T.jsx(Ut,{className:"w-4 h-4"}),T.jsx("span",{children:"å‰Šé™¤"})]}),T.jsx("button",{type:"button",onClick:t,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsxs("button",{type:"submit",disabled:d,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[d?T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):T.jsx(Dt,{className:"w-4 h-4 mr-2"}),d?"æ›´æ–°ä¸­...":"æ›´æ–°"]})]})]})]}),m&&T.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 rounded-2xl",children:T.jsx("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",children:T.jsxs("div",{className:"text-center",children:[T.jsx(Ut,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),T.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"}),T.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:[new Date(e.date).toLocaleDateString("ja-JP"),"ã®ç·´ç¿’è¨˜éŒ²ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"]}),T.jsxs("div",{className:"flex space-x-3",children:[T.jsx("button",{onClick:()=>g(!1),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:async()=>{if(a){c(!0),x("");try{await a(e.id),t()}catch(r){console.error("Error deleting record:",r),x(r.message||"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{c(!1)}}},disabled:d,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50",children:"å‰Šé™¤ã™ã‚‹"})]})]})})})]})})}const kr=x.memo(function({records:e,onUpdate:t,onDelete:s,loading:a=!1,allowEdit:n=!0,allowDelete:l=!1,allowDateEdit:i=!1,showLimited:o=!1,limitCount:d=10}){const[c,u]=r.useState(null),[x,m]=r.useState(!1),[g,h]=r.useState(!1),p=r.useMemo(()=>o&&!g?e.slice(-d):e,[e,o,g,d]),b=r.useMemo(()=>[...p].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[p]),y=r.useCallback(e=>{u(e),m(!0)},[]),f=r.useCallback(()=>{m(!1),u(null)},[]),v=e=>e>=8?"text-red-600 dark:text-red-400":e>=6?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400";return a?T.jsx("div",{className:"space-y-3",children:[1,2,3].map(e=>T.jsx("div",{className:"animate-pulse",children:T.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded-lg"})},e))}):0===e.length?T.jsxs("div",{className:"text-center py-8",children:[T.jsx(De,{className:"w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),T.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"ç·´ç¿’è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"æœ€åˆã®ç·´ç¿’è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"})]}):T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"ç·´ç¿’è¨˜éŒ²"}),o&&e.length>d&&T.jsxs("button",{onClick:()=>h(!g),className:"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 flex items-center space-x-1",children:[T.jsx("span",{children:g?`æœ€æ–°${d}ä»¶ã®ã¿è¡¨ç¤º`:`å…¨${e.length}ä»¶ã‚’è¡¨ç¤º`}),g?T.jsx(Pe,{className:"w-4 h-4"}):T.jsx(Ae,{className:"w-4 h-4"})]})]}),T.jsx("div",{className:"space-y-3",children:b.map(e=>T.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[T.jsx("div",{className:"block sm:hidden",children:T.jsxs("div",{className:"flex items-center justify-between mb-3",children:[T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[T.jsx(De,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),T.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:new Date(e.date).toLocaleDateString("ja-JP")})]}),T.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"RPE"}),T.jsx("div",{className:`font-bold ${v(e.rpe)}`,children:e.rpe})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"æ™‚é–“"}),T.jsxs("div",{className:"font-bold text-blue-600 dark:text-blue-400",children:[e.duration_min,"åˆ†"]})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"è² è·"}),T.jsx("div",{className:"font-bold text-purple-600 dark:text-purple-400",children:e.load})]})]})]}),n&&T.jsx("button",{onClick:()=>y(e),className:"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors ml-2",title:"ç·¨é›†",children:T.jsx(qt,{className:"w-4 h-4"})})]})}),T.jsxs("div",{className:"hidden sm:flex items-center justify-between",children:[T.jsxs("div",{className:"flex-1 grid grid-cols-4 gap-6",children:[T.jsxs("div",{className:"flex items-center",children:[T.jsx(De,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 mr-2"}),T.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:new Date(e.date).toLocaleDateString("ja-JP")})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"RPE"}),T.jsx("div",{className:`text-xl font-bold ${v(e.rpe)}`,children:e.rpe})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"æ™‚é–“"}),T.jsxs("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:[e.duration_min,"åˆ†"]})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"è² è·"}),T.jsx("div",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:e.load})]})]}),n&&T.jsxs("div",{className:"flex space-x-2 ml-4",children:[T.jsx("button",{onClick:()=>y(e),className:"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors",title:"ç·¨é›†",children:T.jsx(qt,{className:"w-4 h-4"})}),l&&T.jsx("button",{onClick:()=>y(e),className:"bg-red-50 hover:bg-red-100 text-red-600 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-300 p-2 rounded-lg transition-colors",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"w-4 h-4"})})]})]})]},e.id))}),o&&e.length>d&&!g&&T.jsx("div",{className:"text-center pt-4",children:T.jsxs("button",{className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",onClick:()=>h(!0),children:["ã•ã‚‰ã«",e.length-d,"ä»¶ã®è¨˜éŒ²ã‚’è¡¨ç¤º"]})}),x&&c&&T.jsx(Nr,{record:c,onClose:f,onUpdate:t,onDelete:l?s:void 0,allowDateEdit:i,allowDelete:l})]})});function _r({alerts:e,onViewAll:t,className:s=""}){const[a,n]=r.useState(!1);r.useEffect(()=>{const e=localStorage.getItem("alertSummaryDismissed"),t=e?parseInt(e,10):0,r=Date.now(),s=36e5;t&&r-t<s?n(!0):t&&r-t>=s&&localStorage.removeItem("alertSummaryDismissed")},[]);const l=e.filter(e=>!e.is_dismissed),i=l.filter(e=>"high"===e.priority),o=l.filter(e=>!e.is_read);return a||0===l.length?null:T.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${s}`,children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center",children:[T.jsx(fe,{className:"w-5 h-5 text-orange-500 mr-2"}),"ã‚¢ãƒ©ãƒ¼ãƒˆæ¦‚è¦"]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("button",{onClick:t,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"å…¨ã¦è¡¨ç¤º"}),T.jsx("button",{onClick:()=>{n(!0),localStorage.setItem("alertSummaryDismissed",Date.now().toString())},className:"text-gray-400 hover:text-gray-600 transition-colors",title:"1æ™‚é–“éè¡¨ç¤º",children:T.jsx(ar,{className:"w-5 h-5"})})]})]}),T.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-red-600",children:i.length}),T.jsx("div",{className:"text-xs text-gray-600",children:"é«˜å„ªå…ˆåº¦"})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.length}),T.jsx("div",{className:"text-xs text-gray-600",children:"æœªèª­"})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-gray-600",children:l.length}),T.jsx("div",{className:"text-xs text-gray-600",children:"åˆè¨ˆ"})]})]}),i.length>0&&T.jsxs("div",{className:"space-y-2",children:[T.jsxs("h4",{className:"text-sm font-medium text-gray-700 flex items-center",children:[T.jsx(fe,{className:"w-4 h-4 text-red-500 mr-1"}),"ç·Šæ€¥å¯¾å¿œãŒå¿…è¦"]}),i.slice(0,3).map(e=>{const t=Q(e);return T.jsx("div",{className:`${t.bgColor} ${t.borderColor} border rounded p-3`,children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[T.jsx("span",{className:"text-sm",children:t.icon}),T.jsx("h5",{className:`font-medium text-sm ${t.textColor}`,children:e.title}),!e.is_read&&T.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"})]}),T.jsx("p",{className:`text-xs ${t.textColor} line-clamp-2`,children:e.message}),e.acwr_value&&T.jsxs("div",{className:"mt-1",children:[T.jsx("span",{className:"text-xs text-gray-600",children:"ACWR: "}),T.jsx("span",{className:`text-xs font-bold ${t.textColor}`,children:e.acwr_value})]})]}),T.jsx("div",{className:"ml-2",children:T.jsx(Oe,{className:"w-3 h-3 text-gray-400"})})]})},e.id)}),i.length>3&&T.jsx("div",{className:"text-center",children:T.jsxs("button",{onClick:t,className:"text-xs text-red-600 hover:text-red-700 font-medium",children:["ä»– ",i.length-3,"ä»¶ã®é«˜å„ªå…ˆåº¦ã‚¢ãƒ©ãƒ¼ãƒˆ"]})})]}),T.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:T.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[T.jsx(lt,{className:"w-3 h-3 mr-1"}),T.jsx("span",{children:"ã‚¢ãƒ©ãƒ¼ãƒˆã¯5åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™"})]})})]})}function Sr({onSubmit:e,onCheckExisting:t,onUpdate:s,loading:a,lastRecord:n}){const l=r.useMemo(()=>H(),[]),[i,o]=r.useState(""),[d,c]=r.useState(l),[u,x]=r.useState(""),[m,g]=r.useState(!1),[h,p]=r.useState(""),[b,y]=r.useState(!1),[f,v]=r.useState(null),[j,w]=r.useState(null),[N,k]=r.useState(!1),[_,S]=r.useState("success"),[C,E]=r.useState(""),D=(e,t)=>{S(e),E(t),k(!0)},M=()=>{o(""),x(""),c(l)};r.useEffect(()=>{n&&""===i.trim()&&o(String(n.weight_kg??""))},[n,i]),r.useEffect(()=>{(async()=>{p("");try{const e=await t(d);v(e),e?(o(String(e.weight_kg??"")),x(e.notes??""),D("success","ã“ã®æ—¥ã®ä½“é‡è¨˜éŒ²ã¯æ—¢ã«ã‚ã‚Šã¾ã™ï¼ˆç·¨é›†ã§ãã¾ã™ï¼‰")):x("")}catch(e){console.error("Error checking existing weight record:",e),v(null),p("æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ"),D("error","æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ")}})()},[d]);const R=()=>{y(!1),v(null),w(null)};return T.jsxs(T.Fragment,{children:[T.jsx(yr,{open:N,type:_,message:C,onClose:()=>k(!1)}),T.jsx(mr,{isOpen:b,onClose:R,onOverwrite:async()=>{if(f&&j&&!m&&!a){g(!0),y(!1),p("");try{await s(f.id,{weight_kg:j.weight_kg,notes:j.notes}),D("success","ä¸Šæ›¸ãã—ã¦ä¿å­˜ã—ã¾ã—ãŸ âœ…"),M(),v(null),w(null)}catch(e){console.error("Error updating record:",e),p("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ"),D("error","è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{g(!1)}}},onCancel:R,title:"ä½“é‡è¨˜éŒ²",date:d,existingValues:[{label:"ä½“é‡",value:`${(null==f?void 0:f.weight_kg)||0} kg`}],newValues:[{label:"ä½“é‡",value:`${(null==j?void 0:j.weight_kg)||0} kg`}]}),T.jsxs("form",{onSubmit:async r=>{if(r.preventDefault(),m||a)return;p("");const s=parseFloat(i);if(isNaN(s)||s<=0||s>=500)return p("ä½“é‡ã¯0ã€œ500kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"),void D("error","å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆä½“é‡ã®ç¯„å›²ï¼‰");let n=null;try{n=await t(d)}catch(l){return console.error("Error checking existing weight record:",l),p("æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ"),void D("error","æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ")}if(n)return v(n),w({weight_kg:s,date:d,notes:u.trim()||void 0}),void y(!0);g(!0);try{await e({weight_kg:s,date:d,notes:u.trim()||void 0}),D("success","ä½“é‡è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ âœ…"),M()}catch(l){console.error("Error submitting weight record:",l);const e=l instanceof Error&&l.message||"è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";p(e),D("error",e)}finally{g(!1)}},className:"space-y-6",children:[T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[T.jsx(De,{className:"w-4 h-4 mr-2"}),"æ¸¬å®šæ—¥"]}),T.jsx("input",{type:"date",value:d,onChange:e=>c(e.target.value),max:l,disabled:m||a,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60",style:{fontSize:"16px"}}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d===l?"ä»Šæ—¥ã®ä½“é‡è¨˜éŒ²":"éå»ã®ä½“é‡è¨˜éŒ²"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[T.jsx(Mt,{className:"w-4 h-4 mr-2"}),"ä½“é‡ï¼ˆkgï¼‰"]}),T.jsx("input",{type:"number",step:"0.1",min:"1",max:"499",value:i,onChange:e=>o(e.target.value),disabled:m||a,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60",placeholder:"65.5",required:!0,style:{fontSize:"16px"}}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å°æ•°ç‚¹ç¬¬1ä½ã¾ã§å…¥åŠ›å¯èƒ½ï¼ˆä¾‹: 65.5kgï¼‰"}),n&&T.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["å‰å›: ",Number(n.weight_kg).toFixed(1)," kgï¼ˆ",new Date(n.date).toLocaleDateString("ja-JP"),"ï¼‰"]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[T.jsx(Xe,{className:"w-4 h-4 mr-2"}),"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"]}),T.jsx("textarea",{value:u,onChange:e=>x(e.target.value),disabled:m||a,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60",placeholder:"ä½“èª¿ã‚„é£Ÿäº‹ã®è¨˜éŒ²ãªã©...",rows:3,maxLength:500,style:{fontSize:"16px"}}),T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[u.length,"/500æ–‡å­—"]})]}),h&&T.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(ye,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),T.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:h})]})}),T.jsx("button",{type:"submit",disabled:m||a||!i,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center touch-target",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:m?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"è¨˜éŒ²ä¸­..."]}):T.jsxs(T.Fragment,{children:[T.jsx(Mt,{className:"w-5 h-5 mr-2"}),"ä½“é‡ã‚’è¨˜éŒ²"]})})]})]})}function Cr({data:e}){const t=e.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).map(e=>({date:e.date,weight:Number(e.weight_kg),displayDate:new Date(e.date).toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}));if(0===t.length)return T.jsx("div",{className:"h-64 sm:h-80 flex items-center justify-center text-gray-500 dark:text-gray-400",children:"ä½“é‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"});const r=t.map(e=>e.weight),s=Math.min(...r),c=Math.max(...r),x=c-s,g=Math.max(0,s-.1*x),h=c+.1*x;return T.jsxs("div",{className:"h-64 sm:h-80",children:[T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:t,margin:{top:5,right:20,left:0,bottom:5},children:[T.jsx(l,{strokeDasharray:"3 3",stroke:"#e5e7eb",className:"dark:stroke-gray-700"}),T.jsx(i,{dataKey:"displayDate",stroke:"#6b7280",style:{fontSize:"12px"},tick:{fill:"currentColor"},className:"dark:text-gray-400"}),T.jsx(o,{stroke:"#6b7280",style:{fontSize:"12px"},tick:{fill:"currentColor"},className:"dark:text-gray-400",domain:[g,h],tickFormatter:e=>`${e.toFixed(1)}`,label:{value:"ä½“é‡ (kg)",angle:-90,position:"insideLeft",fill:"#6b7280"}}),T.jsx(d,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"},labelStyle:{color:"#374151",fontWeight:600},formatter:e=>[`${e.toFixed(1)} kg`,"ä½“é‡"],labelFormatter:e=>{const r=t.find(t=>t.displayDate===e);return r?new Date(r.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}):e}}),T.jsx(m,{wrapperStyle:{paddingTop:"20px"},iconType:"line"}),T.jsx(u,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"ä½“é‡ (kg)"})]})}),t.length>1&&T.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-6 text-sm",children:[T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),T.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["æœ€å°: ",s.toFixed(1)," kg"]})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),T.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["æœ€å¤§: ",c.toFixed(1)," kg"]})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),T.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["å¤‰åŒ–: ",(c-s).toFixed(1)," kg"]})]})]})]})}function Er({records:e,onUpdate:t,onDelete:s,loading:a}){const[n,l]=r.useState(null),[i,o]=r.useState(""),[d,c]=r.useState(""),u=()=>{l(null),o(""),c("")};return a?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):0===e.length?T.jsxs("div",{className:"text-center py-12",children:[T.jsx(Mt,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),T.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"ä½“é‡è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„"})]}):T.jsxs("div",{className:"space-y-4",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ä½“é‡è¨˜éŒ²å±¥æ­´"}),T.jsx("div",{className:"space-y-3",children:e.map(e=>T.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:n===e.id?T.jsxs("div",{className:"space-y-3",children:[T.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[T.jsxs("div",{children:[T.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"æ¸¬å®šæ—¥"}),T.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:[T.jsx(De,{className:"w-4 h-4 mr-2"}),new Date(e.date).toLocaleDateString("ja-JP")]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"ä½“é‡ï¼ˆkgï¼‰"}),T.jsx("input",{type:"number",step:"0.1",min:"1",max:"499",value:i,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white",style:{fontSize:"16px"}})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"ãƒ¡ãƒ¢"}),T.jsx("textarea",{value:d,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white resize-none",rows:2,maxLength:500,style:{fontSize:"16px"}})]}),T.jsxs("div",{className:"flex space-x-2",children:[T.jsx("button",{onClick:()=>(async e=>{const r=parseFloat(i);if(isNaN(r)||r<=0||r>=500)alert("ä½“é‡ã¯0ã€œ500kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");else try{await t(e,{weight_kg:r,notes:d.trim()||void 0}),l(null),o(""),c("")}catch(s){console.error("Error updating weight record:",s),alert("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(e.id),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"ä¿å­˜"}),T.jsx("button",{onClick:u,className:"flex-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors text-sm font-medium",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]}):T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1 space-y-2",children:[T.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[T.jsx(De,{className:"w-4 h-4 mr-2"}),new Date(e.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx(Mt,{className:"w-5 h-5 mr-2 text-blue-600 dark:text-blue-400"}),T.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.weight_kg}),T.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-400 ml-1",children:"kg"})]}),e.notes&&T.jsxs("div",{className:"flex items-start text-sm text-gray-600 dark:text-gray-400 mt-2",children:[T.jsx(Xe,{className:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),T.jsx("span",{className:"whitespace-pre-wrap",children:e.notes})]})]}),T.jsxs("div",{className:"flex space-x-2 ml-4",children:[T.jsx("button",{onClick:()=>(e=>{l(e.id),o(e.weight_kg.toString()),c(e.notes||"")})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors",title:"ç·¨é›†",children:T.jsx(Ue,{className:"w-4 h-4"})}),T.jsx("button",{onClick:()=>(async(e,t)=>{if(confirm(`${new Date(t).toLocaleDateString("ja-JP")}ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`))try{await s(e)}catch(r){console.error("Error deleting weight record:",r),alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(e.id,e.date),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"w-4 h-4"})})]})]})},e.id))})]})}function Dr({acwrData:e,weightData:t}){const r=e.map(e=>{const r=t.find(t=>t.date===e.date);return{date:new Date(e.date).toLocaleDateString("ja-JP",{month:"numeric",day:"numeric"}),fullDate:e.date,acwr:Number(e.acwr),weight:r?Number(r.weight_kg):null}});if(0===r.length)return T.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"});const s=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return T.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[T.jsx("p",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:e.fullDate}),t.map((e,t)=>T.jsxs("p",{className:"text-sm",style:{color:e.color},children:[e.name,": ",null!==e.value?Number(e.value).toFixed(2):"-"]},t))]})}return null};return T.jsx("div",{className:"w-full h-96",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[T.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),T.jsx(i,{dataKey:"date",stroke:"#6B7280",tick:{fill:"#6B7280"}}),T.jsx(o,{yAxisId:"left",stroke:"#3B82F6",tick:{fill:"#3B82F6"},label:{value:"ACWR",angle:-90,position:"insideLeft",fill:"#3B82F6"}}),T.jsx(o,{yAxisId:"right",orientation:"right",stroke:"#10B981",tick:{fill:"#10B981"},label:{value:"ä½“é‡ (kg)",angle:90,position:"insideRight",fill:"#10B981"}}),T.jsx(d,{content:T.jsx(s,{})}),T.jsx(m,{wrapperStyle:{paddingTop:"20px"}}),T.jsx(u,{yAxisId:"left",type:"monotone",dataKey:"acwr",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",r:4},name:"ACWR",connectNulls:!0}),T.jsx(u,{yAxisId:"right",type:"monotone",dataKey:"weight",stroke:"#10B981",strokeWidth:2,dot:{fill:"#10B981",r:4},name:"ä½“é‡ (kg)",connectNulls:!0})]})})})}function Mr({acwrData:e,weightData:t}){const r=(()=>{const r=[];if(t.length<2||e.length<2)return[{type:"info",title:"ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ä¸­",description:"ã‚‚ã†å°‘ã—ãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œã‚‹ã¨ã€ä½“é‡ã¨ACWRã®é–¢é€£æ€§ã‚’åˆ†æã§ãã¾ã™ã€‚",icon:T.jsx(lt,{className:"w-5 h-5"})}];const s=[...t].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),a=s.slice(-7);if(a.length>=2){const t=Number(a[0].weight_kg),s=Number(a[a.length-1].weight_kg)-t,n=(s/t*100).toFixed(1);if(Math.abs(s)>=2){const t=e.slice(-7).filter(e=>"high"===e.riskLevel||"caution"===e.riskLevel).length;s<0&&t>=2?r.push({type:"warning",title:"æ³¨æ„: ä½“é‡æ¸›å°‘ã¨é«˜è² è·ã®çµ„ã¿åˆã‚ã›",description:`æœ€è¿‘1é€±é–“ã§ä½“é‡ãŒ${Math.abs(s).toFixed(1)}kgæ¸›å°‘ã—ã€åŒæ™‚ã«ACWRãƒªã‚¹ã‚¯ãŒé«˜ã„æ—¥ãŒ${t}æ—¥ã‚ã‚Šã¾ã—ãŸã€‚ç–²åŠ´è“„ç©ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚`,icon:T.jsx(fe,{className:"w-5 h-5"})}):Math.abs(s)>=2&&r.push({type:"info",title:`ä½“é‡ãŒ${s>0?"å¢—åŠ ":"æ¸›å°‘"}å‚¾å‘`,description:`æœ€è¿‘1é€±é–“ã§${n}%ï¼ˆ${s>0?"+":""}${s.toFixed(1)}kgï¼‰å¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚`,icon:s>0?T.jsx(Vt,{className:"w-5 h-5"}):T.jsx(Ht,{className:"w-5 h-5"})})}}const n=e.slice(-30),l=n.filter(e=>"good"===e.riskLevel).length,i=n.filter(e=>"high"===e.riskLevel).length;if(l>=20&&t.length>=10){const e=s.slice(-10),t=e.reduce((e,t)=>e+Number(t.weight_kg),0)/e.length;e.reduce((e,r)=>e+Math.pow(Number(r.weight_kg)-t,2),0)/e.length<1&&r.push({type:"success",title:"è‰¯å¥½ãªãƒãƒ©ãƒ³ã‚¹",description:"ä½“é‡ãŒå®‰å®šã—ã€ACWRã‚‚è‰¯å¥½ãªç¯„å›²ã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¹ã‚’ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚",icon:T.jsx(ot,{className:"w-5 h-5"})})}i>=5&&r.push({type:"warning",title:"é«˜è² è·ã®æ—¥ãŒå¤šã‚",description:`éå»30æ—¥é–“ã§${i}æ—¥ãŒé«˜ãƒªã‚¹ã‚¯ã§ã—ãŸã€‚ä¼‘é¤Šã¨æ „é¤Šè£œçµ¦ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚`,icon:T.jsx(fe,{className:"w-5 h-5"})});const o=s.map(e=>Number(e.weight_kg));if(o.length>=14){const t=o.slice(0,7),s=o.slice(-7),a=t.reduce((e,t)=>e+t,0)/t.length,n=s.reduce((e,t)=>e+t,0)/s.length,l=e.slice(0,7).map(e=>Number(e.acwr)),i=e.slice(-7).map(e=>Number(e.acwr)),d=l.reduce((e,t)=>e+t,0)/l.length,c=i.reduce((e,t)=>e+t,0)/i.length;n<a-1&&c>d+.2&&r.push({type:"discovery",title:"ç™ºè¦‹: ä½“é‡æ¸›å°‘æ™‚ã«ACWRä¸Šæ˜‡",description:"ä½“é‡ãŒæ¸›å°‘ã—ã¦ã„ã‚‹æœŸé–“ã¯ã€ACWRãŒé«˜ããªã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚æ „é¤Šè£œçµ¦ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚",icon:T.jsx(ot,{className:"w-5 h-5"})})}return 0===r.length&&r.push({type:"info",title:"é †èª¿ã§ã™",description:"ç¾åœ¨ã®ã¨ã“ã‚ã€ç‰¹ã«æ³¨æ„ã™ã¹ãç‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ãƒšãƒ¼ã‚¹ã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚",icon:T.jsx(lt,{className:"w-5 h-5"})}),r})();return T.jsxs("div",{className:"space-y-4",children:[T.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[T.jsx(ot,{className:"w-5 h-5 mr-2 text-yellow-500"}),"ã‚¤ãƒ³ã‚µã‚¤ãƒˆ"]}),r.map((e,t)=>{const r=(e=>{switch(e){case"warning":return{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",icon:"text-yellow-600 dark:text-yellow-400",title:"text-yellow-900 dark:text-yellow-200",desc:"text-yellow-700 dark:text-yellow-300"};case"success":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",icon:"text-green-600 dark:text-green-400",title:"text-green-900 dark:text-green-200",desc:"text-green-700 dark:text-green-300"};case"discovery":return{bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200 dark:border-purple-800",icon:"text-purple-600 dark:text-purple-400",title:"text-purple-900 dark:text-purple-200",desc:"text-purple-700 dark:text-purple-300"};default:return{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",icon:"text-blue-600 dark:text-blue-400",title:"text-blue-900 dark:text-blue-200",desc:"text-blue-700 dark:text-blue-300"}}})(e.type);return T.jsx("div",{className:`${r.bg} ${r.border} border rounded-lg p-4 transition-colors`,children:T.jsxs("div",{className:"flex items-start",children:[T.jsx("div",{className:`${r.icon} mr-3 mt-0.5`,children:e.icon}),T.jsxs("div",{className:"flex-1",children:[T.jsx("h4",{className:`font-semibold ${r.title} mb-1`,children:e.title}),T.jsx("p",{className:`text-sm ${r.desc}`,children:e.description})]})]})},t)})]})}function Tr(e){const t=e/100;return{min:18.5*t*t,max:24.9*t*t}}function Rr({weightKg:e,heightCm:t,dateOfBirth:r,gender:s}){const a=r?function(e){const t=new Date(e),r=new Date;let s=r.getFullYear()-t.getFullYear();const a=r.getMonth()-t.getMonth();return(a<0||0===a&&r.getDate()<t.getDate())&&s--,s}(r):void 0,n=function(e,t,r,s){const a=function(e,t){const r=t/100;return e/(r*r)}(e,t),{category:n,label:l,healthRisk:i}=function(e){return e<18.5?{category:"underweight",label:"ä½ä½“é‡",healthRisk:"increased"}:e<25?{category:"normal",label:"æ¨™æº–ä½“é‡",healthRisk:"normal"}:e<30?{category:"overweight",label:"éä½“é‡",healthRisk:"increased"}:{category:"obese",label:"è‚¥æº€",healthRisk:"high"}}(a);let o;const d="male"===s||"female"===s?s:null;if(r&&d){const e=function(e,t,r){if(!r)return null;const s=e/100;let a,n;return t<20?(a="male"===r?19:18,n="male"===r?24:23):t<30?(a="male"===r?20:19,n="male"===r?25:24):t<50?(a="male"===r?21:20,n="male"===r?26:25):(a="male"===r?22:21,n="male"===r?27:26),{min:a*s*s,max:n*s*s}}(t,r,d);o=e||Tr(t)}else if(d){const e=function(e,t){if(!t)return null;const r=e/100;return"male"===t?{min:20*r*r,max:25*r*r}:{min:19*r*r,max:24*r*r}}(t,d);o=e||Tr(t)}else o=Tr(t);return{bmi:a,category:n,categoryLabel:l,healthRisk:i,idealWeightRange:o}}(e,t,a,s),l=e>=n.idealWeightRange.min&&e<=n.idealWeightRange.max;return T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"BMIåˆ†æ"}),"high"===n.healthRisk?T.jsx(ye,{className:"w-5 h-5 text-red-500"}):"increased"===n.healthRisk?T.jsx(ye,{className:"w-5 h-5 text-yellow-500"}):T.jsx(be,{className:"w-5 h-5 text-green-500"})]}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex-1",children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ç¾åœ¨ã®BMI"}),T.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:n.bmi.toFixed(1)})]}),T.jsx("div",{className:`px-4 py-2 rounded-lg font-medium text-sm ${(e=>{switch(e){case"underweight":return"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20 dark:text-yellow-400";case"normal":return"text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400";case"overweight":return"text-orange-600 bg-orange-50 dark:bg-orange-900/20 dark:text-orange-400";case"obese":return"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400";default:return"text-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-gray-400"}})(n.category)}`,children:n.categoryLabel})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:[a&&s?`${a}æ­³ãƒ»${"male"===s?"ç”·æ€§":"female"===s?"å¥³æ€§":""}ã®`:"","é©æ­£ä½“é‡ç¯„å›²"]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"æœ€å°"}),T.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[n.idealWeightRange.min.toFixed(1)," kg"]})]}),T.jsx("div",{className:"flex-1 mx-4",children:T.jsxs("div",{className:"relative h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden",children:[T.jsx("div",{className:"absolute h-full bg-green-500 rounded-full",style:{left:"0%",width:"100%"}}),!l&&T.jsx("div",{className:"absolute h-full w-1 bg-red-500",style:{left:`${Math.min(100,Math.max(0,(e-n.idealWeightRange.min)/(n.idealWeightRange.max-n.idealWeightRange.min)*100))}%`}})]})}),T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"æœ€å¤§"}),T.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[n.idealWeightRange.max.toFixed(1)," kg"]})]})]})]}),T.jsx("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:e<n.idealWeightRange.min?T.jsxs(T.Fragment,{children:[T.jsx(Vt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),T.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3",children:["é©æ­£ç¯„å›²ã¾ã§ ",T.jsxs("strong",{children:[(n.idealWeightRange.min-e).toFixed(1)," kg"]})," ã®å¢—é‡ãŒæ¨å¥¨ã•ã‚Œã¾ã™"]})]}):e>n.idealWeightRange.max?T.jsxs(T.Fragment,{children:[T.jsx(Ht,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),T.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3",children:["é©æ­£ç¯„å›²ã¾ã§ ",T.jsxs("strong",{children:[(e-n.idealWeightRange.max).toFixed(1)," kg"]})," ã®æ¸›é‡ãŒæ¨å¥¨ã•ã‚Œã¾ã™"]})]}):T.jsxs(T.Fragment,{children:[T.jsx(be,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),T.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 flex-1 ml-3",children:"é©æ­£ä½“é‡ç¯„å›²å†…ã§ã™"})]})}),a&&s&&T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€» å¹´é½¢ãƒ»æ€§åˆ¥ã‚’è€ƒæ…®ã—ãŸé©æ­£ä½“é‡ç¯„å›²ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™"})]})]})}function $r(e){if(!e)return"";let t=e.replace(/[ï¼-ï¼™]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\D/g,"");return t.startsWith("81")&&(t="0"+t.slice(2)),t}function Ar({user:e,onUpdate:t,onClose:s}){var a;const[n,l]=r.useState(e.name??""),[i,o]=r.useState(e.gender||""),[d,c]=r.useState((null==(a=e.height_cm)?void 0:a.toString())||""),[u,x]=r.useState(e.date_of_birth||""),[m,g]=r.useState(e.phone_number||""),[h,p]=r.useState(!1),[b,y]=r.useState(""),[f,v]=r.useState(!1),j=(()=>{if(!u)return null;const e=new Date(u),t=new Date;let r=t.getFullYear()-e.getFullYear();const s=t.getMonth()-e.getMonth();return(s<0||0===s&&t.getDate()<e.getDate())&&r--,r})(),w=$r(m);return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:T.jsxs("div",{className:"p-6",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[T.jsx(er,{className:"w-6 h-6 mr-2"}),"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†"]}),T.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",type:"button",children:T.jsx("span",{className:"text-2xl",children:"Ã—"})})]}),T.jsxs("form",{onSubmit:async r=>{r.preventDefault(),y(""),v(!1),p(!0);try{const r=n.trim();if(!r)throw new Error("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const l=d?Number(d):null;if(null!==l&&(Number.isNaN(l)||l<100||l>250))throw new Error("èº«é•·ã¯100ã€œ250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(u){const e=new Date(u),t=(new Date).getFullYear()-e.getFullYear();if(Number.isNaN(e.getTime())||t<10||t>150)throw new Error("ç”Ÿå¹´æœˆæ—¥ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ10æ­³ä»¥ä¸Šï¼‰ã€‚")}const o=$r(m);if((a=o)&&!/^0[7-9]0\d{8}$/.test(a))throw new Error("é›»è©±ç•ªå·ã¯070 / 080 / 090ã‹ã‚‰å§‹ã¾ã‚‹æºå¸¯ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆãƒã‚¤ãƒ•ãƒ³OKï¼‰ã€‚");const c={name:r,gender:i||null,height_cm:l,date_of_birth:u||null,phone_number:o||null},{error:x}=await z.from("users").update(c).eq("id",e.id);if(x)throw x;v(!0),setTimeout(()=>{t(),s()},1200)}catch(l){console.error("Error updating profile:",l),y(l instanceof Error?l.message:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{p(!1)}var a},className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"åå‰"}),T.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",required:!0})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[T.jsx(Nt,{className:"w-4 h-4 mr-2"}),"é›»è©±ç•ªå·ï¼ˆæºå¸¯ã®ã¿ãƒ»ä»»æ„ï¼‰"]}),T.jsx("input",{type:"tel",inputMode:"tel",value:m,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",placeholder:"090-1234-5678ï¼ˆ+81 ã§ã‚‚OKï¼‰"}),T.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-1",children:[T.jsx("p",{children:"CSVã§å–ã‚Šè¾¼ã‚€ InBody ãƒ‡ãƒ¼ã‚¿ã®æœ¬äººç´ä»˜ã‘ã«ä½¿ç”¨ã—ã¾ã™ã€‚"}),!!m&&T.jsxs("p",{children:["ä¿å­˜å½¢å¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ï¼‰: ",T.jsx("span",{className:"font-mono",children:w})]})]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[T.jsx(rr,{className:"w-4 h-4 mr-2"}),"æ€§åˆ¥ï¼ˆä»»æ„ï¼‰"]}),T.jsxs("select",{value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",children:[T.jsx("option",{value:"",children:"é¸æŠã—ãªã„"}),T.jsx("option",{value:"male",children:"ç”·æ€§"}),T.jsx("option",{value:"female",children:"å¥³æ€§"}),T.jsx("option",{value:"other",children:"ãã®ä»–"}),T.jsx("option",{value:"prefer_not_to_say",children:"å›ç­”ã—ãªã„"})]}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å¥³æ€§ã‚’é¸æŠã™ã‚‹ã¨ã€åŸºç¤ä½“æ¸©ã‚„æœˆçµŒå‘¨æœŸã®è¨˜éŒ²æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[T.jsx(Et,{className:"w-4 h-4 mr-2"}),"èº«é•·ï¼ˆcmï¼‰ï¼ˆä»»æ„ï¼‰"]}),T.jsx("input",{type:"number",step:"0.1",min:"100",max:"250",value:d,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",placeholder:"175.5"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"èº«é•·ã‚’å…¥åŠ›ã™ã‚‹ã¨BMIãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ï¼ˆ100ã€œ250cmï¼‰"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[T.jsx(De,{className:"w-4 h-4 mr-2"}),"ç”Ÿå¹´æœˆæ—¥ï¼ˆä»»æ„ï¼‰"]}),T.jsx("input",{type:"date",value:u,onChange:e=>x(e.target.value),max:V(10),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white"}),null!==j&&T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ç¾åœ¨ã®å¹´é½¢: ",j,"æ­³"]}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å¹´é½¢åˆ¥ã®é©æ­£ä½“é‡ç¯„å›²ã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–å€¤ã®è¡¨ç¤ºã«ä½¿ç”¨ã•ã‚Œã¾ã™"})]}),b&&T.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(ye,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),T.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:b})]})}),f&&T.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(Dt,{className:"w-5 h-5 text-green-600 dark:text-green-400 mr-2"}),T.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ"})]})}),T.jsxs("div",{className:"flex space-x-3 pt-4",children:[T.jsx("button",{type:"submit",disabled:h||f,className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:h?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"ä¿å­˜ä¸­..."]}):T.jsxs(T.Fragment,{children:[T.jsx(Dt,{className:"w-5 h-5 mr-2"}),"ä¿å­˜"]})}),T.jsx("button",{type:"button",onClick:s,disabled:h,className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]})]})})})}function Ir({targetElement:e,padding:t=8,zIndex:s=1e4,onClick:a}){const[n,l]=r.useState(null),i=r.useRef(null),o=r.useId();r.useEffect(()=>{if(!e)return void l(null);const t=()=>{const t=e.getBoundingClientRect();l(t)};return t(),window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[e]);return T.jsx("div",{ref:i,className:"fixed inset-0 transition-all duration-300",style:{zIndex:s},onClick:e=>{e.target===i.current&&(null==a||a())},"aria-hidden":"true",children:T.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:s+1},children:[T.jsx("defs",{children:T.jsxs("mask",{id:`tutorial-mask-${o}`,children:[T.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),n&&T.jsx("rect",{x:n.left-t,y:n.top-t,width:n.width+2*t,height:n.height+2*t,rx:"8",fill:"black"})]})}),T.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"rgba(0, 0, 0, 0.7)",mask:`url(#tutorial-mask-${o})`}),n&&T.jsx("rect",{x:n.left-t,y:n.top-t,width:n.width+2*t,height:n.height+2*t,rx:"8",fill:"none",stroke:"#3B82F6",strokeWidth:"3",className:"animate-pulse"})]})})}function zr({targetElement:e,position:t="bottom",title:s,description:a,currentStep:n,totalSteps:l,onNext:i,onPrev:o,onSkip:d,onClose:c,showPrev:u=!0,nextLabel:x="æ¬¡ã¸",zIndex:m=9999}){const g=r.useRef(null),[h,p]=r.useState({});return r.useEffect(()=>{if(e&&g.current){const r=()=>{const r=e.getBoundingClientRect(),s=g.current.getBoundingClientRect(),a=16;let n=0,l=0;if("center"===t)n=window.innerHeight/2-s.height/2,l=window.innerWidth/2-s.width/2;else{switch(t){case"top":n=r.top-s.height-a,l=r.left+(r.width-s.width)/2;break;case"bottom":n=r.bottom+a,l=r.left+(r.width-s.width)/2;break;case"left":n=r.top+(r.height-s.height)/2,l=r.left-s.width-a;break;case"right":n=r.top+(r.height-s.height)/2,l=r.right+a}l=Math.max(a,Math.min(l,window.innerWidth-s.width-a)),n=Math.max(a,Math.min(n,window.innerHeight-s.height-a))}p({position:"fixed",top:`${n}px`,left:`${l}px`,zIndex:m})};return r(),window.addEventListener("resize",r),window.addEventListener("scroll",r,!0),()=>{window.removeEventListener("resize",r),window.removeEventListener("scroll",r,!0)}}e||"center"!==t||p({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:m})},[e,t,m]),T.jsxs("div",{ref:g,style:h,className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl border-2 border-blue-500 dark:border-blue-400 w-[90vw] max-w-3xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-300",role:"dialog","aria-labelledby":"tutorial-title","aria-describedby":"tutorial-description",children:[T.jsxs("div",{className:"p-5 sm:p-6 md:p-8",children:[T.jsxs("div",{className:"flex items-start justify-between mb-3",children:[T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("div",{className:"flex items-center gap-2 mb-1.5",children:T.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",children:[n," / ",l]})}),T.jsx("h3",{id:"tutorial-title",className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900 dark:text-white pr-1",children:s})]}),c&&T.jsx("button",{onClick:c,className:"ml-1 flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‰ã˜ã‚‹",children:T.jsx(ar,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),T.jsx("p",{id:"tutorial-description",className:"text-sm sm:text-base md:text-lg text-gray-600 dark:text-gray-300 mb-5 sm:mb-6 leading-relaxed",children:a}),T.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap sm:flex-nowrap",children:[T.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[u&&o&&n>1&&T.jsx("button",{onClick:o,className:"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"æˆ»ã‚‹"}),d&&T.jsx("button",{onClick:d,className:"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors",children:"ã‚¹ã‚­ãƒƒãƒ—"})]}),i&&T.jsx("button",{onClick:i,className:"px-5 py-2 sm:px-7 sm:py-2.5 text-sm sm:text-base font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors shadow-sm",children:n===l?"å®Œäº†":x})]})]}),T.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700",children:T.jsx("div",{className:"h-full bg-blue-600 dark:bg-blue-500 transition-all duration-300",style:{width:n/l*100+"%"}})})]})}function Pr({currentStep:e,totalSteps:t,stepTitles:r,className:s=""}){return T.jsx("div",{className:`flex items-center justify-center gap-2 ${s}`,children:Array.from({length:t},(e,t)=>t+1).map(s=>{const a=s<e,n=s===e,l=null==r?void 0:r[s-1];return T.jsxs("div",{className:"flex items-center gap-2",title:l,children:[T.jsxs("div",{className:"relative flex items-center justify-center",children:[a?T.jsx(Re,{className:"w-6 h-6 text-green-500 dark:text-green-400"}):T.jsx(Fe,{className:"w-6 h-6 "+(n?"text-blue-600 dark:text-blue-400 fill-blue-100 dark:fill-blue-900":"text-gray-300 dark:text-gray-600")}),n&&T.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-blue-600 dark:border-blue-400 animate-ping"})]}),s<t&&T.jsx("div",{className:"w-8 h-0.5 "+(a?"bg-green-500 dark:bg-green-400":"bg-gray-300 dark:bg-gray-600")})]},s)})})}function Lr({steps:e,isActive:t,onComplete:s,onSkip:a,currentStepIndex:n,onStepChange:l,showProgress:i=!0}){const[o,d]=r.useState(0),[c,u]=r.useState(null),[x,m]=r.useState(!1),g=n??o,h=l??d,p=e[g];r.useEffect(()=>{if(!t||!p)return void u(null);let e=!1;const r=()=>{if(!e)if(p.targetSelector){const e=document.querySelector(p.targetSelector);if(e){u(e);try{e.scrollIntoView({behavior:"smooth",block:"center"})}catch{}}else u(null)}else u(null)};(async()=>{try{p.beforeStep&&await p.beforeStep()}catch(e){console.warn("[Tutorial] beforeStep error",e)}})().then(r);const s=new MutationObserver(r);return s.observe(document.body,{childList:!0,subtree:!0}),()=>{e=!0,s.disconnect()}},[t,p,g]);const b=r.useCallback(async()=>{if(!x&&p)try{m(!0);try{p.afterStep&&await p.afterStep()}catch(t){console.warn("[Tutorial] afterStep error",t)}try{p.action&&await p.action()}catch(t){console.warn("[Tutorial] action error",t)}g<e.length-1?h(g+1):s()}finally{m(!1)}},[g,e.length,p,s,h,x]),y=r.useCallback(()=>{g>0&&!x&&h(g-1)},[g,h,x]),f=r.useCallback(()=>{x||a()},[a,x]);return r.useEffect(()=>{const r=r=>{t&&("Escape"===r.key?f():"Enter"===r.key?b():"ArrowLeft"===r.key&&g>0?y():"ArrowRight"===r.key&&g<e.length-1&&b())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,g,e.length,b,y,f]),t&&p?T.jsxs(T.Fragment,{children:[T.jsx(Ir,{targetElement:c,onClick:f}),T.jsx("div",{className:"fixed inset-0 z-[10001] pointer-events-none",children:T.jsx("div",{className:"pointer-events-auto",onClick:e=>{e.stopPropagation()},children:T.jsx(zr,{targetElement:c,position:p.position||"bottom",title:p.title,description:p.description,currentStep:g+1,totalSteps:e.length,onNext:b,onPrev:g>0?y:void 0,onSkip:f,showPrev:g>0})})}),i&&T.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-[10002] pointer-events-none",children:T.jsx(Pr,{currentStep:g+1,totalSteps:e.length,stepTitles:e.map(e=>e.title)})})]}):null}function qr(e){if(null==e||""===e)return null;const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null}function Fr(e){if(!e)return null;const t=String(e).match(/^(\d{4}-\d{2}-\d{2})/);return t?t[1]:null}function Or(e){const t=Fr(e);if(!t)throw new Error("Invalid date");return t}function Wr(e){if(!e)return null;if("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;return Fr(String(e))??null}function Br(e,t){const r=String((null==e?void 0:e.date)??""),s=String((null==t?void 0:t.date)??"");return r.localeCompare(s)}function Ur(e,t){const r=[...e||[]],s=r.findIndex(e=>e.id===t.id);return s>=0?r[s]=t:r.push(t),r.sort(Br),r}function Hr(e){const[t,s]=r.useState([]),[a,n]=r.useState([]),[l,i]=r.useState([]),[o,d]=r.useState(!0),c=r.useRef(!1),u=r.useRef(null),x=r.useCallback(async(t,r)=>{await async function({userId:e,eventType:t,payload:r={}}){if(e)try{const{error:s}=await z.from("events").insert({user_id:e,event_type:t,payload:r});if(s)throw s}catch(s){console.warn("[logEvent] failed:",s)}else console.warn("[logEvent] skipped: missing userId",{eventType:t,payload:r})}({userId:e,eventType:t,payload:r})},[e]),m=r.useCallback(async()=>{if(!e)return;const r=`user:${e}`;if(!(c.current||u.current===r&&t.length>0)){c.current=!0,u.current=r,d(!0);try{const[t,r]=await Promise.all([z.from("training_records").select("*").eq("user_id",e).order("date",{ascending:!0}),z.from("weight_records").select("*").eq("user_id",e).order("date",{ascending:!0})]);if(t.error)throw t.error;if(r.error)throw r.error;s(t.data||[]),n(r.data||[])}catch(a){console.error("[useTrainingData] Error fetching data:",a),s([]),n([]),i([]),u.current=null}finally{c.current=!1,d(!1)}}},[e,!1,t.length]);r.useEffect(()=>{e&&m()},[e,m]),r.useEffect(()=>{const e=(t||[]).map(e=>{const t=Wr(null==e?void 0:e.date);if(!t)return null;const r=qr(null==e?void 0:e.load),s=qr(null==e?void 0:e.rpe),a=qr(null==e?void 0:e.duration_min);return{date:t,load:null!=r?r:null!=s&&null!=a?s*a:null}}).filter(Boolean);i(ie(e))},[t]);const g=r.useCallback(async t=>{const r=Fr(t);if(!r)return null;{const{data:t,error:s}=await z.from("training_records").select("*").eq("user_id",e).eq("date",r).maybeSingle();if(s)throw s;return t}},[e]),h=r.useCallback(async t=>{const r=Fr(t.date);if(!r)throw new Error("Invalid date");const a=Or(t.date),{data:n,error:l}=await z.from("training_records").insert([{user_id:e,date:a,rpe:t.rpe,duration_min:t.duration_min,arrow_score:t.arrow_score,signal_score:t.signal_score}]).select().single();if(l)throw l;return s(e=>Ur(e,n)),await x("training_completed",{date:r,rpe:t.rpe,duration_min:t.duration_min,arrow_score:t.arrow_score,signal_score:t.signal_score,overwrite:!1}),n},[e,x]),p=r.useCallback(async(t,r)=>{const a=r.date?Fr(r.date):null,n=r.date?Or(r.date):null,l={...void 0!==r.rpe?{rpe:r.rpe}:{},...void 0!==r.duration_min?{duration_min:r.duration_min}:{},...void 0!==r.arrow_score?{arrow_score:r.arrow_score}:{},...void 0!==r.signal_score?{signal_score:r.signal_score}:{},...n?{date:n}:{}},{data:i,error:o}=await z.from("training_records").update(l).eq("id",t).eq("user_id",e).select().single();if(o)throw o;s(e=>Ur(e,i));const d=a??Wr(null==i?void 0:i.date)??void 0;return await x("training_completed",{date:d,rpe:r.rpe??(null==i?void 0:i.rpe),duration_min:r.duration_min??(null==i?void 0:i.duration_min),arrow_score:r.arrow_score??(null==i?void 0:i.arrow_score),signal_score:r.signal_score??(null==i?void 0:i.signal_score),overwrite:!0}),i},[e,x]),b=r.useCallback(async t=>{const{error:r}=await z.from("training_records").delete().eq("id",t).eq("user_id",e);if(r)throw r;s(e=>function(e,t){const r=(e||[]).filter(e=>e.id!==t);return r.sort(Br),r}(e,t))},[e]);return{records:t,weightRecords:a,acwrData:l,loading:o,fetchAll:m,checkExistingRecord:g,addTrainingRecord:h,updateTrainingRecord:p,deleteTrainingRecord:b}}function Vr(e){if(!e)return null;const t=String(e).slice(0,10).replace(/\//g,"-").match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(t){const e=Number(t[1]),r=Number(t[2]),s=Number(t[3]);if(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(s))return new Date(e,r-1,s)}const r=new Date(String(e)).getTime();return Number.isFinite(r)?new Date(r):null}function Kr(e){return e?String(e).slice(0,10).replace(/\//g,"-"):""}function Jr(e,t){var r,s;const a=Kr(e.date),n=Kr(t.date);if(a&&n)return n.localeCompare(a);const l=(null==(r=Vr(e.date))?void 0:r.getTime())??0;return((null==(s=Vr(t.date))?void 0:s.getTime())??0)-l}function Yr(e,t){return-Jr(e,t)}function Gr(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null),o=r.useCallback(e=>{const t=[...e].sort(Jr);s(t)},[]),d=r.useCallback(async()=>{try{n(!0),i(null);const{data:t,error:r}=await z.from("weight_records").select("*").eq("user_id",e).order("date",{ascending:!1});if(r)throw r;o(t||[])}catch(t){console.error("Error fetching weight records:",t),i(t instanceof Error?t.message:"ä½“é‡è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),o([])}finally{n(!1)}},[e,o]);r.useEffect(()=>{e&&d()},[e,d]);const c=r.useCallback(async t=>{try{const r=Kr(t),{data:s,error:a}=await z.from("weight_records").select("*").eq("user_id",e).eq("date",r).maybeSingle();if(a)throw a;return s??null}catch(r){return console.error("Error checking existing record:",r),null}},[e]),u=r.useCallback(async e=>{try{const{data:t}=await z.auth.getUser();if(!t.user)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r={user_id:t.user.id,weight_kg:e.weight_kg,date:Kr(e.date),notes:e.notes||null},{data:a,error:n}=await z.from("weight_records").insert(r).select().single();if(n)throw n;s(e=>[a,...e].sort(Jr))}catch(t){throw console.error("Error adding weight record:",t),t}},[]),x=r.useCallback(async(e,t)=>{try{const r={weight_kg:t.weight_kg,notes:t.notes||null},{data:a,error:n}=await z.from("weight_records").update(r).eq("id",e).select().single();if(n)throw n;s(t=>t.map(t=>t.id===e?a:t).sort(Jr))}catch(r){throw console.error("Error updating weight record:",r),r}},[]),m=r.useCallback(async e=>{try{const{error:t}=await z.from("weight_records").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(t){throw console.error("Error deleting weight record:",t),t}},[]),g=r.useCallback(()=>{if(!t||0===t.length)return null;const e=t.reduce((e,t)=>{if(!e)return t;const r=Kr(e.date);return Kr(t.date)>r?t:e},null),r=Number(null==e?void 0:e.weight_kg);return Number.isFinite(r)?r:null},[t]),h=r.useCallback((e=30)=>{if(!t||t.length<2)return null;const r=new Date,s=new Date(r.getFullYear(),r.getMonth(),r.getDate());s.setDate(s.getDate()-e);const a=[...t].sort(Yr).filter(e=>{const t=Vr(e.date);return!!t&&t.getTime()>=s.getTime()});if(a.length<2)return null;const n=Number(a[0].weight_kg),l=Number(a[a.length-1].weight_kg);return Number.isFinite(n)&&Number.isFinite(l)?l-n:null},[t]);return{records:t,loading:a,error:l,checkExistingRecord:c,addWeightRecord:u,updateWeightRecord:x,deleteWeightRecord:m,getLatestWeight:g,getWeightChange:h,refresh:d}}function Zr(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{o()},[e]);const o=async()=>{try{n(!0);const{data:t,error:r}=await z.from("menstrual_cycles").select("*").eq("user_id",e).order("cycle_start_date",{ascending:!1});if(r)throw r;s(t||[])}catch(t){i(t instanceof Error?t.message:"Failed to fetch menstrual cycles")}finally{n(!1)}},d=(e,t)=>{const r=new Date(e.cycle_start_date),s=Math.floor((t.getTime()-r.getTime())/864e5);if(s<0)return null;if(e.period_duration_days&&s<e.period_duration_days)return"menstrual";if(e.cycle_length_days){const t=Math.floor(e.cycle_length_days/2);if(s<t)return"follicular";if(s<t+2)return"ovulatory";if(s<e.cycle_length_days)return"luteal"}return null};return{cycles:t,loading:a,error:l,addCycle:async t=>{try{const{data:r}=await z.auth.getUser();if(!r.user)throw new Error("User not authenticated");const{data:a}=await z.from("users").select("team_id").eq("user_id",r.user.id).maybeSingle();let n=null;if(null==a?void 0:a.team_id){const{data:e}=await z.from("teams").select("organization_id").eq("id",a.team_id).maybeSingle();n=(null==e?void 0:e.organization_id)||null}const{data:l,error:i}=await z.from("menstrual_cycles").insert({...t,user_id:e,organization_id:n}).select().single();if(i)throw i;return l&&s(e=>[l,...e]),l}catch(r){throw i(r instanceof Error?r.message:"Failed to add menstrual cycle"),r}},updateCycle:async(e,t)=>{try{const{data:r,error:a}=await z.from("menstrual_cycles").update(t).eq("id",e).select().single();if(a)throw a;return r&&s(t=>t.map(t=>t.id===e?r:t)),r}catch(r){throw i(r instanceof Error?r.message:"Failed to update menstrual cycle"),r}},deleteCycle:async e=>{try{const{error:t}=await z.from("menstrual_cycles").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(t){throw i(t instanceof Error?t.message:"Failed to delete menstrual cycle"),t}},getCyclePhase:d,getCurrentCyclePhase:()=>{const e=new Date;for(const r of t){const t=d(r,e);if(t)return{cycle:r,phase:t}}return null},refetch:o}}const Xr=[{id:"athlete-welcome",title:"Bekuta ã¸ã‚ˆã†ã“ã",description:"ç·åˆã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒªBekutaã¸ã‚ˆã†ã“ãã€‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ä½“é‡ã€ç¡çœ ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ä¸€å…ƒç®¡ç†ã—ã€ãƒ‡ãƒ¼ã‚¿ã§ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚",position:"center"},{id:"athlete-unified-checkin",title:"çµ±åˆãƒ‡ã‚¤ãƒªãƒ¼ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³",description:"1ã¤ã®ç”»é¢ã§ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ã€Œä½“é‡ã€ã€Œç¡çœ ã€ã€Œãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚’è¨˜éŒ²ã€‚æ¯æ—¥ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã€ç¶šã‘ã‚„ã™ãè¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚",targetSelector:'[data-tutorial="daily-checkin"]',position:"bottom"},{id:"athlete-performance",title:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨˜éŒ²",description:"ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹ã€ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆãªã©ã®ç­‹åŠ›ã€æŒä¹…åŠ›ã€ã‚¹ãƒ—ãƒªãƒ³ãƒˆãªã©ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã‚’è¨˜éŒ²ã€‚æˆé•·ã‚’å¯è¦–åŒ–ã—ã€ãƒ™ã‚¹ãƒˆæ›´æ–°ã‚’ç¥ã„ã¾ã™ã€‚",targetSelector:'[data-tutorial="performance-tab"]',position:"bottom"},{id:"athlete-acwr-chart",title:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã®å¯è¦–åŒ–",description:"æ€¥æ€§ãƒ»æ…¢æ€§ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰æ¯”ï¼ˆACWRï¼‰ã§æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’ç§‘å­¦çš„ã«ç®¡ç†ã€‚0.8ã€œ1.3ãŒç†æƒ³çš„ã§ã€æ€¥æ¿€ãªè² è·å¢—åŠ ã‚’é˜²ãã¾ã™ã€‚",targetSelector:'[data-tutorial="acwr-chart"]',position:"top"},{id:"athlete-multi-metric",title:"ç·åˆã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³",description:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ä½“é‡ã€ç¡çœ ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åŒæ™‚è¡¨ç¤ºã€‚ç›¸é–¢é–¢ä¿‚ã‚’è¦‹ã¤ã‘ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã®å…¨ä½“åƒã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="multi-metric-timeline"]',position:"top"},{id:"athlete-alerts",title:"ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆ",description:"è¤‡æ•°ã®æŒ‡æ¨™ã‚’çµ±åˆåˆ†æã—ã€æ€ªæˆ‘ãƒªã‚¹ã‚¯ã€ã‚ªãƒ¼ãƒãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€å›å¾©ä¸è¶³ã‚’æ—©æœŸã«ç™ºè¦‹ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆã§å¯¾å¿œã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚",targetSelector:'[data-tutorial="alert-badge"]',position:"bottom"},{id:"athlete-gamification",title:"ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³",description:"æ¥½ã—ããƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒï¼è¨˜éŒ²ã‚’ç¶šã‘ã¦ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ä¼¸ã°ã—ã€ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã¦ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã€‚ãƒãƒƒã‚¸ã‚’é›†ã‚ã¦é”æˆæ„Ÿã‚’å‘³ã‚ã„ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="gamification-tab"]',position:"bottom"},{id:"athlete-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"Bekutaã§ç·åˆçš„ãªã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚æ¯æ—¥ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã—ã€ç§‘å­¦çš„ãªæ ¹æ‹ ã«åŸºã¥ã„ãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€å¤§åŒ–ã—ã¾ã™ã€‚",position:"center"}],Qr=[{id:"staff-welcome",title:"Bekuta ã‚¹ã‚¿ãƒƒãƒ•ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ã‚ˆã†ã“ã",description:"ãƒãƒ¼ãƒ å…¨ä½“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çŠ¶æ³ã‚’ç§‘å­¦çš„ã«ç›£è¦–ã—ã€é¸æ‰‹ã®æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ç®¡ç†ã§ãã¾ã™ã€‚",position:"center"},{id:"staff-team-selector",title:"ãƒãƒ¼ãƒ é¸æŠ",description:"æ‹…å½“ã™ã‚‹ãƒãƒ¼ãƒ ã‚’é¸æŠã§ãã¾ã™ã€‚è¤‡æ•°ã®ãƒãƒ¼ãƒ ã‚’ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã“ã§åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚",targetSelector:'[data-tutorial="team-selector"]',position:"bottom"},{id:"staff-alert-summary",title:"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ",description:"ãƒãƒ¼ãƒ å…¨ä½“ã®æ³¨æ„ãŒå¿…è¦ãªé¸æ‰‹ãŒä¸€ç›®ã§åˆ†ã‹ã‚Šã¾ã™ã€‚AIãŒåˆ†æã—ãŸå„ªå…ˆåº¦ã®é«˜ã„ã‚¢ãƒ©ãƒ¼ãƒˆã«ç´ æ—©ãå¯¾å¿œã—ã€æ€ªæˆ‘ã‚’äº‹å‰ã«é˜²ãã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="alert-summary"]',position:"bottom"},{id:"staff-athletes-tab",title:"é¸æ‰‹ä¸€è¦§",description:"ãƒãƒ¼ãƒ ã®å…¨é¸æ‰‹ã‚’ä¸€è¦§ã§ç¢ºèªã§ãã¾ã™ã€‚å„é¸æ‰‹ã®çŠ¶æ…‹ã‚’æŠŠæ¡ã—ã€å€‹åˆ¥ã«ã‚µãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="athletes-tab"]',position:"bottom"},{id:"staff-athlete-list",title:"é¸æ‰‹ã®è©³ç´°ç¢ºèª",description:"é¸æ‰‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è©³ç´°ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å±¥æ­´ã¨ACWRã‚°ãƒ©ãƒ•ã‚’ç¢ºèªã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="athlete-list"]',position:"right"},{id:"staff-team-average",title:"ãƒãƒ¼ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ",description:"ãƒãƒ¼ãƒ å…¨ä½“ã®å¹³å‡ACWRã®æ¨ç§»ã‚’ç§‘å­¦çš„ã«åˆ†æã§ãã¾ã™ã€‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åŠ¹æœã‚’å®šé‡çš„ã«è©•ä¾¡ã—ã€æœ€é©åŒ–ã«å½¹ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="team-average-tab"]',position:"bottom"},{id:"staff-trends",title:"å‚¾å‘åˆ†æ",description:"ãƒãƒ¼ãƒ ã®é•·æœŸçš„ãªå‚¾å‘ã‚’åˆ†æã—ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨ˆç”»ã®æœ€é©åŒ–ã«å½¹ç«‹ã¦ã‚‰ã‚Œã¾ã™ã€‚",targetSelector:'[data-tutorial="trends-tab"]',position:"bottom"},{id:"staff-export",title:"ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ",description:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã€è©³ç´°ãªåˆ†æã‚„è¨˜éŒ²ä¿ç®¡ãŒã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="export-button"]',position:"bottom"},{id:"staff-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"ã“ã‚Œã§Bekutaã‚¹ã‚¿ãƒƒãƒ•ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’å­¦ã³ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§é¸æ‰‹ã®å®‰å…¨ã‚’å®ˆã‚Šã€æœ€å¤§é™ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†ã€‚",position:"center"}],es=[{id:"admin-welcome",title:"Bekuta ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ã‚ˆã†ã“ã",description:"çµ„ç¹”å…¨ä½“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€å…ƒç®¡ç†ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ã€ãƒãƒ¼ãƒ ç®¡ç†ã€ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ã‚’åŠ¹ç‡çš„ã«è¡Œãˆã¾ã™ã€‚",position:"center"},{id:"admin-alert-summary",title:"çµ±åˆã‚¢ãƒ©ãƒ¼ãƒˆç›£è¦–",description:"çµ„ç¹”å…¨ä½“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ä¸€ç”»é¢ã§ç›£è¦–ã§ãã¾ã™ã€‚é‡å¤§ãªæ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚„ã‚·ã‚¹ãƒ†ãƒ å•é¡Œã«ç´ æ—©ãå¯¾å¿œã—ã€å®‰å…¨ãªç’°å¢ƒã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="admin-alert-summary"]',position:"bottom"},{id:"admin-overview-tab",title:"æ¦‚è¦ã‚¿ãƒ–",description:"ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®çµ±è¨ˆæƒ…å ±ã‚„é‡è¦ãªæŒ‡æ¨™ã‚’ç¢ºèªã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="overview-tab"]',position:"bottom"},{id:"admin-invite-tab",title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ ",description:"æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‹›å¾…ã—ã€Bekutaã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ‹¡å¤§ã§ãã¾ã™ã€‚å€‹åˆ¥æ‹›å¾…ã¨CSVä¸€æ‹¬æ‹›å¾…ã®2ã¤ã®æ–¹æ³•ã§ã€åŠ¹ç‡çš„ãªã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒå¯èƒ½ã§ã™ã€‚",targetSelector:'[data-tutorial="invite-tab"]',position:"bottom"},{id:"admin-single-invite",title:"å€‹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…",description:"1äººãšã¤æ‹›å¾…ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ã‚’ä½¿ã„ã¾ã™ã€‚åå‰ã€ãƒ¡ãƒ¼ãƒ«ã€å½¹å‰²ã€ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-tutorial="single-invite"]',position:"right"},{id:"admin-bulk-invite",title:"ä¸€æ‹¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…",description:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¸€åº¦ã«æ‹›å¾…ã§ãã¾ã™ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-tutorial="bulk-invite"]',position:"right"},{id:"admin-manage-tab",title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†",description:"æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç·¨é›†ã€å‰Šé™¤ã§ãã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚‚ã“ã“ã‹ã‚‰è¡Œãˆã¾ã™ã€‚",targetSelector:'[data-tutorial="manage-tab"]',position:"bottom"},{id:"admin-user-list",title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§",description:"å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™ã€‚æ¤œç´¢æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="user-list"]',position:"top"},{id:"admin-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"Bekutaç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®åŸºæœ¬æ©Ÿèƒ½ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€çµ„ç¹”å…¨ä½“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã¨å®‰å…¨ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç’°å¢ƒã‚’å®Ÿç¾ã—ã¾ã—ã‚‡ã†ã€‚",position:"center"}],ts=[{id:"parent-welcome",title:"ä¿è­·è€…ãƒ“ãƒ¥ãƒ¼ã¸ã‚ˆã†ã“ã",description:"ãŠå­ã•ã‚“ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã€å¿…è¦ãªã‚µãƒãƒ¼ãƒˆã«ç¹‹ã’ã‚‹ãŸã‚ã®ç”»é¢ã§ã™ã€‚",position:"center"},{id:"parent-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"ã“ã“ã‹ã‚‰æ—¥ã€…ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",position:"center"}],rs=[{id:"gamification-welcome",title:"ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã‚ˆã†ã“ãï¼",description:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã—ãªãŒã‚‰ç¶™ç¶šçš„ãªè¨˜éŒ²ã‚’æ¥½ã—ã‚‚ã†ï¼ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã€ãƒã‚¤ãƒ³ãƒˆã€ãƒãƒƒã‚¸ã€ç›®æ¨™ã§æˆé•·ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚",position:"center"},{id:"gamification-streaks",title:"ã‚¹ãƒˆãƒªãƒ¼ã‚¯ - é€£ç¶šè¨˜éŒ²",description:"æ¯æ—¥è¨˜éŒ²ã‚’ç¶šã‘ã¦ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ä¼¸ã°ãã†ï¼ç·´ç¿’ã€ä½“é‡ã€ç¡çœ ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®4ç¨®é¡ã€‚é€£ç¶šè¨˜éŒ²ãŒé€”åˆ‡ã‚Œãã†ãªæ™‚ã¯è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚",targetSelector:'[data-tutorial="streaks-section"]',position:"right"},{id:"gamification-level",title:"ãƒ¬ãƒ™ãƒ« & ãƒã‚¤ãƒ³ãƒˆ",description:"è¨˜éŒ²ã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ï¼ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨æ–°ã—ã„ãƒ©ãƒ³ã‚¯ã‚¿ã‚¤ãƒˆãƒ«ãŒæ‰‹ã«å…¥ã‚Šã¾ã™ã€‚ãƒ“ã‚®ãƒŠãƒ¼ã‹ã‚‰ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã¾ã§ã€7æ®µéšã®ãƒ©ãƒ³ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚",targetSelector:'[data-tutorial="level-section"]',position:"right"},{id:"gamification-badges",title:"ãƒãƒƒã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³",description:"ç‰¹åˆ¥ãªé”æˆã§ãƒãƒƒã‚¸ã‚’ç²å¾—ï¼7æ—¥é€£ç¶šè¨˜éŒ²ã€ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆæ›´æ–°ã€å®Œç’§ãªé€±ãªã©ã€‚ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã¯4æ®µéšï¼ˆCommon, Rare, Epic, Legendaryï¼‰ã€‚",targetSelector:'[data-tutorial="badges-card"]',position:"bottom"},{id:"gamification-goals",title:"ç›®æ¨™è¨­å®š",description:"è‡ªåˆ†ã ã‘ã®ç›®æ¨™ã‚’è¨­å®šã—ã¦é”æˆã‚’ç›®æŒ‡ãã†ï¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ä½“é‡ã€ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã€ç¿’æ…£ã€ã‚«ã‚¹ã‚¿ãƒ ãªã©æ§˜ã€…ãªç›®æ¨™ã‚¿ã‚¤ãƒ—ã‹ã‚‰é¸ã¹ã¾ã™ã€‚",targetSelector:'[data-tutorial="goals-section"]',position:"left"},{id:"gamification-rankings",title:"ãƒãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°",description:"ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ç«¶ã„åˆãŠã†ï¼é€±é–“è¨˜éŒ²æ•°ã¨ãƒã‚¤ãƒ³ãƒˆã®2ã¤ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒã‚ã‚Šã¾ã™ã€‚åˆ‡ç£‹ç¢ç£¨ã—ã¦æˆé•·ã—ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="rankings-section"]',position:"left"},{id:"gamification-complete",title:"ã•ã‚ã€å§‹ã‚ã‚ˆã†ï¼",description:"æ¥½ã—ã¿ãªãŒã‚‰è¨˜éŒ²ã‚’ç¶šã‘ã¦ã€ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ä¼¸ã°ã—ã€ãƒãƒƒã‚¸ã‚’é›†ã‚ã¾ã—ã‚‡ã†ã€‚ç¶™ç¶šã¯åŠ›ãªã‚Šï¼",position:"center"}];function ss(e){switch(e){case"athlete":return Xr;case"staff":return Qr;case"parent":return ts;case"global_admin":return es;case"gamification":return rs;default:return[]}}function as({onSubmit:e,onCheckExisting:t,onUpdate:s,loading:a=!1,lastRecord:n}){const[l,i]=r.useState(""),[o,d]=r.useState(H()),[c,u]=r.useState(3),[x,m]=r.useState(""),[g,h]=r.useState(""),[p,b]=r.useState(!1),[y,f]=r.useState(null),[v,j]=r.useState(null),[w,N]=r.useState(!1),[k,_]=r.useState(!1),[S,C]=r.useState("success"),[E,D]=r.useState(""),M=(e,t)=>{C(e),D(t),_(!0)},R=()=>{i(""),d(H()),u(3),m("")};r.useEffect(()=>{n&&(null!=n.sleep_hours&&i(String(n.sleep_hours)),null!=n.sleep_quality&&u(n.sleep_quality))},[n]);const $=()=>{b(!1),f(null),j(null)},A=a||w;return T.jsxs(T.Fragment,{children:[T.jsx(yr,{open:k,type:S,message:E,onClose:()=>_(!1)}),T.jsx(mr,{isOpen:p,onClose:$,onOverwrite:async()=>{if(y&&v&&!w&&!a){b(!1),N(!0),h("");try{await s(y.id,v),R(),f(null),j(null),M("success","ä¸Šæ›¸ãã—ã¦è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(e){h("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error updating record:",e),M("error",`ä¸Šæ›¸ãã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==e?void 0:e.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{N(!1)}}},onCancel:$,title:"ç¡çœ è¨˜éŒ²",date:o,existingValues:[{label:"ç¡çœ æ™‚é–“",value:`${(null==y?void 0:y.sleep_hours)||0}æ™‚é–“`},{label:"ç¡çœ ã®è³ª",value:`${(null==y?void 0:y.sleep_quality)||0}/5`}],newValues:[{label:"ç¡çœ æ™‚é–“",value:`${(null==v?void 0:v.sleep_hours)||0}æ™‚é–“`},{label:"ç¡çœ ã®è³ª",value:`${(null==v?void 0:v.sleep_quality)||0}/5`}]}),T.jsxs("form",{onSubmit:async r=>{if(r.preventDefault(),h(""),w||a)return;const s=(()=>{const e=parseFloat(l);return isNaN(e)||e<0||e>24?(h("ç¡çœ æ™‚é–“ã¯0ã€œ24æ™‚é–“ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),null):e})();if(null==s)return;const n={sleep_hours:s,date:o,sleep_quality:c,notes:x||void 0};N(!0);try{const r=await t(o);if(r)return f(r),j(n),void b(!0);await e(n),R(),M("success","è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(i){h("ç¡çœ è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error submitting sleep record:",i),M("error",`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==i?void 0:i.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{N(!1)}},className:"space-y-4",children:[g&&T.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:g}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"æ—¥ä»˜"}),T.jsx("input",{type:"date",value:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:A})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ç¡çœ æ™‚é–“ï¼ˆæ™‚é–“ï¼‰"}),n&&T.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["å‰å›ï¼ˆ",n.date,"ï¼‰ï¼š",n.sleep_hours,"æ™‚é–“"]}),T.jsx("input",{type:"number",step:"0.5",min:"0",max:"24",value:l,onChange:e=>i(e.target.value),placeholder:"ä¾‹: 7.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:A}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"æ¨å¥¨: 7-9æ™‚é–“"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ç¡çœ ã®è³ª"}),n&&T.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["å‰å›ã®è³ªï¼š",n.sleep_quality??"-"," / 5"]}),T.jsx("div",{className:"flex items-center justify-center space-x-2",children:[1,2,3,4,5].map(e=>T.jsx("button",{type:"button",onClick:()=>u(e),className:"transition-colors "+(e<=c?"text-yellow-400 hover:text-yellow-500":"text-gray-300 dark:text-gray-600 hover:text-gray-400"),children:T.jsx(Ft,{className:"w-6 h-6 "+(e<=c?"fill-current":"")})},e))}),T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:[5===c&&"æœ€é«˜ã®ç¡çœ ",4===c&&"è‰¯ã„ç¡çœ ",3===c&&"æ™®é€š",2===c&&"ã‚„ã‚„ä¸è¶³",1===c&&"ç¡çœ ä¸è¶³"]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),T.jsx("textarea",{value:x,onChange:e=>m(e.target.value),placeholder:"å¤œä¸­ã«ç›®ãŒè¦šã‚ãŸã€å¯ã¤ããŒæ‚ªã‹ã£ãŸ ãªã©...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none",disabled:A})]}),T.jsx("button",{type:"submit",disabled:A,className:"w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center "+(A?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"),children:A?T.jsxs("span",{className:"inline-flex items-center gap-2",children:[T.jsx(ct,{className:"w-5 h-5 animate-spin"}),"ä¿å­˜ä¸­â€¦"]}):T.jsxs(T.Fragment,{children:[T.jsx(bt,{className:"w-5 h-5 mr-2"}),"ç¡çœ ã‚’è¨˜éŒ²ã™ã‚‹"]})})]})]})}function ns({isOpen:e,onClose:t,onOverwrite:r,onCancel:s,existingRecord:a,newValue:n}){return e?T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[T.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center",children:T.jsx(fe,{className:"w-5 h-5 text-yellow-600"})}),T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãã®æ—¥ä»˜ã®è¨˜éŒ²ãŒæ—¢ã«ã‚ã‚Šã¾ã™"})]}),T.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"é–‰ã˜ã‚‹",children:T.jsx(ar,{className:"w-5 h-5"})})]}),T.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"ã“ã®æ—¥ä»˜ã«ã¯æ—¢ã«è¨˜éŒ²ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ"}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 space-y-3",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"æ—¥ä»˜"}),T.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:new Date(a.date).toLocaleDateString("ja-JP")})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"ç¾åœ¨"}),T.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["æ„æ¬² ",a.motivation_level," /10"]}),T.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["ä½“åŠ› ",a.energy_level," /10"]}),T.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["ã‚¹ãƒˆãƒ¬ã‚¹ ",a.stress_level," /10"]})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"æ–°è¦"}),T.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-semibold",children:["æ„æ¬² ",n.motivation_level," /10"]}),T.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 font-semibold",children:["ä½“åŠ› ",n.energy_level," /10"]}),T.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 font-semibold",children:["ã‚¹ãƒˆãƒ¬ã‚¹ ",n.stress_level," /10"]})]})]})]}),T.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3",children:T.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"ä¸Šæ›¸ãã™ã‚‹ã¨ã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯æ›´æ–°ã•ã‚Œã¾ã™ã€‚"})})]}),T.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30",children:[T.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"ä¸Šæ›¸ãã™ã‚‹"})]})]})}):null}function ls({onSubmit:e,onCheckExisting:t,onUpdate:s,loading:a=!1,lastRecord:n}){const[l,i]=r.useState(5),[o,d]=r.useState(5),[c,u]=r.useState(5),[x,m]=r.useState(H()),[g,h]=r.useState(""),[p,b]=r.useState(""),[y,f]=r.useState(!1),[v,j]=r.useState(!1),[w,N]=r.useState(!1),[k,_]=r.useState("success"),[S,C]=r.useState(""),E=(e,t)=>{_(e),C(t),N(!0)},[D,M]=r.useState(!1),[R,$]=r.useState(null),[A,I]=r.useState(null);r.useEffect(()=>{n&&!y&&(i(n.motivation_level),d(n.energy_level),u(n.stress_level),f(!0))},[n,y]);const z=()=>{i(5),d(5),u(5),m(H()),h(""),f(!1)},P=a||v,L=(e,t,r,s,a,l,i,o,d)=>{const c=11.11*(e-1),u=d??"#3b82f6",x="#9ca3af";return T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s,r]}),void 0!==o&&T.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["å‰å›: ",T.jsx("span",{className:"font-semibold",children:o})," / 10",(null==n?void 0:n.date)&&T.jsxs("span",{className:"ml-1",children:["ï¼ˆ",n.date,"ï¼‰"]})]}),T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-12",children:a}),T.jsx("input",{type:"range",min:"1",max:"10",value:e,onChange:e=>t(parseInt(e.target.value)),disabled:P,className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-60 disabled:cursor-not-allowed",style:{background:`linear-gradient(to right, ${u} 0%, ${u} ${c}%, ${x} ${c}%, ${x} 100%)`}}),T.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-12 text-right",children:l})]}),T.jsxs("div",{className:"text-center mt-2",children:[T.jsx("span",{className:`text-2xl font-bold ${i}`,children:e}),T.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" / 10"})]})]})};return T.jsxs(T.Fragment,{children:[T.jsx(yr,{open:w,type:k,message:S,onClose:()=>N(!1)}),T.jsxs("form",{onSubmit:async r=>{if(r.preventDefault(),b(""),P)return;const s={motivation_level:l,energy_level:o,stress_level:c,date:x,notes:g||void 0};j(!0);try{if(t){const e=await t(x);if(e)return $(e),I(s),void M(!0)}await e(s),z(),E("success","è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(a){b("ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error submitting motivation record:",a),E("error",`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==a?void 0:a.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{j(!1)}},className:"space-y-6",children:[p&&T.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:p}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"æ—¥ä»˜"}),T.jsx("input",{type:"date",value:x,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:P})]}),L(l,i,"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³",T.jsx(st,{className:"w-4 h-4 inline mr-2 text-blue-500"}),"ä½ã„","é«˜ã„","text-blue-500",null==n?void 0:n.motivation_level,"#3b82f6"),L(o,d,"ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¬ãƒ™ãƒ«",T.jsx(nr,{className:"w-4 h-4 inline mr-2 text-green-500"}),"ç–²åŠ´","å……å®Ÿ","text-green-500",null==n?void 0:n.energy_level,"#10b981"),L(c,u,"ã‚¹ãƒˆãƒ¬ã‚¹ãƒ¬ãƒ™ãƒ«",T.jsx(ye,{className:"w-4 h-4 inline mr-2 text-red-500"}),"ãƒªãƒ©ãƒƒã‚¯ã‚¹","é«˜ã‚¹ãƒˆãƒ¬ã‚¹","text-red-500",null==n?void 0:n.stress_level,"#ef4444"),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),T.jsx("textarea",{value:g,onChange:e=>h(e.target.value),placeholder:"ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚„æ°—æŒã¡ã‚’è¨˜éŒ²...",rows:3,disabled:P,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60"})]}),T.jsx("button",{type:"submit",disabled:P,className:"w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center "+(P?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:P?T.jsxs("span",{className:"inline-flex items-center gap-2",children:[T.jsx(ct,{className:"w-5 h-5 animate-spin"}),"ä¿å­˜ä¸­â€¦"]}):T.jsxs(T.Fragment,{children:[T.jsx(st,{className:"w-5 h-5 mr-2"}),"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜éŒ²ã™ã‚‹"]})})]}),R&&A&&T.jsx(ns,{isOpen:D,onClose:()=>{M(!1),$(null),I(null)},onCancel:()=>{M(!1),$(null),I(null)},onOverwrite:async()=>{if(R&&A&&!P){b(""),M(!1),j(!0);try{s?await s(R.id,{motivation_level:A.motivation_level,energy_level:A.energy_level,stress_level:A.stress_level,notes:A.notes}):await e(A),$(null),I(null),z(),E("success","ä¸Šæ›¸ãã—ã¦è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(t){b("ä¸Šæ›¸ãã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error overwriting motivation record:",t),E("error",`ä¸Šæ›¸ãã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==t?void 0:t.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{j(!1)}}},existingRecord:R,newValue:{motivation_level:A.motivation_level,energy_level:A.energy_level,stress_level:A.stress_level,notes:A.notes}})]})}function is({data:e}){const t=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},s=r.useMemo(()=>e.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).slice(-30).map(e=>({date:e.date,sleepHours:Number(e.sleep_hours),sleepQuality:e.sleep_quality,displayDate:t(e.date)})),[e]);if(0===e.length)return T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:T.jsxs("div",{className:"text-center px-4",children:[T.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-sm",children:"ç¡çœ è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†"})]})});const x=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return T.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[T.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:e.displayDate}),T.jsxs("div",{className:"space-y-1 text-sm",children:[T.jsxs("p",{className:"flex items-center",children:[T.jsx("span",{className:"w-3 h-3 bg-indigo-500 rounded-full mr-2"}),"ç¡çœ æ™‚é–“: ",T.jsxs("span",{className:"font-semibold ml-1",children:[e.sleepHours,"æ™‚é–“"]})]}),e.sleepQuality&&T.jsxs("p",{className:"flex items-center",children:[T.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),"ç¡çœ ã®è³ª: ",T.jsxs("span",{className:"font-semibold ml-1",children:[e.sleepQuality,"/5"]})]})]})]})}return null};return T.jsx("div",{className:"w-full h-64 sm:h-96",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:s,margin:{top:5,right:20,left:0,bottom:5},children:[T.jsx(l,{strokeDasharray:"3 3",className:"stroke-gray-300 dark:stroke-gray-700"}),T.jsx(i,{dataKey:"displayDate",tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),T.jsx(o,{label:{value:"æ™‚é–“",angle:-90,position:"insideLeft"},tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400",domain:[0,12]}),T.jsx(d,{content:T.jsx(x,{})}),T.jsx(m,{}),T.jsx(c,{y:7,stroke:"#10b981",strokeDasharray:"3 3",label:{value:"æ¨å¥¨æœ€ä½",position:"right",fill:"#10b981"}}),T.jsx(c,{y:9,stroke:"#3b82f6",strokeDasharray:"3 3",label:{value:"ç†æƒ³",position:"right",fill:"#3b82f6"}}),T.jsx(u,{type:"monotone",dataKey:"sleepHours",stroke:"#6366f1",strokeWidth:2,dot:{fill:"#6366f1",r:4},activeDot:{r:6},name:"ç¡çœ æ™‚é–“"})]})})})}function os({data:e}){const t=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},s=r.useMemo(()=>e.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).slice(-30).map(e=>({date:e.date,motivation:e.motivation_level,energy:e.energy_level,stress:e.stress_level,displayDate:t(e.date)})),[e]);if(0===e.length)return T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:T.jsxs("div",{className:"text-center px-4",children:[T.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-sm",children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†"})]})});const x=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return T.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[T.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:e.displayDate}),T.jsxs("div",{className:"space-y-1 text-sm",children:[T.jsxs("p",{className:"flex items-center",children:[T.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³: ",T.jsxs("span",{className:"font-semibold ml-1",children:[e.motivation,"/10"]})]}),T.jsxs("p",{className:"flex items-center",children:[T.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),"ã‚¨ãƒãƒ«ã‚®ãƒ¼: ",T.jsxs("span",{className:"font-semibold ml-1",children:[e.energy,"/10"]})]}),T.jsxs("p",{className:"flex items-center",children:[T.jsx("span",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),"ã‚¹ãƒˆãƒ¬ã‚¹: ",T.jsxs("span",{className:"font-semibold ml-1",children:[e.stress,"/10"]})]})]})]})}return null};return T.jsx("div",{className:"w-full h-64 sm:h-96",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:s,margin:{top:5,right:20,left:0,bottom:5},children:[T.jsx(l,{strokeDasharray:"3 3",className:"stroke-gray-300 dark:stroke-gray-700"}),T.jsx(i,{dataKey:"displayDate",tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),T.jsx(o,{domain:[0,10],tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),T.jsx(d,{content:T.jsx(x,{})}),T.jsx(m,{}),T.jsx(c,{y:5,stroke:"#94a3b8",strokeDasharray:"3 3",label:{value:"ä¸­é–“",position:"right",fill:"#94a3b8"}}),T.jsx(u,{type:"monotone",dataKey:"motivation",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³"}),T.jsx(u,{type:"monotone",dataKey:"energy",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",r:3},name:"ã‚¨ãƒãƒ«ã‚®ãƒ¼"}),T.jsx(u,{type:"monotone",dataKey:"stress",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:3},name:"ã‚¹ãƒˆãƒ¬ã‚¹"})]})})})}function ds({latestACWR:e,sleepHours:t,sleepQuality:r,motivationLevel:s,energyLevel:a,stressLevel:n}){const l=(()=>{let r=0,l=0;if(e&&(l++,"good"===e.riskLevel?r+=3:"caution"===e.riskLevel?r+=2:"low"===e.riskLevel?r+=2.5:r+=1),null!==t&&(l++,r+=t>=7&&t<=9?3:t>=6&&t<7?2:1),null!==s&&(l++,r+=s>=7?3:s>=5?2:1),null!==a&&(l++,r+=a>=7?3:a>=5?2:1),null!==n&&(l++,r+=n<=4?3:n<=6?2:1),0===l)return{level:"unknown",color:"gray",label:"ãƒ‡ãƒ¼ã‚¿ãªã—"};const i=r/l;return i>=2.5?{level:"excellent",color:"green",label:"æœ€é«˜",icon:Re}:i>=2?{level:"good",color:"blue",label:"è‰¯å¥½",icon:Vt}:i>=1.5?{level:"fair",color:"yellow",label:"æ³¨æ„",icon:fe}:{level:"poor",color:"red",label:"è­¦å‘Š",icon:Ht}})(),i=l.icon||fe,o=(()=>{const r=e&&("high"===e.riskLevel||"caution"===e.riskLevel),a=null!==t&&t<7;return r&&a?{text:"æ€ªæˆ‘ãƒªã‚¹ã‚¯æ¥µå¤§ï¼šç·´ç¿’è² è·ãŒé«˜ãã€ç¡çœ ä¸è¶³ã§ã™ã€‚ä¼‘æ¯ã‚’å„ªå…ˆã—ã¦ãã ã•ã„ã€‚",color:"text-red-700 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/20"}:null!==s&&s<5&&(null!==n&&n>7)?{text:"ãƒ¡ãƒ³ã‚¿ãƒ«æ³¨æ„ï¼šãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ä½ä¸‹ã¨ã‚¹ãƒˆãƒ¬ã‚¹éå¤šã§ã™ã€‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’æ¨å¥¨ã—ã¾ã™ã€‚",color:"text-orange-700 dark:text-orange-400",bg:"bg-orange-50 dark:bg-orange-900/20"}:a?{text:"ç¡çœ ä¸è¶³ï¼šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚ç¡çœ æ™‚é–“ã‚’ç¢ºä¿ã—ã¾ã—ã‚‡ã†ã€‚",color:"text-yellow-700 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"}:r?{text:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·æ³¨æ„ï¼šå›å¾©ã‚’å„ªå…ˆã—ã€è² è·ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚",color:"text-blue-700 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20"}:{text:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è‰¯å¥½ï¼šã“ã®ã¾ã¾è¨ˆç”»çš„ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚",color:"text-green-700 dark:text-green-400",bg:"bg-green-50 dark:bg-green-900/20"}})();return T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ä»Šæ—¥ã®ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),T.jsxs("div",{className:`flex items-center space-x-2 px-4 py-2 bg-${l.color}-100 dark:bg-${l.color}-900/20 rounded-full`,children:[T.jsx(i,{className:`w-5 h-5 text-${l.color}-600 dark:text-${l.color}-400`}),T.jsx("span",{className:`font-semibold text-${l.color}-700 dark:text-${l.color}-400`,children:l.label})]})]}),T.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6",children:[e&&T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[T.jsxs("div",{className:"flex items-center mb-2",children:[T.jsx(be,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),T.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ACWR"})]}),T.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.acwr})]}),null!==t&&T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[T.jsxs("div",{className:"flex items-center mb-2",children:[T.jsx(bt,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),T.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ç¡çœ "})]}),T.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t.toFixed(1),"h"]})]}),null!==s&&T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[T.jsxs("div",{className:"flex items-center mb-2",children:[T.jsx(st,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),T.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"æ„æ¬²"})]}),T.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[s,"/10"]})]})]}),T.jsx("div",{className:`${o.bg} border border-${l.color}-200 dark:border-${l.color}-800 rounded-lg p-4`,children:T.jsx("p",{className:`text-sm ${o.color}`,children:o.text})})]})}const cs=[{value:"cramps",label:"ç”Ÿç†ç—›",icon:nr},{value:"mood_changes",label:"æ°—åˆ†ã®å¤‰åŒ–",icon:We},{value:"fatigue",label:"ç–²åŠ´æ„Ÿ",icon:_e},{value:"headache",label:"é ­ç—›",icon:Ce},{value:"bloating",label:"è†¨æº€æ„Ÿ",icon:sr},{value:"breast_tenderness",label:"èƒ¸ã®å¼µã‚Š",icon:st},{value:"acne",label:"ãƒ‹ã‚­ãƒ“",icon:Lt},{value:"back_pain",label:"è…°ç—›",icon:Ot}];function us({selectedDate:e,periodStart:t,setPeriodStart:s,flowIntensity:a,setFlowIntensity:n,symptoms:l,setSymptoms:i,cycleNotes:o,setCycleNotes:d,periodDuration:c,setPeriodDuration:u,cycleLength:x,setCycleLength:m,error:g}){const[h,p]=r.useState(""),b=r.useMemo(()=>{if(!e||!h)return null;const t=new Date(e),r=new Date(h),s=Math.floor((r.getTime()-t.getTime())/864e5)+1;return Number.isFinite(s)&&s>0?s:null},[e,h]);return T.jsxs("div",{className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[T.jsx(Ve,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),T.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"æœˆçµŒå‘¨æœŸã‚’è¨˜éŒ²"})]}),g&&T.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[T.jsx(ye,{className:"w-5 h-5"}),T.jsx("span",{children:g})]}),T.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-4",children:[T.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[T.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:"ä»Šæ—¥ãŒæœˆçµŒé–‹å§‹ï¼ˆå‡ºè¡€1æ—¥ç›®ï¼‰"}),T.jsx("input",{type:"checkbox",checked:t,onChange:e=>s(e.target.checked),className:"h-5 w-5 accent-pink-600"})]}),T.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"â€»é–‹å§‹æ—¥ã®ç™»éŒ²ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«å‘¨æœŸã‚’ä¿å­˜ã—ã¾ã™"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(De,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†é–‹å§‹æ—¥ï¼ˆä»Šæ—¥ã®å…¥åŠ›æ—¥ï¼‰"]}),T.jsx("div",{className:"w-full px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-100",children:e})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(De,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†çµ‚äº†æ—¥ï¼ˆä»»æ„ï¼‰"]}),T.jsx("input",{type:"date",value:h,min:e,onChange:t=>{const r=t.target.value;if(p(r),r){const t=new Date(e),s=new Date(r),a=Math.floor((s.getTime()-t.getTime())/864e5)+1;Number.isFinite(a)&&a>0&&u(a)}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"}),null!=b&&T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ç”Ÿç†æœŸé–“: ",b,"æ—¥é–“"]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"çµŒè¡€é‡"}),T.jsxs("select",{value:a,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white",children:[T.jsx("option",{value:"light",children:"å°‘ãªã„"}),T.jsx("option",{value:"moderate",children:"æ™®é€š"}),T.jsx("option",{value:"heavy",children:"å¤šã„"})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç—‡çŠ¶"}),T.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:cs.map(e=>{const t=e.icon,r=l.includes(e.value);return T.jsxs("button",{type:"button",onClick:()=>(e=>{i(l.includes(e)?l.filter(t=>t!==e):[...l,e])})(e.value),className:"px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 "+(r?"border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-105":"border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300 hover:scale-105"),children:[T.jsx(t,{className:"w-4 h-4"}),T.jsx("span",{children:e.label})]},e.value)})})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"æœˆçµŒæœŸé–“ï¼ˆæ—¥ï¼‰"}),T.jsx("input",{type:"number",min:1,max:14,value:c,onChange:e=>u(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"å‘¨æœŸï¼ˆæ—¥ï¼‰"}),T.jsx("input",{type:"number",min:20,max:45,value:x,onChange:e=>m(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢"}),T.jsx("textarea",{value:o,onChange:e=>d(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"ãã®ä»–ã®ãƒ¡ãƒ¢..."})]}),T.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€» ä¿å­˜ã¯ä¸‹ã®ã€Œæ¬¡ã¸/å®Œäº†ã€ãƒœã‚¿ãƒ³ã§è¡Œã„ã¾ã™"})]})}function xs({userId:e,userGender:t,enableCycle:s,onTrainingSubmit:a,onTrainingCheckExisting:n,onTrainingUpdate:l,onWeightSubmit:i,onWeightCheckExisting:o,onWeightUpdate:d,onSleepSubmit:c,onSleepCheckExisting:u,onSleepUpdate:x,onMotivationSubmit:m,onMotivationCheckExisting:g,onMotivationUpdate:h,onCycleSubmit:p,onCycleUpdate:b,onClose:y,lastTrainingRecord:f,lastWeightRecord:v,lastSleepRecord:j,lastMotivationRecord:w}){const N=H(),k=!0===(s??"female"===t),[_,S]=r.useState(N),[C,E]=r.useState("training"),[D,M]=r.useState((null==f?void 0:f.rpe)??5),[R,$]=r.useState((null==f?void 0:f.duration_min)??60),[A,I]=r.useState((null==f?void 0:f.arrow_score)??50),[z,P]=r.useState((null==f?void 0:f.signal_score)??50),[L,q]=r.useState(null!=(null==v?void 0:v.weight_kg)?String(v.weight_kg):""),[F,O]=r.useState(""),[W,B]=r.useState((null==j?void 0:j.sleep_hours)??7),[U,V]=r.useState((null==j?void 0:j.sleep_quality)??3),[K,J]=r.useState(""),[Y,G]=r.useState((null==w?void 0:w.motivation_level)??7),[Z,X]=r.useState((null==w?void 0:w.energy_level)??7),[Q,ee]=r.useState((null==w?void 0:w.stress_level)??5),[te,re]=r.useState(""),[se,ae]=r.useState(!1),[ne,le]=r.useState(5),[ie,oe]=r.useState(28),[de,ce]=r.useState("moderate"),[ue,xe]=r.useState([]),[me,ge]=r.useState(""),[he,pe]=r.useState(new Set),[ye,fe]=r.useState(!1),[ve,je]=r.useState(""),[we,Ne]=r.useState(!1),[ke,_e]=r.useState(!1),[Se,Ce]=r.useState(null),[Ee,Me]=r.useState(null),[Te,$e]=r.useState(null),Ae=()=>{_e(!1),Me(null),$e(null),Ce(null)},Ie=({values:e,highlight:t})=>T.jsx("div",{className:"mt-1 flex justify-between text-[10px] leading-none text-gray-500 dark:text-gray-400 select-none",children:e.map(e=>T.jsx("span",{className:e===t?"font-semibold text-gray-700 dark:text-gray-200":"",children:e},e))}),ze=(()=>{var e,t;if(!Ee||!Te)return{existing:[],pending:[]};switch(Se){case"training":return{existing:[{label:"RPE",value:(null==(e=Ee.rpe)?void 0:e.toString())||"-"},{label:"æ™‚é–“",value:`${Ee.duration_min||0}åˆ†`},{label:"æˆé•·å®Ÿæ„Ÿ",value:null!=Ee.arrow_score?"å…¥åŠ›ã‚ã‚Š":"â€”"},{label:"æ„å›³ç†è§£",value:null!=Ee.signal_score?"å…¥åŠ›ã‚ã‚Š":"â€”"}],pending:[{label:"RPE",value:(null==(t=Te.rpe)?void 0:t.toString())||"-"},{label:"æ™‚é–“",value:`${Te.duration_min||0}åˆ†`},{label:"æˆé•·å®Ÿæ„Ÿ",value:"å…¥åŠ›ã‚ã‚Š"},{label:"æ„å›³ç†è§£",value:"å…¥åŠ›ã‚ã‚Š"}]};case"weight":return{existing:[{label:"ä½“é‡",value:`${Ee.weight_kg||0} kg`}],pending:[{label:"ä½“é‡",value:`${Te.weight_kg||0} kg`}]};case"conditioning":{const e=Ee;return{existing:[{label:"ç¡çœ æ™‚é–“",value:e.sleep?`${e.sleep.sleep_hours??0}æ™‚é–“`:"â€”"},{label:"ç¡çœ ã®è³ª",value:e.sleep?`${e.sleep.sleep_quality??0}/5`:"â€”"},{label:"ãƒ¢ãƒãƒ™",value:e.motivation?`${e.motivation.motivation_level??0}/10`:"â€”"},{label:"ã‚¨ãƒãƒ«ã‚®ãƒ¼",value:e.motivation?`${e.motivation.energy_level??0}/10`:"â€”"},{label:"ã‚¹ãƒˆãƒ¬ã‚¹",value:e.motivation?`${e.motivation.stress_level??0}/10`:"â€”"}],pending:[{label:"ç¡çœ æ™‚é–“",value:`${Te.sleep.sleep_hours??0}æ™‚é–“`},{label:"ç¡çœ ã®è³ª",value:`${Te.sleep.sleep_quality??0}/5`},{label:"ãƒ¢ãƒãƒ™",value:`${Te.motivation.motivation_level??0}/10`},{label:"ã‚¨ãƒãƒ«ã‚®ãƒ¼",value:`${Te.motivation.energy_level??0}/10`},{label:"ã‚¹ãƒˆãƒ¬ã‚¹",value:`${Te.motivation.stress_level??0}/10`}]}}default:return{existing:[],pending:[]}}})();return T.jsxs(T.Fragment,{children:[T.jsx(mr,{isOpen:ke,onClose:Ae,onOverwrite:async()=>{if(Ee&&Te&&Se){_e(!1),fe(!0);try{if("training"===Se)await l(Ee.id,{rpe:Te.rpe,duration_min:Te.duration_min,arrow_score:Te.arrow_score,signal_score:Te.signal_score}),pe(e=>new Set(e).add("training")),E("weight");else if("weight"===Se)await d(Ee.id,{weight_kg:Te.weight_kg,notes:Te.notes}),pe(e=>new Set(e).add("weight")),E("conditioning");else if("conditioning"===Se){const e=Ee,t=Te;e.sleep?await x(e.sleep.id,t.sleep):await c(t.sleep),e.motivation?await h(e.motivation.id,t.motivation):await m(t.motivation),pe(e=>new Set(e).add("conditioning")),k?E("cycle"):setTimeout(()=>y(),500)}Me(null),$e(null),Ce(null)}catch(e){je("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{fe(!1)}}},onCancel:Ae,title:(()=>{switch(Se){case"training":return"ç·´ç¿’è¨˜éŒ²";case"weight":return"ä½“é‡è¨˜éŒ²";case"conditioning":return"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³";default:return""}})(),date:_,existingValues:ze.existing,newValues:ze.pending}),T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] "+(we?"overflow-hidden":"overflow-y-auto"),children:[T.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 z-10",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ä»Šæ—¥ã®è¨˜éŒ²"}),T.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",type:"button",children:T.jsx(ar,{className:"w-6 h-6"})})]}),T.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[T.jsx(De,{className:"w-4 h-4"}),T.jsx("input",{type:"date",value:_,onChange:e=>S(e.target.value),className:"bg-transparent border-none text-gray-900 dark:text-white font-medium focus:outline-none"})]}),T.jsx("div",{className:"flex space-x-2",children:(k?["training","weight","conditioning","cycle"]:["training","weight","conditioning"]).map(e=>{const t=(e=>{switch(e){case"training":default:return be;case"weight":return Mt;case"conditioning":return st;case"cycle":return De}})(e),r=C===e,s=he.has(e);return T.jsxs("button",{onClick:()=>E(e),className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all flex items-center justify-center space-x-2 "+(r?"bg-blue-600 text-white shadow-lg":s?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),type:"button",children:[s?T.jsx(Re,{className:"w-4 h-4"}):T.jsx(t,{className:"w-4 h-4"}),T.jsx("span",{className:"hidden sm:inline",children:"training"===e?"ç·´ç¿’":"weight"===e?"ä½“é‡":"cycle"===e?"å‘¨æœŸ":"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"})]},e)})})]}),T.jsxs("div",{className:"p-6",children:["training"===C&&T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[T.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-lg",children:T.jsx(be,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ç·´ç¿’è¨˜éŒ²"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"RPEã¨ç·´ç¿’æ™‚é–“ã‚’è¨˜éŒ²"})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"RPE (ä¸»è¦³çš„é‹å‹•å¼·åº¦)"}),T.jsx("input",{type:"range",min:"0",max:"10",value:D,onChange:e=>M(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600"}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:["0 - ã¾ã£ãŸãæ¥½ã§ã‚ã‚‹","1 - éå¸¸ã«æ¥½ã§ã‚ã‚‹","2 - æ¥½ã§ã‚ã‚‹","3 - å°‘ã—ãã¤ã„","4 - ã‚„ã‚„ãã¤ã„","5 - ãã¤ã„","6 - ã‹ãªã‚Šãã¤ã„","7 - éå¸¸ã«ãã¤ã„","8 - æ¥µåº¦ã«ãã¤ã„","9 - é™ç•Œã«è¿‘ã„","10 - é™ç•Œ"][D]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ç·´ç¿’æ™‚é–“ï¼š",R,"åˆ†",T.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["ï¼ˆ",Math.floor(R/60),"æ™‚é–“",R%60,"åˆ†ï¼‰"]})]}),T.jsx("div",{className:"py-3 -my-3",children:T.jsx("input",{type:"range",min:"0",max:"480",step:"5",value:R,onChange:e=>$(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600"})}),T.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[T.jsx("span",{children:"0åˆ†"}),T.jsx("span",{children:"4æ™‚é–“"}),T.jsx("span",{children:"8æ™‚é–“"})]})]}),T.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:T.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-200",children:[T.jsx("strong",{children:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·:"})," ",D*R]})}),T.jsx(hr,{value:A,onChange:I}),T.jsx(br,{value:z,onChange:P})]}),"weight"===C&&T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[T.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg",children:T.jsx(Mt,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ä½“é‡è¨˜éŒ²"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ä½“é‡ã‚’è¨˜éŒ²"})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ä½“é‡ (kg)"}),T.jsx("input",{type:"number",step:"0.1",value:L,onChange:e=>q(e.target.value),placeholder:"ä¾‹: 65.5",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white text-lg"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ (ä»»æ„)"}),T.jsx("textarea",{value:F,onChange:e=>O(e.target.value),placeholder:"æ¸¬å®šæ™‚ã®çŠ¶æ³ãªã©",rows:2,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"})]}),v&&T.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:T.jsxs("p",{className:"text-sm text-green-900 dark:text-green-200",children:[T.jsx("strong",{children:"å‰å›ã®è¨˜éŒ²:"})," ",Number(v.weight_kg).toFixed(1)," kg"]})})]}),"conditioning"===C&&T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[T.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg",children:T.jsx(st,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç¡çœ ã¨ãƒ¡ãƒ³ã‚¿ãƒ«çŠ¶æ…‹ã‚’è¨˜éŒ²"})]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(bt,{className:"w-4 h-4 inline mr-1"}),"ç¡çœ æ™‚é–“ï¼š",T.jsxs("span",{className:"font-semibold",children:[W,"æ™‚é–“"]}),T.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["ï¼ˆ",Math.floor(W),"æ™‚é–“",Math.round(W%1*60),"åˆ†ï¼‰"]})]}),j&&T.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-2",children:["å‰å›ï¼ˆ",j.date,"ï¼‰ï¼š",j.sleep_hours,"æ™‚é–“",null!=(null==j?void 0:j.sleep_quality)?` / è³ª ${j.sleep_quality}/5`:""]}),T.jsx("div",{className:"py-3 -my-3",children:T.jsx("input",{type:"range",min:"0",max:"12",step:"0.25",value:W,onChange:e=>B(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),T.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[T.jsx("span",{children:"0h"}),T.jsx("span",{children:"6h"}),T.jsx("span",{children:"12h"})]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ç¡çœ ã®è³ªï¼š",T.jsx("span",{className:"font-semibold",children:U}),"/5"]}),j&&T.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",j.date,"ï¼‰ï¼š",(null==j?void 0:j.sleep_quality)??"â€”","/5"]}),T.jsx("div",{className:"py-3 -my-3",children:T.jsx("input",{type:"range",min:"1",max:"5",step:"1",value:U,onChange:e=>V(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),T.jsx(Ie,{values:[1,2,3,4,5],highlight:U}),T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[5===U&&"æœ€é«˜ã®ç¡çœ ",4===U&&"è‰¯ã„ç¡çœ ",3===U&&"æ™®é€š",2===U&&"ã‚„ã‚„ä¸è¶³",1===U&&"ç¡çœ ä¸è¶³"]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(nr,{className:"w-4 h-4 inline mr-1"}),"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ï¼š",T.jsx("span",{className:"font-semibold",children:Y}),"/10"]}),w&&T.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",w.date,"ï¼‰ï¼š",w.motivation_level,"/10"]}),T.jsx("div",{className:"py-3 -my-3",children:T.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:Y,onChange:e=>G(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),T.jsx(Ie,{values:[1,2,3,4,5,6,7,8,9,10],highlight:Y})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼š",T.jsx("span",{className:"font-semibold",children:Z}),"/10"]}),w&&T.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",w.date,"ï¼‰ï¼š",w.energy_level,"/10"]}),T.jsx("div",{className:"py-3 -my-3",children:T.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:Z,onChange:e=>X(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),T.jsx(Ie,{values:[1,2,3,4,5,6,7,8,9,10],highlight:Z})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ã‚¹ãƒˆãƒ¬ã‚¹ï¼š",T.jsx("span",{className:"font-semibold",children:Q}),"/10"]}),w&&T.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",w.date,"ï¼‰ï¼š",w.stress_level,"/10"]}),T.jsx("div",{className:"py-3 -my-3",children:T.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:Q,onChange:e=>ee(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),T.jsx(Ie,{values:[1,2,3,4,5,6,7,8,9,10],highlight:Q})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ (ä»»æ„)"}),T.jsx("textarea",{value:te,onChange:e=>re(e.target.value),placeholder:"ä½“èª¿ã®è©³ç´°ãªã©",rows:2,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"})]})]}),ve&&"cycle"!==C&&T.jsx("div",{className:"mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:T.jsx("p",{className:"text-sm text-red-700 dark:text-red-400",children:ve})}),"cycle"===C&&k&&T.jsx(us,{selectedDate:_,periodStart:se,setPeriodStart:ae,flowIntensity:de,setFlowIntensity:ce,symptoms:ue,setSymptoms:xe,cycleNotes:me,setCycleNotes:ge,periodDuration:ne,setPeriodDuration:le,cycleLength:ie,setCycleLength:oe,error:ve||null}),T.jsx("div",{className:"mt-6",children:T.jsx("button",{type:"button",onClick:()=>{(async e=>{fe(!0),je("");try{if("training"===e){const e=await n(_);return e?(Ce("training"),Me(e),$e({rpe:D,duration_min:R,date:_,arrow_score:A,signal_score:z}),_e(!0),void fe(!1)):(await a({rpe:D,duration_min:R,date:_,arrow_score:A??50,signal_score:z??50}),pe(e=>new Set(e).add("training")),void E("weight"))}if("weight"===e){if(L){const e=await o(_);if(e)return Ce("weight"),Me(e),$e({weight_kg:Number(L),date:_,notes:F||void 0}),_e(!0),void fe(!1);await i({weight_kg:Number(L),date:_,notes:F||void 0}),pe(e=>new Set(e).add("weight"))}return void E("conditioning")}if("conditioning"===e){const[e,t]=await Promise.all([u(_),g(_)]);return e||t?(Ce("conditioning"),Me({sleep:e,motivation:t}),$e({sleep:{sleep_hours:W,sleep_quality:U,date:_,notes:K||void 0},motivation:{motivation_level:Y,energy_level:Z,stress_level:Q,date:_,notes:te||void 0}}),_e(!0),void fe(!1)):(await c({sleep_hours:W,sleep_quality:U,date:_,notes:K||void 0}),await m({motivation_level:Y,energy_level:Z,stress_level:Q,date:_,notes:te||void 0}),pe(e=>new Set(e).add("conditioning")),void(k?E("cycle"):setTimeout(()=>y(),500)))}if("cycle"===e){if(se){if(!p)throw new Error("onCycleSubmit ãŒæœªè¨­å®šã§ã™");await p({cycle_start_date:_,period_duration_days:ne,cycle_length_days:ie,flow_intensity:de,symptoms:ue.length>0?ue:void 0,notes:me||void 0})}return pe(e=>new Set(e).add("cycle")),void setTimeout(()=>y(),500)}}catch(t){const r=t instanceof Error?t.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";je(`${"training"===e?"ç·´ç¿’":"weight"===e?"ä½“é‡":"cycle"===e?"å‘¨æœŸ":"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r}`)}finally{fe(!1)}})(C)},disabled:ye,className:"w-full py-3 rounded-xl font-semibold transition-colors "+(ye?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:ye?"ä¿å­˜ä¸­...":(k?"cycle"===C:"conditioning"===C)?"å®Œäº†":"æ¬¡ã¸"})}),T.jsx("div",{className:"mt-4 flex justify-center",children:T.jsx("button",{onClick:y,className:"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",type:"button",children:"å¾Œã§è¨˜éŒ²ã™ã‚‹"})})]})]})})]})}function ms({acwrData:e,weightRecords:t,sleepRecords:s,motivationRecords:a,trainingRecords:n,menstrualCycles:l=[],userGender:i,onOpenDetailView:o,onQuickAdd:d}){const c=r.useMemo(()=>{if(!e||0===e.length)return null;const t=e.filter(e=>null==e?void 0:e.date);return 0===t.length?e[e.length-1]??null:t.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t)},[e]),u=r.useMemo(()=>t&&0!==t.length?t.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[t]),m=r.useMemo(()=>s&&0!==s.length?s.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[s]),g=r.useMemo(()=>a&&0!==a.length?a.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[a]),h=r.useMemo(()=>n&&0!==n.length?n.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[n]),p=()=>{if(t.length<2)return null;const e=Number(t[0].weight_kg)-Number(t[1].weight_kg);return{value:e,isUp:e>0}},b=(()=>{let e=0,r=0;if(c&&(r++,"good"===c.riskLevel?e+=25:"caution"===c.riskLevel?e+=15:"low"===c.riskLevel?e+=20:e+=10),m){r++;const t=Number(m.sleep_hours),s=m.sleep_quality;e+=t>=7&&t<=9&&s>=7?25:t>=6&&s>=5?15:5}if(g){r++;const t=(g.motivation_level+g.energy_level+(10-g.stress_level))/3;e+=t>=7?25:t>=5?15:5}if(u&&t.length>=2){r++;const t=p();t&&Math.abs(t.value)<.5?e+=25:t&&Math.abs(t.value)<1?e+=15:e+=10}return 0===r?0:Math.round(e/r*4)})(),y=p(),f=(()=>{if(0===s.length)return null;const e=s.slice(0,7);return e.reduce((e,t)=>e+Number(t.sleep_hours),0)/e.length})(),v=e=>{switch(e){case"menstrual":return"text-red-600 dark:text-red-400";case"follicular":return"text-green-600 dark:text-green-400";case"ovulatory":return"text-yellow-600 dark:text-yellow-400";case"luteal":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}},j=e=>{switch(e){case"menstrual":return"bg-red-100 dark:bg-red-900/30";case"follicular":return"bg-green-100 dark:bg-green-900/30";case"ovulatory":return"bg-yellow-100 dark:bg-yellow-900/30";case"luteal":return"bg-blue-100 dark:bg-blue-900/30";default:return"bg-gray-100 dark:bg-gray-700"}},w=(()=>{if(!l||0===l.length)return null;const e=new Date;e.setHours(0,0,0,0);for(const t of l){const r=new Date(t.cycle_start_date);r.setHours(0,0,0,0);const s=t.cycle_end_date?new Date(t.cycle_end_date):null;if(s&&s.setHours(0,0,0,0),e>=r&&(!s||e<=s)){const s=Math.floor((e.getTime()-r.getTime())/864e5);if(t.period_duration_days&&s<t.period_duration_days)return{phase:"menstrual",cycle:t,daysSinceStart:s};if(t.cycle_length_days){const e=Math.floor(t.cycle_length_days/2);if(s<e)return{phase:"follicular",cycle:t,daysSinceStart:s};if(s<e+2)return{phase:"ovulatory",cycle:t,daysSinceStart:s};if(s<t.cycle_length_days)return{phase:"luteal",cycle:t,daysSinceStart:s}}}}return null})(),N=(()=>{if(!l||0===l.length)return null;const e=[...l].sort((e,t)=>new Date(t.cycle_start_date).getTime()-new Date(e.cycle_start_date).getTime())[0];if(!e.cycle_length_days)return null;const t=new Date(e.cycle_start_date),r=new Date(t);return r.setDate(r.getDate()+e.cycle_length_days),r})(),k="female"===i,_=r.useMemo(()=>[...t??[]].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[t]),S=r.useMemo(()=>{const e=_[0];if(!(null==e?void 0:e.date)||null==e.weight_kg)return null;const t=new Date(e.date),r=new Date(t);r.setDate(r.getDate()-30);const s=_.find(e=>(null==e?void 0:e.date)&&new Date(e.date)<=r&&null!=e.weight_kg);return s?Number(e.weight_kg)-Number(s.weight_kg):null},[_]);return x.useEffect(()=>{},[i,k,null==l?void 0:l.length]),T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 rounded-2xl shadow-lg p-6 text-white",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsxs("div",{children:[T.jsx("h2",{className:"text-2xl font-bold mb-1",children:"ç·åˆã‚¹ã‚³ã‚¢"}),T.jsx("p",{className:"text-blue-100 text-sm",children:"ã™ã¹ã¦ã®æŒ‡æ¨™ã‚’çµ±åˆã—ãŸå¥åº·çŠ¶æ…‹"})]}),T.jsxs("div",{className:"bg-white/20 rounded-full px-6 py-3",children:[T.jsx("div",{className:"text-4xl font-bold",children:b}),T.jsx("div",{className:"text-xs text-center text-blue-100",children:"/ 100"})]})]}),T.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4",children:[T.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[T.jsx(be,{className:"w-5 h-5 mb-1"}),T.jsx("div",{className:"text-xs text-blue-100",children:"ACWR"}),T.jsx("div",{className:"text-lg font-bold",children:"number"==typeof(null==c?void 0:c.acwr)?c.acwr.toFixed(2):"-"})]}),T.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[T.jsx(Mt,{className:"w-5 h-5 mb-1"}),T.jsx("div",{className:"text-xs text-blue-100",children:"ä½“é‡"}),T.jsx("div",{className:"text-lg font-bold",children:u?`${Number(u.weight_kg).toFixed(1)}kg`:"-"})]}),T.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[T.jsx(st,{className:"w-5 h-5 mb-1"}),T.jsx("div",{className:"text-xs text-blue-100",children:"ç¡çœ "}),T.jsx("div",{className:"text-lg font-bold",children:m?`${Number(m.sleep_hours).toFixed(1)}h`:"-"})]}),T.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[T.jsx(st,{className:"w-5 h-5 mb-1"}),T.jsx("div",{className:"text-xs text-blue-100",children:"æ„æ¬²"}),T.jsx("div",{className:"text-lg font-bold",children:g?`${g.motivation_level}/10`:"-"})]})]})]}),T.jsxs("div",{className:"grid grid-cols-1 gap-6 "+(k?"md:grid-cols-2 lg:grid-cols-4":"md:grid-cols-3"),children:[T.jsxs("div",{onClick:()=>o("training"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("div",{className:`p-3 rounded-lg ${c?(e=>{switch(e){case"good":return"bg-green-50 dark:bg-green-900/20";case"caution":return"bg-yellow-50 dark:bg-yellow-900/20";case"high":return"bg-red-50 dark:bg-red-900/20";default:return"bg-blue-50 dark:bg-blue-900/20"}})(c.riskLevel):"bg-gray-100 dark:bg-gray-700"}`,children:T.jsx(be,{className:`w-6 h-6 ${c?(e=>{switch(e){case"good":return"text-green-600 dark:text-green-400";case"caution":return"text-yellow-600 dark:text-yellow-400";case"high":return"text-red-600 dark:text-red-400";default:return"text-blue-600 dark:text-blue-400"}})(c.riskLevel):"text-gray-400"}`})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ç·´ç¿’è¨˜éŒ²"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Training Load"})]})]}),T.jsx(ze,{className:"w-5 h-5 text-gray-400"})]}),c?T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"mb-4",children:[T.jsxs("div",{className:"flex items-baseline space-x-2",children:[T.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-300",children:"number"==typeof(null==c?void 0:c.acwr)?c.acwr.toFixed(2):"ä¸æ˜"}),T.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ACWR"})]}),T.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:["high"===c.riskLevel&&T.jsx(fe,{className:"w-4 h-4 text-red-600"}),T.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["good"===c.riskLevel&&"ç†æƒ³çš„ãªè² è·","caution"===c.riskLevel&&"è² è·ãŒã‚„ã‚„é«˜ã‚","high"===c.riskLevel&&"æ€ªæˆ‘ãƒªã‚¹ã‚¯è­¦å‘Š","low"===c.riskLevel&&"è² è·ãŒã‚„ã‚„ä½ã‚"]})]})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"æ€¥æ€§è² è·"}),T.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:c.acuteLoad})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"æ…¢æ€§è² è·"}),T.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:c.chronicLoad})]})]}),h&&T.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:T.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[T.jsx("span",{children:"æœ€çµ‚è¨˜éŒ²"}),T.jsx("span",{children:new Date(h.date).toLocaleDateString("ja-JP")})]})})]}):T.jsxs("div",{className:"text-center py-8",children:[T.jsx(be,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),T.jsxs("div",{onClick:()=>o("weight"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg",children:T.jsx(Mt,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ä½“é‡ç®¡ç†"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Weight Tracking"})]})]}),T.jsx(ze,{className:"w-5 h-5 text-gray-400"})]}),u?T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"mb-4",children:[T.jsxs("div",{className:"flex items-baseline space-x-2",children:[T.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:Number(u.weight_kg).toFixed(1)}),T.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"kg"})]}),y&&T.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[y.isUp?T.jsx(Vt,{className:"w-4 h-4 text-red-500"}):T.jsx(Ht,{className:"w-4 h-4 text-blue-500"}),T.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["å‰å›æ¯” ",y.isUp?"+":"",y.value.toFixed(1),"kg"]})]})]}),T.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 mb-3",children:[T.jsx("p",{className:"text-xs text-green-700 dark:text-green-400 mb-1",children:"30æ—¥é–“ã®å¤‰åŒ–"}),T.jsx("p",{className:"text-lg font-bold text-green-800 dark:text-green-300",children:null!==S?`${S.toFixed(1)}kg`:"-"})]}),T.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:T.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[T.jsx("span",{children:"æœ€çµ‚è¨˜éŒ²"}),T.jsx("span",{children:new Date(u.date).toLocaleDateString("ja-JP")})]})})]}):T.jsxs("div",{className:"text-center py-8",children:[T.jsx(Mt,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),T.jsxs("div",{onClick:()=>o("conditioning"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg",children:T.jsx(st,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sleep & Wellness"})]})]}),T.jsx(ze,{className:"w-5 h-5 text-gray-400"})]}),m&&g?T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"space-y-3 mb-4",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç¡çœ æ™‚é–“"}),T.jsxs("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[Number(m.sleep_hours).toFixed(1),"h"]})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç¡çœ ã®è³ª"}),T.jsxs("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[m.sleep_quality,"/10"]})]})]}),T.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mb-3",children:T.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"æ„æ¬²"}),T.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:g.motivation_level})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"æ´»åŠ›"}),T.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:g.energy_level})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"ã‚¹ãƒˆãƒ¬ã‚¹"}),T.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:g.stress_level})]})]})}),f&&T.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["é€±å¹³å‡ç¡çœ : ",f.toFixed(1),"æ™‚é–“"]}),T.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:T.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[T.jsx("span",{children:"æœ€çµ‚è¨˜éŒ²"}),T.jsx("span",{children:new Date(m.date).toLocaleDateString("ja-JP")})]})})]}):T.jsxs("div",{className:"text-center py-8",children:[T.jsx(st,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),k&&T.jsxs("div",{onClick:()=>o("cycle"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("div",{className:`${w?j(w.phase):"bg-pink-100 dark:bg-pink-900/30"} p-3 rounded-lg`,children:T.jsx(Ve,{className:`w-6 h-6 ${w?v(w.phase):"text-pink-600 dark:text-pink-400"}`})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"æœˆçµŒå‘¨æœŸ"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Menstrual Cycle"})]})]}),T.jsx(ze,{className:"w-5 h-5 text-gray-400"})]}),w?T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"mb-4",children:[T.jsx("div",{className:"flex items-baseline space-x-2",children:T.jsx("span",{className:`text-2xl font-bold ${v(w.phase)}`,children:(e=>{switch(e){case"menstrual":return"æœˆçµŒæœŸ";case"follicular":return"åµèƒæœŸ";case"ovulatory":return"æ’åµæœŸ";case"luteal":return"é»„ä½“æœŸ";default:return"ä¸æ˜"}})(w.phase)})}),T.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["å‘¨æœŸé–‹å§‹ã‹ã‚‰",w.daysSinceStart+1,"æ—¥ç›®"]})]}),T.jsxs("div",{className:`${j(w.phase)} rounded-lg p-3 mb-3`,children:[T.jsx("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ¨å¥¨"}),T.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:(e=>{switch(e){case"menstrual":return"ä½ï½ä¸­å¼·åº¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’æ¨å¥¨";case"follicular":return"é«˜å¼·åº¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«æœ€é©";case"ovulatory":return"ãƒ”ãƒ¼ã‚¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœŸ";case"luteal":return"å›å¾©é‡è¦–ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’";default:return""}})(w.phase)})]}),N&&T.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3",children:[T.jsx("p",{className:"text-xs text-pink-700 dark:text-pink-400 mb-1",children:"æ¬¡å›äºˆæ¸¬æ—¥"}),T.jsx("p",{className:"text-lg font-bold text-pink-800 dark:text-pink-300",children:N.toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}),T.jsxs("p",{className:"text-xs text-pink-600 dark:text-pink-400 mt-1",children:[Math.ceil((N.getTime()-(new Date).getTime())/864e5),"æ—¥å¾Œ"]})]})]}):T.jsxs("div",{className:"text-center py-8",children:[T.jsx(Ve,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"å‘¨æœŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"æœˆçµŒå‘¨æœŸã‚’è¨˜éŒ²ã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’æœ€é©åŒ–"})]})]})]}),T.jsxs("button",{onClick:d,className:"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl p-4 flex items-center justify-center space-x-2 font-medium transition-colors shadow-lg",children:[T.jsx(kt,{className:"w-5 h-5"}),T.jsx("span",{children:"ä»Šæ—¥ã®è¨˜éŒ²ã‚’è¿½åŠ "})]})]})}function gs({acwrData:e,weightRecords:t,sleepRecords:s,motivationRecords:c}){const[x,g]=r.useState({acwr:!0,weight:!0,sleep:!0,motivation:!0,energy:!1}),[h,p]=r.useState("30d"),b=e=>e>=(e=>{const t=(new Date).getTime()+324e5,r=new Date(t);return r.setUTCDate(r.getUTCDate()-e),Y(r)})("7d"===h?7:"30d"===h?30:90),y=(()=>{const r=new Map;return e.filter(e=>b(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).acwr=e.acwr,r.get(e.date).acuteLoad=e.acuteLoad}),t.filter(e=>b(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).weight=Number(e.weight_kg)}),s.filter(e=>b(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).sleep=Number(e.sleep_hours),r.get(e.date).sleepQuality=e.sleep_quality}),c.filter(e=>b(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).motivation=e.motivation_level,r.get(e.date).energy=e.energy_level,r.get(e.date).stress=e.stress_level}),Array.from(r.values()).sort((e,t)=>e.date.localeCompare(t.date))})(),f=e=>{g(t=>({...t,[e]:!t[e]}))},v=({active:e,payload:t,label:r})=>e&&t&&t.length?T.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4",children:[T.jsx("p",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:new Date(r).toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}),T.jsx("div",{className:"space-y-1",children:t.map(e=>T.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[T.jsxs("span",{className:"text-sm",style:{color:e.color},children:[e.name,":"]}),T.jsxs("span",{className:"font-semibold text-sm",style:{color:e.color},children:[void 0!==e.value?e.value.toFixed(1):"-","weight"===e.dataKey&&"kg",("sleep"===e.dataKey||"sleepHours"===e.dataKey)&&"h"]})]},e.dataKey))})]}):null;return T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 space-y-4 sm:space-y-0",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:"çµ±åˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ã™ã¹ã¦ã®æŒ‡æ¨™ã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤º"})]}),T.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[T.jsx("button",{onClick:()=>p("7d"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("7d"===h?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:"7æ—¥"}),T.jsx("button",{onClick:()=>p("30d"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("30d"===h?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:"30æ—¥"}),T.jsx("button",{onClick:()=>p("90d"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("90d"===h?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:"90æ—¥"})]})]}),T.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[T.jsxs("button",{onClick:()=>f("acwr"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(x.acwr?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-2 border-blue-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[T.jsx(be,{className:"w-4 h-4"}),T.jsx("span",{children:"ACWR"})]}),T.jsxs("button",{onClick:()=>f("weight"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(x.weight?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-2 border-green-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[T.jsx(Mt,{className:"w-4 h-4"}),T.jsx("span",{children:"ä½“é‡"})]}),T.jsxs("button",{onClick:()=>f("sleep"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(x.sleep?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 border-2 border-purple-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[T.jsx(bt,{className:"w-4 h-4"}),T.jsx("span",{children:"ç¡çœ æ™‚é–“"})]}),T.jsxs("button",{onClick:()=>f("motivation"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(x.motivation?"bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-400 border-2 border-pink-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[T.jsx(st,{className:"w-4 h-4"}),T.jsx("span",{children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³"})]}),T.jsxs("button",{onClick:()=>f("energy"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(x.energy?"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 border-2 border-orange-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[T.jsx(nr,{className:"w-4 h-4"}),T.jsx("span",{children:"ã‚¨ãƒãƒ«ã‚®ãƒ¼"})]})]}),0===y.length?T.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-500 dark:text-gray-400",children:[T.jsx(be,{className:"w-16 h-16 mb-4 opacity-20"}),T.jsx("p",{children:"é¸æŠã—ãŸæœŸé–“ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]}):T.jsx(a,{width:"100%",height:400,children:T.jsxs(n,{data:y,children:[T.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),T.jsx(i,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},stroke:"#9CA3AF",style:{fontSize:"12px"}}),T.jsx(o,{stroke:"#9CA3AF",style:{fontSize:"12px"}}),T.jsx(d,{content:T.jsx(v,{})}),T.jsx(m,{wrapperStyle:{fontSize:"12px"},iconType:"line"}),x.acwr&&T.jsx(u,{type:"monotone",dataKey:"acwr",name:"ACWR",stroke:"#3B82F6",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),x.weight&&T.jsx(u,{type:"monotone",dataKey:"weight",name:"ä½“é‡ (kg)",stroke:"#10B981",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),x.sleep&&T.jsx(u,{type:"monotone",dataKey:"sleep",name:"ç¡çœ  (h)",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),x.motivation&&T.jsx(u,{type:"monotone",dataKey:"motivation",name:"æ„æ¬²",stroke:"#EC4899",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),x.energy&&T.jsx(u,{type:"monotone",dataKey:"energy",name:"æ´»åŠ›",stroke:"#F59E0B",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})}),T.jsxs("div",{className:"mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4",children:[T.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[T.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-400 mb-1",children:"è¨˜éŒ²æ•°"}),T.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-300",children:y.length}),T.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"æ—¥åˆ†"})]}),T.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[T.jsx("p",{className:"text-xs text-green-700 dark:text-green-400 mb-1",children:"å¹³å‡ACWR"}),T.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-300",children:y.filter(e=>e.acwr).length>0?(y.reduce((e,t)=>e+(t.acwr||0),0)/y.filter(e=>e.acwr).length).toFixed(2):"-"})]}),T.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[T.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"å¹³å‡ç¡çœ "}),T.jsx("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-300",children:y.filter(e=>e.sleep).length>0?(y.reduce((e,t)=>e+(t.sleep||0),0)/y.filter(e=>e.sleep).length).toFixed(1):"-"}),T.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:"æ™‚é–“"})]}),T.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3",children:[T.jsx("p",{className:"text-xs text-pink-700 dark:text-pink-400 mb-1",children:"å¹³å‡æ„æ¬²"}),T.jsx("p",{className:"text-2xl font-bold text-pink-900 dark:text-pink-300",children:y.filter(e=>e.motivation).length>0?(y.reduce((e,t)=>e+(t.motivation||0),0)/y.filter(e=>e.motivation).length).toFixed(1):"-"}),T.jsx("p",{className:"text-xs text-pink-600 dark:text-pink-400",children:"/10"})]})]})]})}function hs({onClick:e,onCameraClick:t}){return T.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex items-center gap-3",children:[t&&T.jsx("button",{type:"button",onClick:t,className:"h-14 w-14 rounded-full shadow-lg\n                     bg-blue-600 text-white\n                     flex items-center justify-center\n                     active:scale-95 transition","aria-label":"é£Ÿäº‹ã‚’æ’®å½±ãƒ»é¸æŠ",children:T.jsx(Me,{className:"w-6 h-6"})}),T.jsx("button",{type:"button",onClick:e,className:"h-14 w-14 rounded-full shadow-lg\n                   bg-blue-600 text-white\n                   flex items-center justify-center\n                   active:scale-95 transition","aria-label":"ä»Šæ—¥ã®è¨˜éŒ²ã‚’è¿½åŠ ",children:T.jsx(kt,{className:"w-7 h-7"})})]})}function ps(e,t){const r=new Date(e+"T00:00:00.000Z");return r.setUTCDate(r.getUTCDate()+t),r.toISOString().slice(0,10)}function bs(e){if(!e)return[];const t=e.next_action_items??[];return Array.isArray(t)&&t.length>0?t:e.next_action&&e.next_action.trim()?[{text:e.next_action.trim(),done:!1,done_at:null}]:[]}const ys=["æ „é¤Š","ç¡çœ ","ä½“èª¿","ç–²åŠ´","ç—›ã¿","ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·","è©¦åˆãƒ»é€£æˆ¦","ç§»å‹•","ç”¨å…·","ãƒ¡ãƒ³ã‚¿ãƒ«","é›†ä¸­","ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³","æ™‚é–“ç®¡ç†","å­¦æ¥­","äººé–“é–¢ä¿‚","ç’°å¢ƒ","ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³"];function fs({userId:e}){const t=r.useMemo(()=>new Date((new Date).getTime()+324e5).toISOString().slice(0,10),[]),s=r.useMemo(()=>function(){const e=new Date((new Date).getTime()+324e5);return e.setDate(e.getDate()-1),e.toISOString().slice(0,10)}(),[]),[a,n]=r.useState(0),l=r.useMemo(()=>function(e=0){const t=new Date((new Date).getTime()+324e5),r=(t.getDay()+6)%7;return t.setDate(t.getDate()-r+7*e),t.setHours(0,0,0,0),t.toISOString().slice(0,10)}(a),[a]),i=r.useMemo(()=>ps(l,6),[l]),[o,d]=r.useState(!0),[c,u]=r.useState(null),[x,m]=r.useState(null),[g,h]=r.useState([]),[p,b]=r.useState(!1),[y,f]=r.useState([]),[v,j]=r.useState([{text:"",done:!1,done_at:null}]),[w,N]=r.useState(""),[k,_]=r.useState(""),[S,C]=r.useState([]),[E,D]=r.useState(""),[M,R]=r.useState(!1),[$,A]=r.useState(!1);r.useEffect(()=>{if(!e)return;(async()=>{d(!0);try{const{data:r,error:a}=await z.from("reflections").select("*").eq("user_id",e).in("reflection_date",[t,s]);if(a)throw a;const n=(r||[]).find(e=>e.reflection_date===t)??null,l=(r||[]).find(e=>e.reflection_date===s)??null;u(n),m(l);const i=bs(l);if(f(i),n){N(n.did??""),_(n.didnt??""),C(n.cause_tags??[]),D(n.free_note??"");const e=bs(n);j(e.length?e:[{text:"",done:!1,done_at:null}])}else j([{text:"",done:!1,done_at:null}])}catch(r){console.error("Failed to load reflections (daily):",r)}finally{d(!1)}})()},[e,t,s]),r.useEffect(()=>{if(!e)return;(async()=>{b(!0);try{const t=ps(l,7),{data:r,error:s}=await z.from("reflections").select("id, user_id, reflection_date, did, didnt, cause_tags, next_action_items").eq("user_id",e).gte("reflection_date",l).lt("reflection_date",t).order("reflection_date",{ascending:!0});if(s)throw s;h(r||[])}catch(t){console.error("Failed to load reflections (week):",t)}finally{b(!1)}})()},[e,l]);const I=r.useMemo(()=>{const e=g.filter(e=>(e.did??"").trim().length>0).length,t=g.filter(e=>(e.didnt??"").trim().length>0).length,r={};g.forEach(e=>{(e.cause_tags??[]).forEach(e=>{const t=(e??"").trim();t&&(r[t]=(r[t]??0)+1)})});const s=Object.entries(r).sort((e,t)=>t[1]-e[1]).slice(0,3);let a=0,n=0;const l={};g.forEach(e=>{(e.next_action_items??[]).forEach(e=>{const t=((null==e?void 0:e.text)??"").trim();t&&(a+=1,e.done&&(n+=1),l[t]=l[t]??{total:0,done:0},l[t].total+=1,e.done&&(l[t].done+=1))})});const i=a?Math.round(n/a*100):0,o=Object.entries(l).map(([e,t])=>({text:e,total:t.total,done:t.done,rate:t.total?Math.round(t.done/t.total*100):0})).sort((e,t)=>t.total-e.total).slice(0,3);return{didCount:e,didntCount:t,topTags:s,goals:a,done:n,completionRate:i,topGoals:o,days:g.length}},[g]);return o?T.jsx("div",{className:"rounded-xl p-6 shadow-sm bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100",children:"èª­ã¿è¾¼ã¿ä¸­..."}):T.jsxs("div",{className:"rounded-xl p-6 shadow-sm space-y-6 bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100",children:[T.jsxs("div",{className:"rounded-lg border p-4\n        border-amber-200 bg-amber-50 text-amber-950\n        dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-100\n      ",children:[T.jsxs("div",{className:"flex items-start justify-between gap-3",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold",children:"é€±ã®å‚¾å‘"}),T.jsxs("div",{className:"text-xs mt-1 text-amber-800 dark:text-amber-200/80",children:[l," ã€œ ",i,"ï¼ˆ",I.days,"æ—¥åˆ†ï¼‰",p&&T.jsx("span",{className:"ml-2",children:"èª­ã¿è¾¼ã¿ä¸­â€¦"})]})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("button",{type:"button",onClick:()=>n(e=>e-1),className:"\n                text-xs px-3 py-1 rounded-lg border\n                border-amber-300 bg-white hover:bg-amber-100\n                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800\n              ",children:"ï¼œ å…ˆé€±"}),T.jsx("button",{type:"button",onClick:()=>n(0),disabled:0===a,className:"\n                text-xs px-3 py-1 rounded-lg border\n                border-amber-300 bg-white hover:bg-amber-100 disabled:opacity-50\n                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800\n              ",children:"ä»Šé€±ã¸æˆ»ã‚‹"})]})]}),T.jsxs("div",{className:"mt-3 text-sm",children:["ã§ããŸï¼š",I.didCount,"ä»¶ ï¼ ã§ããªã‹ã£ãŸï¼š",I.didntCount,"ä»¶"]}),T.jsxs("div",{className:"mt-1 text-sm",children:["è¡Œå‹•ç›®æ¨™ï¼š",I.goals,"ä»¶ ï¼ å®Œäº†ï¼š",I.done,"ä»¶ï¼ˆ",I.completionRate,"%ï¼‰"]}),T.jsxs("div",{className:"mt-3 space-y-2",children:[T.jsx("div",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200/80",children:"åŸå› ã‚¿ã‚° TOP3"}),0===I.topTags.length?T.jsx("div",{className:"text-sm text-amber-800 dark:text-amber-200/80",children:"ã¾ã åŸå› ã‚¿ã‚°ãŒã‚ã‚Šã¾ã›ã‚“"}):T.jsx("div",{className:"flex flex-wrap gap-2",children:I.topTags.map(([e,t])=>T.jsxs("span",{className:"\n                    px-3 py-1 rounded-full text-xs border\n                    border-amber-200 bg-white text-amber-950\n                    dark:border-amber-900/60 dark:bg-gray-950 dark:text-amber-100\n                  ",children:[e,"ï¼š",t]},e))})]}),I.topGoals.length>0&&T.jsxs("div",{className:"mt-4 space-y-2",children:[T.jsx("div",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200/80",children:"ã‚ˆãç«‹ã¦ã‚‹è¡Œå‹•ç›®æ¨™ TOP3"}),I.topGoals.map(e=>T.jsxs("div",{className:"flex items-center justify-between gap-3",children:[T.jsx("div",{className:"text-sm flex-1",children:e.text}),T.jsxs("div",{className:"text-xs text-amber-800 dark:text-amber-200/80 w-28 text-right",children:[e.done,"/",e.total,"ï¼ˆ",e.rate,"%ï¼‰"]})]},e.text))]})]}),T.jsxs("div",{className:"rounded-lg border p-4\n        border-blue-200 bg-blue-50 text-blue-950\n        dark:border-blue-900/40 dark:bg-blue-950/30 dark:text-blue-100\n      ",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("h3",{className:"font-semibold",children:"ä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨ï¼ˆæ˜¨æ—¥ã®ç›®æ¨™ï¼‰"}),T.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-200/80",children:[s," ã«è¨­å®š"]})]}),0===y.length?T.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200/80 mt-2",children:"æ˜¨æ—¥ã®ã€Œè¡Œå‹•ç›®æ¨™ã€ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚æ˜¨æ—¥ã®æŒ¯ã‚Šè¿”ã‚Šã§è¡Œå‹•ç›®æ¨™ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã“ã“ã«å‡ºã¾ã™ã€‚"}):T.jsxs("div",{className:"mt-3 space-y-2",children:[y.map((e,t)=>T.jsxs("label",{className:"\n                  flex items-center gap-3 rounded-lg px-3 py-2 border\n                  bg-white border-blue-200\n                  dark:bg-gray-950 dark:border-blue-900/50\n                ",children:[T.jsx("input",{type:"checkbox",checked:!!e.done,onChange:()=>(async e=>{var t;if(!x)return;const r=[...y],s=r[e];if(!s)return;const a=(new Date).toISOString(),n={...s,done:!s.done,done_at:s.done?null:a};r[e]=n,f(r),R(!0);try{const{error:e}=await z.from("reflections").update({next_action_items:r,next_action:(null==(t=r[0])?void 0:t.text)??null,updated_at:(new Date).toISOString()}).eq("id",x.id);if(e)throw e;m(e=>{var t;return e?{...e,next_action_items:r,next_action:(null==(t=r[0])?void 0:t.text)??null}:e}),h(e=>e.map(e=>e.id===x.id?{...e,next_action_items:r}:e))}catch(l){console.error("Failed to save todo:",l),f(bs(x))}finally{R(!1)}})(t),disabled:M,className:"h-4 w-4 accent-green-600"}),T.jsxs("div",{className:"flex-1",children:[T.jsx("div",{className:"text-sm "+(e.done?"line-through text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"),children:e.text}),e.done_at&&T.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["å®Œäº†: ",new Date(e.done_at).toLocaleString("ja-JP")]})]}),e.done&&T.jsx(Re,{className:"h-4 w-4 text-green-600"})]},t)),T.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-200/80 mt-2",children:M?"ä¿å­˜ä¸­â€¦":"ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨å³ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆå®Œäº†ä¿å­˜ï¼‰"})]})]}),T.jsxs("div",{className:"space-y-3",children:[T.jsx("h3",{className:"font-semibold",children:"ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š"}),T.jsxs("div",{children:[T.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ã§ããŸã“ã¨"}),T.jsx("input",{value:w,onChange:e=>N(e.target.value),className:"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            ",placeholder:"ä¾‹ï¼šå¼·åº¦é«˜ã‚ã®ç·´ç¿’ã‚’æœ€å¾Œã¾ã§ã‚„ã‚Šåˆ‡ã‚ŒãŸ"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ã§ããªã‹ã£ãŸã“ã¨"}),T.jsx("input",{value:k,onChange:e=>_(e.target.value),className:"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            ",placeholder:"ä¾‹ï¼šç¡çœ æ™‚é–“ã‚’ç¢ºä¿ã§ããªã‹ã£ãŸ"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"åŸå› ã‚¿ã‚°"}),T.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ys.map(e=>{const t=S.includes(e);return T.jsx("button",{type:"button",onClick:()=>(e=>{C(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:`\n                    px-3 py-1 rounded-full text-xs border transition\n                    ${t?"bg-gray-900 text-white border-gray-900":"bg-slate-100 text-slate-800 border-slate-200 hover:bg-slate-200"}\n                    dark:${t?"bg-green-600 text-white border-green-600":"bg-slate-700 text-slate-100 border-slate-600 hover:bg-slate-600"}\n                  `,children:e},e)})}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"ã€Œã§ããªã‹ã£ãŸã€ã®ä¸»å› ã‚’ä»®èª¬ã§OKã€‚é€±ã®å‚¾å‘ã«é›†è¨ˆã•ã‚Œã¾ã™ã€‚"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ãƒ¡ãƒ¢"}),T.jsx("textarea",{value:E,onChange:e=>D(e.target.value),className:"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            ",rows:3,placeholder:"è‡ªç”±ãƒ¡ãƒ¢"})]}),T.jsxs("div",{className:"rounded-lg border p-4 border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("h4",{className:"font-semibold",children:"æ˜æ—¥ã®è¡Œå‹•ç›®æ¨™ï¼ˆè¤‡æ•°ï¼‰"}),T.jsxs("button",{type:"button",onClick:()=>{j(e=>[...e,{text:"",done:!1,done_at:null}])},className:"\n                text-sm px-3 py-1 rounded-lg flex items-center gap-2\n                bg-gray-900 text-white hover:bg-gray-800\n                dark:bg-green-600 dark:hover:bg-green-700\n              ",children:[T.jsx(kt,{className:"h-4 w-4"}),"è¿½åŠ "]})]}),T.jsx("div",{className:"mt-3 space-y-2",children:v.map((e,t)=>T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("input",{value:e.text,onChange:e=>((e,t)=>{j(r=>{const s=[...r];return s[e]={...s[e],text:t},s})})(t,e.target.value),className:"\n                    flex-1 border rounded-lg px-3 py-2\n                    bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n                    focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n                    dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n                    dark:focus:ring-green-500 dark:focus:border-green-500\n                  ",placeholder:"ä¾‹ï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’10åˆ†é–“è¡Œã†"}),T.jsx("button",{type:"button",onClick:()=>(e=>{j(t=>{const r=t.filter((t,r)=>r!==e);return r.length?r:[{text:"",done:!1,done_at:null}]})})(t),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"})})]},t))}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"ã“ã“ã§è¨­å®šã—ãŸã€Œæ˜æ—¥ã®è¡Œå‹•ç›®æ¨™ã€ã¯ã€ç¿Œæ—¥ã®ã‚«ãƒ¼ãƒ‰ä¸Šéƒ¨ã«â€œä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨â€ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"})]}),T.jsx("button",{onClick:async()=>{var r;if(e){A(!0);try{const s=v.map(e=>({...e,text:(e.text??"").trim()})).filter(e=>e.text.length>0),a={user_id:e,reflection_date:t,did:w.trim(),didnt:k.trim(),cause_tags:S,free_note:E.trim(),next_action_items:s,next_action:(null==(r=s[0])?void 0:r.text)??null,metadata:{source:"daily_reflection_card"},updated_at:(new Date).toISOString()};if(null==c?void 0:c.id){const{error:e}=await z.from("reflections").update(a).eq("id",c.id);if(e)throw e;u(e=>e?{...e,...a}:e),h(e=>e.map(e=>e.id===c.id?{...e,...a}:e))}else{const{data:e,error:r}=await z.from("reflections").insert(a).select("*").single();if(r)throw r;u(e),t>=l&&t<=i&&h(t=>{const r={id:e.id,user_id:e.user_id,reflection_date:e.reflection_date,did:e.did,didnt:e.didnt,cause_tags:e.cause_tags??a.cause_tags,next_action_items:e.next_action_items??a.next_action_items};return[...t.filter(e=>e.id!==r.id),r].sort((e,t)=>e.reflection_date.localeCompare(t.reflection_date))})}}catch(s){console.error("Failed to save reflection:",s)}finally{A(!1)}}},disabled:$,className:"\n            w-full rounded-lg px-4 py-3 font-medium\n            bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50\n            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\n            dark:focus:ring-offset-gray-900\n          ",children:$?"ä¿å­˜ä¸­â€¦":"ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Šã‚’ä¿å­˜"})]})]})}function vs({userId:e,highlight:t}){const[s,a]=r.useState(!1),[n,l]=r.useState(""),[i,o]=r.useState(!1),[d,c]=r.useState(!1),[u,x]=r.useState(!1),m=r.useMemo(()=>i&&!d,[i,d]);return T.jsxs(T.Fragment,{children:[T.jsxs("button",{type:"button",onClick:()=>a(!0),className:["w-full rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-colors","border",t?"bg-blue-600 text-white border-blue-600 hover:bg-blue-700 active:bg-blue-800":"bg-white dark:bg-gray-900 text-gray-900 dark:text-white border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/60 active:bg-gray-100 dark:active:bg-gray-800"].join(" "),children:[T.jsx(Rt,{className:"w-4 h-4"}),T.jsx("span",{className:"font-medium",children:"çŠ¶æ…‹ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«å…±æœ‰ã™ã‚‹"})]}),s&&T.jsxs("div",{className:"fixed inset-0 z-50",children:[T.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>!d&&a(!1)}),T.jsxs("div",{className:"absolute left-1/2 top-1/2 w-[92vw] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-2xl bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-2xl overflow-hidden",children:[T.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[T.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:"å…±æœ‰å†…å®¹ã®ç¢ºèª"}),T.jsx("button",{type:"button",onClick:()=>!d&&a(!1),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 active:bg-gray-200 dark:active:bg-white/15","aria-label":"é–‰ã˜ã‚‹",children:T.jsx(ar,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})})]}),T.jsxs("div",{className:"p-4 space-y-4",children:[T.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-200 space-y-1",children:[T.jsx("p",{children:"ã‚¹ã‚¿ãƒƒãƒ•ã«ä»¥ä¸‹ã®æƒ…å ±ãŒå…±æœ‰ã•ã‚Œã¾ã™ï¼š"}),T.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[T.jsx("li",{children:"ç›´è¿‘ã®ç·´ç¿’è² è·ï¼ˆsRPE / ACWRï¼‰"}),T.jsx("li",{children:"æœ€è¿‘ã®ä½“é‡ãƒ»ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),T.jsx("li",{children:"ç¾åœ¨å‡ºã¦ã„ã‚‹ã‚¢ãƒ©ãƒ¼ãƒˆ"})]}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€»è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿è‡ªä½“ã¯ä¿å­˜ã›ãšã€å…±æœ‰ãƒ­ã‚°ã®ã¿æ®‹ã—ã¾ã™ã€‚"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),T.jsx("textarea",{value:n,onChange:e=>l(e.target.value),rows:3,className:"w-full rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 text-gray-900 dark:text-white px-3 py-2 text-sm placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/60",placeholder:"ä¾‹ï¼šè†ã«é•å’Œæ„Ÿã€ç¡çœ ãŒæµ…ã„ã€ä»Šæ—¥ã¯ã‚„ã‚Šåˆ‡ã‚Œãªã„æ„Ÿã˜ ãªã©"})]}),T.jsxs("button",{type:"button",onClick:()=>o(e=>!e),className:["w-full text-left rounded-xl border px-3 py-3 transition","flex items-start gap-3",i?"border-blue-500/60 bg-blue-50 dark:bg-blue-500/10":"border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10"].join(" "),"aria-pressed":i,children:[T.jsx("span",{className:["mt-0.5 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 transition",i?"bg-blue-600 border-blue-600":"bg-transparent border-gray-400/60 dark:border-gray-300/40"].join(" "),children:i&&T.jsx(Te,{className:"w-4 h-4 text-white"})}),T.jsxs("div",{className:"min-w-0",children:[T.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["å…±æœ‰ã™ã‚‹å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ãŸ"," ",T.jsx("span",{className:"text-xs text-amber-700 dark:text-amber-300",children:"ï¼ˆå¿…é ˆï¼‰"})]}),!i&&T.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:"ã“ã“ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ç¢ºèªã™ã‚‹ã¨ã€Œå…±æœ‰ã™ã‚‹ã€ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™"})]})]}),!i&&!u&&T.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-700 dark:text-amber-300",children:[T.jsx(fe,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),T.jsx("div",{children:"å…±æœ‰ã™ã‚‹ã«ã¯ã€Œå…±æœ‰å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ãŸï¼ˆå¿…é ˆï¼‰ã€ã‚’ONã«ã—ã¦ãã ã•ã„"})]}),T.jsx("button",{type:"button",onClick:async()=>{if(m){c(!0);try{const{error:t}=await z.from("shared_reports").insert({user_id:e,note:n.trim()?n.trim():null});if(t)throw t;x(!0),setTimeout(()=>{a(!1),x(!1),l(""),o(!1)},900)}catch(t){console.error("[ShareStatusButton] insert failed:",t),alert("å…±æœ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚é€šä¿¡çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")}finally{c(!1)}}},disabled:!m,className:["w-full rounded-xl px-4 py-3 font-semibold transition-colors",m?"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800":"bg-gray-200 text-gray-500 dark:bg-white/10 dark:text-white/40 cursor-not-allowed"].join(" "),children:u?"å…±æœ‰ã—ã¾ã—ãŸ":d?"é€ä¿¡ä¸­...":"å…±æœ‰ã™ã‚‹"}),u&&T.jsx("div",{className:"text-center text-sm text-gray-700 dark:text-gray-200",children:"ã‚¹ã‚¿ãƒƒãƒ•ã«å…±æœ‰ã—ã¾ã—ãŸã€‚çŠ¶æ…‹ã‚’ä¼ãˆã‚‹ã“ã¨ã¯ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’å®ˆã‚‹è¡Œå‹•ã§ã™ã€‚"})]})]})]})]})}function js(e){return"string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)}function ws(e){if(!js(e))return null;const t=new Date(e).getTime();return Number.isFinite(t)?t:null}function Ns(e){let t=null,r=-1/0;for(const s of e){const e=ws(null==s?void 0:s.date);null!==e&&((!t||e>r)&&(t=s,r=e))}return t}function ks(e){const{daysWithData:t,consecutiveDays:r,weeklyAverage:s}=e;return T.jsxs("div",{className:"mb-3 rounded-lg bg-gray-50 dark:bg-gray-700/40 px-3 py-2 text-xs text-gray-600 dark:text-gray-300",children:["è¨˜éŒ²æ—¥æ•°: ",T.jsx("span",{className:"font-semibold",children:t})," ï¼ é€£ç¶š: ",T.jsx("span",{className:"font-semibold",children:r}),s&&T.jsxs(T.Fragment,{children:[" ","ï¼ 7æ—¥å¹³å‡RPE:"," ",T.jsx("span",{className:"font-semibold",children:s.rpe.toFixed(1)})," ","å¹³å‡æ™‚é–“:"," ",T.jsxs("span",{className:"font-semibold",children:[s.duration.toFixed(0),"åˆ†"]})]})]})}function _s(e){return"string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)}function Ss(e){if(_s(e))return e;if(e instanceof Date&&!isNaN(e.getTime()))return e.toISOString().slice(0,10);if("string"==typeof e){const t=e.match(/^(\d{4}-\d{2}-\d{2})/);if((null==t?void 0:t[1])&&_s(t[1]))return t[1]}return null}function Cs(e){if(null==e||""===e)return null;const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null}function Es(e){const t=Cs(e);return null===t?null:Math.round(t)}const Ds=(e,t,r)=>Math.min(r,Math.max(t,e));function Ms(e,t={}){const r=function(e){if(!e)return null;const t=Ss(e.date);if(!t)return null;const r=Cs(e.motivation_level??e.motivation);return{id:"string"==typeof e.id?e.id:void 0,date:t,motivation_level:r,energy_level:Cs(e.energy_level),stress_level:Cs(e.stress_level),notes:e.notes??null}}(e);if(!r)return null;const s=Ds(r.motivation_level??t.motivation??5,1,10),a=Ds(r.energy_level??t.energy??5,1,10),n=Ds(r.stress_level??t.stress??5,1,10);return{date:r.date,motivation_level:s,energy_level:a,stress_level:n,notes:r.notes??null}}function Ts({lastTrainingRecord:e,lastWeightRecord:t,lastSleepRecord:r,lastMotivationRecord:s}){const a=e?function(e){if(!e)return null;const t=Ss(e.date);return t?{id:"string"==typeof e.id?e.id:void 0,date:t,rpe:Cs(e.rpe),duration_min:Es(e.duration_min??e.duration_time??e.duration),arrow_score:Cs(e.arrow_score),signal_score:Cs(e.signal_score)}:null}(e):null;var n;return{normalizedLastTrainingRecord:a,normalizedLastTrainingRecordForCheckIn:a?(n=a)?{...n}:null:null,normalizedLastWeightRecord:t?function(e){if(!e)return null;const t=Ss(e.date);return t?{id:"string"==typeof e.id?e.id:void 0,date:t,weight_kg:Cs(e.weight_kg)}:null}(t):null,normalizedLastSleepRecord:r?function(e){if(!e)return null;const t=Ss(e.date);return t?{id:"string"==typeof e.id?e.id:void 0,date:t,sleep_hours:Cs(e.sleep_hours),sleep_quality:Cs(e.sleep_quality)}:null}(r):null,normalizedLastMotivationRecord:s?Ms(s):null}}function Rs(e){if(null==e)return null;const t=Number(e);return Number.isFinite(t)?t:null}function $s(e){const t=String(e||"").trim();if(!t)return 0;const r=t.includes("T")?t:t.replace(/\//g,"-"),s=new Date(r+(r.includes("T")?"":"T00:00:00")).getTime();return Number.isFinite(s)?s:0}function As(e){const[t,s]=r.useState([]),[a,n]=r.useState(!1),[l,i]=r.useState(null),o=r.useMemo(()=>0===t.length?null:t.reduce((e,t)=>e?$s(t.measured_at)>$s(e.measured_at)?t:e:t,null),[t]);return r.useEffect(()=>{if(!e)return;let t=!1;return(async()=>{n(!0),i(null);try{const{data:r,error:a}=await z.from("inbody_records").select("id, measured_at, height, weight, body_fat_percent, user_id").eq("user_id",e).order("measured_at",{ascending:!0});if(a)throw a;if(t)return;const n=(r??[]).map(e=>{const t=Rs(e.height),r=Rs(e.weight),s=Rs(e.body_fat_percent),a=function(e,t){if(null==e||null==t)return null;const r=e*(t/100);return Number.isFinite(r)?r:null}(r,s),n=function(e,t){if(null==e||null==t)return null;const r=e-t;return Number.isFinite(r)?r:null}(r,a);return{id:e.id,measured_at:String(e.measured_at),height:t,weight:r,body_fat_percent:s,fat_mass:a,fat_free_mass:n}});s(n)}catch(r){console.error("[useInbodyData]",r),i((null==r?void 0:r.message)??"InBodyãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),s([])}finally{t||n(!1)}})(),()=>{t=!0}},[e]),{records:t,latest:o,loading:a,error:l}}function Is(e){const t=new Date(e+"T00:00:00");return Number.isNaN(t.getTime())?e:t.toLocaleDateString("ja-JP")}function zs({latest:e,loading:t,error:r}){return T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"InBodyï¼ˆæœ€æ–°ï¼‰"}),T.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[T.jsx(De,{className:"w-4 h-4 mr-1"}),(null==e?void 0:e.measured_at)?Is(e.measured_at):"â€”"]})]}),t?T.jsx("div",{className:"animate-pulse h-20 bg-gray-100 dark:bg-gray-700 rounded-lg"}):r?T.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:r}):e?T.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[T.jsx(Mt,{className:"w-4 h-4 mr-1"})," ä½“é‡"]}),T.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.weight?`${e.weight.toFixed(1)} kg`:"â€”"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[T.jsx(Ke,{className:"w-4 h-4 mr-1"})," é™¤è„‚è‚ªé‡"]}),T.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.fat_free_mass?`${e.fat_free_mass.toFixed(1)} kg`:"â€”"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[T.jsx(Ve,{className:"w-4 h-4 mr-1"})," ä½“è„‚è‚ªé‡"]}),T.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.fat_mass?`${e.fat_mass.toFixed(1)} kg`:"â€”"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[T.jsx(wt,{className:"w-4 h-4 mr-1"})," ä½“è„‚è‚ªç‡"]}),T.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.body_fat_percent?`${e.body_fat_percent.toFixed(1)} %`:"â€”"})]})]}):T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"InBodyãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ï¼ˆCSVå–ã‚Šè¾¼ã¿å¾Œã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"})]})}function Ps(e){const t=String(e||"").trim();if(!t)return"";const r=t.includes("T")?t:t.replace(/\//g,"-"),s=new Date(r+(r.includes("T")?"":"T00:00:00"));return Number.isNaN(s.getTime())?t:s.toLocaleDateString("ja-JP")}function Ls(e){if(null==e)return null;const t=Number(e);return!Number.isFinite(t)||t<=0?null:t/100}function qs(e){if(null==e)return null;const t=Math.round(100*e)/100;return Number.isFinite(t)?t:null}function Fs(e){if(null==e)return null;const t=Math.round(10*e)/10;return Number.isFinite(t)?t:null}const Os={general:{male:{bmi:{low:18.5,high:25},pbf:{low:12,high:20}},female:{bmi:{low:18.5,high:25},pbf:{low:20,high:30}}},athlete:{male:{bmi:{low:20,high:27},pbf:{low:8,high:15}},female:{bmi:{low:18,high:25},pbf:{low:18,high:25}}}};function Ws({records:e,gender:t}){const[s,x]=r.useState(!0),[b,y]=r.useState("general"),f=s&&("male"===t||"female"===t),v=r.useMemo(()=>f?Os[b][t]:null,[f,b,t]),j=r.useMemo(()=>{var t;const r=[...e??[]].sort((e,t)=>e.measured_at>t.measured_at?1:-1);for(let e=r.length-1;e>=0;e--){const s=null==(t=r[e])?void 0:t.height;if(null!=s&&Number.isFinite(s))return s}return null},[e]),w=r.useMemo(()=>[...e??[]].sort((e,t)=>e.measured_at>t.measured_at?1:-1).map(e=>{const t=e.height??j,r=e.weight??null,s=e.fat_free_mass??null,a=e.body_fat_percent??null,n=qs(function(e,t){const r=Ls(t);if(null==e||null==r)return null;const s=e/(r*r);return Number.isFinite(s)?s:null}(s,t));return{date:e.measured_at,dateLabel:Ps(e.measured_at),weight:Fs(r),fat_free_mass:Fs(s),body_fat_percent:Fs(a),ffmi:n}}),[e,j]),N=r.useMemo(()=>[...e??[]].sort((e,t)=>e.measured_at>t.measured_at?1:-1).map((e,t)=>{const r=e.height??j,s=e.body_fat_percent??null,a=function(e,t){const r=Ls(t);if(null==e||null==r)return null;const s=e/(r*r);return Number.isFinite(s)?s:null}(e.weight??null,r);return{idx:t,date:e.measured_at,dateLabel:Ps(e.measured_at),pbf:Fs(s),bmi:qs(a)}}).filter(e=>null!=e.pbf&&null!=e.bmi),[e,j]),k=w.some(e=>null!=e.weight||null!=e.fat_free_mass||null!=e.body_fat_percent||null!=e.ffmi);return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[T.jsx("div",{className:"flex items-start justify-between mb-4 gap-3",children:T.jsxs("div",{children:[T.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"InBody æ¨ç§»ï¼ˆå·¦å³2è»¸ï¼‰"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å·¦ï¼šä½“é‡ / é™¤è„‚è‚ªé‡ã€€å³ï¼šä½“è„‚è‚ªç‡ / FFMIï¼ˆå³è»¸ã®æœ€å°ã¯0ï¼‰"})]})}),k?T.jsx("div",{className:"h-72 sm:h-80",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:w,children:[T.jsx(l,{strokeDasharray:"3 3"}),T.jsx(i,{dataKey:"dateLabel",tick:{fontSize:12}}),T.jsx(o,{yAxisId:"left",tick:{fontSize:12},width:52,domain:["auto","auto"]}),T.jsx(o,{yAxisId:"right",orientation:"right",tick:{fontSize:12},width:52,domain:[0,"auto"]}),T.jsx(d,{formatter:(e,t)=>{const r="number"==typeof e?e:null;return null==r?["â€”",t]:"weight"===t?[`${r.toFixed(1)} kg`,"ä½“é‡"]:"fat_free_mass"===t?[`${r.toFixed(1)} kg`,"é™¤è„‚è‚ªé‡"]:"body_fat_percent"===t?[`${r.toFixed(1)} %`,"ä½“è„‚è‚ªç‡"]:"ffmi"===t?[`${r.toFixed(2)}`,"FFMI"]:[String(e),t]},labelFormatter:e=>`æ¸¬å®šæ—¥ï¼š${e}`}),T.jsx(m,{}),T.jsx(u,{type:"monotone",dataKey:"weight",name:"ä½“é‡",yAxisId:"left",dot:{r:2},connectNulls:!0}),T.jsx(u,{type:"monotone",dataKey:"fat_free_mass",name:"é™¤è„‚è‚ªé‡",yAxisId:"left",dot:{r:2},connectNulls:!0}),T.jsx(u,{type:"monotone",dataKey:"body_fat_percent",name:"ä½“è„‚è‚ªç‡",yAxisId:"right",dot:{r:2},connectNulls:!0}),T.jsx(u,{type:"monotone",dataKey:"ffmi",name:"FFMI",yAxisId:"right",dot:{r:2},connectNulls:!0})]})})}):T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"è¡¨ç¤ºã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆä½“é‡/ä½“è„‚è‚ªç‡/èº«é•·ãŒå¿…è¦ã§ã™ï¼‰"})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-start justify-between mb-4 gap-3",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆBMI Ã— ä½“è„‚è‚ªç‡ï¼‰"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"æ¨ªï¼šä½“è„‚è‚ªç‡ï¼ˆ%ï¼‰ã€€ç¸¦ï¼šBMI"})]}),T.jsxs("div",{className:"flex flex-col items-end gap-2",children:[T.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[T.jsx("input",{type:"checkbox",className:"rounded",checked:s,onChange:e=>x(e.target.checked)}),"å¸¯ã‚’è¡¨ç¤º"]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"åŸºæº–"}),T.jsxs("select",{className:"text-xs px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100",value:b,onChange:e=>y(e.target.value),disabled:!f,children:[T.jsx("option",{value:"general",children:"ä¸€èˆ¬"}),T.jsx("option",{value:"athlete",children:"ç«¶æŠ€è€…"})]})]}),"male"!==t&&"female"!==t?T.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"æ€§åˆ¥æœªè¨­å®šã®ãŸã‚å¸¯ã¯OFF"}):T.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["æ€§åˆ¥ï¼š","male"===t?"ç”·æ€§":"å¥³æ€§"]})]})]}),0===N.length?T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"æ•£å¸ƒå›³ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆä½“é‡ãƒ»èº«é•·ãƒ»ä½“è„‚è‚ªç‡ãŒå¿…è¦ã§ã™ï¼‰"}):T.jsx("div",{className:"h-72 sm:h-80",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(g,{children:[T.jsx(l,{strokeDasharray:"3 3"}),T.jsx(i,{type:"number",dataKey:"pbf",name:"ä½“è„‚è‚ªç‡",unit:"%",tick:{fontSize:12},domain:["auto","auto"]}),T.jsx(o,{type:"number",dataKey:"bmi",name:"BMI",tick:{fontSize:12},domain:["auto","auto"]}),f&&v&&T.jsx(h,{x1:v.pbf.low,x2:v.pbf.high,y1:v.bmi.low,y2:v.bmi.high,fill:"rgba(59,130,246,0.18)",fillOpacity:1,stroke:"rgba(59,130,246,0.9)",strokeWidth:1.5,ifOverflow:"extendDomain"}),f&&v&&T.jsxs(T.Fragment,{children:[T.jsx(h,{x1:v.pbf.low,x2:v.pbf.high,y1:v.bmi.low,y2:v.bmi.high,fill:"rgba(59,130,246,0.12)",stroke:"rgba(59,130,246,0.55)",strokeWidth:1}),T.jsx(c,{x:v.pbf.low,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`PBF ${v.pbf.low}%`,position:"insideTopLeft",fontSize:11}}),T.jsx(c,{x:v.pbf.high,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`PBF ${v.pbf.high}%`,position:"insideTopRight",fontSize:11}}),T.jsx(c,{y:v.bmi.low,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`BMI ${v.bmi.low}`,position:"insideLeft",fontSize:11}}),T.jsx(c,{y:v.bmi.high,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`BMI ${v.bmi.high}`,position:"insideLeft",fontSize:11}})]}),T.jsx(d,{cursor:{strokeDasharray:"3 3"},formatter:(e,t)=>{const r="number"==typeof e?e:null;return"pbf"===t?[`${null==r?void 0:r.toFixed(1)} %`,"ä½“è„‚è‚ªç‡"]:"bmi"===t?[`${null==r?void 0:r.toFixed(2)}`,"BMI"]:[String(e),t]},labelFormatter:(e,t)=>{var r;const s=null==(r=null==t?void 0:t[0])?void 0:r.payload;return(null==s?void 0:s.dateLabel)?`æ¸¬å®šæ—¥ï¼š${s.dateLabel}`:""}}),T.jsx(p,{name:"éå»â†’æœ€æ–°",data:N})]})})})]})]})}function Bs(e){var t,r,s,a,n,l,i,o,d,c;const u="number"==typeof e.intakeCalories?e.intakeCalories:null;let x=null,m="none";const g=(null==(t=e.snapshot)?void 0:t.bmr)??null;if("number"==typeof g&&Number.isFinite(g)&&g>0)x=g,m="snapshot";else{const t=(null==(r=e.fallback)?void 0:r.leanMassKg)??null;if("number"==typeof t&&t>0)h=t,x=Math.round(370+21.6*h),m="leanMass";else{const t=(null==(s=e.fallback)?void 0:s.weightKg7dAvg)??null,r=(null==(a=e.fallback)?void 0:a.heightCm)??null,i=(null==(n=e.fallback)?void 0:n.age)??null,o=(null==(l=e.fallback)?void 0:l.gender)??null;"number"==typeof t&&t>0&&"number"==typeof r&&r>0&&"number"==typeof i&&i>0&&("male"===o||"female"===o)&&(x=function(e){const{weightKg:t,heightCm:r,age:s,gender:a}=e,n=10*t+6.25*r-5*s;return Math.round("male"===a?n+5:n-161)}({weightKg:t,heightCm:r,age:i,gender:o}),m="mifflin")}}var h;let p=null,b="none";const y=(null==(i=e.snapshot)?void 0:i.tdee)??null;if("number"==typeof y&&Number.isFinite(y)&&y>0)p=y,b="snapshot";else if(x){const t=(null==(o=e.snapshot)?void 0:o.activity_factor)??null??1.55,r=(null==(d=e.fallback)?void 0:d.todayLoad)??(null==(c=e.snapshot)?void 0:c.srpe)??0,s=function(e){return e>=600?700:e>=400?500:e>=150?300:200}(Number(r??0));p=Math.round(x*t+s),b="estimated"}const f=null!=u&&null!=p?Math.round(u-p):null;let v="unknown",j="æœªåˆ¤å®š";return null!=f&&(f<=-350?(v="low",j="ä¸è¶³æ°—å‘³"):f>=350?(v="high",j="éå¤šæ°—å‘³"):(v="ok",j="æ¦‚ã­é©æ­£")),{date:e.date,bmr:x,tdee:p,intake:u,balance:f,status:v,statusLabel:j,meta:{bmrSource:m,tdeeSource:b}}}function Us(e,t=0){const r=Number(e);return Number.isFinite(r)?r:t}function Hs(e){switch(e){case"low":return"bg-blue-600";case"ok":return"bg-emerald-600";case"high":return"bg-orange-600";default:return"bg-gray-400"}}function Vs(e){switch(e){case"low":return"text-blue-700 dark:text-blue-300";case"ok":return"text-emerald-700 dark:text-emerald-300";case"high":return"text-orange-700 dark:text-orange-300";default:return"text-gray-500 dark:text-gray-400"}}function Ks({totals:e,targets:t,loading:s=!1,subtitle:a,onOpen:n}){const l=r.useMemo(()=>{if(!t)return null;const r=Us(null==e?void 0:e.cal,0),s=Us(null==e?void 0:e.p,0),a=Us(null==e?void 0:e.f,0),n=Us(null==e?void 0:e.c,0);return[{key:"cal",label:"ã‚«ãƒ­ãƒªãƒ¼",unit:"kcal",now:Math.round(r),goal:Math.round(Us(null==t?void 0:t.cal,0))},{key:"p",label:"ãŸã‚“ã±ãè³ª",unit:"g",now:Math.round(10*s)/10,goal:Math.round(10*Us(null==t?void 0:t.p,0))/10},{key:"f",label:"è„‚è³ª",unit:"g",now:Math.round(10*a)/10,goal:Math.round(10*Us(null==t?void 0:t.f,0))/10},{key:"c",label:"ç‚­æ°´åŒ–ç‰©",unit:"g",now:Math.round(10*n)/10,goal:Math.round(10*Us(null==t?void 0:t.c,0))/10}]},[e,t]);return T.jsxs("div",{className:["bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-5 transition-colors",n?"cursor-pointer hover:shadow-md":""].join(" "),onClick:n,role:n?"button":void 0,tabIndex:n?0:-1,onKeyDown:e=>{n&&("Enter"!==e.key&&" "!==e.key||n())},children:[T.jsx("div",{className:"flex items-start justify-between gap-3",children:T.jsxs("div",{children:[T.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"ä»Šæ—¥ã®æ „é¤Šé€²æ—"}),a&&T.jsx("p",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:a})]})}),s?T.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"èª­ã¿è¾¼ã¿ä¸­â€¦"}):l?T.jsx("div",{className:"mt-4 space-y-3",children:l.map(e=>{const t=function(e,t){if(!Number.isFinite(t)||t<=0)return"na";const r=e/t;return r<.7?"low":r<=1.1?"ok":"high"}(e.now,e.goal),r=function(e,t){if(!Number.isFinite(t)||t<=0)return 0;const r=e/t*100;return Math.min(100,Math.max(0,r))}(e.now,e.goal);return T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-baseline justify-between",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-200",children:e.label}),T.jsxs("span",{className:`text-[11px] ${Vs(t)}`,children:[Math.round(r),"%"]})]}),T.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[e.now,"/",e.goal," ",e.unit]})]}),T.jsx("div",{className:"mt-1.5 h-2.5 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:T.jsx("div",{className:`h-full ${Hs(t)}`,style:{width:`${r}%`}})})]},e.key)})}):T.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"ç›®æ¨™å€¤ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ä½“é‡ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™"}),n&&T.jsx("div",{className:"mt-3 text-[11px] text-gray-500 dark:text-gray-400",children:"ã‚¿ãƒƒãƒ—ã§è©³ç´°ã‚’è¦‹ã‚‹"})]})}function Js(e,t,r){return"number"==typeof e&&Number.isFinite(e)?Math.min(Math.max(e,t),r):t}function Ys(e){return Math.round(10*e)/10}function Gs(e){return Math.round(e)}function Zs(e,t=0){return"number"==typeof e&&Number.isFinite(e)?e:t}function Xs({weightKg:e,bodyFatPercent:t,ffmKg:r,heightCm:s,age:a,sex:n,activityLevel:l="moderate",goalType:i="maintain",targetCaloriesOverride:o=null,proteinPerKg:d=null,proteinPerFFM:c=null,fatPerKg:u=null,minFatG:x=40,minCarbG:m=0,deficitKcal:g=0,surplusKcal:h=0,minCaloriesByBMRRatio:p=1.05,maxCalories:b=6e3}){const y=Zs(e,NaN);if(!Number.isFinite(y)||y<=0)throw new Error("weightKg is required");const f=[];Number.isFinite(t)||f.push("bodyFatPercent"),Number.isFinite(r)||f.push("ffmKg"),Number.isFinite(s)||f.push("heightCm"),Number.isFinite(a)||f.push("age"),n||f.push("sex");const v=Number.isFinite(r)?Ys(r):function(e,t){const r=Zs(e,0),s=Zs(t,NaN);if(!Number.isFinite(s))return null;const a=r*(1-s/100);return a>0?Ys(a):null}(y,t),j=v?function(e){const t=Zs(e,NaN);if(!Number.isFinite(t))return null;const r=370+21.6*t;return r>0?Gs(r):null}(v):null,w=function({weightKg:e,heightCm:t,age:r,sex:s}){const a=Zs(e,NaN),n=Zs(t,NaN),l=Zs(r,NaN);if(![a,n,l].every(Number.isFinite))return null;const i=10*a+6.25*n-5*l,o=(s||"").toLowerCase(),d=i+("male"===o?5:"female"===o?-161:-78);return d>0?Gs(d):null}({weightKg:y,heightCm:s,age:a,sex:n}),N=j??w??null,k=j?"katch":w?"mifflin":"none",_=N?function(e,t){const r=Zs(e,NaN);if(!Number.isFinite(r))return null;const s=r*function(e){switch((e||"").toLowerCase()){case"sedentary":case"low":return 1.2;case"light":return 1.375;case"moderate":default:return 1.55;case"high":return 1.725;case"athlete":case"very_high":return 1.9}}(t);return s>0?Gs(s):null}(N,l):null,S=_?"bmr_x_activity":"none";let C=null;if(Number.isFinite(o))C=Gs(o);else if(_)C=Gs("loss_maintain_muscle"===i?_-(g||300):"gain"===i?_+(h||200):_);else{const e=function(e,t="moderate"){const r=Zs(e,NaN);if(!Number.isFinite(r)||r<=0)return null;const s=(t||"").toLowerCase();return Gs(r*("sedentary"===s||"low"===s?28:"light"===s?30:"moderate"===s?33:"high"===s?36:"athlete"===s||"very_high"===s?40:33))}(y,l);C=Gs(e??33*y)}let E=C;if(N){E=Js(E,Gs(N*Zs(p,1.05)),b)}else E=Js(E,800,b);const D="loss_maintain_muscle"===i?2:"gain"===i?1.8:1.6,M=Number.isFinite(c)&&v?Gs(v*c):Number.isFinite(d)?Gs(y*d):Gs(v&&"loss_maintain_muscle"===i?2.4*v:y*D),T="loss_maintain_muscle"===i?.8:"gain"===i?1:.9,R=Js(Gs(y*(Number.isFinite(u)?u:T)),x,200),$=4*M+9*R,A=E-$;let I=Math.max(0,Gs(A/4));const z=Math.max(0,Gs(Zs(m,0)));let P=E,L=null;z>0&&I<z&&(I=z,P=Gs($+4*I),L="minCarbG_applied");const q=(()=>{const e=!!v,t=[s,a].every(Number.isFinite)&&!!n;return e||t?"high":l?"mid":"low"})();return{ffmKg:v,bmrKcal:N,tdeeKcal:_,activityLevel:l,goalType:i,meta:{bmrMethod:k,tdeeMethod:S,confidence:q,missing:f,targetCalRaw:C,targetCalAdjusted:P,adjustedReason:L},target:{cal:P,p:M,f:R,c:I}}}function Qs({today:e,target:t}){const r=e||{cal:0,p:0,f:0,c:0},s=t||{cal:0,p:0,f:0,c:0};return{cal:Gs(Zs(s.cal,0)-Zs(r.cal,0)),p:Ys(Zs(s.p,0)-Zs(r.p,0)),f:Ys(Zs(s.f,0)-Zs(r.f,0)),c:Ys(Zs(s.c,0)-Zs(r.c,0))}}const ea=1e4;function ta(e){return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}function ra(){return new Date((new Date).getTime()+324e5).toISOString().slice(0,10)}function sa(e){switch(e){case"good":return"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200";case"fatigue":return"bg-amber-50 text-amber-700 ring-1 ring-amber-200";case"danger":case"stop":return"bg-rose-50 text-rose-700 ring-1 ring-rose-200";default:return"bg-slate-50 text-slate-600 ring-1 ring-slate-200"}}function aa({userId:e,onBackHome:t}){const[s,a]=r.useState("standby"),n=r.useRef(!1),[l,i]=r.useState(!1),[o,d]=r.useState(ea),[c,u]=r.useState(0),[x,m]=r.useState(0),[g,h]=r.useState(0),[p,b]=r.useState([]),[y,f]=r.useState("calibrating"),[v,j]=r.useState(""),[w,N]=r.useState(!1),[k,_]=r.useState(!1),[S,C]=r.useState(""),E=r.useRef(0),D=r.useRef([]),M=r.useRef(null),R=r.useRef(null),$=r.useRef(null),A=r.useRef(null),I=r.useMemo(()=>{return e=1-o/ea,t=0,r=1,Math.max(t,Math.min(r,e));var e,t,r},[o]);function P(){M.current&&(window.clearInterval(M.current),M.current=null)}function L(){P(),i(!1),n.current=!1,d(ea),u(0),D.current=[],E.current=0,$.current=null,N(!1),_(!1),C("")}r.useEffect(()=>()=>{n.current=!1,P()},[]);const q="standby"===s?"10ç§’ã‚¿ãƒƒãƒ—ã§ã€è„³ã®ã‚­ãƒ¬ã¨å®‰å®šæ€§ã‚’ãƒã‚§ãƒƒã‚¯":"measure"===s?"ã§ãã‚‹ã ã‘é€Ÿãã€ä¸€å®šã®ãƒªã‚ºãƒ ã§":"çµæœã‚’ç¢ºèªã—ã¦ã€å¿…è¦ãªã‚‰ä¿å­˜",F=Bt;return T.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900",children:T.jsxs("div",{className:"mx-auto max-w-md px-4 py-8",children:[T.jsx("div",{className:"mb-6",children:T.jsxs("div",{className:"flex items-center justify-between gap-3",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center",children:T.jsx(F,{className:"h-5 w-5 text-slate-700"})}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xl font-extrabold tracking-tight",children:"FTT Check"}),T.jsx("div",{className:"text-sm text-slate-500",children:q})]})]}),t&&T.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:[T.jsx(ve,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"æˆ»ã‚‹"})]})]})}),T.jsxs("div",{className:"rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden",children:[T.jsxs("div",{className:"px-5 py-4 border-b border-slate-100 flex items-center justify-between",children:[T.jsxs("div",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[T.jsx(Bt,{className:"h-4 w-4"}),"standby"===s?"Standby":"measure"===s?"Measuring":"Result"]}),T.jsx("div",{className:"text-xs text-slate-400",children:"Bekuta"})]}),T.jsxs("div",{className:"p-5",children:["standby"===s&&T.jsxs("div",{className:"space-y-4",children:[T.jsx("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:T.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[T.jsxs("li",{className:"flex items-start gap-2",children:[T.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"1"}),T.jsx("span",{children:"ã‚¹ãƒãƒ›ã‚’æœºã«ç½®ã„ã¦å›ºå®š"})]}),T.jsxs("li",{className:"flex items-start gap-2",children:[T.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"2"}),T.jsx("span",{children:"åˆ©ãæ‰‹ã®äººå·®ã—æŒ‡ 1æœ¬ã§ã‚¿ãƒƒãƒ—"})]}),T.jsxs("li",{className:"flex items-start gap-2",children:[T.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"3"}),T.jsx("span",{children:"10ç§’é–“ã€é€Ÿããƒ»ä¸€å®šã®ãƒªã‚ºãƒ ã§"})]})]})}),T.jsx("button",{onClick:function(){L(),a("measure"),i(!0),n.current=!0,E.current=performance.now(),M.current=window.setInterval(()=>{if(!n.current)return;const t=performance.now()-E.current,r=Math.max(0,ea-t);d(r),r<=0&&(P(),async function(){a("result"),i(!1),n.current=!1,P();const t=D.current,r=t.length,s=[];for(let e=1;e<t.length;e++)s.push(t[e]-t[e-1]);const l=function(e){if(e.length<=1)return 0;const t=ta(e),r=e.reduce((e,r)=>e+(r-t)*(r-t),0)/e.length;return Math.sqrt(r)}(s);m(r),h(l),b(s);const o=await async function(t,r){const s=5,a=30,n=.9,l=.25;if(!e)return{condition:"calibrating",message:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚"};const i=await async function(t){const{minSamples:r,windowDays:s}=t;if(!e)return{ok:!1,reason:"no_user",sampleCount:0};const a=ra(),n=`${e}:${a}`,l=A.current;if(l&&l.key===n&&l.windowDays===s&&l.minSamples===r)return l.sampleCount<r?{ok:!1,reason:"not_enough_samples",sampleCount:l.sampleCount}:{ok:!0,baselineSpeed:l.baselineSpeed,baselineSD:l.baselineSD,sampleCount:l.sampleCount};const i=function(e){const t=new Date((new Date).getTime()+324e5),r=new Date(t);return r.setDate(r.getDate()-e),r.toISOString().slice(0,10)}(s),{data:o,error:d}=await z.from("ftt_records").select("date,total_count,interval_sd_ms,measured_at").eq("user_id",e).gte("date",i).order("measured_at",{ascending:!1}).limit(200);if(d)return A.current={key:n,windowDays:s,minSamples:r,sampleCount:0,baselineSpeed:0,baselineSD:0,fetchedAt:Date.now()},{ok:!1,reason:"fetch_error",sampleCount:0};const c=(o??[]).filter(e=>{const t=Number(null==e?void 0:e.total_count),r=Number(null==e?void 0:e.interval_sd_ms);return Number.isFinite(t)&&t>0&&Number.isFinite(r)&&r>=0}),u=c.length;if(u<r)return A.current={key:n,windowDays:s,minSamples:r,sampleCount:u,baselineSpeed:0,baselineSD:0,fetchedAt:Date.now()},{ok:!1,reason:"not_enough_samples",sampleCount:u};const x=ta(c.map(e=>Number(e.total_count))),m=ta(c.map(e=>Number(e.interval_sd_ms)));return A.current={key:n,windowDays:s,minSamples:r,sampleCount:u,baselineSpeed:x,baselineSD:m,fetchedAt:Date.now()},{ok:!0,baselineSpeed:x,baselineSD:m,sampleCount:u}}({minSamples:s,windowDays:a});if(!i.ok)return"not_enough_samples"===i.reason?{condition:"calibrating",message:"ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ï¼ˆã‚ã¨æ•°å›ã§åˆ¤å®šãŒå‡ºã¾ã™ï¼‰ã€‚"}:{condition:"calibrating",message:"ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆåˆå›ã¯åˆ¤å®šã—ã¾ã›ã‚“ï¼‰ã€‚"};const o=i.baselineSpeed,d=i.baselineSD,c=t<o*n,u=d>0&&r>d*(1+l);if(c&&u)return{condition:"stop",message:"å¿ƒèº«ã¨ã‚‚ã«é™ç•Œã§ã™ã€‚å‹‡æ°—ã‚’æŒã£ã¦ä¼‘æ¯ã‚’ã¨ã£ã¦ãã ã•ã„ã€‚"};if(u)return{condition:"danger",message:"ä½“ã¯å‹•ãã¾ã™ãŒåˆ¶å¾¡ãŒåŠ¹ã„ã¦ã„ã¾ã›ã‚“ã€‚æ€ªæˆ‘ãƒªã‚¹ã‚¯ãŒé«˜ã„çŠ¶æ…‹ã§ã™ã€‚ã‚¢ãƒƒãƒ—ã‚’å¿µå…¥ã‚Šã«ã€‚"};if(c)return{condition:"fatigue",message:"è„³ãŒå°‘ã—ãŠç–²ã‚Œãƒ¢ãƒ¼ãƒ‰ã€‚ä»Šæ—¥ã¯è³ªã®é«˜ã„ç¡çœ ã‚’å„ªå…ˆã—ã¾ã—ã‚‡ã†ã€‚"};return{condition:"good",message:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è‰¯å¥½ã€‚é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæœŸå¾…ã§ãã¾ã™ã€‚"}}(r,l);f(o.condition),j(o.message),await async function(){if(!e)return;try{const{data:t,error:r}=await z.from("ftt_events").insert({user_id:e,did_save:!1}).select("id").single();if(r)return void console.error("[FTT events insert error]",r);$.current=(null==t?void 0:t.id)??null}catch(t){console.error("[FTT events insert exception]",t)}}()}())},50)},className:"w-full rounded-2xl bg-slate-900 text-white py-3.5 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition",children:"START"}),T.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:"â€» åŸºæœ¬ã¯1æ—¥1å›ã€‚ãƒŸã‚¹ã£ãŸã‚‰RETRYã§ã‚„ã‚Šç›´ã›ã¾ã™ï¼ˆæ¸¬å®šãƒ­ã‚°ã¯æ®‹ã‚Šã¾ã™ï¼‰ã€‚"})]}),"measure"===s&&T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-end justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Remaining"}),T.jsx("div",{className:"text-4xl font-extrabold tracking-tight tabular-nums",children:(o/1e3).toFixed(2)})]}),T.jsxs("div",{className:"text-sm text-slate-600 font-semibold flex items-center gap-2",children:[T.jsx(rt,{className:"h-4 w-4"}),"TAPS ",T.jsx("span",{className:"font-extrabold tabular-nums",children:c})]})]}),T.jsx("div",{className:"h-2 w-full rounded-full bg-slate-100 overflow-hidden ring-1 ring-slate-200",children:T.jsx("div",{className:"h-full rounded-full bg-blue-500",style:{width:100*I+"%",transition:"width 50ms linear"}})}),T.jsxs("div",{ref:R,onPointerDown:function(e){if(!n.current)return;e.cancelable&&e.preventDefault();const t=performance.now();D.current.push(t),u(D.current.length),function(e){const t=R.current;if(!t)return;const r=t.getBoundingClientRect(),s=document.createElement("div");s.style.position="absolute",s.style.borderRadius="999px",s.style.pointerEvents="none",s.style.width="54px",s.style.height="54px",s.style.left=e.clientX-r.left-27+"px",s.style.top=e.clientY-r.top-27+"px",s.style.background="rgba(59,130,246,.20)",s.style.transform="scale(0)",s.style.transition="transform 420ms ease, opacity 420ms ease",t.appendChild(s),requestAnimationFrame(()=>{s.style.transform="scale(5)",s.style.opacity="0"}),setTimeout(()=>s.remove(),450)}(e)},className:"relative h-72 rounded-3xl bg-gradient-to-b from-slate-50 to-white ring-1 ring-slate-200 shadow-sm overflow-hidden select-none",style:{touchAction:"manipulation",WebkitUserSelect:"none",WebkitTouchCallout:"none"},children:[T.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[T.jsx("div",{className:"absolute -top-12 -right-12 h-40 w-40 rounded-full bg-blue-100/50 blur-2xl"}),T.jsx("div",{className:"absolute -bottom-16 -left-16 h-44 w-44 rounded-full bg-emerald-100/40 blur-2xl"})]}),T.jsxs("div",{className:"h-full flex flex-col items-center justify-center gap-3 select-none",children:[T.jsxs("div",{className:"relative h-24 w-24 flex items-center justify-center",children:[T.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/40 animate-ftt-ripple"}),T.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/30 animate-ftt-ripple delay-300"}),T.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/20 animate-ftt-ripple delay-600"}),T.jsx("span",{className:"relative z-10 h-3 w-3 rounded-full bg-slate-800 shadow-[0_0_0_6px_rgba(15,23,42,0.08)]"})]}),T.jsx("div",{className:"text-sm font-extrabold tracking-widest text-slate-800",children:"TAP FAST"}),T.jsx("div",{className:"text-xs text-slate-500",children:"äººå·®ã—æŒ‡1æœ¬ã§"})]})]}),T.jsxs("button",{onClick:()=>{L(),a("standby")},className:"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2",children:[T.jsx(Ct,{className:"h-4 w-4"}),"CANCEL"]})]}),"result"===s&&T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[T.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:[T.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Speed (Total)"}),T.jsx("div",{className:"mt-1 text-3xl font-extrabold tabular-nums",children:x})]}),T.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:[T.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Stability (SD)"}),T.jsxs("div",{className:"mt-1 text-3xl font-extrabold tabular-nums",children:[g.toFixed(1),T.jsx("span",{className:"text-sm font-bold text-slate-500 ml-1",children:"ms"})]})]})]}),(()=>{const e=function(e){switch(e){case"good":return{title:"GOOD",sub:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è‰¯å¥½",icon:Lt};case"fatigue":return{title:"FATIGUE",sub:"å°‘ã—ãŠç–²ã‚Œãƒ¢ãƒ¼ãƒ‰",icon:Bt};case"danger":return{title:"DANGER",sub:"åˆ¶å¾¡ãŒåŠ¹ãã«ãã„çŠ¶æ…‹",icon:At};case"stop":return{title:"STOP",sub:"ä¼‘æ¯ãŒå¿…è¦",icon:At};default:return{title:"CALIBRATING",sub:"åˆ¤å®šæº–å‚™ä¸­",icon:Bt}}}(y),t=e.icon;return T.jsxs("div",{className:`rounded-2xl px-4 py-3 ${sa(y)} flex items-center gap-3`,children:[T.jsx("div",{className:"h-9 w-9 rounded-xl bg-white/70 flex items-center justify-center",children:T.jsx(t,{className:"h-5 w-5"})}),T.jsxs("div",{className:"flex-1",children:[T.jsx("div",{className:"text-sm font-extrabold tracking-wide",children:e.title}),T.jsx("div",{className:"text-xs opacity-80",children:e.sub})]}),T.jsxs("div",{className:"text-xs font-bold opacity-80 tabular-nums",children:["intervals: ",p.length]})]})})(),T.jsx("div",{className:"text-sm text-slate-700 leading-relaxed",children:v}),T.jsxs("button",{disabled:k||w,onClick:async function(){if(k||w)return;if(!e)return void C("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");_(!0),C("é€ä¿¡ã‚­ãƒ¥ãƒ¼å¾…æ©Ÿä¸­â€¦ï¼ˆè² è·åˆ†æ•£ï¼‰");const t=Math.floor(5e3*Math.random());var r;await(r=t,new Promise(e=>setTimeout(e,r)));try{C("ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ä¸­â€¦");const t=ra(),{error:r}=await z.from("ftt_records").upsert({user_id:e,date:t,duration_sec:Math.round(10),total_count:x,interval_sd_ms:g,raw_intervals_ms:p,condition_result:y,meta:{ua:"undefined"!=typeof navigator?navigator.userAgent:null,tz:Intl.DateTimeFormat().resolvedOptions().timeZone,source:"ftt_check"}},{onConflict:"user_id,date"});if(r)return console.error("[FTT records upsert error]",r),C(`ä¿å­˜å¤±æ•—: ${r.message}`),void _(!1);const s=$.current;if(s){const{error:t}=await z.from("ftt_events").update({did_save:!0}).eq("id",s).eq("user_id",e);t&&console.error("[FTT events update error]",t)}N(!0),C("âœ… ä¿å­˜å®Œäº†"),_(!1)}catch(s){console.error("[FTT save exception]",s),C(`ä¿å­˜å¤±æ•—: ${(null==s?void 0:s.message)??"unknown error"}`),_(!1)}},className:["w-full rounded-2xl py-3.5 font-extrabold tracking-wide flex items-center justify-center gap-2 transition active:scale-[0.99]",w?"bg-emerald-600 text-white":k?"bg-slate-200 text-slate-600 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-500"].join(" "),children:[T.jsx(Dt,{className:"h-4 w-4"}),w?"SAVED âœ…":k?"SAVING...":"SAVE DATA"]}),T.jsx("div",{className:["min-h-[18px] text-xs text-center",w?"text-emerald-700":S.includes("å¤±æ•—")?"text-rose-700":"text-slate-500"].join(" "),children:S}),T.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:"â€» è¨ˆæ¸¬çµ‚äº†æ™‚ç‚¹ã§ã€Œæœªä¿å­˜ãƒ­ã‚°ï¼ˆftt_eventsï¼‰ã€ãŒæ®‹ã‚Šã¾ã™ã€‚ ä¿å­˜ãƒœã‚¿ãƒ³ã§ã€Œãã®æ—¥ã®æ­£å¼ãƒ‡ãƒ¼ã‚¿ï¼ˆftt_recordsï¼‰ã€ã¨ã—ã¦æ¡ç”¨ã•ã‚Œã¾ã™ã€‚"}),T.jsxs("button",{onClick:()=>{L(),a("standby")},className:"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2",children:[T.jsx(Ct,{className:"h-4 w-4"}),"RETRY"]})]})]})]}),T.jsx("div",{className:"mt-6 text-center text-xs text-slate-400",children:"â€œfast & steadyâ€ ãŒã‚³ãƒ„ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰ã ã‘ã§ãªãå®‰å®šæ€§ã‚‚è¦‹ã¾ã™ã€‚"})]})})}const na=r.lazy(()=>A(()=>import("./GamificationView-B4thg2QI.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.GamificationView})));function la({user:e}){return T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center h-64",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:T.jsx(na,{userId:e.id,userTeamId:e.team_id})})}const ia=[{value:"cramps",label:"ç”Ÿç†ç—›",icon:nr},{value:"mood_changes",label:"æ°—åˆ†ã®å¤‰åŒ–",icon:We},{value:"fatigue",label:"ç–²åŠ´æ„Ÿ",icon:_e},{value:"headache",label:"é ­ç—›",icon:Ce},{value:"bloating",label:"è†¨æº€æ„Ÿ",icon:sr},{value:"breast_tenderness",label:"èƒ¸ã®å¼µã‚Š",icon:st},{value:"acne",label:"ãƒ‹ã‚­ãƒ“",icon:Lt},{value:"back_pain",label:"è…°ç—›",icon:Ot}];function oa({userId:e,onSuccess:t}){const{addCycle:s}=Zr(e),[a,n]=r.useState(!1),[l,i]=r.useState(null),[o,d]=r.useState(!1),[c,u]=r.useState("success"),[x,m]=r.useState(""),g=(e,t)=>{u(e),m(t),d(!0)},[h,p]=r.useState({cycle_start_date:"",period_end_date:"",flow_intensity:"",symptoms:[],notes:""}),b=(e,t)=>{const r=new Date(e),s=new Date(t);return Math.floor((s.getTime()-r.getTime())/864e5)+1},y=h.cycle_start_date&&h.period_end_date?b(h.cycle_start_date,h.period_end_date):null;return T.jsxs(T.Fragment,{children:[T.jsx(yr,{open:o,type:c,message:x,onClose:()=>d(!1)}),T.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!a){n(!0),i(null);try{if(!h.cycle_start_date)throw new Error("ç”Ÿç†é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const e={cycle_start_date:h.cycle_start_date,symptoms:h.symptoms};if(h.period_end_date){const t=b(h.cycle_start_date,h.period_end_date);if(t<=0)throw new Error("ç”Ÿç†çµ‚äº†æ—¥ã¯é–‹å§‹æ—¥ä»¥é™ã‚’é¸æŠã—ã¦ãã ã•ã„");e.period_duration_days=t}h.flow_intensity&&(e.flow_intensity=h.flow_intensity),h.notes&&(e.notes=h.notes),await s(e),p({cycle_start_date:"",period_end_date:"",flow_intensity:"",symptoms:[],notes:""}),g("success","å‘¨æœŸã‚’è¨˜éŒ²ã—ã¾ã—ãŸ âœ…"),t&&t()}catch(r){const e=r instanceof Error?r.message:"å‘¨æœŸãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ";i(e),g("error",`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e}`)}finally{n(!1)}}},className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[T.jsx(Ve,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),T.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"æœˆçµŒå‘¨æœŸã‚’è¨˜éŒ²"})]}),l&&T.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[T.jsx(ye,{className:"w-5 h-5"}),T.jsx("span",{children:l})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(De,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†é–‹å§‹æ—¥ *"]}),T.jsx("input",{type:"date",required:!0,value:h.cycle_start_date,onChange:e=>p({...h,cycle_start_date:e.target.value}),disabled:a,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(De,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†çµ‚äº†æ—¥"]}),T.jsx("input",{type:"date",value:h.period_end_date,min:h.cycle_start_date||void 0,onChange:e=>p({...h,period_end_date:e.target.value}),disabled:a,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60"}),null!=y&&T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ç”Ÿç†æœŸé–“: ",y,"æ—¥é–“"]})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"çµŒè¡€é‡"}),T.jsxs("select",{value:h.flow_intensity,onChange:e=>p({...h,flow_intensity:e.target.value}),disabled:a,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60",children:[T.jsx("option",{value:"",children:"é¸æŠ..."}),T.jsx("option",{value:"light",children:"å°‘ãªã„"}),T.jsx("option",{value:"moderate",children:"æ™®é€š"}),T.jsx("option",{value:"heavy",children:"å¤šã„"})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç—‡çŠ¶"}),T.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:ia.map(e=>{const t=e.icon,r=h.symptoms.includes(e.value);return T.jsxs("button",{type:"button",onClick:()=>(e=>{p(t=>({...t,symptoms:t.symptoms.includes(e)?t.symptoms.filter(t=>t!==e):[...t.symptoms,e]}))})(e.value),disabled:a,className:"px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 disabled:opacity-60 disabled:cursor-not-allowed "+(r?"border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-[1.02]":"border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300"),children:[T.jsx(t,{className:"w-4 h-4"}),T.jsx("span",{children:e.label})]},e.value)})})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢"}),T.jsx("textarea",{value:h.notes,onChange:e=>p({...h,notes:e.target.value}),rows:3,disabled:a,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60",placeholder:"ãã®ä»–ã®ãƒ¡ãƒ¢..."})]}),T.jsx("button",{type:"submit",disabled:a,className:"w-full py-3 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?"ä¿å­˜ä¸­...":"å‘¨æœŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜"})]})]})}function da(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{o()},[e]);const o=async()=>{try{n(!0);const{data:t,error:r}=await z.from("basal_body_temperature").select("*").eq("user_id",e).order("measurement_date",{ascending:!1});if(r)throw r;s(t||[])}catch(t){i(t instanceof Error?t.message:"Failed to fetch basal body temperature")}finally{n(!1)}};return{temperatures:t,loading:a,error:l,addTemperature:async t=>{try{const{data:r}=await z.auth.getUser();if(!r.user)throw new Error("User not authenticated");const{data:a}=await z.from("users").select("team_id").eq("user_id",r.user.id).maybeSingle();let n=null;if(null==a?void 0:a.team_id){const{data:e}=await z.from("teams").select("organization_id").eq("id",a.team_id).maybeSingle();n=(null==e?void 0:e.organization_id)||null}const{data:l,error:i}=await z.from("basal_body_temperature").insert({...t,user_id:e,organization_id:n}).select().single();if(i)throw i;return l&&s(e=>[l,...e]),l}catch(r){throw i(r instanceof Error?r.message:"Failed to add basal body temperature"),r}},updateTemperature:async(e,t)=>{try{const{data:r,error:a}=await z.from("basal_body_temperature").update(t).eq("id",e).select().single();if(a)throw a;return r&&s(t=>t.map(t=>t.id===e?r:t)),r}catch(r){throw i(r instanceof Error?r.message:"Failed to update basal body temperature"),r}},deleteTemperature:async e=>{try{const{error:t}=await z.from("basal_body_temperature").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(t){throw i(t instanceof Error?t.message:"Failed to delete basal body temperature"),t}},getTemperatureTrend:(e=7)=>{const r=t.slice(0,e).sort((e,t)=>new Date(e.measurement_date).getTime()-new Date(t.measurement_date).getTime());if(r.length<3)return"stable";const s=r.slice(0,Math.floor(r.length/2)),a=r.slice(Math.floor(r.length/2)),n=s.reduce((e,t)=>e+Number(t.temperature_celsius),0)/s.length,l=a.reduce((e,t)=>e+Number(t.temperature_celsius),0)/a.length-n;return l>.1?"rising":l<-.1?"falling":"stable"},getAverageTemperature:(e=7)=>{const r=t.slice(0,e);if(0===r.length)return null;return r.reduce((e,t)=>e+Number(t.temperature_celsius),0)/r.length},refetch:o}}function ca({userId:e,onSuccess:t}){const{addTemperature:s}=da(e),[a,n]=r.useState(!1),[l,i]=r.useState(null),o=H(),d=(new Date).toTimeString().slice(0,5),[c,u]=r.useState({measurement_date:o,temperature_celsius:"",measurement_time:d,notes:""});return T.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0),i(null);try{const e={measurement_date:c.measurement_date,temperature_celsius:parseFloat(c.temperature_celsius)};c.measurement_time&&(e.measurement_time=c.measurement_time),c.notes&&(e.notes=c.notes),await s(e),u({measurement_date:o,temperature_celsius:"",measurement_time:d,notes:""}),t&&t()}catch(r){i(r instanceof Error?r.message:"ä½“æ¸©ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}},className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[T.jsx(Wt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),T.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"åŸºç¤ä½“æ¸©ã‚’è¨˜éŒ²"})]}),l&&T.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[T.jsx(ye,{className:"w-5 h-5"}),T.jsx("span",{children:l})]}),T.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:T.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[T.jsx("strong",{children:"ãƒ’ãƒ³ãƒˆ:"})," åŸºç¤ä½“æ¸©ã¯èµ·åºŠå¾Œã™ãã€ãƒ™ãƒƒãƒ‰ã‹ã‚‰å‡ºã‚‹å‰ã‚„èº«ä½“æ´»å‹•ã‚’ã™ã‚‹å‰ã«æ¸¬å®šã—ã¦ãã ã•ã„ã€‚"]})}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(De,{className:"inline w-4 h-4 mr-1"}),"æ¸¬å®šæ—¥ *"]}),T.jsx("input",{type:"date",required:!0,value:c.measurement_date,max:o,onChange:e=>u({...c,measurement_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(Oe,{className:"inline w-4 h-4 mr-1"}),"æ¸¬å®šæ™‚åˆ»"]}),T.jsx("input",{type:"time",value:c.measurement_time,onChange:e=>u({...c,measurement_time:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[T.jsx(Wt,{className:"inline w-4 h-4 mr-1"}),"ä½“æ¸©ï¼ˆâ„ƒï¼‰ *"]}),T.jsx("input",{type:"number",step:"0.01",min:"35.0",max:"42.0",required:!0,value:c.temperature_celsius,onChange:e=>u({...c,temperature_celsius:e.target.value}),placeholder:"ä¾‹: 36.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"æ­£å¸¸ç¯„å›²: 36.1 - 37.0â„ƒ"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢"}),T.jsx("textarea",{value:c.notes,onChange:e=>u({...c,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ä½“æ¸©ã«å½±éŸ¿ã™ã‚‹è¦å› ï¼ˆä½“èª¿ä¸è‰¯ã€å¯ä¸è¶³ãªã©ï¼‰..."})]}),T.jsx("button",{type:"submit",disabled:a,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?"ä¿å­˜ä¸­...":"ä½“æ¸©ã‚’ä¿å­˜"})]})}function ua({userId:e,days:t=90}){const{cycles:r,getCurrentCyclePhase:s}=Zr(e),{temperatures:x}=da(e),g=s(),h=(()=>{const e=new Date,s=new Date(e);s.setDate(s.getDate()-t);const a=new Map;for(let t=new Date(s);t<=e;t.setDate(t.getDate()+1)){const e=Y(t);a.set(e,{date:e,displayDate:`${t.getMonth()+1}/${t.getDate()}`,temperature:null,cyclePhase:null})}return x.forEach(e=>{const t=a.get(e.measurement_date);t&&(t.temperature=Number(e.temperature_celsius))}),r.forEach(t=>{const s=new Date(t.cycle_start_date),n=t.cycle_end_date?new Date(t.cycle_end_date):e;for(let l=new Date(s);l<=n&&l<=e;l.setDate(l.getDate()+1)){const t=Y(l),s=a.get(t);if(s){r.find(t=>{const r=new Date(t.cycle_start_date+"T00:00:00"),s=t.cycle_end_date?new Date(t.cycle_end_date+"T00:00:00"):e;return l>=r&&l<=s})&&(s.cyclePhase=1)}}}),Array.from(a.values())})();return T.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx(Ve,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),T.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã¨ä½“æ¸©"})]}),g&&T.jsxs("div",{className:"text-sm",children:[T.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º: "}),T.jsx("span",{className:`font-semibold capitalize ${(e=>{switch(e){case"menstrual":return"text-red-600 dark:text-red-400";case"follicular":return"text-green-600 dark:text-green-400";case"ovulatory":return"text-yellow-600 dark:text-yellow-400";case"luteal":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}})(g.phase)}`,children:g.phase})]})]}),T.jsx(a,{width:"100%",height:400,children:T.jsxs(n,{data:h,children:[T.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),T.jsx(i,{dataKey:"displayDate",stroke:"#6B7280",style:{fontSize:"12px"}}),T.jsx(o,{yAxisId:"temp",domain:[35.5,37.5],stroke:"#3B82F6",style:{fontSize:"12px"},label:{value:"ä½“æ¸©ï¼ˆâ„ƒï¼‰",angle:-90,position:"insideLeft"}}),T.jsx(o,{yAxisId:"cycle",orientation:"right",domain:[0,1],ticks:[0,1],stroke:"#EC4899",style:{fontSize:"12px"},label:{value:"å‘¨æœŸ",angle:90,position:"insideRight"}}),T.jsx(d,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px",color:"#F3F4F6"},formatter:(e,t)=>"temperature"===t?[e?`${e.toFixed(2)}â„ƒ`:"ãƒ‡ãƒ¼ã‚¿ãªã—","ä½“æ¸©"]:"cyclePhase"===t?[e?"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–":"å‘¨æœŸãªã—","å‘¨æœŸ"]:[e,t]}),T.jsx(m,{}),T.jsx(c,{yAxisId:"temp",y:36.5,stroke:"#6B7280",strokeDasharray:"3 3"}),T.jsx(u,{yAxisId:"temp",type:"monotone",dataKey:"temperature",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",r:3},connectNulls:!0,name:"ä½“æ¸©"}),T.jsx(u,{yAxisId:"cycle",type:"stepAfter",dataKey:"cyclePhase",stroke:"#EC4899",strokeWidth:2,dot:!1,name:"æœˆçµŒå‘¨æœŸ"})]})}),T.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"æœˆçµŒæœŸ"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"åµèƒæœŸ"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"æ’åµæœŸ"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"é»„ä½“æœŸ"})]})]})]})}function xa({userId:e}){const{cycles:t,getCurrentCyclePhase:s}=Zr(e),[a,n]=r.useState(new Date),l=s(),i=new Date;i.setHours(0,0,0,0);let o=null;if(l){const e=new Date(l.cycle.cycle_start_date);e.setHours(0,0,0,0),o=Math.floor((i.getTime()-e.getTime())/864e5)+1}const d=(()=>{const e=a.getFullYear(),t=a.getMonth(),r=new Date(e,t,1),s=new Date(e,t+1,0),n=new Date(r);n.setDate(n.getDate()-r.getDay());const l=[],i=new Date(n);for(;i<=s||0!==i.getDay();)l.push(new Date(i)),i.setDate(i.getDate()+1);return l})(),c=(()=>{if(0===t.length)return null;const e=[...t].sort((e,t)=>new Date(t.cycle_start_date).getTime()-new Date(e.cycle_start_date).getTime()),r=e[0];if(!r.cycle_end_date)return null;const s=e.reduce((e,t)=>{if(!t.cycle_end_date)return e;const r=new Date(t.cycle_start_date),s=new Date(t.cycle_end_date);return e+Math.floor((s.getTime()-r.getTime())/864e5)},0)/e.filter(e=>e.cycle_end_date).length,a=new Date(r.cycle_end_date),n=new Date(a);n.setDate(n.getDate()+1);const l=new Date(n);return l.setDate(l.getDate()+Math.round(s)),{start:n,end:l}})(),u=e=>{switch(e){case"menstrual":return"bg-red-100 dark:bg-red-900/30 border-red-400 dark:border-red-600";case"follicular":return"bg-green-100 dark:bg-green-900/30 border-green-400 dark:border-green-600";case"ovulatory":return"bg-yellow-100 dark:bg-yellow-900/30 border-yellow-400 dark:border-yellow-600";case"luteal":return"bg-blue-100 dark:bg-blue-900/30 border-blue-400 dark:border-blue-600";default:return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}};return T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx(De,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),T.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("button",{onClick:()=>{n(new Date(a.getFullYear(),a.getMonth()-1))},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:T.jsx(Ie,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),T.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white min-w-[120px] text-center",children:[a.getFullYear(),"å¹´ ",a.getMonth()+1,"æœˆ"]}),T.jsx("button",{onClick:()=>{n(new Date(a.getFullYear(),a.getMonth()+1))},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:T.jsx(ze,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})]}),l&&T.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-lg border border-pink-200 dark:border-pink-800",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º"}),T.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[(e=>{switch(e){case"menstrual":return"æœˆçµŒæœŸ";case"follicular":return"åµèƒæœŸ";case"ovulatory":return"æ’åµæœŸ";case"luteal":return"é»„ä½“æœŸ";default:return""}})(l.phase)," - å‘¨æœŸ",o??"-","æ—¥ç›®"]})]}),"follicular"===l.phase||"ovulatory"===l.phase?T.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[T.jsx(Vt,{className:"w-5 h-5"}),T.jsx("span",{className:"text-sm font-medium",children:"ãƒã‚¤ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœŸ"})]}):"luteal"===l.phase||"menstrual"===l.phase?T.jsxs("div",{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:[T.jsx(fe,{className:"w-5 h-5"}),T.jsx("span",{className:"text-sm font-medium",children:"æ€ªæˆ‘ãƒªã‚¹ã‚¯æ³¨æ„"})]}):null]})}),c&&T.jsx("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:T.jsxs("div",{className:"flex items-start gap-2",children:[T.jsx(lt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5"}),T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"æ¬¡å›ã®å‘¨æœŸäºˆæ¸¬"}),T.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[c.start.getMonth()+1,"æœˆ",c.start.getDate(),"æ—¥ -"," ",c.end.getMonth()+1,"æœˆ",c.end.getDate(),"æ—¥ ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã®ç‚¹ç·šæ ã§è¡¨ç¤ºï¼‰"]})]})]})}),T.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map((e,t)=>T.jsx("div",{className:"text-center text-sm font-semibold py-2 "+(0===t?"text-red-600 dark:text-red-400":6===t?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"),children:e},e))}),T.jsx("div",{className:"grid grid-cols-7 gap-1",children:d.map((e,r)=>{const s=(e=>{for(const r of t){const t=new Date(r.cycle_start_date),s=r.cycle_end_date?new Date(r.cycle_end_date):new Date;if(e>=t&&e<=s){const r=Math.floor((e.getTime()-t.getTime())/864e5)+1;let s=null,a=!1,n=!1;return r>=1&&r<=5?(s="menstrual",n=!0):r>=6&&r<=13?(s="follicular",a=!0):r>=14&&r<=16?(s="ovulatory",a=!0):r>=17&&r<=28&&(s="luteal",n=!0),{phase:s,day:r,isHighPerformance:a,isInjuryRisk:n}}}return{phase:null,day:0,isHighPerformance:!1,isInjuryRisk:!1}})(e),n=(l=e,!!c&&l>=c.start&&l<=c.end);var l;const o=e.getTime()===i.getTime(),d=e.getMonth()===a.getMonth();return T.jsx("div",{className:`\n                relative aspect-square p-1 border rounded-lg transition-all\n                ${u(s.phase)}\n                ${n?"border-dashed border-2":"border"}\n                ${d?"":"opacity-40"}\n                ${o?"ring-2 ring-purple-500 dark:ring-purple-400":""}\n              `,children:T.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[T.jsx("span",{className:"text-sm font-medium "+(o?"text-purple-700 dark:text-purple-300 font-bold":s.phase?"text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"),children:e.getDate()}),s.phase&&T.jsxs("div",{className:"flex gap-0.5 mt-1",children:[s.isHighPerformance&&T.jsx(Vt,{className:"w-3 h-3 text-green-600 dark:text-green-400"}),s.isInjuryRisk&&T.jsx(fe,{className:"w-3 h-3 text-orange-600 dark:text-orange-400"})]}),n&&!s.phase&&T.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium mt-1",children:"äºˆæ¸¬"})]})},r)})}),T.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{className:"space-y-2",children:[T.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"å‘¨æœŸãƒ•ã‚§ãƒ¼ã‚º"}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-4 h-4 rounded bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-600"}),T.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"æœˆçµŒæœŸï¼ˆ1-5æ—¥ç›®ï¼‰"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-4 h-4 rounded bg-green-100 dark:bg-green-900/30 border border-green-400 dark:border-green-600"}),T.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"åµèƒæœŸï¼ˆ6-13æ—¥ç›®ï¼‰"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-4 h-4 rounded bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600"}),T.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"æ’åµæœŸï¼ˆ14-16æ—¥ç›®ï¼‰"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-4 h-4 rounded bg-blue-100 dark:bg-blue-900/30 border border-blue-400 dark:border-blue-600"}),T.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"é»„ä½“æœŸï¼ˆ17-28æ—¥ç›®ï¼‰"})]})]}),T.jsxs("div",{className:"space-y-2",children:[T.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¬ã‚¤ãƒ‰"}),T.jsxs("div",{className:"flex items-start gap-2 bg-green-50 dark:bg-green-900/20 p-2 rounded",children:[T.jsx(Vt,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5"}),T.jsxs("div",{className:"text-xs text-green-800 dark:text-green-200",children:[T.jsx("p",{className:"font-medium mb-1",children:"ãƒã‚¤ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœŸ"}),T.jsx("p",{children:"åµèƒæœŸãƒ»æ’åµæœŸï¼šé«˜å¼·åº¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«é©ã—ãŸæ™‚æœŸ"})]})]}),T.jsxs("div",{className:"flex items-start gap-2 bg-orange-50 dark:bg-orange-900/20 p-2 rounded",children:[T.jsx(fe,{className:"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5"}),T.jsxs("div",{className:"text-xs text-orange-800 dark:text-orange-200",children:[T.jsx("p",{className:"font-medium mb-1",children:"æ€ªæˆ‘ãƒªã‚¹ã‚¯æ³¨æ„æœŸ"}),T.jsx("p",{children:"æœˆçµŒæœŸãƒ»é»„ä½“æœŸï¼šç„¡ç†ã›ãšèª¿æ•´ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ¨å¥¨"})]})]})]})]})]})}function ma(e,t,s){const[a,n]=r.useState([]),[l,i]=r.useState([]),[o,d]=r.useState([]),[c,u]=r.useState([]),[x,m]=r.useState(!0),[g,h]=r.useState(null);r.useEffect(()=>{p()},[]),r.useEffect(()=>{b()},[t]),r.useEffect(()=>{e&&y()},[e,t]);const p=async()=>{try{const{data:e,error:t}=await z.from("performance_categories").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;n(e||[])}catch(e){console.error("Error fetching categories:",e),h("ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}},b=async()=>{try{let e=z.from("performance_test_types").select("\n          *,\n          performance_categories:category_id (\n            id,\n            name,\n            display_name\n          )\n        ").eq("is_active",!0);if(t){const{data:r}=await z.from("performance_categories").select("id").eq("name",t).single();r&&(e=e.eq("category_id",r.id))}const{data:r,error:s}=await e.order("sort_order");if(s)throw s;i(r||[])}catch(e){console.error("Error fetching test types:",e),h("æ¸¬å®šç¨®ç›®ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}},y=async()=>{try{m(!0);let r=z.from("performance_records").select("\n          *,\n          performance_test_types:test_type_id (\n            id,\n            category_id,\n            name,\n            display_name,\n            description,\n            unit,\n            higher_is_better,\n            fields,\n            sort_order,\n            is_active,\n            created_at\n          )\n      ").eq("user_id",e).order("date",{ascending:!1});if(t){const{data:e}=await z.from("performance_categories").select("id").eq("name",t).maybeSingle();if(e){const{data:t}=await z.from("performance_test_types").select("id").eq("category_id",e.id);t&&t.length>0&&(r=r.in("test_type_id",t.map(e=>e.id)))}}const{data:s,error:a}=await r;if(a)throw a;const n=(s||[]).map(e=>({...e,test_type:e.performance_test_types}));d(n),f(n)}catch(r){console.error("Error fetching records:",r),h("è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{m(!1)}},f=e=>{const t=new Map;e.forEach(e=>{if(!e.test_type)return;const r=e.values.primary_value,s="string"==typeof r?parseFloat(r):r;if(null==s||isNaN(s))return;const a=t.get(e.test_type_id);(!a||(e.test_type.higher_is_better?s>a.value:s<a.value))&&t.set(e.test_type_id,{test_type_id:e.test_type_id,test_name:e.test_type.name,test_display_name:e.test_type.display_name,value:s,date:e.date,record:e})}),u(Array.from(t.values()))},v=(e,t,r)=>{const s=c.find(t=>t.test_type_id===e);return!s||(r?t>s.value:t<s.value)},j=e=>o.filter(t=>t.test_type_id===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return{categories:a,testTypes:l,records:o,personalBests:c,loading:x,error:g,addRecord:async t=>{try{const{data:r,error:s}=await z.from("performance_records").insert([{user_id:e,...t}]).select().single();if(s)throw s;await y();const a=l.find(e=>e.id===t.test_type_id),n=t.values.primary_value;return{data:r,isNewPersonalBest:(a&&v(t.test_type_id,n,a.higher_is_better))??!1}}catch(r){throw console.error("Error adding record:",r),r}},updateRecord:async(t,r)=>{try{const{data:s,error:a}=await z.from("performance_records").update(r).eq("id",t).eq("user_id",e).select().single();if(a)throw a;return await y(),s}catch(s){throw console.error("Error updating record:",s),s}},deleteRecord:async t=>{try{const{error:r}=await z.from("performance_records").delete().eq("id",t).eq("user_id",e);if(r)throw r;await y()}catch(r){throw console.error("Error deleting record:",r),r}},checkIfPersonalBest:v,checkExistingRecord:async(t,r)=>{try{const{data:s,error:a}=await z.from("performance_records").select("\n          *,\n          performance_test_types:test_type_id (\n            id,\n            name,\n            display_name,\n            unit,\n            higher_is_better,\n            fields\n          )\n        ").eq("user_id",e).eq("test_type_id",t).eq("date",r).maybeSingle();if(a)throw a;return s?{...s,test_type:s.performance_test_types}:null}catch(s){return console.error("Error checking existing record:",s),null}},getRecordsByTestType:j,getPersonalBest:e=>c.find(t=>t.test_type_id===e),getImprovementPercentage:(e,t)=>{const r=j(e);if(r.length<2)return null;const s=r[r.length-1].values.primary_value;return s&&0!==s?(t-s)/Math.abs(s)*100:null},refresh:y}}function ga({userId:e}){const{cycles:t,getCyclePhase:r}=Zr(e),{records:s}=Hr(e),{records:n}=ma(e,"jump"),c=(()=>{const e={menstrual:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},follicular:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},ovulatory:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},luteal:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0}};return s.forEach(s=>{const a=new Date(s.date);for(const n of t){const t=r(n,a);if(t&&t in e){e[t].count++,e[t].totalLoad+=s.load,e[t].totalRPE+=s.rpe;break}}}),n.forEach(s=>{const a=new Date(s.test_date);for(const n of t){const t=r(n,a);if(t&&t in e){e[t].performances++,e[t].totalScore+=s.score;break}}}),Object.entries(e).map(([e,t])=>({phase:"menstrual"===e?"æœˆçµŒæœŸ":"follicular"===e?"åµèƒæœŸ":"ovulatory"===e?"æ’åµæœŸ":"é»„ä½“æœŸ",avgLoad:t.count>0?(t.totalLoad/t.count).toFixed(1):0,avgRPE:t.count>0?(t.totalRPE/t.count).toFixed(1):0,avgPerformance:t.performances>0?(t.totalScore/t.performances).toFixed(1):0,sessionCount:t.count}))})(),u=c.some(e=>e.sessionCount>0),x=(()=>{var e,t;if(!u)return[];const r=[],s=[...c].sort((e,t)=>Number(t.avgLoad)-Number(e.avgLoad)),a=[...c].sort((e,t)=>Number(t.avgPerformance)-Number(e.avgPerformance));(null==(e=s[0])?void 0:e.avgLoad)>0&&r.push(`${s[0].phase}ã«æœ€ã‚‚é«˜ã„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ï¼ˆå¹³å‡${s[0].avgLoad}ï¼‰`),(null==(t=a[0])?void 0:t.avgPerformance)>0&&r.push(`${a[0].phase}ã«æœ€é«˜ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹`);const n=c.find(e=>"Follicular"===e.phase),l=c.find(e=>"Luteal"===e.phase);return n&&l&&Number(n.avgRPE)<Number(l.avgRPE)&&r.push("åµèƒæœŸã¯ä¸»è¦³çš„é‹å‹•å¼·åº¦ãŒä½ã„ - ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å¼·åº¦ã‚’ä¸Šã’ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„"),r})();return T.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[T.jsx(Vt,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),T.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç›¸é–¢"})]}),u?T.jsxs(T.Fragment,{children:[T.jsx(a,{width:"100%",height:300,children:T.jsxs(b,{data:c,children:[T.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),T.jsx(i,{dataKey:"phase",stroke:"#6B7280",style:{fontSize:"12px"}}),T.jsx(o,{stroke:"#6B7280",style:{fontSize:"12px"}}),T.jsx(d,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px",color:"#F3F4F6"}}),T.jsx(m,{}),T.jsx(y,{dataKey:"avgLoad",fill:"#3B82F6",name:"å¹³å‡è² è·"}),T.jsx(y,{dataKey:"avgRPE",fill:"#EF4444",name:"å¹³å‡RPE"}),T.jsx(y,{dataKey:"avgPerformance",fill:"#10B981",name:"å¹³å‡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹"})]})}),x.length>0&&T.jsxs("div",{className:"mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[T.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"ã‚¤ãƒ³ã‚µã‚¤ãƒˆ"}),T.jsx("ul",{className:"space-y-2 text-sm text-purple-800 dark:text-purple-200",children:x.map((e,t)=>T.jsxs("li",{className:"flex items-start gap-2",children:[T.jsx("span",{className:"text-purple-500 mt-1",children:"â€¢"}),T.jsx("span",{children:e})]},t))})]}),T.jsx("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:T.jsxs("p",{children:[s.length,"å›ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¨",n.length,"å›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã«åŸºã¥ã"]})})]}):T.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[T.jsx(be,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),T.jsx("p",{children:"ç›¸é–¢ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚"}),T.jsx("p",{className:"text-sm mt-2",children:"å‘¨æœŸã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã—ç¶šã‘ã¦ãã ã•ã„ï¼"})]})]})}function ha({userId:e,gender:t}){const[s,a]=r.useState("calendar");return"female"!==t?T.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6 text-center",children:[T.jsx(Ve,{className:"w-12 h-12 text-yellow-600 dark:text-yellow-400 mx-auto mb-4"}),T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"ã“ã®æ©Ÿèƒ½ã¯å¥³æ€§ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨ã§ã™"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã§æ€§åˆ¥ã‚’ã€Œå¥³æ€§ã€ã«è¨­å®šã™ã‚‹ã¨ã€æœˆçµŒå‘¨æœŸãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚"})]}):T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[T.jsx(oa,{userId:e}),T.jsx(ca,{userId:e})]}),T.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border dark:border-gray-700",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸã®è¡¨ç¤ºå½¢å¼"}),T.jsxs("div",{className:"flex gap-2",children:[T.jsx("button",{onClick:()=>a("calendar"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("calendar"===s?"bg-pink-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"}),T.jsx("button",{onClick:()=>a("chart"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("chart"===s?"bg-pink-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"ã‚°ãƒ©ãƒ•"})]})]}),"calendar"===s?T.jsx(xa,{userId:e}):T.jsx(ua,{userId:e,days:90}),T.jsx(ga,{userId:e})]})}function pa(e){try{return localStorage.getItem(e)}catch{return null}}function ba(e,t){try{localStorage.setItem(e,t)}catch{}}function ya(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function fa(e){const{userId:t,keyPrefix:s="athlete",thresholdDays:a=3,enableDailyOneWord:n,enableDailyTip:l}=e,i=n??l??!0,o=r.useMemo(()=>({lastOpenAt:`bekuta:${s}:last_open_at:${t}`,lastDailyShown:`bekuta:${s}:last_daily_one_word_shown:${t}`,lastWelcomeShown:`bekuta:${s}:last_welcome_shown:${t}`,dismissedToday:`bekuta:${s}:dismissed_today:${t}`}),[s,t]),[d,c]=r.useState({open:!1,mode:"none",daysAway:0,todayYMD:ya(new Date)});r.useEffect(()=>{const e=new Date,t=ya(e);if(pa(o.dismissedToday)===t)return ba(o.lastOpenAt,e.toISOString()),void c(e=>({...e,open:!1,mode:"none",todayYMD:t}));const r=pa(o.lastOpenAt),s=pa(o.lastDailyShown),n=pa(o.lastWelcomeShown);let l="none",d=0;if(r){const s=new Date(r);d=function(e,t){const r=t.getTime()-e.getTime();return Math.floor(r/864e5)}(s,e);const i=n===t;Number.isFinite(d)&&d>=a&&!i&&(l="welcome_back")}"none"===l&&i&&s!==t&&(l="daily_one_word"),c("none"!==l?{open:!0,mode:l,daysAway:d,todayYMD:t}:e=>({...e,open:!1,mode:"none",daysAway:d,todayYMD:t})),ba(o.lastOpenAt,e.toISOString())},[o,a,i]);const u=r.useCallback((e="close")=>{const t=new Date,r=ya(t);return ba(o.dismissedToday,r),"daily_one_word"===d.mode&&ba(o.lastDailyShown,r),"welcome_back"===d.mode&&ba(o.lastWelcomeShown,r),ba(o.lastOpenAt,t.toISOString()),c(e=>({...e,open:!1,mode:"none"})),e},[o,d.mode]);return{...d,dismiss:u}}function va(e){const{open:t,mode:r,daysAway:s=0,title:a,message:n,okLabel:l,closeLabel:i,onOk:o,onClose:d}=e;if(!t)return null;const c="welcome_back"===r?"ãŠã‹ãˆã‚Šãªã•ã„":"ä»Šæ—¥ã®ä¸€è¨€",u="welcome_back"===r?"ä»Šæ—¥ã¯ã“ã“ã‹ã‚‰":"OK";return T.jsxs("div",{className:"fixed inset-0 z-[60] flex items-start justify-center px-4 pt-16",children:[T.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:d}),T.jsxs("div",{className:"relative w-full max-w-sm rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 shadow-2xl p-4",children:[T.jsx("button",{type:"button",onClick:d,className:"absolute right-3 top-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"é–‰ã˜ã‚‹",children:T.jsx(ar,{className:"w-5 h-5 text-gray-500"})}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"p-2 rounded-xl bg-blue-50 dark:bg-blue-900/20",children:T.jsx(Lt,{className:"w-5 h-5 text-blue-600 dark:text-blue-300"})}),T.jsxs("div",{className:"min-w-0",children:[T.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a??c}),"welcome_back"===r&&T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ã‹ã‚‰ ",s,"æ—¥"]})]})]}),T.jsx("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-200 whitespace-pre-line",children:n}),T.jsxs("div",{className:"mt-4 flex gap-2",children:[T.jsx("button",{type:"button",onClick:o,className:"flex-1 rounded-xl bg-blue-600 text-white py-2.5 text-sm font-semibold active:opacity-90",children:l??u}),T.jsx("button",{type:"button",onClick:d,className:"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-200",children:i??"é–‰ã˜ã‚‹"})]})]})]})}const ja={preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:80,maxTagHints:1},wa={off:"å›å¾©ãƒ•ã‚§ãƒ¼ã‚ºã€‚ç¡çœ ã¨ç–²åŠ´æŠœãã‚’æœ€å„ªå…ˆã«ã€‚",pre:"åœŸå°ã¥ãã‚Šãƒ•ã‚§ãƒ¼ã‚ºã€‚ãƒ•ã‚©ãƒ¼ãƒ ãƒ»åŸºç¤ã‚’å„ªå…ˆã€ä¸Šã’ã™ãæ³¨æ„ã€‚",in:"ç©ã¿ä¸Šã’ãƒ•ã‚§ãƒ¼ã‚ºã€‚å¼·åº¦ã®æ³¢ã‚’æ•´ãˆã€ç¶™ç¶šã§ãã‚‹è² è·ã§ã€‚",peak:"ä»•ä¸Šã’ãƒ•ã‚§ãƒ¼ã‚ºã€‚è³ªã‚’æœ€å¤§åŒ–ã—ã¤ã¤ã€ç¡çœ ã¨ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’æœ€å„ªå…ˆã«ã€‚",transition:"åˆ‡ã‚Šæ›¿ãˆãƒ•ã‚§ãƒ¼ã‚ºã€‚ç–²åŠ´ç®¡ç†ã¨æ¬¡ã®æº–å‚™ã‚’ä¸å¯§ã«ã€‚",unknown:"ãƒ•ã‚§ãƒ¼ã‚ºæœªè¨­å®šã€‚ä»Šã®ç‹™ã„ã‚’ç¢ºèªã—ã¦ã€ç„¡ç†ã®ãªã„è¨ˆç”»ã§é€²ã‚ã‚ˆã†ã€‚"},Na=[{match:e=>/ãƒ•ã‚©ãƒ¼ãƒ |å§¿å‹¢|åŸºç¤|åŸºæœ¬|å‹•ä½œ|ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯|æŠ€è¡“/i.test(e),text:"ã€Œé€Ÿã•ã€ã‚ˆã‚Šã€Œå½¢ã€ã€‚ç›´ã™ç‚¹ã¯1ã¤ã«çµã‚ã†ã€‚"},{match:e=>/å¯å‹•åŸŸ|ãƒ¢ãƒ“ãƒªãƒ†ã‚£|æŸ”è»Ÿ|ã‚¹ãƒˆãƒ¬ãƒƒãƒ|é–¢ç¯€/i.test(e),text:"å¯å‹•åŸŸã¯â€œæ¯æ—¥å°‘ã—â€ã€‚ç—›ã¿ã‚¼ãƒ­ã§ç©ã‚€ã€‚"},{match:e=>/ä½“å¹¹|ã‚³ã‚¢|è…¹åœ§|ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£|å®‰å®š/i.test(e),text:"ä½“å¹¹ã¯â€œå›ºã‚ã‚‹â€ã‚ˆã‚Šâ€œæ”¯ãˆã‚‹â€ã€‚å‘¼å¸ã‚‚ã‚»ãƒƒãƒˆã§ã€‚"},{match:e=>/å‘¼å¸|ãƒ–ãƒ¬ã‚¹|æ¨ªéš”è†œ/i.test(e),text:"å‘¼å¸ã‚’æ•´ãˆã‚‹ã¨å‹•ãã‚‚æ•´ã†ã€‚æœ€åˆã®1åˆ†ã§ãƒªã‚»ãƒƒãƒˆã€‚"},{match:e=>/ç­‹åŠ›|ç­‹è‚¥å¤§|ã‚¦ã‚¨ã‚¤ãƒˆ|ã‚¦ã‚§ã‚¤ãƒˆ|strength|S&C/i.test(e),text:"é‡ã‚ˆã‚Šè³ªã€‚ãƒ•ã‚©ãƒ¼ãƒ ã¨å¯å‹•åŸŸãŒå´©ã‚ŒãŸã‚‰æ­¢ã‚ã‚‹ã€‚"},{match:e=>/ãƒ‘ãƒ¯ãƒ¼|çˆ†ç™º|ç¬ç™º|ãƒ‘ãƒ¯ãƒ¼ç³»|power/i.test(e),text:"å‡ºåŠ›ã¯â€œçŸ­ãæ¿ƒãâ€ã€‚å›å¾©ã¾ã§å«ã‚ã¦1ã‚»ãƒƒãƒˆã€‚"},{match:e=>/ãƒ—ãƒ©ã‚¤ã‚ª|ãƒ—ãƒ©ã‚¤ã‚ªãƒ¡ãƒˆãƒªã‚¯ã‚¹|plyo|ã‚¸ãƒ£ãƒ³ãƒ—/i.test(e),text:"è·³ã¶å‰ã«ç€åœ°ã€‚é™ã‹ãªç€åœ°ãŒã§ããŸã‚‰å¼·åº¦UPã€‚"},{match:e=>/ã‚¹ãƒ—ãƒªãƒ³ãƒˆ|ã‚¹ãƒ”ãƒ¼ãƒ‰|speed|åŠ é€Ÿ|ãƒˆãƒƒãƒ—ã‚¹ãƒ”ãƒ¼ãƒ‰/i.test(e),text:"å‡ºåŠ›æ—¥ã¯å›å¾©ã¨ã‚»ãƒƒãƒˆã€‚æ¬¡ã®æ—¥ã«ç–²åŠ´ã‚’æ®‹ã•ãªã„ã€‚"},{match:e=>/æ¸›é€Ÿ|ãƒ–ãƒ¬ãƒ¼ã‚­|åœæ­¢|decel/i.test(e),text:"æ¸›é€Ÿã¯ã‚±ã‚¬äºˆé˜²ã®è¦ã€‚å°ã•ãæ­¢ã¾ã‚Œã‚‹å¼·ã•ã‚’ã€‚"},{match:e=>/åˆ‡ã‚Šè¿”ã—|æ–¹å‘è»¢æ›|ã‚¢ã‚¸ãƒªãƒ†ã‚£|agility|ã‚¿ãƒ¼ãƒ³/i.test(e),text:"æ›²ãŒã‚‹å‰ã«æ¸›é€Ÿã€‚å§¿å‹¢ãŒé«˜ã„ãªã‚‰ä¸€æ®µä¸‹ã’ã‚‹ã€‚"},{match:e=>/åå¿œ|ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³|åˆ¤æ–­|reaction/i.test(e),text:"åå¿œã¯â€œå…ˆã«è¦‹ã‚‹â€ã€‚è¦–ç·šã¨æº–å‚™å§¿å‹¢ã‚’ãã‚ãˆã‚‹ã€‚"},{match:e=>/ãƒªã‚ºãƒ |ãƒ†ãƒ³ãƒ|ãƒ”ãƒƒãƒ/i.test(e),text:"ãƒªã‚ºãƒ ãŒå´©ã‚ŒãŸã‚‰ä¸€åº¦æ­¢ã‚ã‚‹ã€‚æ•´ãˆã¦ã‹ã‚‰å†é–‹ã€‚"},{match:e=>/æŒä¹…|ã‚¹ã‚¿ãƒŸãƒŠ|aerobic|endurance|æœ‰é…¸ç´ /i.test(e),text:"ç–²åŠ´ã®æºœã‚ã™ãã«æ³¨æ„ã€‚ç¿Œæ—¥ã«èµ°ã‚Œã‚‹å¼·åº¦ã§ã€‚"},{match:e=>/ç„¡é…¸ç´ |ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«|ä¹³é…¸|anaerobic/i.test(e),text:"è¿½ã„è¾¼ã¿ã™ãæ³¨æ„ã€‚è³ªã®è½ã¡å§‹ã‚ãŒâ€œçµ‚äº†ã‚µã‚¤ãƒ³â€ã€‚"},{match:e=>/å›å¾©|ãƒªã‚«ãƒãƒªãƒ¼|ç–²åŠ´æŠœã|ä¼‘é¤Š|ãƒ¬ã‚¹ãƒˆ/i.test(e),text:"å›å¾©ã¯ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€‚ç¡çœ ãƒ»æ „é¤Šãƒ»æ°´åˆ†ã‚’å…ˆã«æ•´ãˆã‚‹ã€‚"},{match:e=>/è‚¡é–¢ç¯€|ãƒ’ãƒƒãƒ—|éª¨ç›¤/i.test(e),text:"è‚¡é–¢ç¯€ãŒå‹•ãã¨å…¨èº«ãŒè»½ã„ã€‚è©°ã¾ã‚Šæ„Ÿã¯è¦èª¿æ•´ã€‚"},{match:e=>/è¶³é¦–|ã‚¢ãƒ³ã‚¯ãƒ«|ãµãã‚‰ã¯ã|ã‚¢ã‚­ãƒ¬ã‚¹/i.test(e),text:"è¶³é¦–ãŒç¡¬ã„æ—¥ã¯ç„¡ç†ã«ä¸Šã’ãªã„ã€‚æ¥åœ°ã®è³ªã‚’å„ªå…ˆã€‚"},{match:e=>/è†|ãƒ‹ãƒ¼|è†ç—›/i.test(e),text:"è†ã¯çµæœã€‚è‚¡é–¢ç¯€ã¨è¶³éƒ¨ã®ä½ç½®ã‚’å…ˆã«æ•´ãˆã‚‹ã€‚"},{match:e=>/ãƒãƒ |ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°|è‚‰é›¢ã‚Œ/i.test(e),text:"ãƒãƒ ã¯â€œå¼µã‚Šå§‹ã‚â€ã§æ­¢ã‚ã‚‹ã€‚æ—©ã‚ã®ã‚±ã‚¢ãŒå‹ã¡ã€‚"},{match:e=>/è‚©|è‚©ç”²éª¨|ã‚¹ã‚­ãƒ£ãƒ—ãƒ©|èƒ¸éƒ­|T-spine|èƒ¸æ¤/i.test(e),text:"è‚©ã¯èƒ¸éƒ­ã‹ã‚‰ã€‚ä¸Šã’ã‚‹å‰ã«å›ã™ãƒ»åºƒã’ã‚‹ã€‚"},{match:e=>/RPE|ä¸»è¦³|ãã¤ã•/i.test(e),text:"ä¸»è¦³ã¯æ­£è§£ã€‚ã„ã¤ã‚‚ã‚ˆã‚Šé‡ã„ãªã‚‰è² è·ã‚’ä¸‹ã’ã‚‹åˆ¤æ–­ã‚‚â—ã€‚"},{match:e=>/FTT|ãƒ‹ãƒ¥ãƒ¼ãƒ­|åå¿œãƒ†ã‚¹ãƒˆ/i.test(e),text:"åå¿œãŒéˆã„æ—¥ã¯â€œé‡ã‚ˆã‚Šè³ªâ€ã€‚ç¥çµŒã®å›å¾©ã‚’å„ªå…ˆã€‚"},{match:e=>/ç¡çœ |å¯ä¸è¶³|çœ ã„/i.test(e),text:"å¯ä¸è¶³ã®æ—¥ã¯ä¸Šã’ã™ãæ³¨æ„ã€‚ç²¾åº¦ã¨å›å¾©ã‚’æœ€å„ªå…ˆã€‚"},{match:e=>/æ „é¤Š|è£œé£Ÿ|ã‚¿ãƒ³ãƒ‘ã‚¯|ç‚­æ°´åŒ–ç‰©|æ°´åˆ†/i.test(e),text:"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã€‚ã¾ãšå›å¾©ã®åœŸå°ã‹ã‚‰ã€‚"},{match:e=>/é›†ä¸­|ãƒ¡ãƒ³ã‚¿ãƒ«|æ°—æŒã¡|ãƒ¢ãƒãƒ™/i.test(e),text:"é›†ä¸­ãŒåˆ‡ã‚Œã‚‹å‰ã«åŒºåˆ‡ã‚‹ã€‚çŸ­ãã¦ã‚‚é«˜å“è³ªãŒå‹ã¡ã€‚"},{match:e=>/è©¦åˆ|ã‚²ãƒ¼ãƒ |å¤§ä¼š|æœ¬ç•ª/i.test(e),text:"æœ¬ç•ªã¯â€œä»•ä¸ŠãŒã‚Šâ€ãŒå…¨ã¦ã€‚ç–²åŠ´ã‚’æ®‹ã•ãªã„èª¿æ•´ã¸ã€‚"},{match:e=>/èª¿æ•´|ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°|è»½ã‚/i.test(e),text:"è»½ãã¦ã‚‚OKã€‚ã‚­ãƒ¬ã‚’å‡ºã™å‹•ãã ã‘æ®‹ã™ã€‚"},{match:e=>/ç¢ºèª|å¾©ç¿’|è¦‹ç›´ã—/i.test(e),text:"â€œã§ããŸ/ã§ããªã„â€ã‚ˆã‚Šâ€œæ°—ã¥ã‘ãŸã‹â€ã€‚ãã‚ŒãŒæˆé•·ã€‚"},{match:e=>/ç©ã¿ä¸Šã’|ç¶™ç¶š|ç¿’æ…£/i.test(e),text:"ç¶šã‘ã‚‹è¨­è¨ˆãŒæœ€å¼·ã€‚æ˜æ—¥ã‚‚ã§ãã‚‹ä½™ç™½ã‚’æ®‹ãã†ã€‚"}];function ka(e,t,r,s){const a={...ja,...s??{}},n=wa[e]??wa.unknown,l=((e,t=1)=>{const r=Array.isArray(e)?e:[],s=[];for(const a of r){const e=Na.find(e=>e.match(a));if(e&&!s.includes(e.text)&&s.push(e.text),s.length>=Math.max(0,t))break}return s.length?s.join(" "):""})(t,a.maxTagHints),i="string"==typeof r&&r.trim().length>0;if(a.preferNote&&i){const e=((e,t)=>{const r=(e=>e.replace(/\s+/g," ").replace(/ã€€+/g," ").trim())(e);return r.length<=t?r:r.slice(0,Math.max(0,t-1))+"â€¦"})(r,a.maxNoteChars);return a.appendTagHintsWhenNote&&l?`${e} ${l}`:e}return l?`${n} ${l}`:n}function _a(e){return e?e.replace(/åœŸå°ã¥ãã‚Šã®é€±/g,"åœŸå°ã¥ãã‚Šã®æœŸé–“").replace(/ç©ã¿ä¸Šã’ã®é€±/g,"ç©ã¿ä¸Šã’ã®æœŸé–“").replace(/ä»•ä¸Šã’ã®é€±/g,"ä»•ä¸Šã’ã®æœŸé–“").replace(/åˆ‡ã‚Šæ›¿ãˆã®é€±/g,"åˆ‡ã‚Šæ›¿ãˆã®æœŸé–“").replace(/ä»Šé€±/g,"ã“ã®æœŸé–“").replace(/é€±/g,"æœŸé–“"):e}function Sa(e,t){return e?e.length<=t?e:e.slice(0,Math.max(0,t-1))+"â€¦":e}const Ca={"pre:åŸºç¤":{oneWord:"ğŸ§± åœŸå°ã¥ãã‚Šã®æœŸé–“ã€‚åŸºæœ¬ã‚’ä¸å¯§ã«ã€ä¸Šã’ã™ãæ³¨æ„ã€‚",training:"åœŸå°ã¥ãã‚Šï¼šãƒ•ã‚©ãƒ¼ãƒ ãƒ»åŸºç¤ã‚’å„ªå…ˆã€‚ä¸Šã’ã™ãæ³¨æ„ã€‚"},"pre:ãƒ•ã‚©ãƒ¼ãƒ ":{oneWord:"ğŸ§± ãƒ•ã‚©ãƒ¼ãƒ æœ€å„ªå…ˆã€‚é€Ÿã•ã‚ˆã‚Šâ€œè³ªâ€ã§ç©ã‚€ã€‚",training:"ãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆã€‚é€Ÿã•ã‚ˆã‚Šâ€œå†ç¾æ€§â€ã§ç©ã‚‚ã†ã€‚"},"pre:ç­‹åŠ›":{oneWord:"ğŸ§± ç­‹åŠ›ã¯ç©ã¿ä¸Šã’ã€‚è¿½ã„è¾¼ã¿ã™ããšç¶™ç¶šã§å‹ã¤ã€‚",training:"ç­‹åŠ›ã¯â€œç¶šã‘ã¦ä¼¸ã°ã™â€ã€‚ã‚„ã‚Šåˆ‡ã‚‹ã‚ˆã‚Šç¶™ç¶šã€‚"},"in:ç©ã¿ä¸Šã’":{oneWord:"ğŸ“ˆ ç©ã¿ä¸Šã’æœŸã€‚ç‹™ã„ã‚’æ±ºã‚ã¦è¨˜éŒ²ã—ã‚ˆã†ã€‚",training:"ç©ã¿ä¸Šã’ï¼šç‹™ã„ã‚’æ±ºã‚ã¦ã€ã‚„ã£ãŸå†…å®¹ã‚’æ®‹ãã†ã€‚"},"in:å¼·åº¦":{oneWord:"ğŸ“ˆ å¼·åº¦ã‚’ä½¿ã†æœŸé–“ã€‚å›å¾©ã‚‚ã‚»ãƒƒãƒˆã§è¨­è¨ˆã€‚",training:"å¼·åº¦ã‚’ä½¿ã†æ—¥ã€‚å›å¾©ï¼ˆç¡çœ /æ „é¤Šï¼‰ã‚‚ã‚»ãƒƒãƒˆã§ã€‚"},"peak:ã‚­ãƒ¬":{oneWord:"âš¡ ä»•ä¸Šã’æœŸã€‚ç–²åŠ´ã‚’æ®‹ã•ãšã‚­ãƒ¬é‡è¦–ã€‚",training:"ä»•ä¸Šã’ï¼šé‡ã‚ˆã‚Šã‚­ãƒ¬ã€‚ç–²åŠ´ã‚’æ®‹ã•ãªã„ã€‚"},"peak:è©¦åˆ":{oneWord:"âš¡ è©¦åˆãƒ¢ãƒ¼ãƒ‰ã€‚è»½ãé‹­ãã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³æœ€å„ªå…ˆã€‚",training:"è©¦åˆå„ªå…ˆï¼šè»½ãé‹­ãã€‚ã‚„ã‚Šéããªã„ã€‚",sleep:"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚",nutrition:"èƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚"},"transition:å›å¾©":{oneWord:"ğŸ”„ åˆ‡ã‚Šæ›¿ãˆæœŸã€‚æ•´ãˆã¦æ¬¡ã®ä¼¸ã³ã«ç¹‹ã’ã‚‹ã€‚",training:"æ•´ãˆã‚‹æ—¥ã€‚è»½ã‚ã§OKã€å¯å‹•åŸŸã¨å®‰å®šæ€§ã€‚"},"off:ä¼‘é¤Š":{oneWord:"ğŸŒ¿ å›å¾©ãŒä»•äº‹ã€‚ç¡çœ ã¨æ „é¤Šã§æº€ã‚¿ãƒ³ã«ã€‚",training:"å›å¾©å„ªå…ˆã€‚å¼·åº¦ã¯æ§ãˆã‚ã§OKã€‚",sleep:"ç¡çœ ã§å›å¾©ã‚’ä½œã‚‹ã€‚æ—©å¯ã‚‚æ¤œè¨ã€‚",nutrition:"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚"},"unknown:":{oneWord:"âœ… ä»Šæ—¥ã®æ„Ÿè¦šã‚’æ­£ç›´ã«è¨˜éŒ²ã—ã‚ˆã†ã€‚"}};function Ea(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let a=0;a<r.length;++a)s[a]=r.charCodeAt(a);return s}async function Da(){if(!("serviceWorker"in navigator))return null;return await navigator.serviceWorker.register("/sw.js")}async function Ma(e){var t,r;const{data:{user:s}}=await z.auth.getUser();if(!s)throw new Error("Not logged in");await Da();const a=await async function(e){if(!("serviceWorker"in navigator)||!("PushManager"in window))throw new Error("Push not supported");const t=await navigator.serviceWorker.ready,r=await t.pushManager.getSubscription();if(r)return r;if("granted"!==await Notification.requestPermission())throw new Error("Notification permission denied");return await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ea(e)})}(e),n=a.toJSON(),l={user_id:s.id,endpoint:a.endpoint,p256dh:(null==(t=n.keys)?void 0:t.p256dh)??"",auth:(null==(r=n.keys)?void 0:r.auth)??"",user_agent:navigator.userAgent},{error:i}=await z.from("push_subscriptions").upsert(l,{onConflict:"user_id,endpoint"});if(i)throw i;return a}const Ta="BOs4Yup3ijgFAgBaqEaRv10Lx6SuRLNuJdiJ1zZiDyIcPh6YgoUneI4iD3czij1Qz_g50DRRd9AtxvQoNb-emvc";function Ra({userId:e,userEmail:t}){const[s,a]=r.useState({alerts:!0,password_reset:!0,weekly_summary:!1}),[n,l]=r.useState(!1),[i,o]=r.useState(!1),[d,c]=r.useState(!1),[u,x]=r.useState(!0),[m,g]=r.useState(!1),[h,p]=r.useState(null);r.useEffect(()=>{(async()=>{x(!0),await Promise.all([b(),f()]),x(!1)})()},[e]);const b=async()=>{try{const{data:t,error:r}=await z.from("users").select("email_notifications").eq("id",e).single();if(r)throw r;const s=(null==t?void 0:t.email_notifications)??{};a(e=>({...e,...s}))}catch(t){console.error("Error loading email preferences:",t)}},y=e=>{a(t=>({...t,[e]:!t[e]}))},f=async()=>{try{const t=await Da();l(!!t);const{data:r,error:s}=await z.from("push_subscriptions").select("id").eq("user_id",e).limit(1).maybeSingle();if(s)throw s;o(!!r)}catch(t){console.error("Error init push:",t),l(!1)}};return u?T.jsx("div",{className:"flex justify-center items-center py-8",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx(gt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),T.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"é€šçŸ¥è¨­å®š"})]}),T.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start",children:[T.jsx(gt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 mt-0.5 flex-shrink-0"}),T.jsxs("div",{children:[T.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[T.jsx("strong",{children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:"})," ",t]}),T.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:"ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã¯ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€ä¿¡ã•ã‚Œã¾ã™"})]})]})}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 space-y-6 transition-colors",children:[T.jsxs("div",{className:"flex items-start space-x-4",children:[T.jsx(Se,{className:"w-6 h-6 text-purple-600 dark:text-purple-400 mt-1 flex-shrink-0"}),T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã„ãªã„æ™‚ã‚‚ã€å¿…è¦ãªã¨ãã ã‘ãã£ã¨å£°ã‚’ã‹ã‘ã¾ã™"})]}),T.jsx("button",{onClick:async()=>{c(!0),p(null);try{0,i?(await async function(){const{data:{user:e}}=await z.auth.getUser();if(!e)throw new Error("Not logged in");if("serviceWorker"in navigator){const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();if(t)try{await t.unsubscribe()}catch(r){console.warn("unsubscribe failed:",r)}}const{error:t}=await z.from("push_subscriptions").delete().eq("user_id",e.id);if(t)throw t;return!0}(),o(!1),p({type:"success",text:"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’OFFã«ã—ã¾ã—ãŸ"})):(await Da(),await Ma(Ta),o(!0),p({type:"success",text:"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’ONã«ã—ã¾ã—ãŸ"}))}catch(e){console.error("Push toggle error:",e),p({type:"error",text:e.message||"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ"})}finally{c(!1),setTimeout(()=>p(null),3e3)}},disabled:!n||d,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"} ${!n||d?"opacity-50 cursor-not-allowed":""}`,title:n?"":"ã“ã®ç«¯æœ«ã§ã¯ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’åˆ©ç”¨ã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™",children:T.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(i?"translate-x-6":"translate-x-1")})})]}),T.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"â€» iPhoneã¯ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ãŸBekutaã‹ã‚‰ONã«ã—ã¦ãã ã•ã„"})]})]}),T.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),T.jsxs("div",{className:"flex items-start space-x-4",children:[T.jsx(Se,{className:"w-6 h-6 text-red-600 dark:text-red-400 mt-1 flex-shrink-0"}),T.jsx("div",{className:"flex-1",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"é«˜ãƒªã‚¹ã‚¯ã®ACWRå€¤ã‚„æ€ªæˆ‘ã®äºˆæ¸¬ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ä¿¡"})]}),T.jsx("button",{onClick:()=>y("alerts"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.alerts?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"),children:T.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.alerts?"translate-x-6":"translate-x-1")})})]})})]}),T.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),T.jsxs("div",{className:"flex items-start space-x-4",children:[T.jsx(zt,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 mt-1 flex-shrink-0"}),T.jsx("div",{className:"flex-1",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆé€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸéš›ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é€šçŸ¥"})]}),T.jsx("button",{onClick:()=>y("password_reset"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.password_reset?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"),children:T.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.password_reset?"translate-x-6":"translate-x-1")})})]})})]}),T.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),T.jsxs("div",{className:"flex items-start space-x-4",children:[T.jsx(De,{className:"w-6 h-6 text-green-600 dark:text-green-400 mt-1 flex-shrink-0"}),T.jsx("div",{className:"flex-1",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"é€±æ¬¡ã‚µãƒãƒªãƒ¼ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"æ¯é€±æœˆæ›œæ—¥ã«å…ˆé€±ã®çŠ¶æ³ã‚’ã¾ã¨ã‚ãŸãƒ¬ãƒãƒ¼ãƒˆã‚’å—ä¿¡"})]}),T.jsx("button",{onClick:()=>y("weekly_summary"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.weekly_summary?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"),children:T.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.weekly_summary?"translate-x-6":"translate-x-1")})})]})})]})]}),h&&T.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg ${"success"===h.type?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-600 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400"} transition-colors`,children:["success"===h.type?T.jsx(Re,{className:"w-5 h-5 flex-shrink-0"}):T.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),T.jsx("span",{className:"text-sm",children:h.text})]}),T.jsx("div",{className:"flex justify-end",children:T.jsx("button",{onClick:async()=>{g(!0),p(null);try{const{error:t}=await z.from("users").update({email_notifications:s}).eq("id",e);if(t)throw t;p({type:"success",text:"ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ"})}catch(t){console.error("Error saving preferences:",t),p({type:"error",text:t.message||"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ"})}finally{g(!1),setTimeout(()=>p(null),3e3)}},disabled:m,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white py-2 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center space-x-2",children:m?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),T.jsx("span",{children:"ä¿å­˜ä¸­..."})]}):T.jsxs(T.Fragment,{children:[T.jsx(Dt,{className:"w-4 h-4"}),T.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«è¨­å®šã‚’ä¿å­˜"})]})})}),T.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4 transition-colors",children:T.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[T.jsx("strong",{children:"æ³¨æ„:"})," ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹é‡è¦ãªé€šçŸ¥ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç­‰ï¼‰ã¯ã€è¨­å®šã«é–¢ã‚ã‚‰ãšé€ä¿¡ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚"]})})]})}function $a({user:e,onOpenProfileEdit:t}){return T.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š"}),T.jsx("button",{onClick:t,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"ç·¨é›†"})]}),T.jsx("div",{className:"space-y-4",children:T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"åå‰"}),T.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.name??"-"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.email??"-"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"æ€§åˆ¥"}),T.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"male"===e.gender?"ç”·æ€§":"female"===e.gender?"å¥³æ€§":"other"===e.gender?"ãã®ä»–":"prefer_not_to_say"===e.gender?"å›ç­”ã—ãªã„":"æœªè¨­å®š"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"èº«é•·"}),T.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.height_cm?`${e.height_cm} cm`:"æœªè¨­å®š"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ç”Ÿå¹´æœˆæ—¥"}),T.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.date_of_birth?new Date(e.date_of_birth).toLocaleDateString("ja-JP"):"æœªè¨­å®š"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"é›»è©±ç•ªå·"}),T.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.phone_number?e.phone_number:"æœªè¨­å®š"})]})]})})]}),T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:T.jsx(Ra,{userId:e.id,userEmail:e.email??""})})]})}const Aa=r.lazy(()=>A(()=>import("./AthleteNutritionDashboardView-5dKSLPKh.js"),__vite__mapDeps([3,1,2])).then(e=>({default:e.default}))),Ia=r.lazy(()=>A(()=>import("./ExportPanel-znwgpFDe.js"),__vite__mapDeps([4,1,5,2])).then(e=>({default:e.ExportPanel})));r.lazy(()=>A(()=>import("./GamificationView-B4thg2QI.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.GamificationView})));const za=r.lazy(()=>A(()=>import("./MessagingPanel-D7zdw3YG.js"),__vite__mapDeps([6,1,2])).then(e=>({default:e.MessagingPanel}))),Pa=r.lazy(()=>A(()=>import("./AthletePerformanceView-BEW3xqkO.js"),__vite__mapDeps([7,1,2])).then(e=>({default:e.default})));function La({user:e,alerts:t,onLogout:s,onHome:a,onNavigateToPrivacy:n,onNavigateToTerms:l,onNavigateToCommercial:i,onNavigateToHelp:o,onUserUpdated:d}){var c,u,x,m,g,h,p,b,y,f,v,j,w;r.useRef(!1),r.useEffect(()=>{},[e.id,e.role,e.gender,e.team_id]),r.useRef(!1),r.useEffect(()=>{},[]);const N=r.useMemo(()=>H(),[]),[k,_]=r.useState(null),[S,C]=r.useState([]),[E,D]=r.useState(!1),[M,R]=r.useState(null);r.useEffect(()=>{const t=e.team_id;if(!t)return _(null),void C([]);let r=!1;return(async()=>{D(!0),R(null);try{const{data:e,error:s}=await z.rpc("get_team_phase_on_date",{p_team_id:t,p_date:N});if(s)throw s;const a=((e,t)=>{const[r,s,a]=e.split("-").map(Number),n=new Date(r,(s??1)-1,a??1);return n.setDate(n.getDate()+t),`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`})(N,21),{data:n,error:l}=await z.rpc("get_team_phases_in_range",{p_team_id:t,p_start:N,p_end:a});if(l)throw l;if(r)return;const i=Array.isArray(e)?e[0]:e;_(i??null);const o=((Array.isArray(n)?n:[])??[]).filter(e=>!i||!(e.phase_type===i.phase_type&&e.start_date===i.start_date&&e.end_date===i.end_date));o.sort((e,t)=>e.start_date>t.start_date?1:e.start_date<t.start_date?-1:0),C(o)}catch(e){if(r)return;console.error("[team phase fetch error]",e),R((null==e?void 0:e.message)??"team phase fetch error"),_(null),C([])}finally{r||D(!1)}})(),()=>{r=!0}},[e.team_id,N]);const $=e=>{switch(e){case"off":return"ã‚ªãƒ•";case"pre":return"ãƒ—ãƒ¬";case"in":return"ã‚¤ãƒ³";case"peak":return"ãƒ”ãƒ¼ã‚¯";case"transition":return"ç§»è¡Œ";default:return"æœªè¨­å®š"}},I=(e,t)=>{const r=Number(e.slice(5,7)),s=Number(e.slice(8,10)),a=Number(t.slice(5,7)),n=Number(t.slice(8,10));return r&&s&&a&&n?`${r}/${s}â€“${a}/${n}`:`${e}ã€œ${t}`},[P,L]=r.useState(null),[q,F]=r.useState(!1),[O,W]=r.useState(!1),[B,U]=r.useState(!1),[V,K]=r.useState(!1),[Y,G]=r.useState("unified"),Z=!!e.ftt_enabled,X=!!e.nutrition_enabled;r.useEffect(()=>{const e=navigator.connection,t=!!(null==e?void 0:e.saveData),r=null==e?void 0:e.effectiveType;if(t||("slow-2g"===r||"2g"===r||"3g"===r))return;let s=!1;const a=()=>{A(()=>import("./AthletePerformanceView-BEW3xqkO.js"),__vite__mapDeps([7,1,2]))};if("requestIdleCallback"in window){const e=window.requestIdleCallback(()=>{s||a()},{timeout:4e3});return()=>{var t;s=!0,null==(t=window.cancelIdleCallback)||t.call(window,e)}}const n=setTimeout(()=>{s||a()},2500);return()=>{s=!0,clearTimeout(n)}},[]);const Q=r.useCallback(e=>{("ftt"!==e||Z)&&("nutrition"!==e||X)&&G(e)},[Z,X]);r.useEffect(()=>{Z||"ftt"!==Y||G("unified")},[Z,Y]),r.useEffect(()=>{X||"nutrition"!==Y||G("unified")},[X,Y]);const[ee,te]=r.useState(null),[re,se]=r.useState(!1),ae=r.useMemo(()=>"female"===e.gender||"male"===e.gender?e.gender:null,[e.gender]),ie=r.useMemo(()=>"female"===e.gender||"male"===e.gender||"other"===e.gender||"prefer_not_to_say"===e.gender?e.gender:null,[e.gender]);r.useEffect(()=>{},[e.gender,ae,ie]),r.useEffect(()=>{"cycle"===Y&&"female"!==ae&&G("unified")},[Y,ae]);const{records:oe,loading:de,checkExistingRecord:ce,addTrainingRecord:ue,updateTrainingRecord:xe,deleteTrainingRecord:me,acwrData:he}=Hr(e.id),pe=r.useMemo(()=>he&&he.length>0?he[he.length-1]:null,[he]),{records:ye,loading:ve,checkExistingRecord:je,addWeightRecord:we,updateWeightRecord:Ne,deleteWeightRecord:ke,getLatestWeight:_e,getWeightChange:Se}=Gr(e.id),Ce=r.useMemo(()=>_e(),[_e]),Me=r.useMemo(()=>0===ye.length?null:ye.reduce((e,t)=>!e||new Date(t.date)>new Date(e.date)?t:e,null),[ye]),{records:Te,loading:Re,checkExistingRecord:$e,addSleepRecord:Ae,updateSleepRecord:Ie,getAverageSleepHours:ze,getAverageSleepQuality:Pe,getLatestSleep:Le}=function(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null),o=async()=>{try{n(!0),i(null);const{data:t,error:r}=await z.from("sleep_records").select("*").eq("user_id",e).order("date",{ascending:!1});if(r)throw r;s(t||[])}catch(t){console.error("Error fetching sleep records:",t),i(t instanceof Error?t.message:"ç¡çœ è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}};r.useEffect(()=>{e&&o()},[e]);const d=(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const s=t.filter(e=>new Date(e.date)>=r);return 0===s.length?null:s.reduce((e,t)=>e+Number(t.sleep_hours),0)/s.length};return{records:t,loading:a,error:l,checkExistingRecord:async t=>{try{const{data:r,error:s}=await z.from("sleep_records").select("*").eq("user_id",e).eq("date",t).maybeSingle();if(s)throw s;return r}catch(r){return console.error("Error checking existing record:",r),null}},addSleepRecord:async e=>{try{const{data:t}=await z.auth.getUser();if(!t.user)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r={user_id:t.user.id,date:e.date,sleep_hours:e.sleep_hours,sleep_quality:e.sleep_quality||null,bedtime:e.bedtime||null,waketime:e.waketime||null,notes:e.notes||null},{data:a,error:n}=await z.from("sleep_records").insert(r).select().single();if(n)throw n;s(e=>[a,...e].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}catch(t){throw console.error("Error adding sleep record:",t),t}},updateSleepRecord:async(e,t)=>{try{const r={sleep_hours:t.sleep_hours,sleep_quality:void 0!==t.sleep_quality?t.sleep_quality:null,bedtime:void 0!==t.bedtime?t.bedtime:null,waketime:void 0!==t.waketime?t.waketime:null,notes:void 0!==t.notes?t.notes:null},{data:a,error:n}=await z.from("sleep_records").update(r).eq("id",e).select().single();if(n)throw n;s(t=>t.map(t=>t.id===e?a:t))}catch(r){throw console.error("Error updating sleep record:",r),r}},deleteSleepRecord:async e=>{try{const{error:t}=await z.from("sleep_records").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(t){throw console.error("Error deleting sleep record:",t),t}},getAverageSleepHours:d,getAverageSleepQuality:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const s=t.filter(e=>new Date(e.date)>=r&&null!==e.sleep_quality);return 0===s.length?null:s.reduce((e,t)=>e+(t.sleep_quality||0),0)/s.length},getLatestSleep:()=>0===t.length?null:t[0],getSleepDeficit:(e=7)=>{const t=d(e);return null===t?null:8-t},refresh:o}}(e.id),qe=r.useMemo(()=>(null==Le?void 0:Le())??null,[Le]),Fe=r.useMemo(()=>{const e=Number((null==qe?void 0:qe.sleep_hours)??0),t=Number((null==qe?void 0:qe.sleep_quality)??0);return{isPoor:e>0&&e<6||t>0&&t<=2,hours:e||null,quality:t||null}},[qe]),{records:Oe,loading:We,checkExistingRecord:Be,addMotivationRecord:Ue,updateMotivationRecord:He,getAverageMotivation:Ke,getAverageEnergy:Je,getAverageStress:Ye,getLatestMotivation:Ge}=function(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null),o=async()=>{try{n(!0),i(null);const{data:t,error:r}=await z.from("motivation_records").select("*").eq("user_id",e).order("date",{ascending:!1});if(r)throw r;s(t||[])}catch(t){console.error("Error fetching motivation records:",t),i(t instanceof Error?t.message:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}};return r.useEffect(()=>{e&&o()},[e]),{records:t,loading:a,error:l,checkExistingRecord:async t=>{try{const{data:r,error:s}=await z.from("motivation_records").select("*").eq("user_id",e).eq("date",t).maybeSingle();if(s)throw s;return r}catch(r){return console.error("Error checking existing record:",r),null}},addMotivationRecord:async t=>{try{if(!e)throw new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒã‚ã‚Šã¾ã›ã‚“");const r={user_id:e,date:t.date,motivation_level:t.motivation_level,energy_level:t.energy_level,stress_level:t.stress_level,mood:t.mood||null,notes:t.notes||null},{data:a,error:n}=await z.from("motivation_records").upsert(r,{onConflict:"user_id,date"}).select().single();if(n)throw n;s(e=>{const t=e.filter(e=>!(e.user_id===a.user_id&&e.date===a.date));return[a,...t].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())})}catch(r){throw console.error("Error adding motivation record:",r),r}},updateMotivationRecord:async(e,t)=>{try{const r={motivation_level:t.motivation_level,energy_level:t.energy_level,stress_level:t.stress_level,mood:void 0!==t.mood?t.mood:null,notes:void 0!==t.notes?t.notes:null},{data:a,error:n}=await z.from("motivation_records").update(r).eq("id",e).select().single();if(n)throw n;s(t=>t.map(t=>t.id===e?a:t))}catch(r){throw console.error("Error updating motivation record:",r),r}},deleteMotivationRecord:async e=>{try{const{error:t}=await z.from("motivation_records").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(t){throw console.error("Error deleting motivation record:",t),t}},getAverageMotivation:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const s=t.filter(e=>new Date(e.date)>=r);return 0===s.length?null:s.reduce((e,t)=>e+t.motivation_level,0)/s.length},getAverageEnergy:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const s=t.filter(e=>new Date(e.date)>=r);return 0===s.length?null:s.reduce((e,t)=>e+t.energy_level,0)/s.length},getAverageStress:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const s=t.filter(e=>new Date(e.date)>=r);return 0===s.length?null:s.reduce((e,t)=>e+t.stress_level,0)/s.length},getLatestMotivation:()=>0===t.length?null:t[0],getMotivationTrend:(e=7)=>{if(t.length<2)return null;const r=new Date;r.setDate(r.getDate()-e);const s=t.filter(e=>new Date(e.date)>=r).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());if(s.length<2)return null;const a=Math.floor(s.length/2),n=s.slice(0,a),l=s.slice(a),i=n.reduce((e,t)=>e+t.motivation_level,0)/n.length,o=l.reduce((e,t)=>e+t.motivation_level,0)/l.length-i;return o>.5?"improving":o<-.5?"declining":"stable"},refresh:o}}(e.id),{records:Ze,latest:Qe,loading:tt,error:rt}=As(e.id),{cycles:nt,addCycle:lt,updateCycle:ot}=Zr(e.id),{isActive:dt,shouldShowTutorial:ct,startTutorial:ut,completeTutorial:xt,skipTutorial:gt,currentStepIndex:pt,setCurrentStepIndex:yt}=ge(),{isDarkMode:ft}=function(){const[e,t]=r.useState(()=>window.matchMedia("(prefers-color-scheme: dark)").matches);return r.useEffect(()=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[e]),r.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),r=e=>{t(e.matches)};return e.addEventListener("change",r),()=>e.removeEventListener("change",r)},[]),{isDarkMode:e}}(),{logs:vt,totals:jt,loading:wt,error:Nt,refetch:kt}=function(e,t){const[s,a]=r.useState([]),[n,l]=r.useState("idle"),[i,o]=r.useState(null),[d,c]=r.useState(0),u=r.useRef({cal:0,p:0,f:0,c:0}),x=r.useCallback(()=>{c(e=>e+1)},[]);r.useEffect(()=>{if(!e||!t)return;let r=!1;return async function(){l("loading"),o(null);try{const{data:s,error:n}=await z.from("nutrition_logs").select("id, record_date, meal_type, meal_slot, total_calories, p, f, c, is_edited, advice_markdown, image_url, image_path, analysis_status, analysis_error, created_at").eq("user_id",e).eq("record_date",t).order("meal_type",{ascending:!0}).order("meal_slot",{ascending:!0}).order("created_at",{ascending:!0});if(n)throw n;r||(a(s??[]),l("ready"))}catch(s){console.error("[useTodayNutritionTotals] fetch error:",s),r||(a([]),l("error"),o(String((null==s?void 0:s.message)??s)))}}(),()=>{r=!0}},[e,t,d]);const m=r.useMemo(()=>{if("loading"===n)return u.current;const e={cal:0,p:0,f:0,c:0};let t=!1;for(const a of s)null!=a.total_calories&&null!=a.p&&null!=a.f&&null!=a.c||(t=!0),e.cal+=Number(a.total_calories??0),e.p+=Number(a.p??0),e.f+=Number(a.f??0),e.c+=Number(a.c??0);e.p=Math.round(10*e.p)/10,e.f=Math.round(10*e.f)/10,e.c=Math.round(10*e.c)/10;const r={...e,hasAnyLog:s.length>0,hasUnparsed:t};return u.current=r,r},[s,n]);return{logs:s,totals:m,loading:"loading"===n,status:n,error:i,refetch:x}}(e.id,N),_t=r.useMemo(()=>{const e=jt??{};return{cal:Number((null==e?void 0:e.cal)??(null==e?void 0:e.kcal)??(null==e?void 0:e.calories)??(null==e?void 0:e.total_calories)??0)||0,p:Number((null==e?void 0:e.p)??(null==e?void 0:e.protein_g)??(null==e?void 0:e.protein)??0)||0,f:Number((null==e?void 0:e.f)??(null==e?void 0:e.fat_g)??(null==e?void 0:e.fat)??0)||0,c:Number((null==e?void 0:e.c)??(null==e?void 0:e.carbs_g)??(null==e?void 0:e.carbs)??0)||0}},[jt]),St=function(e){const t=e.trainingRecords??[],s=e.weightRecords??[],a=e.sleepRecords??[],n=e.motivationRecords??[];return{lastTrainingRecord:r.useMemo(()=>Ns(t),[t]),lastWeightRecord:r.useMemo(()=>Ns(s),[s]),lastSleepRecord:r.useMemo(()=>Ns(a),[a]),lastMotivationRecord:r.useMemo(()=>Ns(n),[n]),daysWithTrainingData:r.useMemo(()=>{const e=new Set;for(const r of t)js(null==r?void 0:r.date)&&e.add(r.date);return e.size},[t]),consecutiveTrainingDays:r.useMemo(()=>{const e=new Set;for(const i of t)js(null==i?void 0:i.date)&&e.add(i.date);if(0===e.size)return 0;const r=new Date;r.setHours(0,0,0,0);const s=new Date(r),a=J(s);e.has(a)||s.setDate(s.getDate()-1);let n=0;const l=new Date(s);for(let t=0;t<365;t++){const t=J(l);if(!e.has(t))break;n++,l.setDate(l.getDate()-1)}return n},[t]),weeklyAverage:r.useMemo(()=>{if(!t.length)return null;const e=new Date;e.setDate(e.getDate()-7);const r=e.getTime();let s=0,a=0,n=0,l=0;for(const i of t){const e=ws(null==i?void 0:i.date);null!==e&&(e<r||(s++,a+=Number.isFinite(Number(i.rpe))?Number(i.rpe):0,n+=Number.isFinite(Number(i.duration_min))?Number(i.duration_min):0,l+=Number.isFinite(Number(i.load))?Number(i.load):0))}return 0===s?null:{rpe:a/s,duration:n/s,load:l/s}},[t])}}({trainingRecords:oe,weightRecords:ye,sleepRecords:Te,motivationRecords:Oe}),Ct=St.daysWithTrainingData,Et=St.consecutiveTrainingDays,Dt=St.weeklyAverage,{normalizedLastTrainingRecord:Tt,normalizedLastTrainingRecordForCheckIn:Rt,normalizedLastWeightRecord:At,normalizedLastSleepRecord:It,normalizedLastMotivationRecord:Pt}=Ts({lastTrainingRecord:St.lastTrainingRecord,lastWeightRecord:St.lastWeightRecord,lastSleepRecord:St.lastSleepRecord,lastMotivationRecord:St.lastMotivationRecord}),Lt=r.useMemo(()=>Te.map(e=>({...e,sleep_quality:e.sleep_quality??0})),[Te]),qt=r.useMemo(()=>Lt.map(e=>({sleep_hours:e.sleep_hours,sleep_quality:e.sleep_quality,date:e.date})),[Lt]),Ft=r.useMemo(()=>t.filter(t=>t.user_id===e.id),[t,e.id]),Ot=r.useMemo(()=>Ft.filter(e=>"high"===e.priority),[Ft]),Wt=r.useMemo(()=>ye.find(e=>e.date===N),[ye,N]),Bt=r.useMemo(()=>{const e=function(e){var t;const r=e.phase,s=e.poorSleep,a=e.risk??null,n=(null==r?void 0:r.phase_type)??"unknown",l=null==(t=(null==r?void 0:r.focus_tags)??[])?void 0:t.filter(Boolean),i=(null==r?void 0:r.note)??null,o=!!(null==a?void 0:a.hasHighPriorityAlert),d=(null==a?void 0:a.riskLevel)??"unknown",c=o||"high"===d;if(null==s?void 0:s.isPoor){const e=(u=s).hours&&u.hours>0?`ï¼ˆç¡çœ ${u.hours.toFixed(1)}hï¼‰`:u.quality&&u.quality>0?`ï¼ˆç¡çœ ã®è³ª${u.quality}/5ï¼‰`:"ï¼ˆç¡çœ ä¸è¶³ï¼‰";return{oneWord:`âš ï¸ ${e} ä»Šæ—¥ã¯ä¸Šã’ã™ãæ³¨æ„ã€‚å¼·åº¦ã‚’æŠ‘ãˆã¦ç²¾åº¦é‡è¦–ã€‚`,trainingHint:`âš ï¸ ${e} ä»Šæ—¥ã¯ä¸Šã’ã™ãæ³¨æ„ã€‚å¼·åº¦ã‚’æŠ‘ãˆã¦ç²¾åº¦é‡è¦–ã§ã€‚`,sleepHint:`âš ï¸ ${e} ä»Šæ—¥ã¯å›å¾©ãŒæœ€å„ªå…ˆã€‚æ˜¼å¯ã‚„æ—©å¯ã‚‚æ¤œè¨ã€‚`,nutritionHint:`âš ï¸ ${e} å›å¾©å„ªå…ˆï¼šæ°´åˆ†ï¼‹ç‚­æ°´åŒ–ç‰©ï¼‹ãŸã‚“ã±ãè³ªã‚’ç¢ºå®Ÿã«ã€‚`,popHint:`${e} ã¾ãšè¨˜éŒ²ã€‚ä»Šæ—¥ã¯å¼·åº¦ã‚’æŠ‘ãˆã‚‹æ—¥ã«ã€‚`,reason:"poor_sleep"}}var u;if(c)return{oneWord:"âš ï¸ ã‚±ã‚¬ãƒªã‚¹ã‚¯é«˜ã‚ã€‚è² è·ã‚’è½ã¨ã—ã¦å›å¾©/å¯å‹•åŸŸã‚’å„ªå…ˆã€‚",trainingHint:"âš ï¸ ãƒªã‚¹ã‚¯é«˜ã‚ã€‚ä»Šæ—¥ã¯å¼·åº¦ã‚’è½ã¨ã—ã¦ç²¾åº¦ãƒ»å›å¾©å„ªå…ˆã§ã€‚",sleepHint:"ç¡çœ ã§å›å¾©ã‚’æœ€å¤§åŒ–ã€‚å…¥çœ /èµ·åºŠãƒªã‚ºãƒ ã‚’æ•´ãˆã‚ˆã†ã€‚",nutritionHint:"å›å¾©å„ªå…ˆï¼šæ°´åˆ†ï¼‹ç‚­æ°´åŒ–ç‰©ï¼‹ãŸã‚“ã±ãè³ªã‚’å…ˆã«ç¢ºä¿ã€‚",popHint:"ã¾ãšè¨˜éŒ²ã€‚ä»Šæ—¥ã¯â€œå›å¾©å¯„ã‚Šâ€ã§æ•´ãˆã‚ˆã†ã€‚",reason:"high_risk"};if(r){const e=l.find(e=>Ca[`${n}:${e}`]);if(e){const t=Ca[`${n}:${e}`];return{oneWord:Sa(t.oneWord,80),trainingHint:Sa(t.training??t.oneWord,80),sleepHint:Sa(t.sleep??("peak"===n?"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚":"in"===n?"ç¡çœ ã§å›å¾©ã‚’ç©ã‚€ã€‚çŸ­ãã¦ã‚‚è³ªã‚’ç¢ºä¿ã€‚":"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚"),80),nutritionHint:Sa(t.nutrition??("pre"===n?"åœŸå°ã¥ãã‚Šï¼šã¾ãšã¯ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã‹ã‚‰ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç·´ç¿’é‡ã«åˆã‚ã›ã¦ç‚­æ°´åŒ–ç‰©ã‚’ç¢ºä¿ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šèƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚":"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚"),80),popHint:"ã¾ãšè¨˜éŒ²ã€‚ä»Šæ—¥ã®ç‹™ã„ã‚’æ˜ç¢ºã«ã—ã‚ˆã†ã€‚",reason:"phase"}}return i&&i.trim().length>0?{oneWord:Sa(_a(i.trim()),80),trainingHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆã€ä¸Šã’ã™ãæ³¨æ„ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç‹™ã„ã‚’æ±ºã‚ã¦è¨˜éŒ²ã—ã‚ˆã†ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šç–²åŠ´ã‚’æºœã‚ãšã«ã‚­ãƒ¬é‡è¦–ã€‚":"transition"===n?"åˆ‡ã‚Šæ›¿ãˆæœŸï¼šæ•´ãˆã‚‹ãƒ»è»½ã‚ã§OKã€‚":"ä»Šæ—¥ã¯å›å¾©å„ªå…ˆã€‚å¼·åº¦ã¯æ§ãˆã‚ã§OKã€‚",sleepHint:"peak"===n?"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚":"in"===n?"ç¡çœ ã§å›å¾©ã‚’ç©ã‚€ã€‚çŸ­ãã¦ã‚‚è³ªã‚’ç¢ºä¿ã€‚":"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚",nutritionHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šã¾ãšã¯ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã‹ã‚‰ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç·´ç¿’é‡ã«åˆã‚ã›ã¦ç‚­æ°´åŒ–ç‰©ã‚’ç¢ºä¿ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šèƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚":"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚",popHint:"ã¾ãšè¨˜éŒ²ã€‚ä»Šæ—¥ã®ç‹™ã„ã‚’æ˜ç¢ºã«ã—ã‚ˆã†ã€‚",reason:"phase"}:{oneWord:Sa(_a(ka(n,l,i,{preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:80})),80),trainingHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆã€ä¸Šã’ã™ãæ³¨æ„ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç‹™ã„ã‚’æ±ºã‚ã¦è¨˜éŒ²ã—ã‚ˆã†ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šç–²åŠ´ã‚’æºœã‚ãšã«ã‚­ãƒ¬é‡è¦–ã€‚":"transition"===n?"åˆ‡ã‚Šæ›¿ãˆæœŸï¼šæ•´ãˆã‚‹ãƒ»è»½ã‚ã§OKã€‚":"ä»Šæ—¥ã¯å›å¾©å„ªå…ˆã€‚å¼·åº¦ã¯æ§ãˆã‚ã§OKã€‚",sleepHint:"peak"===n?"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚":"in"===n?"ç¡çœ ã§å›å¾©ã‚’ç©ã‚€ã€‚çŸ­ãã¦ã‚‚è³ªã‚’ç¢ºä¿ã€‚":"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚",nutritionHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šã¾ãšã¯ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã‹ã‚‰ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç·´ç¿’é‡ã«åˆã‚ã›ã¦ç‚­æ°´åŒ–ç‰©ã‚’ç¢ºä¿ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šèƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚":"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚",popHint:"ã¾ãšè¨˜éŒ²ã€‚ä»Šæ—¥ã®ç‹™ã„ã‚’æ˜ç¢ºã«ã—ã‚ˆã†ã€‚",reason:"phase"}}return{oneWord:"âœ… ä»Šæ—¥ã¯â€œ1ã¤ã ã‘â€ã‚„ã‚‹ã€‚ã¾ãšè¨˜éŒ²ã‹ã‚‰ã€‚",trainingHint:"ä»Šæ—¥ã®ç·´ç¿’ã‚’æ­£ç›´ã«è¨˜éŒ²ã—ã‚ˆã†ã€‚",sleepHint:"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚",nutritionHint:"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚",popHint:"ã¾ãš1åˆ†ã§å…¥åŠ›ã—ã‚ˆã†ã€‚",reason:"default"}}({phase:k,poorSleep:Fe,risk:{riskLevel:(null==pe?void 0:pe.riskLevel)??"unknown",hasHighPriorityAlert:((null==Ot?void 0:Ot.length)??0)>0}});return{base:e.oneWord,training:e.trainingHint,sleep:e.sleepHint,nutrition:e.nutritionHint}},[k,Fe,null==pe?void 0:pe.riskLevel,null==Ot?void 0:Ot.length]),Ut=fa({userId:e.id,keyPrefix:"athlete",thresholdDays:3,enableDailyTip:!0}),Ht="unified"===Y&&Ut.open,Jt=r.useMemo(()=>"welcome_back"===Ut.mode?"ãŠã‹ãˆã‚Šï¼\nã¾ãšã¯ã€Œä»Šæ—¥ã®çŠ¶æ…‹ã€ã‚’è»½ãè¨˜éŒ²ã—ã¦ã€ç„¡ç†ãªãå†å§‹å‹•ã—ã‚ˆã†ã€‚":`${Bt.base}`,[Ut.mode,Bt.base]),Yt=r.useMemo(()=>{const t=Number((null==Qe?void 0:Qe.weight)??(null==Qe?void 0:Qe.weight_kg))||Number(null==e?void 0:e.weight_kg)||0;if(!t||t<=0)return null;const r=Number((null==Qe?void 0:Qe.body_fat_percent)??(null==Qe?void 0:Qe.body_fat_perc)),s=Number.isFinite(r)&&r>0?r:null,a=Number(null==e?void 0:e.height_cm),n=Xs({weightKg:t,bodyFatPercent:s,heightCm:Number.isFinite(a)&&a>0?a:null,age:null,sex:null,activityLevel:"moderate",goalType:"maintain"});return(null==n?void 0:n.target)??null},[null==e?void 0:e.weight_kg,null==e?void 0:e.height_cm,null==Qe?void 0:Qe.weight,null==Qe?void 0:Qe.weight_kg,null==Qe?void 0:Qe.body_fat_percent,null==Qe?void 0:Qe.body_fat_perc]),Gt=r.useMemo(()=>oe.find(e=>e.date===N)??null,[oe,N]),Zt=r.useMemo(()=>Gt?(Gt.rpe??0)*(Gt.duration_min??0):0,[Gt]);r.useMemo(()=>Bs({date:N,snapshot:P?{bmr:P.bmr,tdee:P.tdee,srpe:P.srpe,activity_factor:Number(P.activity_factor)}:null,intakeCalories:0,fallback:{todayLoad:Zt}}),[N,P,0,Zt]),r.useEffect(()=>{re||de||ct()&&(ut(),se(!0))},[de,re,ct,ut]);const Xt=r.useCallback(async t=>{await ue({rpe:t.rpe,duration_min:t.duration_min,date:t.date,arrow_score:t.arrow_score??50,signal_score:t.signal_score??50}),await async function(e){const{userId:t,date:r,rpe:s,durationMin:a}=e,n=(s??0)*(a??0),{data:l,error:i}=await z.from("nutrition_metabolism_snapshots").select("bmr").eq("user_id",t).order("calculated_at",{ascending:!1}).limit(1).maybeSingle();if(i)throw i;const o=null==l?void 0:l.bmr;if(!o)return;const d=0===n?1.2:n<300?1.4:n<600?1.6:n<900?1.8:2,c=Math.round(o*d),{error:u}=await z.from("daily_energy_snapshots").upsert({user_id:t,date:r,bmr:o,srpe:n,activity_factor:d,tdee:c},{onConflict:"user_id,date"});if(u)throw u}({userId:e.id,date:t.date,rpe:t.rpe,durationMin:t.duration_min})},[ue,e.id]),Qt=r.useCallback(async(e,t)=>{await xe(e,t)},[xe]),er=r.useCallback(async(e,t)=>{await xe(e,t)},[xe]),tr=r.useCallback(async e=>{await ue({rpe:e.rpe,duration_min:e.duration_min,date:e.date,arrow_score:e.arrow_score??50,signal_score:e.signal_score??50})},[ue]),rr=r.useCallback(async(e,t)=>{await xe(e,{rpe:t.rpe,duration_min:t.duration_min,arrow_score:t.arrow_score??50,signal_score:t.signal_score??50})},[xe]),sr=N,lr=r.useRef(null);r.useRef(null);const ir=r.useCallback(e=>{G("nutrition")},[]);return r.useCallback(e=>{switch(e){case"jump":return"ã‚¸ãƒ£ãƒ³ãƒ—æ¸¬å®š";case"endurance":return"å…¨èº«æŒä¹…åŠ›æ¸¬å®š";case"strength":return"ç­‹åŠ›æ¸¬å®š";case"sprint":return"ã‚¹ãƒ—ãƒªãƒ³ãƒˆæ¸¬å®š";case"agility":return"ã‚¢ã‚¸ãƒªãƒ†ã‚£æ¸¬å®š";default:return"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š"}},[]),r.useEffect(()=>{},[null==(c=St.lastTrainingRecord)?void 0:c.date,null==(u=St.lastSleepRecord)?void 0:u.date,null==(x=St.lastMotivationRecord)?void 0:x.date,St.daysWithTrainingData,St.consecutiveTrainingDays]),T.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[T.jsx("header",{className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 shadow-lg transition-colors",children:T.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("button",{type:"button",onClick:a,className:"flex items-baseline gap-2 active:opacity-70 cursor-pointer",style:{WebkitTapHighlightColor:"transparent"},children:[T.jsx("span",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Bekuta"}),T.jsx("span",{className:"text-xs font-medium text-blue-100 hidden sm:inline",children:"by ARCA"})]}),T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("button",{type:"button",onClick:ut,className:"p-2 rounded-lg text-white/90 hover:bg-white/10 hover:text-white transition-colors","aria-label":"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",children:T.jsx(at,{className:"w-5 h-5"})}),T.jsx("button",{type:"button",onClick:()=>K(e=>!e),className:"p-2 rounded-lg text-white hover:bg-white/10 transition-colors","aria-label":"ãƒ¡ãƒ‹ãƒ¥ãƒ¼",title:"ãƒ¡ãƒ‹ãƒ¥ãƒ¼",children:V?T.jsx(ar,{className:"w-6 h-6"}):T.jsx(ht,{className:"w-6 h-6"})})]})]})})}),T.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 transition-colors",children:T.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-2",children:T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.name,"ã•ã‚“ Â·"," ","unified"===Y?"ã™ã¹ã¦ã®è¨˜éŒ²ã‚’ä¸€ç›®ã§ç¢ºèª":"overview"===Y?"ä»Šæ—¥ã®ç·´ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²":"weight"===Y?"ä½“é‡ã®å¤‰åŒ–ã‚’ç®¡ç†":"insights"===Y?"ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ–°ã—ã„ç™ºè¦‹ã‚’":"performance"===Y?"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¸¬å®š":"conditioning"===Y?"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†":"cycle"===Y?"æœˆçµŒå‘¨æœŸã¨ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’è¨˜éŒ²":"nutrition"===Y?"æ „é¤Šï¼šAIä¸‹æ›¸ãâ†’ã‚ãªãŸãŒç¢ºå®š":"gamification"===Y?"ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã€ãƒãƒƒã‚¸ã€ç›®æ¨™ã‚’ç®¡ç†":"è¨­å®šã¨ãŠçŸ¥ã‚‰ã›"]})})}),V&&T.jsxs("div",{className:"fixed inset-0 z-50",onClick:()=>K(!1),children:[T.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50"}),T.jsx("div",{className:"absolute top-20 right-4 bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-72 max-h-[calc(100vh-6rem)] overflow-y-auto",onClick:e=>e.stopPropagation(),children:T.jsxs("div",{className:"p-2",children:[T.jsxs("button",{type:"button",onClick:()=>{G("unified"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("unified"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(it,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ãƒ›ãƒ¼ãƒ "})]}),T.jsxs("button",{type:"button",onClick:()=>{G("weight"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("weight"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(Mt,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ä½“é‡ç®¡ç†"})]}),T.jsxs("button",{type:"button",onClick:()=>{G("conditioning"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("conditioning"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(st,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†"})]}),"female"===ae&&T.jsxs("button",{type:"button",onClick:()=>{G("cycle"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("cycle"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(Ve,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"æœˆçµŒå‘¨æœŸ"})]}),T.jsxs("button",{type:"button",onClick:()=>{G("overview"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("overview"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(be,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ç·´ç¿’è¨˜éŒ²"})]}),Z&&T.jsxs("button",{type:"button",onClick:()=>{G("ftt"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("ftt"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(be,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒã‚§ãƒƒã‚¯ï¼ˆ10ç§’ï¼‰"})]}),X&&T.jsxs("button",{type:"button",onClick:()=>{Q("nutrition"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("nutrition"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(et,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"æ „é¤Š"})]}),T.jsxs("button",{type:"button",onClick:()=>{G("performance"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("performance"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx(nr,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹"})]}),T.jsxs("button",{type:"button",onClick:()=>{G("gamification"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("gamification"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),"data-tutorial":"gamification-tab",children:[T.jsx(Kt,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³"})]}),T.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),T.jsxs("button",{type:"button",onClick:()=>{G("settings"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("settings"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[T.jsx($t,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"è¨­å®š"})]}),T.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),o&&T.jsxs("button",{type:"button",onClick:()=>{K(!1),o()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[T.jsx(at,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ãƒ˜ãƒ«ãƒ—ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«"})]}),n&&T.jsxs("button",{type:"button",onClick:()=>{K(!1),n()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[T.jsx(zt,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼"})]}),l&&T.jsxs("button",{type:"button",onClick:()=>{K(!1),l()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[T.jsx(Xe,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"åˆ©ç”¨è¦ç´„"})]}),i&&T.jsxs("button",{type:"button",onClick:()=>{K(!1),i()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[T.jsx(Ee,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜"})]}),s&&T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),T.jsxs("button",{type:"button",onClick:async()=>{K(!1),await s()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[T.jsx(mt,{className:"w-4 h-4"}),T.jsx("span",{className:"text-sm font-medium",children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]})]})]})})]}),T.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-4 sm:pt-4 sm:pb-8",children:"unified"===Y?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"mb-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-5 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º"}),E?T.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"èª­ã¿è¾¼ã¿ä¸­â€¦"}):M?T.jsx("span",{className:"text-xs text-red-600 dark:text-red-400",children:"å–å¾—ã‚¨ãƒ©ãƒ¼"}):k?T.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:I(k.start_date,k.end_date)}):T.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"æœªè¨­å®š"})]}),E?T.jsxs("div",{className:"mt-3",children:[T.jsx("div",{className:"h-7 w-28 bg-gray-100 dark:bg-gray-700 rounded animate-pulse"}),T.jsxs("div",{className:"mt-3 flex gap-2",children:[T.jsx("div",{className:"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse"}),T.jsx("div",{className:"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse"}),T.jsx("div",{className:"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse"})]}),T.jsx("div",{className:"mt-3 h-4 w-4/5 bg-gray-100 dark:bg-gray-700 rounded animate-pulse"})]}):M?T.jsxs("div",{className:"mt-3 text-sm text-red-700 dark:text-red-300",children:["å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼š",M]}):k?T.jsxs(T.Fragment,{children:[T.jsx("h3",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:$(k.phase_type)}),Array.isArray(k.focus_tags)&&k.focus_tags.length>0&&T.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[k.focus_tags.slice(0,6).map((e,t)=>T.jsx("span",{className:"text-xs px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/15 text-blue-700 dark:text-blue-200",children:e},`${e}-${t}`)),k.focus_tags.length>6&&T.jsxs("span",{className:"text-xs px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:["+",k.focus_tags.length-6]})]}),T.jsx("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-200 line-clamp-2",children:Bt.base})]}):T.jsx("div",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300",children:"ãƒ•ã‚§ãƒ¼ã‚ºãŒæœªè¨­å®šã§ã™ï¼ˆã‚³ãƒ¼ãƒãŒè¨­å®šã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"}),!E&&!M&&Array.isArray(S)&&S.length>0&&T.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ä»Šå¾Œ"}),T.jsx("p",{className:"text-[11px] text-gray-400 dark:text-gray-500",children:"æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«"})]}),T.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1",children:S.slice(0,8).map((e,t)=>T.jsx("div",{className:"min-w-[140px] rounded-lg border border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2",children:T.jsxs("div",{className:"flex items-center justify-between gap-2",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate",children:$(e.phase_type)}),T.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 whitespace-nowrap",children:I(e.start_date,e.end_date)})]})},`${e.start_date}-${e.end_date}-${t}`))})]})]})}),T.jsx(ms,{acwrData:he,weightRecords:ye,sleepRecords:Lt,motivationRecords:Oe,trainingRecords:oe,menstrualCycles:nt,userGender:ie,onOpenDetailView:e=>{"training"===e?G("overview"):"weight"===e?G("weight"):"conditioning"===e?G("conditioning"):"cycle"===e&&"female"===ae&&G("cycle")},onQuickAdd:()=>W(!0)}),X&&T.jsx("div",{className:"mt-6",children:T.jsx("button",{type:"button",onClick:()=>G("nutrition"),className:"w-full text-left","aria-label":"æ „é¤Šã®è©³ç´°ã¸",children:T.jsx("div",{className:"rounded-xl hover:opacity-95 active:opacity-90 transition",children:T.jsx(Ks,{totals:jt,targets:Yt,loading:wt,subtitle:`${sr} Â· ${Bt.nutrition}`})})})}),T.jsx("div",{className:"mt-6",children:T.jsx(fs,{userId:e.id})}),!1,T.jsx("div",{className:"mt-4",children:T.jsx(vs,{userId:e.id,highlight:Ot.length>0})}),T.jsx("div",{className:"mt-6",children:T.jsx(gs,{acwrData:he,weightRecords:ye,sleepRecords:qt,motivationRecords:Oe})}),Ot.length>0&&T.jsx("div",{className:"mt-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(fe,{className:"w-6 h-6 text-red-600 dark:text-red-400 mr-3"}),T.jsxs("div",{className:"flex-1",children:[T.jsx("h3",{className:"font-semibold text-red-900 dark:text-red-200",children:"ç·Šæ€¥æ³¨æ„"}),T.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:"æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚ç·´ç¿’å¼·åº¦ã®èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"})]})]})})]}):"nutrition"===Y?X?T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center h-64",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:T.jsx(Aa,{user:e,date:N,nutritionLogs:vt,nutritionTotals:_t,nutritionLoading:wt,nutritionError:Nt,onBackHome:()=>G("unified"),latestInbody:Qe??null,trainingRecords:oe??[],latestWeightKg:Ce??null,onRefreshNutrition:kt})}):null:"ftt"===Y?Z?T.jsx(aa,{userId:e.id,onBackHome:()=>G("unified")}):null:"overview"===Y?T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[T.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[Ft.length>0&&T.jsx(_r,{alerts:Ft,onViewAll:()=>{}}),T.jsx("div",{className:"mt-3",children:T.jsx(vs,{userId:e.id,highlight:Ot.length>0})}),Ot.length>0&&T.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(fe,{className:"w-6 h-6 text-red-600 mr-3"}),T.jsxs("div",{className:"flex-1",children:[T.jsx("h3",{className:"font-semibold text-red-900",children:"ç·Šæ€¥æ³¨æ„"}),T.jsx("p",{className:"text-sm text-red-700",children:"æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚ç·´ç¿’å¼·åº¦ã®èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"})]})]})}),Wt&&T.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4 transition-colors",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:"ä»Šæ—¥ã®ä½“é‡"}),T.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[Number(Wt.weight_kg).toFixed(1)," kg"]})]}),T.jsx("button",{type:"button",onClick:()=>G("weight"),className:"text-sm text-green-600 dark:text-green-400 hover:underline",children:"ä½“é‡ç®¡ç†ã¸ â†’"})]})}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors","data-tutorial":"training-form",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[T.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"ç·´ç¿’è¨˜éŒ²"}),T.jsx(De,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]}),T.jsx(ks,{daysWithData:Ct,consecutiveDays:Et,weeklyAverage:Dt}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:Bt.training}),T.jsx(fr,{userId:e.id,onSubmit:Xt,onCheckExisting:ce,onUpdate:Qt,loading:de,lastRecord:Tt,weeklyAverage:Dt,daysWithData:Ct,consecutiveDays:Et})]}),pe&&T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"ç¾åœ¨ã®ACWR"}),T.jsx(Vt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 dark:text-gray-500"})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"text-2xl sm:text-3xl font-bold mb-2",style:{color:le(pe.riskLevel)},children:pe.acwr}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:ne(pe.riskLevel??"unknown")}),T.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4 text-sm",children:[T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm",children:"æ€¥æ€§è² è·"}),T.jsx("p",{className:"font-semibold text-sm sm:text-base dark:text-white",children:pe.acuteLoad})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm",children:"æ…¢æ€§è² è·"}),T.jsx("p",{className:"font-semibold text-sm sm:text-base dark:text-white",children:pe.chronicLoad})]})]})]})]})]}),T.jsx("div",{className:"lg:col-span-2",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors","data-tutorial":"acwr-chart",children:[T.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"ACWRæ¨ç§»ã‚°ãƒ©ãƒ•"}),de?T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T.jsx(jr,{data:he,daysWithData:Ct,isDarkMode:ft})]})})]}),T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mt-6 transition-colors",children:T.jsx(kr,{records:oe,onUpdate:er,onDelete:me,loading:de,allowEdit:!0,allowDelete:!0,allowDateEdit:!1,showLimited:!0,limitCount:10})})]}):"weight"===Y?T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[T.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[pe&&T.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 transition-colors",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"ç¾åœ¨ã®ACWR"}),T.jsx("p",{className:"text-2xl font-bold",style:{color:le(pe.riskLevel)},children:pe.acwr}),T.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:ne(pe.riskLevel??"unknown")})]}),T.jsx("button",{type:"button",onClick:()=>G("overview"),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"ç·´ç¿’è¨˜éŒ²ã¸ â†’"})]})}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[T.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ä½“é‡ã‚µãƒãƒªãƒ¼"}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[T.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"ç¾åœ¨ã®ä½“é‡"}),T.jsx("p",{className:"text-2xl font-bold text-blue-700",children:null!==_e()?`${_e().toFixed(1)} kg`:"æœªè¨˜éŒ²"})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"30æ—¥å¤‰åŒ–"}),T.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:null!==Se(30)?T.jsxs(T.Fragment,{children:[Se(30)>0?"+":"",Se(30).toFixed(1)," kg"]}):"-"})]}),T.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"è¨˜éŒ²æ•°"}),T.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:ye.length})]})]})]})]}),tt?T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:T.jsx("div",{className:"flex items-center justify-center h-24",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):rt?T.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:T.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300",children:["InBodyãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š",rt]})}):Qe?T.jsxs("div",{className:"space-y-6",children:[T.jsx(zs,{latest:Qe,loading:tt,error:rt}),T.jsx(Ws,{records:Ze,gender:ae})]}):T.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-6 text-center",children:T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"InBodyãƒ‡ãƒ¼ã‚¿ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"})}),e.height_cm&&Ce&&T.jsx(Rr,{weightKg:Ce,heightCm:e.height_cm,dateOfBirth:e.date_of_birth,gender:ie}),!e.height_cm&&T.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 transition-colors",children:T.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"èº«é•·ã‚’è¨­å®šã™ã‚‹ã¨BMIãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚è¨­å®šã‚¿ãƒ–ã‹ã‚‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚"})}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[T.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"ä½“é‡è¨˜éŒ²"}),T.jsx(Mt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]}),T.jsx(Sr,{onSubmit:we,onCheckExisting:je,onUpdate:Ne,loading:ve,lastRecord:Me})]})]}),T.jsxs("div",{className:"lg:col-span-2",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mb-6 transition-colors",children:[T.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•"}),ve?T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-80",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T.jsx(Cr,{data:ye})]}),T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:T.jsx(Er,{records:ye,onUpdate:Ne,onDelete:ke,loading:ve})})]})]}):"insights"===Y?T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[T.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"ä½“é‡ã¨ACWRã®ç›¸é–¢ã‚°ãƒ©ãƒ•"}),de||ve?T.jsx("div",{className:"flex items-center justify-center h-96",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T.jsx(Dr,{acwrData:he,weightData:ye})]}),T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:T.jsx(Mr,{acwrData:he,weightData:ye})})]}):"performance"===Y?T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center h-64",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:T.jsx(Pa,{user:e,onBackHome:()=>G("unified")})}):"conditioning"===Y?T.jsxs("div",{className:"space-y-6",children:[T.jsx(ds,{latestACWR:pe,sleepHours:(null==(m=Le())?void 0:m.sleep_hours)?Number(Le().sleep_hours):null,sleepQuality:(null==(g=Le())?void 0:g.sleep_quality)??null,motivationLevel:(null==(h=Ge())?void 0:h.motivation_level)??null,energyLevel:(null==(p=Ge())?void 0:p.energy_level)??null,stressLevel:(null==(b=Ge())?void 0:b.stress_level)??null}),T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ç¡çœ è¨˜éŒ²"}),T.jsx(bt,{className:"w-6 h-6 text-indigo-500"})]}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:Bt.sleep}),T.jsx(as,{onSubmit:Ae,onCheckExisting:$e,onUpdate:Ie,loading:Re,lastRecord:It})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç¡çœ æ¨ç§»ã‚°ãƒ©ãƒ•"}),Re?T.jsx("div",{className:"flex items-center justify-center h-96",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):T.jsx(is,{data:Te})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"7æ—¥å¹³å‡ç¡çœ æ™‚é–“"}),T.jsxs("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:[(null==(y=ze(7))?void 0:y.toFixed(1))||"-","h"]})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"7æ—¥å¹³å‡ç¡çœ ã®è³ª"}),T.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[(null==(f=Pe(7))?void 0:f.toFixed(1))||"-","/5"]})]})]})]}),T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²"}),T.jsx(st,{className:"w-6 h-6 text-blue-500"})]}),T.jsx(ls,{onSubmit:Ue,onCheckExisting:Be,onUpdate:He,loading:We,lastRecord:Pt??void 0})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ¨ç§»ã‚°ãƒ©ãƒ•"}),We?T.jsx("div",{className:"flex items-center justify-center h-96",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T.jsx(os,{data:Oe})]}),T.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"å¹³å‡æ„æ¬²"}),T.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[(null==(v=Ke(7))?void 0:v.toFixed(1))||"-","/10"]})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"å¹³å‡ä½“åŠ›"}),T.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[(null==(j=Je(7))?void 0:j.toFixed(1))||"-","/10"]})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"å¹³å‡ã‚¹ãƒˆãƒ¬ã‚¹"}),T.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[(null==(w=Ye(7))?void 0:w.toFixed(1))||"-","/10"]})]})]})]})]}):"cycle"===Y?T.jsx(ha,{userId:e.id,gender:ae}):"gamification"===Y?T.jsx(la,{user:e}):"messages"===Y?T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center h-64",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:T.jsx(za,{userId:e.id,userName:e.name,onClose:()=>G("unified")})}):"settings"===Y?T.jsx($a,{user:e,onOpenProfileEdit:()=>U(!0)}):null}),q&&T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:T.jsx(Ia,{user:e,trainingRecords:oe,acwrData:he,onClose:()=>F(!1)})}),B&&T.jsx(Ar,{user:e,onUpdate:async()=>{await(null==d?void 0:d())},onClose:()=>U(!1)}),T.jsx(Lr,{steps:ss("athlete"),isActive:dt,onComplete:xt,onSkip:gt,currentStepIndex:pt,onStepChange:yt}),O&&T.jsx(xs,{userId:e.id,userGender:ae,onTrainingSubmit:tr,onTrainingCheckExisting:ce,onTrainingUpdate:rr,onWeightSubmit:we,onWeightCheckExisting:je,onWeightUpdate:Ne,onSleepSubmit:Ae,onSleepCheckExisting:$e,onSleepUpdate:Ie,onMotivationSubmit:Ue,onMotivationCheckExisting:Be,onMotivationUpdate:He,onCycleSubmit:lt,onCycleUpdate:ot,onClose:()=>W(!1),lastTrainingRecord:Rt??null,lastWeightRecord:At?{weight_kg:Number(At.weight_kg),date:At.date}:null,lastSleepRecord:It??null,lastMotivationRecord:Pt??null}),"unified"===Y&&T.jsx(hs,{onClick:()=>W(!0),onCameraClick:X?()=>{var e;return null==(e=lr.current)?void 0:e.click()}:void 0}),T.jsx("input",{ref:lr,type:"file",accept:"image/*",className:"absolute -left-[9999px] top-0 w-px h-px opacity-0",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];e.target.value="",r&&ir(r)}}),Ht&&"none"!==Ut.mode&&T.jsx(va,{open:Ht,mode:Ut.mode,daysAway:Ut.daysAway,message:Jt,onClose:()=>Ut.dismiss("close"),onOk:()=>{Ut.dismiss("ok"),W(!0)},okLabel:"OK",closeLabel:"é–‰ã˜ã‚‹"})]})}function qa({athletes:e,onAthleteSelect:t,athleteACWRMap:s={},weekCardMap:a={}}){const[n,l]=r.useState(""),[i,o]=r.useState("all"),[d,c]=r.useState("all"),u=e=>(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||"åå‰æœªè¨­å®š",x=r.useMemo(()=>{const t=n.trim().toLowerCase();return e.filter(e=>{const r=s[e.id],n=(null==r?void 0:r.daysOfData)??("number"==typeof e.training_days_28d?e.training_days_28d:null),l=null!==n&&n>=21&&"number"==typeof(null==r?void 0:r.currentACWR)&&Number.isFinite(r.currentACWR)&&r.currentACWR>0?(null==r?void 0:r.riskLevel)??"unknown":"unknown",o="all"===i||"high"===l,c=a[e.id],x="all"===d||!!(null==c?void 0:c.is_sharing_active),m=`${u(e)}`.toLowerCase(),g=""===t||m.includes(t);return o&&x&&g})},[e,n,i,d,s,a]),m=e=>{switch(e){case"high":return T.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700",children:"é«˜ãƒªã‚¹ã‚¯"});case"caution":return T.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-700",children:"æ³¨æ„"});case"good":return T.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",children:"è‰¯å¥½"});case"low":return T.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-sky-100 text-sky-700",children:"ä½è² è·"});default:return T.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-500",children:"ä¸æ˜"})}},g=e=>{if(!e)return"è¨˜éŒ²ãªã—";const t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){const r=Number(t[2]),s=Number(t[3]);return Number.isFinite(r)&&Number.isFinite(s)?`${r}/${s}`:e}try{const t=new Date(e);return Number.isNaN(t.getTime())?e:`${t.getMonth()+1}/${t.getDate()}`}catch{return e}},h=e=>null==e||Number.isNaN(e)?"-":e.toFixed(1),p=e=>null==e||Number.isNaN(e)?"-":String(Math.round(e)),b=e=>!!(null==e?void 0:e.is_sharing_active)?T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[T.jsx(Jt,{className:"w-3 h-3"}),"å…±æœ‰ON"]}):T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-600 border border-gray-200",children:[T.jsx(ut,{className:"w-3 h-3"}),"å…±æœ‰OFF"]});return T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[T.jsxs("div",{className:"relative flex-1",children:[T.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"åå‰ã§æ¤œç´¢",className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),T.jsx(be,{className:"w-4 h-4 text-gray-400 absolute left-2.5 top-2.5"})]}),T.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[T.jsx("button",{type:"button",onClick:()=>o("all"),className:"px-3 py-1.5 rounded-full text-xs font-medium border "+("all"===i?"bg-green-50 text-green-700 border-green-200":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50"),children:"å…¨å“¡è¡¨ç¤º"}),T.jsxs("button",{type:"button",onClick:()=>o("high"),className:"px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 "+("high"===i?"bg-red-50 text-red-700 border-red-200":"bg-white text-gray-600 border-gray-200 hover:bg-red-50 hover:text-red-700"),children:[T.jsx(fe,{className:"w-3 h-3"}),"é«˜ãƒªã‚¹ã‚¯ã®ã¿"]}),T.jsxs("button",{type:"button",onClick:()=>c("on"===d?"all":"on"),className:"px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 "+("on"===d?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-white text-gray-600 border-gray-200 hover:bg-emerald-50 hover:text-emerald-700"),title:"å…±æœ‰ONã®é¸æ‰‹ã ã‘è¡¨ç¤º",children:[T.jsx(Jt,{className:"w-3 h-3"}),"å…±æœ‰ONã®ã¿"]})]})]}),T.jsx("div",{className:"divide-y divide-gray-100 border border-gray-100 rounded-xl bg-white",children:0===x.length?T.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"æ¡ä»¶ã«åˆã†é¸æ‰‹ãŒã„ã¾ã›ã‚“"}):x.map(e=>{const r=s[e.id],n=(null==r?void 0:r.daysOfData)??("number"==typeof e.training_days_28d?e.training_days_28d:null),l=null!==n&&n>=21&&"number"==typeof(null==r?void 0:r.currentACWR)&&Number.isFinite(r.currentACWR)&&r.currentACWR>0,i=l?(null==r?void 0:r.riskLevel)??"unknown":"unknown",o=l?r.currentACWR.toFixed(2):"æº–å‚™ä¸­",d=null!==n?Math.max(21-n,0):null,c=a[e.id],x=!!(null==c?void 0:c.is_sharing_active),y=!x;return T.jsxs("button",{type:"button",onClick:()=>{y||t(e)},disabled:y,className:"w-full flex items-stretch justify-between px-4 sm:px-5 py-3 sm:py-4 text-left transition-colors "+(y?"opacity-60 cursor-not-allowed bg-white":"hover:bg-gray-50"),title:y?"ã“ã®é¸æ‰‹ã¯ç¾åœ¨ã€å…±æœ‰ãŒOFFã§ã™ï¼ˆğŸ”’ï¼‰":"è©³ç´°ã‚’é–‹ã",children:[T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[T.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:u(e)}),e.nickname&&e.name&&T.jsxs("p",{className:"text-xs text-gray-400 truncate",children:["(",e.name,")"]}),b(c)]}),T.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-[11px] sm:text-xs text-gray-500",children:[T.jsxs("span",{children:["ç›´è¿‘28æ—¥ï¼š ",e.training_days_28d??0,"æ—¥ / ",e.training_sessions_28d??0,"å›"]}),T.jsxs("span",{children:["æœ€çµ‚å…¥åŠ›ï¼š ",g(e.last_training_date??null)]})]}),x&&c&&T.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] sm:text-xs",children:[c.action_total>0?T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:[T.jsx(Te,{className:"w-3 h-3"}),"è¡Œå‹• ",c.action_done,"/",c.action_total]}):T.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-50 text-gray-600 border border-gray-200",children:"è¡Œå‹• -"}),T.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200",children:["ç¡çœ  ",h(c.sleep_hours_avg),"h / è³ª ",h(c.sleep_quality_avg)]}),T.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:["ãƒ¢ãƒ ",p(c.motivation_avg),"ãƒ»ã‚¨ãƒ ",p(c.energy_avg),"ãƒ»ã‚¹ãƒˆ ",p(c.stress_avg)]})]}),!x&&T.jsx("div",{className:"mt-2 text-[11px] sm:text-xs text-gray-500",children:"ğŸ”’ å…±æœ‰ãŒOFFã®ãŸã‚ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã¯è¡¨ç¤ºã§ãã¾ã›ã‚“"})]}),T.jsxs("div",{className:"flex flex-col items-end justify-center ml-4",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[T.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500",children:"ACWR"}),T.jsx("span",{className:"text-sm sm:text-base font-semibold "+(l?"text-gray-900":"text-gray-400"),children:o})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[m(i),T.jsx(ze,{className:"w-4 h-4 text-gray-300"})]}),!l&&T.jsxs("p",{className:"mt-1 text-[10px] sm:text-xs text-gray-400 text-right",children:["ACWRæº–å‚™ï¼š",n??0,"/",21,"æ—¥",null!==d&&d>0?`ï¼ˆã‚ã¨${d}æ—¥ï¼‰`:""]})]})]},e.id)})})]})}const Fa=e=>Array.from(new Set(e)).slice(0,2),Oa={high:3,caution:2,low:1};function Wa(e){const{id:t,name:r,acwrInfo:s,weekCard:a,noData:n}=e,l=!!(null==a?void 0:a.is_sharing_active),i=(null==s?void 0:s.currentACWR)??null,o=(null==a?void 0:a.sleep_hours_avg)??null,d=(null==n?void 0:n.daysSinceLast)??null,c=[];let u=!1;if(null!=d&&d>=14&&(u=!0,c.push("æœªå…¥åŠ›")),l&&"number"==typeof i&&i>=1.5&&(u=!0,c.push("è² è·æ€¥å¢—")),l&&"number"==typeof o&&o<=5&&(u=!0,c.push("ç¡çœ â†“")),u)return{id:t,name:r,riskLevel:"high",reasons:Fa(c),acwr:i};let x=!1;return null!=d&&d>=7&&(x=!0,c.push("æœªå…¥åŠ›")),l&&"number"==typeof i&&i>=1.3&&(x=!0,c.push("è² è·ã‚„ã‚„é«˜")),l&&"number"==typeof o&&o<=5.5&&(x=!0,c.push("ç¡çœ â†“")),x?{id:t,name:r,riskLevel:"caution",reasons:Fa(c),acwr:i}:{id:t,name:r,riskLevel:"low",reasons:[],acwr:i}}function Ba(e){switch(e){case"high":return"bg-red-50 text-red-700 border-red-200";case"caution":return"bg-amber-50 text-amber-700 border-amber-200";case"low":return"bg-emerald-50 text-emerald-700 border-emerald-200";default:return"bg-gray-50 text-gray-500 border-gray-200"}}function Ua(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"low":return"å®‰å®š";default:return"ä¸æ˜"}}function Ha(e){const t=e.reasons||[],r=t.includes("æœªå…¥åŠ›"),s=t.includes("è² è·æ€¥å¢—")||t.includes("è² è·ã‚„ã‚„é«˜"),a=t.includes("ç¡çœ â†“");return"high"===e.riskLevel?[r?"å…¥åŠ›ãŒæ­¢ã¾ã£ã¦ã„ã‚‹ç†ç”±ã‚’ç¢ºèªï¼ˆä½“èª¿/å¿™ã—ã•/å…¥åŠ›å°ç·šï¼‰":"ä¸»è¦³ç–²åŠ´ãƒ»ç—›ã¿ãƒ»é•å’Œæ„Ÿã®æœ‰ç„¡ã‚’ç¢ºèª",s?"ç·´ç¿’å¾ŒRPEã®ç¢ºèªï¼‹æ¬¡å›ã¯å¼·åº¦oré‡ã‚’ä¸€æ®µè½ã¨ã™æ¤œè¨":"ä»Šæ—¥ã€œæ˜æ—¥ã®å›å¾©æŒ‡æ¨™ï¼ˆç¡çœ /é£Ÿæ¬²/æ°—åˆ†ï¼‰ã‚’ç¢ºèª",a?"ä»Šå¤œã®ç¡çœ ç¢ºä¿ï¼ˆå°±å¯æ™‚åˆ»ã®ææ¡ˆãƒ»ã‚¹ãƒãƒ›/ã‚«ãƒ•ã‚§ã‚¤ãƒ³ï¼‰":"48æ™‚é–“ã®çµŒéè¦³å¯Ÿï¼ˆç—‡çŠ¶ãŒã‚ã‚Œã°ç·´ç¿’å†…å®¹èª¿æ•´ï¼‰"]:"caution"===e.riskLevel?[s?"æ¬¡å›ã®è² è·ã‚’å¾®èª¿æ•´ï¼ˆé‡/å¼·åº¦ã®ã©ã¡ã‚‰ã‹ã‚’è»½ãï¼‰":"å›å¾©çŠ¶æ³ã‚’ä¸€è¨€ãƒ’ã‚¢ãƒªãƒ³ã‚°",a?"ç¡çœ ã®ç¢ºä¿ï¼ˆæœ€ä½6hç›®æ¨™ã€å°±å¯å‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ï¼‰":"ç·´ç¿’å¾Œã®ãƒªã‚«ãƒãƒªãƒ¼ï¼ˆè£œé£Ÿ/å…¥æµ´/ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‰ã‚’ä¿ƒã™",r?"å…¥åŠ›ã®ç¿’æ…£ã¥ã‘ï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°å›ºå®šï¼šç·´ç¿’å¾Œ/å°±å¯å‰ãªã©ï¼‰":"çŠ¶æ…‹ãŒä¸Šå‘ã‘ã°é€šå¸¸é‹ç”¨ã¸"]:["çŠ¶æ…‹ã¯å®‰å®šã€‚è‰¯ã„ç¿’æ…£ã‚’ç¶™ç¶š","è‰¯ã‹ã£ãŸç‚¹ã‚’ä¸€è¨€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆç¶™ç¶šã®å¼·åŒ–ï¼‰","ä»Šé€±ã®ç›®æ¨™ã‚’å†ç¢ºèªã—ã¦é€²ã‚ã‚‹"]}function Va(e){if(!e)return"";if("string"==typeof e){const t=e.includes("T")?e.split("T")[0]:e;if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t}const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}function Ka(e){const t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return e||"";const r=Number(t[2]),s=Number(t[3]);return Number.isFinite(r)&&Number.isFinite(s)?`${r}/${s}`:e}function Ja(e){return null!=e&&Number.isFinite(e)?e>0?{arrow:"â†‘",tone:"text-red-600"}:e<0?{arrow:"â†“",tone:"text-emerald-600"}:{arrow:"â†’",tone:"text-gray-600"}:{arrow:"â€“",tone:"text-gray-500"}}function Ya({athlete:e,onClose:t,risk:s,weekCard:n}){var x;const{records:g,weightRecords:h,acwrData:p,loading:b}=Hr(e.id),[v,j]=r.useState("overview"),w=p.length>0?p[p.length-1]:null,N=g.slice(-7),k=p.length>=2?p[p.length-2]:null,_=null!=(null==w?void 0:w.acwr)&&Number.isFinite(Number(w.acwr))?Number(w.acwr):null,S=null!=(null==k?void 0:k.acwr)&&Number.isFinite(Number(k.acwr))?Number(k.acwr):null,C=null!=_&&null!=S?_-S:null,E=Ja(C),D=r.useMemo(()=>(Array.isArray(h)?h:[]).map(e=>{const t=e.weight_kg??e.weight??e.body_weight??null,r=Va(e.date);if(!r)return null;const s=null!=t?Number(t):null;return null!=s&&Number.isFinite(s)?{rawDate:r,date:Ka(r),weight:s}:null}).filter(Boolean),[h]),M=D.length>0?D[D.length-1]:null,R=D.length>=2?D[D.length-2]:null,$=null!=(null==M?void 0:M.weight)&&Number.isFinite(M.weight)?M.weight:null,A=null!=(null==R?void 0:R.weight)&&Number.isFinite(R.weight)?R.weight:null,I=null!=$&&null!=A?$-A:null,z=Ja(I),P=g.slice(-7),L=g.slice(-14,-7),q=e=>e.reduce((e,t)=>{const r=Number(t.rpe??t.session_rpe),s=Number(t.duration_min??t.duration_minutes??t.duration);return Number.isFinite(r)&&Number.isFinite(s)?e+r*s:e},0),F=P.length>0?q(P):null,O=L.length>0?q(L):null,W=null!=F&&null!=O?F-O:null,B=Ja(W),U=r.useMemo(()=>{if(!Array.isArray(g)||0===g.length)return[];const e={};Array.isArray(p)&&p.forEach(t=>{const r=Va(null==t?void 0:t.date);if(!r)return;const s=t.acwr??t.ACWR??t.value??null,a=null!=s?Number(s):null;null!=a&&Number.isFinite(a)&&(e[r]=a)});const t=g.map(t=>{const r=Va(t.date);if(!r)return null;const s=t.rpe??t.session_rpe??null,a=t.duration_min??t.duration_minutes??t.duration??null,n=null!=s?Number(s):null,l=null!=a?Number(a):null;let i=null;null!=n&&null!=l&&Number.isFinite(n)&&Number.isFinite(l)&&(i=n*l);const o=null!=e[r]?e[r]:null;return null==i&&null==o&&null==n?null:{rawDate:r,date:Ka(r),rpe:null!=n&&Number.isFinite(n)?n:null,load:i,acwr:o}}).filter(Boolean);return t.sort((e,t)=>e.rawDate<t.rawDate?-1:e.rawDate>t.rawDate?1:0),console.log("[AthleteDetailModal] rpeLoadAcwrChartData sample:",t.slice(0,5)),t},[g,p]),H=r.useMemo(()=>{const e=new Map;for(const r of U)e.set(r.rawDate,{...r});for(const r of D){const t=e.get(r.rawDate)??{rawDate:r.rawDate,date:r.date};e.set(r.rawDate,{...t,weight:r.weight,date:t.date??r.date})}const t=Array.from(e.values());return t.sort((e,t)=>e.rawDate<t.rawDate?-1:e.rawDate>t.rawDate?1:0),t},[U,D]);if(b)return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:T.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] flex items-center justify-center",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})});const V=w?Ka(Va(w.date)):"";return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:T.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[T.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[T.jsx(be,{className:"w-5 h-5"}),e.nickname||e.name||"é¸æ‰‹"]}),T.jsx("p",{className:"text-sm text-blue-100 mt-1",children:e.email})]}),T.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:T.jsx(ar,{className:"w-5 h-5"})})]}),s&&T.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 mb-4",children:[T.jsx("div",{className:"flex items-start justify-between gap-3",children:T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${Ba(s.riskLevel)}`,children:Ua(s.riskLevel)}),"number"==typeof s.acwr&&T.jsxs("span",{className:"text-xs text-gray-600",children:["ACWR ",T.jsx("b",{children:s.acwr.toFixed(2)})]}),!1===(null==n?void 0:n.is_sharing_active)&&T.jsx("span",{className:"text-xs px-2 py-1 rounded-full border bg-gray-50 text-gray-600 border-gray-200",children:"ğŸ”’ å…±æœ‰OFF"})]}),(null==(x=s.reasons)?void 0:x.length)>0&&T.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:s.reasons.slice(0,2).map(e=>T.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full border bg-gray-50 text-gray-700 border-gray-200",children:e},e))})]})}),T.jsxs("div",{className:"mt-3 text-sm text-gray-800",children:[T.jsx("div",{className:"font-semibold mb-1",children:"æ¬¡ã®ä¸€æ‰‹"}),T.jsx("ul",{className:"list-disc pl-5 space-y-1",children:Ha(s).map(e=>T.jsx("li",{children:e},e))})]})]}),T.jsx("div",{className:"border-b border-gray-200 px-6 pt-3",children:T.jsxs("div",{className:"flex gap-4 overflow-x-auto text-sm",children:[T.jsx("button",{onClick:()=>j("overview"),className:"pb-3 border-b-2 "+("overview"===v?"border-blue-500 text-blue-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"),children:"æ¦‚è¦"}),T.jsxs("button",{onClick:()=>j("weight"),className:"pb-3 border-b-2 flex items-center gap-1 "+("weight"===v?"border-green-500 text-green-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"),children:[T.jsx(Mt,{className:"w-4 h-4"}),"ä½“é‡æ¨ç§»"]}),T.jsxs("button",{onClick:()=>j("rpe"),className:"pb-3 border-b-2 flex items-center gap-1 "+("rpe"===v?"border-purple-500 text-purple-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"),children:[T.jsx(Ne,{className:"w-4 h-4"}),"RPE / è² è· / ACWR"]})]})}),T.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:["overview"===v&&T.jsx("div",{className:"space-y-4",children:T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-4",children:[T.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[T.jsx("p",{className:"text-xs text-blue-700 mb-1",children:"æœ€æ–° ACWR"}),T.jsx("p",{className:"text-2xl font-bold text-blue-900",children:null!=(null==w?void 0:w.acwr)?Number(w.acwr).toFixed(2):"--"}),T.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[T.jsx("span",{className:`${E.tone} font-semibold`,children:E.arrow}),T.jsxs("span",{className:"text-gray-600",children:["å‰å›æ¯”ï¼š",T.jsx("b",{className:"ml-1",children:null!=C?`${C>=0?"+":""}${C.toFixed(2)}`:"--"})]})]}),w&&T.jsx("p",{className:"text-xs text-blue-700 mt-1",children:V})]}),T.jsxs("div",{className:"bg-green-50 rounded-xl p-4",children:[T.jsx("p",{className:"text-xs text-green-700 mb-1",children:"ç›´è¿‘7æ—¥é–“ã®è¨˜éŒ²æ•°"}),T.jsx("p",{className:"text-2xl font-bold text-green-900",children:N.length})]}),T.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[T.jsx("p",{className:"text-xs text-gray-700 mb-1",children:"ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°"}),T.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.length})]}),T.jsxs("div",{className:"bg-green-50 rounded-xl p-4",children:[T.jsx("p",{className:"text-xs text-green-700 mb-1",children:"æœ€æ–° ä½“é‡"}),T.jsx("p",{className:"text-2xl font-bold text-green-900",children:null!=$?$.toFixed(1):"--"}),T.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[T.jsx("span",{className:`${z.tone} font-semibold`,children:z.arrow}),T.jsxs("span",{className:"text-gray-600",children:["å‰å›æ¯”ï¼š",T.jsx("b",{className:"ml-1",children:null!=I?`${I>=0?"+":""}${I.toFixed(1)}kg`:"--"})]})]})]}),T.jsxs("div",{className:"bg-purple-50 rounded-xl p-4",children:[T.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"ç›´è¿‘7æ—¥ Load"}),T.jsx("p",{className:"text-2xl font-bold text-purple-900",children:null!=F?Math.round(F):"--"}),T.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[T.jsx("span",{className:`${B.tone} font-semibold`,children:B.arrow}),T.jsxs("span",{className:"text-gray-600",children:["å‰é€±æ¯”ï¼š",T.jsx("b",{className:"ml-1",children:null!=W?`${W>=0?"+":""}${Math.round(W)}`:"--"})]})]})]})]})}),"weight"===v&&T.jsxs("div",{className:"space-y-4",children:[T.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[T.jsx(Mt,{className:"w-4 h-4 text-green-500"}),"ä½“é‡æ¨ç§» ï¼‹ è² è·ï¼ˆRPEÃ—æ™‚é–“ï¼‰"]}),T.jsxs("p",{className:"text-xs text-gray-500",children:["ä½“é‡ï¼š",D.length,"ä»¶ / ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ï¼š",U.length,"ä»¶"]}),0===H.length?T.jsx("p",{className:"text-sm text-gray-500",children:"ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚"}):T.jsx("div",{className:"h-72",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(f,{data:H,children:[T.jsx(l,{strokeDasharray:"3 3"}),T.jsx(i,{dataKey:"date"}),T.jsx(o,{yAxisId:"left",orientation:"left",tick:{fontSize:12},tickFormatter:e=>`${Math.round(e)}`}),T.jsx(o,{yAxisId:"right",orientation:"right",tick:{fontSize:12},tickFormatter:e=>`${e.toFixed(1)}`}),T.jsx(d,{formatter:(e,t)=>"number"!=typeof e?e:"ä½“é‡"===t?[e.toFixed(1),t]:[Math.round(e),t]}),T.jsx(m,{}),T.jsx(y,{yAxisId:"left",dataKey:"load",name:"è² è·ï¼ˆRPEÃ—æ™‚é–“ï¼‰",fill:"#60a5fa",opacity:.85}),T.jsx(u,{yAxisId:"right",type:"monotone",dataKey:"weight",name:"ä½“é‡",stroke:"#22c55e",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0})]})})}),T.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["ãƒ»é’ã„æ£’ï¼šè² è·ï¼ˆRPEÃ—æ™‚é–“ or loadã‚«ãƒ©ãƒ ï¼‰",T.jsx("br",{}),"ãƒ»ç·‘ã®ç·šï¼šä½“é‡ï¼ˆkgï¼‰",T.jsx("br",{}),"â€» æ—¥ä»˜ã¯YYYY-MM-DDã‚’æ–‡å­—åˆ—å‡¦ç†ã—ã¦ã„ã‚‹ã®ã§ã€JSTã§ã‚‚ã‚ºãƒ¬ã¾ã›ã‚“ã€‚"]})]}),"rpe"===v&&T.jsxs("div",{className:"space-y-4",children:[T.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[T.jsx(Ne,{className:"w-4 h-4 text-purple-500"}),"RPEãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³è² è·ãƒ»ACWR"]}),T.jsxs("p",{className:"text-xs text-gray-500",children:["ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ï¼š",U.length," ä»¶"]}),0===U.length?T.jsx("p",{className:"text-sm text-gray-500",children:"RPE ã¾ãŸã¯ç·´ç¿’æ™‚é–“ãŒè¨˜éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚"}):T.jsx("div",{className:"h-72",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(f,{data:U,children:[T.jsx(l,{strokeDasharray:"3 3"}),T.jsx(i,{dataKey:"date"}),T.jsx(o,{yAxisId:"left",orientation:"left",tick:{fontSize:12},tickFormatter:e=>`${Math.round(e)}`}),T.jsx(o,{yAxisId:"right",orientation:"right",tick:{fontSize:12},domain:[0,10],tickFormatter:e=>e.toFixed(1)}),T.jsx(d,{formatter:(e,t)=>"number"!=typeof e?e:"ACWR"===t?[e.toFixed(2),t]:"RPE"===t?[e.toFixed(1),t]:[Math.round(e),t]}),T.jsx(m,{}),T.jsx(y,{yAxisId:"left",dataKey:"load",name:"è² è·ï¼ˆRPEÃ—æ™‚é–“ï¼‰",fill:"#60a5fa",opacity:.85}),T.jsx(u,{yAxisId:"right",type:"monotone",dataKey:"rpe",name:"RPE",stroke:"#f97316",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0}),T.jsx(u,{yAxisId:"right",type:"monotone",dataKey:"acwr",name:"ACWR",stroke:"#a855f7",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0}),T.jsx(c,{yAxisId:"right",y:.8,stroke:"#22c55e",strokeDasharray:"4 4",ifOverflow:"extendDomain"}),T.jsx(c,{yAxisId:"right",y:1.3,stroke:"#f97316",strokeDasharray:"4 4",ifOverflow:"extendDomain"})]})})}),T.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["ãƒ»æ£’ï¼šè² è·ï¼ˆRPE Ã— ç·´ç¿’æ™‚é–“ or loadï¼‰",T.jsx("br",{}),"ãƒ»ã‚ªãƒ¬ãƒ³ã‚¸ï¼šRPEï¼ˆå³è»¸ï¼‰",T.jsx("br",{}),"ãƒ»ç´«ï¼šACWRï¼ˆå³è»¸ï¼‰"]})]})]})]})})}const Ga=e=>e.averageRPE??e.avg_rpe??e.rpe_avg??null,Za=e=>e.averageLoad??e.avg_load??e.load_avg??null;function Xa({showRPE:e,showLoad:t,onToggle:r}){return T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:"hidden sm:inline text-xs text-gray-500 mr-1",children:"å³è»¸ã®è¡¨ç¤º"}),T.jsxs("button",{type:"button",onClick:()=>r("rpe"),className:["inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold","shadow-sm transition","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",e?"bg-white border-blue-200 text-blue-700":"bg-gray-50 border-gray-200 text-gray-500 hover:bg-white"].join(" "),"aria-pressed":e,children:[T.jsx("span",{className:["inline-flex h-5 w-9 items-center rounded-full p-0.5 transition",e?"bg-blue-600":"bg-gray-300"].join(" "),children:T.jsx("span",{className:["h-4 w-4 rounded-full bg-white shadow transition",e?"translate-x-4":"translate-x-0"].join(" ")})}),"å¹³å‡RPE"]}),T.jsxs("button",{type:"button",onClick:()=>r("load"),className:["inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold","shadow-sm transition","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",t?"bg-white border-emerald-200 text-emerald-700":"bg-gray-50 border-gray-200 text-gray-500 hover:bg-white"].join(" "),"aria-pressed":t,children:[T.jsx("span",{className:["inline-flex h-5 w-9 items-center rounded-full p-0.5 transition",t?"bg-emerald-600":"bg-gray-300"].join(" "),children:T.jsx("span",{className:["h-4 w-4 rounded-full bg-white shadow transition",t?"translate-x-4":"translate-x-0"].join(" ")})}),"å¹³å‡Load"]})]})}function Qa({data:e,teamName:t,showAvgRPE:s=!0,showAvgLoad:x=!1}){const[g,h]=r.useState("month"),[p,b]=r.useState(s),[y,f]=r.useState(x),v=r.useMemo(()=>{if(!e||0===e.length)return[];const t=new Date;let r;switch(g){case"week":r=new Date(t),r.setDate(t.getDate()-7);break;case"month":r=new Date(t),r.setDate(t.getDate()-30);break;case"quarter":r=new Date(t),r.setDate(t.getDate()-90);break;default:return e}return e.filter(e=>{const s=new Date(e.date);return s>=r&&s<=t})},[e,g]),j=r.useMemo(()=>(v||[]).map(e=>({...e,avgRPE:Ga(e),avgLoad:Za(e)})),[v]),w=r.useMemo(()=>(j||[]).filter(e=>!(!e||"string"!=typeof e.date)&&!("number"!=typeof e.averageACWR||!Number.isFinite(e.averageACWR))).map(e=>({...e,averageACWR:Math.max(0,e.averageACWR),avgRPE:"number"==typeof e.avgRPE&&Number.isFinite(e.avgRPE)?e.avgRPE:null,avgLoad:"number"==typeof e.avgLoad&&Number.isFinite(e.avgLoad)?e.avgLoad:null})),[j]),N=r.useMemo(()=>w.some(e=>"number"==typeof e.avgRPE),[w]),k=r.useMemo(()=>w.some(e=>"number"==typeof e.avgLoad),[w]),_=!!p&&N,S=!!y&&k,C=_||S;if(!e||0===e.length)return T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:T.jsxs("div",{className:"text-center px-4",children:[T.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-sm",children:"é¸æ‰‹ã®ç·´ç¿’è¨˜éŒ²ãŒè“„ç©ã•ã‚Œã‚‹ã¨å¹³å‡ACWRãŒè¡¨ç¤ºã•ã‚Œã¾ã™"})]})});if(0===w.length)return T.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:T.jsxs("div",{className:"text-center px-4",children:[T.jsx("p",{className:"text-base sm:text-lg mb-2",children:"æœ‰åŠ¹ãªACWRãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-sm",children:"ï¼ˆä¸æ­£ãªæ•°å€¤ãƒ»æ¬ æãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–ã—ã¾ã—ãŸï¼‰"})]})});const E=e=>{const t=new Date(e),r=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][t.getDay()];return`${t.getMonth()+1}/${t.getDate()}(${r})`},D=({active:e,payload:t,label:r})=>{var s;if(e&&t&&t.length){const e=null==(s=null==t?void 0:t[0])?void 0:s.payload,a=new Date(r),n=0===a.getDay()||6===a.getDay(),l=null==e?void 0:e.averageACWR,i=null==e?void 0:e.avgRPE,o=null==e?void 0:e.avgLoad;return T.jsxs("div",{className:"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs",children:[T.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[T.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base",children:E(r)}),n&&T.jsx("span",{className:"bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-medium",children:"é€±æœ«"})]}),T.jsxs("div",{className:"space-y-1 text-xs sm:text-sm",children:[T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"å¹³å‡ACWR:"}),T.jsx("span",{className:"font-semibold",style:{color:le(null==e?void 0:e.riskLevel)},children:"number"==typeof l?l.toFixed(2):"-"})]}),_&&T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"å¹³å‡RPE:"}),T.jsx("span",{className:"font-semibold",children:"number"==typeof i?i.toFixed(2):"-"})]}),S&&T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"å¹³å‡Load:"}),T.jsx("span",{className:"font-semibold",children:"number"==typeof o?Math.round(o):"-"})]}),T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"å¹³å‡ã«ä½¿ç”¨:"}),T.jsxs("span",{className:"font-semibold",children:[null==e?void 0:e.athleteCount," / ",(null==e?void 0:e.rosterCount)??"-","å"]})]}),T.jsxs("p",{className:"flex justify-between",children:[T.jsx("span",{children:"ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«:"}),T.jsx("span",{className:"font-semibold",style:{color:le(null==e?void 0:e.riskLevel)},children:en(null==e?void 0:e.riskLevel)})]})]})]})}return null},M=e=>{const{cx:t,cy:r,payload:s}=e;if(t&&r&&s){const e=new Date(s.date),a=0===e.getDay()||6===e.getDay();return T.jsx("circle",{cx:t,cy:r,r:a?5:4,fill:le(s.riskLevel),strokeWidth:2,stroke:a?"#8B5CF6":"white",opacity:a?.9:1})}return null};return T.jsxs("div",{className:"w-full",children:[T.jsxs("div",{className:"mb-4 space-y-4",children:[T.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[T.jsxs("div",{children:[T.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 truncate",children:[T.jsxs("span",{className:"hidden sm:inline",children:[t," - "]}),"ãƒãƒ¼ãƒ å¹³å‡ACWRæ¨ç§»"]}),T.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:["å·¦è»¸ï¼šACWR",C?" / å³è»¸ï¼šRPEãƒ»Load":""]})]}),T.jsx(Xa,{showRPE:p,showLoad:y,onToggle:e=>{"rpe"===e&&b(e=>!e),"load"===e&&f(e=>!e)}})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),T.jsx("div",{className:"flex space-x-1",children:[{value:"week",label:"1é€±é–“"},{value:"month",label:"1ãƒ¶æœˆ"},{value:"quarter",label:"3ãƒ¶æœˆ"},{value:"all",label:"å…¨æœŸé–“"}].map(e=>T.jsx("button",{onClick:()=>h(e.value),className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors "+(g===e.value?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))})]}),T.jsx("div",{className:"bg-purple-50 rounded-lg p-3",children:T.jsxs("div",{className:"flex items-center justify-between text-sm",children:[T.jsxs("div",{className:"flex items-center space-x-4",children:[T.jsxs("div",{children:[T.jsx("span",{className:"text-purple-600 font-medium",children:"è¡¨ç¤ºæœŸé–“:"}),T.jsx("span",{className:"text-purple-800 ml-1",children:"week"===g?"éå»7æ—¥é–“":"month"===g?"éå»30æ—¥é–“":"quarter"===g?"éå»90æ—¥é–“":"å…¨æœŸé–“"})]}),T.jsxs("div",{children:[T.jsx("span",{className:"text-purple-600 font-medium",children:"ãƒ‡ãƒ¼ã‚¿æ•°:"}),T.jsxs("span",{className:"text-purple-800 ml-1",children:[w.length,"æ—¥"]})]})]}),T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full border-2 border-purple-600"}),T.jsx("span",{className:"text-xs text-purple-600",children:"é€±æœ«ã¯ç´«ã®æ ã§å¼·èª¿"})]})]})}),p&&!N||y&&!k?T.jsx("div",{className:"text-xs bg-amber-50 border border-amber-200 text-amber-800 rounded-lg px-3 py-2",children:"è¡¨ç¤ºONã®æŒ‡æ¨™ãŒãƒ‡ãƒ¼ã‚¿ã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆå¹³å‡RPE/å¹³å‡Loadã®åˆ—ãŒæœªå–å¾—ã®å¯èƒ½æ€§ï¼‰ã€‚"}):null]}),T.jsx("div",{className:"h-64 sm:h-96",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:w,margin:{top:20,right:36,left:20,bottom:20},children:[T.jsx(l,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),T.jsx(i,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},stroke:"#6b7280",fontSize:10,interval:"preserveStartEnd"}),T.jsx(o,{yAxisId:"acwr",domain:[0,e=>Number.isFinite(e)?e+.5:2],stroke:"#6b7280",fontSize:10,width:40}),T.jsx(o,{yAxisId:"aux",orientation:"right",domain:[0,e=>Number.isFinite(e)?e:10],stroke:"#6b7280",fontSize:10,width:40,hide:!C}),T.jsx(d,{content:T.jsx(D,{})}),T.jsx(m,{}),T.jsx(c,{yAxisId:"acwr",y:1.5,stroke:"#EF4444",strokeDasharray:"5 5"}),T.jsx(c,{yAxisId:"acwr",y:1.3,stroke:"#F59E0B",strokeDasharray:"5 5"}),T.jsx(c,{yAxisId:"acwr",y:.8,stroke:"#10B981",strokeDasharray:"5 5"}),T.jsx(u,{type:"monotone",dataKey:"averageACWR",name:"å¹³å‡ACWR",yAxisId:"acwr",stroke:"#8B5CF6",strokeWidth:3,dot:T.jsx(M,{}),activeDot:{r:6,stroke:"#8B5CF6",strokeWidth:2,fill:"white"},connectNulls:!0}),_&&T.jsx(u,{type:"monotone",dataKey:"avgRPE",name:"å¹³å‡RPE",yAxisId:"aux",stroke:"#0EA5E9",strokeWidth:2,dot:!1,connectNulls:!0}),S&&T.jsx(u,{type:"monotone",dataKey:"avgLoad",name:"å¹³å‡Load",yAxisId:"aux",stroke:"#22C55E",strokeWidth:2,dot:!1,connectNulls:!0})]})})}),T.jsx("div",{className:"mt-4 flex justify-center",children:T.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs",children:[T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),T.jsx("span",{children:"é«˜ãƒªã‚¹ã‚¯ (>1.5)"})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),T.jsx("span",{children:"æ³¨æ„ (1.3-1.5)"})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),T.jsx("span",{children:"è‰¯å¥½ (0.8-1.3)"})]}),T.jsxs("div",{className:"flex items-center",children:[T.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),T.jsx("span",{children:"ä½è² è· (<0.8)"})]})]})})]})}function en(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"good":return"è‰¯å¥½";case"low":return"ä½è² è·";default:return"ä¸æ˜"}}const tn={high:3,medium:2,low:1};function rn(e){return"high"===e||"medium"===e||"low"===e}function sn(e,t){return tn[t]-tn[e]}function an({alerts:e,onMarkAsRead:t,onDismiss:s,onMarkAllAsRead:a,onClose:n,userRole:l,selectedUserId:i,userNameMap:o={}}){const[d,c]=r.useState("all"),[u,x]=r.useState(!1),[m,g]=r.useState({}),h=e=>{const t=new Date,r=new Date(e),s=Math.floor((t.getTime()-r.getTime())/6e4);if(s<1)return"ãŸã£ãŸä»Š";if(s<60)return`${s}åˆ†å‰`;const a=Math.floor(s/60);if(a<24)return`${a}æ™‚é–“å‰`;return`${Math.floor(a/24)}æ—¥å‰`},p=e=>e.user_id??e.target_user_id??e.athlete_id,b=r.useMemo(()=>e.filter(e=>!(!u&&e.is_dismissed)),[e,u]),y=r.useMemo(()=>i?b.filter(e=>p(e)===i):b,[b,i]),f=r.useMemo(()=>y.filter(e=>!e.is_read&&!e.is_dismissed).length,[y]),v=r.useMemo(()=>y.filter(e=>"high"===e.priority&&!e.is_dismissed).length,[y]),j=r.useMemo(()=>{const e=new Map;for(const r of y){const t=p(r);t&&(e.has(t)||e.set(t,[]),e.get(t).push(r))}const t=[];for(const[r,s]of e.entries()){const e=s.map(e=>rn(e.priority)?e.priority:"low").sort(sn)[0]??"low",a=s.filter(t=>(rn(t.priority)?t.priority:"low")===e).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),n=s.filter(e=>"medium"===(rn(e.priority)?e.priority:"low")).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),l=s.filter(e=>"low"===(rn(e.priority)?e.priority:"low")).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());t.push({userId:r,topPriority:e,topAlerts:a,included:{medium:"high"===e?n:[],low:"low"!==e?l:[]},totalCount:s.length,unreadCount:s.filter(e=>!e.is_read).length})}return t.sort((e,t)=>{var r,s;const a=sn(e.topPriority,t.topPriority);if(0!==a)return a;if(t.unreadCount!==e.unreadCount)return t.unreadCount-e.unreadCount;const n=new Date((null==(r=e.topAlerts[0])?void 0:r.created_at)??0).getTime();return new Date((null==(s=t.topAlerts[0])?void 0:s.created_at)??0).getTime()-n})},[y]),w=r.useMemo(()=>j.filter(e=>"unread"===d?e.unreadCount>0:"high"!==d&&"medium"!==d&&"low"!==d||e.topPriority===d),[j,d]),N=!!i;return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:T.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[T.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-4",children:[T.jsx("div",{className:"bg-blue-500 rounded-full p-3",children:T.jsx(Vt,{className:"w-8 h-8"})}),T.jsxs("div",{children:[T.jsx("h2",{className:"text-2xl font-bold",children:N?"é¸æ‰‹ã‚¢ãƒ©ãƒ¼ãƒˆè©³ç´°":"ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥"}),T.jsxs("p",{className:"text-blue-100",children:[f>0?`${f}ä»¶ã®æœªèª­é€šçŸ¥`:"å…¨ã¦ç¢ºèªæ¸ˆã¿",v>0&&T.jsxs("span",{className:"ml-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs",children:["é«˜å„ªå…ˆåº¦ ",v,"ä»¶"]})]})]})]}),T.jsx("button",{onClick:n,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:T.jsx(ar,{className:"w-6 h-6"})})]})}),T.jsx("div",{className:"bg-gray-50 border-b border-gray-200 p-4",children:T.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-3 sm:space-y-0",children:[T.jsxs("div",{className:"flex flex-wrap items-center space-x-2",children:[T.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),T.jsxs("select",{value:d,onChange:e=>c(e.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[T.jsx("option",{value:"all",children:N?"å…¨ã¦ï¼ˆã“ã®é¸æ‰‹ï¼‰":"å…¨ã¦ï¼ˆé¸æ‰‹å˜ä½ï¼‰"}),T.jsx("option",{value:"unread",children:N?"æœªèª­ã®ã¿ï¼ˆã“ã®é¸æ‰‹ï¼‰":"æœªèª­ã‚ã‚Šï¼ˆé¸æ‰‹ï¼‰"}),T.jsx("option",{value:"high",children:"é«˜ãƒªã‚¹ã‚¯"}),T.jsx("option",{value:"medium",children:"ä¸­ãƒªã‚¹ã‚¯"}),T.jsx("option",{value:"low",children:"ä½ãƒªã‚¹ã‚¯"})]}),T.jsxs("label",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[T.jsx("input",{type:"checkbox",checked:u,onChange:e=>x(e.target.checked),className:"rounded"}),T.jsx("span",{children:"éè¡¨ç¤ºã‚’å«ã‚€"})]})]}),T.jsx("div",{className:"flex space-x-2",children:f>0&&T.jsxs("button",{onClick:a,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center space-x-1",children:[T.jsx($e,{className:"w-4 h-4"}),T.jsx("span",{children:"å…¨ã¦æ—¢èª­"})]})})]})}),T.jsx("div",{className:"overflow-y-auto max-h-[60vh] p-6",children:0===w.length?T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"text-gray-400 mb-4",children:T.jsx(Vt,{className:"w-16 h-16 mx-auto"})}),T.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"unread"===d?"æœªèª­ã®é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“":"é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-gray-600",children:"unread"===d?"å…¨ã¦ã®é€šçŸ¥ã‚’ç¢ºèªæ¸ˆã¿ã§ã™ã€‚":"ã‚·ã‚¹ãƒ†ãƒ ãŒç¶™ç¶šçš„ã«ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚"})]}):T.jsx("div",{className:"space-y-4",children:w.map(e=>{const r=e.topAlerts[0],a=Q(r||{priority:e.topPriority}),n=o[e.userId]??"å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼",i=!!m[e.userId];return T.jsxs("div",{className:`${a.bgColor} ${a.borderColor} border rounded-lg p-4`,children:[T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[T.jsx("span",{className:"text-lg",children:a.icon}),T.jsx("h3",{className:`font-semibold ${a.textColor}`,children:"athlete"!==l?n:null==r?void 0:r.title}),T.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.bgColor} ${a.textColor} border ${a.borderColor}`,children:"high"===e.topPriority?"é«˜ãƒªã‚¹ã‚¯":"medium"===e.topPriority?"ä¸­ãƒªã‚¹ã‚¯":"ä½ãƒªã‚¹ã‚¯"}),e.unreadCount>0&&T.jsxs("span",{className:"ml-1 inline-flex items-center text-xs",children:[T.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full mr-2"}),T.jsxs("span",{className:"text-gray-600",children:["æœªèª­ ",e.unreadCount]})]}),e.included.medium.length+e.included.low.length>0&&T.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["é–¢é€£è¦å›  ",e.included.medium.length+e.included.low.length,"ä»¶"]})]}),T.jsxs("div",{className:"space-y-2",children:[e.topAlerts.slice(0,2).map(e=>T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.bgColor} ${a.textColor} border ${a.borderColor}`,children:ee(e.type)}),T.jsx("span",{className:`font-semibold ${a.textColor}`,children:e.title})]}),T.jsx("p",{className:`${a.textColor} mt-1`,children:e.message}),e.acwr_value&&T.jsx("div",{className:"bg-white bg-opacity-50 rounded p-2 mt-2",children:T.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[T.jsxs("div",{children:[T.jsx("span",{className:"text-gray-600",children:"ACWRå€¤:"}),T.jsx("span",{className:`font-bold ml-1 ${a.textColor}`,children:e.acwr_value})]}),e.threshold_exceeded&&T.jsxs("div",{children:[T.jsx("span",{className:"text-gray-600",children:"é–¾å€¤:"}),T.jsx("span",{className:"font-medium ml-1",children:e.threshold_exceeded})]})]})}),T.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:[T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(Oe,{className:"w-3 h-3"}),T.jsx("span",{children:h(e.created_at)})]}),"athlete"!==l&&T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(er,{className:"w-3 h-3"}),T.jsx("span",{children:n})]})]}),T.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[!e.is_read&&T.jsx("button",{onClick:()=>t(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${a.iconColor}`,title:"æ—¢èª­ã«ã™ã‚‹",children:T.jsx(Ge,{className:"w-4 h-4"})}),!e.is_dismissed&&T.jsx("button",{onClick:()=>s(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${a.iconColor}`,title:"éè¡¨ç¤ºã«ã™ã‚‹",children:T.jsx(Ye,{className:"w-4 h-4"})})]})]},e.id)),e.topAlerts.length>2&&T.jsxs("div",{className:"text-xs text-gray-600",children:["ã»ã‹ ",e.topAlerts.length-2," ä»¶ã®åŒå„ªå…ˆåº¦ã‚¢ãƒ©ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã™"]})]})]}),e.included.medium.length+e.included.low.length>0&&T.jsx("button",{onClick:()=>{return t=e.userId,void g(e=>({...e,[t]:!e[t]}));var t},className:"ml-4 text-gray-700 hover:text-gray-900 flex items-center space-x-1",title:"é–¢é€£è¦å› ã‚’è¡¨ç¤º",children:i?T.jsx(Ae,{className:"w-5 h-5"}):T.jsx(ze,{className:"w-5 h-5"})})]}),e.included.medium.length+e.included.low.length>0&&i&&T.jsxs("div",{className:"mt-4 bg-white bg-opacity-60 rounded-lg p-4",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-3",children:"é–¢é€£è¦å› ï¼ˆå‚è€ƒï¼‰"}),e.included.medium.length>0&&T.jsxs("div",{className:"mb-4",children:[T.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["ä¸­ãƒªã‚¹ã‚¯ï¼ˆ",e.included.medium.length,"ï¼‰"]}),T.jsx("div",{className:"space-y-3",children:e.included.medium.map(e=>{const r=Q(e);return T.jsxs("div",{className:`${r.bgColor} ${r.borderColor} border rounded p-3`,children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("span",{className:"text-base",children:r.icon}),T.jsx("span",{className:`text-sm font-semibold ${r.textColor}`,children:e.title}),T.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.bgColor} ${r.textColor} border ${r.borderColor}`,children:ee(e.type)})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[!e.is_read&&T.jsx("button",{onClick:()=>t(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"æ—¢èª­ã«ã™ã‚‹",children:T.jsx(Ge,{className:"w-4 h-4"})}),!e.is_dismissed&&T.jsx("button",{onClick:()=>s(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"éè¡¨ç¤ºã«ã™ã‚‹",children:T.jsx(Ye,{className:"w-4 h-4"})})]})]}),T.jsx("p",{className:`${r.textColor} mt-2 text-sm`,children:e.message}),T.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mt-2",children:[T.jsx(Oe,{className:"w-3 h-3"}),T.jsx("span",{children:h(e.created_at)})]})]},e.id)})})]}),e.included.low.length>0&&T.jsxs("div",{children:[T.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["ä½ãƒªã‚¹ã‚¯ï¼ˆ",e.included.low.length,"ï¼‰"]}),T.jsx("div",{className:"space-y-3",children:e.included.low.map(e=>{const r=Q(e);return T.jsxs("div",{className:`${r.bgColor} ${r.borderColor} border rounded p-3`,children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("span",{className:"text-base",children:r.icon}),T.jsx("span",{className:`text-sm font-semibold ${r.textColor}`,children:e.title}),T.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.bgColor} ${r.textColor} border ${r.borderColor}`,children:ee(e.type)})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[!e.is_read&&T.jsx("button",{onClick:()=>t(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"æ—¢èª­ã«ã™ã‚‹",children:T.jsx(Ge,{className:"w-4 h-4"})}),!e.is_dismissed&&T.jsx("button",{onClick:()=>s(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"éè¡¨ç¤ºã«ã™ã‚‹",children:T.jsx(Ye,{className:"w-4 h-4"})})]})]}),T.jsx("p",{className:`${r.textColor} mt-2 text-sm`,children:e.message}),T.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mt-2",children:[T.jsx(Oe,{className:"w-3 h-3"}),T.jsx("span",{children:h(e.created_at)})]})]},e.id)})})]})]})]},e.userId)})})}),T.jsx("div",{className:"bg-gray-50 border-t border-gray-200 p-4",children:T.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[T.jsxs("div",{children:["è¡¨ç¤ºä¸­: ",w.length,N?"ï¼ˆã“ã®é¸æ‰‹ï¼‰":"äºº"," / å¯¾è±¡: ",j.length,N?"":"äºº","ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆç·æ•°: ",y.length,"ä»¶ï¼‰"]}),T.jsxs("div",{className:"flex items-center space-x-4",children:[T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("div",{className:"w-3 h-3 bg-red-100 border border-red-200 rounded"}),T.jsx("span",{children:"é«˜å„ªå…ˆåº¦"})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("div",{className:"w-3 h-3 bg-yellow-100 border border-yellow-200 rounded"}),T.jsx("span",{children:"ä¸­å„ªå…ˆåº¦"})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-200 rounded"}),T.jsx("span",{children:"ä½å„ªå…ˆåº¦"})]})]})]})})]})})}const nn=Object.freeze(Object.defineProperty({__proto__:null,AlertPanel:an},Symbol.toStringTag,{value:"Module"}));class ln extends x.Component{constructor(){super(...arguments),t(this,"state",{hasError:!1,message:""})}static getDerivedStateFromError(e){return{hasError:!0,message:String((null==e?void 0:e.message)||e)}}componentDidCatch(e){console.error(`[ChartErrorBoundary] ${this.props.name}`,e)}render(){return this.state.hasError?T.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:["ãƒãƒ£ãƒ¼ãƒˆæç”»ã‚¨ãƒ©ãƒ¼ï¼š",this.props.name,T.jsx("div",{className:"text-xs mt-1 opacity-80",children:this.state.message})]}):this.props.children}}const on=e=>{if(null==e)return null;const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null},dn=e=>new Date(e.toLocaleString("en-US",{timeZone:"Asia/Tokyo"})).toISOString().slice(0,10);const cn={async getUserOrganizations(e){const{data:t,error:r}=await z.rpc("get_user_organizations",{user_uuid:e});if(r)throw r;return t},async getOrganizationHierarchy(e){const{data:t,error:r}=await z.rpc("get_organization_hierarchy",{org_id:e});if(r)throw r;return t},async getOrganizations(){const{data:e,error:t}=await z.from("organizations").select("*").order("name");if(t)throw console.error("Organizations query error:",{message:t.message,details:t.details,hint:t.hint,code:t.code}),new Error(`Failed to load organizations: ${t.message} (${t.code})`);return e},async getOrganizationById(e){const{data:t,error:r}=await z.from("organizations").select("*").eq("id",e).maybeSingle();if(r)throw r;return t},async createOrganization(e){const{data:t,error:r}=await z.from("organizations").insert(e).select().single();if(r)throw r;return t},async updateOrganization(e,t){const{data:r,error:s}=await z.from("organizations").update(t).eq("id",e).select().single();if(s)throw s;return r},async deleteOrganization(e){const{error:t}=await z.from("organizations").delete().eq("id",e);if(t)throw t},async getOrganizationTeams(e){const{data:t,error:r}=await z.from("teams").select("*").eq("organization_id",e).order("name");if(r)throw console.error("Organization teams query error:",{message:r.message,details:r.details,hint:r.hint,code:r.code}),new Error(`Failed to load organization teams: ${r.message}`);return t},async getTeamById(e){const{data:t,error:r}=await z.from("teams").select("*").eq("id",e).maybeSingle();if(r)throw r;return t},async createTeam(e){const t={name:e.name,organization_id:e.organization_id,department_id:e.department_id};console.log("Creating team with data:",t);const{data:r,error:s}=await z.from("teams").insert(t).select().single();if(s)throw console.error("Team creation error:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),s;return console.log("Team created successfully:",r),r},async updateTeam(e,t){const{data:r,error:s}=await z.from("teams").update(t).eq("id",e).select().single();if(s)throw s;return r},async deleteTeam(e){const{error:t}=await z.from("teams").delete().eq("id",e);if(t)throw t},async getOrganizationMembers(e){const{data:t,error:r}=await z.from("organization_members").select("\n        *,\n        users:user_id (\n          id,\n          user_id,\n          name,\n          email,\n          role\n        )\n      ").eq("organization_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async addOrganizationMember(e){const{data:t,error:r}=await z.from("organization_members").insert(e).select().single();if(r)throw r;return t},async updateOrganizationMemberRole(e,t){const{data:r,error:s}=await z.from("organization_members").update({role:t}).eq("id",e).select().single();if(s)throw s;return r},async removeOrganizationMember(e){const{error:t}=await z.from("organization_members").delete().eq("id",e);if(t)throw t},async getOrganizationStats(){const{data:e,error:t}=await z.from("organization_stats").select("*").order("name");if(t)throw t;return e},async checkOrphanedRecords(){const{data:e,error:t}=await z.rpc("check_orphaned_records");if(t)throw t;return e},async assignTeamToOrganization(e,t){const{data:r,error:s}=await z.from("teams").update({organization_id:t}).eq("id",e).select().single();if(s)throw s;return r}};function un(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{e?o():n(!1)},[e]);const o=async()=>{var e,t;try{n(!0),i(null);const{data:{session:r}}=await(await A(async()=>{const{supabase:e}=await Promise.resolve().then(()=>L);return{supabase:e}},void 0)).supabase.auth.getSession();console.log("Auth state when loading organizations:",{hasSession:!!r,userId:null==(e=null==r?void 0:r.user)?void 0:e.id,email:null==(t=null==r?void 0:r.user)?void 0:t.email});const a=await cn.getOrganizations();console.log("Organizations loaded successfully:",a.length),s(a)}catch(r){const e=r instanceof Error?r.message:"Failed to load organizations";i(e),console.error("Error loading organizations:",{error:r,message:e,stack:r instanceof Error?r.stack:void 0})}finally{n(!1)}};return{organizations:t,loading:a,error:l,createOrganization:async(e,t)=>{try{const r=await cn.createOrganization({name:e,description:t||""});return s(e=>[...e,r].sort((e,t)=>e.name.localeCompare(t.name))),r}catch(r){const e=r instanceof Error?r.message:"Failed to create organization";throw i(e),new Error(e)}},updateOrganization:async(e,t)=>{try{const r=await cn.updateOrganization(e,t);return s(t=>t.map(t=>t.id===e?r:t).sort((e,t)=>e.name.localeCompare(t.name))),r}catch(r){const e=r instanceof Error?r.message:"Failed to update organization";throw i(e),new Error(e)}},deleteOrganization:async e=>{try{await cn.deleteOrganization(e),s(t=>t.filter(t=>t.id!==e))}catch(t){const e=t instanceof Error?t.message:"Failed to delete organization";throw i(e),new Error(e)}},reload:o}}function xn(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null),o=r.useCallback(async()=>{if(e)try{n(!0),i(null);const t=await cn.getOrganizationTeams(e);console.log("Teams loaded:",t),s(t)}catch(t){i(t instanceof Error?t.message:"Failed to load teams"),console.error("Error loading teams:",t)}finally{n(!1)}},[e]);r.useEffect(()=>{if(!e)return s([]),void n(!1);o()},[e,o]);return{teams:t,loading:a,error:l,createTeam:async t=>{if(!e)throw new Error("Organization ID is required");try{const r=await cn.createTeam({organization_id:e,name:t});return console.log("New team created, reloading teams..."),await o(),console.log("Teams reloaded after creation"),r}catch(r){const e=r instanceof Error?r.message:"Failed to create team";throw i(e),new Error(e)}},updateTeam:async(e,t)=>{try{const r=await cn.updateTeam(e,t);return await o(),r}catch(r){const e=r instanceof Error?r.message:"Failed to update team";throw i(e),new Error(e)}},deleteTeam:async e=>{try{await cn.deleteTeam(e),s(t=>t.filter(t=>t.id!==e))}catch(t){const e=t instanceof Error?t.message:"Failed to delete team";throw i(e),new Error(e)}},reload:o}}const mn=(e,t,r)=>Math.max(t,Math.min(r,e)),gn=(e,t)=>t>0?e/t:0;function hn(e){const{baseDate:t,athleteIds:s}=e,[a,n]=r.useState([]),[l,i]=r.useState(!1),[o,d]=r.useState(null),c=r.useMemo(()=>t?function(e){const t=new Date(`${e}T00:00:00+09:00`),r=(t.getDay()+6)%7,s=new Date(t);s.setDate(t.getDate()-r);const a=new Date(s);a.setDate(s.getDate()+6);const n=e=>new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(e);return{start:n(s),end:n(a)}}(t):{start:"",end:""},[t]),u=r.useMemo(()=>(Array.isArray(s)?s:[]).slice().sort().join(","),[s]);return r.useEffect(()=>{const e=u?u.split(",").filter(Boolean):[];if(!c.start||!c.end||0===e.length)return n([]),i(!1),void d(null);let t=!1;return(async()=>{try{i(!0),d(null);const r=[];for(const t of((e,t)=>{const r=[];for(let s=0;s<e.length;s+=t)r.push(e.slice(s,s+t));return r})(e,50)){const{data:e,error:s}=await z.from("training_records").select("user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score").in("user_id",t).gte("date",c.start).lte("date",c.end);if(s)throw s;r.push(...e??[])}if(t)return;const s=new Map;for(const e of r){const t=e.intent_signal??e.signal_score??50,r=e.growth_vector??e.arrow_score??50,a="number"==typeof e.load&&isFinite(e.load)?e.load:(e.rpe??0)*(e.duration_min??0),n=mn(Number(t)||50,0,100),l=mn(Number(r)||50,0,100),i=mn(Number(a)||0,0,999999),o=mn(Number(e.rpe)||0,0,10),d=e.date,c=s.get(d)??{sumX:0,sumY:0,sumLoad:0,sumRpe:0,n:0};c.sumX+=n,c.sumY+=l,c.sumLoad+=i,c.sumRpe+=o,c.n+=1,s.set(d,c)}const a=[],l=new Date(`${c.start}T00:00:00+09:00`);for(let e=0;e<7;e++){const t=new Date(l);t.setDate(l.getDate()+e);const r=new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(t);a.push(r)}const o=a.map(e=>{const t=s.get(e);return t&&0!==t.n?{date:e,x:Math.round(10*gn(t.sumX,t.n))/10,y:Math.round(10*gn(t.sumY,t.n))/10,load:Math.round(gn(t.sumLoad,t.n)),rpe:Math.round(10*gn(t.sumRpe,t.n))/10,n:t.n}:{date:e,x:50,y:50,load:0,rpe:0,n:0}});n(o)}catch(r){console.error("[useWeeklyGrowthCycle] error",r),t||(d((null==r?void 0:r.message)??"é€±ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),n([]))}finally{t||i(!1)}})(),()=>{t=!0}},[c.start,c.end,u]),{weekRange:c,teamDaily:a,loading:l,error:o}}function pn(e,t){if(!isFinite(e)||e<=0)return 5;if(!isFinite(t)||t<=0)return 5;var r,s,a;return 5+13*(r=e/t,s=0,a=1,Math.max(s,Math.min(a,r)))}function bn(e){const{teamDaily:t,weekLabel:s}=e,c=r.useMemo(()=>(null==t?void 0:t.length)?Math.max(...t.map(e=>e.load??0),0):0,[t]),x=r.useMemo(()=>(t??[]).map(e=>({...e,name:e.n>0?e.date:`${e.date}ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰`,opacity:e.n>0?.55:.12})),[t]),h=r.useMemo(()=>(t??[]).map(e=>({date:e.date.slice(5),load:e.load,growth:e.y,understanding:e.x,n:e.n})),[t]);return T.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5 space-y-4",children:[T.jsxs("div",{children:[T.jsxs("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:["é€±ã‚µã‚¤ã‚¯ãƒ«ï¼ˆ",s,"ï¼‰"]}),T.jsx("div",{className:"text-xs text-gray-500",children:"ä¸Šï¼šæ—¥åˆ¥å¹³å‡ã®ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆç‚¹ã‚µã‚¤ã‚ºï¼è² è· loadï¼‰ / ä¸‹ï¼šé€±ã®æ¨ç§»ï¼ˆloadãƒ»æˆé•·ãƒ»ç†è§£ï¼‰"})]}),T.jsx("div",{style:{width:"100%",height:360},children:T.jsx(a,{children:T.jsxs(g,{margin:{top:10,right:14,bottom:10,left:10},children:[T.jsx(l,{}),T.jsx(i,{type:"number",dataKey:"x",domain:[0,100],ticks:[0,25,50,75,100]}),T.jsx(o,{type:"number",dataKey:"y",domain:[0,100],ticks:[0,25,50,75,100]}),T.jsx(d,{cursor:{strokeDasharray:"3 3"},content:({active:e,payload:t})=>{if(!e||!(null==t?void 0:t.length))return null;const r=t[0].payload;return T.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 shadow",children:[T.jsx("div",{className:"font-semibold mb-1",children:r.date}),T.jsxs("div",{className:"text-sm",children:["ç†è§£åº¦: ",Math.round(r.x)]}),T.jsxs("div",{className:"text-sm",children:["æˆé•·åº¦: ",Math.round(r.y)]}),T.jsxs("div",{className:"text-sm",children:["è² è·(load): ",Math.round(r.load)]}),T.jsxs("div",{className:"text-sm",children:["å¹³å‡RPE: ",r.rpe]}),T.jsxs("div",{className:"text-sm",children:["ä»¶æ•°: ",r.n]})]})}}),T.jsx(m,{}),T.jsx(p,{name:"æ—¥åˆ¥å¹³å‡",data:x,fill:"#3b82f6",shape:e=>{const{cx:t,cy:r,payload:s}=e,a=pn((null==s?void 0:s.load)??0,c);return T.jsx("circle",{cx:t,cy:r,r:a,fill:"#3b82f6",fillOpacity:(null==s?void 0:s.opacity)??.55,stroke:"#1d4ed8",strokeWidth:1})}})]})})}),T.jsx("div",{style:{width:"100%",height:260},children:T.jsx(a,{children:T.jsxs(n,{data:h,margin:{top:10,right:14,bottom:10,left:10},children:[T.jsx(l,{}),T.jsx(i,{dataKey:"date"}),T.jsx(o,{}),T.jsx(d,{}),T.jsx(m,{}),T.jsx(u,{type:"monotone",dataKey:"load",name:"è² è·(load)"}),T.jsx(u,{type:"monotone",dataKey:"growth",name:"æˆé•·(å¹³å‡)"}),T.jsx(u,{type:"monotone",dataKey:"understanding",name:"ç†è§£(å¹³å‡)"})]})})}),T.jsx("div",{className:"text-xs text-gray-500",children:"â€»ã€Œæˆé•·/ç†è§£ã€ã¯ 0â€“100 ã®å¹³å‡å€¤ã€‚n=0 ã®æ—¥ã¯ç‚¹ãŒè–„ãã€loadã¯0ã«ãªã‚Šã¾ã™ã€‚"})]})}const yn=(e,t,r)=>Math.max(t,Math.min(r,e));function fn(e){const{date:t,athletes:s}=e,[a,n]=r.useState([]),[l,i]=r.useState(!1),[o,d]=r.useState(null),c=r.useMemo(()=>Array.isArray(s)&&0!==s.length?s.map(e=>{const t=e.nickname||e.name||e.email||"åå‰æœªè¨­å®š";return`${e.id}:${t}`}).sort().join("|"):"",[s]),u=r.useMemo(()=>Array.isArray(s)&&0!==s.length?s.map(e=>e.id).filter(Boolean).sort().join(","):"",[s]),x=r.useMemo(()=>u?u.split(",").filter(Boolean):[],[u]),m=r.useMemo(()=>{const e={};if(!c)return e;for(const t of c.split("|")){const[r,...s]=t.split(":"),a=s.join(":")||"åå‰æœªè¨­å®š";r&&(e[r]=a)}return e},[c]),g=r.useRef(0);r.useEffect(()=>{if(!t||0===x.length)return n([]),d(null),void i(!1);let e=!1;const r=++g.current;return(async()=>{try{i(!0),d(null);const s=[];for(const e of((e,t)=>{const r=[];for(let s=0;s<e.length;s+=t)r.push(e.slice(s,s+t));return r})(x,50)){const{data:r,error:a}=await z.from("training_records").select("user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score").in("user_id",e).eq("date",t);if(a)throw a;s.push(...r??[])}if(e)return;if(r!==g.current)return;const a=new Map;for(const e of s){const t=e.intent_signal??e.signal_score??50,r=e.growth_vector??e.arrow_score??50,s="number"==typeof e.load&&isFinite(e.load)?e.load:(e.rpe??0)*(e.duration_min??0),n=yn(Number(t)||50,0,100),l=yn(Number(r)||50,0,100),i=yn(Number(s)||0,0,999999),o=yn(Number(e.rpe)||0,0,10),d=yn(Number(e.duration_min)||0,0,1e5),c=a.get(e.user_id)??{sumX:0,sumY:0,sumLoad:0,sumRpe:0,sumDur:0,n:0};c.sumX+=n,c.sumY+=l,c.sumLoad+=i,c.sumRpe+=o,c.sumDur+=d,c.n+=1,a.set(e.user_id,c)}const l=Array.from(a.entries()).map(([e,t])=>{const r=t.n||1;return{user_id:e,name:m[e]||"åå‰æœªè¨­å®š",x:Math.round(t.sumX/r*10)/10,y:Math.round(t.sumY/r*10)/10,load:Math.round(t.sumLoad/r),rpe:Math.round(t.sumRpe/r*10)/10,duration_min:Math.round(t.sumDur/r)}});n(l)}catch(s){console.error("[useDailyGrowthMatrix] error",s),e||(d((null==s?void 0:s.message)??"å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),n([]))}finally{e||i(!1)}})(),()=>{e=!0}},[t,u,c]);const h=r.useMemo(()=>{if(!a||0===a.length)return null;const e=e=>e.reduce((e,t)=>e+t,0)/e.length;return{x:e(a.map(e=>e.x)),y:e(a.map(e=>e.y)),load:e(a.map(e=>e.load))}},[a]);return{points:a,teamAvg:h,loading:l,error:o}}const vn=(e,t)=>{const r=Math.pow(10,t);return Math.round(e*r)/r},jn=(e,t,r)=>{const s=e.toFixed(t);return r?`${s} ${r}`:s},wn=e=>{const t=e.toLowerCase();return t.includes("10m")||t.includes("20m")||t.includes("30m")||t.includes("sprint")||t.includes("dash")||t.includes("time")||t.includes("ç§’")||t.includes("sec")?"lower":"higher"},Nn=(e,t,r)=>{const s=e-t;return"higher"===r?s:-s},kn=e=>{const{athleteName:t,testDisplayName:r,latestValue:s,bestValue:a,unitLabel:n,direction:l,teamAvg:i,p10:o,p90:d,prevValue:c}=e;if(null==s||!Number.isFinite(s))return null;const u=(e=>e?(e.toLowerCase().includes("rsi"),2):2)(r),x=`${t?t+"ï¼š":""}${r}ã®è¦ç‚¹`,m=[],g=[];if(m.push(`æœ€æ–°ï¼š${jn(s,u,n)}`),null!=a&&Number.isFinite(a)&&m.push(`ãƒ™ã‚¹ãƒˆï¼š${jn(a,u,n)}`),null!=c&&Number.isFinite(c)){const e=Nn(s,c,l),t=e>=0?"+":"";m.push(`å‰å›æ¯”ï¼š${t}${vn(e,u).toFixed(u)}ï¼ˆè‰¯åŒ–æ–¹å‘ åŸºæº–ï¼‰`),Math.abs(e)<Math.max(.003*Math.abs(s),1e-4)&&g.push("å¤‰åŒ–ãŒå°ã•ã„ã®ã§ã€ã¾ãšã¯ãƒ•ã‚©ãƒ¼ãƒ /æ¡ä»¶ï¼ˆã‚·ãƒ¥ãƒ¼ã‚ºãƒ»è·¯é¢ãƒ»ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ï¼‰ã‚’å›ºå®šã—ã¦å†æ¸¬å®š")}if(null!=i&&Number.isFinite(i)){const e=((e,t,r)=>{const s=Nn(e,t,r),a=Math.max(.002*Math.abs(t),1e-4);return s>a?"above":s<-a?"below":"equal"})(s,i,l),t=Nn(s,i,l),a=t>=0?"+":"";m.push(`ãƒãƒ¼ãƒ å¹³å‡ï¼š${jn(i,u,n)}ï¼ˆå¹³å‡ã¨ã®å·®ï¼š${a}${vn(t,u).toFixed(u)} è‰¯åŒ–æ–¹å‘ åŸºæº–ï¼‰`),"above"===e?(m.push("è©•ä¾¡ï¼šå¹³å‡ä»¥ä¸Šï¼ˆå¼·ã¿å€™è£œï¼‰"),g.push("å¼·ã¿ã‚’ç¶­æŒï¼šé€±1å›ã¯åŒæ¡ä»¶ã§å†ç¾æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆåŒã˜ã‚¢ãƒƒãƒ—â†’åŒã˜æ¸¬å®šï¼‰")):"below"===e?(m.push("è©•ä¾¡ï¼šå¹³å‡æœªæº€ï¼ˆèª²é¡Œå€™è£œï¼‰"),r.toLowerCase(),"lower"===l?(g.push("èª²é¡Œä»®èª¬ï¼šåŠ é€Ÿå±€é¢ã®å‡ºåŠ›/æ¥åœ°ã®ãƒ­ã‚¹ã€‚å‹•ç”»ã§â€œæ¥åœ°ä½ç½®ã¨ä¸Šä½“è§’â€ã‚’ç¢ºèª"),g.push("ãƒ‰ãƒªãƒ«ï¼š10mãªã‚‰ã€2æ­©åŠ é€Ÿâ†’10mã€ã‚’é€±2ï¼ˆçŸ­æ™‚é–“ï¼‰ã§åå¾©")):(g.push("èª²é¡Œä»®èª¬ï¼šå‡ºåŠ› or åç™ºã®ä¸è¶³ã€‚å¯å‹•åŸŸã¨åŠ›ç™ºæ®ã®ä¸¡é¢ã§ãƒã‚§ãƒƒã‚¯"),g.push("ãƒ‰ãƒªãƒ«ï¼šã‚¸ãƒ£ãƒ³ãƒ—ç³»ãªã‚‰ã€ä½å¼·åº¦ãƒã‚´â†’ä¸­å¼·åº¦ã€ã®æ¼¸é€²ã§åç™ºã‚’ä½œã‚‹"))):(m.push("è©•ä¾¡ï¼šå¹³å‡åŒç­‰"),g.push("æ¬¡ã®ä¼¸ã³ä»£ï¼šã¾ãšâ€œãƒ™ã‚¹ãƒˆãŒå‡ºã‚‹æ¡ä»¶â€ã‚’å†ç¾ï¼ˆæ¸¬å®šå‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã®å›ºå®šï¼‰"))}if(null!=o&&null!=d&&Number.isFinite(o)&&Number.isFinite(d)){m.push(`ç›®å®‰ãƒ¬ãƒ³ã‚¸ï¼šP10 ${jn(o,u,n)} / P90 ${jn(d,u,n)}`);("higher"===l?s>=Math.min(o,d)&&s<=Math.max(o,d):s<=Math.max(o,d)&&s>=Math.min(o,d))||g.push("ãƒ¬ãƒ³ã‚¸å¤–ï¼šæ¸¬å®šæ¡ä»¶ã®é•ã„ï¼ˆæ©Ÿå™¨/ãƒ•ã‚©ãƒ¼ãƒ /ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ï¼‰ã‚’ç–‘ã£ã¦å†æ¸¬å®š")}return{title:x,bullets:m.filter(Boolean),nextActions:Array.from(new Set(g)).slice(0,4),note:"â€»ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯å†…éƒ¨ãƒ«ãƒ¼ãƒ«ã§ç”Ÿæˆã—ã¦ã„ã¾ã™ï¼ˆåŸå› ã®æ–­å®šã¯ã›ãšã€æ¬¡ã®ç¢ºèªãƒ»è¡Œå‹•ã«ç¹‹ã’ã‚‹è¨­è¨ˆï¼‰ã€‚"}},_n=e=>{const[t,r,s]=e.split("-").map(Number);return t&&r&&s?`${r}/${s}`:e};function Sn({open:e,onClose:t,teamId:s,athleteUserId:x,athleteName:m,testTypeId:g,metricKey:h}){const[p,b]=r.useState(!1),[y,f]=r.useState(null),[v,j]=r.useState(null),[w,N]=r.useState([]),[k,_]=r.useState(null),S=!!(null==v?void 0:v.is_strength)?"relative_1rm"===h?"ç›¸å¯¾1RM":"æ¨å®š1RM":"",C=r.useMemo(()=>v?"relative_1rm"===h?"Ã—BW":v.unit||"":"",[v,h]),E=r.useMemo(()=>{const e=(e=>{const t=(e||"").trim();return"ç§’"===t||"s"===t||"sec"===t?2:new Set(["å›","ç‚¹"]).has(t)?0:2})(C);return t=>{if(null==t)return"â€”";const r=Number(t);return Number.isFinite(r)?0===e?String(Math.round(r)):r.toFixed(e):"â€”"}},[C]);r.useEffect(()=>{if(!e)return;let t=!1;return(async()=>{try{b(!0),f(null);const e=await z.from("performance_test_types").select("id, display_name, unit, is_strength").eq("id",g).single();if(e.error)throw e.error;t||j(e.data);const{data:r,error:a}=await z.rpc("get_athlete_test_timeseries",{p_team_id:s,p_user_id:x,p_test_type_id:g,p_metric:h,p_days:730});if(a)throw a;const n=(r??[]).map(e=>({date:e.date,value:Number(e.value)})).filter(e=>e.date&&Number.isFinite(e.value)).sort((e,t)=>e.date.localeCompare(t.date));t||N(n);const{data:l,error:i}=await z.rpc("get_my_team_benchmarks",{p_days:90,p_metric:h});if(!i&&l){const e=Array.isArray(l)?l[0]:l,r={avg_value:(null==e?void 0:e.avg_value)??(null==e?void 0:e.avg)??null,p10:(null==e?void 0:e.p10)??null,p90:(null==e?void 0:e.p90)??null};t||_(r)}else t||_(null)}catch(e){console.error("[CoachAthletePerformanceModal] error",e),t||(f((null==e?void 0:e.message)??"å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),N([]),_(null))}finally{t||b(!1)}})(),()=>{t=!0}},[e,s,x,g,h]);const D=w.length?w[w.length-1]:null,M=kn({athleteName:m,testDisplayName:(null==v?void 0:v.display_name)||"ç¨®ç›®",latestValue:(null==D?void 0:D.value)??null,prevValue:w.length>=2?w[w.length-2].value:null,unitLabel:C,direction:wn((null==v?void 0:v.display_name)||""),teamAvg:(null==k?void 0:k.avg_value)??null,p10:(null==k?void 0:k.p10)??null,p90:(null==k?void 0:k.p90)??null});return e?T.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",onClick:t,children:T.jsxs("div",{className:"bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[T.jsxs("div",{className:"px-5 py-4 border-b flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsx("div",{className:"text-sm text-gray-500",children:"æˆé•·ã‚°ãƒ©ãƒ•"}),T.jsxs("div",{className:"text-lg font-bold text-gray-900 truncate",children:[m," / ",(null==v?void 0:v.display_name)||"ç¨®ç›®",S?`ï¼ˆ${S}ï¼‰`:""]}),T.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["æœ€æ–°ï¼š",D?`${D.date} / ${E(D.value)} ${C}`:"â€”"]})]}),T.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100",onClick:t,"aria-label":"close",title:"é–‰ã˜ã‚‹",children:T.jsx(ar,{className:"w-5 h-5 text-gray-600"})})]}),T.jsxs("div",{className:"p-5 space-y-4",children:[y&&T.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:y}),M&&T.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900",children:M.title}),T.jsx("ul",{className:"mt-2 space-y-1 text-sm text-gray-800 list-disc pl-5",children:M.bullets.map((e,t)=>T.jsx("li",{children:e},t))}),M.nextActions.length>0&&T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"mt-3 text-xs font-semibold text-gray-700",children:"æ¬¡ã®ä¸€æ‰‹"}),T.jsx("ul",{className:"mt-1 space-y-1 text-sm text-gray-800 list-disc pl-5",children:M.nextActions.map((e,t)=>T.jsx("li",{children:e},t))})]}),M.note&&T.jsx("div",{className:"mt-2 text-xs text-gray-500",children:M.note})]}),p?T.jsx("div",{className:"flex items-center justify-center py-16",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):0===w.length?T.jsx("div",{className:"py-12 text-center text-sm text-gray-500",children:"ã“ã®ç¨®ç›®ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“"}):T.jsx("div",{className:"h-64",children:T.jsx(a,{width:"100%",height:"100%",children:T.jsxs(n,{data:w,margin:{top:10,right:10,left:0,bottom:0},children:[T.jsx(l,{strokeDasharray:"3 3"}),T.jsx(i,{dataKey:"date",tickFormatter:_n,minTickGap:18}),T.jsx(o,{}),T.jsx(d,{formatter:e=>`${E(Number(e))} ${C}`,labelFormatter:e=>`æ—¥ä»˜: ${e}`}),null!=(null==k?void 0:k.avg_value)&&T.jsx(c,{y:k.avg_value,strokeDasharray:"6 4",label:{value:"ãƒãƒ¼ãƒ å¹³å‡",position:"insideTopRight"}}),null!=(null==k?void 0:k.p10)&&T.jsx(c,{y:k.p10,strokeDasharray:"2 6"}),null!=(null==k?void 0:k.p90)&&T.jsx(c,{y:k.p90,strokeDasharray:"2 6"}),T.jsx(u,{type:"monotone",dataKey:"value",strokeWidth:3,dot:!1})]})})}),w.length>0&&T.jsxs("div",{className:"border rounded-xl overflow-hidden",children:[T.jsxs("div",{className:"px-4 py-2 bg-gray-50 text-xs text-gray-600 flex justify-between",children:[T.jsx("span",{children:"æ—¥ä»˜"}),T.jsxs("span",{children:["å€¤ï¼ˆ",C||"-","ï¼‰"]})]}),T.jsx("div",{className:"max-h-48 overflow-auto divide-y",children:w.slice().reverse().map(e=>T.jsxs("div",{className:"px-4 py-2 text-sm flex justify-between",children:[T.jsx("span",{className:"text-gray-700",children:e.date}),T.jsx("span",{className:"font-semibold text-gray-900",children:E(e.value)})]},e.date))})]}),T.jsx("div",{className:"text-xs text-gray-500",children:"â€» ã¾ãšã¯ã€Œå€‹äººæ¨ç§»ï¼‹ãƒãƒ¼ãƒ åŸºæº–ç·šï¼ˆã‚ã‚Œã°ï¼‰ã€ã§å®Œæˆã€‚æ¬¡ã«ã€Œãƒãƒ¼ãƒ å†…é †ä½ã®æ¨ç§»ã€ãªã©æ‹¡å¼µã§ãã¾ã™ã€‚"})]})]})}):null}const Cn={off:"ã‚ªãƒ•",pre:"ãƒ—ãƒ¬ï¼ˆæº–å‚™ï¼‰",in:"ã‚¤ãƒ³ï¼ˆé€šå¸¸ï¼‰",peak:"ãƒ”ãƒ¼ã‚¯",transition:"ç§»è¡Œ",unknown:"æœªè¨­å®š"},En={off:"bg-gray-100 text-gray-700 border-gray-200",pre:"bg-blue-50 text-blue-700 border-blue-200",in:"bg-emerald-50 text-emerald-700 border-emerald-200",peak:"bg-rose-50 text-rose-700 border-rose-200",transition:"bg-amber-50 text-amber-700 border-amber-200",unknown:"bg-slate-50 text-slate-700 border-slate-200"},Dn=(e,t)=>{const r=Number(e.slice(5,7)),s=Number(e.slice(8,10)),a=Number(t.slice(5,7)),n=Number(t.slice(8,10));return r&&s&&a&&n?`${r}/${s}â€“${a}/${n}`:`${e}ã€œ${t}`},Mn=()=>{const e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(e)},Tn=(e,t)=>{const[r,s,a]=e.split("-").map(Number),n=new Date(r,(s??1)-1,a??1);return n.setDate(n.getDate()+t),new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(n)},Rn=e=>e.split(/[,ã€\n\t ]+/).map(e=>e.trim()).filter(Boolean).slice(0,12);function $n({teamId:e,teamName:t}){const[s,a]=r.useState(!1),[n,l]=r.useState(!1),[i,o]=r.useState(null),[d,c]=r.useState([]),[u,x]=r.useState(!1),[m,g]=r.useState("create"),[h,p]=r.useState(null),[b,y]=r.useState(()=>Mn()),[f,v]=r.useState(()=>Tn(Mn(),20)),[j,w]=r.useState("pre"),[N,k]=r.useState("åŸºç¤ ãƒ•ã‚©ãƒ¼ãƒ  ç­‹åŠ›"),[_,S]=r.useState(""),C=r.useMemo(()=>[...d].sort((e,t)=>(e.start_date||"").localeCompare(t.start_date||"")),[d]),E=Mn(),D=r.useMemo(()=>C.find(e=>{return t=E,r=e.start_date,s=e.end_date,r<=t&&t<=s;var t,r,s})??null,[C,E]),M=r.useMemo(()=>{const e=Tn(E,21);return C.filter(t=>!(t.end_date<E||e<t.start_date))},[C,E]);r.useMemo(()=>M.filter(e=>{return r=D,!((t=e)&&r&&t.phase_type===r.phase_type&&t.start_date===r.start_date&&t.end_date===r.end_date);var t,r}),[M,D]);const R=()=>x(!1),$=async()=>{if(e)try{a(!0),o(null);const{data:t,error:r}=await z.rpc("list_team_season_phases",{p_team_id:e});if(r)throw r;const s=(t??[]).map(t=>({id:t.id,team_id:t.team_id??e,start_date:t.start_date,end_date:t.end_date,phase_type:t.phase_type??"unknown",focus_tags:Array.isArray(t.focus_tags)?t.focus_tags:[],note:t.note??null}));c(s)}catch(t){console.error("[TeamSeasonPhaseSettings] fetch error",t),o((null==t?void 0:t.message)??"å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),c([])}finally{a(!1)}};r.useEffect(()=>{$()},[e]);return T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[T.jsxs("div",{className:"flex items-center justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsx("div",{className:"text-xs text-gray-500",children:"è¨­å®šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºï¼‰"}),T.jsxs("div",{className:"text-base font-bold text-gray-900 truncate",children:["ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º",t?` - ${t}`:""]}),T.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:"â€» é¸æ‰‹å´ãƒˆãƒƒãƒ—ã«ã€Œä»Šæ—¥ã€ã¨ã€Œä»Šå¾Œ3é€±é–“ã€ã‚’è¡¨ç¤º"})]}),T.jsxs("button",{onClick:()=>{(()=>{const e=Mn();y(e),v(Tn(e,20)),w("pre"),k("åŸºç¤ ãƒ•ã‚©ãƒ¼ãƒ  ç­‹åŠ›"),S(""),g("create"),p(null)})(),o(null),x(!0)},className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 text-xs font-semibold shrink-0",children:[T.jsx(kt,{className:"w-4 h-4"}),"è¿½åŠ "]})]}),i&&T.jsxs("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2 flex items-start gap-2",children:[T.jsx(fe,{className:"w-4 h-4 mt-0.5"}),T.jsx("div",{className:"min-w-0",children:i})]})]}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:"text-xs font-medium text-gray-500",children:"ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º"}),T.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-600",children:"ä»Šæ—¥"})]}),T.jsx("span",{className:"text-xs text-gray-500",children:D?Dn(D.start_date,D.end_date):"æœªè¨­å®š"})]}),D?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"mt-2 flex items-end justify-between gap-3",children:T.jsx("div",{className:"min-w-0",children:T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("h3",{className:"text-xl font-semibold text-gray-900 truncate",children:Cn[D.phase_type]}),T.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${En[D.phase_type]}`,children:D.phase_type})]})})}),Array.isArray(D.focus_tags)&&D.focus_tags.length>0&&T.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[D.focus_tags.slice(0,6).map((e,t)=>T.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-50 text-blue-700",children:e},`${e}-${t}`)),D.focus_tags.length>6&&T.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:["+",D.focus_tags.length-6]})]}),T.jsx("p",{className:"mt-3 text-sm text-gray-700 line-clamp-2",children:ka((null==D?void 0:D.phase_type)??"unknown",(null==D?void 0:D.focus_tags)??[],(null==D?void 0:D.note)??null,{preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:80})})]}):T.jsx("div",{className:"mt-3 text-sm text-gray-600",children:"ãƒ•ã‚§ãƒ¼ã‚ºãŒæœªè¨­å®šã§ã™ï¼ˆï¼‹è¿½åŠ  ã‹ã‚‰ç™»éŒ²ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"})]}),T.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsxs("div",{children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"ä»Šå¾Œ3é€±é–“"}),T.jsx("div",{className:"text-xs text-gray-500",children:"æ¨ªã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«"})]}),T.jsxs("div",{className:"text-[11px] text-gray-400",children:[E,"ã€œ",Tn(E,21)]})]}),0===M.length?T.jsx("div",{className:"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-3",children:"æœŸé–“å†…ã®ãƒ•ã‚§ãƒ¼ã‚ºãŒã‚ã‚Šã¾ã›ã‚“"}):T.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1",children:M.slice(0,6).map((e,t)=>{const r=D&&e.phase_type===D.phase_type&&e.start_date===D.start_date&&e.end_date===D.end_date;return T.jsxs("div",{className:"min-w-[170px] rounded-lg border p-3 "+(r?"border-blue-200 bg-blue-50/60":"border-gray-200 bg-white"),children:[T.jsxs("div",{className:"flex items-center justify-between gap-2",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:Cn[e.phase_type]}),T.jsx("div",{className:"text-[11px] text-gray-500 whitespace-nowrap",children:Dn(e.start_date,e.end_date)})]}),Array.isArray(e.focus_tags)&&e.focus_tags.length>0&&T.jsxs("div",{className:"mt-2 flex flex-wrap gap-1.5",children:[e.focus_tags.slice(0,3).map((t,r)=>T.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:t},`${e.id}-${t}-${r}`)),e.focus_tags.length>3&&T.jsxs("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:["+",e.focus_tags.length-3]})]}),T.jsx("div",{className:"mt-2 text-xs text-gray-600 line-clamp-1",children:ka(e.phase_type??"unknown",e.focus_tags??[],e.note??null,{preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:50})})]},`${e.id}-${t}`)})})]})]}),T.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[T.jsxs("div",{className:"px-4 py-3 bg-gray-50 flex items-center justify-between",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"ç™»éŒ²æ¸ˆã¿ãƒ•ã‚§ãƒ¼ã‚º"}),T.jsx("button",{onClick:$,className:"text-xs font-semibold px-3 py-1.5 rounded-lg border bg-white hover:bg-gray-50",disabled:s,children:s?"æ›´æ–°ä¸­â€¦":"æ›´æ–°"})]}),s?T.jsx("div",{className:"py-10 flex items-center justify-center",children:T.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):0===C.length?T.jsx("div",{className:"py-10 text-center text-sm text-gray-600",children:"ã¾ã ãƒ•ã‚§ãƒ¼ã‚ºãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œè¿½åŠ ã€ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚"}):T.jsx("div",{className:"divide-y",children:C.map(t=>{var r;return T.jsx("div",{className:"p-4",children:T.jsxs("div",{className:"flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[T.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full border text-xs font-semibold ${En[t.phase_type]}`,children:Cn[t.phase_type]}),T.jsxs("span",{className:"text-xs text-gray-500",children:[t.start_date,"ã€œ",t.end_date]})]}),!!(null==(r=t.focus_tags)?void 0:r.length)&&T.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[t.focus_tags.slice(0,4).map(e=>T.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:e},e)),t.focus_tags.length>4&&T.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:["+",t.focus_tags.length-4]})]}),t.note&&T.jsx("div",{className:"mt-2 text-xs text-gray-600 line-clamp-2",children:t.note})]}),T.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[T.jsx("button",{onClick:()=>(e=>{g("edit"),p(e.id),y(e.start_date),v(e.end_date),w(e.phase_type),k((e.focus_tags??[]).join(" ")),S(e.note??""),o(null),x(!0)})(t),className:"p-2 rounded-lg border bg-white hover:bg-gray-50",title:"ç·¨é›†",children:T.jsx(jt,{className:"w-4 h-4 text-gray-700"})}),T.jsx("button",{onClick:()=>(async t=>{if(window.confirm(`å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n${t.start_date}ã€œ${t.end_date} / ${Cn[t.phase_type]}`))try{l(!0),o(null);const{error:r}=await z.from("team_season_phases").delete().eq("id",t.id).eq("team_id",e);if(r)throw r;await $()}catch(r){console.error("[TeamSeasonPhaseSettings] delete error",r),o((null==r?void 0:r.message)??"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{l(!1)}})(t),className:"p-2 rounded-lg border bg-white hover:bg-red-50",title:"å‰Šé™¤",disabled:n,children:T.jsx(Ut,{className:"w-4 h-4 text-red-600"})})]})]})},t.id)})})]}),u&&T.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",onClick:R,children:T.jsxs("div",{className:"bg-white w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[T.jsxs("div",{className:"px-5 py-4 border-b flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsx("div",{className:"text-sm text-gray-500",children:"ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º"}),T.jsx("div",{className:"text-lg font-bold text-gray-900 truncate",children:"create"===m?"è¿½åŠ ":"ç·¨é›†"})]}),T.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100",onClick:R,"aria-label":"close",children:T.jsx(ar,{className:"w-5 h-5 text-gray-600"})})]}),T.jsxs("div",{className:"p-5 space-y-4",children:[T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[T.jsxs("label",{className:"block",children:[T.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"é–‹å§‹æ—¥"}),T.jsx("input",{type:"date",value:b,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300"})]}),T.jsxs("label",{className:"block",children:[T.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"çµ‚äº†æ—¥"}),T.jsx("input",{type:"date",value:f,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300"})]})]}),T.jsxs("label",{className:"block",children:[T.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ãƒ•ã‚§ãƒ¼ã‚º"}),T.jsxs("select",{value:j,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300",children:[T.jsx("option",{value:"off",children:"ã‚ªãƒ•"}),T.jsx("option",{value:"pre",children:"ãƒ—ãƒ¬ï¼ˆæº–å‚™ï¼‰"}),T.jsx("option",{value:"in",children:"ã‚¤ãƒ³ï¼ˆé€šå¸¸ï¼‰"}),T.jsx("option",{value:"peak",children:"ãƒ”ãƒ¼ã‚¯"}),T.jsx("option",{value:"transition",children:"ç§»è¡Œ"}),T.jsx("option",{value:"unknown",children:"æœªè¨­å®š"})]})]}),T.jsxs("label",{className:"block",children:[T.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚°ï¼ˆã‚¹ãƒšãƒ¼ã‚¹/ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰"}),T.jsx("input",{type:"text",value:N,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300",placeholder:"ä¾‹ï¼šåŸºç¤ ãƒ•ã‚©ãƒ¼ãƒ  ç­‹åŠ›"}),T.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Rn(N).map(e=>T.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:e},e))})]}),T.jsxs("label",{className:"block",children:[T.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),T.jsx("textarea",{value:_,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 min-h-[90px]",placeholder:"ä¾‹ï¼šã¾ãšã¯åœŸå°ã¥ãã‚Šï¼ˆä»®ï¼‰"})]}),T.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[T.jsx("button",{onClick:R,className:"px-4 py-2 rounded-lg border bg-white hover:bg-gray-50 text-sm font-semibold",disabled:n,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsxs("button",{onClick:async()=>{try{l(!0),o(null);const t={start_date:b,end_date:f,phase_type:j,focus_tags:Rn(N),note:_.trim()?_.trim():null},r=function(e){const t=[];return e.start_date||t.push("é–‹å§‹æ—¥ãŒæœªå…¥åŠ›ã§ã™"),e.end_date||t.push("çµ‚äº†æ—¥ãŒæœªå…¥åŠ›ã§ã™"),e.start_date&&e.end_date&&e.start_date>e.end_date&&t.push("é–‹å§‹æ—¥ > çµ‚äº†æ—¥ ã«ãªã£ã¦ã„ã¾ã™"),e.phase_type||t.push("ãƒ•ã‚§ãƒ¼ã‚ºãŒæœªé¸æŠã§ã™"),t}(t);if(r.length>0)return void o(r.join(" / "));if("create"===m){const{error:r}=await z.from("team_season_phases").insert({team_id:e,start_date:t.start_date,end_date:t.end_date,phase_type:t.phase_type,focus_tags:t.focus_tags??[],note:t.note??null});if(r)throw r}else{if(!h)throw new Error("editingId is missing");const{error:r}=await z.from("team_season_phases").update({start_date:t.start_date,end_date:t.end_date,phase_type:t.phase_type,focus_tags:t.focus_tags??[],note:t.note??null}).eq("id",h).eq("team_id",e);if(r)throw r}await $(),R()}catch(t){console.error("[TeamSeasonPhaseSettings] save error",t),o((null==t?void 0:t.message)??"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{l(!1)}},className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-sm font-semibold disabled:opacity-50",disabled:n,children:[T.jsx(Dt,{className:"w-4 h-4"}),n?"ä¿å­˜ä¸­â€¦":"ä¿å­˜"]})]}),T.jsx("div",{className:"text-[11px] text-gray-500",children:"â€» æœŸé–“ãŒé‡è¤‡ã™ã‚‹ã¨DBå´ã®åˆ¶ç´„ï¼ˆEXCLUDEï¼‰ã§å¼¾ã‹ã‚Œã¾ã™ã€‚å¿…è¦ãªã‚‰æœŸé–“ã‚’èª¿æ•´ã—ã¦ã­ã€‚"})]})]})})]})}const An=r.lazy(()=>A(()=>import("./TeamExportPanel-BGlYlYPU.js"),__vite__mapDeps([8,1,5,2])).then(e=>({default:e.TeamExportPanel}))),In=r.lazy(()=>A(()=>import("./ReportView-nD5fRgZk.js"),__vite__mapDeps([9,1,2])).then(e=>({default:e.ReportView}))),zn=r.lazy(async()=>({default:(await A(()=>import("./CoachRankingsView-De1OIxUp.js"),__vite__mapDeps([10,1,2]))).default})),Pn=r.lazy(async()=>{const e=await A(()=>import("./GrowthUnderstandingQuadrantSummary-ByKDmVRN.js"),__vite__mapDeps([11,1,2]));return{default:e.GrowthUnderstandingQuadrantSummary??e.default}}),Ln=r.lazy(async()=>{const e=await A(()=>import("./GrowthUnderstandingMatrix-Dt-VFs5L.js"),__vite__mapDeps([12,1,2]));return{default:e.GrowthUnderstandingMatrix??e.default}}),qn=e=>e.toISOString().slice(0,10),Fn=e=>new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(e),On=e=>Math.round(100*e)/100,Wn=e=>e>=1.5?"high":e>=1.3?"caution":e>=.8?"good":"low",Bn=(e,t,r)=>"unknown"===e?`ãƒ‡ãƒ¼ã‚¿ä¸è¶³ï¼šæœ‰åŠ¹äººæ•°ãŒå°‘ãªã„ï¼ˆ${t}/${r}ï¼‰`:"danger"===e?"æ³¨æ„ï¼šè² è·ãŒé«˜ã„å¯èƒ½æ€§ã€‚å£°ã‹ã‘ãƒ»ç·´ç¿’å¾ŒRPEç¢ºèªæ¨å¥¨":"warn"===e?"æ³¨æ„ï¼šã‚„ã‚„é«˜ã‚ã€‚å›å¾©çŠ¶æ³ã®ç¢ºèªæ¨å¥¨":"å®‰å®šï¼šé€šå¸¸é‹ç”¨ã§OK",Un={danger:{box:"border-red-200 bg-red-50",badge:"bg-red-100 text-red-700 border-red-200",dot:"bg-red-500"},warn:{box:"border-amber-200 bg-amber-50",badge:"bg-amber-100 text-amber-700 border-amber-200",dot:"bg-amber-500"},ok:{box:"border-emerald-200 bg-emerald-50",badge:"bg-emerald-100 text-emerald-700 border-emerald-200",dot:"bg-emerald-500"},unknown:{box:"border-gray-200 bg-gray-50",badge:"bg-gray-100 text-gray-700 border-gray-200",dot:"bg-gray-400"}},Hn=(e,t)=>{const r=[];for(let s=0;s<e.length;s+=t)r.push(e.slice(s,s+t));return r};function Vn({user:e,alerts:t,onNavigateToPrivacy:s,onNavigateToTerms:a,onNavigateToCommercial:n,onNavigateToHelp:l}){const[i,o]=r.useState([]),[d,c]=r.useState(null),[u,x]=r.useState([]),[m,g]=r.useState(!1),[h,p]=r.useState(null),[b,y]=r.useState(!0),[f,v]=r.useState({}),[j,w]=r.useState(!1),[N,k]=r.useState(()=>(()=>{const e=new Date,t=(e.getDay()+6)%7,r=new Date(e);r.setDate(e.getDate()-t),r.setHours(0,0,0,0);const s=new Date(r);return s.setDate(r.getDate()+6),{start:qn(r),end:qn(s)}})()),[_,S]=r.useState([]),[C,E]=r.useState(!1),[D,M]=r.useState([]),[R,$]=r.useState(()=>Fn(new Date)),[A,I]=r.useState(null),[P,L]=r.useState("athletes"),[q,F]=r.useState({open:!1,athleteUserId:"",athleteName:"",testTypeId:"",metricKey:"primary_value"}),[O,W]=r.useState(!1),[B,U]=r.useState(!1),[H,V]=r.useState(!0),[K,J]=r.useState(!1),Y=r.useRef(null),G=r.useRef(0),Z=r.useRef("");r.useEffect(()=>{Y.current=(null==d?void 0:d.id)??null},[null==d?void 0:d.id]),r.useEffect(()=>{Z.current=u.map(e=>e.id).slice().sort().join(",")},[u]);const X=Fn(new Date),[Q,ee]=r.useState(()=>{if("undefined"==typeof window)return!1;try{const t=`noDataDismissed-${e.id}-${X}`;return"1"===localStorage.getItem(t)}catch{return!1}}),{isActive:te,shouldShowTutorial:re,startTutorial:se,completeTutorial:ae,skipTutorial:ne,currentStepIndex:le,setCurrentStepIndex:ie}=ge(),oe=un(e.id),de=Array.isArray(null==oe?void 0:oe.organizations)?oe.organizations:[],ce=Array.isArray(de)?de:[];(null==d?void 0:d.organization_id)||ce.length>0&&ce[0].id,r.useEffect(()=>{re()&&!b&&se()},[re,se,b]);const ue=function(e){const[t,s]=r.useState([]),[a,n]=r.useState({}),[l,i]=r.useState(!1),o=r.useRef(0);return r.useEffect(()=>{if(!e)return s([]),n({}),void i(!1);const t=++o.current;i(!0),s([]),n({}),(async()=>{try{const r=new Date,a=new Date(r);a.setDate(a.getDate()-90);const l=dn(a),i=dn(r),{data:d,error:c}=await z.from("team_acwr_daily").select("team_id,date,average_acwr,athlete_count").eq("team_id",e).gte("date",l).lte("date",i).order("date",{ascending:!0});if(c)throw c;if(o.current!==t)return;const u=(d||[]).map(e=>{const t=on(e.average_acwr),r=on(e.athlete_count);return{date:e.date,averageACWR:null!=t?(a=t,Math.round(100*a)/100):NaN,athleteCount:null!=r?Math.max(0,Math.round(r)):0,riskLevel:(s=t,null==s||!Number.isFinite(s)||s<=0?"unknown":s>=1.5?"high":s>=1.3?"caution":s>=.8?"good":"low"),averageRPE:null,averageLoad:null};var s,a}).filter(e=>Number.isFinite(e.averageACWR));let x=u;try{const{data:r,error:s}=await z.from("team_training_daily").select("team_id,date,average_rpe,average_load,athlete_count").eq("team_id",e).gte("date",l).lte("date",i).order("date",{ascending:!0});if(s)throw s;if(o.current!==t)return;const a=new Map;(r||[]).forEach(e=>a.set(e.date,e)),x=u.map(e=>{const t=a.get(e.date);return{...e,averageRPE:on(null==t?void 0:t.average_rpe)??null,averageLoad:on(null==t?void 0:t.average_load)??null}})}catch{x=u}if(o.current!==t)return;s(x),n({})}catch(r){console.error("[useTeamACWR] fetch failed",r),o.current===t&&(s([]),n({}))}finally{o.current===t&&i(!1)}})()},[e]),{teamACWRData:t,athleteACWRMap:a,loading:l}}((null==d?void 0:d.id)||null),xe=!!ue.loading,me=ue.teamACWRData??ue.data??[],he=Array.isArray(me)?me:[],pe=Array.isArray(u)?u:[],ye=Array.isArray(t)?t:[],ve=Array.isArray(_)?_:[],je=r.useMemo(()=>{const e=null==d?void 0:d.id;return e?ye.filter(t=>null==(null==t?void 0:t.team_id)||t.team_id===e):ye},[ye,null==d?void 0:d.id]),we=r.useMemo(()=>je.filter(e=>"high"===(null==e?void 0:e.priority)),[je]),Ne=r.useMemo(()=>pe.map(e=>e.id),[pe]),_e=r.useMemo(()=>pe.map(e=>({id:e.id,name:e.name,nickname:e.nickname,email:e.email})),[pe]),{points:Se,teamAvg:Ce,loading:Ee,error:Me}=fn({date:X,athletes:_e}),[Te,Re]=r.useState([]),[$e,Ae]=r.useState(!1),[Ie,ze]=r.useState(null),Pe=r.useRef(0),Le=r.useMemo(()=>Ne.slice().sort().join(","),[Ne]);r.useEffect(()=>{if("team-average"!==P)return;if(!(null==d?void 0:d.id)||!N.start||!N.end||0===Ne.length)return Re([]),Ae(!1),void ze(null);const e=++Pe.current;let t=!1;return(async()=>{try{Ae(!0),ze(null);const r=[];for(const e of Hn(Ne,50)){const{data:t,error:s}=await z.from("training_records").select("user_id,date,rpe,duration_min,load,arrow_score,signal_score").in("user_id",e).gte("date",N.start).lte("date",N.end);if(s)throw s;r.push(...t??[])}if(t)return;if(e!==Pe.current)return;const s=r.map(e=>{const t="number"==typeof e.arrow_score&&Number.isFinite(e.arrow_score)?e.arrow_score:null,r="number"==typeof e.signal_score&&Number.isFinite(e.signal_score)?e.signal_score:null,s="number"==typeof e.load&&Number.isFinite(e.load)?e.load:(Number(e.rpe)||0)*(Number(e.duration_min)||0);return{arrow_score:t,signal_score:r,load:Number.isFinite(s)?s:0}});Re(s)}catch(r){console.error("[weeklyQuadrant] error",r),ze((null==r?void 0:r.message)??"é€±ã‚µãƒãƒªãƒ¼å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),Re([])}finally{t||Ae(!1)}})(),()=>{t=!0}},[P,null==d?void 0:d.id,N.start,N.end,Le]);const{weekRange:qe,teamDaily:Fe,loading:Oe,error:We}=hn({baseDate:R,athleteIds:Ne});r.useEffect(()=>{Be()},[e.id]),r.useEffect(()=>{(null==d?void 0:d.id)&&(x([]),S([]),M([]),v({}),w(!1),Ue(d.id),He(d.id,N.start,N.end))},[null==d?void 0:d.id,N.start,N.end]),r.useEffect(()=>{if("undefined"==typeof window)return;const t=`noDataDismissed-${e.id}-${X}`;ee("1"===localStorage.getItem(t))},[e.id,X]);const Be=async()=>{try{y(!0);const{data:t,error:r}=await z.from("staff_team_links").select("\n            team_id,\n            teams (\n              id,\n              name,\n              created_at,\n              organization_id\n            )\n          ").eq("staff_user_id",e.id);if(r)throw r;const s=(t||[]).map(e=>e.teams).filter(Boolean);o(s||[]),s&&s.length>0?c(s[0]):c(null)}catch(t){console.error("Error fetching staff teams:",t),o([]),c(null)}finally{y(!1)}},Ue=async e=>{try{g(!0),p(null);const t=e,{data:r,error:s}=await z.from("staff_team_athletes_with_activity").select("*").eq("team_id",e);if(s)throw s;if(Y.current!==t)return;const a=r||[];x(a);const n=a.map(e=>e.id);Ve(e,n)}catch(t){console.error(t),p("é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{g(!1)}},He=async(e,t,r)=>{try{E(!0);const[s,a]=await Promise.all([z.rpc("get_coach_week_athlete_cards",{p_team_id:e,p_start_date:t,p_end_date:r}),z.rpc("get_coach_week_cause_tags",{p_team_id:e,p_start_date:t,p_end_date:r})]);if(s.error)throw s.error;if(a.error)throw a.error;S(s.data||[]),M(a.data||[])}catch(s){console.error("Failed to fetch week summary",s),S([]),M([])}finally{E(!1)}},Ve=async(e,t)=>{if(!t||0===t.length)return void(Y.current===e&&(v({}),w(!1)));const r=++G.current,s=t.slice().sort().join(",");try{w(!0);const a=new Date,n=new Date(a);n.setDate(n.getDate()-90);const l=Fn(n),i=Fn(a),o=Hn(t,50),d=[];for(const e of o){const{data:t,error:r}=await z.from("athlete_acwr_daily").select("user_id,date,acwr").in("user_id",e).gte("date",l).lte("date",i).order("date",{ascending:!1});if(r)throw r;d.push(...t||[])}if(Y.current!==e)return;if(r!==G.current)return;if(Z.current!==s)return;const c={};for(const e of d){if(c[e.user_id])continue;const t="number"==typeof e.acwr&&Number.isFinite(e.acwr)?e.acwr:null;c[e.user_id]={currentACWR:null!=t?On(t):null,riskLevel:null!=t?Wn(t):void 0,daysOfData:28}}for(const e of t)c[e]||(c[e]={currentACWR:null,riskLevel:void 0,daysOfData:null});v(c)}catch(a){console.error("[fetchAthleteACWRFromDaily] failed",a),Y.current===e&&v({})}finally{Y.current===e&&w(!1)}},Ke=he.length>0?he[he.length-1]:null,Je=r.useMemo(()=>{const e=new Date;return pe.filter(e=>e.last_training_date).map(t=>{const r=new Date(t.last_training_date);return{athlete:t,daysSinceLast:Math.floor((e.getTime()-r.getTime())/864e5)}}).filter(e=>e.daysSinceLast>=14).sort((e,t)=>t.daysSinceLast-e.daysSinceLast)},[pe]),Ye=(null==Ke?void 0:Ke.averageACWR)??null,Ge=(null==Ke?void 0:Ke.athleteCount)??0,Ze=pe.length,Qe=((e,t,r)=>{const s=Math.min(5,Math.max(1,Math.floor(.2*r)));return null==e||t<s?"unknown":e>=1.5?"danger":e>=1.3?"warn":"ok"})("number"==typeof Ye?Ye:null,Ge,Ze),et=r.useMemo(()=>{const e=[];if(Je.slice(0,3).forEach(({athlete:t,daysSinceLast:r})=>{e.push({user_id:t.id,name:t.name||t.email||"unknown",category:"risk",reason:"è¨˜éŒ²ãŒé€”åˆ‡ã‚Œã¦ã„ã¾ã™",meta:`${r}æ—¥æœªå…¥åŠ›`})}),!ve||0===ve.length)return e.slice(0,5);ve.forEach(t=>{var r;if(!t.is_sharing_active)return;const s=null==(r=null==f?void 0:f[t.athlete_user_id])?void 0:r.currentACWR;"number"==typeof s&&s>=1.5&&e.push({user_id:t.athlete_user_id,name:t.athlete_name||"unknown",category:"risk",reason:"ACWRé«˜å€¤",meta:`ACWR ${s.toFixed(2)}`})}),ve.forEach(t=>{t.is_sharing_active&&null!=t.sleep_hours_avg&&t.sleep_hours_avg<=5.5&&e.push({user_id:t.athlete_user_id,name:t.athlete_name||"unknown",category:"checkin",reason:"ç¡çœ ãŒçŸ­ã‚",meta:`${t.sleep_hours_avg.toFixed(1)}h`})}),ve.forEach(t=>{t.action_total>0&&(t.action_done_rate??0)>=90&&e.push({user_id:t.athlete_user_id,name:t.athlete_name||"unknown",category:"praise",reason:"è¡Œå‹•ç›®æ¨™ãŒè‰¯ã„",meta:`${Math.round(t.action_done_rate??0)}%`})});const t={risk:3,checkin:2,praise:1},r=new Map;for(const a of e){const e=r.get(a.user_id);(!e||t[a.category]>t[e.category])&&r.set(a.user_id,a)}const s=Array.from(r.values());return s.sort((e,r)=>t[r.category]-t[e.category]),s.slice(0,5)},[Je,ve,f]),tt=r.useMemo(()=>{const e={};for(const t of ve)e[t.athlete_user_id]=t;return e},[ve]),rt=r.useMemo(()=>{const e={};for(const t of Je)e[t.athlete.id]={daysSinceLast:t.daysSinceLast};return e},[Je]),st=r.useMemo(()=>{const e={};for(const t of pe)e[t.id]=Wa({id:t.id,name:t.name||t.email||"unknown",acwrInfo:(null==f?void 0:f[t.id])??null,weekCard:(null==tt?void 0:tt[t.id])??null,noData:(null==rt?void 0:rt[t.id])??null});return e},[pe,f,tt,rt]),nt=r.useMemo(()=>function(e){const{athletes:t,riskMap:r,weekCardMap:s={}}=e;return[...t].sort((e,t)=>{var a,n,l,i,o,d,c,u;const x=(null==(a=s[e.id])?void 0:a.is_sharing_active)??!0,m=(null==(n=s[t.id])?void 0:n.is_sharing_active)??!0;if(!x&&m)return 1;if(x&&!m)return-1;const g=null==(l=r[e.id])?void 0:l.riskLevel,h=null==(i=r[t.id])?void 0:i.riskLevel,p=g?Oa[g]:0,b=h?Oa[h]:0;if(p!==b)return b-p;const y=null==(o=r[e.id])?void 0:o.acwr,f=null==(d=r[t.id])?void 0:d.acwr,v="number"==typeof y&&Number.isFinite(y)?y:-1/0,j="number"==typeof f&&Number.isFinite(f)?f:-1/0;if(v!==j)return j-v;const w=(null==(c=r[e.id])?void 0:c.reasons.length)??0,N=(null==(u=r[t.id])?void 0:u.reasons.length)??0;return w!==N?N-w:(e.name||"").localeCompare(t.name||"","ja")})}({athletes:pe,riskMap:st,weekCardMap:tt}),[pe,st,tt]);r.useEffect(()=>{if(!nt||0===nt.length)return;const e=nt.filter(e=>{var t;return null==(t=null==st?void 0:st[e.id])?void 0:t.riskLevel}).length;e>=Math.floor(.7*nt.length)?console.log("[sortedAthletes]",nt.map(e=>{var t,r,s,a,n;return{name:e.name,risk:null==(t=st[e.id])?void 0:t.riskLevel,sharing:null==(r=tt[e.id])?void 0:r.is_sharing_active,acwr:null==(s=f[e.id])?void 0:s.currentACWR,reasons:(null==(n=null==(a=st[e.id])?void 0:a.reasons)?void 0:n.length)??0}})):console.log(`[sortedAthletes] risk not ready: ${e}/${nt.length}`)},[nt,st,tt,f]);return b?T.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T.jsxs("div",{className:"min-h-screen bg-gray-50",children:[T.jsx("header",{className:"bg-white shadow-sm border-b sticky top-0 z-40",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[T.jsxs("div",{className:"flex items-center justify-between py-3",children:[T.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"ã‚³ãƒ¼ãƒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"}),T.jsxs("div",{className:"flex items-center space-x-1",children:[we.length>0&&T.jsxs("button",{onClick:()=>W(!0),className:"p-2 text-gray-600 hover:text-red-600 transition-colors relative",title:"ã‚¢ãƒ©ãƒ¼ãƒˆ",children:[T.jsx(fe,{className:"w-5 h-5"}),T.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center",children:we.length})]}),T.jsx("button",{onClick:se,className:"p-2 text-gray-600 hover:text-green-600 transition-colors",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",children:T.jsx(at,{className:"w-5 h-5"})})]})]}),i.length>0&&T.jsx("div",{className:"pb-3 border-t border-gray-100",children:T.jsxs("div",{className:"flex items-center gap-3 pt-3",children:[T.jsx(rr,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),T.jsx("select",{value:(null==d?void 0:d.id)||"",onChange:e=>{const t=i.find(t=>t.id===e.target.value);t&&c(t)},className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:i.map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))})]})})]})}),T.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:0===i.length?T.jsxs("div",{className:"text-center py-12",children:[T.jsx(rr,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),T.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"æ‹…å½“ãƒãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("p",{className:"text-gray-600",children:"ç®¡ç†è€…ã«ãƒãƒ¼ãƒ ã®å‰²ã‚Šå½“ã¦ã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚"})]}):T.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[d&&T.jsxs("div",{className:"space-y-4",children:[!xe&&Ke&&T.jsx("div",{className:`rounded-xl border p-4 sm:p-5 ${Un[Qe].box}`,children:T.jsx("div",{className:"flex items-start justify-between gap-3",children:T.jsxs("div",{className:"min-w-0",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[T.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs font-semibold ${Un[Qe].badge}`,children:[T.jsx("span",{className:`w-2 h-2 rounded-full ${Un[Qe].dot}`}),"Today Summary"]}),T.jsx("span",{className:`inline-flex items-center px-3 py-1.5 rounded-full border text-sm font-bold ${Un[Qe].badge}`,children:(lt=Qe,"danger"===lt?"High":"warn"===lt?"Caution":"ok"===lt?"Good":"Unknown")})]}),T.jsx("div",{className:"text-sm sm:text-base text-gray-900 font-semibold",children:Bn(Qe,Ge,Ze)}),T.jsxs("div",{className:"mt-2 text-xs sm:text-sm text-gray-700 flex flex-wrap gap-x-4 gap-y-1",children:[T.jsxs("span",{children:["ãƒãƒ¼ãƒ ACWRï¼š",T.jsx("b",{children:Ke.averageACWR})]}),T.jsxs("span",{children:["æœ‰åŠ¹äººæ•°ï¼š",T.jsx("b",{children:Ge})," / åœ¨ç±ï¼š",T.jsx("b",{children:Ze})]})]})]})})}),!xe&&!Ke&&T.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4 sm:p-5",children:[T.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Today Summary"}),T.jsxs("div",{className:"text-sm text-gray-700",children:["ã¾ã ãƒãƒ¼ãƒ ACWRã‚’ç®—å‡ºã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",T.jsx("br",{}),"ï¼ˆé¸æ‰‹ã®RPEã¨ç·´ç¿’æ™‚é–“ã®å…¥åŠ›ãŒå¢—ãˆã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"]})]}),et.length>0&&T.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[T.jsxs("div",{className:"flex items-center justify-between mb-3",children:[T.jsx("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"ä»Šæ—¥ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆæœ€å¤§5äººï¼‰"}),T.jsx("div",{className:"text-xs text-gray-500",children:"ã‚¿ãƒƒãƒ—ã§é¸æ‰‹è©³ç´°"})]}),T.jsx("ul",{className:"space-y-2",children:et.map(e=>T.jsx("li",{children:T.jsxs("button",{onClick:()=>(e=>{const t=pe.find(t=>t.id===e.user_id);if(!t)return void window.alert("é¸æ‰‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");const r=ve.find(e=>e.athlete_user_id===t.id);!r||r.is_sharing_active?I(t):window.alert("ã“ã®é¸æ‰‹ã¯ç¾åœ¨ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰ãŒOFFã§ã™ï¼ˆğŸ”’ï¼‰")})({user_id:e.user_id}),className:"w-full text-left rounded-lg border border-gray-200 hover:bg-gray-50 px-3 py-2 flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsx("div",{className:"font-semibold text-gray-900 truncate",children:e.name}),T.jsxs("div",{className:"text-xs text-gray-700",children:[e.reason,e.meta?T.jsxs("span",{className:"text-gray-500",children:["ï¼ˆ",e.meta,"ï¼‰"]}):null]})]}),T.jsx("span",{className:"shrink-0 text-[11px] px-2 py-1 rounded-full border "+("risk"===e.category?"bg-red-50 text-red-700 border-red-200":"checkin"===e.category?"bg-amber-50 text-amber-700 border-amber-200":"bg-emerald-50 text-emerald-700 border-emerald-200"),children:"risk"===e.category?"æ³¨æ„":"checkin"===e.category?"å£°ã‹ã‘":"ç§°è³›"})]})},e.user_id))})]})]}),Je.length>0&&!Q&&T.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-amber-200 p-4 sm:p-5",children:[T.jsxs("div",{className:"flex items-start justify-between mb-3",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1",children:"ç·´ç¿’è¨˜éŒ²ãŒé€”åˆ‡ã‚Œã¦ã„ã‚‹é¸æ‰‹"}),T.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"æœ€çµ‚è¨˜éŒ²æ—¥ã‹ã‚‰ä¸€å®šæœŸé–“ã€è¨˜éŒ²ãŒãªã„é¸æ‰‹ã®ä¸€è¦§ã§ã™"})]}),T.jsx("button",{onClick:()=>{if("undefined"!=typeof window){const t=`noDataDismissed-${e.id}-${X}`;localStorage.setItem(t,"1")}ee(!0)},className:"text-xs sm:text-sm text-blue-600 hover:text-blue-700 font-medium px-2 py-1 rounded-lg hover:bg-blue-50",children:"ä»Šæ—¥åˆ†ã¯æ—¢èª­ã«ã™ã‚‹"})]}),T.jsx("ul",{className:"space-y-1 sm:space-y-1.5 text-sm sm:text-base",children:Je.map(({athlete:e,daysSinceLast:t})=>T.jsxs("li",{className:"flex items-baseline justify-between border-t border-gray-100 pt-1.5 first:border-t-0 first:pt-0",children:[T.jsx("div",{className:"font-medium text-gray-900 truncate mr-2",children:e.name||e.email}),T.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 whitespace-nowrap",children:["æœ€çµ‚æ—¥ ",e.last_training_date||"-","ï¼ˆ",t,"æ—¥é–“ï¼‰"]})]},e.id))})]}),d&&T.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[T.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 truncate",children:[T.jsxs("span",{className:"hidden sm:inline",children:[d.name," - "]}),T.jsx("span",{className:"sm:hidden",children:"ãƒãƒ¼ãƒ "}),"æ¦‚è¦"]}),T.jsx(Vt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 ml-2"})]}),xe?T.jsx("div",{className:"flex items-center justify-center py-8",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):Ke?T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 sm:gap-6",children:[T.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 sm:p-6 text-center",children:[T.jsx("div",{className:"text-xl sm:text-2xl font-bold text-purple-600 mb-1",children:Ke.averageACWR}),T.jsx("div",{className:"text-xs sm:text-sm text-purple-700",children:"ãƒãƒ¼ãƒ å¹³å‡ACWR"})]}),T.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 sm:p-6 text-center",children:[T.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 mb-1",children:Ke.athleteCount}),T.jsx("div",{className:"text-xs sm:text-sm text-blue-700",children:"ãƒ‡ãƒ¼ã‚¿æœ‰åŠ¹é¸æ‰‹æ•°"})]}),T.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 sm:p-6 text-center",children:[T.jsx("div",{className:"text-xl sm:text-2xl font-bold text-gray-600 mb-1",children:pe.length}),T.jsx("div",{className:"text-xs sm:text-sm text-gray-700",children:"ç·é¸æ‰‹æ•°"})]}),T.jsxs("div",{className:"bg-red-50 rounded-lg p-4 sm:p-6 text-center",children:[T.jsx("div",{className:"text-xl sm:text-2xl font-bold text-red-600 mb-1",children:je.filter(e=>"high"===e.priority).length}),T.jsx("div",{className:"text-xs sm:text-sm text-red-700",children:"é«˜ãƒªã‚¹ã‚¯é¸æ‰‹"})]})]}):T.jsxs("div",{className:"py-6 text-center text-sm text-gray-500",children:["ã¾ã ACWRã‚’è¨ˆç®—ã§ãã‚‹ååˆ†ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",T.jsx("br",{}),"ï¼ˆé¸æ‰‹ã®RPEã¨ç·´ç¿’æ™‚é–“ã‚’å…¥åŠ›ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"]})]}),d&&T.jsxs("div",{className:"bg-white rounded-xl shadow-sm",children:[T.jsxs("div",{className:"border-b border-gray-200",children:[T.jsxs("nav",{className:"hidden sm:flex px-4 sm:px-6 overflow-x-auto",children:[T.jsx("button",{onClick:()=>L("athletes"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap "+("athletes"===P?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"athletes-tab",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(be,{className:"w-4 h-4 mr-2"}),"é¸æ‰‹ä¸€è¦§"]})}),T.jsx("button",{onClick:()=>L("team-average"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("team-average"===P?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"team-average-tab",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(ke,{className:"w-4 h-4 mr-2"}),"ãƒãƒ¼ãƒ å¹³å‡ACWR"]})}),T.jsx("button",{onClick:()=>L("rankings"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("rankings"===P?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(Kt,{className:"w-4 h-4 mr-2"}),"ãƒ©ãƒ³ã‚­ãƒ³ã‚°"]})}),T.jsx("button",{onClick:()=>L("reports"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("reports"===P?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(Xe,{className:"w-4 h-4 mr-2"}),"ãƒ¬ãƒãƒ¼ãƒˆ"]})}),T.jsx("button",{onClick:()=>L("settings"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("settings"===P?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(De,{className:"w-4 h-4 mr-2"}),"è¨­å®šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºï¼‰"]})})]}),T.jsx("div",{className:"sm:hidden px-4 py-3",children:T.jsxs("select",{value:P,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[T.jsx("option",{value:"athletes",children:"é¸æ‰‹ä¸€è¦§"}),T.jsx("option",{value:"team-average",children:"ãƒãƒ¼ãƒ å¹³å‡ACWR"}),T.jsx("option",{value:"rankings",children:"ãƒ©ãƒ³ã‚­ãƒ³ã‚°"}),T.jsx("option",{value:"settings",children:"è¨­å®šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºï¼‰"}),T.jsx("option",{value:"reports",children:"ãƒ¬ãƒãƒ¼ãƒˆ"})]})})]}),T.jsxs("div",{className:"p-4 sm:p-6",children:["athletes"===P&&T.jsxs("div",{children:[T.jsxs("div",{className:"text-xs text-gray-600 mb-3 flex items-center gap-2",children:[T.jsx(ut,{className:"w-4 h-4"}),"å…±æœ‰OFFï¼ˆğŸ”’ï¼‰ã®é¸æ‰‹ã¯ã€è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã‘ã¾ã›ã‚“",j&&T.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"ï¼ˆACWRå–å¾—ä¸­â€¦ï¼‰"})]}),m?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):h?T.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 text-sm text-red-700",children:[T.jsx("div",{className:"font-semibold mb-1",children:"é¸æ‰‹ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"}),T.jsx("div",{className:"mb-3",children:h}),T.jsx("button",{className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",onClick:()=>(null==d?void 0:d.id)&&Ue(d.id),children:"å†å–å¾—"})]}):0===pe.length?T.jsxs("div",{className:"bg-white border rounded-xl p-6 text-center text-gray-600",children:[T.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:"é¸æ‰‹ãŒã¾ã ã„ã¾ã›ã‚“"}),T.jsx("div",{className:"text-sm",children:"ãƒãƒ¼ãƒ ã«é¸æ‰‹ãŒæ‰€å±ã—ã¦ã„ã‚‹ã‹ï¼ˆteam_id / view æ¡ä»¶ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"})]}):T.jsx(qa,{athletes:nt,onAthleteSelect:e=>{const t=ve.find(t=>t.athlete_user_id===e.id);(null==t?void 0:t.is_sharing_active)?I(e):window.alert("ã“ã®é¸æ‰‹ã¯ç¾åœ¨ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰ãŒOFFã§ã™ï¼ˆğŸ”’ï¼‰")},athleteACWRMap:f,weekCardMap:tt,athleteRiskMap:st})]}),"team-average"===P&&T.jsxs("div",{className:"space-y-4",children:[xe?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T.jsx(ln,{name:"TeamACWRChart",children:T.jsx(Qa,{data:he,teamName:(null==d?void 0:d.name)??"",showAvgRPE:H,showAvgLoad:K})}),T.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[T.jsxs("div",{className:"flex items-center justify-between gap-3",children:[T.jsxs("div",{className:"min-w-0",children:[T.jsx("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"é€±ã‚µã‚¤ã‚¯ãƒ«è¡¨ç¤ºï¼ˆ7æ—¥ï¼‰"}),T.jsx("div",{className:"text-xs text-gray-500",children:"æŒ‡å®šæ—¥ã‚’å«ã‚€é€±ï¼ˆæœˆã€œæ—¥ï¼‰ã‚’ã€Œæˆé•·Ã—ç†è§£ã€ã®å‹•ãï¼‹è² è·ã§å¯è¦–åŒ–ã—ã¾ã™"})]}),T.jsx("input",{type:"date",value:R,onChange:e=>$(e.target.value),className:"px-3 py-2 rounded-lg border border-gray-300",title:"ã“ã®æ—¥ä»˜ã‚’å«ã‚€é€±ï¼ˆæœˆã€œæ—¥ï¼‰ã‚’è¡¨ç¤º"})]}),T.jsx("div",{className:"mt-3",children:Oe?T.jsx("div",{className:"flex items-center justify-center py-10",children:T.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):We?T.jsx("div",{className:"text-sm text-red-600",children:We}):T.jsx(ln,{name:"WeeklyGrowthCycleView",children:T.jsx(bn,{teamDaily:Fe,weekLabel:`${qe.start} ã€œ ${qe.end}`})})})]}),T.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:$e?T.jsx("div",{className:"flex items-center justify-center py-10",children:T.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):Ie?T.jsx("div",{className:"text-sm text-red-600",children:Ie}):T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center py-10",children:T.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}),children:T.jsx(ln,{name:"GrowthUnderstandingQuadrantSummary",children:T.jsx(Pn,{data:Te})})})}),T.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:Ee?T.jsx("div",{className:"flex items-center justify-center py-10",children:T.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):Me?T.jsx("div",{className:"text-sm text-red-600",children:Me}):T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center py-10",children:T.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}),children:T.jsx(ln,{name:"GrowthUnderstandingMatrix",children:T.jsx(Ln,{points:Se,teamAvg:Ce})})})})]}),"rankings"===P&&T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center h-64",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:T.jsx(ln,{name:"CoachRankingsView",children:T.jsx(zn,{team:d,onOpenAthlete:(e,t,r,s)=>{F({open:!0,athleteUserId:e,athleteName:s||"åå‰æœªè¨­å®š",testTypeId:t,metricKey:r})}})})}),"settings"===P&&d&&T.jsx("div",{className:"space-y-4",children:T.jsx($n,{teamId:d.id,teamName:d.name})}),"reports"===P&&T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center h-64",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:T.jsx(In,{team:d})})]})]})]})}),A&&T.jsx(Ya,{athlete:A,onClose:()=>I(null),risk:st[A.id],weekCard:tt[A.id]}),O&&T.jsx(an,{alerts:je,onMarkAsRead:async e=>console.log("Mark as read:",e),onDismiss:async e=>console.log("Dismiss alert:",e),onMarkAllAsRead:async()=>console.log("Mark all as read"),onClose:()=>W(!1),userRole:e.role}),B&&d&&T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:T.jsx(An,{team:d,onClose:()=>U(!1)})}),T.jsx(Sn,{open:q.open,onClose:()=>F(e=>({...e,open:!1})),teamId:(null==d?void 0:d.id)??"",athleteUserId:q.athleteUserId,athleteName:q.athleteName,testTypeId:q.testTypeId,metricKey:q.metricKey}),T.jsx(Lr,{steps:ss("staff"),isActive:te,onComplete:ae,onSkip:ne,currentStepIndex:le,onStepChange:ie})]});var lt}function Kn(e){return"global_admin"===e}function Jn({teams:e,onUserInvited:t,restrictToOrganizationId:s,allowAdminInvite:a=!0}){const[n,l]=r.useState([]),[i,o]=r.useState([]),[d,c]=r.useState(!1),[u,x]=r.useState({name:"",email:"",role:"athlete",organizationId:s||"",teamId:""}),[m,g]=r.useState(!1),[h,p]=r.useState(null),[b,y]=r.useState([]),[f,v]=r.useState({}),[j,w]=r.useState(null);r.useEffect(()=>{(async()=>{try{c(!0);const e=(await cn.getOrganizations()||[]).map(e=>({id:e.id,name:e.name,description:e.description??void 0}));l(e),s&&x(e=>({...e,organizationId:s}))}catch(e){console.error("Failed to load organizations:",e)}finally{c(!1)}})()},[s]),r.useEffect(()=>{(async()=>{if(u.organizationId)try{const e=await cn.getOrganizationTeams(u.organizationId);o(e)}catch(e){console.error("Failed to load organization teams:",e),o([])}else o([])})()},[u.organizationId]);const N=e=>{switch(e){case"athlete":return"é¸æ‰‹";case"staff":return"ã‚¹ã‚¿ãƒƒãƒ•";case"global_admin":return"ç®¡ç†è€…";default:return e}};return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx(Xt,{className:"w-6 h-6 text-blue-600"}),T.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…"})]}),b.length>0&&T.jsxs("button",{onClick:()=>{if(0===b.length)return;const e=[["åå‰","ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹","å½¹å‰²","çµ„ç¹”","ãƒãƒ¼ãƒ ","ãƒ¦ãƒ¼ã‚¶ãƒ¼ID","åˆå›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰","æ‹›å¾…URL","æ‹›å¾…æ—¥æ™‚","ãƒ¡ãƒ¼ãƒ«é€ä¿¡"].join(","),...b.map(e=>[e.name,e.email,N(e.role),e.organizationName||"-",e.teamName||"-",e.user_id||"ç”Ÿæˆä¸­",e.temporaryPassword||"-",e.inviteUrl||"-",e.invitedAt,e.emailSent?"é€ä¿¡æ¸ˆã¿":"æœªé€ä¿¡"].join(","))].join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),s=URL.createObjectURL(t);r.setAttribute("href",s),r.setAttribute("download",`æ‹›å¾…æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼_${H()}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm",children:[T.jsx(He,{className:"w-4 h-4"}),T.jsx("span",{children:"æ‹›å¾…å±¥æ­´ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"})]})]}),T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[T.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[T.jsxs("div",{className:"flex items-center mb-6",children:[T.jsx(gt,{className:"w-5 h-5 text-blue-600 mr-2"}),T.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ãƒ•ã‚©ãƒ¼ãƒ "})]}),T.jsxs("form",{onSubmit:async e=>{var r,s,a;e.preventDefault(),g(!0),p(null);try{const{data:{session:e}}=await z.auth.getSession();if(!e)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const{data:o}=await z.from("users").select("name").eq("id",e.user.id).single(),d=null==(r=i.find(e=>e.id===u.teamId))?void 0:r.name,c=null==(s=n.find(e=>e.id===u.organizationId))?void 0:s.name;console.log("ğŸš€ Starting user creation process...");const m="http://127.0.0.1:54321",g={name:u.name,email:u.email,role:u.role,teamId:"athlete"===u.role||"staff"===u.role?u.teamId:void 0,organizationId:u.organizationId||void 0,redirectUrl:`${window.location.origin}/reset-password`};console.log("ğŸ“¤ Sending user creation request...");const h=await fetch(`${m}/functions/v1/create-user`,{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(g)}),b=await h.json();if(!h.ok)throw new Error(b.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ");console.log("âœ… User created successfully");const f=b.passwordSetupLink;if(console.log("ğŸ”— Password setup link received"),!f)throw new Error("Edge Functionã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒªãƒ³ã‚¯ãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ");console.log("âœ… Skipping token storage - using Supabase native password reset flow"),console.log("ğŸ“§ Preparing to send invitation email...");const v=`${window.location.origin}/invite-expired`,j=function(e){const t={athlete:"ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ",staff:"ã‚¹ã‚¿ãƒƒãƒ•",admin:"ç®¡ç†è€…"}[e.role]||e.role;return`\n<!DOCTYPE html>\n<html lang="ja">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Bekutaã¸ã®æ‹›å¾…</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      min-height: 100vh;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0 auto;\n      padding: 40px 20px;\n    }\n    .card {\n      background: white;\n      border-radius: 20px;\n      overflow: hidden;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    }\n    .header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      padding: 50px 30px;\n      text-align: center;\n      position: relative;\n    }\n    .header::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);\n      background-size: 30px 30px;\n    }\n    .icon {\n      background: white;\n      width: 80px;\n      height: 80px;\n      border-radius: 50%;\n      margin: 0 auto 20px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n      position: relative;\n    }\n    .icon svg {\n      width: 40px;\n      height: 40px;\n    }\n    .header h1 {\n      color: white;\n      font-size: 32px;\n      margin: 0 0 10px 0;\n      font-weight: bold;\n    }\n    .header p {\n      color: rgba(255, 255, 255, 0.9);\n      font-size: 18px;\n      margin: 0;\n    }\n    .content {\n      padding: 40px 30px;\n    }\n    .greeting {\n      font-size: 24px;\n      color: #1a202c;\n      margin: 0 0 20px 0;\n      font-weight: 600;\n    }\n    .message {\n      color: #4a5568;\n      line-height: 1.6;\n      margin-bottom: 30px;\n      font-size: 16px;\n    }\n    .info-box {\n      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);\n      border-left: 4px solid #667eea;\n      padding: 20px;\n      margin: 20px 0;\n      border-radius: 8px;\n    }\n    .info-item {\n      margin: 12px 0;\n      display: flex;\n      align-items: start;\n    }\n    .info-label {\n      font-weight: 600;\n      color: #2d3748;\n      min-width: 120px;\n      font-size: 14px;\n    }\n    .info-value {\n      color: #4a5568;\n      font-size: 14px;\n    }\n    .setup-box {\n      background: linear-gradient(135deg, #e6f7ff 0%, #d0edff 100%);\n      border: 2px solid #3b82f6;\n      padding: 25px;\n      margin: 20px 0;\n      border-radius: 12px;\n      text-align: center;\n    }\n    .setup-label {\n      font-size: 16px;\n      color: #1e40af;\n      font-weight: 600;\n      margin-bottom: 15px;\n    }\n    .setup-note {\n      font-size: 13px;\n      color: #1e40af;\n      margin-top: 12px;\n      line-height: 1.5;\n    }\n    .cta-button {\n      display: block;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      text-decoration: none;\n      padding: 18px 40px;\n      border-radius: 12px;\n      font-weight: 600;\n      font-size: 18px;\n      margin: 30px 0;\n      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);\n      transition: all 0.3s ease;\n      text-align: center;\n    }\n    .cta-button:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);\n    }\n    .steps {\n      background: #f7fafc;\n      padding: 25px;\n      border-radius: 12px;\n      margin: 25px 0;\n    }\n    .steps h3 {\n      color: #2d3748;\n      font-size: 18px;\n      margin: 0 0 20px 0;\n      text-align: center;\n    }\n    .step {\n      display: flex;\n      align-items: start;\n      margin: 15px 0;\n      color: #4a5568;\n    }\n    .step-number {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      width: 28px;\n      height: 28px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      margin-right: 12px;\n      flex-shrink: 0;\n      font-size: 14px;\n    }\n    .urgency {\n      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);\n      padding: 15px 20px;\n      border-radius: 10px;\n      margin: 20px 0;\n      text-align: center;\n      border: 2px solid #fdcb6e;\n    }\n    .urgency-icon {\n      font-size: 24px;\n      margin-bottom: 5px;\n    }\n    .urgency-text {\n      color: #7d6608;\n      font-weight: 600;\n      margin: 0;\n      font-size: 14px;\n    }\n    .footer {\n      padding: 30px;\n      text-align: center;\n      color: #718096;\n      font-size: 14px;\n      background: #f7fafc;\n      border-top: 1px solid #e2e8f0;\n    }\n    .footer a {\n      color: #667eea;\n      text-decoration: none;\n    }\n    @media only screen and (max-width: 600px) {\n      .container {\n        padding: 20px 10px;\n      }\n      .header {\n        padding: 30px 20px;\n      }\n      .header h1 {\n        font-size: 24px;\n      }\n      .content {\n        padding: 30px 20px;\n      }\n      .greeting {\n        font-size: 20px;\n      }\n      .cta-button {\n        padding: 16px 30px;\n        font-size: 16px;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <div class="card">\n      <div class="header">\n        <div class="icon">\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 2 L2 7 L12 12 L22 7 L12 2z"/>\n            <polyline points="2 17 12 22 22 17"/>\n            <polyline points="2 12 12 17 22 12"/>\n          </svg>\n        </div>\n        <h1>ã‚ˆã†ã“ãã€${e.name}ã•ã‚“ï¼</h1>\n        ${e.teamName?`<p>${e.teamName} ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™</p>`:"<p>ãƒãƒ¼ãƒ ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™</p>"}\n      </div>\n\n      <div class="content">\n        <p class="greeting">Bekuta ã¸ã®æ‹›å¾…</p>\n\n        <p class="message">\n          ${e.inviterName?`${e.inviterName}ã‹ã‚‰ã€`:""}Bekutaï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã¸ã”æ‹›å¾…ã—ã¾ã™ã€‚<br/>\n          ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã‚’ç§‘å­¦çš„ã«ç®¡ç†ã—ã€æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n        </p>\n\n        <div class="info-box">\n          <div class="info-item">\n            <span class="info-label">ã‚ãªãŸã®å½¹å‰²</span>\n            <span class="info-value">${t}</span>\n          </div>\n          <div class="info-item">\n            <span class="info-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>\n            <span class="info-value">${e.email}</span>\n          </div>\n          ${e.teamName?`\n          <div class="info-item">\n            <span class="info-label">ãƒãƒ¼ãƒ </span>\n            <span class="info-value">${e.teamName}</span>\n          </div>\n          `:""}\n        </div>\n\n        <div class="setup-box">\n          <div class="setup-label">ğŸ” ã¾ãšã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„</div>\n          <div class="setup-note">\n            ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€æœ€åˆã«ã€ŒBekutaã§ä½¿ã†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã‚’è‡ªåˆ†ã§è¨­å®šã—ã¦ã„ãŸã ãã¾ã™ã€‚<br>\n            ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒšãƒ¼ã‚¸ã‚’é–‹ãã€è¨­å®šãŒçµ‚ã‚ã£ãŸã‚‰ Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§\n            <br>ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã¨ã€Œè¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚\n          </div>\n        </div>\n\n        <div class="urgency">\n          <div class="urgency-icon">â°</div>\n          <p class="urgency-text">\n            ã“ã®ãƒªãƒ³ã‚¯ã¯ ${e.expiresInHours}æ™‚é–“å¾Œã«æœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã™ã€‚<br/>\n            æœŸé™ãŒåˆ‡ã‚ŒãŸå ´åˆã¯ã€ç®¡ç†è€…ã«æ–°ã—ã„æ‹›å¾…ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚\n          </p>\n        </div>\n\n        <a href="${e.passwordSetupLink}" class="cta-button">\n          ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹\n        </a>\n\n        <div class="steps">\n          <h3>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>\n          <div class="step">\n            <div class="step-number">1</div>\n            <div>ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒšãƒ¼ã‚¸ã‚’é–‹ã</div>\n          </div>\n          <div class="step">\n            <div class="step-number">2</div>\n            <div>ã‚ãªãŸå°‚ç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ä¿å­˜ã™ã‚‹</div>\n          </div>\n          <div class="step">\n            <div class="step-number">3</div>\n            <div>Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’é–‹ãã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³</div>\n          </div>\n          <div class="step">\n            <div class="step-number">4</div>\n            <div>ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ï¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’é–‹å§‹</div>\n          </div>\n        </div>\n\n        <p class="message" style="font-size: 14px; color: #718096;">\n          ãƒœã‚¿ãƒ³ãŒæ©Ÿèƒ½ã—ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š<br>\n          <span style="word-break: break-all; color: #667eea;">${e.passwordSetupLink}</span>\n        </p>\n      </div>\n\n      <div style="margin-top: 18px; font-size: 13px; color: #4a5568; line-height: 1.6;">\n        ã‚‚ã—ãƒªãƒ³ã‚¯ãŒé–‹ã‘ãªã„ï¼æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ã€ã“ã¡ã‚‰ã‹ã‚‰å†ç™ºè¡Œã§ãã¾ã™ï¼š<br />\n        <a href="${e.inviteExpiredUrl}" style="color:#667eea; text-decoration: underline;">\n          æ‹›å¾…ãƒªãƒ³ã‚¯ã®å†ç™ºè¡Œãƒšãƒ¼ã‚¸ã‚’é–‹ã\n        </a>\n      </div>\n\n      <div class="footer">\n        <p>ã“ã®ãƒ¡ãƒ¼ãƒ«ã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ç„¡è¦–ã—ã¦ã„ãŸã ã„ã¦æ§‹ã„ã¾ã›ã‚“ã€‚</p>\n        <p style="margin-top: 15px;">\n          è³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n        </p>\n        <p style="margin-top: 15px; font-size: 12px; color: #a0aec0;">\n          Â© ${(new Date).getFullYear()} Bekuta. All rights reserved.\n        </p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n  `.trim()}({name:u.name,email:u.email,role:u.role,teamName:d||c,passwordSetupLink:f,inviteExpiredUrl:v,inviterName:null==o?void 0:o.name,expiresInHours:24}),w=function(e){const t={athlete:"ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ",staff:"ã‚¹ã‚¿ãƒƒãƒ•",admin:"ç®¡ç†è€…"}[e.role]||e.role;return`\nBekuta ã¸ã®æ‹›å¾…\n\nã‚ˆã†ã“ãã€${e.name}ã•ã‚“ï¼\n\n${e.inviterName?`${e.inviterName}ã‹ã‚‰ã€`:""}Bekutaï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã¸ã”æ‹›å¾…ã—ã¾ã™ã€‚\n\nã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã‚’ç§‘å­¦çš„ã«ç®¡ç†ã—ã€\næ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\næ‹›å¾…æƒ…å ±\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nã‚ãªãŸã®å½¹å‰²: ${t}\nãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ${e.email}\n${e.teamName?`ãƒãƒ¼ãƒ : ${e.teamName}\n`:""}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€ã¾ãš Bekuta ã§ä½¿ã†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\nè¨­å®šå¾Œã¯ã€Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§\nã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã¨ã€Œè¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n1. ä»¥ä¸‹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒšãƒ¼ã‚¸ã‚’é–‹ã\n   ${e.passwordSetupLink}\n\n2. ã‚ãªãŸå°‚ç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€ã€Œä¿å­˜ã€ã™ã‚‹\n\n3. Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’é–‹ãã€\n   ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹\n\n4. ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ï¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’é–‹å§‹\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ° ã“ã®ãƒªãƒ³ã‚¯ã¯ ${e.expiresInHours}æ™‚é–“å¾Œã«æœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã™ã€‚\n   æœŸé™ãŒåˆ‡ã‚ŒãŸå ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«\n   æ–°ã—ã„æ‹›å¾…ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã®ç™ºè¡Œã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚\n\n  ãƒªãƒ³ã‚¯ãŒé–‹ã‘ãªã„ï¼æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ã€ã“ã¡ã‚‰ã‹ã‚‰å†ç™ºè¡Œã§ãã¾ã™ï¼š\n  ${e.inviteExpiredUrl}\n\nã“ã®ãƒ¡ãƒ¼ãƒ«ã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ç„¡è¦–ã—ã¦ã„ãŸã ã„ã¦æ§‹ã„ã¾ã›ã‚“ã€‚\nè³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n\nÂ© ${(new Date).getFullYear()} Bekuta\n  `.trim()}({name:u.name,email:u.email,role:u.role,teamName:d||c,passwordSetupLink:f,inviteExpiredUrl:v,inviterName:null==o?void 0:o.name,expiresInHours:24});let N=!1,k="";try{console.log("ğŸ“§ Sending invitation email to:",u.email);const t=await fetch(`${m}/functions/v1/send-email`,{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({to:u.email,subject:`ã€Bekutaã€‘ ${d||c||"Bekuta"}åˆå›ãƒ­ã‚°ã‚¤ãƒ³è¨­å®šã®ã”æ¡ˆå†…`,html:j,text:w})}),r=await t.json();N=t.ok,N?console.log("âœ… Email sent successfully to:",u.email):(k=r.error||"Unknown error",console.error("âŒ Email sending failed:",{status:t.status,error:k,result:r}))}catch(l){k=l.message||"Network error",console.error("âŒ Email sending exception:",l)}const _={name:u.name,email:u.email,role:u.role,teamName:d,organizationName:c,user_id:null==(a=b.user)?void 0:a.user_id,invitedAt:(new Date).toLocaleString("ja-JP"),emailSent:N,inviteUrl:f};y(e=>[_,...e]),p({type:"success",text:N?`${u.name}ã•ã‚“ï¼ˆ${u.email}ï¼‰ã‚’æ‹›å¾…ã—ã¾ã—ãŸã€‚æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚`:`${u.name}ã•ã‚“ï¼ˆ${u.email}ï¼‰ã‚’æ‹›å¾…ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ãŸãŸã‚ã€æ‹›å¾…URLã‚’ç›´æ¥å…±æœ‰ã—ã¦ãã ã•ã„ã€‚`}),x({name:"",email:"",role:"athlete",organizationId:"",teamId:""}),t()}catch(o){console.error("User invitation error:",o),p({type:"error",text:o.message||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ"})}finally{g(!1)}},className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åå‰"}),T.jsx("input",{type:"text",value:u.name,onChange:e=>x(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ç”°ä¸­å¤ªéƒ",required:!0})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsx("input",{type:"email",value:u.email,onChange:e=>x(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"tanaka@example.com",required:!0})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å½¹å‰²"}),T.jsxs("select",{value:u.role,onChange:e=>{const t=e.target.value;x(e=>({...e,role:t,teamId:"global_admin"===t?"":e.teamId}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[T.jsx("option",{value:"athlete",children:"é¸æ‰‹"}),T.jsx("option",{value:"staff",children:"ã‚¹ã‚¿ãƒƒãƒ•"}),a&&T.jsx("option",{value:"global_admin",children:"ç®¡ç†è€…"})]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[T.jsx(Ee,{className:"w-4 h-4 text-blue-600"}),T.jsx("span",{children:"çµ„ç¹”"})]}),T.jsxs("select",{value:u.organizationId,onChange:e=>x(t=>({...t,organizationId:e.target.value,teamId:""})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:d||!!s,children:[T.jsx("option",{value:"",children:d?"èª­ã¿è¾¼ã¿ä¸­...":"çµ„ç¹”ã‚’é¸æŠ"}),n.filter(e=>!s||e.id===s).map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))]}),T.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã“ã®çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒãƒ¼ãƒ "}),T.jsxs("select",{value:u.teamId,onChange:e=>x(t=>({...t,teamId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:"athlete"===u.role,disabled:"global_admin"===u.role||!u.organizationId,children:[T.jsx("option",{value:"",children:"global_admin"===u.role?"ç®¡ç†è€…ã¯ãƒãƒ¼ãƒ ä¸è¦":u.organizationId?"ãƒãƒ¼ãƒ ã‚’é¸æŠ":"å…ˆã«çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),i.map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))]}),"global_admin"===u.role&&T.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ç®¡ç†è€…ã¯å…¨ã¦ã®ãƒãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™"}),"global_admin"!==u.role&&!u.organizationId&&T.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"å…ˆã«çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"})]}),h&&T.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg "+("success"===h.type?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"),children:["success"===h.type?T.jsx(Re,{className:"w-5 h-5 flex-shrink-0"}):T.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),T.jsx("span",{className:"text-sm",children:h.text})]}),T.jsxs("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:[m?T.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):T.jsx(gt,{className:"w-5 h-5 mr-2"}),m?"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­...":"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡"]})]})]}),T.jsxs("div",{className:"space-y-6",children:[T.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start",children:[T.jsx(lt,{className:"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0"}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ã«ã¤ã„ã¦"}),T.jsxs("div",{className:"text-sm text-blue-700 space-y-2",children:[T.jsx("p",{children:"1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚"}),T.jsx("p",{children:"2. ãƒ¡ãƒ¼ãƒ«ã«ã¯ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šç”¨ãƒªãƒ³ã‚¯ã€ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚"}),T.jsx("p",{children:"3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒªãƒ³ã‚¯å…ˆã§è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚"}),T.jsx("p",{children:"4.  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã‚·ã‚¹ãƒ†ãƒ ä¸Šã«ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚å†ç™ºè¡Œã¯å†åº¦ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã€ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚"}),T.jsx("p",{children:"5. æ‹›å¾…ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ã¯24æ™‚é–“ã§ã™ã€‚æœ‰åŠ¹æœŸé™åˆ‡ã‚Œã®å ´åˆã¯å†åº¦æ‹›å¾…ã—ã¦ãã ã•ã„ã€‚"})]})]})]})}),T.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[T.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"å½¹å‰²ã®èª¬æ˜"}),T.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[T.jsxs("div",{className:"flex items-start",children:[T.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"}),T.jsxs("div",{children:[T.jsx("strong",{children:"é¸æ‰‹:"})," è‡ªåˆ†ã®ç·´ç¿’è¨˜éŒ²ã®å…¥åŠ›ã¨é–²è¦§ã®ã¿å¯èƒ½"]})]}),T.jsxs("div",{className:"flex items-start",children:[T.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0"}),T.jsxs("div",{children:[T.jsx("strong",{children:"ã‚¹ã‚¿ãƒƒãƒ•:"})," æ‹…å½“ãƒãƒ¼ãƒ ã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ãƒ»ç®¡ç†å¯èƒ½"]})]}),T.jsxs("div",{className:"flex items-start",children:[T.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full mt-2 mr-3 flex-shrink-0"}),T.jsxs("div",{children:[T.jsx("strong",{children:"ç®¡ç†è€…:"})," å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãŒå¯èƒ½"]})]})]})]}),b.length>0&&T.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsx("h4",{className:"font-medium text-gray-900",children:"æœ€è¿‘ã®æ‹›å¾…å±¥æ­´"}),T.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:[b.length,"ä»¶"]})]}),T.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:b.slice(0,10).map((e,t)=>T.jsxs("div",{className:"bg-gray-50 rounded p-3",children:[T.jsxs("div",{className:"flex items-center justify-between mb-1",children:[T.jsx("span",{className:"font-medium text-gray-900",children:e.name}),T.jsx("span",{className:"text-xs text-gray-500",children:e.invitedAt})]}),T.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[T.jsx("p",{children:e.email}),T.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[T.jsx("span",{children:N(e.role)}),e.organizationName&&T.jsxs("span",{className:"flex items-center gap-1",children:["â€¢ ",T.jsx(Ee,{className:"w-3 h-3"})," ",e.organizationName]}),e.teamName&&T.jsxs("span",{children:["â€¢ ",e.teamName]}),e.user_id&&T.jsx("span",{className:"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:e.user_id}),e.emailSent?T.jsxs("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs flex items-center space-x-1",children:[T.jsx(gt,{className:"w-3 h-3"}),T.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ¸ˆã¿"})]}):T.jsxs("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-xs flex items-center space-x-1",children:[T.jsx(ye,{className:"w-3 h-3"}),T.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«æœªé€ä¿¡"})]})]}),e.temporaryPassword&&T.jsxs("div",{className:"flex items-center space-x-2 bg-yellow-50 border border-yellow-200 p-2 rounded",children:[T.jsx("span",{className:"text-xs font-medium text-yellow-800",children:"åˆå›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:"}),T.jsx("code",{className:"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-yellow-300",children:f[t]?e.temporaryPassword:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),T.jsx("button",{onClick:()=>v(e=>({...e,[t]:!e[t]})),className:"p-1 hover:bg-yellow-100 rounded transition-colors",title:f[t]?"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’éš ã™":"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¡¨ç¤º",children:f[t]?T.jsx(Ye,{className:"w-4 h-4 text-yellow-700"}):T.jsx(Ge,{className:"w-4 h-4 text-yellow-700"})}),T.jsx("button",{onClick:()=>(async(e,t)=>{try{await navigator.clipboard.writeText(e),w(t),setTimeout(()=>w(null),2e3)}catch(r){console.error("Failed to copy password:",r)}})(e.temporaryPassword,t),className:"p-1 hover:bg-yellow-100 rounded transition-colors",title:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼",children:T.jsx(Be,{className:"w-4 h-4 "+(j===t?"text-green-600":"text-yellow-700")})})]}),e.inviteUrl&&T.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 p-2 rounded",children:[T.jsx("span",{className:"text-xs font-medium text-blue-800",children:"æ‹›å¾…URL:"}),T.jsx("code",{className:"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-blue-300 truncate",children:e.inviteUrl}),T.jsx("button",{onClick:()=>(async(e,t)=>{try{await navigator.clipboard.writeText(e),w(t+1e3),setTimeout(()=>w(null),2e3)}catch(r){console.error("Failed to copy URL:",r)}})(e.inviteUrl,t),className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"æ‹›å¾…URLã‚’ã‚³ãƒ”ãƒ¼",children:T.jsx(Be,{className:"w-4 h-4 "+(j===t+1e3?"text-green-600":"text-blue-700")})}),T.jsx("a",{href:e.inviteUrl,className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"æ‹›å¾…ãƒšãƒ¼ã‚¸ã‚’é–‹ãï¼ˆåŒã˜ã‚¿ãƒ–ã§é–‹ãã¾ã™ï¼‰",children:T.jsx(dt,{className:"w-4 h-4 text-blue-700"})})]})]})]},t))})]})]})]})]})}function Yn({teams:e,onUsersInvited:t,restrictToOrganizationId:s,allowAdminInvite:a=!0}){const[n,l]=r.useState(null),[i,o]=r.useState(!1),[d,c]=r.useState([]),[u,x]=r.useState(!1),m=d.filter(e=>"success"===e.status).length,g=d.filter(e=>"error"===e.status).length;return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx(rr,{className:"w-6 h-6 text-purple-600"}),T.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€æ‹¬æ‹›å¾…"})]}),T.jsxs("button",{onClick:()=>{const e=[["ç”°ä¸­å¤ªéƒ","tanaka@example.com","athlete","æ„›å·¥å¤§åé›»é«˜æ ¡","ã‚µãƒƒã‚«ãƒ¼éƒ¨"],["ä½è—¤èŠ±å­","sato@example.com","staff","æ„›å·¥å¤§åé›»é«˜æ ¡","ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«éƒ¨"],a?["ç®¡ç†è€…","admin@example.com","global_admin","æ„›å·¥å¤§åé›»é«˜æ ¡",""]:null].filter(Boolean),t=["# Bekuta ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€æ‹¬æ‹›å¾…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ","# æ³¨æ„äº‹é …:",a?"# - role ã¯ athlete, staff, global_admin ã®ã„ãšã‚Œã‹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„":"# - role ã¯ athlete, staff ã®ã„ãšã‚Œã‹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„","# - organizationName ã¯ç®¡ç†ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çµ„ç¹”åã¨å®Œå…¨ã«åŒã˜æ–‡å­—åˆ—ã§å…¥åŠ›ã—ã¦ãã ã•ã„","# - athlete ã®å ´åˆã¯ team_name ã‚’å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„","# - staff ã®å ´åˆã‚‚ team_name ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼ˆæŒ‡å®šã—ãŸãƒãƒ¼ãƒ ã‚’ç®¡ç†ã—ã¾ã™ï¼‰","# - global_admin ã®å ´åˆã¯ team_name ã¯ç©ºç™½ã§ã‚‚æ§‹ã„ã¾ã›ã‚“","",["name","email","role","organizationName","team_name"].join(","),...e.map(e=>e.join(","))].filter(Boolean).join("\n"),r=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(r);s.setAttribute("href",n),s.setAttribute("download","ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€æ‹¬æ‹›å¾…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.csv"),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm",children:[T.jsx(He,{className:"w-4 h-4"}),T.jsx("span",{children:"CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"})]})]}),T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[T.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:T.jsxs("div",{className:"text-center",children:[T.jsx(Yt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),T.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),T.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å«ã‚€CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„"}),T.jsx("input",{type:"file",accept:".csv",onChange:e=>{var t;const r=(null==(t=e.target.files)?void 0:t[0])||null;l(r),x(!1),c([])},className:"hidden",id:"csv-upload"}),T.jsxs("label",{htmlFor:"csv-upload",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg cursor-pointer transition-colors inline-flex items-center space-x-2",children:[T.jsx(Ze,{className:"w-5 h-5"}),T.jsx("span",{children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"})]}),n&&T.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:T.jsxs("p",{className:"text-sm text-green-700",children:["é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:"," ",T.jsx("strong",{children:n.name})]})}),n&&T.jsxs("button",{onClick:async()=>{if(n){o(!0);try{const r=(e=>{const t=e.split("\n").map(e=>e.trim()).filter(e=>e&&!e.startsWith("#"));if(t.length<2)throw new Error("CSVã«ãƒ‡ãƒ¼ã‚¿è¡ŒãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‹1è¡Œä»¥ä¸Šå¿…è¦ã§ã™ï¼‰");const r=t[0].split(",").map(e=>e.trim().replace(/^"|"$/g,"")),s=e=>r.findIndex(t=>e.some(e=>t.toLowerCase()===e.toLowerCase())),n=s(["name"]),l=s(["email"]),i=s(["role"]),o=s(["organizationname","organization","organization_name"]),d=s(["team_name","team"]);if(-1===n||-1===l||-1===i||-1===o)throw new Error("CSVã«ã¯ name, email, role, organizationName ã®4åˆ—ãŒå¿…è¦ã§ã™");const c=[];for(let u=1;u<t.length;u++){const e=t[u].split(",").map(e=>e.trim().replace(/^"|"$/g,""));if(!(e[n]&&e[l]&&e[i]&&e[o]))continue;const r=e[i].toLowerCase();(a?["athlete","staff","global_admin"]:["athlete","staff"]).includes(r)&&c.push({name:e[n],email:e[l],role:r,organizationName:e[o],teamName:-1!==d&&e[d]||void 0})}if(0===c.length)throw new Error("CSVã«æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");return c})(await n.text()),l=await(async t=>{var r;const{data:{session:a}}=await z.auth.getSession();if(!a)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã—ã¦ãã ã•ã„ï¼‰");let n=z.from("organizations").select("id, name");s&&(n=n.eq("id",s));const{data:l,error:i}=await n;if(i||!l||0===l.length)throw new Error("çµ„ç¹”ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");const o="http://127.0.0.1:54321",d=[];for(const x of t){try{const t=l.find(e=>e.name===x.organizationName);if(!t){d.push({...x,status:"error",message:`çµ„ç¹” "${x.organizationName}" ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`});continue}if(s&&t.id!==s){d.push({...x,status:"error",message:`ã“ã®ç”»é¢ã‹ã‚‰ã¯çµ„ç¹”ID "${s}" ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿æ‹›å¾…ã§ãã¾ã™ï¼ˆCSVä¸Šã®çµ„ç¹”: ${x.organizationName}ï¼‰`});continue}let n;if(x.teamName){const r=e.find(e=>e.name===x.teamName&&e.organization_id===t.id);if(!r){d.push({...x,status:"error",message:`çµ„ç¹” "${t.name}" ã«ãƒãƒ¼ãƒ  "${x.teamName}" ã¯å­˜åœ¨ã—ã¾ã›ã‚“`});continue}n=r.id}if("athlete"===x.role&&!n){d.push({...x,status:"error",message:"athleteï¼ˆé¸æ‰‹ï¼‰ã«ã¯ team_nameï¼ˆãƒãƒ¼ãƒ åï¼‰ã®æŒ‡å®šãŒå¿…é ˆã§ã™"});continue}console.log("ğŸš€ Creating user:",x.email);const i=await fetch(`${o}/functions/v1/create-user`,{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({name:x.name,email:x.email,role:x.role,teamId:n,organizationId:t.id,redirectUrl:`${window.location.origin}/reset-password`})}),u=await i.json();if(!i.ok){console.error("âŒ create-user error:",u),d.push({...x,status:"error",message:u.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ"});continue}const m=u.passwordSetupLink;if(!m){d.push({...x,status:"error",message:"Edge Function ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒªãƒ³ã‚¯ãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"});continue}let g=!1,h="";try{console.log("ğŸ“§ Sending invitation email to:",x.email);const e=await fetch(`${o}/functions/v1/send-email`,{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({to:x.email,type:"invitation",data:{name:x.name,email:x.email,role:x.role,teamName:x.teamName,passwordSetupLink:m,expiresInHours:24}})}),t=await e.json();g=e.ok,g?console.log("âœ… Email sent successfully to:",x.email):(h=t.error||"Unknown error",console.error("âŒ Invitation email failed:",{status:e.status,error:h,result:t}))}catch(c){h=c.message||"Network error",console.error("âŒ Invitation email exception:",c)}d.push({...x,status:g?"success":"error",message:g?"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†":`ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå®Œäº†ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—: ${h}ï¼‰`,user_id:null==(r=u.user)?void 0:r.user_id,teamId:n})}catch(u){console.error("âŒ Bulk invite error for row:",x,u),d.push({...x,status:"error",message:u.message||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"})}await new Promise(e=>setTimeout(e,2e3))}return d})(r);c(l),x(!0);l.filter(e=>"success"===e.status).length>0&&t()}catch(r){console.error("Bulk invitation error:",r),alert(`ä¸€æ‹¬æ‹›å¾…ã‚¨ãƒ©ãƒ¼: ${r.message}`)}finally{o(!1)}}},disabled:i,className:"mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:[i?T.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):T.jsx(gt,{className:"w-5 h-5 mr-2"}),i?"æ‹›å¾…å‡¦ç†ä¸­...":"ä¸€æ‹¬æ‹›å¾…å®Ÿè¡Œ"]})]})}),T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[T.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"CSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼"}),T.jsxs("div",{className:"text-sm text-blue-700 space-y-2",children:[T.jsx("p",{children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®åˆ—ãŒå¿…è¦ã§ã™ï¼š"}),T.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[T.jsxs("li",{children:[T.jsx("strong",{children:"name:"})," ãƒ¦ãƒ¼ã‚¶ãƒ¼å"]}),T.jsxs("li",{children:[T.jsx("strong",{children:"email:"})," ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"]}),T.jsxs("li",{children:[T.jsx("strong",{children:"role:"})," athlete, staff, global_admin ã®ã„ãšã‚Œã‹"]}),T.jsxs("li",{children:[T.jsx("strong",{children:"organizationName:"})," çµ„ç¹”åï¼ˆç®¡ç†ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹åç§°ã¨å®Œå…¨ä¸€è‡´ï¼‰"]}),T.jsxs("li",{children:[T.jsx("strong",{children:"team_name:"})," ãƒãƒ¼ãƒ åï¼ˆathlete ã¯å¿…é ˆ / staff æ¨å¥¨ï¼‰"]})]})]})]}),T.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[T.jsx("h4",{className:"font-medium text-amber-900 mb-3",children:"æ³¨æ„äº‹é …"}),T.jsxs("div",{className:"text-sm text-amber-700 space-y-1",children:[T.jsx("p",{children:"â€¢ å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™"}),T.jsx("p",{children:"â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™"}),T.jsx("p",{children:"â€¢ çµ„ç¹”åã¨ãƒãƒ¼ãƒ åã¯ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®åç§°ã¨å®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"}),T.jsx("p",{children:"â€¢ å‡¦ç†ã«ã¯æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™"})]})]}),u&&T.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsx("h4",{className:"font-medium text-gray-900",children:"å‡¦ç†çµæœ"}),T.jsxs("button",{onClick:()=>{if(0===d.length)return;const e=[`# ä¸€æ‹¬æ‹›å¾…çµæœ - ${(new Date).toLocaleString("ja-JP")}`,`# æˆåŠŸ: ${d.filter(e=>"success"===e.status).length}ä»¶`,`# å¤±æ•—: ${d.filter(e=>"error"===e.status).length}ä»¶`,"",["åå‰","ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹","å½¹å‰²","çµ„ç¹”","ãƒãƒ¼ãƒ ","ãƒ¦ãƒ¼ã‚¶ãƒ¼ID","çŠ¶æ…‹","ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"].join(","),...d.map(e=>[e.name,e.email,"athlete"===e.role?"é¸æ‰‹":"staff"===e.role?"ã‚¹ã‚¿ãƒƒãƒ•":"ç®¡ç†è€…",e.organizationName,e.teamName||"-",e.user_id||"-","success"===e.status?"æˆåŠŸ":"å¤±æ•—",e.message].join(","))].join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),s=URL.createObjectURL(t);r.setAttribute("href",s),r.setAttribute("download",`ä¸€æ‹¬æ‹›å¾…çµæœ_${H()}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center space-x-1",children:[T.jsx(He,{className:"w-3 h-3"}),T.jsx("span",{children:"çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"})]})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[T.jsxs("div",{className:"bg-green-50 rounded p-3 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-green-600",children:m}),T.jsx("div",{className:"text-sm text-green-700",children:"æˆåŠŸ"})]}),T.jsxs("div",{className:"bg-red-50 rounded p-3 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-red-600",children:g}),T.jsx("div",{className:"text-sm text-red-700",children:"å¤±æ•—"})]})]}),T.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:d.map((e,t)=>T.jsx("div",{className:"p-3 rounded border "+("success"===e.status?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:T.jsx("div",{className:"flex items-center justify-between",children:T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center space-x-2",children:["success"===e.status?T.jsx(Re,{className:"w-4 h-4 text-green-600"}):T.jsx(ye,{className:"w-4 h-4 text-red-600"}),T.jsx("span",{className:"font-medium",children:e.name}),e.user_id&&T.jsx("span",{className:"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:e.user_id})]}),T.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.email," â€¢ ",e.role," ","â€¢ ",e.organizationName,e.teamName&&` â€¢ ${e.teamName}`]}),T.jsx("div",{className:"text-xs mt-1 "+("success"===e.status?"text-green-600":"text-red-600"),children:e.message})]})})},t))})]})]})]})]})}function Gn({data:e,itemsPerPage:t=20,renderItem:s,renderHeader:a,loading:n=!1,emptyMessage:l="ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}){const[i,o]=r.useState(1),d=Math.ceil(e.length/t),c=(i-1)*t,u=c+t,m=r.useMemo(()=>e.slice(c,u),[e,c,u]),g=e=>{e>=1&&e<=d&&o(e)};return n?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):0===e.length?T.jsx("div",{className:"text-center py-12",children:T.jsx("p",{className:"text-gray-500",children:l})}):T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[T.jsxs("div",{children:[c+1," - ",Math.min(u,e.length)," / ",e.length,"ä»¶ã‚’è¡¨ç¤º"]}),T.jsxs("div",{children:["ãƒšãƒ¼ã‚¸ ",i," / ",d]})]}),a&&a(),T.jsx("div",{className:"space-y-2",children:m.map((e,t)=>s(e,c+t))}),d>1&&T.jsxs("div",{className:"flex items-center justify-center space-x-2 py-4",children:[T.jsx("button",{onClick:()=>g(1),disabled:1===i,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"æœ€åˆã®ãƒšãƒ¼ã‚¸",children:T.jsx(Le,{className:"w-4 h-4"})}),T.jsx("button",{onClick:()=>g(i-1),disabled:1===i,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"å‰ã®ãƒšãƒ¼ã‚¸",children:T.jsx(Ie,{className:"w-4 h-4"})}),T.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const e=[],t=[];for(let r=Math.max(2,i-2);r<=Math.min(d-1,i+2);r++)e.push(r);return i-2>2?t.push(1,"..."):t.push(1),t.push(...e),i+2<d-1?t.push("...",d):d>1&&t.push(d),t})().map((e,t)=>T.jsx(x.Fragment,{children:"..."===e?T.jsx("span",{className:"px-3 py-2 text-gray-500",children:"..."}):T.jsx("button",{onClick:()=>g(e),className:"px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(i===e?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"),children:e})},t))}),T.jsx("button",{onClick:()=>g(i+1),disabled:i===d,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"æ¬¡ã®ãƒšãƒ¼ã‚¸",children:T.jsx(ze,{className:"w-4 h-4"})}),T.jsx("button",{onClick:()=>g(d),disabled:i===d,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"æœ€å¾Œã®ãƒšãƒ¼ã‚¸",children:T.jsx(qe,{className:"w-4 h-4"})})]}),T.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm",children:[T.jsx("span",{className:"text-gray-600",children:"è¡¨ç¤ºä»¶æ•°:"}),T.jsxs("select",{value:t,onChange:e=>{parseInt(e.target.value),o(1)},className:"border border-gray-300 rounded px-2 py-1",children:[T.jsx("option",{value:10,children:"10ä»¶"}),T.jsx("option",{value:20,children:"20ä»¶"}),T.jsx("option",{value:50,children:"50ä»¶"}),T.jsx("option",{value:100,children:"100ä»¶"})]})]})]})}function Zn({user:e,teams:t,onClose:s,onUserUpdated:a}){const[n,l]=r.useState({name:e.name,email:e.email,role:e.role,teamId:e.team_id||""}),[i,o]=r.useState(!1),[d,c]=r.useState(null),[u,x]=r.useState([]),[m,g]=r.useState(!1);r.useEffect(()=>{"staff"===e.role&&h()},[e.id,e.role]);const h=async()=>{try{const{data:t,error:r}=await z.from("staff_team_links").select("\n          team_id,\n          teams (\n            id,\n            name\n          )\n        ").eq("staff_user_id",e.id);if(r)return void console.error("Error fetching staff teams:",r);const s=null==t?void 0:t.map(e=>e.teams).filter(Boolean);x(s||[]),g((s||[]).length>1),s&&s.length>0&&l(e=>({...e,teamId:s[0].id}))}catch(t){console.error("Error fetching staff teams:",t)}};return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:T.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[T.jsx("div",{className:"bg-blue-600 text-white p-6 rounded-t-2xl",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("h2",{className:"text-xl font-bold",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†"}),T.jsx("button",{onClick:s,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:T.jsx(ar,{className:"w-5 h-5"})})]})}),T.jsxs("div",{className:"p-6",children:[m&&T.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:T.jsxs("div",{className:"flex items-start",children:[T.jsx(fe,{className:"w-5 h-5 text-amber-600 mr-3 mt-0.5 flex-shrink-0"}),T.jsxs("div",{className:"flex-1",children:[T.jsxs("h3",{className:"font-medium text-amber-900 mb-2 flex items-center",children:[T.jsx(rr,{className:"w-4 h-4 mr-1"}),"è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ã‚¹ã‚¿ãƒƒãƒ•"]}),T.jsxs("div",{className:"text-sm text-amber-700 space-y-2",children:[T.jsx("p",{children:"ã“ã®ã‚¹ã‚¿ãƒƒãƒ•ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ï¼š"}),T.jsx("div",{className:"bg-amber-100 rounded p-2",children:u.map((e,t)=>T.jsxs("div",{className:"flex items-center",children:[T.jsx("span",{className:"w-2 h-2 bg-amber-600 rounded-full mr-2"}),T.jsx("span",{className:"font-medium",children:e.name})]},e.id))}),T.jsxs("div",{className:"bg-white border border-amber-300 rounded p-3 mt-3",children:[T.jsx("p",{className:"font-medium text-amber-900 mb-1",children:"âš ï¸ ç·¨é›†æ™‚ã®æ³¨æ„"}),T.jsxs("ul",{className:"text-xs space-y-1",children:[T.jsx("li",{children:"â€¢ ãƒãƒ¼ãƒ å¤‰æ›´ã¯æœ€åˆã®ãƒãƒ¼ãƒ ã®ã¿è¨­å®šã•ã‚Œã¾ã™"}),T.jsx("li",{children:"â€¢ è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ã‚’ç¶­æŒã™ã‚‹ã«ã¯Supabaseå´ã§è¨­å®šãŒå¿…è¦"}),T.jsx("li",{children:"â€¢ å½¹å‰²å¤‰æ›´æ™‚ã¯å…¨ã¦ã®ãƒãƒ¼ãƒ é–¢é€£ä»˜ã‘ãŒå‰Šé™¤ã•ã‚Œã¾ã™"})]})]})]})]})]})}),T.jsxs("form",{onSubmit:async t=>{t.preventDefault(),o(!0),c(null);try{const{data:{session:t}}=await z.auth.getSession();if(!t)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r="http://127.0.0.1:54321",s=await fetch(`${r}/functions/v1/update-user`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,name:n.name,email:n.email,role:n.role,teamId:n.teamId||void 0})}),l=await s.json();if(!s.ok)throw new Error(l.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");c({type:"success",text:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚"}),setTimeout(()=>{a()},1e3)}catch(r){console.error("Error updating user:",r),c({type:"error",text:`æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`})}finally{o(!1)}},className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åå‰"}),T.jsx("input",{type:"text",value:n.name,onChange:e=>l(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsx("input",{type:"email",value:n.email,onChange:e=>l(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["å½¹å‰²",m&&T.jsx("span",{className:"ml-2 text-xs text-amber-600 font-normal",children:"âš ï¸ å¤‰æ›´ã™ã‚‹ã¨è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ãŒè§£é™¤ã•ã‚Œã¾ã™"})]}),T.jsxs("select",{value:n.role,onChange:e=>{const t=e.target.value;l(e=>({...e,role:t,teamId:"global_admin"===t?"":e.teamId}))},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(m?"border-amber-300 bg-amber-50":"border-gray-300"),children:[T.jsx("option",{value:"athlete",children:"é¸æ‰‹"}),T.jsx("option",{value:"staff",children:"ã‚¹ã‚¿ãƒƒãƒ•"}),T.jsx("option",{value:"global_admin",children:"ç®¡ç†è€…"})]})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ãƒãƒ¼ãƒ ",m&&"staff"===n.role&&T.jsx("span",{className:"ml-2 text-xs text-amber-600 font-normal",children:"âš ï¸ æœ€åˆã®ãƒãƒ¼ãƒ ã®ã¿è¨­å®šã•ã‚Œã¾ã™"})]}),T.jsxs("select",{value:n.teamId,onChange:e=>l(t=>({...t,teamId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(m&&"staff"===n.role?"border-amber-300 bg-amber-50":"border-gray-300"),required:"athlete"===n.role,disabled:"global_admin"===n.role,children:[T.jsx("option",{value:"",children:"global_admin"===n.role?"ç®¡ç†è€…ã¯ãƒãƒ¼ãƒ ä¸è¦":"ãƒãƒ¼ãƒ ã‚’é¸æŠ"}),t.map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))]}),"global_admin"===n.role&&T.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ç®¡ç†è€…ã¯å…¨ã¦ã®ãƒãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™"}),"staff"===n.role&&!m&&T.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ã‚¹ã‚¿ãƒƒãƒ•ã¯é¸æŠã—ãŸãƒãƒ¼ãƒ ã‚’ç®¡ç†ã§ãã¾ã™"}),m&&"staff"===n.role&&T.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ã‚’ç¶­æŒã™ã‚‹ã«ã¯ã€Supabaseå´ã§å†è¨­å®šãŒå¿…è¦ã§ã™"})]}),d&&T.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg "+("success"===d.type?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"),children:["success"===d.type?T.jsx(Re,{className:"w-5 h-5 flex-shrink-0"}):T.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),T.jsx("span",{className:"text-sm",children:d.text})]}),T.jsxs("div",{className:"flex space-x-3 pt-4",children:[T.jsx("button",{type:"button",onClick:s,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsxs("button",{type:"submit",disabled:i,className:"flex-1 py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center "+(m?"bg-amber-600 hover:bg-amber-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"),children:[i?T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):T.jsx(Dt,{className:"w-4 h-4 mr-2"}),i?"æ›´æ–°ä¸­...":m?"æ³¨æ„ã—ã¦æ›´æ–°":"æ›´æ–°"]})]})]})]})]})})}function Xn({user:e,onClose:t,onUserDeleted:s}){const[a,n]=r.useState(!1),[l,i]=r.useState(""),[o,d]=r.useState(null);return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:T.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:[T.jsx("div",{className:"bg-red-600 text-white p-6 rounded-t-2xl",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center",children:[T.jsx(fe,{className:"w-6 h-6 mr-3"}),T.jsx("h2",{className:"text-xl font-bold",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤"})]}),T.jsx("button",{onClick:t,className:"bg-red-500 hover:bg-red-400 rounded-full p-2 transition-colors",children:T.jsx(ar,{className:"w-5 h-5"})})]})}),T.jsxs("div",{className:"p-6",children:[T.jsxs("div",{className:"mb-6",children:[T.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:T.jsxs("div",{className:"flex items-start",children:[T.jsx(fe,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-medium text-red-900 mb-2",children:"è­¦å‘Š: ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“"}),T.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[T.jsx("p",{children:"â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™"}),T.jsx("p",{children:"â€¢ é–¢é€£ã™ã‚‹ç·´ç¿’è¨˜éŒ²ã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™"}),T.jsx("p",{children:"â€¢ ãƒãƒ¼ãƒ ã¨ã®é–¢é€£ä»˜ã‘ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™"})]})]})]})}),T.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[T.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"å‰Šé™¤å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼"}),T.jsxs("div",{className:"text-sm text-gray-700",children:[T.jsxs("p",{children:[T.jsx("strong",{children:"åå‰:"})," ",e.name]}),T.jsxs("p",{children:[T.jsx("strong",{children:"ãƒ¡ãƒ¼ãƒ«:"})," ",e.email]}),T.jsxs("p",{children:[T.jsx("strong",{children:"å½¹å‰²:"})," ","athlete"===e.role?"é¸æ‰‹":"staff"===e.role?"ã‚¹ã‚¿ãƒƒãƒ•":"ç®¡ç†è€…"]})]})]})]}),T.jsxs("div",{className:"mb-6",children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["å‰Šé™¤ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€Œ",T.jsx("strong",{children:e.name}),"ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"]}),T.jsx("input",{type:"text",value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:e.name})]}),o&&T.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg mb-4 "+("success"===o.type?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"),children:["success"===o.type?T.jsx(Re,{className:"w-5 h-5 flex-shrink-0"}):T.jsx(fe,{className:"w-5 h-5 flex-shrink-0"}),T.jsx("span",{className:"text-sm",children:o.text})]}),T.jsxs("div",{className:"flex space-x-3",children:[T.jsx("button",{type:"button",onClick:t,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsxs("button",{onClick:async()=>{if(l===e.name){n(!0),d(null);try{const{data:{session:t}}=await z.auth.getSession();if(!t)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r="http://127.0.0.1:54321",a=await fetch(`${r}/functions/v1/delete-user`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})}),n=await a.json();if(!a.ok)throw new Error(n.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");d({type:"success",text:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚"}),setTimeout(()=>{s()},1e3)}catch(t){console.error("Error deleting user:",t),d({type:"error",text:`å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.message}`})}finally{n(!1)}}else d({type:"error",text:"ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚"})},disabled:a||l!==e.name,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[a?T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):T.jsx(Ut,{className:"w-4 h-4 mr-2"}),a?"å‰Šé™¤ä¸­...":"å‰Šé™¤ã™ã‚‹"]})]})]})]})})}function Qn({teams:e,restrictToOrganizationId:t}){const[s,a]=r.useState([]),[n,l]=r.useState([]),[i,o]=r.useState(!0),[d,c]=r.useState(null),[u,x]=r.useState(!1),[m,g]=r.useState(!1),[h,p]=r.useState(null),[b,y]=r.useState(""),[f,v]=r.useState("all"),j=r.useCallback(async()=>{o(!0),p(null);try{if(t){const{data:e,error:r}=await z.from("organization_members").select("user_id").eq("organization_id",t);if(r)throw r;const s=(null==e?void 0:e.map(e=>e.user_id))||[];if(0===s.length)return void a([]);const{data:n,error:l}=await z.from("users").select("*").in("id",s).neq("role","global_admin").order("created_at",{ascending:!1});if(l)throw l;a(n||[])}else{const{data:e,error:t}=await z.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;a(e||[])}}catch(e){console.error("Error fetching users:",e),p("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{o(!1)}},[t]);r.useEffect(()=>{j()},[j]),r.useEffect(()=>{let e=s;b&&(e=e.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())||e.email.toLowerCase().includes(b.toLowerCase())||e.user_id&&e.user_id.toLowerCase().includes(b.toLowerCase()))),"all"!==f&&(e=e.filter(e=>e.role===f)),l(e)},[s,b,f]);const w=e=>{c(e),x(!0)},N=e=>{c(e),g(!0)},k=t=>{if(!t)return"-";const r=e.find(e=>e.id===t);return r?r.name:"ä¸æ˜ãªãƒãƒ¼ãƒ "},_=e=>{switch(e){case"athlete":return"é¸æ‰‹";case"staff":return"ã‚¹ã‚¿ãƒƒãƒ•";case"global_admin":return"ç®¡ç†è€…";default:return e}},S=e=>{switch(e){case"global_admin":return"bg-purple-100 text-purple-800";case"staff":return"bg-green-100 text-green-800";case"athlete":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx(rr,{className:"w-6 h-6 text-purple-600"}),T.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†"})]}),T.jsxs("div",{className:"text-sm text-gray-600",children:[s.length,"åã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™"]})]}),T.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[T.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[T.jsx("div",{className:"flex-1",children:T.jsxs("div",{className:"relative",children:[T.jsx(Tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),T.jsx("input",{type:"text",placeholder:"åå‰ã€ãƒ¡ãƒ¼ãƒ«ã€ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§æ¤œç´¢...",value:b,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),T.jsx("div",{className:"sm:w-48",children:T.jsxs("div",{className:"relative",children:[T.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),T.jsxs("select",{value:f,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none",children:[T.jsx("option",{value:"all",children:"å…¨ã¦ã®å½¹å‰²"}),T.jsx("option",{value:"global_admin",children:"ç®¡ç†è€…"}),T.jsx("option",{value:"staff",children:"ã‚¹ã‚¿ãƒƒãƒ•"}),T.jsx("option",{value:"athlete",children:"é¸æ‰‹"})]})]})})]}),(b||"all"!==f)&&T.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:T.jsxs("div",{className:"flex items-center justify-between text-sm",children:[T.jsxs("div",{className:"text-gray-600",children:["ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœ: ",n.length,"å",b&&T.jsxs("span",{className:"ml-2",children:["ã€Œ",b,"ã€ã§æ¤œç´¢"]}),"all"!==f&&T.jsxs("span",{className:"ml-2",children:["å½¹å‰²: ",_(f)]})]}),T.jsx("button",{onClick:()=>{y(""),v("all")},className:"text-blue-600 hover:text-blue-700 underline",children:"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢"})]})})]}),h&&T.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:[T.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),T.jsx("span",{className:"text-sm",children:h})]}),T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[T.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.filter(e=>"global_admin"===e.role).length}),T.jsx("div",{className:"text-sm text-purple-700",children:"ç®¡ç†è€…"})]}),T.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.filter(e=>"staff"===e.role).length}),T.jsx("div",{className:"text-sm text-green-700",children:"ã‚¹ã‚¿ãƒƒãƒ•"})]}),T.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.filter(e=>"athlete"===e.role).length}),T.jsx("div",{className:"text-sm text-blue-700",children:"é¸æ‰‹"})]}),T.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-gray-600",children:s.length}),T.jsx("div",{className:"text-sm text-gray-700",children:"åˆè¨ˆ"})]})]}),T.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[T.jsx("div",{className:"p-4 border-b border-gray-200",children:T.jsx("h3",{className:"font-medium text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§"})}),T.jsx("div",{className:"p-4",children:T.jsx(Gn,{data:n,itemsPerPage:10,renderItem:(e,t)=>T.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[T.jsx("div",{className:"block sm:hidden space-y-3",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[T.jsx("span",{className:"font-mono text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:e.user_id||"N/A"}),T.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${S(e.role)}`,children:_(e.role)})]}),T.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),T.jsx("p",{className:"text-sm text-gray-600 truncate",children:e.email}),T.jsx("p",{className:"text-xs text-gray-500",children:k(e.team_id)})]}),T.jsxs("div",{className:"flex space-x-2 ml-2",children:[T.jsx("button",{onClick:()=>w(e),className:"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors",title:"ç·¨é›†",children:T.jsx(qt,{className:"w-4 h-4"})}),T.jsx("button",{onClick:()=>N(e),className:"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"w-4 h-4"})})]})]})}),T.jsxs("div",{className:"hidden sm:grid grid-cols-6 gap-4 items-center",children:[T.jsxs("div",{children:[T.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ID"}),T.jsx("div",{className:"font-mono text-sm bg-gray-100 text-gray-700 px-2 py-1 rounded inline-block",children:e.user_id||"N/A"})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"åå‰"}),T.jsx("div",{className:"font-semibold text-gray-900",children:e.name})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ãƒ¡ãƒ¼ãƒ«"}),T.jsx("div",{className:"text-sm text-gray-700 break-all",children:e.email})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"å½¹å‰²"}),T.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${S(e.role)}`,children:_(e.role)})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ãƒãƒ¼ãƒ "}),T.jsx("div",{className:"text-sm text-gray-700",children:k(e.team_id)})]}),T.jsxs("div",{className:"flex justify-end space-x-2",children:[T.jsx("button",{onClick:()=>w(e),className:"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors",title:"ç·¨é›†",children:T.jsx(qt,{className:"w-4 h-4"})}),T.jsx("button",{onClick:()=>N(e),className:"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"w-4 h-4"})})]})]})]},e.id),loading:i,emptyMessage:b||"all"!==f?"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã«è©²å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚":"ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"})})]}),d&&u&&T.jsx(Zn,{user:d,teams:e,onClose:()=>{x(!1),c(null)},onUserUpdated:()=>{x(!1),c(null),j()}}),d&&m&&T.jsx(Xn,{user:d,onClose:()=>{g(!1),c(null)},onUserDeleted:()=>{g(!1),c(null),j()}})]})}function el(){const[e,t]=r.useState("high"),[s,a]=r.useState(!1),[n,l]=r.useState(null),[i,o]=r.useState(null),[d,c]=r.useState(null),[u,x]=r.useState(!1),[m,g]=r.useState(null),h=r.useMemo(()=>{const e="http://127.0.0.1:54321";return e?`${e}/functions/v1/calculate-metabolism`:"/functions/v1/calculate-metabolism"},[]),p=async()=>{var t,r;a(!0),l(null);try{const{data:s}=await z.auth.getUser(),a=null==(t=null==s?void 0:s.user)?void 0:t.id;if(!a)throw new Error("ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå–å¾—ã§ãã¾ã›ã‚“");const{data:n}=await z.auth.getSession(),l=null==(r=null==n?void 0:n.session)?void 0:r.access_token;if(!l)throw new Error("ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—å¤±æ•—");const i=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({activity_level:e})}),d=await i.json();if(!i.ok)throw new Error((null==d?void 0:d.error)??"Edge Function error");o(d),await b(a)}catch(s){l(String((null==s?void 0:s.message)??s)),o(null)}finally{a(!1)}},b=async e=>{x(!0),g(null);try{const{data:t,error:r}=await z.from("nutrition_metabolism_7d_avg").select("*").eq("user_id",e).single();if(r)throw r;c(t)}catch(t){g(String((null==t?void 0:t.message)??t)),c(null)}finally{x(!1)}},y=r.useMemo(()=>i&&d?i.tdee-d.avg_tdee:null,[i,d]),f=r.useMemo(()=>null===y?null:y>150?"ä»Šæ—¥ã¯æ´»å‹•é‡ãŒã‹ãªã‚Šé«˜ã‚":y>50?"ä»Šæ—¥ã¯ã‚„ã‚„æ´»å‹•é‡å¤šã‚":y<-150?"ä»Šæ—¥ã¯æ´»å‹•é‡ãŒä½ã‚":y<-50?"ä»Šæ—¥ã¯ã‚„ã‚„æ´»å‹•é‡å°‘ãªã‚":"å¹³å‡çš„ãªæ´»å‹•é‡",[y]);return r.useEffect(()=>{p()},[]),T.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[T.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx(be,{className:"w-5 h-5 text-indigo-600"}),T.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"æ „é¤Šãƒ‡ãƒãƒƒã‚°ï¼ˆéå…¬é–‹ï¼‰"})]}),T.jsxs("button",{onClick:p,disabled:s,className:"inline-flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:[T.jsx(St,{className:"w-4 h-4 "+(s?"animate-spin":"")}),"å†å–å¾—"]})]}),T.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 mb-4",children:[T.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[T.jsx(lt,{className:"w-4 h-4 text-gray-400"}),"InBody â†’ LBM â†’ BMR â†’ TDEEï¼ˆæ¤œè¨¼ç”¨ï¼‰"]}),T.jsxs("div",{className:"sm:ml-auto flex items-center gap-2",children:[T.jsx("span",{className:"text-xs text-gray-500",children:"æ´»å‹•ãƒ¬ãƒ™ãƒ«"}),T.jsxs("select",{value:e,onChange:e=>t(e.target.value),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg",children:[T.jsx("option",{value:"low",children:"low"}),T.jsx("option",{value:"medium",children:"medium"}),T.jsx("option",{value:"high",children:"high"}),T.jsx("option",{value:"elite",children:"elite"})]}),T.jsx("button",{onClick:p,disabled:s,className:"px-3 py-2 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:"åæ˜ "})]})]}),n&&T.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700 flex items-start gap-2",children:[T.jsx(fe,{className:"w-4 h-4 mt-0.5"}),T.jsx("div",{children:n})]}),i&&T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[T.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[T.jsx("div",{className:"text-xs text-gray-500",children:"ä½“é‡"}),T.jsxs("div",{className:"text-2xl font-bold",children:[i.weight," kg"]})]}),T.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[T.jsx("div",{className:"text-xs text-gray-500",children:"ä½“è„‚è‚ªç‡"}),T.jsxs("div",{className:"text-2xl font-bold",children:[i.body_fat_percent??"â€”","%"]})]}),T.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[T.jsx("div",{className:"text-xs text-gray-500",children:"é™¤è„‚è‚ªä½“é‡ï¼ˆLBMï¼‰"}),T.jsxs("div",{className:"text-2xl font-bold",children:[i.lean_mass??"â€”"," kg"]})]}),T.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[T.jsx("div",{className:"text-xs text-gray-500",children:"BMR"}),T.jsxs("div",{className:"text-2xl font-bold",children:[i.bmr," kcal"]})]}),T.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg sm:col-span-2",children:[T.jsx("div",{className:"text-xs text-indigo-700",children:"TDEE"}),T.jsxs("div",{className:"text-3xl font-extrabold text-indigo-900",children:[i.tdee," kcal"]})]})]}),u&&T.jsx("div",{className:"text-sm text-gray-500",children:"7æ—¥å¹³å‡ã‚’è¨ˆç®—ä¸­..."}),m&&T.jsxs("div",{className:"text-sm text-yellow-700",children:["7æ—¥å¹³å‡å–å¾—å¤±æ•—: ",m]}),d&&i&&null!==y&&T.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[T.jsx("div",{className:"font-semibold mb-2",children:"ç›´è¿‘7æ—¥å¹³å‡ã¨ã®å·®ï¼ˆæ´»å‹•é‡ï¼‰"}),T.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[T.jsxs("div",{children:[T.jsx("div",{className:"text-gray-500",children:"ä»Šæ—¥"}),T.jsxs("div",{className:"font-bold",children:[i.tdee," kcal"]})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-gray-500",children:"7æ—¥å¹³å‡"}),T.jsxs("div",{className:"font-bold",children:[d.avg_tdee," kcal"]})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-gray-500",children:"å·®åˆ†"}),T.jsxs("div",{className:"font-bold "+(y>0?"text-red-600":y<0?"text-blue-600":"text-gray-700"),children:[y>0&&"+",y," kcal"]})]})]}),T.jsxs("div",{className:"text-xs text-gray-600 mt-2",children:["è©•ä¾¡ï¼š",T.jsx("span",{className:"font-semibold",children:f})]})]})]})}function tl(){const[e,t]=r.useState("æœé£Ÿ"),[s,a]=r.useState(1),[n,l]=r.useState(function(e=new Date){const t=e.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}).split("/");return`${t[0]}-${t[1].padStart(2,"0")}-${t[2].padStart(2,"0")}`}()),[i,o]=r.useState(null),[d,c]=r.useState(!1),[u,x]=r.useState(""),m="nutrition-images",g=r.useMemo(()=>i?URL.createObjectURL(i):"",[i]);return T.jsxs("div",{className:"bg-white border rounded-xl p-4 space-y-4",children:[T.jsx("div",{className:"text-lg font-semibold",children:"ğŸ“¸ é£Ÿäº‹å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"æ—¥ä»˜"}),T.jsx("input",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:n,onChange:e=>l(e.target.value)})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"é£Ÿäº‹ã‚¿ã‚¤ãƒ—"}),T.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:e,onChange:e=>{const r=e.target.value;t(r),"è£œé£Ÿ"!==r&&a(1)},children:[T.jsx("option",{value:"æœé£Ÿ",children:"æœé£Ÿ"}),T.jsx("option",{value:"æ˜¼é£Ÿ",children:"æ˜¼é£Ÿ"}),T.jsx("option",{value:"å¤•é£Ÿ",children:"å¤•é£Ÿ"}),T.jsx("option",{value:"è£œé£Ÿ",children:"è£œé£Ÿ"})]})]}),T.jsxs("div",{children:[T.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ã‚¹ãƒ­ãƒƒãƒˆ"}),T.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:s,disabled:"è£œé£Ÿ"!==e,onChange:e=>a(Number(e.target.value)),children:[T.jsx("option",{value:1,children:"1"}),T.jsx("option",{value:2,children:"2"})]}),T.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:"â€» è£œé£Ÿã®ã¿ 1 / 2ã€æœæ˜¼å¤•ã¯ 1 å›ºå®š"})]}),T.jsxs("div",{className:"space-y-2",children:[T.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;return o((null==(t=e.target.files)?void 0:t[0])??null)}}),g&&T.jsx("img",{src:g,className:"max-h-60 rounded border"})]}),T.jsx("button",{onClick:async()=>{var t,r;if(!i)return x("ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„");c(!0),x("");try{const{data:a}=await z.auth.getUser(),l=null==(t=null==a?void 0:a.user)?void 0:t.id;if(!l)throw new Error("æœªãƒ­ã‚°ã‚¤ãƒ³");const d=i.name.split(".").pop()||"jpg",c=crypto.randomUUID(),u=`nutrition/${l}/${n}/${c}.${d}`,{error:g}=await z.storage.from(m).upload(u,i,{contentType:i.type});if(g)throw g;const{data:h}=z.storage.from(m).getPublicUrl(u),{data:p,error:b}=await z.from("nutrition_logs").insert({user_id:l,record_date:n,meal_type:e,meal_slot:s,image_path:u,image_url:h.publicUrl}).select().single();if(b)throw b;const y=await async function(e){return new Promise((t,r)=>{const s=new FileReader;s.onload=()=>{const e=s.result;t(e.split(",")[1])},s.onerror=r,s.readAsDataURL(e)})}(i),{data:f}=await z.auth.getSession(),v=await fetch("http://127.0.0.1:54321/functions/v1/nutrition-analyze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(r=null==f?void 0:f.session)?void 0:r.access_token}`},body:JSON.stringify({meal_type:e,image_base64:y,mime_type:i.type,user_name:"user"})}),j=await v.json();if(!v.ok)throw new Error(j.error);await z.from("nutrition_logs").update({total_calories:j.result.total_calories,p:j.result.nutrients.p,f:j.result.nutrients.f,c:j.result.nutrients.c,menu_items:j.result.menu_items,advice_markdown:j.result.advice_markdown}).eq("id",p.id),x("âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼†AIè§£æ å®Œäº†ï¼"),o(null)}catch(a){console.error(a),x(`âŒ ${a.message}`)}finally{c(!1)}},disabled:d||!i,className:"px-4 py-2 bg-indigo-600 text-white rounded disabled:opacity-50",children:d?"è§£æä¸­...":"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼†è§£æ"}),u&&T.jsx("div",{className:"text-sm",children:u})]})}function rl({userId:e}){const{organizations:t,loading:s,error:a,createOrganization:n,updateOrganization:l,deleteOrganization:i}=un(e),[o,d]=r.useState(),[c,u]=r.useState(!1),[x,m]=r.useState(!1),[g,h]=r.useState(null);return s?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a?T.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:T.jsxs("div",{className:"flex items-start gap-3",children:[T.jsx("div",{className:"flex-shrink-0",children:T.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),T.jsxs("div",{className:"flex-1",children:[T.jsx("h3",{className:"text-sm font-medium text-red-800 mb-2",children:"çµ„ç¹”ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ"}),T.jsx("p",{className:"text-sm text-red-700 mb-3",children:a}),T.jsxs("details",{className:"text-xs text-red-600",children:[T.jsx("summary",{className:"cursor-pointer hover:text-red-800 font-medium mb-1",children:"ãƒ‡ãƒãƒƒã‚°æƒ…å ±"}),T.jsxs("div",{className:"mt-2 bg-red-100 p-2 rounded border border-red-200 font-mono",children:[T.jsxs("p",{children:["User ID: ",e]}),T.jsxs("p",{children:["Error: ",a]}),T.jsxs("p",{className:"mt-2 text-red-700",children:["è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :",T.jsx("br",{}),"â€¢ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®RLSãƒãƒªã‚·ãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹",T.jsx("br",{}),"â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®roleãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„",T.jsx("br",{}),"â€¢ auth.uid()ã¨users.idã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«å•é¡ŒãŒã‚ã‚‹"]})]})]}),T.jsx("button",{onClick:()=>window.location.reload(),className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿"})]})]})}):T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[T.jsx(Ee,{className:"h-6 w-6"}),"çµ„ç¹”ç®¡ç†"]}),T.jsx("p",{className:"text-gray-600 mt-1",children:"çµ„ç¹”ã¨ãƒãƒ¼ãƒ ã®ä½œæˆãƒ»ç®¡ç†"})]}),T.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[T.jsx(kt,{className:"h-4 w-4"}),"çµ„ç¹”ã‚’è¿½åŠ "]})]}),T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[T.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[T.jsx("div",{className:"p-6 border-b",children:T.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"çµ„ç¹”ä¸€è¦§"})}),T.jsx("div",{className:"divide-y",children:0===t.length?T.jsx("div",{className:"p-6 text-center text-gray-500",children:"çµ„ç¹”ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):t.map(e=>T.jsx(sl,{organization:e,isSelected:o===e.id,onSelect:()=>d(e.id),onEdit:()=>h(e),onDelete:async()=>{if(confirm(`${e.name}ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿé–¢é€£ã™ã‚‹ãƒãƒ¼ãƒ ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`))try{await i(e.id),o===e.id&&d(void 0)}catch(t){alert("çµ„ç¹”ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(t instanceof Error?t.message:"Unknown error"))}}},e.id))})]}),T.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:o?T.jsx(al,{organizationId:o,onCreateClick:()=>m(!0)}):T.jsx("div",{className:"p-6 text-center text-gray-500",children:"å·¦å´ã‹ã‚‰çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"})})]}),c&&T.jsx(ll,{onClose:()=>u(!1),onCreate:async(e,t)=>{try{await n(e,t);const r=document.createElement("div");r.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",r.innerHTML=`\n                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n                </svg>\n                <span>çµ„ç¹”ã€Œ${e}ã€ã‚’ä½œæˆã—ã¾ã—ãŸ</span>\n              `,document.body.appendChild(r),setTimeout(()=>{r.style.opacity="0",r.style.transition="opacity 0.3s",setTimeout(()=>r.remove(),300)},3e3),u(!1)}catch(r){alert("çµ„ç¹”ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+(r instanceof Error?r.message:"Unknown error"))}}}),g&&T.jsx(il,{organization:g,onClose:()=>h(null),onUpdate:async e=>{try{await l(g.id,e);const t=document.createElement("div");t.className="fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",t.innerHTML='\n                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n                </svg>\n                <span>çµ„ç¹”ã‚’æ›´æ–°ã—ã¾ã—ãŸ</span>\n              ',document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transition="opacity 0.3s",setTimeout(()=>t.remove(),300)},3e3),h(null)}catch(t){alert("çµ„ç¹”ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(t instanceof Error?t.message:"Unknown error"))}}}),x&&o&&T.jsx(ol,{organizationId:o,onClose:()=>m(!1)})]})}function sl({organization:e,isSelected:t,onSelect:r,onEdit:s,onDelete:a}){return T.jsx("div",{className:"p-4 cursor-pointer transition-colors "+(t?"bg-blue-50 border-l-4 border-blue-600":"hover:bg-gray-50"),onClick:r,children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:e.name}),e.description&&T.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.description}),T.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ä½œæˆæ—¥: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),T.jsxs("div",{className:"flex items-center gap-2 ml-4",onClick:e=>e.stopPropagation(),children:[T.jsx("button",{onClick:s,className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",title:"ç·¨é›†",children:T.jsx(vt,{className:"h-4 w-4"})}),T.jsx("button",{onClick:a,className:"p-1 text-gray-600 hover:text-red-600 transition-colors",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"h-4 w-4"})})]})]})})}function al({organizationId:e,onCreateClick:t}){const{teams:r,loading:s,deleteTeam:a}=xn(e);return console.log("TeamPanel render:",{organizationId:e,loading:s,teamsCount:r.length,teams:r}),T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[T.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[T.jsx(rr,{className:"h-5 w-5"}),"ãƒãƒ¼ãƒ ä¸€è¦§ (",r.length,")"]}),T.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:[T.jsx(kt,{className:"h-4 w-4"}),"ãƒãƒ¼ãƒ ã‚’è¿½åŠ "]})]}),T.jsx("div",{className:"divide-y max-h-[500px] overflow-y-auto",children:s?T.jsx("div",{className:"p-6 text-center",children:T.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):0===r.length?T.jsx("div",{className:"p-6 text-center text-gray-500",children:"ãƒãƒ¼ãƒ ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):r.map(e=>T.jsx(nl,{team:e,onDelete:async()=>{if(confirm(`${e.name}ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿæ‰€å±ã™ã‚‹é¸æ‰‹ã¨ã‚³ãƒ¼ãƒã®ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`))try{await a(e.id)}catch(t){alert("ãƒãƒ¼ãƒ ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(t instanceof Error?t.message:"Unknown error"))}}},e.id))})]})}function nl({team:e,onDelete:t}){return T.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("h4",{className:"font-medium text-gray-900 truncate",children:e.name}),e.description&&T.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.description}),T.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[T.jsxs("span",{className:"flex items-center gap-1",children:[T.jsx(rr,{className:"h-3 w-3"}),"é¸æ‰‹: ",e.member_count||0,"å"]}),T.jsxs("span",{className:"flex items-center gap-1",children:["ã‚³ãƒ¼ãƒ: ",e.staff_count||0,"å"]})]})]}),T.jsx("button",{onClick:t,className:"p-1 text-gray-600 hover:text-red-600 transition-colors ml-4",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"h-4 w-4"})})]})})}function ll({onClose:e,onCreate:t}){const[s,a]=r.useState(""),[n,l]=r.useState(""),[i,o]=r.useState(!1);return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:T.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),s.trim()){o(!0);try{await t(s.trim(),n.trim())}finally{o(!1)}}},children:[T.jsxs("div",{className:"p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"çµ„ç¹”ã‚’è¿½åŠ "}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["çµ„ç¹”å ",T.jsx("span",{className:"text-red-600",children:"*"})]}),T.jsx("input",{type:"text",value:s,onChange:e=>a(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ä¾‹: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«",required:!0,autoFocus:!0})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"èª¬æ˜"}),T.jsx("textarea",{value:n,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"çµ„ç¹”ã®èª¬æ˜ã‚’å…¥åŠ›ï¼ˆä»»æ„ï¼‰"})]})]})]}),T.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[T.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:i,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:i||!s.trim(),children:i?"ä½œæˆä¸­...":"ä½œæˆ"})]})]})})})}function il({organization:e,onClose:t,onUpdate:s}){const[a,n]=r.useState(e.name),[l,i]=r.useState(e.description||""),[o,d]=r.useState(!1);return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:T.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),a.trim()){d(!0);try{await s({name:a.trim(),description:l.trim()})}finally{d(!1)}}},children:[T.jsxs("div",{className:"p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"çµ„ç¹”ã‚’ç·¨é›†"}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["çµ„ç¹”å ",T.jsx("span",{className:"text-red-600",children:"*"})]}),T.jsx("input",{type:"text",value:a,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,autoFocus:!0})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"èª¬æ˜"}),T.jsx("textarea",{value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]})]})]}),T.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[T.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:o,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:o||!a.trim(),children:o?"æ›´æ–°ä¸­...":"æ›´æ–°"})]})]})})})}function ol({organizationId:e,onClose:t}){const{createTeam:s}=xn(e),[a,n]=r.useState(""),[l,i]=r.useState(!1);return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:T.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),a.trim()){i(!0);try{const e=await s(a.trim());console.log("Team created successfully, closing modal:",e);const r=document.createElement("div");r.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",r.innerHTML=`\n        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n        </svg>\n        <span>ãƒãƒ¼ãƒ ã€Œ${a.trim()}ã€ã‚’ä½œæˆã—ã¾ã—ãŸ</span>\n      `,document.body.appendChild(r),setTimeout(()=>{r.style.opacity="0",r.style.transition="opacity 0.3s",setTimeout(()=>r.remove(),300)},3e3),t()}catch(r){alert("ãƒãƒ¼ãƒ ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+(r instanceof Error?r.message:"Unknown error"))}finally{i(!1)}}},children:[T.jsxs("div",{className:"p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ãƒãƒ¼ãƒ ã‚’è¿½åŠ "}),T.jsx("div",{className:"space-y-4",children:T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ãƒãƒ¼ãƒ å ",T.jsx("span",{className:"text-red-600",children:"*"})]}),T.jsx("input",{type:"text",value:a,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ä¾‹: U-15ã‚µãƒƒã‚«ãƒ¼ãƒãƒ¼ãƒ ",required:!0,autoFocus:!0})]})})]}),T.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[T.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:l,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",disabled:l||!a.trim(),children:l?"ä½œæˆä¸­...":"ä½œæˆ"})]})]})})})}function dl({organizationId:e,organizationName:t}){var s,a;const[n,l]=r.useState([]),[i,o]=r.useState(!0),[d,c]=r.useState(null),[u,x]=r.useState(new Set),[m,g]=r.useState(!1),[h,p]=r.useState(null),[b,y]=r.useState([]),[f,v]=r.useState("");r.useEffect(()=>{j(),w()},[e]);const j=async()=>{try{o(!0),c(null);const{data:t,error:r}=await z.from("teams").select("*").eq("organization_id",e).order("name");if(r)throw r;if(!t||0===t.length)return void l([]);const s=await Promise.all(t.map(async e=>{const{data:t,error:r}=await z.from("users").select("*").eq("team_id",e.id).eq("role","athlete").order("name");if(r)throw r;const{data:s,error:a}=await z.from("staff_team_links").select("\n              staff_user_id,\n              users!staff_team_links_staff_user_id_fkey (\n                id,\n                name,\n                email,\n                role\n              )\n            ").eq("team_id",e.id);if(a)throw a;const n=(null==s?void 0:s.map(e=>e.users).filter(Boolean))||[];return{...e,athletes:t||[],coaches:n}}));l(s)}catch(t){console.error("Error loading teams and members:",t),c(t instanceof Error?t.message:"çµ„ç¹”ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{o(!1)}},w=async()=>{try{const{data:t,error:r}=await z.from("organization_members").select("user_id").eq("organization_id",e);if(r)throw r;if(!t||0===t.length)return console.log("No organization members found"),void y([]);const s=t.map(e=>e.user_id),{data:a,error:n}=await z.from("users").select("id, name, email, role, team_id").in("id",s);if(n)throw n;console.log("Organization members loaded:",a),console.log("Total members:",(null==a?void 0:a.length)||0),y(a||[])}catch(t){console.error("Error loading organization members:",t)}},N=async(e,t,r)=>{if(confirm("ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒãƒ¼ãƒ ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{if(console.log("ğŸ—‘ï¸ Removing member:",{userId:e,memberRole:t,teamId:r}),"athlete"===t){console.log("ğŸ”„ Calling update_athlete_team function with null team_id");const{data:t,error:r}=await z.rpc("update_athlete_team",{athlete_id:e,new_team_id:null});if(console.log("ğŸ“Š Function response:",{data:t,error:r}),r)throw r;console.log("âœ… Athlete removed successfully")}else{console.log("ğŸ”„ Deleting staff_team_link");const{error:t}=await z.from("staff_team_links").delete().eq("staff_user_id",e).eq("team_id",r);if(t)throw t;console.log("âœ… Staff removed successfully")}console.log("ğŸ”„ Reloading teams and members..."),await j(),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒãƒ¼ãƒ ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ")}catch(s){console.error("âŒ Error removing member:",s),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(s instanceof Error?s.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}},k=b.filter(e=>"athlete"===e.role).length,_=b.filter(e=>"athlete"===e.role&&!e.team_id).length,S=b.filter(e=>"staff"===e.role).length;return i?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):d?T.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:T.jsx("p",{className:"text-red-800 dark:text-red-200",children:d})}):T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:t}),T.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"çµ„ç¹”å…¨ä½“ã®ãƒãƒ¼ãƒ ã¨ãƒ¡ãƒ³ãƒãƒ¼ã®æ¦‚è¦"})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[T.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-1",children:"ç™»éŒ²ãƒãƒ¼ãƒ æ•°"}),T.jsx("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-100",children:n.length})]}),T.jsx(rr,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})]})}),T.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-1",children:"é¸æ‰‹ç·æ•°"}),T.jsx("p",{className:"text-3xl font-bold text-green-900 dark:text-green-100",children:k}),_>0&&T.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["âš ï¸ ãƒãƒ¼ãƒ æœªæ‰€å±: ",_,"å"]})]}),T.jsx(Gt,{className:"h-8 w-8 text-green-600 dark:text-green-400"})]})}),T.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300 mb-1",children:"ã‚³ãƒ¼ãƒç·æ•°"}),T.jsx("p",{className:"text-3xl font-bold text-purple-900 dark:text-purple-100",children:S})]}),T.jsx(Qt,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})]})})]}),_>0&&T.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800",children:[T.jsx("div",{className:"flex items-center justify-between mb-3",children:T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx(Qt,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"}),T.jsxs("h3",{className:"text-sm font-semibold text-orange-900 dark:text-orange-100",children:["ãƒãƒ¼ãƒ æœªæ‰€å±ã®é¸æ‰‹ (",_,"å)"]})]})}),T.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:b.filter(e=>"athlete"===e.role&&!e.team_id).map(e=>T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-orange-200 dark:border-orange-600",children:[T.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.email})]},e.id))})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[T.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒãƒ¼ãƒ åˆ¥ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§"})}),T.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===n.length?T.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"ã“ã®çµ„ç¹”ã«ã¯ãƒãƒ¼ãƒ ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):n.map(e=>{const t=u.has(e.id);return T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[T.jsxs("button",{onClick:()=>{return t=e.id,void x(e=>{const r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r});var t},className:"flex-1 flex items-center gap-3 text-left",children:[t?T.jsx(Ae,{className:"h-5 w-5 text-gray-400"}):T.jsx(ze,{className:"h-5 w-5 text-gray-400"}),T.jsxs("div",{children:[T.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["é¸æ‰‹ ",e.athletes.length,"å / ã‚³ãƒ¼ãƒ ",e.coaches.length,"å"]})]})]}),T.jsxs("button",{onClick:()=>(e=>{p(e),g(!0),v("")})(e),className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[T.jsx(Xt,{className:"h-4 w-4"}),T.jsx("span",{children:"ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ "})]})]}),t&&T.jsx("div",{className:"px-4 pb-4 bg-gray-50 dark:bg-gray-700/30",children:T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[T.jsxs("div",{children:[T.jsxs("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[T.jsx(Gt,{className:"h-4 w-4"}),"é¸æ‰‹ (",e.athletes.length,")"]}),T.jsx("div",{className:"space-y-2",children:0===e.athletes.length?T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):e.athletes.map(t=>T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:t.email})]}),T.jsx("button",{onClick:()=>N(t.id,"athlete",e.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"å‰Šé™¤",children:T.jsx(Qt,{className:"h-4 w-4"})})]},t.id))})]}),T.jsxs("div",{children:[T.jsxs("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[T.jsx(Qt,{className:"h-4 w-4"}),"ã‚³ãƒ¼ãƒ (",e.coaches.length,")"]}),T.jsx("div",{className:"space-y-2",children:0===e.coaches.length?T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"ã‚³ãƒ¼ãƒãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“"}):e.coaches.map(t=>T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:t.email})]}),T.jsx("button",{onClick:()=>N(t.id,"staff",e.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"å‰Šé™¤",children:T.jsx(Qt,{className:"h-4 w-4"})})]},t.id))})]})]})})]},e.id)})})]}),m&&h&&T.jsx(cl,{team:h,allTeams:n,organizationMembers:b,currentTeamMembers:[...(null==(s=n.find(e=>e.id===h.id))?void 0:s.athletes)||[],...(null==(a=n.find(e=>e.id===h.id))?void 0:a.coaches)||[]],searchQuery:f,onSearchChange:v,onClose:()=>{g(!1),p(null),v("")},onAssign:async(e,t)=>{if(h)try{if("athlete"===t){console.log("â• Adding athlete to team using update_athlete_team function");const{data:t,error:r}=await z.rpc("update_athlete_team",{athlete_id:e,new_team_id:h.id});if(console.log("ğŸ“Š Function response:",{data:t,error:r}),r)throw r}else{const{error:t}=await z.from("staff_team_links").insert({staff_user_id:e,team_id:h.id});if(t)throw t}console.log("ğŸ”„ Reloading teams and members..."),await j(),await w(),g(!1),p(null),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒãƒ¼ãƒ ã«è¿½åŠ ã—ã¾ã—ãŸ")}catch(r){console.error("âŒ Error assigning member:",r),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(r instanceof Error?r.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}}})]})}function cl({team:e,allTeams:t,organizationMembers:s,currentTeamMembers:a,searchQuery:n,onSearchChange:l,onClose:i,onAssign:o}){const[d,c]=r.useState(!1),u=new Set(a.map(e=>e.id)),x=s.filter(t=>{var r,s;if(u.has(t.id))return!1;if("athlete"===t.role&&t.team_id&&t.team_id!==e.id)return!1;if(n){const e=n.toLowerCase(),a=null==(r=t.name)?void 0:r.toLowerCase().includes(e),l=null==(s=t.email)?void 0:s.toLowerCase().includes(e);return a||l}return!0});console.log("Search query:",n),console.log("Organization members:",s),console.log("Available members after filter:",x);const m=x.filter(e=>"athlete"===e.role),g=x.filter(e=>"staff"===e.role),h=async(r,a,n)=>{if("athlete"===a&&n&&n!==e.id){const e=s.find(e=>e.id===r),a=t.find(e=>e.id===n);if(!confirm(`${null==e?void 0:e.name}ã¯ç¾åœ¨ã€Œ${null==a?void 0:a.name}ã€ã«æ‰€å±ã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒãƒ¼ãƒ ã«ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ`))return}c(!0);try{await o(r,a)}finally{c(!1)}};return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[T.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[T.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[e.name," ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "]}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"çµ„ç¹”å†…ã®ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„"})]}),T.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:T.jsxs("div",{className:"relative",children:[T.jsx(Tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),T.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"åå‰ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})}),T.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:0===x.length?T.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:n?"æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“":"ã“ã®ãƒãƒ¼ãƒ ã«è¿½åŠ ã§ãã‚‹ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“"}):T.jsxs("div",{className:"space-y-6",children:[m.length>0&&T.jsxs("div",{children:[T.jsxs("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[T.jsx(Gt,{className:"h-4 w-4"}),"é¸æ‰‹ (",m.length,")"]}),T.jsx("div",{className:"space-y-2",children:m.map(e=>{const r=e.team_id?t.find(t=>t.id===e.team_id):null;return T.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:e.email}),r&&T.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["ç¾åœ¨: ",r.name]})]}),T.jsx("button",{onClick:()=>h(e.id,"athlete",e.team_id||void 0),disabled:d,className:"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap",children:r?"ç§»å‹•":"è¿½åŠ "})]},e.id)})})]}),g.length>0&&T.jsxs("div",{children:[T.jsxs("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[T.jsx(rr,{className:"h-4 w-4"}),"ã‚¹ã‚¿ãƒƒãƒ• (",g.length,")"]}),T.jsx("div",{className:"space-y-2",children:g.map(e=>T.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:e.email})]}),T.jsx("button",{onClick:()=>h(e.id,"staff"),disabled:d,className:"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap",children:"è¿½åŠ "})]},e.id))})]})]})}),T.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end border-t dark:border-gray-700",children:T.jsx("button",{onClick:i,disabled:d,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"é–‰ã˜ã‚‹"})})]})})}const ul=z,xl={async getSubscriptionPlans(){const{data:e,error:t}=await ul.from("subscription_plans").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;return e},async getSubscriptionPlanById(e){const{data:t,error:r}=await ul.from("subscription_plans").select("*").eq("id",e).maybeSingle();if(r)throw r;return t},async createSubscriptionPlan(e){const{data:t,error:r}=await ul.from("subscription_plans").insert(e).select().single();if(r)throw r;return t},async getOrganizationSubscription(e){const{data:t,error:r}=await ul.from("organization_subscriptions").select("\n        *,\n        plan:plan_id (*)\n      ").eq("organization_id",e).maybeSingle();if(r)throw r;return t},async createOrganizationSubscription(e){const{data:t,error:r}=await ul.from("organization_subscriptions").insert(e).select().single();if(r)throw r;return t},async updateOrganizationSubscription(e,t){const{data:r,error:s}=await ul.from("organization_subscriptions").update(t).eq("organization_id",e).select().single();if(s)throw s;return r},async getUserSubscription(e){const{data:t,error:r}=await ul.from("user_subscriptions").select("\n        *,\n        plan:plan_id (*)\n      ").eq("user_id",e).maybeSingle();if(r)throw r;return t},async getCurrentUsage(e){const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0),{data:a,error:n}=await ul.from("usage_tracking").select("*").eq("organization_id",e).gte("period_start",r.toISOString()).lte("period_end",s.toISOString()).maybeSingle();if(n)throw n;return a},async calculateCurrentUsage(e){const t=new Date(new Date);t.setDate(t.getDate()-30);const{data:r,error:s}=await z.from("users").select("id",{count:"exact",head:!1}).eq("role","athlete").eq("team_id",e).gte("created_at",t.toISOString());if(s)throw s;const{data:a,error:n}=await z.from("organization_members").select("id",{count:"exact",head:!1}).eq("organization_id",e);if(n)throw n;const{error:l}=await z.from("training_records").select("id",{count:"exact",head:!0}).gte("date",K(30));if(l)throw l;return{active_athletes:(null==r?void 0:r.length)||0,total_users:(null==a?void 0:a.length)||0,storage_used_mb:0,api_calls:0,data_exports:0}},async createUsageRecord(e){const{data:t,error:r}=await ul.from("usage_tracking").insert(e).select().single();if(r)throw r;return t},async getBillingHistory(e,t){let r=ul.from("billing_history").select("*").order("billing_date",{ascending:!1});e?r=r.eq("organization_id",e):t&&(r=r.eq("user_id",t));const{data:s,error:a}=await r;if(a)throw a;return s},async createBillingRecord(e){const{data:t,error:r}=await ul.from("billing_history").insert(e).select().single();if(r)throw r;return t},async updateBillingRecord(e,t){const{data:r,error:s}=await ul.from("billing_history").update(t).eq("id",e).select().single();if(s)throw s;return r},async getPermissionDefinitions(){const{data:e,error:t}=await ul.from("permission_definitions").select("*").eq("is_active",!0).order("category",{ascending:!0}).order("name",{ascending:!0});if(t)throw t;return e},async getRolePermissions(e){const{data:t,error:r}=await ul.from("role_permissions").select("\n        *,\n        permission:permission_id (*)\n      ").eq("role",e);if(r)throw r;return t},async getAllRolePermissions(){const{data:e,error:t}=await ul.from("role_permissions").select("\n        *,\n        permission:permission_id (*)\n      ").order("role");if(t)throw t;return e},async checkPlanLimits(e){const t=await this.getOrganizationSubscription(e);if(!t||!t.plan)return{withinLimits:!1,message:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",limits:{}};const r=t.plan,s=await this.calculateCurrentUsage(e),a=null===r.athlete_limit||s.active_athletes<=r.athlete_limit,n=s.storage_used_mb<=1024*r.storage_gb;return{withinLimits:a&&n,message:a&&n?"ãƒ—ãƒ©ãƒ³åˆ¶é™å†…ã§ã™":"ä½¿ç”¨é‡ãŒãƒ—ãƒ©ãƒ³åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™",limits:{athletes:{current:s.active_athletes,limit:r.athlete_limit,exceeded:!a},storage:{current:s.storage_used_mb,limit:1024*r.storage_gb,exceeded:!n}},plan:r,usage:s}},async hasFeature(e,t){const r=await this.getOrganizationSubscription(e);if(!r||!r.plan)return!1;const s=r.plan;return!(!s.features||!0!==s.features[t])},async upgradePlan(e,t,r){if(!(await this.getOrganizationSubscription(e)))throw new Error("ç¾åœ¨ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const s=new Date,a=new Date(s);"monthly"===r?a.setMonth(a.getMonth()+1):a.setFullYear(a.getFullYear()+1);const n={plan_id:t,billing_cycle:r,current_period_start:s.toISOString(),current_period_end:a.toISOString(),status:"active",updated_at:s.toISOString()};return await this.updateOrganizationSubscription(e,n)},async cancelSubscription(e,t=!1){const r=t?{status:"cancelled",updated_at:(new Date).toISOString()}:{cancel_at_period_end:!0,updated_at:(new Date).toISOString()};return await this.updateOrganizationSubscription(e,r)},async reactivateSubscription(e){const t={status:"active",cancel_at_period_end:!1,updated_at:(new Date).toISOString()};return await this.updateOrganizationSubscription(e,t)}};function ml({organizationId:e,organizationName:t}){var s,a,n,l,i,o,d,c,u,x,m;const{subscription:g,plans:h,billingHistory:p,limits:b,loading:y,error:f,upgradePlan:v,cancelSubscription:j,reactivateSubscription:w}=function(e){const[t,s]=r.useState(null),[a,n]=r.useState([]),[l,i]=r.useState(null),[o,d]=r.useState([]),[c,u]=r.useState(null),[x,m]=r.useState(!0),[g,h]=r.useState(null);r.useEffect(()=>{e?p():m(!1)},[e]);const p=async()=>{if(e)try{m(!0),h(null);const[t,r,a,l,o]=await Promise.all([xl.getOrganizationSubscription(e),xl.getSubscriptionPlans(),xl.getCurrentUsage(e),xl.getBillingHistory(e),xl.checkPlanLimits(e)]);s(t),n(r),i(a),d(l),u(o)}catch(t){console.warn("Subscription feature not yet implemented:",t),h(null),s(null),n([]),i(null),d([]),u(null)}finally{m(!1)}};return{subscription:t,plans:a,usage:l,billingHistory:o,limits:c,loading:x,error:g,upgradePlan:async(t,r)=>{if(!e)throw new Error("Organization ID is required");try{const s=await xl.upgradePlan(e,t,r);return await p(),s}catch(s){const e=s instanceof Error?s.message:"ãƒ—ãƒ©ãƒ³ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ";throw h(e),new Error(e)}},cancelSubscription:async(t=!1)=>{if(!e)throw new Error("Organization ID is required");try{const r=await xl.cancelSubscription(e,t);return await p(),r}catch(r){const e=r instanceof Error?r.message:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ";throw h(e),new Error(e)}},reactivateSubscription:async()=>{if(!e)throw new Error("Organization ID is required");try{const t=await xl.reactivateSubscription(e);return await p(),t}catch(t){const e=t instanceof Error?t.message:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å†é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ";throw h(e),new Error(e)}},hasFeature:async t=>{if(!e)return!1;try{return await xl.hasFeature(e,t)}catch(r){return console.error("Error checking feature:",r),!1}},refreshUsage:async()=>{if(e)try{const[t,r]=await Promise.all([xl.getCurrentUsage(e),xl.checkPlanLimits(e)]);i(t),u(r)}catch(t){console.error("Error refreshing usage:",t)}},reload:p}}(e),[N,k]=r.useState(null),[_,S]=r.useState("monthly"),[C,E]=r.useState(!1),[D,M]=r.useState(!1),[R,$]=r.useState(!1);if(y)return T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(f)return T.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:T.jsx("p",{className:"text-red-800 dark:text-red-200",children:f})});const A=null==g?void 0:g.plan,I="trial"===(null==g?void 0:g.status),z="cancelled"===(null==g?void 0:g.status),P=null==g?void 0:g.cancel_at_period_end,L=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}),q=e=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e);return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[T.jsx(Ue,{className:"h-6 w-6"}),"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†"]}),T.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[t,"ã®ãƒ—ãƒ©ãƒ³ã¨è«‹æ±‚"]})]}),b&&!b.withinLimits&&T.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start gap-3",children:[T.jsx(ye,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-yellow-900 dark:text-yellow-200",children:"ä½¿ç”¨é‡ãŒãƒ—ãƒ©ãƒ³åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™"}),T.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300 mt-1",children:"ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã®åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ã”æ¤œè¨ãã ã•ã„ã€‚"}),(null==(s=b.limits.athletes)?void 0:s.exceeded)&&T.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-400 mt-1",children:["ã‚¢ã‚¹ãƒªãƒ¼ãƒˆæ•°: ",b.limits.athletes.current," / ",b.limits.athletes.limit||"ç„¡åˆ¶é™"]})]})]})}),P&&T.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"flex items-start gap-3",children:[T.jsx(ye,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5"}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-orange-900 dark:text-orange-200",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«äºˆå®šã§ã™"}),T.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-300 mt-1",children:[L(g.current_period_end),"ã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã—ã¾ã™"]})]})]}),T.jsx("button",{onClick:async()=>{$(!0);try{await w()}catch(e){alert(e instanceof Error?e.message:"å†é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{$(!1)}},disabled:R,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 whitespace-nowrap",children:"å†é–‹ã™ã‚‹"})]})}),T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³"}),A?T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:A.name}),I&&T.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-xs font-semibold rounded-full",children:"ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­"}),z&&T.jsx("span",{className:"px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 text-xs font-semibold rounded-full",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿"})]}),T.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:A.description})]}),T.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[T.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[T.jsx("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:q("yearly"===g.billing_cycle?A.price_yearly:A.price_monthly)}),T.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["/ ","yearly"===g.billing_cycle?"å¹´":"æœˆ"]})]}),"yearly"===g.billing_cycle&&T.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["å¹´é–“ãƒ—ãƒ©ãƒ³ã§ ",q(12*A.price_monthly-A.price_yearly)," ãŠå¾—"]})]}),T.jsxs("div",{className:"space-y-2 pt-4 border-t dark:border-gray-700",children:[T.jsxs("div",{className:"flex items-center justify-between text-sm",children:[T.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"è«‹æ±‚ã‚µã‚¤ã‚¯ãƒ«"}),T.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"yearly"===g.billing_cycle?"å¹´æ¬¡":"æœˆæ¬¡"})]}),T.jsxs("div",{className:"flex items-center justify-between text-sm",children:[T.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"æ¬¡å›è«‹æ±‚æ—¥"}),T.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:L(g.current_period_end)})]}),I&&g.trial_end&&T.jsxs("div",{className:"flex items-center justify-between text-sm",children:[T.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"ãƒˆãƒ©ã‚¤ã‚¢ãƒ«çµ‚äº†"}),T.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:L(g.trial_end)})]})]}),T.jsxs("div",{className:"pt-4 space-y-2",children:[T.jsx("button",{onClick:()=>E(!0),disabled:z,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"ãƒ—ãƒ©ãƒ³ã‚’å¤‰æ›´"}),!z&&!P&&T.jsx("button",{onClick:()=>M(!0),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]}):T.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“"})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[T.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[T.jsx(Vt,{className:"h-5 w-5"}),"ä½¿ç”¨çŠ¶æ³"]}),b&&T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ"}),T.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[(null==(a=b.usage)?void 0:a.active_athletes)||0," / ",(null==A?void 0:A.athlete_limit)||"ç„¡åˆ¶é™"]})]}),T.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:T.jsx("div",{className:"h-2 rounded-full "+((null==(l=null==(n=b.limits)?void 0:n.athletes)?void 0:l.exceeded)?"bg-red-600":"bg-blue-600"),style:{width:(null==A?void 0:A.athlete_limit)?`${Math.min(((null==(i=b.usage)?void 0:i.active_athletes)||0)/A.athlete_limit*100,100)}%`:"0%"}})})]}),T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡"}),T.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[(((null==(o=b.usage)?void 0:o.storage_used_mb)||0)/1024).toFixed(2)," GB / ",(null==A?void 0:A.storage_gb)||0," GB"]})]}),T.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:T.jsx("div",{className:"h-2 rounded-full "+((null==(c=null==(d=b.limits)?void 0:d.storage)?void 0:c.exceeded)?"bg-red-600":"bg-green-600"),style:{width:(null==A?void 0:A.storage_gb)?`${Math.min(((null==(u=b.usage)?void 0:u.storage_used_mb)||0)/1024/A.storage_gb*100,100)}%`:"0%"}})})]}),T.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t dark:border-gray-700",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==(x=b.usage)?void 0:x.total_users)||0}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°"})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==(m=b.usage)?void 0:m.data_exports)||0}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"})]})]})]})]})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[T.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[T.jsx(De,{className:"h-5 w-5"}),"è«‹æ±‚å±¥æ­´"]}),p.length>0?T.jsx("div",{className:"overflow-x-auto",children:T.jsxs("table",{className:"w-full",children:[T.jsx("thead",{children:T.jsxs("tr",{className:"border-b dark:border-gray-700",children:[T.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"æ—¥ä»˜"}),T.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"é‡‘é¡"}),T.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"}),T.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"æ”¯æ‰•æ–¹æ³•"})]})}),T.jsx("tbody",{children:p.slice(0,10).map(e=>T.jsxs("tr",{className:"border-b dark:border-gray-700 last:border-0",children:[T.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 dark:text-white",children:L(e.billing_date)}),T.jsx("td",{className:"py-3 px-4 text-sm font-medium text-gray-900 dark:text-white",children:q(e.amount)}),T.jsx("td",{className:"py-3 px-4 text-sm",children:T.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold "+("paid"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":"pending"===e.status?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200"),children:"paid"===e.status?"æ”¯æ‰•æ¸ˆ":"pending"===e.status?"ä¿ç•™ä¸­":"å¤±æ•—"})}),T.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:e.payment_method||"-"})]},e.id))})]})}):T.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-4",children:"è«‹æ±‚å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“"})]}),C&&T.jsx(gl,{plans:h,currentPlan:A,selectedPlan:N,billingCycle:_,onSelectPlan:k,onSelectCycle:S,onConfirm:async()=>{if(N){$(!0);try{await v(N.id,_),E(!1),k(null)}catch(e){alert(e instanceof Error?e.message:"ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{$(!1)}}},onClose:()=>{E(!1),k(null)},processing:R}),D&&T.jsx(hl,{onCancel:async e=>{$(!0);try{await j(e),M(!1)}catch(t){alert(t instanceof Error?t.message:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{$(!1)}},onClose:()=>M(!1),processing:R})]})}function gl({plans:e,currentPlan:t,selectedPlan:r,billingCycle:s,onSelectPlan:a,onSelectCycle:n,onConfirm:l,onClose:i,processing:o}){const d=(e,t)=>e.features&&e.features[t];return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto",children:T.jsxs("div",{className:"p-6",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ"}),T.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:T.jsx(ar,{className:"h-6 w-6"})})]}),T.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[T.jsx("button",{onClick:()=>n("monthly"),className:"px-6 py-2 rounded-lg font-medium transition-colors "+("monthly"===s?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"æœˆæ¬¡"}),T.jsx("button",{onClick:()=>n("yearly"),className:"px-6 py-2 rounded-lg font-medium transition-colors "+("yearly"===s?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"å¹´æ¬¡ï¼ˆãŠå¾—ï¼‰"})]}),T.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:e.map(e=>{const n=(null==t?void 0:t.id)===e.id,l=(null==r?void 0:r.id)===e.id,i="yearly"===s?e.price_yearly:e.price_monthly;return T.jsxs("div",{onClick:()=>a(e),className:"border-2 rounded-lg p-4 cursor-pointer transition-all "+(l?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":n?"border-gray-400 dark:border-gray-600":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700"),children:[n&&T.jsx("div",{className:"mb-2",children:T.jsx("span",{className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-xs font-semibold rounded",children:"ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³"})}),T.jsx("h4",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:e.name}),T.jsxs("div",{className:"mb-4",children:[T.jsx("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:(o=i,new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(o))}),T.jsxs("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["/ ","yearly"===s?"å¹´":"æœˆ"]})]}),T.jsxs("ul",{className:"space-y-2 text-sm",children:[T.jsxs("li",{className:"flex items-center gap-2",children:[T.jsx($e,{className:"h-4 w-4 text-green-600"}),T.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[e.athlete_limit?`${e.athlete_limit}äºº`:"ç„¡åˆ¶é™","ã®ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ"]})]}),T.jsxs("li",{className:"flex items-center gap-2",children:[T.jsx($e,{className:"h-4 w-4 text-green-600"}),T.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[e.storage_gb,"GB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"]})]}),d(e,"advanced_analytics")&&T.jsxs("li",{className:"flex items-center gap-2",children:[T.jsx($e,{className:"h-4 w-4 text-green-600"}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"é«˜åº¦ãªåˆ†æ"})]}),d(e,"priority_support")&&T.jsxs("li",{className:"flex items-center gap-2",children:[T.jsx($e,{className:"h-4 w-4 text-green-600"}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"å„ªå…ˆã‚µãƒãƒ¼ãƒˆ"})]})]})]},e.id);var o})}),T.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t dark:border-gray-700",children:[T.jsx("button",{onClick:i,disabled:o,className:"px-6 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:l,disabled:!r||o,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"å‡¦ç†ä¸­...":"å¤‰æ›´ã‚’ç¢ºå®š"})]})]})})})}function hl({onCancel:e,onClose:t,processing:r}){return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:T.jsxs("div",{className:"p-6",children:[T.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ"}),T.jsxs("div",{className:"space-y-3",children:[T.jsxs("button",{onClick:()=>e(!1),disabled:r,className:"w-full px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 text-left",children:[T.jsx("div",{className:"font-semibold",children:"æœŸé–“çµ‚äº†æ™‚ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("div",{className:"text-sm opacity-90",children:"ç¾åœ¨ã®è«‹æ±‚æœŸé–“ã®çµ‚ã‚ã‚Šã¾ã§åˆ©ç”¨å¯èƒ½ã§ã™"})]}),T.jsxs("button",{onClick:()=>e(!0),disabled:r,className:"w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 text-left",children:[T.jsx("div",{className:"font-semibold",children:"å³åº§ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("div",{className:"text-sm opacity-90",children:"ã™ãã«ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ããªããªã‚Šã¾ã™ï¼ˆè¿”é‡‘ãªã—ï¼‰"})]}),T.jsx("button",{onClick:t,disabled:r,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"é–‰ã˜ã‚‹"})]})]})})})}function pl({organizationId:e}){const{organizations:t,updateOrganization:s}=un(void 0),a=t.find(t=>t.id===e),[n,l]=r.useState("general"),[i,o]=r.useState(!1);if(!a)return T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"çµ„ç¹”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"})});const d=[{id:"general",name:"ä¸€èˆ¬è¨­å®š",icon:tt},{id:"notifications",name:"é€šçŸ¥",icon:Se},{id:"security",name:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£",icon:zt},{id:"appearance",name:"å¤–è¦³",icon:yt}];return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[T.jsx($t,{className:"h-6 w-6"}),"çµ„ç¹”è¨­å®š"]}),T.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[a.name,"ã®è©³ç´°è¨­å®š"]})]}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:[T.jsx("div",{className:"border-b dark:border-gray-700",children:T.jsx("nav",{className:"flex px-6",children:d.map(e=>{const t=e.icon;return T.jsxs("button",{onClick:()=>l(e.id),className:"py-4 px-1 mr-8 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors "+(n===e.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300"),children:[T.jsx(t,{className:"h-4 w-4"}),T.jsx("span",{children:e.name})]},e.id)})})}),T.jsxs("div",{className:"p-6",children:["general"===n&&T.jsx(bl,{organization:a,onUpdate:s,saving:i,setSaving:o}),"notifications"===n&&T.jsx(yl,{organization:a,onUpdate:s,saving:i,setSaving:o}),"security"===n&&T.jsx(fl,{organization:a,onUpdate:s,saving:i,setSaving:o}),"appearance"===n&&T.jsx(vl,{organization:a,onUpdate:s,saving:i,setSaving:o})]})]})]})}function bl({organization:e,onUpdate:t,saving:s,setSaving:a}){const[n,l]=r.useState(e.name),[i,o]=r.useState(e.description||""),d=e.settings||{},[c,u]=r.useState(d.timezone||"Asia/Tokyo"),[x,m]=r.useState(d.language||"ja");return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"çµ„ç¹”å"}),T.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"èª¬æ˜"}),T.jsx("textarea",{value:i,onChange:e=>o(e.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³"}),T.jsxs("select",{value:c,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[T.jsx("option",{value:"Asia/Tokyo",children:"æ—¥æœ¬æ¨™æº–æ™‚ (JST)"}),T.jsx("option",{value:"America/New_York",children:"æ±éƒ¨æ¨™æº–æ™‚ (EST)"}),T.jsx("option",{value:"America/Los_Angeles",children:"å¤ªå¹³æ´‹æ¨™æº–æ™‚ (PST)"}),T.jsx("option",{value:"Europe/London",children:"ã‚°ãƒªãƒ‹ãƒƒã‚¸æ¨™æº–æ™‚ (GMT)"}),T.jsx("option",{value:"UTC",children:"å”å®šä¸–ç•Œæ™‚ (UTC)"})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"è¨€èª"}),T.jsxs("select",{value:x,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[T.jsx("option",{value:"ja",children:"æ—¥æœ¬èª"}),T.jsx("option",{value:"en",children:"English"})]})]}),T.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:T.jsx("button",{onClick:async()=>{a(!0);try{await t(e.id,{name:n,description:i,settings:{...d,timezone:c,language:x}}),alert("è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{a(!1)}},disabled:s,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:s?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}function yl({organization:e,onUpdate:t,saving:s,setSaving:a}){const n=e.settings||{},l=n.notifications||{},[i,o]=r.useState(!1!==l.emailAlerts),[d,c]=r.useState(l.highPriorityOnly||!1),[u,x]=r.useState(l.weeklyReport||!1),[m,g]=r.useState(!1!==l.usageLimitWarnings);return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"space-y-4",children:[T.jsxs("label",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆ"}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ACWRã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ä¿¡"})]}),T.jsx("input",{type:"checkbox",checked:i,onChange:e=>o(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]}),T.jsxs("label",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"é«˜å„ªå…ˆåº¦ã®ã¿"}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"é«˜å„ªå…ˆåº¦ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿ã‚’é€šçŸ¥"})]}),T.jsx("input",{type:"checkbox",checked:d,onChange:e=>c(e.target.checked),disabled:!i,className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})]}),T.jsxs("label",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ"}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"æ¯é€±æœˆæ›œæ—¥ã«ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’å—ä¿¡"})]}),T.jsx("input",{type:"checkbox",checked:u,onChange:e=>x(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]}),T.jsxs("label",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"ä½¿ç”¨é‡åˆ¶é™è­¦å‘Š"}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ—ãƒ©ãƒ³åˆ¶é™ã«è¿‘ã¥ã„ãŸéš›ã«é€šçŸ¥"})]}),T.jsx("input",{type:"checkbox",checked:m,onChange:e=>g(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]})]}),T.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:T.jsx("button",{onClick:async()=>{a(!0);try{await t(e.id,{settings:{...n,notifications:{emailAlerts:i,highPriorityOnly:d,weeklyReport:u,usageLimitWarnings:m}}}),alert("é€šçŸ¥è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{a(!1)}},disabled:s,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:s?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}function fl({organization:e,onUpdate:t,saving:s,setSaving:a}){const n=e.settings||{},l=n.security||{},[i,o]=r.useState(l.dataRetentionDays||365),[d,c]=r.useState(l.requireMFA||!1),[u,x]=r.useState(!1!==l.allowExport);return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ï¼ˆæ—¥æ•°ï¼‰"}),T.jsx("input",{type:"number",value:i,onChange:e=>o(parseInt(e.target.value)),min:"30",max:"3650",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"å¤ã„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã¯è‡ªå‹•çš„ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã¾ã™"})]}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("label",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"å¤šè¦ç´ èªè¨¼ã‚’è¦æ±‚"}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"å…¨ãƒ¡ãƒ³ãƒãƒ¼ã«MFAã‚’å¼·åˆ¶ï¼ˆé–‹ç™ºä¸­ï¼‰"})]}),T.jsx("input",{type:"checkbox",checked:d,onChange:e=>c(e.target.checked),disabled:!0,className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})]}),T.jsxs("label",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨±å¯"}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã‚‹"})]}),T.jsx("input",{type:"checkbox",checked:u,onChange:e=>x(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]})]}),T.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:T.jsx("button",{onClick:async()=>{a(!0);try{await t(e.id,{settings:{...n,security:{dataRetentionDays:i,requireMFA:d,allowExport:u}}}),alert("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{a(!1)}},disabled:s,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:s?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}function vl({organization:e,onUpdate:t,saving:s,setSaving:a}){const n=e.settings||{},l=n.appearance||{},[i,o]=r.useState(l.primaryColor||"#3B82F6"),[d,c]=r.useState(l.acwrThresholdLow||.8),[u,x]=r.useState(l.acwrThresholdHigh||1.3);return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚«ãƒ©ãƒ¼"}),T.jsxs("div",{className:"flex items-center gap-4",children:[T.jsx("input",{type:"color",value:i,onChange:e=>o(e.target.value),className:"h-10 w-20 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),T.jsx("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"çµ„ç¹”ã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ï¼ˆé–‹ç™ºä¸­ï¼‰"})]}),T.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[T.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"ACWRé–¾å€¤ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º"}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ä½ãƒªã‚¹ã‚¯é–¾å€¤ï¼ˆä¸‹é™ï¼‰"}),T.jsx("input",{type:"number",value:d,onChange:e=>c(parseFloat(e.target.value)),step:"0.1",min:"0.5",max:"1.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ã“ã®å€¤æœªæº€ã¯ä½ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã¨ã—ã¦è­¦å‘Š"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"é«˜ãƒªã‚¹ã‚¯é–¾å€¤ï¼ˆä¸Šé™ï¼‰"}),T.jsx("input",{type:"number",value:u,onChange:e=>x(parseFloat(e.target.value)),step:"0.1",min:"1.2",max:"2.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ã“ã®å€¤ã‚’è¶…ãˆã‚‹ã¨é«˜ãƒªã‚¹ã‚¯ã¨ã—ã¦è­¦å‘Š"})]})]})]}),T.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:T.jsx("button",{onClick:async()=>{a(!0);try{await t(e.id,{settings:{...n,appearance:{primaryColor:i,acwrThresholdLow:d,acwrThresholdHigh:u}}}),alert("å¤–è¦³è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{a(!1)}},disabled:s,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:s?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}const jl={async getMyRequests(e){const{data:t,error:r}=await z.from("team_access_requests").select("\n        *,\n        team:teams (\n          id,\n          name\n        )\n      ").eq("requester_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async getPendingRequestsForMyTeams(e){const{data:t,error:r}=await z.from("users").select("role").eq("id",e).maybeSingle();if(r)throw r;if("global_admin"===(null==t?void 0:t.role)){const{data:e,error:t}=await z.from("team_access_requests").select("\n          *,\n          requester:users!team_access_requests_requester_id_fkey (\n            id,\n            name,\n            email\n          ),\n          team:teams (\n            id,\n            name,\n            organization_id\n          )\n        ").eq("status","pending").order("created_at",{ascending:!1});if(t)throw t;return e}const{data:s,error:a}=await z.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(a)throw a;const n=(null==s?void 0:s.map(e=>e.team_id).filter(Boolean))||[];if(0===n.length)return[];const{data:l,error:i}=await z.from("team_access_requests").select("\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        )\n      ").eq("status","pending").in("team_id",n).order("created_at",{ascending:!1});if(i)throw i;return l},async getRequestsForOrganization(e){const{data:t,error:r}=await z.from("team_access_requests").select("\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        ),\n        reviewer:users!team_access_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("organization_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async getAvailableTeamsToRequest(e,t){const{data:r,error:s}=await z.from("users").select("team_id").eq("id",e).maybeSingle();if(s)throw s;const{data:a,error:n}=await z.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(n)throw n;const l=(a??[]).map(e=>e.team_id).filter(Boolean);(null==r?void 0:r.team_id)&&l.push(r.team_id);const{data:i,error:o}=await z.from("team_access_requests").select("team_id").eq("requester_id",e).eq("status","pending");if(o)throw o;const d=(i??[]).map(e=>e.team_id).filter(Boolean),c=Array.from(new Set([...l,...d])).filter(Boolean),{data:u,error:x}=await z.from("teams").select("id, name, organization_id").eq("organization_id",t).order("name");if(x)throw x;return c.length?(u??[]).filter(e=>!c.includes(e.id)):u??[]},async createRequest(e,t,r,s=""){const{data:a,error:n}=await z.from("team_access_requests").insert({requester_id:e,team_id:t,organization_id:r,status:"pending",request_message:s}).select().single();if(n)throw n;return a},async approveRequest(e,t,r=""){const{error:s}=await z.rpc("approve_team_access_request",{request_id:e,reviewer_user_id:t,notes:r});if(s)throw s},async rejectRequest(e,t,r=""){const{error:s}=await z.rpc("reject_team_access_request",{request_id:e,reviewer_user_id:t,notes:r});if(s)throw s},async cancelRequest(e){const{error:t}=await z.from("team_access_requests").delete().eq("id",e).eq("status","pending");if(t)throw t},async getRequestById(e){const{data:t,error:r}=await z.from("team_access_requests").select("\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        ),\n        reviewer:users!team_access_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("id",e).maybeSingle();if(r)throw r;return t}};function wl({userId:e,organizationId:t,isAdmin:s=!1}){var a,n;const{myRequests:l,pendingRequests:i,organizationRequests:o,availableTeams:d,loading:c,error:u,createRequest:x,approveRequest:m,rejectRequest:g,cancelRequest:h}=function(e,t){const[s,a]=r.useState([]),[n,l]=r.useState([]),[i,o]=r.useState([]),[d,c]=r.useState([]),[u,x]=r.useState(!0),[m,g]=r.useState(null),h=r.useCallback(async()=>{try{const t=await jl.getMyRequests(e);a(t)}catch(t){throw console.error("Error loading my requests:",t),t}},[e]),p=r.useCallback(async()=>{try{const t=await jl.getPendingRequestsForMyTeams(e);l(t)}catch(t){throw console.error("Error loading pending requests:",t),t}},[e]),b=r.useCallback(async()=>{if(t)try{const e=await jl.getRequestsForOrganization(t);o(e)}catch(e){throw console.error("Error loading organization requests:",e),e}},[t]),y=r.useCallback(async()=>{if(t)try{const r=await jl.getAvailableTeamsToRequest(e,t);c(r)}catch(r){throw console.error("Error loading available teams:",r),r}},[e,t]),f=r.useCallback(async()=>{x(!0),g(null);try{const e=await Promise.allSettled([h(),p(),t?b():Promise.resolve(),t?y():Promise.resolve()]);e.forEach((e,t)=>{if("rejected"===e.status){const r=["myRequests","pendingRequests","organizationRequests","availableTeams"];console.error(`Failed to load ${r[t]}:`,e.reason)}}),2===e.filter((e,t)=>t<2&&"rejected"===e.status).length&&g("Failed to load team access requests")}catch(e){g(e instanceof Error?e.message:"Failed to load team access requests")}finally{x(!1)}},[h,p,b,y,t]);return r.useEffect(()=>{f()},[f]),{myRequests:s,pendingRequests:n,organizationRequests:i,availableTeams:d,loading:u,error:m,createRequest:r.useCallback(async(r,s="")=>{if(!t)throw new Error("Organization ID is required");try{await jl.createRequest(e,r,t,s),await f()}catch(a){throw new Error(a instanceof Error?a.message:"Failed to create request")}},[e,t,f]),approveRequest:r.useCallback(async(t,r="")=>{try{await jl.approveRequest(t,e,r),await f()}catch(s){throw new Error(s instanceof Error?s.message:"Failed to approve request")}},[e,f]),rejectRequest:r.useCallback(async(t,r="")=>{try{await jl.rejectRequest(t,e,r),await f()}catch(s){throw new Error(s instanceof Error?s.message:"Failed to reject request")}},[e,f]),cancelRequest:r.useCallback(async e=>{try{await jl.cancelRequest(e),await f()}catch(t){throw new Error(t instanceof Error?t.message:"Failed to cancel request")}},[f]),refresh:f}}(e,t),[p,b]=r.useState(!1),[y,f]=r.useState(""),[v,j]=r.useState(""),[w,N]=r.useState(""),[k,_]=r.useState(null),[S,C]=r.useState(!1),[E,D]=r.useState("my");console.log("TeamAccessRequestManagement render:",{userId:e,organizationId:t,availableTeamsCount:d.length,loading:c,error:u});const M=e=>{switch(e){case"pending":return T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:[T.jsx(Oe,{className:"h-3 w-3"}),"æ‰¿èªå¾…ã¡"]});case"approved":return T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:[T.jsx($e,{className:"h-3 w-3"}),"æ‰¿èªæ¸ˆã¿"]});case"rejected":return T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:[T.jsx(ar,{className:"h-3 w-3"}),"å´ä¸‹"]});default:return null}};return c?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):u?T.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx(ye,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),T.jsx("p",{className:"text-red-800 dark:text-red-200",children:u})]})}):T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[T.jsx(rr,{className:"h-6 w-6"}),"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†"]}),T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"ä»–ã®ãƒãƒ¼ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ç®¡ç†"})]}),d.length>0&&T.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[T.jsx(kt,{className:"h-4 w-4"}),"æ–°è¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"]})]}),T.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:T.jsxs("nav",{className:"flex gap-4",children:[T.jsxs("button",{onClick:()=>D("my"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("my"===E?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["è‡ªåˆ†ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (",l.length,")"]}),T.jsxs("button",{onClick:()=>D("pending"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("pending"===E?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["æ‰¿èªå¾…ã¡ (",i.length,")"]}),s&&T.jsxs("button",{onClick:()=>D("all"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("all"===E?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["ã™ã¹ã¦ (",o.length,")"]})]})}),"my"===E&&T.jsx("div",{className:"space-y-4",children:0===l.length?T.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):l.map(e=>{var t;return T.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.team)?void 0:t.name}),M(e.status)]}),e.request_message&&T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:e.request_message}),e.review_notes&&T.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¡ãƒ¢:"})," ",e.review_notes]})}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),"pending"===e.status&&T.jsx("button",{onClick:()=>(async e=>{if(confirm("ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ")){C(!0);try{await h(e)}catch(t){alert(t instanceof Error?t.message:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{C(!1)}}})(e.id),disabled:S,className:"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})},e.id)})}),"pending"===E&&T.jsx("div",{className:"space-y-4",children:0===i.length?T.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"æ‰¿èªå¾…ã¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):i.map(e=>{var t,r;return T.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.requester)?void 0:t.name}),T.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ãŒ ",null==(r=e.team)?void 0:r.name," ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"]})]}),e.request_message&&T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:e.request_message}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),T.jsxs("div",{className:"flex gap-2",children:[T.jsx("button",{onClick:()=>_(e),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"æ‰¿èª"}),T.jsx("button",{onClick:()=>{_(e),N("")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"å´ä¸‹"})]})]})},e.id)})}),"all"===E&&s&&T.jsx("div",{className:"space-y-4",children:0===o.length?T.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):o.map(e=>{var t,r;return T.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:T.jsx("div",{className:"flex items-start justify-between",children:T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.requester)?void 0:t.name}),T.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["â†’ ",null==(r=e.team)?void 0:r.name]}),M(e.status)]}),e.request_message&&T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:e.request_message}),e.review_notes&&T.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼:"})," ",e.review_notes,e.reviewer&&` by ${e.reviewer.name}`]})}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]})})},e.id)})}),p&&T.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒãƒ¼ãƒ ã‚’é¸æŠ"}),T.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[T.jsx("option",{value:"",children:"é¸æŠã—ã¦ãã ã•ã„"}),d.map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰"}),T.jsx("textarea",{value:v,onChange:e=>j(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç†ç”±ã‚„è©³ç´°ã‚’å…¥åŠ›..."})]})]}),T.jsxs("div",{className:"flex gap-3 mt-6",children:[T.jsx("button",{onClick:()=>b(!1),disabled:S,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:async()=>{if(y){C(!0);try{await x(y,v),b(!1),f(""),j("")}catch(e){alert(e instanceof Error?e.message:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{C(!1)}}},disabled:S||!y,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:S?"é€ä¿¡ä¸­...":"ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡"})]})]})}),k&&T.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{className:"font-medium",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…:"})," ",null==(a=k.requester)?void 0:a.name]}),T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{className:"font-medium",children:"ãƒãƒ¼ãƒ :"})," ",null==(n=k.team)?void 0:n.name]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),T.jsx("textarea",{value:w,onChange:e=>N(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..."})]})]}),T.jsxs("div",{className:"flex gap-3 mt-6",children:[T.jsx("button",{onClick:()=>{_(null),N("")},disabled:S,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:()=>(async e=>{C(!0);try{await g(e.id,w),_(null),N("")}catch(t){alert(t instanceof Error?t.message:"å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{C(!1)}})(k),disabled:S,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:"å´ä¸‹"}),T.jsx("button",{onClick:()=>(async e=>{C(!0);try{await m(e.id,w),_(null),N("")}catch(t){alert(t instanceof Error?t.message:"æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{C(!1)}})(k),disabled:S,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:"æ‰¿èª"})]})]})})]})}const Nl={async getMyTransferRequests(e){const{data:t,error:r}=await z.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        )\n      ").or(`athlete_id.eq.${e},requested_by.eq.${e}`).order("created_at",{ascending:!1});if(r)throw r;return t},async getPendingRequestsForMyTeams(e){const{data:t,error:r}=await z.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(r)throw r;const s=(null==t?void 0:t.map(e=>e.team_id))||[];if(0===s.length)return[];const{data:a,error:n}=await z.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        )\n      ").eq("status","pending").in("from_team_id",s).order("created_at",{ascending:!1});if(n)throw n;return a},async getRequestsForOrganization(e){const{data:t,error:r}=await z.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        ),\n        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("organization_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async getAthletesInMyTeams(e){const{data:t,error:r}=await z.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(r)throw r;const s=(null==t?void 0:t.map(e=>e.team_id))||[];if(0===s.length)return[];const{data:a,error:n}=await z.from("users").select("\n        id,\n        name,\n        email,\n        team_id,\n        team:teams (\n          id,\n          name\n        )\n      ").eq("role","athlete").in("team_id",s).order("name");if(n)throw n;return a},async getAvailableDestinationTeams(e,t){const{data:r,error:s}=await z.from("teams").select("id, name, organization_id").eq("organization_id",e).neq("id",t).order("name");if(s)throw s;return r},async createTransferRequest(e,t,r,s,a,n=""){const{data:l,error:i}=await z.from("athlete_transfer_requests").insert({athlete_id:e,from_team_id:t,to_team_id:r,organization_id:s,requested_by:a,status:"pending",request_reason:n}).select().single();if(i)throw i;return l},async approveTransfer(e,t,r=""){const{error:s}=await z.rpc("approve_athlete_transfer",{request_id:e,reviewer_user_id:t,notes:r});if(s)throw s},async rejectTransfer(e,t,r=""){const{error:s}=await z.rpc("reject_athlete_transfer",{request_id:e,reviewer_user_id:t,notes:r});if(s)throw s},async cancelTransferRequest(e){const{error:t}=await z.from("athlete_transfer_requests").delete().eq("id",e).eq("status","pending");if(t)throw t},async getTransferHistory(e){const{data:t,error:r}=await z.from("team_transfer_history").select("\n        *,\n        athlete:users!team_transfer_history_athlete_id_fkey (\n          id,\n          name\n        ),\n        from_team:teams!team_transfer_history_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!team_transfer_history_to_team_id_fkey (\n          id,\n          name\n        ),\n        transferred_by_user:users!team_transfer_history_transferred_by_fkey (\n          id,\n          name\n        )\n      ").eq("athlete_id",e).order("transfer_date",{ascending:!1});if(r)throw r;return t},async getTeamTransferHistory(e){const{data:t,error:r}=await z.from("team_transfer_history").select("\n        *,\n        athlete:users!team_transfer_history_athlete_id_fkey (\n          id,\n          name\n        ),\n        from_team:teams!team_transfer_history_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!team_transfer_history_to_team_id_fkey (\n          id,\n          name\n        ),\n        transferred_by_user:users!team_transfer_history_transferred_by_fkey (\n          id,\n          name\n        )\n      ").or(`from_team_id.eq.${e},to_team_id.eq.${e}`).order("transfer_date",{ascending:!1});if(r)throw r;return t},async getRequestById(e){const{data:t,error:r}=await z.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        ),\n        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("id",e).maybeSingle();if(r)throw r;return t}};function kl({userId:e,organizationId:t,isAdmin:s=!1}){var a,n,l,i,o;const{myRequests:d,pendingRequests:c,organizationRequests:u,myAthletes:x,loading:m,error:g,createTransferRequest:h,approveTransfer:p,rejectTransfer:b,cancelTransferRequest:y,getTransferHistory:f,getAvailableDestinationTeams:v}=function(e,t){const[s,a]=r.useState([]),[n,l]=r.useState([]),[i,o]=r.useState([]),[d,c]=r.useState([]),[u,x]=r.useState(!0),[m,g]=r.useState(null),h=r.useCallback(async()=>{try{const t=await Nl.getMyTransferRequests(e);a(t)}catch(t){throw console.error("Error loading my transfer requests:",t),t}},[e]),p=r.useCallback(async()=>{try{const t=await Nl.getPendingRequestsForMyTeams(e);l(t)}catch(t){throw console.error("Error loading pending transfer requests:",t),t}},[e]),b=r.useCallback(async()=>{if(t)try{const e=await Nl.getRequestsForOrganization(t);o(e)}catch(e){throw console.error("Error loading organization transfer requests:",e),e}},[t]),y=r.useCallback(async()=>{try{const t=await Nl.getAthletesInMyTeams(e);c(t)}catch(t){throw console.error("Error loading my athletes:",t),t}},[e]),f=r.useCallback(async()=>{x(!0),g(null);try{await Promise.all([h(),p(),y(),t?b():Promise.resolve()])}catch(e){g(e instanceof Error?e.message:"Failed to load transfer requests")}finally{x(!1)}},[h,p,y,b,t]);return r.useEffect(()=>{f()},[f]),{myRequests:s,pendingRequests:n,organizationRequests:i,myAthletes:d,loading:u,error:m,createTransferRequest:r.useCallback(async(r,s,a,n="")=>{if(!t)throw new Error("Organization ID is required");try{await Nl.createTransferRequest(r,s,a,t,e,n),await f()}catch(l){throw new Error(l instanceof Error?l.message:"Failed to create transfer request")}},[e,t,f]),approveTransfer:r.useCallback(async(t,r="")=>{try{await Nl.approveTransfer(t,e,r),await f()}catch(s){throw new Error(s instanceof Error?s.message:"Failed to approve transfer")}},[e,f]),rejectTransfer:r.useCallback(async(t,r="")=>{try{await Nl.rejectTransfer(t,e,r),await f()}catch(s){throw new Error(s instanceof Error?s.message:"Failed to reject transfer")}},[e,f]),cancelTransferRequest:r.useCallback(async e=>{try{await Nl.cancelTransferRequest(e),await f()}catch(t){throw new Error(t instanceof Error?t.message:"Failed to cancel transfer request")}},[f]),getTransferHistory:r.useCallback(async e=>{try{return await Nl.getTransferHistory(e)}catch(t){throw new Error(t instanceof Error?t.message:"Failed to get transfer history")}},[]),getAvailableDestinationTeams:r.useCallback(async e=>{if(!t)throw new Error("Organization ID is required");try{return await Nl.getAvailableDestinationTeams(t,e)}catch(r){throw new Error(r instanceof Error?r.message:"Failed to get available teams")}},[t]),refresh:f}}(e,t),[j,w]=r.useState(!1),[N,k]=r.useState(null),[_,S]=r.useState(""),[C,E]=r.useState(""),[D,M]=r.useState(""),[R,$]=r.useState(null),[A,I]=r.useState(!1),[z,P]=r.useState("my"),[L,q]=r.useState([]),[F,O]=r.useState(!1),[W,B]=r.useState([]),U=e=>{switch(e){case"pending":return T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:[T.jsx(Oe,{className:"h-3 w-3"}),"æ‰¿èªå¾…ã¡"]});case"approved":return T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:[T.jsx($e,{className:"h-3 w-3"}),"æ‰¿èªæ¸ˆã¿"]});case"completed":return T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:[T.jsx($e,{className:"h-3 w-3"}),"å®Œäº†"]});case"rejected":return T.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:[T.jsx(ar,{className:"h-3 w-3"}),"å´ä¸‹"]});default:return null}};return m?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):g?T.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx(ye,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),T.jsx("p",{className:"text-red-800 dark:text-red-200",children:g})]})}):T.jsxs("div",{className:"space-y-6",children:[T.jsx("div",{className:"flex items-center justify-between",children:T.jsxs("div",{children:[T.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[T.jsx(Zt,{className:"h-6 w-6"}),"é¸æ‰‹ç§»ç±ç®¡ç†"]}),T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"é¸æ‰‹ã®ãƒãƒ¼ãƒ é–“ç§»ç±ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ç®¡ç†"})]})}),T.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:T.jsxs("nav",{className:"flex gap-4",children:[T.jsxs("button",{onClick:()=>P("my"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("my"===z?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["è‡ªåˆ†ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (",d.length,")"]}),T.jsxs("button",{onClick:()=>P("pending"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("pending"===z?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["æ‰¿èªå¾…ã¡ (",c.length,")"]}),s&&T.jsxs("button",{onClick:()=>P("all"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("all"===z?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["ã™ã¹ã¦ (",u.length,")"]})]})}),"my"===z&&T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"æ‹…å½“é¸æ‰‹"}),T.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(e=>{var t;return T.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[T.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:null==(t=e.team)?void 0:t.name}),T.jsxs("div",{className:"flex gap-2 mt-3",children:[T.jsx("button",{onClick:()=>(async e=>{k(e);try{const t=await v(e.team_id);q(t),w(!0)}catch(t){alert(t instanceof Error?t.message:"åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ãƒ ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}})(e),className:"flex-1 px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"ç§»ç±ç”³è«‹"}),T.jsx("button",{onClick:()=>(async e=>{try{const t=await f(e);B(t),O(!0)}catch(t){alert(t instanceof Error?t.message:"å±¥æ­´ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}})(e.id),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:T.jsx(nt,{className:"h-4 w-4"})})]})]},e.id)})})]}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±¥æ­´"}),T.jsx("div",{className:"space-y-4",children:0===d.length?T.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):d.map(e=>{var t,r,s;return T.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[T.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.athlete)?void 0:t.name}),U(e.status)]}),T.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{children:null==(r=e.from_team)?void 0:r.name}),T.jsx(je,{className:"h-4 w-4"}),T.jsx("span",{children:null==(s=e.to_team)?void 0:s.name})]}),e.request_reason&&T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ç†ç”±: ",e.request_reason]}),e.review_notes&&T.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼:"})," ",e.review_notes]})}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),"pending"===e.status&&T.jsx("button",{onClick:()=>(async e=>{if(confirm("ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ")){I(!0);try{await y(e)}catch(t){alert(t instanceof Error?t.message:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{I(!1)}}})(e.id),disabled:A,className:"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})},e.id)})})]})]}),"pending"===z&&T.jsx("div",{className:"space-y-4",children:0===c.length?T.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"æ‰¿èªå¾…ã¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):c.map(e=>{var t,r,s,a;return T.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[T.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.athlete)?void 0:t.name}),T.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ã®ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"})]}),T.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[T.jsx("span",{children:null==(r=e.from_team)?void 0:r.name}),T.jsx(je,{className:"h-4 w-4"}),T.jsx("span",{children:null==(s=e.to_team)?void 0:s.name})]}),T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…: ",null==(a=e.requester)?void 0:a.name]}),e.request_reason&&T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ç†ç”±: ",e.request_reason]}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),T.jsxs("div",{className:"flex gap-2",children:[T.jsx("button",{onClick:()=>$(e),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"æ‰¿èª"}),T.jsx("button",{onClick:()=>{$(e),M("")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"å´ä¸‹"})]})]})},e.id)})}),"all"===z&&s&&T.jsx("div",{className:"space-y-4",children:0===u.length?T.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):u.map(e=>{var t,r,s,a;return T.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:T.jsx("div",{className:"flex items-start justify-between",children:T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[T.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.athlete)?void 0:t.name}),U(e.status)]}),T.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[T.jsx("span",{children:null==(r=e.from_team)?void 0:r.name}),T.jsx(je,{className:"h-4 w-4"}),T.jsx("span",{children:null==(s=e.to_team)?void 0:s.name})]}),T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…: ",null==(a=e.requester)?void 0:a.name]}),e.request_reason&&T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ç†ç”±: ",e.request_reason]}),e.review_notes&&T.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼:"})," ",e.review_notes,e.reviewer&&` by ${e.reviewer.name}`]})}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]})})},e.id)})}),j&&N&&T.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ"}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"é¸æ‰‹"}),T.jsx("p",{className:"text-gray-900 dark:text-white",children:N.name}),T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ç¾åœ¨ã®ãƒãƒ¼ãƒ : ",null==(a=N.team)?void 0:a.name]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç§»ç±å…ˆãƒãƒ¼ãƒ "}),T.jsxs("select",{value:_,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[T.jsx("option",{value:"",children:"é¸æŠã—ã¦ãã ã•ã„"}),L.map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç§»ç±ç†ç”±"}),T.jsx("textarea",{value:C,onChange:e=>E(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ç§»ç±ã®ç†ç”±ã‚’å…¥åŠ›..."})]})]}),T.jsxs("div",{className:"flex gap-3 mt-6",children:[T.jsx("button",{onClick:()=>{w(!1),k(null),S(""),E(""),q([])},disabled:A,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:async()=>{if(N&&_){I(!0);try{await h(N.id,N.team_id,_,C),w(!1),k(null),S(""),E(""),q([])}catch(e){alert(e instanceof Error?e.message:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{I(!1)}}},disabled:A||!_,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:A?"é€ä¿¡ä¸­...":"ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡"})]})]})}),R&&T.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T.jsx("span",{className:"font-medium",children:"é¸æ‰‹:"})," ",null==(n=R.athlete)?void 0:n.name]}),T.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mt-1",children:[T.jsx("span",{children:null==(l=R.from_team)?void 0:l.name}),T.jsx(je,{className:"h-4 w-4"}),T.jsx("span",{children:null==(i=R.to_team)?void 0:i.name})]}),T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[T.jsx("span",{className:"font-medium",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…:"})," ",null==(o=R.requester)?void 0:o.name]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),T.jsx("textarea",{value:D,onChange:e=>M(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..."})]})]}),T.jsxs("div",{className:"flex gap-3 mt-6",children:[T.jsx("button",{onClick:()=>{$(null),M("")},disabled:A,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{onClick:()=>(async e=>{I(!0);try{await b(e.id,D),$(null),M("")}catch(t){alert(t instanceof Error?t.message:"å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{I(!1)}})(R),disabled:A,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:"å´ä¸‹"}),T.jsx("button",{onClick:()=>(async e=>{var t;if(confirm(`${null==(t=e.athlete)?void 0:t.name}ã®ç§»ç±ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)){I(!0);try{await p(e.id,D),$(null),M("")}catch(r){alert(r instanceof Error?r.message:"æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{I(!1)}}})(R),disabled:A,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:"æ‰¿èª"})]})]})}),F&&T.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ç§»ç±å±¥æ­´"}),T.jsx("button",{onClick:()=>O(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:T.jsx(ar,{className:"h-5 w-5"})})]}),T.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===W.length?T.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"ç§»ç±å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“"}):W.map(e=>{var t;return T.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:[T.jsxs("div",{className:"flex items-center gap-2 text-sm mb-1",children:[e.from_team?T.jsxs(T.Fragment,{children:[T.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:e.from_team.name}),T.jsx(je,{className:"h-4 w-4"})]}):T.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"æ–°è¦ç™»éŒ²"}),T.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:e.to_team.name})]}),e.transfer_reason&&T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.transfer_reason}),T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[new Date(e.transfer_date).toLocaleString("ja-JP")," by"," ",null==(t=e.transferred_by_user)?void 0:t.name]})]},e.id)})})]})})]})}function _l(e){return e.trim().toLowerCase()}function Sl({organizationId:e,organizationName:t}){const[s,a]=r.useState([]),[n,l]=r.useState([]),[i,o]=r.useState([]),[d,c]=r.useState(!0),[u,x]=r.useState(!1),[m,g]=r.useState(!1),[h,p]=r.useState(null),[b,y]=r.useState(""),[f,v]=r.useState({}),[j,w]=r.useState({});r.useEffect(()=>{N(),k(),_()},[e]);const N=async()=>{try{c(!0);const t=await cn.getOrganizationMembers(e);a(t||[])}catch(t){console.error("Error loading members:",t),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{c(!1)}},k=async()=>{try{const{data:e,error:t}=await z.from("users").select("*").order("name");if(t)throw t;l(e||[])}catch(e){console.error("Error loading users:",e)}},_=async()=>{try{const t=await cn.getOrganizationTeams(e);o(t||[])}catch(t){console.error("Error loading organization teams:",t)}},S=async(e,t)=>{try{await cn.updateOrganizationMemberRole(e,t),await N(),alert("æ¨©é™ã‚’æ›´æ–°ã—ã¾ã—ãŸ")}catch(r){console.error("Error updating role:",r),alert("æ¨©é™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}},C=async e=>{if(confirm("ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{await cn.removeOrganizationMember(e),await N(),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ")}catch(t){console.error("Error removing member:",t),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}},E=async e=>{const t=_l(e);if(t&&"sending"!==f[t]){v(e=>({...e,[t]:"sending"})),w(e=>({...e,[t]:""}));try{const{data:e,error:r}=await z.functions.invoke("request-password-reset",{body:{email:t,redirectUrl:`${window.location.origin}/reset-password`}});if(r)return console.error("[OrganizationMembersManagement] request-password-reset error:",r),v(e=>({...e,[t]:"error"})),void w(e=>({...e,[t]:"é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"}));console.log("[OrganizationMembersManagement] request-password-reset result:",e),v(e=>({...e,[t]:"success"})),w(e=>({...e,[t]:"å†è¨­å®šãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆè¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ï¼‰ã€‚"})),window.setTimeout(()=>{v(e=>({...e,[t]:"idle"})),w(e=>({...e,[t]:""}))},5e3)}catch(r){console.error("[OrganizationMembersManagement] exception:",r),v(e=>({...e,[t]:"error"})),w(e=>({...e,[t]:(null==r?void 0:r.message)||"é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"}))}}},D=e=>"organization_admin"===e?T.jsx(zt,{className:"h-4 w-4 text-blue-600"}):T.jsx(rr,{className:"h-4 w-4 text-gray-600"}),M=e=>{switch(e){case"organization_admin":return"çµ„ç¹”ç®¡ç†è€…";case"member":return"ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼";default:return e}},R=e=>{switch(e){case"organization_admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"member":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200";default:return"bg-gray-100 text-gray-800"}},$=r.useMemo(()=>s.filter(e=>{var t,r;if(!b)return!0;const s=e.users;if(!s)return!1;const a=b.toLowerCase();return(null==(t=s.name)?void 0:t.toLowerCase().includes(a))||(null==(r=s.email)?void 0:r.toLowerCase().includes(a))}),[s,b]);return d?T.jsx("div",{className:"flex items-center justify-center py-12",children:T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[T.jsx(rr,{className:"h-6 w-6"}),"çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†"]}),T.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[t,"ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨æ¨©é™ã‚’ç®¡ç†"]})]}),T.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[T.jsx(kt,{className:"h-4 w-4"}),"ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "]})]}),T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4",children:T.jsxs("div",{className:"relative",children:[T.jsx(Tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),T.jsx("input",{type:"text",value:b,onChange:e=>y(e.target.value),placeholder:"åå‰ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})}),T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:[T.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:T.jsx("div",{className:"flex items-center justify-between",children:T.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ (",$.length,")"]})})}),T.jsx("div",{className:"divide-y dark:divide-gray-700",children:0===$.length?T.jsx("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:b?"æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“":"ãƒ¡ãƒ³ãƒãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):$.map(e=>T.jsx(Cl,{member:e,onUpdateRole:S,onRemove:C,onAssignTeam:e=>{p(e),g(!0)},onResendPasswordLink:E,sendStateByEmail:f,sendMsgByEmail:j,getRoleIcon:D,getRoleLabel:M,getRoleBadgeColor:R},e.id))})]}),u&&T.jsx(El,{organizationId:e,existingMembers:s,availableUsers:n,onClose:()=>x(!1),onAdd:async(t,r)=>{try{await cn.addOrganizationMember({user_id:t,organization_id:e,role:r}),await N(),x(!1),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ")}catch(s){console.error("Error adding member:",s),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(s instanceof Error?s.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}},getRoleIcon:D,getRoleLabel:M}),m&&h&&T.jsx(Dl,{member:h,teams:i,onClose:()=>{g(!1),p(null)},onAssign:async(t,r)=>{try{const{error:s}=await z.rpc("assign_user_to_team",{p_user_id:t,p_team_id:r,p_organization_id:e,p_assignment_type:"primary"});if(s)throw s;await N(),g(!1),p(null),alert("ãƒãƒ¼ãƒ ã¸ã®å‰²ã‚Šå½“ã¦ãŒå®Œäº†ã—ã¾ã—ãŸ")}catch(s){console.error("Error assigning to team:",s),alert("ãƒãƒ¼ãƒ ã¸ã®å‰²ã‚Šå½“ã¦ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(s instanceof Error?s.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}}})]})}function Cl({member:e,onUpdateRole:t,onRemove:r,onAssignTeam:s,onResendPasswordLink:a,sendStateByEmail:n,sendMsgByEmail:l,getRoleIcon:i,getRoleLabel:o,getRoleBadgeColor:d}){var c,u,x,m;const g=e.users;if(!g)return null;const h=_l(g.email||""),p=n[h]||"idle",b=l[h]||"",y="sending"===p;return T.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:T.jsxs("div",{className:"flex items-start justify-between gap-3",children:[T.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[T.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:T.jsx("span",{className:"text-blue-600 dark:text-blue-200 font-semibold",children:(null==(u=null==(c=g.name)?void 0:c[0])?void 0:u.toUpperCase())||(null==(m=null==(x=g.email)?void 0:x[0])?void 0:m.toUpperCase())||"?"})}),T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[T.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:g.name||"Unknown User"}),T.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${d(e.role)}`,children:[i(e.role),o(e.role)]})]}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:g.email}),T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["è¿½åŠ æ—¥: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),b&&T.jsxs("div",{className:"mt-2 text-xs rounded-md px-2 py-1 inline-flex items-start gap-1 border "+("success"===p?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200":"error"===p?"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200":"bg-gray-50 border-gray-200 text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200"),children:["success"===p?T.jsx(Re,{className:"h-3.5 w-3.5 mt-0.5"}):"error"===p?T.jsx(fe,{className:"h-3.5 w-3.5 mt-0.5"}):null,T.jsx("span",{children:b})]})]})]}),T.jsxs("div",{className:"flex items-center gap-2 ml-2 flex-shrink-0",children:[T.jsxs("button",{onClick:()=>s(e),className:"px-3 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1",title:"ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦",children:[T.jsx(Xt,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden sm:inline",children:"ãƒãƒ¼ãƒ å‰²å½“"})]}),T.jsx("button",{onClick:()=>a(g.email),disabled:!g.email||y,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\n                       disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šãƒªãƒ³ã‚¯ã‚’å†é€",children:y?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),T.jsx("span",{className:"hidden sm:inline",children:"é€ä¿¡ä¸­"})]}):T.jsxs(T.Fragment,{children:[T.jsx(_t,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden sm:inline",children:"å†é€"})]})}),T.jsxs("select",{value:e.role,onChange:r=>t(e.id,r.target.value),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[T.jsx("option",{value:"organization_admin",children:"çµ„ç¹”ç®¡ç†è€…"}),T.jsx("option",{value:"member",children:"ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼"})]}),T.jsx("button",{onClick:()=>r(e.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"å‰Šé™¤",children:T.jsx(Ut,{className:"h-4 w-4"})})]})]})})}function El({organizationId:e,existingMembers:t,availableUsers:s,onClose:a,onAdd:n,getRoleIcon:l,getRoleLabel:i}){const[o,d]=r.useState(""),[c,u]=r.useState("organization_admin"),[x,m]=r.useState(!1),[g,h]=r.useState(""),p=new Set(t.map(e=>e.user_id)),b=s.filter(e=>!p.has(e.id)).filter(e=>{var t,r;if(!g)return!0;const s=g.toLowerCase();return(null==(t=e.name)?void 0:t.toLowerCase().includes(s))||(null==(r=e.email)?void 0:r.toLowerCase().includes(s))});return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:T.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o){m(!0);try{await n(o,c)}finally{m(!1)}}else alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„")},children:[T.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"çµ„ç¹”ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¦æ¨©é™ã‚’è¨­å®šã—ã¾ã™"})]}),T.jsxs("div",{className:"p-6 space-y-6",children:[T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ ",T.jsx("span",{className:"text-red-600",children:"*"})]}),T.jsx("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"åå‰ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-3"}),T.jsx("div",{className:"border dark:border-gray-600 rounded-lg max-h-60 overflow-y-auto",children:0===b.length?T.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:g?"è©²å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“":"è¿½åŠ å¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¾ã›ã‚“"}):T.jsx("div",{className:"divide-y dark:divide-gray-700",children:b.map(e=>T.jsxs("label",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors "+(o===e.id?"bg-blue-50 dark:bg-blue-900/20":""),children:[T.jsx("input",{type:"radio",name:"user",value:e.id,checked:o===e.id,onChange:e=>d(e.target.value),className:"h-4 w-4 text-blue-600"}),T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.name||"Unknown User"}),T.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:e.email}),e.role&&T.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ­ãƒ¼ãƒ«: ",e.role]})]})]},e.id))})})]}),T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:["æ¨©é™ã‚’é¸æŠ ",T.jsx("span",{className:"text-red-600",children:"*"})]}),T.jsx("div",{className:"space-y-3",children:[{value:"organization_admin",label:"çµ„ç¹”ç®¡ç†è€…",description:"çµ„ç¹”å†…ã®ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¨è¨­å®šã‚’ç®¡ç†ã§ãã¾ã™ï¼ˆç›£ç£ã€GMã€çµ±æ‹¬ã‚³ãƒ¼ãƒãªã©ï¼‰"},{value:"member",label:"ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼",description:"é€šå¸¸ã®ã‚³ãƒ¼ãƒ/é¸æ‰‹ã¨ã—ã¦æ´»å‹•ã—ã¾ã™ï¼ˆç®¡ç†æ¨©é™ãªã—ï¼‰"}].map(e=>T.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-colors "+(c===e.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[T.jsx("input",{type:"radio",name:"role",value:e.value,checked:c===e.value,onChange:e=>u(e.target.value),className:"mt-1 h-4 w-4 text-blue-600"}),T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[l(e.value),T.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.label})]}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]})]},e.value))})]})]}),T.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700",children:[T.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:x,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:x||!o,children:x?"è¿½åŠ ä¸­...":"ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "})]})]})})})}function Dl({member:e,teams:t,onClose:s,onAssign:a}){const[n,l]=r.useState(""),[i,o]=r.useState(!1),d=e.users;if(!d)return null;return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:T.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:T.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),n){o(!0);try{await a(d.id,n)}finally{o(!1)}}else alert("ãƒãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„")},children:[T.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦"}),T.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[d.name,"ã•ã‚“ã‚’ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦ã¾ã™"]})]}),T.jsxs("div",{className:"p-6 space-y-4",children:[T.jsxs("div",{children:[T.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ãƒãƒ¼ãƒ ã‚’é¸æŠ ",T.jsx("span",{className:"text-red-600",children:"*"})]}),T.jsxs("select",{value:n,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0,children:[T.jsx("option",{value:"",children:"ãƒãƒ¼ãƒ ã‚’é¸æŠ..."}),t.map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))]}),0===t.length&&T.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-2",children:"ã“ã®çµ„ç¹”ã«ã¯ã¾ã ãƒãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ãƒãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"})]}),T.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:T.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[T.jsx("strong",{children:"æ³¨æ„:"})," ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é¸æŠã—ãŸãƒãƒ¼ãƒ ã«ä¸»è¦ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚"]})})]}),T.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700",children:[T.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:i,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),T.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center gap-2",disabled:i||!n||0===t.length,children:i?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),T.jsx("span",{children:"å‰²ã‚Šå½“ã¦ä¸­..."})]}):T.jsxs(T.Fragment,{children:[T.jsx(Xt,{className:"h-4 w-4"}),T.jsx("span",{children:"ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦"})]})})]})]})})})}const Ml=2e3;function Tl(e){return(e??"").trim().replace(/^\uFEFF/,"").replace(/\u3000/g," ").replace(/\s+/g," ").replace(/^\s*\d+\s*[\.\)\-:]\s*/g,"").toLowerCase().replace(/\s+/g," ").replace(/[^a-z0-9\u3040-\u30ff\u4e00-\u9faf %/_-]/g,"")}function Rl(e){const t=(e??"").toString().trim();if(!t)return null;const r=Number(t.replace(/,/g,""));return Number.isFinite(r)?r:null}function $l(e,t){const r=e.map(e=>({raw:e,norm:Tl(e)})).find(e=>t.includes(e.norm));return(null==r?void 0:r.raw)??null}function Al(){const[e,t]=r.useState(""),[s,a]=r.useState(""),[n,l]=r.useState(!1),[i,o]=r.useState(!1),[d,c]=r.useState([]),[u,x]=r.useState([]),[m,g]=r.useState(""),h=d.length,p=u.length,b=r.useMemo(()=>h>0&&!i,[h,i]),y=async e=>{t(e.name),g(""),c([]),x([]),l(!0);try{const t=await e.text();a(t);const r=function(e){const t=[];let r=[],s="",a=!1;for(let n=0;n<e.length;n++){const l=e[n],i=e[n+1];'"'!==l?a||","!==l&&"\t"!==l?a||"\n"!==l&&"\r"!==l?s+=l:("\r"===l&&"\n"===i&&n++,r.push(s),s="",t.push(r),r=[]):(r.push(s),s=""):a&&'"'===i?(s+='"',n++):a=!a}for(r.push(s),t.push(r);t.length&&t[t.length-1].every(e=>""===(e??"").trim());)t.pop();return t}(t),{headers:s,rows:n}=function(e){if(!e.length)return{rows:[],headers:[]};const t=e[0].map(e=>(e??"").trim()),r=e.slice(1).map(e=>{const r={};for(let s=0;s<t.length;s++)r[t[s]]=(e[s]??"").toString();return r});return{headers:t,rows:r}}(r);if(!s.length)return void g("CSVã®ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");const l=$l(s,["mobile number","mobile","phone","phone number","phone_number","tel","telephone","æºå¸¯","æºå¸¯ç•ªå·","é›»è©±","é›»è©±ç•ªå·"]),i=$l(s,["test date / time","test date/time","test date time","test date","measured_at","date","æ¸¬å®šæ—¥","æ¸¬å®šæ—¥æ™‚","inbodyæ¸¬å®šæ—¥","inbody æ¸¬å®šæ—¥"]),o=$l(s,["height","height_cm","èº«é•·"]),d=$l(s,["weight","ä½“é‡"]),u=$l(s,["pbf (percent body fat)","pbf","percent body fat","percent_body_fat","body fat percent","body_fat_percent","ä½“è„‚è‚ªç‡"]),m=[l?null:"Mobile Number(é›»è©±ç•ªå·)",i?null:"Test Date / Time(æ¸¬å®šæ—¥)",o?null:"Height(èº«é•·)",d?null:"Weight(ä½“é‡)",u?null:"PBF(ä½“è„‚è‚ªç‡)"].filter(Boolean);if(m.length)return void g(`CSVãƒ˜ãƒƒãƒ€ãƒ¼ã«å¿…é ˆã‚«ãƒ©ãƒ ãŒä¸è¶³ã—ã¦ã„ã¾ã™: ${m.join(", ")}`);if(n.length>Ml)return void g("è¡Œæ•°ãŒå¤šã™ãã¾ã™ï¼ˆä¸Šé™ 2000 è¡Œï¼‰ã€‚CSVã‚’åˆ†å‰²ã—ã¦ãã ã•ã„ã€‚");const h=[],p=[];n.forEach((e,t)=>{const r=t+1,s=(e[l]??"").toString().replace(/\D/g,"");const a=function(e){const t=(e??"").toString().trim();if(!t)return null;const r=t.match(/(\d{4})[\/\.-](\d{1,2})[\/\.-](\d{1,2})/);if(r)return`${r[1]}-${String(Number(r[2])).padStart(2,"0")}-${String(Number(r[3])).padStart(2,"0")}`;const s=new Date(t);if(!Number.isNaN(s.getTime()))return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;return null}(e[i]),n=Rl(e[o]),c=Rl(e[d]),x=Rl(e[u]);s?a?null==n||n<=0||n>250?p.push({rowIndex:r,message:"èº«é•·ãŒä¸æ­£ã§ã™ï¼ˆ0ã€œ250cmã®ç¯„å›²ã§ï¼‰",raw:e}):null==c||c<=0||c>300?p.push({rowIndex:r,message:"ä½“é‡ãŒä¸æ­£ã§ã™ï¼ˆ0ã€œ300kgã®ç¯„å›²ã§ï¼‰",raw:e}):null==x||x<0||x>80?p.push({rowIndex:r,message:"ä½“è„‚è‚ªç‡(PBF)ãŒä¸æ­£ã§ã™ï¼ˆ0ã€œ80%ã®ç¯„å›²ã§ï¼‰",raw:e}):h.push({rowIndex:r,phone_number:s,measured_at:a,height:n,weight:c,body_fat_percent:x,raw:e}):p.push({rowIndex:r,message:"æ¸¬å®šæ—¥(Test Date / Time)ãŒè§£é‡ˆã§ãã¾ã›ã‚“ï¼ˆä¾‹: 2025-12-21ï¼‰",raw:e}):p.push({rowIndex:r,message:"é›»è©±ç•ªå·ãŒç©º or ä¸æ­£ã§ã™ï¼ˆæ•°å­—ã®ã¿æŠ½å‡ºã§ãã¾ã›ã‚“ï¼‰",raw:e})}),c(h),x(p),g(`è§£æå®Œäº†ï¼šæœ‰åŠ¹ ${h.length} è¡Œ / ã‚¨ãƒ©ãƒ¼ ${p.length} è¡Œ`)}catch(r){console.error(r),g(`CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${String((null==r?void 0:r.message)??r)}`)}finally{l(!1)}};return T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[T.jsx(Xe,{className:"w-5 h-5 text-gray-600"}),T.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"InBody CSV ä¸€æ‹¬å–ã‚Šè¾¼ã¿"})]}),T.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[T.jsx("div",{className:"font-medium text-gray-800 mb-1",children:"å¿…é ˆã‚«ãƒ©ãƒ "}),T.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[T.jsx("li",{children:"Mobile Numberï¼ˆé›»è©±ç•ªå·ï¼‰â€»ã€Œ1. Mobile Numberã€ã§ã‚‚OK"}),T.jsx("li",{children:"Test Date / Timeï¼ˆâ€»æ™‚åˆ»è¾¼ã¿OK / ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯æ—¥ä»˜ã ã‘è¡¨ç¤ºï¼‰"}),T.jsx("li",{children:"Heightï¼ˆèº«é•·ï¼‰"}),T.jsx("li",{children:"Weightï¼ˆä½“é‡ï¼‰"}),T.jsx("li",{children:"PBFï¼ˆPercent Body Fat / ä½“è„‚è‚ªç‡ï¼‰"})]}),T.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"â€»ç•ªå·ä»˜ããƒ˜ãƒƒãƒ€ï¼ˆä¾‹: 1. Mobile Numberï¼‰ã‚‚è‡ªå‹•ã§å¸åã—ã¾ã™ã€‚"})]}),T.jsxs("label",{className:"block",children:[T.jsx("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-blue-400 transition-colors cursor-pointer bg-gray-50",children:T.jsxs("div",{className:"text-center",children:[T.jsx(Yt,{className:"w-7 h-7 mx-auto text-gray-500 mb-2"}),T.jsx("div",{className:"text-sm font-medium text-gray-800",children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ã‚‚OKï¼‰"}),T.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["ä¸Šé™ ",Ml," è¡Œ"]}),e&&T.jsxs("div",{className:"text-xs text-gray-700 mt-2",children:["é¸æŠä¸­: ",e]})]})}),T.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&y(r)}})]}),m&&T.jsxs("div",{className:"mt-4 flex items-start gap-2 text-sm",children:[m.startsWith("âœ…")?T.jsx(Te,{className:"w-5 h-5 text-green-600 mt-0.5"}):m.startsWith("âŒ")?T.jsx(fe,{className:"w-5 h-5 text-red-600 mt-0.5"}):T.jsx(fe,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),T.jsx("div",{className:"text-gray-700 whitespace-pre-wrap",children:m})]}),T.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[T.jsx("button",{onClick:async()=>{if(b){o(!0),g("");try{const{data:e,error:t}=await z.functions.invoke("import-inbody-csv",{body:{csv:s,source:"csv",note:null}});if(t)throw t;const r=(null==e?void 0:e.inserted_or_updated)??0,a=(null==e?void 0:e.rejected)??0;g(`âœ… å–ã‚Šè¾¼ã¿æˆåŠŸï¼š${r} è¡Œã‚’ upsertï¼ˆrejected: ${a}ï¼‰`)}catch(e){console.error(e),g(`âŒ å–ã‚Šè¾¼ã¿å¤±æ•—: ${String((null==e?void 0:e.message)??e)}`)}finally{o(!1)}}},disabled:!b,className:"px-4 py-2 rounded-lg text-white text-sm font-medium transition-colors "+(b?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 cursor-not-allowed"),children:i?T.jsxs("span",{className:"inline-flex items-center gap-2",children:[T.jsx(ct,{className:"w-4 h-4 animate-spin"}),"å–ã‚Šè¾¼ã¿ä¸­..."]}):"DBã¸ä¸€æ‹¬å–ã‚Šè¾¼ã¿ï¼ˆEdgeï¼‰"}),n&&T.jsxs("span",{className:"text-sm text-gray-600 inline-flex items-center gap-2",children:[T.jsx(ct,{className:"w-4 h-4 animate-spin"}),"è§£æä¸­..."]}),T.jsxs("div",{className:"text-sm text-gray-600",children:["æœ‰åŠ¹ ",T.jsx("span",{className:"font-semibold text-gray-900",children:h})," è¡Œ / ã‚¨ãƒ©ãƒ¼"," ",T.jsx("span",{className:"font-semibold text-gray-900",children:p})," è¡Œ"]})]})]}),u.length>0&&T.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[T.jsx(fe,{className:"w-5 h-5 text-red-600"}),T.jsx("h4",{className:"text-md font-semibold text-gray-900",children:"ã‚¨ãƒ©ãƒ¼è¡Œï¼ˆå–ã‚Šè¾¼ã¿å¯¾è±¡å¤–ï¼‰"})]}),T.jsx("div",{className:"overflow-x-auto",children:T.jsxs("table",{className:"min-w-full text-sm",children:[T.jsx("thead",{children:T.jsxs("tr",{className:"text-left text-gray-600",children:[T.jsx("th",{className:"py-2 pr-3",children:"è¡Œ"}),T.jsx("th",{className:"py-2 pr-3",children:"ç†ç”±"}),T.jsx("th",{className:"py-2 pr-3",children:"ãƒ‡ãƒ¼ã‚¿ï¼ˆæŠœç²‹ï¼‰"})]})}),T.jsx("tbody",{children:u.slice(0,50).map(e=>T.jsxs("tr",{className:"border-t",children:[T.jsx("td",{className:"py-2 pr-3 font-mono",children:e.rowIndex}),T.jsx("td",{className:"py-2 pr-3 text-red-700",children:e.message}),T.jsxs("td",{className:"py-2 pr-3 text-gray-600",children:[JSON.stringify(e.raw).slice(0,140),JSON.stringify(e.raw).length>140?"...":""]})]},`${e.rowIndex}-${e.message}`))})]})}),u.length>50&&T.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"â€»è¡¨ç¤ºã¯æœ€åˆã®50è¡Œã®ã¿"})]}),d.length>0&&T.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[T.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå…ˆé ­10è¡Œï¼‰"}),T.jsx("div",{className:"overflow-x-auto",children:T.jsxs("table",{className:"min-w-full text-sm",children:[T.jsx("thead",{children:T.jsxs("tr",{className:"text-left text-gray-600",children:[T.jsx("th",{className:"py-2 pr-3",children:"è¡Œ"}),T.jsx("th",{className:"py-2 pr-3",children:"é›»è©±"}),T.jsx("th",{className:"py-2 pr-3",children:"æ¸¬å®šæ—¥"}),T.jsx("th",{className:"py-2 pr-3",children:"èº«é•·"}),T.jsx("th",{className:"py-2 pr-3",children:"ä½“é‡"}),T.jsx("th",{className:"py-2 pr-3",children:"ä½“è„‚è‚ªç‡"})]})}),T.jsx("tbody",{children:d.slice(0,10).map(e=>T.jsxs("tr",{className:"border-t",children:[T.jsx("td",{className:"py-2 pr-3 font-mono",children:e.rowIndex}),T.jsx("td",{className:"py-2 pr-3 font-mono",children:e.phone_number}),T.jsx("td",{className:"py-2 pr-3 font-mono",children:e.measured_at}),T.jsx("td",{className:"py-2 pr-3",children:e.height}),T.jsx("td",{className:"py-2 pr-3",children:e.weight}),T.jsx("td",{className:"py-2 pr-3",children:e.body_fat_percent})]},e.rowIndex))})]})}),T.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"â€»å®Ÿéš›ã®ä¿å­˜ã¯ Edge å´ãŒæ—¥æ™‚ï¼ˆmeasured_at_tsï¼‰ã‚‚æ‰±ã„ã¾ã™"})]})]})}function Il({user:e,alerts:t,onNavigateToPrivacy:s,onNavigateToTerms:a,onNavigateToCommercial:n,onNavigateToHelp:l}){if(!e||!Kn(e.role))return T.jsx("div",{className:"min-h-screen flex items-center justify-center",children:T.jsxs("div",{className:"bg-white border rounded-xl p-6",children:[T.jsx("div",{className:"text-lg font-semibold",children:"æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"}),T.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"ã“ã®ãƒšãƒ¼ã‚¸ã¯ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚"})]})});const[i,o]=r.useState([]),[d,c]=r.useState("system"),[u,x]=r.useState("overview"),[m,g]=r.useState("invite"),[h,p]=r.useState(""),[b,y]=r.useState("overview"),[f,v]=r.useState([]),[j,w]=r.useState(!1),[N,k]=r.useState("single"),[_,S]=r.useState(),[C,E]=r.useState(!0),[D,M]=r.useState(!1),[R,$]=r.useState(!1),[A,I]=r.useState(!1),{isActive:P,shouldShowTutorial:L,startTutorial:q,completeTutorial:F,skipTutorial:O,currentStepIndex:W,setCurrentStepIndex:B}=ge(),{organizations:U,loading:H}=un(e.id);r.useEffect(()=>{L()&&!C&&q()},[L,q,C]),r.useEffect(()=>{const e=localStorage.getItem("admin_selected_organization");e&&U.some(t=>t.id===e)?S(e):U.length>0&&!_&&(S(U[0].id),localStorage.setItem("admin_selected_organization",U[0].id))},[U]);const V=U.find(e=>e.id===_),K=t.filter(e=>"high"===e.priority),J=t.filter(e=>"no_data"===e.type||"reminder"===e.type);r.useEffect(()=>{const e=localStorage.getItem("criticalAlertDismissed"),t=e?parseInt(e,10):0,r=Date.now(),s=18e5;t&&r-t<s?$(!0):t&&r-t>=s&&localStorage.removeItem("criticalAlertDismissed")},[]);r.useEffect(()=>{Y()},[]),r.useEffect(()=>{"system"===d&&"nutrition-dev"===u&&(async()=>{try{w(!0);const{data:e,error:t}=await z.from("inbody_records").select("user_id").not("user_id","is",null);if(t)throw t;const r=Array.from(new Set((e??[]).map(e=>e.user_id))).filter(Boolean),{data:s,error:a}=await z.from("app_users").select("id, nickname, email").in("id",r);if(a)return console.warn("fetchInbodyUsers: failed to fetch app_users info:",a),void v(r.map(e=>({user_id:e})));const n=(s??[]).map(e=>({user_id:e.id,name:e.nickname||e.email||e.id}))??[];v(n)}catch(e){console.error("fetchInbodyUsers error:",e)}finally{w(!1)}})()},[d,u]);const Y=async()=>{try{const{data:e,error:t}=await z.from("teams").select("*").order("name");if(t)throw t;o(e||[])}catch(e){console.error("Error fetching teams:",e)}finally{E(!1)}};return C?T.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T.jsxs("div",{className:"min-h-screen bg-gray-50",children:[T.jsx("header",{className:"bg-white shadow-sm border-b sticky top-0 z-40",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[T.jsxs("div",{className:"flex items-center justify-between py-3",children:[T.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"}),T.jsxs("div",{className:"flex items-center space-x-1",children:[K.length>0&&T.jsxs("button",{onClick:()=>M(!0),className:"p-2 text-gray-600 hover:text-red-600 transition-colors relative",title:"ã‚¢ãƒ©ãƒ¼ãƒˆ",children:[T.jsx(fe,{className:"w-5 h-5"}),T.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),T.jsx("button",{onClick:q,className:"p-2 text-gray-600 hover:text-purple-600 transition-colors",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",children:T.jsx(at,{className:"w-5 h-5"})})]})]}),!H&&U.length>1&&T.jsx("div",{className:"pb-3 border-t border-gray-100",children:T.jsxs("div",{className:"flex items-center gap-3 pt-3",children:[T.jsx(Ee,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),T.jsx("select",{value:_||"",onChange:e=>{return t=e.target.value,S(t),void localStorage.setItem("admin_selected_organization",t);var t},className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:U.map(e=>T.jsx("option",{value:e.id,children:e.name},e.id))})]})})]})}),T.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:T.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[K.length>0&&!R&&T.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:T.jsxs("div",{className:"flex items-center",children:[T.jsx(fe,{className:"w-6 h-6 text-red-600 mr-3 flex-shrink-0"}),T.jsxs("div",{className:"flex-1 min-w-0",children:[T.jsx("h3",{className:"font-semibold text-red-900",children:"é«˜ãƒªã‚¹ã‚¯ã‚¢ãƒ©ãƒ¼ãƒˆ"}),T.jsxs("p",{className:"text-sm text-red-700",children:[K.length,"ä»¶ã®æ³¨æ„ãŒå¿…è¦ã§ã™"]})]}),T.jsx("button",{onClick:()=>{$(!0),localStorage.setItem("criticalAlertDismissed",Date.now().toString())},className:"ml-3 p-1 text-red-400 hover:text-red-600 transition-colors flex-shrink-0",title:"30åˆ†é–“éè¡¨ç¤º",children:T.jsx(ar,{className:"w-5 h-5"})})]})}),T.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[T.jsxs("div",{className:"flex items-center mb-6",children:[T.jsx(ke,{className:"w-6 h-6 text-blue-600 mr-3"}),T.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦"})]}),T.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[T.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:t.length}),T.jsx("div",{className:"text-sm text-blue-700",children:"ç·ã‚¢ãƒ©ãƒ¼ãƒˆæ•°"})]}),T.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-red-600 mb-1",children:K.length}),T.jsx("div",{className:"text-sm text-red-700",children:"é«˜å„ªå…ˆåº¦"})]}),T.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-yellow-600 mb-1",children:J.length}),T.jsx("div",{className:"text-sm text-yellow-700",children:"ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥"})]}),T.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[T.jsx("div",{className:"text-2xl font-bold text-green-600 mb-1",children:i.length}),T.jsx("div",{className:"text-sm text-green-700",children:"ç™»éŒ²ãƒãƒ¼ãƒ æ•°"})]})]})]}),T.jsxs("div",{className:"bg-white rounded-xl shadow-sm mb-8",children:[T.jsx("div",{className:"border-b border-gray-200",children:T.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:[T.jsxs("button",{onClick:()=>c("system"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("system"===d?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"system-tab",children:[T.jsx(ke,{className:"w-4 h-4"}),T.jsx("span",{children:"ã‚·ã‚¹ãƒ†ãƒ "})]}),T.jsxs("button",{onClick:()=>c("users"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("users"===d?"border-green-500 text-green-600 bg-green-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"users-tab",children:[T.jsx(rr,{className:"w-4 h-4"}),T.jsx("span",{children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†"})]}),T.jsxs("button",{onClick:()=>c("organization"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("organization"===d?"border-orange-500 text-orange-600 bg-orange-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"organization-tab",children:[T.jsx(Ee,{className:"w-4 h-4"}),T.jsx("span",{children:"çµ„ç¹”ç®¡ç†"})]})]})}),("system"===d||"users"===d||"organization"===d)&&T.jsx("div",{className:"border-b border-gray-100 bg-gray-50",children:T.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:["system"===d&&T.jsxs(T.Fragment,{children:[T.jsxs("button",{onClick:()=>x("overview"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("overview"===u?"border-blue-500 text-blue-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(ke,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"æ¦‚è¦"})]}),T.jsxs("button",{onClick:()=>x("nutrition-dev"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("nutrition-dev"===u?"border-blue-500 text-blue-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(pt,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"æ „é¤ŠDev"})]})]}),"users"===d&&T.jsxs(T.Fragment,{children:[T.jsxs("button",{onClick:()=>g("invite"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("invite"===m?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(Xt,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"æ‹›å¾…"})]}),T.jsxs("button",{onClick:()=>g("manage"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("manage"===m?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(Zt,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"ç®¡ç†"})]}),T.jsxs("button",{onClick:()=>g("inbody"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("inbody"===m?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(Xe,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"InBody(CSV)"})]})]}),"organization"===d&&T.jsxs(T.Fragment,{children:[T.jsxs("button",{onClick:()=>y("overview"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("overview"===b?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(ft,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"æ¦‚è¦"})]}),T.jsxs("button",{onClick:()=>y("list"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("list"===b?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(Ee,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"çµ„ç¹”ä¸€è¦§"})]}),T.jsxs("button",{onClick:()=>y("members"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("members"===b?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(It,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"ãƒ¡ãƒ³ãƒãƒ¼"})]}),T.jsxs("button",{onClick:()=>y("settings"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("settings"===b?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(Pt,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"è¨­å®š"})]}),T.jsxs("button",{onClick:()=>y("subscription"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("subscription"===b?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(Ue,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³"})]}),T.jsxs("button",{onClick:()=>y("transfers"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("transfers"===b?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(Zt,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"é¸æ‰‹ç§»ç±"})]}),T.jsxs("button",{onClick:()=>y("team-access"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("team-access"===b?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[T.jsx(tr,{className:"w-3.5 h-3.5"}),T.jsx("span",{children:"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹"})]})]})]})}),T.jsx("div",{className:"p-6",children:"system"===d?T.jsx("div",{className:"space-y-6",children:"overview"===u?T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–"}),T.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:T.jsx("p",{className:"text-gray-600 text-center",children:"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ACWRãƒ‡ãƒ¼ã‚¿ã‚’ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚ ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ãŸå ´åˆã¯å³åº§ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚"})})]}):"nutrition-dev"===u?T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"æ „é¤Šã‚µãƒãƒ¼ãƒˆï¼ˆDevï¼‰"}),T.jsx("p",{className:"text-sm text-gray-600",children:"éå…¬é–‹ã®é–‹ç™ºç”¨ç”»é¢ã§ã™ï¼ˆä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ã›ãªã„æƒ³å®šï¼‰ã€‚"})]}),T.jsxs("div",{className:"space-y-4",children:[T.jsx(tl,{}),T.jsx(el,{})]}),T.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 space-y-3",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"ãƒ†ã‚¹ãƒˆå¯¾è±¡ user_id"}),T.jsx("p",{className:"text-xs text-gray-500",children:"æ¸¬å®šãƒ‡ãƒ¼ã‚¿ï¼ˆinbody_recordsï¼‰ãŒå…¥ã£ã¦ã„ã‚‹é¸æ‰‹ã® user_id ã‚’è²¼ã£ã¦ãã ã•ã„"})]}),f.length>0&&T.jsxs("select",{value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[T.jsx("option",{value:"",children:"ï¼ˆInBodyã‚ã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠï¼‰"}),f.map(e=>T.jsxs("option",{value:e.user_id,children:[e.name," â€” ",e.user_id.slice(0,8),"â€¦"]},e.user_id))]}),T.jsx("input",{value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"ä¾‹: f7f3aea1-764f-4013-b51d-c7bca2ed6d20"}),T.jsx("button",{onClick:async()=>{var e;try{if(!h)return void alert("user_id ã‚’å…¥ã‚Œã¦ãã ã•ã„");const{data:t}=await z.auth.getSession(),r=null==(e=t.session)?void 0:e.access_token;if(!r)return void alert("ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå–å¾—ã§ãã¾ã›ã‚“ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ï¼Ÿï¼‰");const s=await fetch("https://cymnqmbdwaveccoooics.supabase.co/functions/v1/calculate-metabolism",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({user_id:h,activity_level:"medium"})}),a=await s.json();if(console.log("ğŸ§ª calculate-metabolism result:",a),!s.ok)return void alert(`å¤±æ•—: ${s.status}\n`+JSON.stringify(a,null,2));alert(JSON.stringify(a,null,2))}catch(t){console.error(t),alert("ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼ˆconsoleã‚’ç¢ºèªï¼‰")}},disabled:!h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"ğŸ§ª ä»£è¬è¨ˆç®— Edge Function ãƒ†ã‚¹ãƒˆ"}),T.jsx("p",{className:"text-xs text-gray-500",children:"â€» console / alert ã«çµæœã‚’è¡¨ç¤ºã—ã¾ã™"})]})]}):null}):"users"===d?T.jsx("div",{children:"invite"===m?T.jsxs("div",{children:[T.jsx("div",{className:"border-b border-gray-200 mb-6",children:T.jsxs("nav",{className:"flex space-x-8",children:[T.jsx("button",{onClick:()=>k("single"),className:"py-3 px-1 border-b-2 font-medium text-sm "+("single"===N?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"å€‹åˆ¥æ‹›å¾…"}),T.jsx("button",{onClick:()=>k("bulk"),className:"py-3 px-1 border-b-2 font-medium text-sm "+("bulk"===N?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"ä¸€æ‹¬æ‹›å¾… (CSV)"})]})}),"single"===N?T.jsx("div",{"data-tutorial":"single-invite",children:T.jsx(Jn,{teams:i,onUserInvited:()=>{}})}):T.jsx("div",{"data-tutorial":"bulk-invite",children:T.jsx(Yn,{teams:i,onUsersInvited:()=>{}})})]}):"manage"===m?T.jsx("div",{"data-tutorial":"user-list",children:T.jsx(Qn,{teams:i})}):"inbody"===m?T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"InBody ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿"}),T.jsx("p",{className:"text-sm text-gray-600",children:"CSVã‹ã‚‰ inbody_records ã« upsert ã—ã¾ã™ï¼ˆphone_number + measured_at ã§é‡è¤‡æ›´æ–°ï¼‰ã€‚"})]}),T.jsx(Al,{})]}):null}):"organization"===d?T.jsx("div",{children:"overview"===b?_&&V?T.jsx(dl,{organizationId:_,organizationName:V.name}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),T.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]}):"list"===b?T.jsx(rl,{userId:e.id}):"members"===b?T.jsx("div",{children:_&&V?T.jsx(Sl,{organizationId:_,organizationName:V.name}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç®¡ç†ã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),T.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"settings"===b?T.jsx("div",{children:_?T.jsx(pl,{organizationId:_}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"è¨­å®šã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),T.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"subscription"===b?T.jsx("div",{children:_?T.jsx(ml,{organizationId:_,organizationName:"ãƒ‡ãƒ¢çµ„ç¹”"}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),T.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"transfers"===b?T.jsx("div",{children:_?T.jsx(kl,{userId:e.id,organizationId:_,isAdmin:Kn(e.role)}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"é¸æ‰‹ç§»ç±ç®¡ç†ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),T.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"team-access"===b?T.jsx("div",{children:_?T.jsx(wl,{userId:e.id,organizationId:_,isAdmin:Kn(e.role)}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),T.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):null}):null})]})]})}),T.jsx(Lr,{steps:ss("global_admin"),isActive:P,onComplete:F,onSkip:O,currentStepIndex:W,onStepChange:B})]})}function zl(e,t={}){const s=t.enabled??!0,a=t.pollMs??0,n=t.pauseWhenHidden??!0,l=r.useRef(!0);r.useEffect(()=>(l.current=!0,()=>{l.current=!1}),[e]);const[i,o]=r.useState([]),[d,c]=r.useState([]),[u,x]=r.useState(!0),[m,g]=r.useState(null),{state:h,registerPollJob:p}=ce(),b=r.useMemo(()=>{var e,t;return(null==(t=null==(e=globalThis.crypto)?void 0:e.randomUUID)?void 0:t.call(e))??Math.random().toString(36).slice(2)},[]),y=r.useRef(null),f=r.useRef(null),v=r.useRef(!1),j=r.useRef(!1),w=r.useCallback(()=>{var e;const t=y.current;if(t){try{null==(e=t.unsubscribe)||e.call(t)}catch(r){}try{z.removeChannel(t)}catch(r){}y.current=null}},[]),N=r.useCallback(()=>{f.current&&(f.current(),f.current=null)},[]),k=r.useCallback(async()=>{const{data:e,error:t}=await z.from("badges").select("*").order("sort_order");if(t)throw t;l.current&&o(e??[])},[]),_=r.useCallback(async()=>{if(e&&s&&!j.current){j.current=!0;try{const{data:t,error:r}=await z.from("user_badges").select("*, badge:badges(*)").eq("user_id",e).order("earned_at",{ascending:!1});if(r)throw r;if(!l.current)return;c(t??[]),g(null)}catch(t){if(!l.current)return;g((null==t?void 0:t.message)??"ãƒãƒƒã‚¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{j.current=!1}}},[e,s]),S=r.useCallback(()=>(d??[]).filter(e=>{if("boolean"==typeof(null==e?void 0:e.is_new))return!0===e.is_new;const t=null==e?void 0:e.viewed_at,r=(null==e?void 0:e.is_viewed)??(null==e?void 0:e.viewed)??!1;return!t&&!r}),[d]),C=r.useCallback(()=>{const e=(d??[]).length,t=(i??[]).length;return{earned:e,total:t,percentage:t>0?Math.round(e/t*100):0}},[d,i]),E=r.useCallback(async e=>{if(!e)return;if(!(await z.from("user_badges").update({is_new:!1}).eq("id",e)).error)return c(t=>(t??[]).map(t=>(null==t?void 0:t.id)===e?{...t,is_new:!1}:t)),void(await _());if(!(await z.from("user_badges").update({viewed_at:(new Date).toISOString()}).eq("id",e)).error)return void(await _());if(!(await z.from("user_badges").update({is_viewed:!0}).eq("id",e)).error)return void(await _());const t=await z.from("user_badges").update({viewed:!0}).eq("id",e);if(t.error)throw console.warn("[useBadges] markBadgeAsViewed failed:",t.error),t.error;await _()},[_]);return r.useEffect(()=>{let t=!1;return(async()=>{if(w(),N(),e&&s)try{l.current&&x(!0),v.current||(await k(),v.current=!0),await _()}catch(r){l.current&&g((null==r?void 0:r.message)??"ãƒãƒƒã‚¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{!t&&l.current&&x(!1)}else l.current&&x(!1)})(),()=>{t=!0,w(),N()}},[e,s,k,_,w,N]),r.useEffect(()=>{w()},[e,s,h.canRealtime,_,w,b]),r.useEffect(()=>{N();if(!(!!e&&s&&a>0&&!0))return;const t=p({key:`badges:${e}:${b}`,intervalMs:a,run:async()=>{await _()},enabled:!0,requireVisible:n,requireOnline:!0,immediate:!1});return f.current=t,()=>N()},[e,s,a,n,h.canRealtime,p,_,N,b]),{allBadges:i,userBadges:d,loading:u,error:m,getNewBadges:S,getBadgeProgress:C,markBadgeAsViewed:E,refresh:async()=>{await Promise.all([k(),_()])}}}const Pl=(null==or?void 0:or.default)??or;function Ll({badge:e,onClose:t}){r.useEffect(()=>{"function"==typeof Pl&&Pl({particleCount:100,spread:70,origin:{y:.6}})},[null==e?void 0:e.id]);const s=r.useCallback(()=>{t()},[t]);return r.useEffect(()=>{const e=e=>{"Escape"===e.key&&s()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s]),T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:s,role:"dialog","aria-modal":"true",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl relative",onClick:e=>e.stopPropagation(),children:[T.jsx("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"é–‰ã˜ã‚‹",children:T.jsx(ar,{className:"w-6 h-6"})}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"w-20 h-20 bg-yellow-100 dark:bg-yellow-900/20 rounded-full flex items-center justify-center mx-auto mb-6",children:T.jsx(we,{className:"w-10 h-10 text-yellow-600 dark:text-yellow-400"})}),T.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"æ–°ã—ã„ãƒãƒƒã‚¸ç²å¾—ï¼"}),T.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[T.jsx(Ft,{className:"w-5 h-5 text-yellow-500"}),T.jsx("span",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:e.name}),T.jsx(Ft,{className:"w-5 h-5 text-yellow-500"})]}),T.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:e.description}),T.jsx("button",{onClick:s,className:"bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors",children:"ã‚„ã£ãŸï¼"})]})]})})}function ql({userId:e}){const{userBadges:t,markBadgeAsViewed:s}=zl(e),[a,n]=r.useState(null),l=r.useRef(new Set),i=r.useMemo(()=>{const e=(t??[]).filter(e=>e.is_new),r={"ãƒ–ãƒ­ãƒ³ã‚ºåˆ°é”":10,"ã‚·ãƒ«ãƒãƒ¼åˆ°é”":20,"ã‚´ãƒ¼ãƒ«ãƒ‰åˆ°é”":30,"ãƒ—ãƒ©ãƒãƒŠåˆ°é”":40,"ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰åˆ°é”":50,"ãƒã‚¹ã‚¿ãƒ¼åˆ°é”":60};return[...e].sort((e,t)=>{var s,a;const n=new Date(e.earned_at).getTime(),l=new Date(t.earned_at).getTime();if(n!==l)return n-l;const i=(null==(s=e.badge)?void 0:s.name)??"",o=(null==(a=t.badge)?void 0:a.name)??"",d=r[i]??999,c=r[o]??999;return d!==c?d-c:i.localeCompare(o,"ja")})},[t]);r.useEffect(()=>{if(a)return;const e=i.find(e=>!l.current.has(e.id));e&&(l.current.add(e.id),n(e.id))},[i,a]);const o=(t??[]).find(e=>e.id===a)||null;return(null==o?void 0:o.badge)?T.jsx(Ll,{badge:o.badge,onClose:async()=>{a&&await s(a),n(null)}}):null}function Fl({onDone:e}){const[t,r]=x.useState(!1),[s,a]=x.useState(null),n=new URL(window.location.href),l=function(e){return e?e.startsWith("http://")||e.startsWith("https://")?"/":e.startsWith("/")?e:"/":"/"}(n.searchParams.get("next")),i=n.searchParams.get("verify"),o=i?function(e){try{return decodeURIComponent(e)}catch{return e}}(i):null,d=n.searchParams.get("code"),c=window.location.hash,u=c?new URLSearchParams(c.replace("#","")):null,m=null==u?void 0:u.get("type"),g=null==u?void 0:u.get("access_token"),h=null==u?void 0:u.get("refresh_token"),p=x.useMemo(()=>o?"ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¾ã§èªè¨¼ãƒªãƒ³ã‚¯ã‚’é–‹ã‹ãªã„ãŸã‚ã€ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯å…ˆèª­ã¿å¯¾ç­–ã«ãªã‚Šã¾ã™ã€‚":d?"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã ã‘èªè¨¼ã‚’å®Œäº†ã—ã¾ã™ã€‚":"recovery"===m?"ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºå®šã—ã¾ã™ã€‚":"ãƒªãƒ³ã‚¯ãŒå¤±åŠ¹ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",[o,d,m]);return T.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-6",children:T.jsxs("div",{className:"bg-white rounded-xl shadow p-6 max-w-md w-full space-y-4",children:[T.jsx("h1",{className:"text-lg font-bold",children:"ãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Œäº†ã—ã¾ã™"}),T.jsx("p",{className:"text-sm text-gray-600",children:p}),s&&T.jsx("p",{className:"text-sm text-red-600",children:s}),T.jsx("button",{onClick:async()=>{a(null),r(!0);try{if(o)return void(window.location.href=o);if(d){const{error:e}=await z.auth.exchangeCodeForSession(d);if(e)throw e;return window.history.replaceState({},document.title,n.pathname),void(window.location.href=l)}if("recovery"===m&&g&&h){const{error:e}=await z.auth.setSession({access_token:g,refresh_token:h});if(e)throw e;return window.history.replaceState({},document.title,n.pathname+n.search),void(window.location.href=l)}throw new Error("èªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆãƒªãƒ³ã‚¯ãŒä¸æ­£ã€ã¾ãŸã¯å…ˆèª­ã¿ã§å¤±åŠ¹ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰")}catch(e){console.error("[AuthCallback] failed:",e),a((null==e?void 0:e.message)??"èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{r(!1)}},disabled:t,className:"w-full bg-blue-600 text-white rounded-lg py-2 disabled:opacity-50",children:t?"å‡¦ç†ä¸­â€¦":"èªè¨¼ã‚’ç¢ºå®šã™ã‚‹"}),T.jsx("button",{type:"button",onClick:()=>window.location.href="/invite-expired",className:"w-full text-sm text-gray-600 underline",children:"æ‹›å¾…ãƒªãƒ³ã‚¯åˆ‡ã‚Œï¼ˆå†é€ï¼‰ã¸"}),T.jsx("button",{type:"button",onClick:()=>{window.history.replaceState({},"","/"),e()},className:"w-full text-sm text-gray-500 underline",children:"ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹"})]})})}function Ol(e){return e.trim().toLowerCase()}function Wl(){const[e,t]=r.useState(""),[s,a]=r.useState("idle"),[n,l]=r.useState(""),i=r.useMemo(()=>{const t=Ol(e);return t.includes("@")&&t.includes(".")&&"sending"!==s},[e,s]);return T.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:T.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[T.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:T.jsxs("div",{className:"flex items-start space-x-3",children:[T.jsx("div",{className:"mt-1",children:T.jsx(fe,{className:"w-6 h-6 text-amber-500"})}),T.jsxs("div",{children:[T.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"æ‹›å¾…ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸ"}),T.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šï¼ˆ= æ–°ã—ã„ãƒ­ã‚°ã‚¤ãƒ³æ‰‹æ®µï¼‰ã‚’ç™ºè¡Œã§ãã¾ã™ã€‚"})]})]})}),T.jsxs("div",{className:"p-6 space-y-4",children:[T.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 text-sm text-amber-900 dark:text-amber-200",children:[T.jsx("p",{className:"font-medium mb-1",children:"ã“ã†ã„ã†æ™‚ã®æ•‘æ¸ˆãƒ«ãƒ¼ãƒˆã§ã™"}),T.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[T.jsx("li",{children:"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ãŒåˆ‡ã‚Œã¦ã—ã¾ã£ãŸ"}),T.jsx("li",{children:"ä¼šç¤¾ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã§ãƒªãƒ³ã‚¯ãŒå…ˆèª­ã¿ã•ã‚Œã¦ç„¡åŠ¹ã«ãªã£ãŸ"}),T.jsx("li",{children:"æ™‚é–“ãŒçµŒã£ã¦ã—ã¾ã£ãŸ"})]})]}),T.jsxs("label",{className:"block",children:[T.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),T.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[T.jsxs("div",{className:"relative flex-1",children:[T.jsx(gt,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),T.jsx("input",{value:e,onChange:e=>t(e.target.value),placeholder:"ä¾‹ï¼‰tanaka@example.com",className:"w-full pl-10 pr-3 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900\n                             text-gray-900 dark:text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",type:"email",autoComplete:"email"})]}),T.jsx("button",{onClick:async()=>{const t=Ol(e);if(t){a("sending"),l("");try{const{data:e,error:r}=await z.functions.invoke("request-password-reset",{body:{email:t,redirectUrl:`${window.location.origin}/reset-password`}});if(r)return console.error("[InviteExpired] request-password-reset error:",r),a("error"),void l("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");console.log("[InviteExpired] request-password-reset result:",e),a("success"),l("å†è¨­å®šãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚å—ä¿¡ç®±ã‚’ã”ç¢ºèªãã ã•ã„ã€‚è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚")}catch(r){console.error("[InviteExpired] exception:",r),a("error"),l((null==r?void 0:r.message)||"é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}}},disabled:!i,className:"px-4 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium\n                           disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",type:"button",children:"sending"===s?T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),T.jsx("span",{children:"é€ä¿¡ä¸­"})]}):T.jsxs(T.Fragment,{children:[T.jsx(_t,{className:"w-4 h-4"}),T.jsx("span",{children:"å†é€"})]})})]})]}),n&&T.jsx("div",{className:"rounded-lg p-3 text-sm border "+("success"===s?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200":"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200"),children:T.jsxs("div",{className:"flex items-start space-x-2",children:["success"===s?T.jsx(Re,{className:"w-4 h-4 mt-0.5"}):T.jsx(fe,{className:"w-4 h-4 mt-0.5"}),T.jsx("p",{children:n})]})}),T.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[T.jsx("p",{children:"â€¢ ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆã¯ã€Œè¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã€ã€Œãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚"}),T.jsx("p",{children:"â€¢ ãã‚Œã§ã‚‚å±Šã‹ãªã„å ´åˆã€æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"})]}),T.jsx("div",{className:"pt-2",children:T.jsxs("button",{type:"button",onClick:()=>{window.history.replaceState({},"","/"),window.location.reload()},className:"text-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white flex items-center space-x-2",children:[T.jsx(ve,{className:"w-4 h-4"}),T.jsx("span",{children:"ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹"})]})})]})]})})}function Bl({count:e,hasHighPriority:t=!1,onClick:r,className:s=""}){return 0===e?T.jsx("button",{onClick:r,className:`\n          relative p-2 text-gray-400 dark:text-gray-500 \n          hover:text-gray-600 dark:hover:text-gray-300 \n          transition-colors ${s}\n        `,children:T.jsx(Se,{className:"w-6 h-6"})}):T.jsxs("button",{onClick:r,className:`\n        relative p-2 transition-colors ${t?"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300":"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300"} ${s}\n      `,children:[t?T.jsx(fe,{className:"w-6 h-6 animate-pulse"}):T.jsx(Se,{className:"w-6 h-6"}),T.jsx("span",{className:`\n        absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white \n        transform translate-x-1/2 -translate-y-1/2 rounded-full min-w-[20px] h-5 ${t?"bg-red-600 dark:bg-red-500 animate-pulse":"bg-blue-600 dark:bg-blue-500"}\n      `,children:e>99?"99+":e})]})}function Ul({effectiveRole:e,userProfile:t,alertsLoading:r,unreadCount:s,hasHighPriorityAlerts:a,onOpenAlertPanel:n,onLogout:l,onHome:i,onNavigateToPrivacy:o,onNavigateToTerms:d,onNavigateToCommercial:c,onNavigateToHelp:u}){const[m,g]=x.useState(!1);if("athlete"===e)return null;const h=()=>g(!1);return T.jsxs(T.Fragment,{children:[T.jsx("nav",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 relative z-40 transition-colors",children:T.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:T.jsxs("div",{className:"flex justify-between items-center h-16",children:[T.jsx("div",{className:"flex items-center",children:T.jsxs("button",{type:"button",onClick:()=>{i(),h()},className:"flex items-baseline space-x-2 transition-colors active:opacity-70 cursor-pointer",style:{WebkitTapHighlightColor:"transparent"},children:[T.jsx("span",{className:"text-xl font-bold tracking-tight text-gray-900 dark:text-white",style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"-0.02em"},children:"Bekuta"}),T.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 hidden sm:inline",style:{letterSpacing:"0.05em"},children:"by ARCA"})]})}),T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300 hidden md:block transition-colors",children:[t.name,"ã•ã‚“"]}),!r&&T.jsx(Bl,{count:s,hasHighPriority:a,onClick:n,className:"touch-target"}),T.jsxs("button",{onClick:l,className:"hidden md:flex bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600\n                  text-gray-700 dark:text-gray-200 px-3 py-2 rounded-lg\n                  border border-gray-300 dark:border-gray-600\n                  transition-colors items-center space-x-2 text-sm",type:"button",children:[T.jsx(mt,{className:"w-4 h-4"}),T.jsx("span",{children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]}),T.jsx("button",{onClick:()=>g(e=>!e),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",type:"button","aria-label":"ãƒ¡ãƒ‹ãƒ¥ãƒ¼",children:m?T.jsx(ar,{className:"w-6 h-6"}):T.jsx(ht,{className:"w-6 h-6"})})]})]})})}),m&&T.jsx("div",{className:"md:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg transition-colors relative z-40",children:T.jsxs("div",{className:"px-4 py-3 space-y-2",children:[T.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-gray-200 dark:border-gray-700",children:[T.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:T.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold text-sm",children:(t.name||"U").charAt(0)})}),T.jsxs("div",{className:"min-w-0",children:[T.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:[t.name,"ã•ã‚“"]}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t.email})]})]}),u&&T.jsxs("button",{onClick:()=>{h(),u()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[T.jsx(at,{className:"w-5 h-5"}),T.jsx("span",{children:"ãƒ˜ãƒ«ãƒ—ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«"})]}),o&&T.jsxs("button",{onClick:()=>{h(),o()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[T.jsx(zt,{className:"w-5 h-5"}),T.jsx("span",{children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼"})]}),d&&T.jsxs("button",{onClick:()=>{h(),d()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[T.jsx(Xe,{className:"w-5 h-5"}),T.jsx("span",{children:"åˆ©ç”¨è¦ç´„"})]}),c&&T.jsxs("button",{onClick:()=>{h(),c()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[T.jsx(Ee,{className:"w-5 h-5"}),T.jsx("span",{children:"ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜"})]}),T.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),T.jsxs("button",{onClick:e=>{h(),l(e)},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[T.jsx(mt,{className:"w-5 h-5"}),T.jsx("span",{children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]})]})})]})}function Hl({subtitle:e}){return T.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950",children:T.jsxs("div",{className:"text-center px-6",children:[T.jsx("div",{className:"text-4xl font-extrabold tracking-tight text-gray-900 dark:text-white",children:"Bekuta"}),T.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:e??"èª­ã¿è¾¼ã¿ä¸­â€¦"}),T.jsx("div",{className:"mt-6 flex justify-center",children:T.jsx("div",{className:"h-6 w-6 rounded-full border-2 border-gray-300 dark:border-gray-700 border-t-transparent animate-spin"})})]})})}function Vl({loading:e,ready:t,onRetry:s,children:a,timeoutMs:n=12e3}){const[l,i]=r.useState(!1);return r.useEffect(()=>{if(!e)return void i(!1);const t=setTimeout(()=>i(!0),n);return()=>clearTimeout(t)},[e,n]),t?T.jsx(T.Fragment,{children:a}):l?T.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950",children:T.jsxs("div",{className:"max-w-md w-full p-6 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900",children:[T.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Bekuta"}),T.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:"æ¥ç¶šãŒé•·å¼•ã„ã¦ã„ã¾ã™ã€‚é€šä¿¡çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã€å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"}),T.jsxs("div",{className:"mt-5 flex gap-2",children:[T.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg bg-gray-900 text-white dark:bg-white dark:text-gray-900 text-sm font-semibold",onClick:s,children:"å†è©¦è¡Œ"}),T.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 text-sm",onClick:async()=>{await z.auth.signOut(),window.location.href="/"},children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]})]})}):T.jsx(Hl,{subtitle:"ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚’æº–å‚™ã—ã¦ã„ã¾ã™â€¦"})}function Kl({title:e="ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­",message:t="ç¾åœ¨ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šåŒ–å¯¾å¿œã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ã”ä¸ä¾¿ã‚’ãŠã‹ã‘ã—ã¾ã™ãŒã€ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",etaText:s="",showRetry:a=!0}){const n=r.useMemo(()=>function(){const e=new Date,t=e=>String(e).padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}`}(),[]);return T.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50 text-slate-900",children:[T.jsxs("div",{className:"pointer-events-none fixed inset-0 overflow-hidden",children:[T.jsx("div",{className:"absolute -top-24 -right-24 h-80 w-80 rounded-full bg-blue-200/35 blur-3xl"}),T.jsx("div",{className:"absolute -bottom-28 -left-28 h-96 w-96 rounded-full bg-emerald-200/30 blur-3xl"}),T.jsx("div",{className:"absolute top-1/3 left-1/2 h-72 w-72 -translate-x-1/2 rounded-full bg-violet-200/20 blur-3xl"})]}),T.jsxs("div",{className:"relative mx-auto max-w-2xl px-5 py-10",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center",children:T.jsx(Lt,{className:"h-5 w-5 text-slate-700"})}),T.jsxs("div",{children:[T.jsxs("div",{className:"text-xl font-extrabold tracking-tight",children:["Bekuta",T.jsx("span",{className:"ml-2 text-xs font-semibold text-slate-500 align-middle",children:"maintenance"})]}),T.jsx("div",{className:"text-sm text-slate-500",children:"strength for the future"})]})]}),T.jsxs("div",{className:"text-xs text-slate-400",children:["JST ",n]})]}),T.jsxs("div",{className:"mt-8 rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden",children:[T.jsxs("div",{className:"border-b border-slate-100 px-6 py-5 flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700",children:[T.jsx(At,{className:"h-4 w-4 text-rose-500"}),e]}),T.jsx("div",{className:"text-xs text-slate-400",children:"System Status"})]}),T.jsxs("div",{className:"px-6 py-6",children:[T.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-5",children:[T.jsx("p",{className:"text-slate-700 leading-relaxed",children:t}),s?T.jsxs("div",{className:"mt-3 text-sm text-slate-600",children:[T.jsx("span",{className:"font-semibold",children:"ç›®å®‰ï¼š"}),s]}):null,T.jsx("div",{className:"mt-4 text-xs text-slate-500 leading-relaxed",children:"â€» ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®åœæ­¢ãƒ»DBè² è·ã®è»½æ¸›ã®ãŸã‚ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”»é¢ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚"})]}),T.jsxs("div",{className:"mt-5 flex flex-col sm:flex-row gap-3",children:[a&&T.jsxs("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center justify-center gap-2 rounded-2xl bg-slate-900 text-white px-5 py-3 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition",children:[T.jsx(_t,{className:"h-4 w-4"}),"å†èª­ã¿è¾¼ã¿"]}),T.jsxs("a",{href:"https://bekuta.netlify.app/",className:"inline-flex items-center justify-center gap-2 rounded-2xl bg-white ring-1 ring-slate-200 px-5 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition",children:[T.jsx(Je,{className:"h-4 w-4"}),"ãƒˆãƒƒãƒ—ã¸"]})]}),T.jsx("div",{className:"mt-6 text-center text-xs text-slate-400",children:"â€œSmall steps, big futures.â€ â€” Bekuta"})]})]}),T.jsx("div",{className:"mt-8 text-center text-xs text-slate-400",children:"ãŠæ€¥ãã®å ´åˆã¯ã€ã‚¹ã‚¿ãƒƒãƒ•ã¸ã”é€£çµ¡ãã ã•ã„ã€‚"})]})]})}function Jl({onAccept:e,onDecline:t}){const[s,a]=r.useState(!1),[n,l]=r.useState(!1),[i,o]=r.useState(null),[d,c]=r.useState(!1),u=s&&n&&null!==i;return T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:T.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[T.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx(zt,{className:"w-8 h-8"}),T.jsxs("div",{children:[T.jsx("h2",{className:"text-2xl font-bold",children:"Bekuta ã¸ã‚ˆã†ã“ã"}),T.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"ã”åˆ©ç”¨å‰ã«å¿…ãšãŠèª­ã¿ãã ã•ã„"})]})]})}),T.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:T.jsxs("div",{className:"space-y-6",children:[T.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-4 rounded",children:T.jsxs("div",{className:"flex items-start",children:[T.jsx(ye,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 mr-3 mt-0.5 flex-shrink-0"}),T.jsxs("div",{className:"text-sm space-y-2",children:[T.jsx("p",{className:"font-bold text-orange-900 dark:text-orange-200",children:"æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã®é‡è¦ãªãŠçŸ¥ã‚‰ã›"}),T.jsxs("ul",{className:"space-y-1 text-orange-800 dark:text-orange-300",children:[T.jsx("li",{children:"â€¢ å½“ã‚µãƒ¼ãƒ“ã‚¹ã¯åŒ»ç™‚æ©Ÿå™¨ã§ã¯ãªãã€è¨ºæ–­ãƒ»æ²»ç™‚ã‚’ç›®çš„ã¨ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“"}),T.jsx("li",{children:"â€¢ æ€ªæˆ‘ã®äºˆé˜²ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“"}),T.jsx("li",{children:"â€¢ ACWRã¯å‚è€ƒå€¤ã§ã‚ã‚Šã€æœ€çµ‚åˆ¤æ–­ã¯æœ¬äººãƒ»æŒ‡å°è€…ãƒ»åŒ»ç™‚å°‚é–€å®¶ãŒè¡Œã„ã¾ã™"}),T.jsx("li",{children:"â€¢ ã‚¹ãƒãƒ¼ãƒ„æ´»å‹•ã«ã¯å›ºæœ‰ã®ãƒªã‚¹ã‚¯ãŒä¼´ã„ã¾ã™"})]})]})]})}),T.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-5",children:[T.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white mb-3 flex items-center",children:[T.jsx(Xe,{className:"w-5 h-5 mr-2 text-purple-600 dark:text-purple-400"}),"å¹´é½¢ç¢ºèª"]}),T.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-4",children:"ã‚ãªãŸã¯18æ­³ä»¥ä¸Šã§ã™ã‹ï¼Ÿ"}),T.jsxs("div",{className:"flex space-x-4",children:[T.jsxs("button",{onClick:()=>o(!1),className:"flex-1 py-3 px-4 rounded-lg border-2 transition-all "+(!1===i?"border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"border-gray-300 dark:border-gray-600 hover:border-green-400"),children:[T.jsx(Re,{className:"w-5 h-5 mx-auto mb-1 "+(!1===i?"text-green-500":"text-gray-400")}),T.jsx("span",{className:"text-sm font-medium",children:"18æ­³ä»¥ä¸Šã§ã™"})]}),T.jsxs("button",{onClick:()=>o(!0),className:"flex-1 py-3 px-4 rounded-lg border-2 transition-all "+(!0===i?"border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":"border-gray-300 dark:border-gray-600 hover:border-yellow-400"),children:[T.jsx(ye,{className:"w-5 h-5 mx-auto mb-1 "+(!0===i?"text-yellow-500":"text-gray-400")}),T.jsx("span",{className:"text-sm font-medium",children:"18æ­³æœªæº€ã§ã™"})]})]}),null!==i&&i&&T.jsxs("div",{className:"mt-4 bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 font-medium mb-2",children:"ä¿è­·è€…ã®åŒæ„ãŒå¿…è¦ã§ã™"}),T.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mb-3",children:"18æ­³æœªæº€ã®æ–¹ã¯ã€ä¿è­·è€…ã®æ–¹ã¨ä¸€ç·’ã«ã“ã®ç”»é¢ã‚’ã”ç¢ºèªã„ãŸã ãã€ ä¿è­·è€…ã®æ–¹ã®åŒæ„ã‚’å¾—ãŸä¸Šã§ã”åˆ©ç”¨ãã ã•ã„ã€‚"}),T.jsx("div",{className:"bg-white dark:bg-yellow-800/20 rounded-lg p-3 text-xs text-yellow-900 dark:text-yellow-100",children:"ä¿è­·è€…ã®æ–¹ãŒã„ãªã„å ´åˆã¯ã€ã€ŒåŒæ„ã—ãªã„ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ å¾Œã»ã©ä¿è­·è€…ã®æ–¹ã¨ä¸€ç·’ã«å†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚"})]})]}),T.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800",children:T.jsxs("label",{className:"flex items-start cursor-pointer group",children:[T.jsxs("div",{className:"relative flex-shrink-0",children:[T.jsx("input",{type:"checkbox",checked:s,onChange:e=>a(e.target.checked),className:"sr-only peer"}),T.jsx("div",{className:`\n                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center\n                    ${s?"bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500"}\n                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800\n                  `,children:s&&T.jsx(Re,{className:"w-4 h-4 text-white",strokeWidth:3})})]}),T.jsxs("div",{className:"ml-4 flex-1",children:[T.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¾ã™"}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:T.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",onClick:e=>e.stopPropagation(),children:"åˆ©ç”¨è¦ç´„ã‚’ç¢ºèªã™ã‚‹ â†’"})})]})]})}),T.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800",children:T.jsxs("label",{className:"flex items-start cursor-pointer group",children:[T.jsxs("div",{className:"relative flex-shrink-0",children:[T.jsx("input",{type:"checkbox",checked:n,onChange:e=>l(e.target.checked),className:"sr-only peer"}),T.jsx("div",{className:`\n                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center\n                    ${n?"bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500"}\n                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800\n                  `,children:n&&T.jsx(Re,{className:"w-4 h-4 text-white",strokeWidth:3})})]}),T.jsxs("div",{className:"ml-4 flex-1",children:[T.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã—ã¾ã™"}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:T.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",onClick:e=>e.stopPropagation(),children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèªã™ã‚‹ â†’"})})]})]})}),T.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[T.jsx("h4",{className:"text-sm font-bold text-gray-900 dark:text-white mb-2",children:"åé›†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦"}),T.jsxs("ul",{className:"text-xs text-gray-700 dark:text-gray-300 space-y-1",children:[T.jsx("li",{children:"â€¢ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ï¼ˆRPEã€æ™‚é–“ã€è² è·ï¼‰"}),T.jsx("li",{children:"â€¢ ä½“é‡è¨˜éŒ²ï¼ˆãƒ¡ãƒ¢ã¯æœ¬äººã®ã¿é–²è¦§å¯èƒ½ï¼‰"}),T.jsx("li",{children:"â€¢ æ‰€å±ãƒãƒ¼ãƒ ã®ã‚¹ã‚¿ãƒƒãƒ•ã¯ã‚ãªãŸã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ã§ãã¾ã™"}),T.jsx("li",{children:"â€¢ ãƒ‡ãƒ¼ã‚¿ã¯æš—å·åŒ–ã—ã¦å®‰å…¨ã«ä¿ç®¡ã•ã‚Œã¾ã™"})]})]})]})}),T.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700",children:d?T.jsxs("div",{className:"text-center py-8",children:[T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),T.jsx("p",{className:"text-gray-700 dark:text-gray-300 font-medium mb-2",children:"ä¿è­·è€…ã®åŒæ„æ‰¿èªã‚’å¾—ã¦ã‹ã‚‰åˆ©ç”¨ã—ã¦ãã ã•ã„"}),T.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚Šã¾ã™..."})]}):T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"flex space-x-3",children:[T.jsx("button",{onClick:async()=>{c(!0),await t()},disabled:d,className:"flex-1 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"åŒæ„ã—ãªã„"}),T.jsx("button",{onClick:()=>{u&&!d&&e()},disabled:!u||d,className:"flex-1 py-3 px-4 rounded-lg font-medium transition-all "+(u&&!d?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-500 cursor-not-allowed"),children:i?"ä¿è­·è€…ã®åŒæ„ã‚’å¾—ã¦åˆ©ç”¨é–‹å§‹":"åŒæ„ã—ã¦åˆ©ç”¨é–‹å§‹"})]}),T.jsx("p",{className:"text-xs text-center text-gray-500 dark:text-gray-400 mt-3",children:"åˆ©ç”¨é–‹å§‹å¾Œã‚‚ã„ã¤ã§ã‚‚è¨­å®šã‹ã‚‰ã“ã‚Œã‚‰ã®æ–‡æ›¸ã‚’ç¢ºèªã§ãã¾ã™"})]})})]})})}function Yl({id:e,message:t,type:s="success",duration:a=3e3,onClose:n}){r.useEffect(()=>{const t=setTimeout(()=>{n(e)},a);return()=>clearTimeout(t)},[e,a,n]);return T.jsxs("div",{className:`${(()=>{switch(s){case"success":default:return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"info":return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}})()} border rounded-lg shadow-lg p-4 flex items-center space-x-3 min-w-[300px] max-w-md animate-slide-in-right`,role:"alert",children:[(()=>{switch(s){case"success":default:return T.jsx(Re,{className:"w-5 h-5 text-green-600 dark:text-green-400"});case"error":return T.jsx(ye,{className:"w-5 h-5 text-red-600 dark:text-red-400"});case"info":return T.jsx(lt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}})(),T.jsx("p",{className:"flex-1 text-sm font-medium text-gray-900 dark:text-white",children:t}),T.jsx("button",{onClick:()=>n(e),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:T.jsx(ar,{className:"w-4 h-4"})})]})}function Gl({toasts:e,onClose:t}){return T.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>T.jsx(Yl,{...e,onClose:t},e.id))})}function Zl({onNavigateToPrivacy:e,onNavigateToTerms:t,onNavigateToCommercial:r}){const s=(new Date).getFullYear();return T.jsx("footer",{className:"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8",children:[T.jsx("div",{className:"md:hidden",children:T.jsxs("div",{className:"text-center space-y-3",children:[T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Â© ",s," æ ªå¼ä¼šç¤¾ARCA. All Rights Reserved."]}),T.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"æ³•çš„æƒ…å ±ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã”è¦§ã„ãŸã ã‘ã¾ã™"})]})}),T.jsxs("div",{className:"hidden md:grid grid-cols-1 md:grid-cols-3 gap-8",children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"Bekuta by ARCA"}),T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 leading-relaxed",children:"ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚ ACWRã‚’ç”¨ã„ã¦æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’å¯è¦–åŒ–ã—ã€ã‚¢ã‚¹ãƒªãƒ¼ãƒˆã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚"}),T.jsxs("div",{className:"mt-4 flex items-center text-xs text-gray-500 dark:text-gray-400",children:[T.jsx(Xl,{className:"w-4 h-4 mr-1"}),T.jsx("span",{children:"åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“"})]})]}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"æ³•çš„æƒ…å ±"}),T.jsxs("ul",{className:"space-y-2",children:[T.jsx("li",{children:T.jsxs("button",{onClick:e,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[T.jsx(zt,{className:"w-4 h-4 mr-2"}),"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼"]})}),T.jsx("li",{children:T.jsxs("button",{onClick:t,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[T.jsx(Xe,{className:"w-4 h-4 mr-2"}),"åˆ©ç”¨è¦ç´„"]})}),T.jsx("li",{children:T.jsxs("button",{onClick:r,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[T.jsx(Ee,{className:"w-4 h-4 mr-2"}),"ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜"]})})]})]}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"ãŠå•ã„åˆã‚ã›"}),T.jsxs("div",{className:"space-y-3",children:[T.jsxs("a",{href:"mailto:info@arca.fit",className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[T.jsx(gt,{className:"w-4 h-4 mr-2"}),"info@arca.fit"]}),T.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"å–¶æ¥­æ—¥2-3æ—¥ä»¥å†…ã«è¿”ä¿¡ã„ãŸã—ã¾ã™"})]}),T.jsxs("div",{className:"mt-4",children:[T.jsx("h4",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"é‹å–¶äº‹æ¥­è€…"}),T.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["æ ªå¼ä¼šç¤¾ARCA",T.jsx("br",{}),"ä»£è¡¨å–ç· å½¹ å‰ç”°å……ç¯„"]})]})]})]}),T.jsx("div",{className:"hidden md:block mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:T.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-4 rounded",children:T.jsxs("p",{className:"text-xs text-yellow-800 dark:text-yellow-200 leading-relaxed",children:[T.jsx("strong",{children:"å…è²¬äº‹é …:"})," æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯åŒ»ç™‚æ©Ÿå™¨ã§ã¯ãªãã€è¨ºæ–­ãƒ»æ²»ç™‚ã‚’ç›®çš„ã¨ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ æ€ªæˆ‘ã®äºˆé˜²ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ACWRãã®ä»–ã®æŒ‡æ¨™ã¯å‚è€ƒå€¤ã§ã™ã€‚ æœ€çµ‚çš„ãªåˆ¤æ–­ã¯åˆ©ç”¨è€…æœ¬äººã€æŒ‡å°è€…ã€åŒ»ç™‚å°‚é–€å®¶ãŒè¡Œã£ã¦ãã ã•ã„ã€‚"]})})}),T.jsx("div",{className:"hidden md:block mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:T.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0",children:[T.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Â© ",s," æ ªå¼ä¼šç¤¾ARCA. All Rights Reserved."]}),T.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[T.jsx("span",{children:"Version 1.0.0"}),T.jsx("span",{children:"â€¢"}),T.jsx("span",{children:"æ—¥æœ¬æ³•æº–æ‹ "})]})]})}),T.jsx("div",{className:"hidden md:block mt-4",children:T.jsxs("details",{className:"text-xs text-gray-500 dark:text-gray-400",children:[T.jsx("summary",{className:"cursor-pointer hover:text-gray-700 dark:hover:text-gray-300",children:"ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹"}),T.jsxs("div",{className:"mt-2 pl-4 space-y-1",children:[T.jsx("p",{children:"â€¢ React - MIT License"}),T.jsx("p",{children:"â€¢ Recharts - MIT License"}),T.jsx("p",{children:"â€¢ Supabase - Apache License 2.0"}),T.jsx("p",{children:"â€¢ Lucide Icons - ISC License"}),T.jsx("p",{children:"â€¢ Tailwind CSS - MIT License"})]})]})})]})})}function Xl({className:e}){return T.jsx("svg",{className:e,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}function Ql({userId:e}){var t,s;const{state:a,registerPollJob:n}=ce(),[l,i]=r.useState([]),[o,d]=r.useState(!1),[c,u]=r.useState(null),x=r.useRef((null==(s=null==(t=globalThis.crypto)?void 0:t.randomUUID)?void 0:s.call(t))??Math.random().toString(36).slice(2)),m=r.useRef(null),g=r.useRef(null),[h,p]=r.useState(!1),b=r.useCallback(()=>{var e;const t=m.current;if(t){try{null==(e=t.unsubscribe)||e.call(t)}catch(r){}try{z.removeChannel(t)}catch(r){}m.current=null}},[]),y=r.useCallback(async()=>{if(!e)return;const{data:t,error:r}=await z.from("team_achievement_notifications").select("\n        id, team_id, user_id, achievement_id, is_read, created_at,\n        achievement:team_achievements (\n          id, team_id, achievement_type, title, description, achieved_at, metadata, celebrated\n        )\n      ").eq("user_id",e).eq("is_read",!1).order("created_at",{ascending:!0});if(r)return void console.error("[team_achievement_notifications] load error:",r);if(!t)return;const s=t.filter(e=>e.achievement);i(s)},[e]);r.useEffect(()=>{e&&a.canRun&&y()},[e,a.canRun,y]),r.useEffect(()=>{b()},[e,a.canRealtime,h,y,b]),r.useEffect(()=>{if(g.current&&(g.current(),g.current=null),!e)return;const t=`team_achievements:${e}:${x.current}`,r=n({key:t,intervalMs:12e4,run:async()=>{await y()},enabled:!0,requireVisible:!0,requireOnline:!0,immediate:!0});return g.current=r,()=>{g.current&&(g.current(),g.current=null)}},[e,h,n,y]),r.useEffect(()=>{},[e,a.canRealtime,h]),r.useEffect(()=>{l.length>0&&!o&&(u(l[0]),d(!0),f())},[l,o]);const f=()=>{const e=Date.now()+2500,t={startVelocity:25,spread:360,ticks:60,zIndex:9999},r=setInterval(()=>{const s=e-Date.now();if(s<=0)return clearInterval(r);const a=s/2500*50;or({...t,particleCount:a,origin:{x:.2,y:.2}}),or({...t,particleCount:a,origin:{x:.8,y:.2}})},200)},v=async()=>{if(!c)return;const{error:e}=await z.rpc("mark_team_notification_read",{p_notification_id:c.id});e&&console.error("[mark_team_notification_read] error:",e),d(!1),i(e=>e.filter(e=>e.id!==c.id)),u(null)};if(!o||!c)return null;const j=c.achievement;if(!j)return null;const w=(e=>{switch(e){case"team_streak":case"streak_7":return rr;case"team_personal_best":case"pb":return we;case"team_acwr_safe":return Vt;default:return Kt}})(j.achievement_type);return T.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4 animate-fade-in",children:T.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-2xl shadow-2xl max-w-md w-full p-8 border-4 border-yellow-400 dark:border-yellow-600 animate-bounce-in",children:[T.jsx("div",{className:"flex justify-end mb-2",children:T.jsx("button",{onClick:v,className:"p-2 hover:bg-yellow-200 dark:hover:bg-yellow-800 rounded-lg transition-colors",children:T.jsx(ar,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-yellow-400 dark:bg-yellow-600 rounded-full mb-4 animate-pulse",children:T.jsx(w,{className:"w-10 h-10 text-white"})}),T.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900 dark:text-white",children:"ãƒãƒ¼ãƒ é”æˆï¼"}),T.jsxs("div",{className:"mb-4",children:[T.jsx("h3",{className:"text-xl font-semibold text-yellow-800 dark:text-yellow-200 mb-1",children:j.title}),j.description?T.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:j.description}):null]}),T.jsx("button",{onClick:v,className:"w-full py-3 bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 text-white font-semibold rounded-lg transition-colors",children:"ãŠã‚ã§ã¨ã†ï¼"})]})]})})}const ei=r.lazy(()=>A(()=>import("./OrganizationAdminView-C7TeoVv6.js"),__vite__mapDeps([13,1,2])).then(e=>({default:e.OrganizationAdminView}))),ti=r.lazy(()=>A(()=>Promise.resolve().then(()=>nn),void 0).then(e=>({default:e.AlertPanel})));function ri(){const{user:e,userProfile:t,loading:s,requiresPasswordChange:a,signIn:n,signOut:l,changePassword:i,acceptTerms:o,refreshUserProfile:d}=O();x.useEffect(()=>{let e=!0;(async()=>{const{error:t}=await z.auth.getSession();e&&t&&await P(t)})();const{data:t}=z.auth.onAuthStateChange(async(t,r)=>{if(e&&!r&&("TOKEN_REFRESHED"===t||"SIGNED_IN"===t)){const{error:e}=await z.auth.getSession();e&&await P(e)}});return()=>{e=!1,t.subscription.unsubscribe()}},[]);const c="staff"===(null==t?void 0:t.role)||"global_admin"===(null==t?void 0:t.role)||"athlete"===(null==t?void 0:t.role)?t.role:"athlete",[u,m]=x.useState(!1),{isOrganizationAdmin:g,getOrganizationAdminRoles:h}=function(e){const[t,s]=r.useState([]),[a,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{e?o():n(!1)},[e]);const o=async()=>{if(e)try{n(!0),i(null);const{data:t,error:r}=await z.from("organization_members").select("\n          organization_id,\n          role,\n          organizations (\n            id,\n            name\n          )\n        ").eq("user_id",e);if(r)throw r;const a=(t||[]).map(e=>{var t;return{organizationId:e.organization_id,organizationName:(null==(t=e.organizations)?void 0:t.name)||"Unknown",role:e.role}});s(a)}catch(t){const e=t instanceof Error?t.message:"Failed to load organization roles";i(e),console.error("Error loading organization roles:",t)}finally{n(!1)}};return{organizationRoles:t,loading:a,error:l,isOrganizationAdmin:e=>e?t.some(t=>t.organizationId===e&&"organization_admin"===t.role):t.some(e=>"organization_admin"===e.role),getOrganizationAdminRoles:()=>t.filter(e=>"organization_admin"===e.role),reload:o}}(null==t?void 0:t.id),{alerts:p,loading:b,unreadCount:y,markAsRead:f,dismissAlert:v,markAllAsRead:j,getAlertsByPriority:w}=ue((null==t?void 0:t.id)||"",c),{toasts:N,removeToast:k}=function(){const[e,t]=r.useState([]),s=r.useCallback((e,r="success",s=3e3)=>{const a={id:`toast-${Date.now()}-${Math.random()}`,message:e,type:r,duration:s};t(e=>[...e,a])},[]),a=r.useCallback(e=>{t(t=>t.filter(t=>t.id!==e))},[]),n=r.useCallback((e,t)=>{s(e,"success",t)},[s]),l=r.useCallback((e,t)=>{s(e,"error",t)},[s]),i=r.useCallback((e,t)=>{s(e,"info",t)},[s]);return{toasts:e,showToast:s,removeToast:a,success:n,error:l,info:i}}(),[_,S]=x.useState(!1),[C,E]=x.useState(!1),[D,M]=x.useState("app"),[R,$]=x.useState("staff"),[A,I]=x.useState(!1);if(x.useEffect(()=>{m(a)},[a]),x.useEffect(()=>{const e=new URL(window.location.href),t=e.pathname,r=e.searchParams;t.startsWith("/auth/callback")?M("auth-callback"):t.startsWith("/invite-expired")?M("invite-expired"):t.startsWith("/reset-password")?M("reset-password"):(t.startsWith("/welcome")||r.get("token"))&&M("welcome")},[]),x.useEffect(()=>{const e=window.location.hash;if(!e)return;const t=new URLSearchParams(e.replace("#",""));if("recovery"!==t.get("type"))return;const r=t.get("access_token"),s=t.get("refresh_token");r&&s&&(async()=>{var e;const{data:t}=await z.auth.setSession({access_token:r,refresh_token:s});(null==(e=t.session)?void 0:e.user)&&(m(!0),window.history.replaceState({},document.title,window.location.pathname),M("reset-password"))})()},[]),x.useEffect(()=>{e&&t&&!u?t.terms_accepted||A?E(!1):E(!0):E(!1)},[e,t,u,A]),"auth-callback"===D)return T.jsx(Fl,{onDone:()=>{M("app"),window.history.replaceState({},"","/")}});const L="true"===String("false"),q=window.location.pathname.startsWith("/auth/callback");return L&&!q?T.jsx(Kl,{etaText:"ï¼ˆå®‰å®šåŒ–ã‚’ç¢ºèªä¸­ã§ã™ã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ï¼‰"}):"invite-expired"===D?T.jsx(Wl,{}):"welcome"===D?T.jsx(xr,{onContinue:()=>{M("app"),window.history.replaceState({},"","/")}}):e?T.jsx(Vl,{loading:s||!!e&&!t,ready:!!e&&!!t,onRetry:d,children:(()=>{if(!t)return null;if(u)return T.jsx(ur,{onPasswordChange:async e=>{await i(e),m(!1),window.history.replaceState({},"","/")},userName:t.name});if(C)return T.jsx(Jl,{onAccept:async()=>{await o(),I(!0),E(!1)},onDecline:l});const e=w("high").length>0;return T.jsx(me,{userId:t.id,role:c,children:T.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[T.jsx(Ul,{effectiveRole:c,userProfile:{id:t.id,name:t.name,email:t.email},alertsLoading:b,unreadCount:y,hasHighPriorityAlerts:e,onOpenAlertPanel:()=>S(!0),onLogout:async e=>{e.preventDefault(),await l(),M("app"),window.history.replaceState({},"","/")},onHome:()=>{console.log("ğŸ  Bekuta logo clicked"),M("app"),$("staff"),S(!1)},onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}),T.jsxs("div",{className:"relative",children:[T.jsx(ql,{userId:t.id}),"athlete"===c?T.jsx(La,{user:t,alerts:p,onLogout:l,onUserUpdated:d,onHome:()=>{console.log("ğŸ  Athlete Bekuta home tapped"),window.location.assign("https://bekuta.netlify.app/")},onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}):Kn(c)?T.jsx(Il,{user:t,alerts:p,onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}):T.jsxs(T.Fragment,{children:[g()&&T.jsx("div",{className:"bg-white dark:bg-gray-800 border-b dark:border-gray-700 transition-colors sticky top-0 z-30",children:T.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2",children:T.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1 max-w-md",children:[T.jsxs("button",{type:"button",onClick:()=>$("staff"),className:"flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 "+("staff"===R?"bg-white dark:bg-gray-600 text-green-600 dark:text-green-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:[T.jsx(rr,{className:"w-4 h-4"}),T.jsx("span",{children:"ã‚³ãƒ¼ãƒ"})]}),T.jsxs("button",{type:"button",onClick:()=>$("org-admin"),className:"flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 "+("org-admin"===R?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:[T.jsx(Ee,{className:"w-4 h-4"}),T.jsx("span",{children:"çµ„ç¹”ç®¡ç†"})]})]})})}),"staff"===R?T.jsx(Vn,{user:t,alerts:p,onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")}):h().length>0&&T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"flex items-center justify-center min-h-screen",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:T.jsx(ei,{user:t,alerts:p,organizationId:h()[0].organizationId,organizationName:h()[0].organizationName,onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial"),onNavigateToHelp:()=>M("help")})})]})]}),_&&!b&&T.jsx(r.Suspense,{fallback:T.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:T.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:T.jsx(ti,{alerts:p,onMarkAsRead:f,onDismiss:v,onMarkAllAsRead:j,onClose:()=>S(!1),userRole:c})}),t&&T.jsx(Ql,{userId:t.id}),T.jsx(Gl,{toasts:N,onClose:k}),T.jsx(Zl,{onNavigateToPrivacy:()=>M("privacy"),onNavigateToTerms:()=>M("terms"),onNavigateToCommercial:()=>M("commercial")})]})})})()}):T.jsx(lr,{onLogin:n})}const si="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,ai=globalThis,ni="10.34.0";function li(){return ii(ai),ai}function ii(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||ni,t[ni]=t[ni]||{}}function oi(e,t,r=ai){const s=r.__SENTRY__=r.__SENTRY__||{},a=s[ni]=s[ni]||{};return a[e]||(a[e]=t())}const di=["debug","info","warn","error","log","assert","trace"],ci={};function ui(e){if(!("console"in ai))return e();const t=ai.console,r={},s=Object.keys(ci);s.forEach(e=>{const s=ci[e];r[e]=t[e],t[e]=s});try{return e()}finally{s.forEach(e=>{t[e]=r[e]})}}function xi(){return gi().enabled}function mi(e,...t){si&&xi()&&ui(()=>{ai.console[e](`Sentry Logger [${e}]:`,...t)})}function gi(){return si?oi("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const hi={enable:function(){gi().enabled=!0},disable:function(){gi().enabled=!1},isEnabled:xi,log:function(...e){mi("log",...e)},warn:function(...e){mi("warn",...e)},error:function(...e){mi("error",...e)}},pi="?",bi=/\(error: (.*)\)/,yi=/captureMessage|captureException/;function fi(...e){const t=e.sort((e,t)=>e[0]-t[0]).map(e=>e[1]);return(e,r=0,s=0)=>{const a=[],n=e.split("\n");for(let l=r;l<n.length;l++){let e=n[l];e.length>1024&&(e=e.slice(0,1024));const r=bi.test(e)?e.replace(bi,"$1"):e;if(!r.match(/\S*Error: /)){for(const e of t){const t=e(r);if(t){a.push(t);break}}if(a.length>=50+s)break}}return function(e){if(!e.length)return[];const t=Array.from(e);/sentryWrapped/.test(vi(t).function||"")&&t.pop();t.reverse(),yi.test(vi(t).function||"")&&(t.pop(),yi.test(vi(t).function||"")&&t.pop());return t.slice(0,50).map(e=>({...e,filename:e.filename||vi(t).filename,function:e.function||pi}))}(a.slice(s))}}function vi(e){return e[e.length-1]||{}}const ji="<anonymous>";function wi(e){try{return e&&"function"==typeof e&&e.name||ji}catch{return ji}}function Ni(e){const t=e.exception;if(t){const e=[];try{return t.values.forEach(t=>{t.stacktrace.frames&&e.push(...t.stacktrace.frames)}),e}catch{return}}}function ki(e){return"__v_isVNode"in e&&e.__v_isVNode?"[VueVNode]":"[VueViewModel]"}const _i={},Si={};function Ci(e,t){_i[e]=_i[e]||[],_i[e].push(t)}function Ei(e,t){if(!Si[e]){Si[e]=!0;try{t()}catch(r){si&&hi.error(`Error while instrumenting ${e}`,r)}}}function Di(e,t){const r=e&&_i[e];if(r)for(const a of r)try{a(t)}catch(s){si&&hi.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${wi(a)}\nError:`,s)}}let Mi=null;function Ti(){Mi=ai.onerror,ai.onerror=function(e,t,r,s,a){return Di("error",{column:s,error:a,line:r,msg:e,url:t}),!!Mi&&Mi.apply(this,arguments)},ai.onerror.__SENTRY_INSTRUMENTED__=!0}let Ri=null;function $i(){Ri=ai.onunhandledrejection,ai.onunhandledrejection=function(e){return Di("unhandledrejection",e),!Ri||Ri.apply(this,arguments)},ai.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const Ai=Object.prototype.toString;function Ii(e){switch(Ai.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Hi(e,Error)}}function zi(e,t){return Ai.call(e)===`[object ${t}]`}function Pi(e){return zi(e,"ErrorEvent")}function Li(e){return zi(e,"DOMError")}function qi(e){return zi(e,"String")}function Fi(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function Oi(e){return null===e||Fi(e)||"object"!=typeof e&&"function"!=typeof e}function Wi(e){return zi(e,"Object")}function Bi(e){return"undefined"!=typeof Event&&Hi(e,Event)}function Ui(e){return Boolean((null==e?void 0:e.then)&&"function"==typeof e.then)}function Hi(e,t){try{return e instanceof t}catch{return!1}}function Vi(e){return!("object"!=typeof e||null===e||!(e.__isVue||e._isVue||e.__v_isVNode))}function Ki(e){return"undefined"!=typeof Request&&Hi(e,Request)}const Ji=ai;function Yi(e,t={}){if(!e)return"<unknown>";try{let r=e;const s=5,a=[];let n=0,l=0;const i=" > ",o=i.length;let d;const c=Array.isArray(t)?t:t.keyAttrs,u=!Array.isArray(t)&&t.maxStringLength||80;for(;r&&n++<s&&(d=Gi(r,c),!("html"===d||n>1&&l+a.length*o+d.length>=u));)a.push(d),l+=d.length,r=r.parentNode;return a.reverse().join(i)}catch{return"<unknown>"}}function Gi(e,t){const r=e,s=[];if(!(null==r?void 0:r.tagName))return"";if(Ji.HTMLElement&&r instanceof HTMLElement&&r.dataset){if(r.dataset.sentryComponent)return r.dataset.sentryComponent;if(r.dataset.sentryElement)return r.dataset.sentryElement}s.push(r.tagName.toLowerCase());const a=(null==t?void 0:t.length)?t.filter(e=>r.getAttribute(e)).map(e=>[e,r.getAttribute(e)]):null;if(null==a?void 0:a.length)a.forEach(e=>{s.push(`[${e[0]}="${e[1]}"]`)});else{r.id&&s.push(`#${r.id}`);const e=r.className;if(e&&qi(e)){const t=e.split(/\s+/);for(const e of t)s.push(`.${e}`)}}const n=["aria-label","type","name","title","alt"];for(const l of n){const e=r.getAttribute(l);e&&s.push(`[${l}="${e}"]`)}return s.join("")}function Zi(){try{return Ji.document.location.href}catch{return""}}function Xi(e,t,r){if(!(t in e))return;const s=e[t];if("function"!=typeof s)return;const a=r(s);"function"==typeof a&&eo(a,s);try{e[t]=a}catch{si&&hi.log(`Failed to replace method "${t}" in object`,e)}}function Qi(e,t,r){try{Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0})}catch{si&&hi.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function eo(e,t){try{const r=t.prototype||{};e.prototype=t.prototype=r,Qi(e,"__sentry_original__",t)}catch{}}function to(e){return e.__sentry_original__}function ro(e){if(Ii(e))return{message:e.message,name:e.name,stack:e.stack,...ao(e)};if(Bi(e)){const t={type:e.type,target:so(e.target),currentTarget:so(e.currentTarget),...ao(e)};return"undefined"!=typeof CustomEvent&&Hi(e,CustomEvent)&&(t.detail=e.detail),t}return e}function so(e){try{return t=e,"undefined"!=typeof Element&&Hi(t,Element)?Yi(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}var t}function ao(e){if("object"==typeof e&&null!==e){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}return{}}let no,lo;function io(e){if(void 0!==no)return no?no(e):e();const t=Symbol.for("__SENTRY_SAFE_RANDOM_ID_WRAPPER__"),r=ai;return t in r&&"function"==typeof r[t]?(no=r[t],no(e)):(no=null,e())}function oo(){return io(()=>Math.random())}function co(){return io(()=>Date.now())}function uo(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function xo(e,t){if(!Array.isArray(e))return"";const r=[];for(let s=0;s<e.length;s++){const t=e[s];try{Vi(t)?r.push(ki(t)):r.push(String(t))}catch{r.push("[value cannot be serialized]")}}return r.join(t)}function mo(e,t,r=!1){return!!qi(e)&&(zi(t,"RegExp")?t.test(e):!!qi(t)&&(r?e===t:e.includes(t)))}function go(e,t=[],r=!1){return t.some(t=>mo(e,t,r))}function ho(e=function(){const e=ai;return e.crypto||e.msCrypto}()){try{if(null==e?void 0:e.randomUUID)return io(()=>e.randomUUID()).replace(/-/g,"")}catch{}return lo||(lo="10000000100040008000100000000000"),lo.replace(/[018]/g,e=>(e^(16*oo()&15)>>e/4).toString(16))}function po(e){var t,r;return null==(r=null==(t=e.exception)?void 0:t.values)?void 0:r[0]}function bo(e){const{message:t,event_id:r}=e;if(t)return t;const s=po(e);return s?s.type&&s.value?`${s.type}: ${s.value}`:s.type||s.value||r||"<unknown>":r||"<unknown>"}function yo(e,t,r){const s=e.exception=e.exception||{},a=s.values=s.values||[],n=a[0]=a[0]||{};n.value||(n.value=t||""),n.type||(n.type="Error")}function fo(e,t){const r=po(e);if(!r)return;const s=r.mechanism;if(r.mechanism={type:"generic",handled:!0,...s,...t},t&&"data"in t){const e={...null==s?void 0:s.data,...t.data};r.mechanism.data=e}}function vo(e){if(function(e){try{return e.__sentry_captured__}catch{}}(e))return!0;try{Qi(e,"__sentry_captured__",!0)}catch{}return!1}function jo(){return co()/1e3}let wo;function No(){return(wo??(wo=function(){const{performance:e}=ai;if(!(null==e?void 0:e.now)||!e.timeOrigin)return jo;const t=e.timeOrigin;return()=>(t+io(()=>e.now()))/1e3}()))()}function ko(e){const t=No(),r={sid:ho(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(e){return{sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}}}(r)};return e&&_o(r,e),r}function _o(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),e.did||t.did||(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||No(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:ho()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function So(e,t,r=2){if(!t||"object"!=typeof t||r<=0)return t;if(e&&0===Object.keys(t).length)return e;const s={...e};for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(s[a]=So(s[a],t[a],r-1));return s}function Co(){return ho()}function Eo(){return ho().substring(16)}const Do="_sentrySpan";function Mo(e,t){t?Qi(e,Do,t):delete e[Do]}function To(e){return e[Do]}class Ro{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Co(),sampleRand:oo()}}clone(){const e=new Ro;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._attributes={...this._attributes},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Mo(e,To(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&_o(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this.setTags({[e]:t})}setAttributes(e){return this._attributes={...this._attributes,...e},this._notifyScopeListeners(),this}setAttribute(e,t){return this.setAttributes({[e]:t})}removeAttribute(e){return e in this._attributes&&(delete this._attributes[e],this._notifyScopeListeners()),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,r=t instanceof Ro?t.getScopeData():Wi(t)?e:void 0,{tags:s,attributes:a,extra:n,user:l,contexts:i,level:o,fingerprint:d=[],propagationContext:c}=r||{};return this._tags={...this._tags,...s},this._attributes={...this._attributes,...a},this._extra={...this._extra,...n},this._contexts={...this._contexts,...i},l&&Object.keys(l).length&&(this._user=l),o&&(this._level=o),d.length&&(this._fingerprint=d),c&&(this._propagationContext=c),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,Mo(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Co(),sampleRand:oo()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){var r;const s="number"==typeof t?t:100;if(s<=0)return this;const a={timestamp:jo(),...e,message:e.message?uo(e.message,2048):e.message};return this._breadcrumbs.push(a),this._breadcrumbs.length>s&&(this._breadcrumbs=this._breadcrumbs.slice(-s),null==(r=this._client)||r.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:To(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=So(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const r=(null==t?void 0:t.event_id)||ho();if(!this._client)return si&&hi.warn("No client configured on scope - will not capture exception!"),r;const s=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:s,...t,event_id:r},this),r}captureMessage(e,t,r){const s=(null==r?void 0:r.event_id)||ho();if(!this._client)return si&&hi.warn("No client configured on scope - will not capture message!"),s;const a=(null==r?void 0:r.syntheticException)??new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:a,...r,event_id:s},this),s}captureEvent(e,t){const r=(null==t?void 0:t.event_id)||ho();return this._client?(this._client.captureEvent(e,{...t,event_id:r},this),r):(si&&hi.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}class $o{constructor(e,t){let r,s;r=e||new Ro,s=t||new Ro,this._stack=[{scope:r}],this._isolationScope=s}withScope(e){const t=this._pushScope();let r;try{r=e(t)}catch(s){throw this._popScope(),s}return Ui(r)?r.then(e=>(this._popScope(),e),e=>{throw this._popScope(),e}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function Ao(){const e=ii(li());return e.stack=e.stack||new $o(oi("defaultCurrentScope",()=>new Ro),oi("defaultIsolationScope",()=>new Ro))}function Io(e){return Ao().withScope(e)}function zo(e,t){const r=Ao();return r.withScope(()=>(r.getStackTop().scope=e,t(e)))}function Po(e){return Ao().withScope(()=>e(Ao().getIsolationScope()))}function Lo(e){const t=ii(e);return t.acs?t.acs:{withIsolationScope:Po,withScope:Io,withSetScope:zo,withSetIsolationScope:(e,t)=>Po(t),getCurrentScope:()=>Ao().getScope(),getIsolationScope:()=>Ao().getIsolationScope()}}function qo(){return Lo(li()).getCurrentScope()}function Fo(){return Lo(li()).getIsolationScope()}function Oo(){return qo().getClient()}function Wo(e){const t=e.getPropagationContext(),{traceId:r,parentSpanId:s,propagationSpanId:a}=t,n={trace_id:r,span_id:a||Eo()};return s&&(n.parent_span_id=s),n}const Bo="sentry.profile_id",Uo="sentry.exclusive_time";function Ho(e){if(e){if("object"==typeof e&&"deref"in e&&"function"==typeof e.deref)try{return e.deref()}catch{return}return e}}function Vo(e){const t=e;return{scope:t._sentryScope,isolationScope:Ho(t._sentryIsolationScope)}}const Ko=/^sentry-/;function Jo(e){const t=function(e){if(!e||!qi(e)&&!Array.isArray(e))return;if(Array.isArray(e))return e.reduce((e,t)=>{const r=Yo(t);return Object.entries(r).forEach(([t,r])=>{e[t]=r}),e},{});return Yo(e)}(e);if(!t)return;const r=Object.entries(t).reduce((e,[t,r])=>{if(t.match(Ko)){e[t.slice(7)]=r}return e},{});return Object.keys(r).length>0?r:void 0}function Yo(e){return e.split(",").map(e=>{const t=e.indexOf("=");if(-1===t)return[];return[e.slice(0,t),e.slice(t+1)].map(e=>{try{return decodeURIComponent(e.trim())}catch{return}})}).reduce((e,[t,r])=>(t&&r&&(e[t]=r),e),{})}const Go=/^o(\d+)\./,Zo=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)((?:\[[:.%\w]+\]|[\w.-]+))(?::(\d+))?\/(.+)/;function Xo(e,t=!1){const{host:r,path:s,pass:a,port:n,projectId:l,protocol:i,publicKey:o}=e;return`${i}://${o}${t&&a?`:${a}`:""}@${r}${n?`:${n}`:""}/${s?`${s}/`:s}${l}`}function Qo(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function ed(e){const t=e.getOptions(),{host:r}=e.getDsn()||{};let s;return t.orgId?s=String(t.orgId):r&&(s=function(e){const t=e.match(Go);return null==t?void 0:t[1]}(r)),s}function td(e){const t="string"==typeof e?function(e){const t=Zo.exec(e);if(!t)return void ui(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});const[r,s,a="",n="",l="",i=""]=t.slice(1);let o="",d=i;const c=d.split("/");if(c.length>1&&(o=c.slice(0,-1).join("/"),d=c.pop()),d){const e=d.match(/^\d+/);e&&(d=e[0])}return Qo({host:n,pass:a,path:o,projectId:d,port:l,protocol:r,publicKey:s})}(e):Qo(e);if(t&&function(e){if(!si)return!0;const{port:t,projectId:r,protocol:s}=e;return!(["protocol","publicKey","host","projectId"].find(t=>!e[t]&&(hi.error(`Invalid Sentry Dsn: ${t} missing`),!0))||(r.match(/^\d+$/)?function(e){return"http"===e||"https"===e}(s)?t&&isNaN(parseInt(t,10))&&(hi.error(`Invalid Sentry Dsn: Invalid port ${t}`),1):(hi.error(`Invalid Sentry Dsn: Invalid protocol ${s}`),1):(hi.error(`Invalid Sentry Dsn: Invalid projectId ${r}`),1)))}(t))return t}let rd=!1;function sd(e){const{spanId:t,traceId:r,isRemote:s}=e.spanContext(),a=s?t:id(e).parent_span_id,n=Vo(e).scope;return{parent_span_id:a,span_id:s?(null==n?void 0:n.getPropagationContext().propagationSpanId)||Eo():t,trace_id:r}}function ad(e){return e&&e.length>0?e.map(({context:{spanId:e,traceId:t,traceFlags:r,...s},attributes:a})=>({span_id:e,trace_id:t,sampled:1===r,attributes:a,...s})):void 0}function nd(e){return"number"==typeof e?ld(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?ld(e.getTime()):No()}function ld(e){return e>9999999999?e/1e3:e}function id(e){var t;if(function(e){return"function"==typeof e.getSpanJSON}(e))return e.getSpanJSON();const{spanId:r,traceId:s}=e.spanContext();if(function(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}(e)){const{attributes:a,startTime:n,name:l,endTime:i,status:o,links:d}=e;return{span_id:r,trace_id:s,data:a,description:l,parent_span_id:"parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?null==(t=e.parentSpanContext)?void 0:t.spanId:void 0,start_timestamp:nd(n),timestamp:nd(i)||void 0,status:od(o),op:a["sentry.op"],origin:a["sentry.origin"],links:ad(d)}}return{span_id:r,trace_id:s,start_timestamp:0,data:{}}}function od(e){if(e&&0!==e.code)return 1===e.code?"ok":e.message||"internal_error"}function dd(e){return e._sentryRootSpan||e}function cd(){rd||(ui(()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly or use `ignoreSpans`.")}),rd=!0)}function ud(e){hi.log(`Ignoring span ${e.op} - ${e.description} because it matches \`ignoreSpans\`.`)}function xd(e,t){if(!(null==t?void 0:t.length)||!e.description)return!1;for(const r of t){if(gd(r)){if(mo(e.description,r))return si&&ud(e),!0;continue}if(!r.name&&!r.op)continue;const t=!r.name||mo(e.description,r.name),s=!r.op||e.op&&mo(e.op,r.op);if(t&&s)return si&&ud(e),!0}return!1}function md(e,t){const r=t.parent_span_id,s=t.span_id;if(r)for(const a of e)a.parent_span_id===s&&(a.parent_span_id=r)}function gd(e){return"string"==typeof e||e instanceof RegExp}const hd="production";function pd(e,t){const r=t.getOptions(),{publicKey:s}=t.getDsn()||{},a={environment:r.environment||hd,release:r.release,public_key:s,trace_id:e,org_id:ed(t)};return t.emit("createDsc",a),a}function bd(e){var t;const r=Oo();if(!r)return{};const s=dd(e),a=id(s),n=a.data,l=s.spanContext().traceState,i=(null==l?void 0:l.get("sentry.sample_rate"))??n["sentry.sample_rate"]??n["sentry.previous_trace_sample_rate"];function o(e){return"number"!=typeof i&&"string"!=typeof i||(e.sample_rate=`${i}`),e}const d=s._frozenDsc;if(d)return o(d);const c=null==l?void 0:l.get("sentry.dsc"),u=c&&Jo(c);if(u)return o(u);const x=pd(e.spanContext().traceId,r),m=n["sentry.source"],g=a.description;return"url"!==m&&g&&(x.transaction=g),function(){var e;if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=null==(e=Oo())?void 0:e.getOptions();return!(!t||null==t.tracesSampleRate&&!t.tracesSampler)}()&&(x.sampled=String(function(e){const{traceFlags:t}=e.spanContext();return 1===t}(s)),x.sample_rand=(null==l?void 0:l.get("sentry.sample_rand"))??(null==(t=Vo(s).scope)?void 0:t.getPropagationContext().sampleRand.toString())),o(x),r.emit("createDsc",x,s),x}function yd(e,t=100,r=1/0){try{return vd("",e,t,r)}catch(s){return{ERROR:`**non-serializable** (${s})`}}}function fd(e,t=3,r=102400){const s=yd(e,t);return a=s,function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(a))>r?fd(e,t-1,r):s;var a}function vd(e,t,r=1/0,s=1/0,a=function(){const e=new WeakSet;function t(t){return!!e.has(t)||(e.add(t),!1)}function r(t){e.delete(t)}return[t,r]}()){const[n,l]=a;if(null==t||["boolean","string"].includes(typeof t)||"number"==typeof t&&Number.isFinite(t))return t;const i=function(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if("undefined"!=typeof global&&t===global)return"[Global]";if("undefined"!=typeof window&&t===window)return"[Window]";if("undefined"!=typeof document&&t===document)return"[Document]";if(Vi(t))return ki(t);if(Wi(r=t)&&"nativeEvent"in r&&"preventDefault"in r&&"stopPropagation"in r)return"[SyntheticEvent]";if("number"==typeof t&&!Number.isFinite(t))return`[${t}]`;if("function"==typeof t)return`[Function: ${wi(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const s=function(e){const t=Object.getPrototypeOf(e);return(null==t?void 0:t.constructor)?t.constructor.name:"null prototype"}(t);return/^HTML(\w*)Element$/.test(s)?`[HTMLElement: ${s}]`:`[object ${s}]`}catch(s){return`**non-serializable** (${s})`}var r}(e,t);if(!i.startsWith("[object "))return i;if(t.__sentry_skip_normalization__)return t;const o="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:r;if(0===o)return i.replace("object ","");if(n(t))return"[Circular ~]";const d=t;if(d&&"function"==typeof d.toJSON)try{return vd("",d.toJSON(),o-1,s,a)}catch{}const c=Array.isArray(t)?[]:{};let u=0;const x=ro(t);for(const m in x){if(!Object.prototype.hasOwnProperty.call(x,m))continue;if(u>=s){c[m]="[MaxProperties ~]";break}const e=x[m];c[m]=vd(m,e,o-1,s,a),u++}return l(t),c}function jd(e,t=[]){return[e,t]}function wd(e,t){const[r,s]=e;return[r,[...s,t]]}function Nd(e,t){const r=e[1];for(const s of r){if(t(s,s[0].type))return!0}return!1}function kd(e){const t=ii(ai);return t.encodePolyfill?t.encodePolyfill(e):(new TextEncoder).encode(e)}function _d(e){const[t,r]=e;let s=JSON.stringify(t);function a(e){"string"==typeof s?s="string"==typeof e?s+e:[kd(s),e]:s.push("string"==typeof e?kd(e):e)}for(const n of r){const[e,t]=n;if(a(`\n${JSON.stringify(e)}\n`),"string"==typeof t||t instanceof Uint8Array)a(t);else{let e;try{e=JSON.stringify(t)}catch{e=JSON.stringify(yd(t))}a(e)}}return"string"==typeof s?s:function(e){const t=e.reduce((e,t)=>e+t.length,0),r=new Uint8Array(t);let s=0;for(const a of e)r.set(a,s),s+=a.length;return r}(s)}function Sd(e){const t="string"==typeof e.data?kd(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const Cd={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item",metric:"metric",trace_metric:"metric"};function Ed(e){return Cd[e]}function Dd(e){if(!(null==e?void 0:e.sdk))return;const{name:t,version:r}=e.sdk;return{name:t,version:r}}function Md(e,t,r,s){const a=Dd(r),n=e.type&&"replay_event"!==e.type?e.type:"event";!function(e,t){var r,s,a,n;if(!t)return e;const l=e.sdk||{};e.sdk={...l,name:l.name||t.name,version:l.version||t.version,integrations:[...(null==(r=e.sdk)?void 0:r.integrations)||[],...t.integrations||[]],packages:[...(null==(s=e.sdk)?void 0:s.packages)||[],...t.packages||[]],settings:(null==(a=e.sdk)?void 0:a.settings)||t.settings?{...null==(n=e.sdk)?void 0:n.settings,...t.settings}:void 0}}(e,null==r?void 0:r.sdk);const l=function(e,t,r,s){var a;const n=null==(a=e.sdkProcessingMetadata)?void 0:a.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!r&&s&&{dsn:Xo(s)},...n&&{trace:n}}}(e,a,s,t);delete e.sdkProcessingMetadata;return jd(l,[[{type:n},e]])}function Td(e){return new $d(t=>{t(e)})}function Rd(e){return new $d((t,r)=>{r(e)})}class $d{constructor(e){this._state=0,this._handlers=[],this._runExecutor(e)}then(e,t){return new $d((r,s)=>{this._handlers.push([!1,t=>{if(e)try{r(e(t))}catch(a){s(a)}else r(t)},e=>{if(t)try{r(t(e))}catch(a){s(a)}else s(e)}]),this._executeHandlers()})}catch(e){return this.then(e=>e,e)}finally(e){return new $d((t,r)=>{let s,a;return this.then(t=>{a=!1,s=t,e&&e()},t=>{a=!0,s=t,e&&e()}).then(()=>{a?r(s):t(s)})})}_executeHandlers(){if(0===this._state)return;const e=this._handlers.slice();this._handlers=[],e.forEach(e=>{e[0]||(1===this._state&&e[1](this._value),2===this._state&&e[2](this._value),e[0]=!0)})}_runExecutor(e){const t=(e,t)=>{0===this._state&&(Ui(t)?t.then(r,s):(this._state=e,this._value=t,this._executeHandlers()))},r=e=>{t(1,e)},s=e=>{t(2,e)};try{e(r,s)}catch(a){s(a)}}}function Ad(e,t,r,s=0){try{const a=Id(t,r,e,s);return Ui(a)?a:Td(a)}catch(a){return Rd(a)}}function Id(e,t,r,s){const a=r[s];if(!e||!a)return e;const n=a({...e},t);return si&&null===n&&hi.log(`Event processor "${a.id||"?"}" dropped event`),Ui(n)?n.then(e=>Id(e,t,r,s+1)):Id(n,t,r,s+1)}let zd,Pd,Ld,qd;function Fd(e,t){const{fingerprint:r,span:s,breadcrumbs:a,sdkProcessingMetadata:n}=t;!function(e,t){const{extra:r,tags:s,user:a,contexts:n,level:l,transactionName:i}=t;Object.keys(r).length&&(e.extra={...r,...e.extra});Object.keys(s).length&&(e.tags={...s,...e.tags});Object.keys(a).length&&(e.user={...a,...e.user});Object.keys(n).length&&(e.contexts={...n,...e.contexts});l&&(e.level=l);i&&"transaction"!==e.type&&(e.transaction=i)}(e,t),s&&function(e,t){e.contexts={trace:sd(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:bd(t),...e.sdkProcessingMetadata};const r=dd(t),s=id(r).description;s&&!e.transaction&&"transaction"===e.type&&(e.transaction=s)}(e,s),function(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t));e.fingerprint.length||delete e.fingerprint}(e,r),function(e,t){const r=[...e.breadcrumbs||[],...t];e.breadcrumbs=r.length?r:void 0}(e,a),function(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}(e,n)}function Od(e,t){const{extra:r,tags:s,attributes:a,user:n,contexts:l,level:i,sdkProcessingMetadata:o,breadcrumbs:d,fingerprint:c,eventProcessors:u,attachments:x,propagationContext:m,transactionName:g,span:h}=t;Wd(e,"extra",r),Wd(e,"tags",s),Wd(e,"attributes",a),Wd(e,"user",n),Wd(e,"contexts",l),e.sdkProcessingMetadata=So(e.sdkProcessingMetadata,o,2),i&&(e.level=i),g&&(e.transactionName=g),h&&(e.span=h),d.length&&(e.breadcrumbs=[...e.breadcrumbs,...d]),c.length&&(e.fingerprint=[...e.fingerprint,...c]),u.length&&(e.eventProcessors=[...e.eventProcessors,...u]),x.length&&(e.attachments=[...e.attachments,...x]),e.propagationContext={...e.propagationContext,...m}}function Wd(e,t,r){e[t]=So(e[t],r,1)}function Bd(e,t){const r=oi("globalScope",()=>new Ro).getScopeData();return e&&Od(r,e.getScopeData()),t&&Od(r,t.getScopeData()),r}function Ud(e,t,r,s,a,n){const{normalizeDepth:l=3,normalizeMaxBreadth:i=1e3}=e,o={...t,event_id:t.event_id||r.event_id||ho(),timestamp:t.timestamp||jo()},d=r.integrations||e.integrations.map(e=>e.name);!function(e,t){var r,s;const{environment:a,release:n,dist:l,maxValueLength:i}=t;e.environment=e.environment||a||hd,!e.release&&n&&(e.release=n);!e.dist&&l&&(e.dist=l);const o=e.request;(null==o?void 0:o.url)&&i&&(o.url=uo(o.url,i));i&&(null==(s=null==(r=e.exception)?void 0:r.values)||s.forEach(e=>{e.value&&(e.value=uo(e.value,i))}))}(o,e),function(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}(o,d),a&&a.emit("applyFrameMetadata",t),void 0===t.type&&function(e,t){var r,s;const a=function(e){const t=ai._sentryDebugIds,r=ai._debugIds;if(!t&&!r)return{};const s=t?Object.keys(t):[],a=r?Object.keys(r):[];if(qd&&s.length===Pd&&a.length===Ld)return qd;Pd=s.length,Ld=a.length,qd={},zd||(zd={});const n=(t,r)=>{for(const s of t){const t=r[s],a=null==zd?void 0:zd[s];if(a&&qd&&t)qd[a[0]]=t,zd&&(zd[s]=[a[0],t]);else if(t){const r=e(s);for(let e=r.length-1;e>=0;e--){const a=r[e],n=null==a?void 0:a.filename;if(n&&qd&&zd){qd[n]=t,zd[s]=[n,t];break}}}}};return t&&n(s,t),r&&n(a,r),qd}(t);null==(s=null==(r=e.exception)?void 0:r.values)||s.forEach(e=>{var t,r;null==(r=null==(t=e.stacktrace)?void 0:t.frames)||r.forEach(e=>{e.filename&&(e.debug_id=a[e.filename])})})}(o,e.stackParser);const c=function(e,t){if(!t)return e;const r=e?e.clone():new Ro;return r.update(t),r}(s,r.captureContext);r.mechanism&&fo(o,r.mechanism);const u=a?a.getEventProcessors():[],x=Bd(n,c),m=[...r.attachments||[],...x.attachments];m.length&&(r.attachments=m),Fd(o,x);return Ad([...u,...x.eventProcessors],o,r).then(e=>(e&&function(e){var t,r;const s={};if(null==(r=null==(t=e.exception)?void 0:t.values)||r.forEach(e=>{var t,r;null==(r=null==(t=e.stacktrace)?void 0:t.frames)||r.forEach(e=>{e.debug_id&&(e.abs_path?s[e.abs_path]=e.debug_id:e.filename&&(s[e.filename]=e.debug_id),delete e.debug_id)})}),0===Object.keys(s).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const a=e.debug_meta.images;Object.entries(s).forEach(([e,t])=>{a.push({type:"sourcemap",code_file:e,debug_id:t})})}(e),"number"==typeof l&&l>0?function(e,t,r){var s,a;if(!e)return null;const n={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(e=>({...e,...e.data&&{data:yd(e.data,t,r)}}))},...e.user&&{user:yd(e.user,t,r)},...e.contexts&&{contexts:yd(e.contexts,t,r)},...e.extra&&{extra:yd(e.extra,t,r)}};(null==(s=e.contexts)?void 0:s.trace)&&n.contexts&&(n.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(n.contexts.trace.data=yd(e.contexts.trace.data,t,r)));e.spans&&(n.spans=e.spans.map(e=>({...e,...e.data&&{data:yd(e.data,t,r)}})));(null==(a=e.contexts)?void 0:a.flags)&&n.contexts&&(n.contexts.flags=yd(e.contexts.flags,3,r));return n}(e,l,i):e))}function Hd(e,t){return qo().captureException(e,void 0)}function Vd(e,t){return qo().captureEvent(e,t)}function Kd(e){const t=Fo(),r=qo(),{userAgent:s}=ai.navigator||{},a=ko({user:r.getUser()||t.getUser(),...s&&{userAgent:s},...e}),n=t.getSession();return"ok"===(null==n?void 0:n.status)&&_o(n,{status:"exited"}),Jd(),t.setSession(a),a}function Jd(){const e=Fo(),t=qo().getSession()||e.getSession();t&&function(e){let t={};"ok"===e.status&&(t={status:"exited"}),_o(e,t)}(t),Yd(),e.setSession()}function Yd(){const e=Fo(),t=Oo(),r=e.getSession();r&&t&&t.captureSession(r)}function Gd(e=!1){e?Jd():Yd()}function Zd(e,t,r){return t||`${function(e){return`${function(e){const t=e.protocol?`${e.protocol}:`:"",r=e.port?`:${e.port}`:"";return`${t}//${e.host}${r}${e.path?`/${e.path}`:""}/api/`}(e)}${e.projectId}/envelope/`}(e)}?${function(e,t){const r={sentry_version:"7"};return e.publicKey&&(r.sentry_key=e.publicKey),t&&(r.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(r).toString()}(e,r)}`}const Xd=[];function Qd(e){const t=e.defaultIntegrations||[],r=e.integrations;let s;if(t.forEach(e=>{e.isDefaultInstance=!0}),Array.isArray(r))s=[...t,...r];else if("function"==typeof r){const e=r(t);s=Array.isArray(e)?e:[e]}else s=t;return function(e){const t={};return e.forEach(e=>{const{name:r}=e,s=t[r];s&&!s.isDefaultInstance&&e.isDefaultInstance||(t[r]=e)}),Object.values(t)}(s)}function ec(e,t){for(const r of t)(null==r?void 0:r.afterAllSetup)&&r.afterAllSetup(e)}function tc(e,t,r){if(r[t.name])si&&hi.log(`Integration skipped because it was already installed: ${t.name}`);else{if(r[t.name]=t,Xd.includes(t.name)||"function"!=typeof t.setupOnce||(t.setupOnce(),Xd.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const r=t.preprocessEvent.bind(t);e.on("preprocessEvent",(t,s)=>r(t,s,e))}if("function"==typeof t.processEvent){const r=t.processEvent.bind(t),s=Object.assign((t,s)=>r(t,s,e),{id:t.name});e.addEventProcessor(s)}si&&hi.log(`Integration installed: ${t.name}`)}}function rc(e,t){const r=t??function(e){return sc().get(e)}(e)??[];if(0===r.length)return;const s=e.getOptions(),a=function(e,t,r,s){const a={};return(null==t?void 0:t.sdk)&&(a.sdk={name:t.sdk.name,version:t.sdk.version}),r&&s&&(a.dsn=Xo(s)),jd(a,[(n=e,[{type:"log",item_count:n.length,content_type:"application/vnd.sentry.items.log+json"},{items:n}])]);var n}(r,s._metadata,s.tunnel,e.getDsn());sc().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(a)}function sc(){return oi("clientToLogBufferMap",()=>new WeakMap)}function ac(e,t){const r=t??function(e){return nc().get(e)}(e)??[];if(0===r.length)return;const s=e.getOptions(),a=function(e,t,r,s){const a={};return(null==t?void 0:t.sdk)&&(a.sdk={name:t.sdk.name,version:t.sdk.version}),r&&s&&(a.dsn=Xo(s)),jd(a,[(n=e,[{type:"trace_metric",item_count:n.length,content_type:"application/vnd.sentry.items.trace-metric+json"},{items:n}])]);var n}(r,s._metadata,s.tunnel,e.getDsn());nc().set(e,[]),e.emit("flushMetrics"),e.sendEnvelope(a)}function nc(){return oi("clientToMetricBufferMap",()=>new WeakMap)}const lc=Symbol.for("SentryBufferFullError");function ic(e=100){const t=new Set;function r(e){t.delete(e)}return{get $(){return Array.from(t)},add:function(s){if(!(t.size<e))return Rd(lc);const a=s();return t.add(a),a.then(()=>r(a),()=>r(a)),a},drain:function(e){if(!t.size)return Td(!0);const r=Promise.allSettled(Array.from(t)).then(()=>!0);if(!e)return r;const s=[r,new Promise(t=>setTimeout(()=>t(!1),e))];return Promise.race(s)}}}function oc(e,{statusCode:t,headers:r},s=co()){const a={...e},n=null==r?void 0:r["x-sentry-rate-limits"],l=null==r?void 0:r["retry-after"];if(n)for(const i of n.trim().split(",")){const[e,t,,,r]=i.split(":",5),n=parseInt(e,10),l=1e3*(isNaN(n)?60:n);if(t)for(const i of t.split(";"))"metric_bucket"===i&&r&&!r.split(";").includes("custom")||(a[i]=s+l);else a.all=s+l}else l?a.all=s+function(e,t=co()){const r=parseInt(`${e}`,10);if(!isNaN(r))return 1e3*r;const s=Date.parse(`${e}`);return isNaN(s)?6e4:s-t}(l,s):429===t&&(a.all=s+6e4);return a}function dc(e,t,r=ic(e.bufferSize||64)){let s={};return{send:function(a){const n=[];if(Nd(a,(t,r)=>{const a=Ed(r);!function(e,t,r=co()){return function(e,t){return e[t]||e.all||0}(e,t)>r}(s,a)?n.push(t):e.recordDroppedEvent("ratelimit_backoff",a)}),0===n.length)return Promise.resolve({});const l=jd(a[0],n),i=t=>{!function(e,t){return Nd(e,(e,r)=>t.includes(r))}(l,["client_report"])?Nd(l,(r,s)=>{e.recordDroppedEvent(t,Ed(s))}):si&&hi.warn(`Dropping client report. Will not send outcomes (reason: ${t}).`)};return r.add(()=>t({body:_d(l)}).then(e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&si&&hi.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),s=oc(s,e),e),e=>{throw i("network_error"),si&&hi.error("Encountered error running transport request:",e),e})).then(e=>e,e=>{if(e===lc)return si&&hi.error("Skipped sending event because buffer is full."),i("queue_overflow"),Promise.resolve({});throw e})},flush:e=>r.drain(e)}}function cc(e){const t=[];e.message&&t.push(e.message);try{const r=e.exception.values[e.exception.values.length-1];(null==r?void 0:r.value)&&(t.push(r.value),r.type&&t.push(`${r.type}: ${r.value}`))}catch{}return t}const uc="Not capturing exception because it's already been captured.",xc="Discarded session because of missing or non-string release",mc=Symbol.for("SentryInternalError"),gc=Symbol.for("SentryDoNotSendEventError");function hc(e){return{message:e,[mc]:!0}}function pc(e){return{message:e,[gc]:!0}}function bc(e){return!!e&&"object"==typeof e&&mc in e}function yc(e){return!!e&&"object"==typeof e&&gc in e}function fc(e,t,r,s,a){let n,l=0,i=!1;e.on(r,()=>{l=0,clearTimeout(n),i=!1}),e.on(t,t=>{l+=s(t),l>=8e5?a(e):i||(i=!0,n=setTimeout(()=>{a(e)},5e3))}),e.on("flush",()=>{a(e)})}class vc{constructor(e){var t,r,s;if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],this._promiseBuffer=ic((null==(t=e.transportOptions)?void 0:t.bufferSize)??64),e.dsn?this._dsn=td(e.dsn):si&&hi.warn("No DSN provided, client will not send events."),this._dsn){const t=Zd(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}this._options.enableLogs=this._options.enableLogs??(null==(r=this._options._experiments)?void 0:r.enableLogs),this._options.enableLogs&&fc(this,"afterCaptureLog","flushLogs",_c,rc);(this._options.enableMetrics??(null==(s=this._options._experiments)?void 0:s.enableMetrics)??!0)&&fc(this,"afterCaptureMetric","flushMetrics",kc,ac)}captureException(e,t,r){const s=ho();if(vo(e))return si&&hi.log(uc),s;const a={event_id:s,...t};return this._process(()=>this.eventFromException(e,a).then(e=>this._captureEvent(e,a,r)).then(e=>e),"error"),a.event_id}captureMessage(e,t,r,s){const a={event_id:ho(),...r},n=Fi(e)?e:String(e),l=Oi(e),i=l?this.eventFromMessage(n,t,a):this.eventFromException(e,a);return this._process(()=>i.then(e=>this._captureEvent(e,a,s)),l?"unknown":"error"),a.event_id}captureEvent(e,t,r){const s=ho();if((null==t?void 0:t.originalException)&&vo(t.originalException))return si&&hi.log(uc),s;const a={event_id:s,...t},n=e.sdkProcessingMetadata||{},l=n.capturedSpanScope,i=n.capturedSpanIsolationScope,o=jc(e.type);return this._process(()=>this._captureEvent(e,a,l||r,i),o),a.event_id}captureSession(e){this.sendSession(e),_o(e,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}async flush(e){const t=this._transport;if(!t)return!0;this.emit("flush");const r=await this._isClientDoneProcessing(e),s=await t.flush(e);return r&&s}async close(e){const t=await this.flush(e);return this.getOptions().enabled=!1,this.emit("close"),t}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];tc(this,e,this._integrations),t||ec(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let r=Md(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of t.attachments||[])r=wd(r,Sd(s));this.sendEnvelope(r).then(t=>this.emit("afterSendEvent",e,t))}sendSession(e){const{release:t,environment:r=hd}=this._options;if("aggregates"in e){const s=e.attrs||{};if(!s.release&&!t)return void(si&&hi.warn(xc));s.release=s.release||t,s.environment=s.environment||r,e.attrs=s}else{if(!e.release&&!t)return void(si&&hi.warn(xc));e.release=e.release||t,e.environment=e.environment||r}this.emit("beforeSendSession",e);const s=function(e,t,r,s){const a=Dd(r);return jd({sent_at:(new Date).toISOString(),...a&&{sdk:a},...!!s&&t&&{dsn:Xo(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(s)}recordDroppedEvent(e,t,r=1){if(this._options.sendClientReports){const s=`${e}:${t}`;si&&hi.log(`Recording outcome: "${s}"${r>1?` (${r} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+r}}on(e,t){const r=this._hooks[e]=this._hooks[e]||new Set,s=(...e)=>t(...e);return r.add(s),()=>{r.delete(s)}}emit(e,...t){const r=this._hooks[e];r&&r.forEach(e=>e(...t))}async sendEnvelope(e){if(this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport)try{return await this._transport.send(e)}catch(t){return si&&hi.error("Error while sending envelope:",t),{}}return si&&hi.error("Transport disabled"),{}}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(e,t){const r={};return t.forEach(t=>{t&&tc(e,t,r)}),r}(this,e),ec(this,e)}_updateSessionFromEvent(e,t){var r,s;let a="fatal"===t.level,n=!1;const l=null==(r=t.exception)?void 0:r.values;if(l){n=!0,a=!1;for(const e of l)if(!1===(null==(s=e.mechanism)?void 0:s.handled)){a=!0;break}}const i="ok"===e.status;(i&&0===e.errors||i&&a)&&(_o(e,{...a&&{status:"crashed"},errors:e.errors||Number(n||a)}),this.captureSession(e))}async _isClientDoneProcessing(e){let t=0;for(;!e||t<e;){if(await new Promise(e=>setTimeout(e,1)),!this._numProcessing)return!0;t++}return!1}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,r,s){const a=this.getOptions(),n=Object.keys(this._integrations);return!t.integrations&&(null==n?void 0:n.length)&&(t.integrations=n),this.emit("preprocessEvent",e,t),e.type||s.setLastEventId(e.event_id||t.event_id),Ud(a,e,t,r,this,s).then(e=>{if(null===e)return e;this.emit("postprocessEvent",e,t),e.contexts={trace:Wo(r),...e.contexts};const s=function(e,t){const r=t.getPropagationContext();return r.dsc||pd(r.traceId,e)}(this,r);return e.sdkProcessingMetadata={dynamicSamplingContext:s,...e.sdkProcessingMetadata},e})}_captureEvent(e,t={},r=qo(),s=Fo()){return si&&wc(e)&&hi.log(`Captured error event \`${cc(e)[0]||"<unknown>"}\``),this._processEvent(e,t,r,s).then(e=>e.event_id,e=>{si&&(yc(e)?hi.log(e.message):bc(e)?hi.warn(e.message):hi.warn(e))})}_processEvent(e,t,r,s){const a=this.getOptions(),{sampleRate:n}=a,l=Nc(e),i=wc(e),o=`before send for type \`${e.type||"error"}\``,d=void 0===n?void 0:function(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;return"number"!=typeof t||isNaN(t)||t<0||t>1?void 0:t}(n);if(i&&"number"==typeof d&&oo()>d)return this.recordDroppedEvent("sample_rate","error"),Rd(pc(`Discarding event because it's not included in the random sample (sampling rate = ${n})`));const c=jc(e.type);return this._prepareEvent(e,t,r,s).then(e=>{if(null===e)throw this.recordDroppedEvent("event_processor",c),pc("An event processor returned `null`, will not send event.");if(t.data&&!0===t.data.__sentry__)return e;const r=function(e,t,r,s){const{beforeSend:a,beforeSendTransaction:n,beforeSendSpan:l,ignoreSpans:i}=t;let o=r;if(wc(o)&&a)return a(o,s);if(Nc(o)){if(l||i){const t=function(e){var t;const{trace_id:r,parent_span_id:s,span_id:a,status:n,origin:l,data:i,op:o}=(null==(t=e.contexts)?void 0:t.trace)??{};return{data:i??{},description:e.transaction,op:o,parent_span_id:s,span_id:a??"",start_timestamp:e.start_timestamp??0,status:n,timestamp:e.timestamp,trace_id:r??"",origin:l,profile_id:null==i?void 0:i[Bo],exclusive_time:null==i?void 0:i[Uo],measurements:e.measurements,is_segment:!0}}(o);if((null==i?void 0:i.length)&&xd(t,i))return null;if(l){const e=l(t);e?o=So(r,{type:"transaction",timestamp:(d=e).timestamp,start_timestamp:d.start_timestamp,transaction:d.description,contexts:{trace:{trace_id:d.trace_id,span_id:d.span_id,parent_span_id:d.parent_span_id,op:d.op,status:d.status,origin:d.origin,data:{...d.data,...d.profile_id&&{[Bo]:d.profile_id},...d.exclusive_time&&{[Uo]:d.exclusive_time}}}},measurements:d.measurements}):cd()}if(o.spans){const t=[],r=o.spans;for(const e of r)if((null==i?void 0:i.length)&&xd(e,i))md(r,e);else if(l){const r=l(e);r?t.push(r):(cd(),t.push(e))}else t.push(e);const s=o.spans.length-t.length;s&&e.recordDroppedEvent("before_send","span",s),o.spans=t}}if(n){if(o.spans){const e=o.spans.length;o.sdkProcessingMetadata={...r.sdkProcessingMetadata,spanCountBeforeProcessing:e}}return n(o,s)}}var d;return o}(this,a,e,t);return function(e,t){const r=`${t} must return \`null\` or a valid event.`;if(Ui(e))return e.then(e=>{if(!Wi(e)&&null!==e)throw hc(r);return e},e=>{throw hc(`${t} rejected with ${e}`)});if(!Wi(e)&&null!==e)throw hc(r);return e}(r,o)}).then(a=>{var n;if(null===a){if(this.recordDroppedEvent("before_send",c),l){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw pc(`${o} returned \`null\`, will not send event.`)}const d=r.getSession()||s.getSession();if(i&&d&&this._updateSessionFromEvent(d,a),l){const e=((null==(n=a.sdkProcessingMetadata)?void 0:n.spanCountBeforeProcessing)||0)-(a.spans?a.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const u=a.transaction_info;if(l&&u&&a.transaction!==e.transaction){const e="custom";a.transaction_info={...u,source:e}}return this.sendEvent(a,t),a}).then(null,e=>{if(yc(e)||bc(e))throw e;throw this.captureException(e,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:e}),hc(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`)})}_process(e,t){this._numProcessing++,this._promiseBuffer.add(e).then(e=>(this._numProcessing--,e),e=>(this._numProcessing--,e===lc&&this.recordDroppedEvent("queue_overflow",t),e))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([e,t])=>{const[r,s]=e.split(":");return{reason:r,category:s,quantity:t}})}_flushOutcomes(){si&&hi.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(si&&hi.log("No outcomes to send"));if(!this._dsn)return void(si&&hi.log("No dsn provided, will not send outcomes"));si&&hi.log("Sending outcomes:",e);const t=(r=e,jd((s=this._options.tunnel&&Xo(this._dsn))?{dsn:s}:{},[[{type:"client_report"},{timestamp:jo(),discarded_events:r}]]));var r,s;this.sendEnvelope(t)}}function jc(e){return"replay_event"===e?"replay":e||"error"}function wc(e){return void 0===e.type}function Nc(e){return"transaction"===e.type}function kc(e){let t=0;return e.name&&(t+=2*e.name.length),t+=8,t+Sc(e.attributes)}function _c(e){let t=0;return e.message&&(t+=2*e.message.length),t+Sc(e.attributes)}function Sc(e){if(!e)return 0;let t=0;return Object.values(e).forEach(e=>{Array.isArray(e)?t+=e.length*Cc(e[0]):Oi(e)?t+=Cc(e):t+=100}),t}function Cc(e){return"string"==typeof e?2*e.length:"number"==typeof e?8:"boolean"==typeof e?4:0}function Ec(e){return function(e){return Ii(e)&&"__sentry_fetch_url_host__"in e&&"string"==typeof e.__sentry_fetch_url_host__}(e)?`${e.message} (${e.__sentry_fetch_url_host__})`:e.message}function Dc(e,t){!0===t.debug&&(si?hi.enable():ui(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")}));qo().update(t.initialScope);const r=new e(t);return function(e){qo().setClient(e)}(r),r.init(),r}function Mc(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const r=t[6]||"",s=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:r,hash:s,relative:t[5]+r+s}}function Tc(e){var t;"aggregates"in e?void 0===(null==(t=e.attrs)?void 0:t.ip_address)&&(e.attrs={...e.attrs,ip_address:"{{auto}}"}):void 0===e.ipAddress&&(e.ipAddress="{{auto}}")}function Rc(e,t,r=[t],s="npm"){const a=e._metadata||{};a.sdk||(a.sdk={name:`sentry.javascript.${t}`,packages:r.map(e=>({name:`${s}:@sentry/${e}`,version:ni})),version:ni}),e._metadata=a}const $c=100;function Ac(e,t){const r=Oo(),s=Fo();if(!r)return;const{beforeBreadcrumb:a=null,maxBreadcrumbs:n=$c}=r.getOptions();if(n<=0)return;const l={timestamp:jo(),...e},i=a?ui(()=>a(l,t)):l;null!==i&&(r.emit&&r.emit("beforeAddBreadcrumb",i,t),s.addBreadcrumb(i,n))}let Ic;const zc=new WeakMap,Pc=()=>({name:"FunctionToString",setupOnce(){Ic=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=to(this),r=zc.has(Oo())&&void 0!==t?t:this;return Ic.apply(r,e)}}catch{}},setup(e){zc.set(e,!0)}}),Lc=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],qc=(e={})=>{let t;return{name:"EventFilters",setup(r){const s=r.getOptions();t=Oc(e,s)},processEvent(r,s,a){if(!t){const r=a.getOptions();t=Oc(e,r)}return function(e,t){if(e.type){if("transaction"===e.type&&function(e,t){if(!(null==t?void 0:t.length))return!1;const r=e.transaction;return!!r&&go(r,t)}(e,t.ignoreTransactions))return si&&hi.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${bo(e)}`),!0}else{if(function(e,t){if(!(null==t?void 0:t.length))return!1;return cc(e).some(e=>go(e,t))}(e,t.ignoreErrors))return si&&hi.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${bo(e)}`),!0;if(function(e){var t,r;if(!(null==(r=null==(t=e.exception)?void 0:t.values)?void 0:r.length))return!1;return!e.message&&!e.exception.values.some(e=>e.stacktrace||e.type&&"Error"!==e.type||e.value)}(e))return si&&hi.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${bo(e)}`),!0;if(function(e,t){if(!(null==t?void 0:t.length))return!1;const r=Wc(e);return!!r&&go(r,t)}(e,t.denyUrls))return si&&hi.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${bo(e)}.\nUrl: ${Wc(e)}`),!0;if(!function(e,t){if(!(null==t?void 0:t.length))return!0;const r=Wc(e);return!r||go(r,t)}(e,t.allowUrls))return si&&hi.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${bo(e)}.\nUrl: ${Wc(e)}`),!0}return!1}(r,t)?null:r}}},Fc=(e={})=>({...qc(e),name:"InboundFilters"});function Oc(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:Lc],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function Wc(e){var t,r;try{const s=[...(null==(t=e.exception)?void 0:t.values)??[]].reverse().find(e=>{var t,r,s;return void 0===(null==(t=e.mechanism)?void 0:t.parent_id)&&(null==(s=null==(r=e.stacktrace)?void 0:r.frames)?void 0:s.length)}),a=null==(r=null==s?void 0:s.stacktrace)?void 0:r.frames;return a?function(e=[]){for(let t=e.length-1;t>=0;t--){const r=e[t];if(r&&"<anonymous>"!==r.filename&&"[native code]"!==r.filename)return r.filename||null}return null}(a):null}catch{return si&&hi.error(`Cannot extract url for event ${bo(e)}`),null}}function Bc(e,t,r,s,a,n){var l;if(!(null==(l=a.exception)?void 0:l.values)||!n||!Hi(n.originalException,Error))return;const i=a.exception.values.length>0?a.exception.values[a.exception.values.length-1]:void 0;i&&(a.exception.values=Uc(e,t,s,n.originalException,r,a.exception.values,i,0))}function Uc(e,t,r,s,a,n,l,i){if(n.length>=r+1)return n;let o=[...n];if(Hi(s[a],Error)){Hc(l,i);const n=e(t,s[a]),d=o.length;Vc(n,a,d,i),o=Uc(e,t,r,s[a],a,[n,...o],n,d)}return Array.isArray(s.errors)&&s.errors.forEach((s,n)=>{if(Hi(s,Error)){Hc(l,i);const d=e(t,s),c=o.length;Vc(d,`errors[${n}]`,c,i),o=Uc(e,t,r,s,a,[d,...o],d,c)}}),o}function Hc(e,t){e.mechanism={handled:!0,type:"auto.core.linked_errors",...e.mechanism,..."AggregateError"===e.type&&{is_exception_group:!0},exception_id:t}}function Vc(e,t,r,s){e.mechanism={handled:!0,...e.mechanism,type:"chained",source:t,exception_id:r,parent_id:s}}function Kc(){"console"in ai&&di.forEach(function(e){e in ai.console&&Xi(ai.console,e,function(t){return ci[e]=t,function(...t){Di("console",{args:t,level:e});const r=ci[e];null==r||r.apply(ai.console,t)}})})}function Jc(e){return"warn"===e?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const Yc=()=>{let e;return{name:"Dedupe",processEvent(t){if(t.type)return t;try{if(function(e,t){if(!t)return!1;if(function(e,t){const r=e.message,s=t.message;if(!r&&!s)return!1;if(r&&!s||!r&&s)return!1;if(r!==s)return!1;if(!Zc(e,t))return!1;if(!Gc(e,t))return!1;return!0}(e,t))return!0;if(function(e,t){const r=Xc(t),s=Xc(e);if(!r||!s)return!1;if(r.type!==s.type||r.value!==s.value)return!1;if(!Zc(e,t))return!1;if(!Gc(e,t))return!1;return!0}(e,t))return!0;return!1}(t,e))return si&&hi.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return e=t}}};function Gc(e,t){let r=Ni(e),s=Ni(t);if(!r&&!s)return!0;if(r&&!s||!r&&s)return!1;if(s.length!==r.length)return!1;for(let a=0;a<s.length;a++){const e=s[a],t=r[a];if(e.filename!==t.filename||e.lineno!==t.lineno||e.colno!==t.colno||e.function!==t.function)return!1}return!0}function Zc(e,t){let r=e.fingerprint,s=t.fingerprint;if(!r&&!s)return!0;if(r&&!s||!r&&s)return!1;try{return!(r.join("")!==s.join(""))}catch{return!1}}function Xc(e){var t,r;return null==(r=null==(t=e.exception)?void 0:t.values)?void 0:r[0]}function Qc(e){return void 0===e?void 0:e>=400&&e<500?"warning":e>=500?"error":void 0}const eu=ai;function tu(e){return e&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function ru(){var e;if("string"==typeof EdgeRuntime)return!0;if(!function(){if(!("fetch"in eu))return!1;try{return new Headers,new Request("data:,"),new Response,!0}catch{return!1}}())return!1;if(tu(eu.fetch))return!0;let t=!1;const r=eu.document;if(r&&"function"==typeof r.createElement)try{const s=r.createElement("iframe");s.hidden=!0,r.head.appendChild(s),(null==(e=s.contentWindow)?void 0:e.fetch)&&(t=tu(s.contentWindow.fetch)),r.head.removeChild(s)}catch(s){si&&hi.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",s)}return t}function su(e,t){const r="fetch";Ci(r,e),Ei(r,()=>function(e,t=!1){if(t&&!ru())return;Xi(ai,"fetch",function(e){return function(...t){const r=new Error,{method:s,url:a}=function(e){if(0===e.length)return{method:"GET",url:""};if(2===e.length){const[t,r]=e;return{url:nu(t),method:au(r,"method")?String(r.method).toUpperCase():Ki(t)&&au(t,"method")?String(t.method).toUpperCase():"GET"}}const t=e[0];return{url:nu(t),method:au(t,"method")?String(t.method).toUpperCase():"GET"}}(t),n={args:t,fetchData:{method:s,url:a},startTimestamp:1e3*No(),virtualError:r,headers:lu(t)};return Di("fetch",{...n}),e.apply(ai,t).then(async e=>(Di("fetch",{...n,endTimestamp:1e3*No(),response:e}),e),e=>{Di("fetch",{...n,endTimestamp:1e3*No(),error:e}),Ii(e)&&void 0===e.stack&&(e.stack=r.stack,Qi(e,"framesToPop",1));const t=Oo(),s=(null==t?void 0:t.getOptions().enhanceFetchErrorMessages)??"always";if(!1!==s&&e instanceof TypeError&&("Failed to fetch"===e.message||"Load failed"===e.message||"NetworkError when attempting to fetch resource."===e.message))try{const t=new URL(n.fetchData.url).host;"always"===s?e.message=`${e.message} (${t})`:Qi(e,"__sentry_fetch_url_host__",t)}catch{}throw e})}})}(0,t))}function au(e,t){return!!e&&"object"==typeof e&&!!e[t]}function nu(e){return"string"==typeof e?e:e?au(e,"url")?e.url:e.toString?e.toString():"":""}function lu(e){const[t,r]=e;try{if("object"==typeof r&&null!==r&&"headers"in r&&r.headers)return new Headers(r.headers);if(Ki(t))return new Headers(t.headers)}catch{}}const iu=ai;let ou=0;function du(){return ou>0}function cu(e,t={}){if("function"!=typeof e)return e;try{const t=e.__sentry_wrapped__;if(t)return"function"==typeof t?t:e;if(to(e))return e}catch{return e}const r=function(...r){try{const s=r.map(e=>cu(e,t));return e.apply(this,s)}catch(s){throw ou++,setTimeout(()=>{ou--}),function(...e){const t=Lo(li());if(2===e.length){const[r,s]=e;return r?t.withSetScope(r,s):t.withScope(s)}t.withScope(e[0])}(e=>{e.addEventProcessor(e=>(t.mechanism&&(yo(e,void 0),fo(e,t.mechanism)),e.extra={...e.extra,arguments:r},e)),Hd(s)}),s}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}catch{}eo(r,e),Qi(e,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>e.name})}catch{}return r}function uu(e,t){const r=gu(e,t),s={type:bu(t),value:yu(t)};return r.length&&(s.stacktrace={frames:r}),void 0===s.type&&""===s.value&&(s.value="Unrecoverable error caught"),s}function xu(e,t,r,s){const a=Oo(),n=null==a?void 0:a.getOptions().normalizeDepth,l=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const r=e[t];if(r instanceof Error)return r}return}(t),i={__serialized__:fd(t,n)};if(l)return{exception:{values:[uu(e,l)]},extra:i};const o={exception:{values:[{type:Bi(t)?t.constructor.name:s?"UnhandledRejection":"Error",value:ju(t,{isUnhandledRejection:s})}]},extra:i};if(r){const t=gu(e,r);t.length&&(o.exception.values[0].stacktrace={frames:t})}return o}function mu(e,t){return{exception:{values:[uu(e,t)]}}}function gu(e,t){const r=t.stacktrace||t.stack||"",s=function(e){if(e&&hu.test(e.message))return 1;return 0}(t),a=function(e){if("number"==typeof e.framesToPop)return e.framesToPop;return 0}(t);try{return e(r,s,a)}catch{}return[]}const hu=/Minified React error #\d+;/i;function pu(e){return"undefined"!=typeof WebAssembly&&void 0!==WebAssembly.Exception&&e instanceof WebAssembly.Exception}function bu(e){const t=null==e?void 0:e.name;if(!t&&pu(e)){return e.message&&Array.isArray(e.message)&&2==e.message.length?e.message[0]:"WebAssembly.Exception"}return t}function yu(e){const t=null==e?void 0:e.message;return pu(e)?Array.isArray(e.message)&&2==e.message.length?e.message[1]:"wasm exception":t?t.error&&"string"==typeof t.error.message?Ec(t.error):Ec(e):"No error message"}function fu(e,t,r,s,a){let n;if(Pi(t)&&t.error){return mu(e,t.error)}if(Li(t)||zi(t,"DOMException")){const a=t;if("stack"in t)n=mu(e,t);else{const t=a.name||(Li(a)?"DOMError":"DOMException"),l=a.message?`${t}: ${a.message}`:t;n=vu(e,l,r,s),yo(n,l)}return"code"in a&&(n.tags={...n.tags,"DOMException.code":`${a.code}`}),n}if(Ii(t))return mu(e,t);if(Wi(t)||Bi(t)){return n=xu(e,t,r,a),fo(n,{synthetic:!0}),n}return n=vu(e,t,r,s),yo(n,`${t}`),fo(n,{synthetic:!0}),n}function vu(e,t,r,s){const a={};if(s&&r){const s=gu(e,r);s.length&&(a.exception={values:[{value:t,stacktrace:{frames:s}}]}),fo(a,{synthetic:!0})}if(Fi(t)){const{__sentry_template_string__:e,__sentry_template_values__:r}=t;return a.logentry={message:e,params:r},a}return a.message=t,a}function ju(e,{isUnhandledRejection:t}){const r=function(e){const t=Object.keys(ro(e));return t.sort(),t[0]?t.join(", "):"[object has no keys]"}(e),s=t?"promise rejection":"exception";if(Pi(e))return`Event \`ErrorEvent\` captured as ${s} with message \`${e.message}\``;if(Bi(e)){return`Event \`${function(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}(e)}\` (type=${e.type}) captured as ${s}`}return`Object captured as ${s} with keys: ${r}`}class wu extends vc{constructor(e){var t;const r=function(e){var t;return{release:"string"==typeof __SENTRY_RELEASE__?__SENTRY_RELEASE__:null==(t=iu.SENTRY_RELEASE)?void 0:t.id,sendClientReports:!0,parentSpanIsAlwaysRootSpan:!0,...e}}(e);Rc(r,"browser",["browser"],iu.SENTRY_SDK_SOURCE||"npm"),(null==(t=r._metadata)?void 0:t.sdk)&&(r._metadata.sdk.settings={infer_ip:r.sendDefaultPii?"auto":"never",...r._metadata.sdk.settings}),super(r);const{sendDefaultPii:s,sendClientReports:a,enableLogs:n,_experiments:l,enableMetrics:i}=this._options,o=i??(null==l?void 0:l.enableMetrics)??!0;iu.document&&(a||n||o)&&iu.document.addEventListener("visibilitychange",()=>{"hidden"===iu.document.visibilityState&&(a&&this._flushOutcomes(),n&&rc(this),o&&ac(this))}),s&&this.on("beforeSendSession",Tc)}eventFromException(e,t){return function(e,t,r,s){const a=fu(e,t,(null==r?void 0:r.syntheticException)||void 0,s);return fo(a),a.level="error",(null==r?void 0:r.event_id)&&(a.event_id=r.event_id),Td(a)}(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",r){return function(e,t,r="info",s,a){const n=vu(e,t,(null==s?void 0:s.syntheticException)||void 0,a);return n.level=r,(null==s?void 0:s.event_id)&&(n.event_id=s.event_id),Td(n)}(this._options.stackParser,e,t,r,this._options.attachStacktrace)}_prepareEvent(e,t,r,s){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,r,s)}}const Nu="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,ku=ai;let _u,Su,Cu,Eu;function Du(){if(!ku.document)return;const e=Di.bind(null,"dom"),t=Mu(e,!0);ku.document.addEventListener("click",t,!1),ku.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach(t=>{var r,s;const a=null==(r=ku[t])?void 0:r.prototype;(null==(s=null==a?void 0:a.hasOwnProperty)?void 0:s.call(a,"addEventListener"))&&(Xi(a,"addEventListener",function(t){return function(r,s,a){if("click"===r||"keypress"==r)try{const s=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},n=s[r]=s[r]||{refCount:0};if(!n.handler){const s=Mu(e);n.handler=s,t.call(this,r,s,a)}n.refCount++}catch{}return t.call(this,r,s,a)}}),Xi(a,"removeEventListener",function(e){return function(t,r,s){if("click"===t||"keypress"==t)try{const r=this.__sentry_instrumentation_handlers__||{},a=r[t];a&&(a.refCount--,a.refCount<=0&&(e.call(this,t,a.handler,s),a.handler=void 0,delete r[t]),0===Object.keys(r).length&&delete this.__sentry_instrumentation_handlers__)}catch{}return e.call(this,t,r,s)}}))})}function Mu(e,t=!1){return r=>{if(!r||r._sentryCaptured)return;const s=function(e){try{return e.target}catch{return null}}(r);if(function(e,t){return"keypress"===e&&(!(null==t?void 0:t.tagName)||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable)}(r.type,s))return;Qi(r,"_sentryCaptured",!0),s&&!s._sentryId&&Qi(s,"_sentryId",ho());const a="keypress"===r.type?"input":r.type;if(!function(e){if(e.type!==Su)return!1;try{if(!e.target||e.target._sentryId!==Cu)return!1}catch{}return!0}(r)){e({event:r,name:a,global:t}),Su=r.type,Cu=s?s._sentryId:void 0}clearTimeout(_u),_u=ku.setTimeout(()=>{Cu=void 0,Su=void 0},1e3)}}function Tu(e){const t="history";Ci(t,e),Ei(t,Ru)}function Ru(){function e(e){return function(...t){const r=t.length>2?t[2]:void 0;if(r){const s=Eu,a=function(e){try{return new URL(e,ku.location.origin).toString()}catch{return e}}(String(r));if(Eu=a,s===a)return e.apply(this,t);Di("history",{from:s,to:a})}return e.apply(this,t)}}ku.addEventListener("popstate",()=>{const e=ku.location.href,t=Eu;if(Eu=e,t===e)return;Di("history",{from:t,to:e})}),"history"in eu&&eu.history&&(Xi(ku.history,"pushState",e),Xi(ku.history,"replaceState",e))}const $u={};const Au="__sentry_xhr_v3__";function Iu(){if(!ku.XMLHttpRequest)return;const e=XMLHttpRequest.prototype;e.open=new Proxy(e.open,{apply(e,t,r){const s=new Error,a=1e3*No(),n=qi(r[0])?r[0].toUpperCase():void 0,l=function(e){if(qi(e))return e;try{return e.toString()}catch{}return}(r[1]);if(!n||!l)return e.apply(t,r);t[Au]={method:n,url:l,request_headers:{}},"POST"===n&&l.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const i=()=>{const e=t[Au];if(e&&4===t.readyState){try{e.status_code=t.status}catch{}Di("xhr",{endTimestamp:1e3*No(),startTimestamp:a,xhr:t,virtualError:s})}};return"onreadystatechange"in t&&"function"==typeof t.onreadystatechange?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply:(e,t,r)=>(i(),e.apply(t,r))}):t.addEventListener("readystatechange",i),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(e,t,r){const[s,a]=r,n=t[Au];return n&&qi(s)&&qi(a)&&(n.request_headers[s.toLowerCase()]=a),e.apply(t,r)}}),e.apply(t,r)}}),e.send=new Proxy(e.send,{apply(e,t,r){const s=t[Au];if(!s)return e.apply(t,r);void 0!==r[0]&&(s.body=r[0]);return Di("xhr",{startTimestamp:1e3*No(),xhr:t}),e.apply(t,r)}})}function zu(e,t=function(e){const t=$u[e];if(t)return t;let r=ku[e];if(tu(r))return $u[e]=r.bind(ku);const s=ku.document;if(s&&"function"==typeof s.createElement)try{const t=s.createElement("iframe");t.hidden=!0,s.head.appendChild(t);const a=t.contentWindow;(null==a?void 0:a[e])&&(r=a[e]),s.head.removeChild(t)}catch(a){Nu&&hi.warn(`Could not create sandbox iframe for ${e} check, bailing to window.${e}: `,a)}return r?$u[e]=r.bind(ku):r}("fetch")){let r=0,s=0;return dc(e,async function(a){const n=a.body.length;r+=n,s++;const l={body:a.body,method:"POST",referrerPolicy:"strict-origin",headers:e.headers,keepalive:r<=6e4&&s<15,...e.fetchOptions};try{const r=await t(e.url,l);return{statusCode:r.status,headers:{"x-sentry-rate-limits":r.headers.get("X-Sentry-Rate-Limits"),"retry-after":r.headers.get("Retry-After")}}}catch(i){throw $u["fetch"]=void 0,i}finally{r-=n,s--}},ic(e.bufferSize||40))}const Pu="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function Lu(e,t,r,s){const a={filename:e,function:"<anonymous>"===t?pi:t,in_app:!0};return void 0!==r&&(a.lineno=r),void 0!==s&&(a.colno=s),a}const qu=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Fu=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Ou=/\((\S*)(?::(\d+))(?::(\d+))\)/,Wu=/at (.+?) ?\(data:(.+?),/,Bu=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Uu=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Hu=fi(...[[30,e=>{const t=e.match(Wu);if(t)return{filename:`<data:${t[2]}>`,function:t[1]};const r=qu.exec(e);if(r){const[,e,t,s]=r;return Lu(e,pi,+t,+s)}const s=Fu.exec(e);if(s){if(s[2]&&0===s[2].indexOf("eval")){const e=Ou.exec(s[2]);e&&(s[2]=e[1],s[3]=e[2],s[4]=e[3])}const[e,t]=Vu(s[1]||pi,s[2]);return Lu(t,e,s[3]?+s[3]:void 0,s[4]?+s[4]:void 0)}}],[50,e=>{const t=Bu.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const e=Uu.exec(t[3]);e&&(t[1]=t[1]||"eval",t[3]=e[1],t[4]=e[2],t[5]="")}let e=t[3],r=t[1]||pi;return[r,e]=Vu(r,e),Lu(e,r,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}}]]),Vu=(e,t)=>{const r=-1!==e.indexOf("safari-extension"),s=-1!==e.indexOf("safari-web-extension");return r||s?[-1!==e.indexOf("@")?e.split("@")[0]:pi,r?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]},Ku=1024,Ju=(e={})=>{const t={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e};return{name:"Breadcrumbs",setup(e){var r;t.console&&function(e){const t="console";Ci(t,e),Ei(t,Kc)}(function(e){return function(t){if(Oo()!==e)return;const r={category:"console",data:{arguments:t.args,logger:"console"},level:Jc(t.level),message:xo(t.args," ")};if("assert"===t.level){if(!1!==t.args[0])return;r.message=`Assertion failed: ${xo(t.args.slice(1)," ")||"console.assert"}`,r.data.arguments=t.args.slice(1)}Ac(r,{input:t.args,level:t.level})}}(e)),t.dom&&(r=function(e,t){return function(r){if(Oo()!==e)return;let s,a,n="object"==typeof t?t.serializeAttribute:void 0,l="object"==typeof t&&"number"==typeof t.maxStringLength?t.maxStringLength:void 0;l&&l>Ku&&(Pu&&hi.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${l} was configured. Sentry will use 1024 instead.`),l=Ku),"string"==typeof n&&(n=[n]);try{const e=r.event,t=function(e){return!!e&&!!e.target}(e)?e.target:e;s=Yi(t,{keyAttrs:n,maxStringLength:l}),a=function(e){if(!Ji.HTMLElement)return null;let t=e;for(let r=0;r<5;r++){if(!t)return null;if(t instanceof HTMLElement){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}t=t.parentNode}return null}(t)}catch{s="<unknown>"}if(0===s.length)return;const i={category:`ui.${r.name}`,message:s};a&&(i.data={"ui.component_name":a}),Ac(i,{event:r.event,name:r.name,global:r.global})}}(e,t.dom),Ci("dom",r),Ei("dom",Du)),t.xhr&&function(e){Ci("xhr",e),Ei("xhr",Iu)}(function(e){return function(t){if(Oo()!==e)return;const{startTimestamp:r,endTimestamp:s}=t,a=t.xhr[Au];if(!r||!s||!a)return;const{method:n,url:l,status_code:i,body:o}=a,d={method:n,url:l,status_code:i},c={xhr:t.xhr,input:o,startTimestamp:r,endTimestamp:s},u={category:"xhr",data:d,type:"http",level:Qc(i)};e.emit("beforeOutgoingRequestBreadcrumb",u,c),Ac(u,c)}}(e)),t.fetch&&su(function(e){return function(t){if(Oo()!==e)return;const{startTimestamp:r,endTimestamp:s}=t;if(s&&(!t.fetchData.url.match(/sentry_key/)||"POST"!==t.fetchData.method))if(t.fetchData.method,t.fetchData.url,t.error){const a=t.fetchData,n={data:t.error,input:t.args,startTimestamp:r,endTimestamp:s},l={category:"fetch",data:a,level:"error",type:"http"};e.emit("beforeOutgoingRequestBreadcrumb",l,n),Ac(l,n)}else{const a=t.response,n={...t.fetchData,status_code:null==a?void 0:a.status};t.fetchData.request_body_size,t.fetchData.response_body_size,null==a||a.status;const l={input:t.args,response:a,startTimestamp:r,endTimestamp:s},i={category:"fetch",data:n,type:"http",level:Qc(n.status_code)};e.emit("beforeOutgoingRequestBreadcrumb",i,l),Ac(i,l)}}}(e)),t.history&&Tu(function(e){return function(t){if(Oo()!==e)return;let r=t.from,s=t.to;const a=Mc(iu.location.href);let n=r?Mc(r):void 0;const l=Mc(s);(null==n?void 0:n.path)||(n=a),a.protocol===l.protocol&&a.host===l.host&&(s=l.relative),a.protocol===n.protocol&&a.host===n.host&&(r=n.relative),Ac({category:"navigation",data:{from:r,to:s}})}}(e)),t.sentry&&e.on("beforeSendEvent",function(e){return function(t){Oo()===e&&Ac({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:bo(t)},{event:t})}}(e))}}};const Yu=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Gu=(e={})=>{const t={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,unregisterOriginalCallbacks:!1,...e};return{name:"BrowserApiErrors",setupOnce(){t.setTimeout&&Xi(iu,"setTimeout",Zu),t.setInterval&&Xi(iu,"setInterval",Zu),t.requestAnimationFrame&&Xi(iu,"requestAnimationFrame",Xu),t.XMLHttpRequest&&"XMLHttpRequest"in iu&&Xi(XMLHttpRequest.prototype,"send",Qu);const e=t.eventTarget;if(e){(Array.isArray(e)?e:Yu).forEach(e=>function(e,t){var r,s;const a=null==(r=iu[e])?void 0:r.prototype;if(!(null==(s=null==a?void 0:a.hasOwnProperty)?void 0:s.call(a,"addEventListener")))return;Xi(a,"addEventListener",function(r){return function(s,a,n){try{"function"==typeof a.handleEvent&&(a.handleEvent=cu(a.handleEvent,{mechanism:{data:{handler:wi(a),target:e},handled:!1,type:"auto.browser.browserapierrors.handleEvent"}}))}catch{}return t.unregisterOriginalCallbacks&&function(e,t,r){e&&"object"==typeof e&&"removeEventListener"in e&&"function"==typeof e.removeEventListener&&e.removeEventListener(t,r)}(this,s,a),r.apply(this,[s,cu(a,{mechanism:{data:{handler:wi(a),target:e},handled:!1,type:"auto.browser.browserapierrors.addEventListener"}}),n])}}),Xi(a,"removeEventListener",function(e){return function(t,r,s){try{const a=r.__sentry_wrapped__;a&&e.call(this,t,a,s)}catch{}return e.call(this,t,r,s)}})}(e,t))}}}};function Zu(e){return function(...t){const r=t[0];return t[0]=cu(r,{mechanism:{handled:!1,type:`auto.browser.browserapierrors.${wi(e)}`}}),e.apply(this,t)}}function Xu(e){return function(t){return e.apply(this,[cu(t,{mechanism:{data:{handler:wi(e)},handled:!1,type:"auto.browser.browserapierrors.requestAnimationFrame"}})])}}function Qu(e){return function(...t){const r=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(e=>{e in r&&"function"==typeof r[e]&&Xi(r,e,function(t){const r={mechanism:{data:{handler:wi(t)},handled:!1,type:`auto.browser.browserapierrors.xhr.${e}`}},s=to(t);return s&&(r.mechanism.data.handler=wi(s)),cu(t,r)})}),e.apply(this,t)}}const ex=()=>({name:"BrowserSession",setupOnce(){void 0!==iu.document?(Kd({ignoreDuration:!0}),Gd(),Tu(({from:e,to:t})=>{void 0!==e&&e!==t&&(Kd({ignoreDuration:!0}),Gd())})):Pu&&hi.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.")}}),tx=(e={})=>{const t={onerror:!0,onunhandledrejection:!0,...e};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(e){t.onerror&&(!function(e){!function(e){const t="error";Ci(t,e),Ei(t,Ti)}(t=>{const{stackParser:r,attachStacktrace:s}=sx();if(Oo()!==e||du())return;const{msg:a,url:n,line:l,column:i,error:o}=t,d=function(e,t,r,s){const a=e.exception=e.exception||{},n=a.values=a.values||[],l=n[0]=n[0]||{},i=l.stacktrace=l.stacktrace||{},o=i.frames=i.frames||[],d=s,c=r,u=function(e){if(!qi(e)||0===e.length)return;if(e.startsWith("data:")){const t=e.match(/^data:([^;]+)/);return`<data:${t?t[1]:"text/javascript"}${e.includes("base64,")?",base64":""}>`}return e}(t)??Zi();0===o.length&&o.push({colno:d,filename:u,function:pi,in_app:!0,lineno:c});return e}(fu(r,o||a,void 0,s,!1),n,l,i);d.level="error",Vd(d,{originalException:o,mechanism:{handled:!1,type:"auto.browser.global_handlers.onerror"}})})}(e),rx("onerror")),t.onunhandledrejection&&(!function(e){!function(e){const t="unhandledrejection";Ci(t,e),Ei(t,$i)}(t=>{const{stackParser:r,attachStacktrace:s}=sx();if(Oo()!==e||du())return;const a=function(e){if(Oi(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch{}return e}(t),n=Oi(a)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(a)}`}]}}:fu(r,a,void 0,s,!0);n.level="error",Vd(n,{originalException:a,mechanism:{handled:!1,type:"auto.browser.global_handlers.onunhandledrejection"}})})}(e),rx("onunhandledrejection"))}}};function rx(e){Pu&&hi.log(`Global Handler attached: ${e}`)}function sx(){const e=Oo();return(null==e?void 0:e.getOptions())||{stackParser:()=>[],attachStacktrace:!1}}const ax=()=>({name:"HttpContext",preprocessEvent(e){var t;if(!iu.navigator&&!iu.location&&!iu.document)return;const r=function(){const e=Zi(),{referrer:t}=iu.document||{},{userAgent:r}=iu.navigator||{};return{url:e,headers:{...t&&{Referer:t},...r&&{"User-Agent":r}}}}(),s={...r.headers,...null==(t=e.request)?void 0:t.headers};e.request={...r,...e.request,headers:s}}}),nx=(e={})=>{const t=e.limit||5,r=e.key||"cause";return{name:"LinkedErrors",preprocessEvent(e,s,a){Bc(uu,a.getOptions().stackParser,r,t,e,s)}}};function lx(){return!!function(){var e;if(void 0===iu.window)return!1;const t=iu;if(t.nw)return!1;const r=t.chrome||t.browser;if(!(null==(e=null==r?void 0:r.runtime)?void 0:e.id))return!1;const s=Zi(),a=["chrome-extension","moz-extension","ms-browser-extension","safari-web-extension"];return!(iu===iu.top&&a.some(e=>s.startsWith(`${e}://`)))}()&&(Pu&&ui(()=>{console.error("[Sentry] You cannot use Sentry.init() in a browser extension, see: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")}),!0)}function ix(e={}){const t=!e.skipBrowserExtensionCheck&&lx();let r=null==e.defaultIntegrations?[Fc(),Pc(),Gu(),Ju(),tx(),nx(),Yc(),ax(),ex()]:e.defaultIntegrations;const s={...e,enabled:!t&&e.enabled,stackParser:(a=e.stackParser||Hu,Array.isArray(a)?fi(...a):a),integrations:Qd({integrations:e.integrations,defaultIntegrations:r}),transport:e.transport||zu};var a;return Dc(wu,s)}!function(e){const t={...e};var s,a;Rc(t,"react"),s="react",a={version:r.version},Fo().setContext(s,a),ix(t)}({dsn:"https://ef38d8a37ebc8c6e3960fbe47f15123b@o4510731847008256.ingest.us.sentry.io/4510731981881344",sendDefaultPii:!1}),console.log("ğŸš€ main.tsx is executing"),console.log("ğŸ“ Current URL:",window.location.href),console.log("ğŸ” Checking for root element...");const ox=document.getElementById("root");if(!ox)throw console.error("âŒ Root element not found!"),document.body.innerHTML='<div style="padding: 40px; font-family: sans-serif;"><h1>Error: Root element not found</h1><p>The #root div is missing from index.html</p></div>',new Error("Root element not found");console.log("âœ… Root element found, creating React root...");try{const e=M(ox);console.log("âœ… React root created, rendering App..."),e.render(T.jsx(r.StrictMode,{children:T.jsx(de,{children:T.jsx(ri,{})})})),console.log("âœ… App render initiated successfully")}catch(dx){Hd(dx),console.error("âŒ Error during React initialization:",dx),document.body.innerHTML=`<div style="padding: 40px; font-family: sans-serif;">\n    <h1>React Initialization Error</h1>\n    <pre>${String(dx)}</pre>\n  </div>`}export{St as $,fe as A,ke as B,Ue as C,He as D,De as E,et as F,Oe as G,at as H,Ze as I,ce as J,ye as K,ct as L,we as M,Vt as N,dl as O,Kt as P,Ft as Q,Lt as R,It as S,wl as T,rr as U,ut as V,st as W,ar as X,zt as Y,nr as Z,cr as _,Ee as a,tt as a0,zl as a1,Ll as a2,pt as a3,Tt as a4,er as a5,Rt as a6,Gr as a7,H as a8,ns as a9,Mt as aa,kt as ab,Ht as ac,Xe as ad,or as ae,ma as af,ie as ag,U as ah,Y as ai,G as aj,Qe as ak,Je as al,_t as am,Re as an,gt as ao,O as ap,un as aq,Ge as ar,Ae as as,fn as at,Xt as b,Zt as c,Pt as d,tr as e,Jn as f,Yn as g,Qn as h,Sl as i,T as j,pl as k,ml as l,kl as m,Lr as n,ss as o,Ut as p,Dt as q,Xs as r,z as s,Qs as t,ge as u,Me as v,Te as w,ot as x,ve as y,pe as z};
//# sourceMappingURL=index-BXAoWvaK.js.map

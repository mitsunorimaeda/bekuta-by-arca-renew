import{u as e,s as r,j as t,A as a,H as s,X as n,B as o,U as d,a as i,b as l,c as x,S as c,d as g,C as m,e as b,O as h,f as p,g as y,h as v,i as k,k as u,l as j,m as N,T as w,n as f,o as I}from"./index-DC548egD.js";import{r as z}from"./chart-vendor-DEPfNMx8.js";import"./supabase-vendor-BgrwFlS9.js";function C({user:C,alerts:S,organizationId:T,organizationName:A,onNavigateToPrivacy:D,onNavigateToTerms:E,onNavigateToCommercial:O,onNavigateToHelp:U}){const[_,F]=z.useState([]),[H,q]=z.useState("overview"),[B,G]=z.useState("invite"),[P,V]=z.useState("members"),[J,K]=z.useState("single"),[L,M]=z.useState(!0),[Q,R]=z.useState(!1),[W,X]=z.useState(!1),[Y,Z]=z.useState(!1),{isActive:$,shouldShowTutorial:ee,startTutorial:re,completeTutorial:te,skipTutorial:ae,currentStepIndex:se,setCurrentStepIndex:ne}=e();z.useEffect(()=>{ee()&&!L&&re()},[ee,re,L]);const oe=S.filter(e=>"high"===e.priority),de=S.filter(e=>"no_data"===e.type||"reminder"===e.type);z.useEffect(()=>{const e=localStorage.getItem("criticalAlertDismissed"),r=e?parseInt(e,10):0,t=Date.now(),a=18e5;r&&t-r<a?X(!0):r&&t-r>=a&&localStorage.removeItem("criticalAlertDismissed")},[]);z.useEffect(()=>{ie()},[T]);const ie=async()=>{try{const{data:e,error:t}=await r.from("teams").select("*").eq("organization_id",T).order("name");if(t)throw t;F(e||[])}catch(e){console.error("Error fetching teams:",e)}finally{M(!1)}};return L?t.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[t.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700 transition-colors sticky top-0 z-40",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex items-center justify-between py-3",children:[t.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"組織管理ダッシュボード"}),t.jsxs("div",{className:"flex items-center space-x-1",children:[oe.length>0&&t.jsxs("button",{onClick:()=>R(!0),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors relative",title:"アラート",children:[t.jsx(a,{className:"w-5 h-5"}),t.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),t.jsx("button",{onClick:re,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:"チュートリアル",children:t.jsx(s,{className:"w-5 h-5"})})]})]})})}),t.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:t.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[oe.length>0&&!W&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(a,{className:"w-6 h-6 text-red-600 dark:text-red-400 mr-3 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-semibold text-red-900 dark:text-red-100",children:"高リスクアラート"}),t.jsxs("p",{className:"text-sm text-red-700 dark:text-red-200",children:[oe.length,"件の注意が必要です"]})]}),t.jsx("button",{onClick:()=>{X(!0),localStorage.setItem("criticalAlertDismissed",Date.now().toString())},className:"ml-3 p-1 text-red-400 hover:text-red-600 transition-colors flex-shrink-0",title:"30分間非表示",children:t.jsx(n,{className:"w-5 h-5"})})]})}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[t.jsxs("div",{className:"flex items-center mb-6",children:[t.jsx(o,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 mr-3"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"組織概要"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1",children:S.length}),t.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"総アラート数"})]}),t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mb-1",children:oe.length}),t.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:"高優先度"})]}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-1",children:de.length}),t.jsx("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"システム通知"})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1",children:_.length}),t.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"登録チーム数"})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-8 transition-colors",children:[t.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:t.jsxs("nav",{className:"flex px-6 overflow-x-auto scrollbar-hide",children:[t.jsxs("button",{onClick:()=>q("overview"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("overview"===H?"border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(o,{className:"w-4 h-4"}),t.jsx("span",{children:"概要"})]}),t.jsxs("button",{onClick:()=>q("users"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("users"===H?"border-green-500 text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),"data-tutorial":"users-tab",children:[t.jsx(d,{className:"w-4 h-4"}),t.jsx("span",{children:"ユーザー管理"})]}),t.jsxs("button",{onClick:()=>q("organization"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("organization"===H?"border-orange-500 text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),"data-tutorial":"organization-tab",children:[t.jsx(i,{className:"w-4 h-4"}),t.jsx("span",{children:"組織管理"})]})]})}),("users"===H||"organization"===H)&&t.jsx("div",{className:"border-b border-gray-100 dark:border-gray-700/50 bg-gray-50 dark:bg-gray-800/50",children:t.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:["users"===H&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>G("invite"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("invite"===B?"border-green-500 text-green-700 dark:text-green-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(l,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"招待"})]}),t.jsxs("button",{onClick:()=>G("manage"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("manage"===B?"border-green-500 text-green-700 dark:text-green-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(x,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"管理"})]})]}),"organization"===H&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>V("members"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("members"===P?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(c,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"メンバー"})]}),t.jsxs("button",{onClick:()=>V("settings"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("settings"===P?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(g,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"設定"})]}),t.jsxs("button",{onClick:()=>V("subscription"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("subscription"===P?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(m,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"サブスクリプション"})]}),t.jsxs("button",{onClick:()=>V("transfers"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("transfers"===P?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(x,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"選手移籍"})]}),t.jsxs("button",{onClick:()=>V("team-access"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("team-access"===P?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsx(b,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"チームアクセス"})]})]})]})}),t.jsx("div",{className:"p-6",children:"overview"===H?t.jsx(h,{organizationId:T,organizationName:A}):"users"===H?t.jsx("div",{children:"invite"===B?t.jsxs("div",{children:[t.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:t.jsxs("nav",{className:"flex space-x-8",children:[t.jsx("button",{onClick:()=>K("single"),className:"py-3 px-1 border-b-2 font-medium text-sm "+("single"===J?"border-green-500 text-green-600 dark:text-green-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:"個別招待"}),t.jsx("button",{onClick:()=>K("bulk"),className:"py-3 px-1 border-b-2 font-medium text-sm "+("bulk"===J?"border-green-500 text-green-600 dark:text-green-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:"一括招待 (CSV)"})]})}),"single"===J?t.jsx("div",{"data-tutorial":"single-invite",children:t.jsx(p,{teams:_,onUserInvited:()=>{},restrictToOrganizationId:T,allowAdminInvite:!1})}):t.jsx("div",{"data-tutorial":"bulk-invite",children:t.jsx(y,{teams:_,onUsersInvited:()=>{},restrictToOrganizationId:T,allowAdminInvite:!1})})]}):"manage"===B?t.jsx("div",{"data-tutorial":"user-list",children:t.jsx(v,{teams:_,restrictToOrganizationId:T})}):null}):"organization"===H?t.jsx("div",{children:"members"===P?t.jsx(k,{organizationId:T,organizationName:A}):"settings"===P?t.jsx(u,{organizationId:T}):"subscription"===P?t.jsx(j,{organizationId:T,organizationName:A}):"transfers"===P?t.jsx(N,{userId:C.id,organizationId:T,isAdmin:isGlobalAdmin(C.role)}):"team-access"===P?t.jsx(w,{userId:C.id,organizationId:T,isAdmin:!0}):null}):null})]})]})}),t.jsx(f,{steps:I("global_admin"),isActive:$,onComplete:te,onSkip:ae,currentStepIndex:se,onStepChange:ne})]})}export{C as OrganizationAdminView};
//# sourceMappingURL=OrganizationAdminView-BLDffxYf.js.map

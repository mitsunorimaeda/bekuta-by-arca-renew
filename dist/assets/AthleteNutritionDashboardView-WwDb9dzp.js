import{j as e,X as Fe,L as de,p as Ce,q as $e,s as I,r as Ae,t as Pe,F as fe,v as Ee,w as Ke,x as De,y as Re}from"./index-C7IL5YWP.js";import{r as g}from"./chart-vendor-B8I3tXXj.js";import"./supabase-vendor-CRHRt2Ih.js";function O(a,t=0){const r=Number(a);return Number.isFinite(r)?r:t}function Oe(a,t){return a==="補食"?`補食${Number(t??1)}`:a}function ze({open:a,log:t,onClose:r,onSaved:l,onDeleted:u}){const[i,h]=g.useState(!1),[d,m]=g.useState(!1),[p,x]=g.useState(null),[o,y]=g.useState("0"),[_,s]=g.useState("0"),[N,P]=g.useState("0"),[E,S]=g.useState("0"),[G,J]=g.useState(""),[D,R]=g.useState(""),A=g.useMemo(()=>t?`${Oe(String(t.meal_type),t.meal_slot)} の編集`:"",[t]);if(g.useEffect(()=>{if(!a)return;const b=document.body.style.overflow,v=document.body.style.paddingRight,F=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",F>0&&(document.body.style.paddingRight=`${F}px`),()=>{document.body.style.overflow=b,document.body.style.paddingRight=v}},[a]),g.useEffect(()=>{if(!a)return;const b=v=>{v.key==="Escape"&&r()};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[a,r]),g.useEffect(()=>{if(!a||!t)return;x(null),y(String(O(t.total_calories,0))),s(String(O(t.p,0))),P(String(O(t.f,0))),S(String(O(t.c,0)));const v=(Array.isArray(t.menu_items)?t.menu_items:[]).map(F=>typeof F=="string"?F:(F==null?void 0:F.name)??(F==null?void 0:F.label)??"").filter(Boolean);J(v.join(`
`)),R(String(t.advice_markdown??""))},[a,t]),!a||!t)return null;const q=async()=>{h(!0),x(null);try{const b={total_calories:Math.max(0,Math.round(O(o,0))),p:Math.max(0,Number(O(_,0).toFixed(1))),f:Math.max(0,Number(O(N,0).toFixed(1))),c:Math.max(0,Number(O(E,0).toFixed(1))),menu_items:(G||"").split(`
`).map(T=>T.trim()).filter(Boolean),advice_markdown:D!=null&&D.trim()?D.trim():null,is_edited:!0,edit_meta:{updated_at:new Date().toISOString(),source:"nutrition_edit_modal"}},{data:v,error:F}=await I.from("nutrition_logs").update(b).eq("id",t.id).select("*").single();if(F)throw F;l(v),r()}catch(b){console.error("[NutritionEditModal] save error:",b),x(String((b==null?void 0:b.message)??b))}finally{h(!1)}},M=async()=>{if(window.confirm("この栄養記録を削除します。よろしいですか？")){m(!0),x(null);try{const{error:v}=await I.from("nutrition_logs").delete().eq("id",t.id);if(v)throw v;u(t.id),r()}catch(v){console.error("[NutritionEditModal] delete error:",v),x(String((v==null?void 0:v.message)??v))}finally{m(!1)}}};return e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/50",onClick:r,"aria-label":"閉じる",disabled:i||d}),e.jsxs("div",{className:`
          relative w-full max-w-2xl
          bg-white dark:bg-gray-900
          rounded-2xl shadow-2xl
          flex flex-col
          max-h-[calc(100vh-2rem)]
        `,role:"dialog","aria-modal":"true","aria-label":A,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex-none",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate",children:A}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.record_date," / status: ",t.analysis_status??"-",t.is_edited?"（編集済）":""]})]}),e.jsx("button",{type:"button",onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 flex-none","aria-label":"close",disabled:i||d,children:e.jsx(Fe,{className:"w-5 h-5 text-gray-700 dark:text-gray-200"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 overflow-y-auto",children:[p&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:p})}),t.image_url&&e.jsx("div",{className:"rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800",children:e.jsx("img",{src:t.image_url,alt:"meal",className:"w-full max-h-[320px] object-cover",loading:"eager",decoding:"async"})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"kcal"}),e.jsx("input",{value:o,onChange:b=>y(b.target.value),inputMode:"numeric",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:i||d})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"P (g)"}),e.jsx("input",{value:_,onChange:b=>s(b.target.value),inputMode:"decimal",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:i||d})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"F (g)"}),e.jsx("input",{value:N,onChange:b=>P(b.target.value),inputMode:"decimal",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:i||d})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"C (g)"}),e.jsx("input",{value:E,onChange:b=>S(b.target.value),inputMode:"decimal",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:i||d})]})]}),e.jsxs("label",{className:"space-y-1 block",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"推定メニュー（1行=1品）"}),e.jsx("textarea",{value:G,onChange:b=>J(b.target.value),rows:4,className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:i||d})]}),e.jsxs("label",{className:"space-y-1 block",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"メモ / AIコメント（編集OK）"}),e.jsx("textarea",{value:D,onChange:b=>R(b.target.value),rows:4,className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:i||d})]}),t.analysis_status==="failed"&&t.analysis_error&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-200 whitespace-pre-wrap",children:["解析失敗: ",String(t.analysis_error)]})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 px-4 sm:px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex-none",children:[e.jsxs("button",{type:"button",onClick:M,disabled:i||d,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-red-200 dark:border-red-800 text-red-600 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 disabled:opacity-60",children:[d?e.jsx(de,{className:"w-4 h-4 animate-spin"}):e.jsx(Ce,{className:"w-4 h-4"}),"削除"]}),e.jsxs("button",{type:"button",onClick:q,disabled:i||d,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:[i?e.jsx(de,{className:"w-4 h-4 animate-spin"}):e.jsx($e,{className:"w-4 h-4"}),"保存"]})]})]})]})}function ne(a,t=0){const r=Number(a);return Number.isFinite(r)?r:t}function ie(a,t,r){return Math.min(r,Math.max(t,a))}function Ie(a,t,r){const l=a*4,u=t*9,i=r*4,h=l+u+i;return{pK:l,fK:u,cK:i,total:h}}function Ue(a,t,r){const l=[{key:"p",v:ie(a,0,100)},{key:"f",v:ie(t,0,100)},{key:"c",v:ie(r,0,100)}],u=l.map(x=>({...x,floor:Math.floor(x.v),frac:x.v-Math.floor(x.v)}));let h=100-u.reduce((x,o)=>x+o.floor,0);u.sort((x,o)=>o.frac-x.frac);const d={p:0,f:0,c:0};for(let x=0;x<u.length&&h>0;x++)d[u[x].key]+=1,h-=1;const m={p:0,f:0,c:0};for(const x of l){const o=u.find(y=>y.key===x.key);m[x.key]=o.floor+d[x.key]}const p=m.p+m.f+m.c;if(p!==100){const x=["p","f","c"].reduce((o,y)=>m[y]>m[o]?y:o,"p");m[x]+=100-p}return m}function ge(a){return Math.round(a*10)/10}const H={p:{short:"P",long:"たんぱく質"},f:{short:"F",long:"脂質"},c:{short:"C",long:"炭水化物"}};function Be({totals:a,targets:t,title:r="PFCバランス"}){const[l,u]=g.useState(null),i=g.useMemo(()=>{const o=ne(a==null?void 0:a.p,0),y=ne(a==null?void 0:a.f,0),_=ne(a==null?void 0:a.c,0),s=Ie(o,y,_),N=s.total;if(!Number.isFinite(N)||N<=0)return{pG:o,fG:y,cG:_,now:s,totalK:0,pctInt:{p:0,f:0,c:0},pctFloat:{p:0,f:0,c:0}};const P=s.pK/N*100,E=s.fK/N*100,S=s.cK/N*100,G=Ue(P,E,S);return{pG:o,fG:y,cG:_,now:s,totalK:Math.round(N),pctInt:G,pctFloat:{p:P,f:E,c:S}}},[a]),h=i.totalK,d=g.useMemo(()=>{if(!l)return null;const o=l==="p"?i.pG:l==="f"?i.fG:i.cG,y=l==="p"?i.now.pK:l==="f"?i.now.fK:i.now.cK,_=i.pctInt[l]??0;return{g:o,k:y,pct:_,key:l}},[l,i]),m=o=>{u(y=>y===o?null:o)},p=o=>l?l===o?"opacity-100":"opacity-35":"opacity-100",x=h<=0;return e.jsxs("div",{className:"rounded-2xl bg-white dark:bg-gray-900 shadow-sm ring-1 ring-gray-200 dark:ring-gray-800 p-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:r}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["合計: ",e.jsx("span",{className:"font-bold tabular-nums",children:h})," kcal（P/F/C換算）"]})]}),x?e.jsx("div",{className:"mt-4 rounded-xl bg-gray-50 dark:bg-gray-800/60 p-4 text-sm text-gray-600 dark:text-gray-300",children:"まだ記録がありません（写真で食事を追加するとPFCバランスが表示されます）"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:block mt-3",children:[e.jsxs("div",{className:"h-10 rounded-xl bg-gray-200 dark:bg-gray-700 overflow-hidden flex",children:[e.jsx("button",{type:"button",onClick:()=>m("p"),className:`h-full bg-emerald-600 flex items-center justify-center px-2 ${p("p")}`,style:{width:`${i.pctInt.p}%`},title:`P（たんぱく質） ${i.pctInt.p}%`,children:e.jsxs("span",{className:"text-white font-semibold text-xs whitespace-nowrap drop-shadow",children:["P（たんぱく質） ",i.pctInt.p,"%"]})}),e.jsx("button",{type:"button",onClick:()=>m("f"),className:`h-full bg-orange-500 flex items-center justify-center px-2 ${p("f")}`,style:{width:`${i.pctInt.f}%`},title:`F（脂質） ${i.pctInt.f}%`,children:e.jsxs("span",{className:"text-white font-semibold text-xs whitespace-nowrap drop-shadow",children:["F（脂質） ",i.pctInt.f,"%"]})}),e.jsx("button",{type:"button",onClick:()=>m("c"),className:`h-full bg-blue-600 flex items-center justify-center px-2 ${p("c")}`,style:{width:`${i.pctInt.c}%`},title:`C（炭水化物） ${i.pctInt.c}%`,children:e.jsxs("span",{className:"text-white font-semibold text-xs whitespace-nowrap drop-shadow",children:["C（炭水化物） ",i.pctInt.c,"%"]})})]}),d&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300 tabular-nums",children:[H[d.key].short,"（",H[d.key].long,"）：",ge(d.g),"g / ",Math.round(d.k),"kcal（",d.pct,"%）"]})]}),e.jsx("div",{className:"sm:hidden mt-3",children:e.jsxs("div",{className:"relative rounded-2xl bg-gray-50 dark:bg-gray-800/60 p-3",children:[e.jsxs("div",{className:"relative mx-auto w-[260px] max-w-full",children:[e.jsxs("svg",{viewBox:"0 0 200 200",className:"block mx-auto w-[220px] h-[220px]",children:[e.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:"rgba(156,163,175,0.25)",strokeWidth:"28"}),(()=>{const o=2*Math.PI*70,y=[{key:"p",pct:i.pctInt.p,className:"stroke-emerald-600"},{key:"f",pct:i.pctInt.f,className:"stroke-orange-500"},{key:"c",pct:i.pctInt.c,className:"stroke-blue-600"}];let _=0;return y.map(s=>{const N=s.pct/100*o,P=`${N} ${o-N}`,E=_/100*o;return _+=s.pct,e.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",strokeWidth:"28",strokeLinecap:"butt",className:`${s.className} ${p(s.key)}`,strokeDasharray:P,strokeDashoffset:-E,transform:"rotate(-90 100 100)"},s.key)})})(),e.jsxs("text",{x:"100",y:"96",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",style:{fontSize:22,fontWeight:800},children:[h," kcal"]}),e.jsx("text",{x:"100",y:"118",textAnchor:"middle",className:"fill-gray-500 dark:fill-gray-300",style:{fontSize:12,fontWeight:700},children:"（P/F/C換算）"})]}),e.jsxs("button",{type:"button",onClick:()=>m("c"),className:`absolute left-0 top-2 rounded-2xl bg-white/90 dark:bg-gray-900/80 ring-1 ring-gray-200 dark:ring-gray-700 px-3 py-2 text-left shadow-sm ${l==="c"?"ring-2 ring-blue-500":""}`,children:[e.jsx("div",{className:"text-xs font-extrabold text-gray-900 dark:text-white",children:"C（炭水化物）"}),e.jsxs("div",{className:"text-2xl leading-none font-extrabold text-gray-900 dark:text-white tabular-nums",children:[i.pctInt.c,"%"]})]}),e.jsxs("button",{type:"button",onClick:()=>m("p"),className:`absolute right-0 top-6 rounded-2xl bg-white/90 dark:bg-gray-900/80 ring-1 ring-gray-200 dark:ring-gray-700 px-3 py-2 text-left shadow-sm ${l==="p"?"ring-2 ring-emerald-500":""}`,children:[e.jsx("div",{className:"text-xs font-extrabold text-gray-900 dark:text-white",children:"P（たんぱく質）"}),e.jsxs("div",{className:"text-2xl leading-none font-extrabold text-gray-900 dark:text-white tabular-nums",children:[i.pctInt.p,"%"]})]}),e.jsxs("button",{type:"button",onClick:()=>m("f"),className:`absolute left-0 bottom-4 rounded-2xl bg-white/90 dark:bg-gray-900/80 ring-1 ring-gray-200 dark:ring-gray-700 px-3 py-2 text-left shadow-sm ${l==="f"?"ring-2 ring-orange-400":""}`,children:[e.jsx("div",{className:"text-xs font-extrabold text-gray-900 dark:text-white",children:"F（脂質）"}),e.jsxs("div",{className:"text-2xl leading-none font-extrabold text-gray-900 dark:text-white tabular-nums",children:[i.pctInt.f,"%"]})]})]}),d&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300 tabular-nums text-center",children:[H[d.key].short,"（",H[d.key].long,"）：",ge(d.g),"g / ",Math.round(d.k),"kcal（",d.pct,"%）"]})]})})]})]})}function z(a,t=0){const r=Number(a);return Number.isFinite(r)?r:t}function Ge(a,t,r){return Math.min(r,Math.max(t,a))}function qe(a,t){return!Number.isFinite(t)||t<=0?0:Ge(a/t*100,0,100)}function le(a){return Math.round(a*10)/10}function ye(a,t){return!Number.isFinite(t)||t<=0?null:Math.max(0,t-a)}function be({now:a,goal:t}){const r=qe(a,t);return e.jsx("div",{className:"mt-2 h-2.5 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gray-400 dark:bg-gray-300",style:{width:`${r}%`}})})}function ce({label:a,unit:t,now:r,goal:l}){const u=ye(r,l);return e.jsxs("div",{className:"rounded-xl bg-gray-50 dark:bg-gray-800/60 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a}),e.jsx("div",{className:"text-xs font-semibold text-emerald-600 dark:text-emerald-400",children:u!=null?`あと${le(u)}${t}`:""})]}),e.jsxs("div",{className:"mt-1.5 flex items-baseline gap-2",children:[e.jsx("div",{className:"text-2xl font-extrabold tabular-nums text-gray-900 dark:text-white",children:le(r)}),e.jsxs("div",{className:"text-sm font-bold text-gray-600 dark:text-gray-300 tabular-nums",children:["/ ",le(l),t]})]}),e.jsx(be,{now:r,goal:l})]})}function Te({dateLabel:a,totals:t,targets:r,loading:l=!1,bmrKcal:u=null,tdeeKcal:i=null,onPrimaryAction:h,primaryLabel:d="食事を記録"}){const m=g.useMemo(()=>({cal:z(t==null?void 0:t.cal,0),p:z(t==null?void 0:t.p,0),f:z(t==null?void 0:t.f,0),c:z(t==null?void 0:t.c,0)}),[t]),p=g.useMemo(()=>r?{cal:z(r==null?void 0:r.cal,0),p:z(r==null?void 0:r.p,0),f:z(r==null?void 0:r.f,0),c:z(r==null?void 0:r.c,0)}:null,[r]),x=p?ye(m.cal,p.cal):null;return e.jsxs("div",{className:"rounded-2xl bg-white dark:bg-gray-900 shadow-sm ring-1 ring-gray-200 dark:ring-gray-800",children:[e.jsx("div",{className:"px-4 sm:px-5 pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"栄養サマリー"}),a&&e.jsx("div",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:a})]}),e.jsxs("div",{className:"text-right text-[11px] leading-snug text-gray-500 dark:text-gray-400",children:[u!=null&&e.jsxs("div",{children:["推定BMR: ",Math.round(u),"kcal"]}),i!=null&&e.jsxs("div",{children:["今日必要: ",Math.round(i),"kcal"]})]})]})}),e.jsx("div",{className:"px-4 sm:px-5 pb-4 sm:pb-5",children:l?e.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"読み込み中…"}):p?e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"rounded-2xl bg-gray-50 dark:bg-gray-800/60 px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"カロリー"}),e.jsx("div",{className:"text-xs font-semibold text-emerald-600 dark:text-emerald-400",children:x!=null?`あと${Math.round(x)}kcal`:""})]}),e.jsxs("div",{className:"mt-2 flex items-baseline justify-center gap-2",children:[e.jsx("div",{className:"text-5xl font-extrabold tabular-nums text-gray-900 dark:text-white",children:Math.round(m.cal)}),e.jsxs("div",{className:"text-xl font-bold text-gray-600 dark:text-gray-300 tabular-nums",children:["/ ",Math.round(p.cal),"kcal"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(be,{now:m.cal,goal:p.cal})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(ce,{label:"たんぱく質",unit:"g",now:m.p,goal:p.p}),e.jsx(ce,{label:"脂質",unit:"g",now:m.f,goal:p.f}),e.jsx(ce,{label:"炭水化物",unit:"g",now:m.c,goal:p.c})]}),e.jsx("div",{className:"gap-3 mt-4",children:e.jsx(Be,{totals:{p:m.p,f:m.f,c:m.c},targets:p?{p:p.p,f:p.f,c:p.c}:null})}),h&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",onClick:h,className:"inline-flex items-center justify-center px-5 py-2.5 rounded-full bg-emerald-600 text-white font-bold text-sm hover:bg-emerald-500 transition",children:d})})]}):e.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"目標値の表示には体重データが必要です"})})]})}function c(a,t=0){const r=Number(a);return Number.isFinite(r)?r:t}function We(a,t,r){return Math.min(r,Math.max(t,a))}function Le(a,t){return a==="補食"?`補食${Number(t??1)}`:a}function Je(a){return a?a==="male"?"male":a==="female"?"female":null:null}function Ve(a){if(!a)return null;const t=new Date(a);if(Number.isNaN(t.getTime()))return null;const r=new Date;let l=r.getFullYear()-t.getFullYear();const u=r.getMonth()-t.getMonth();return(u<0||u===0&&r.getDate()<t.getDate())&&(l-=1),l>=0?l:null}function Ye(a,t){return a==="補食"?We(c(t,1),1,2):1}async function Qe(a){return new Promise((t,r)=>{const l=new FileReader;l.onload=()=>{const u=l.result;t(u.split(",")[1]??"")},l.onerror=r,l.readAsDataURL(a)})}function pe(a){if(!a)return null;if(typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a))return a;const t=new Date(a);if(Number.isNaN(t.getTime()))return null;const r=t.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}).split("/");return`${r[0]}-${String(r[1]).padStart(2,"0")}-${String(r[2]).padStart(2,"0")}`}function Xe(a){const t=(a==null?void 0:a.result)??(a==null?void 0:a.data)??a??{},r=(t==null?void 0:t.calories)??(t==null?void 0:t.total_calories)??(t==null?void 0:t.kcal),l=(t==null?void 0:t.protein)??(t==null?void 0:t.p),u=(t==null?void 0:t.fat)??(t==null?void 0:t.f),i=(t==null?void 0:t.carbs)??(t==null?void 0:t.c),h=Number(r),d=Number(l),m=Number(u),p=Number(i);if(!(Number.isFinite(h)&&h>=0&&Number.isFinite(d)&&d>=0&&Number.isFinite(m)&&m>=0&&Number.isFinite(p)&&p>=0)){const _=(t==null?void 0:t.error)??(t==null?void 0:t.message)??"Gemini返却に必須値（calories/protein/fat/carbs）が見つかりません",s=JSON.stringify({calories:r,protein:l,fat:u,carbs:i,keys:Object.keys(t??{})},null,2);throw new Error(`${_}
${s}`)}const o=(t==null?void 0:t.menu_items)??(t==null?void 0:t.menuItems)??[],y=(t==null?void 0:t.comment)??(t==null?void 0:t.advice_markdown)??(t==null?void 0:t.advice)??null;return{total_calories:Math.round(h),p:c(d,0),f:c(m,0),c:c(p,0),menu_items:Array.isArray(o)?o:[],advice_markdown:y!=null?String(y):null,raw:a}}function Ze(a){var i;const t=(a==null?void 0:a.code)??((i=a==null?void 0:a.details)==null?void 0:i.code),r=String((a==null?void 0:a.message)??""),l=String((a==null?void 0:a.details)??""),u=String((a==null?void 0:a.hint)??"");return t==="23505"||r.includes("nutrition_logs_user_date_meal_slot_unique")||l.includes("nutrition_logs_user_date_meal_slot_unique")||u.includes("nutrition_logs_user_date_meal_slot_unique")}function he(a,t){return`すでに「${a==="補食"?`補食${t}`:a}」は記録済みです。新規追加はできません。
「今日の記録」から開いて編集してください。`}function He(a,t){if(!t)return null;const r=c(a==null?void 0:a.cal,0),l=c(a==null?void 0:a.p,0),u=c(a==null?void 0:a.f,0),i=c(a==null?void 0:a.c,0);return[{key:"cal",label:"エネルギー",unit:"kcal",now:Math.round(r),goal:Math.round(c(t==null?void 0:t.cal,0)),remain:Math.round(c(t==null?void 0:t.cal,0))-Math.round(r)},{key:"p",label:"たんぱく質",unit:"g",now:Math.round(l*10)/10,goal:Math.round(c(t==null?void 0:t.p,0)*10)/10,remain:Math.round((c(t==null?void 0:t.p,0)-l)*10)/10},{key:"f",label:"脂質",unit:"g",now:Math.round(u*10)/10,goal:Math.round(c(t==null?void 0:t.f,0)*10)/10,remain:Math.round((c(t==null?void 0:t.f,0)-u)*10)/10},{key:"c",label:"炭水化物",unit:"g",now:Math.round(i*10)/10,goal:Math.round(c(t==null?void 0:t.c,0)*10)/10,remain:Math.round((c(t==null?void 0:t.c,0)-i)*10)/10}]}function et(a){var m,p,x,o;if(!a)return[];const t=Object.fromEntries(a.map(y=>[y.key,y])),r=Math.max(0,c((m=t.p)==null?void 0:m.remain,0)),l=Math.max(0,c((p=t.c)==null?void 0:p.remain,0)),u=Math.max(0,c((x=t.f)==null?void 0:x.remain,0)),i=Math.max(0,c((o=t.cal)==null?void 0:o.remain,0)),h=r>=15?"p":l>=40?"c":u>=10?"f":i>=300?"cal":r>0||l>0||u>0||i>0?"mix":"ok",d=r>=15&&l>=40;return h==="ok"?["今日はだいたいOK。水分・野菜・睡眠を整える","補食を入れるなら：ヨーグルト or 果物","明日に備えて：夕食で主食・主菜を欠かさない"]:d?["ご飯（中）＋鶏むね/ささみ（目安）","おにぎり2個＋ツナ/サバ缶（半分〜1缶）","うどん＋卵/納豆（タンパク質を足す）"]:h==="p"?["鶏むね・ささみ（目安）／脂質を抑えてPを足す","卵＋納豆（手軽にPを積む）","プロテイン1杯＋ヨーグルト（補食で埋める）"]:h==="c"?["おにぎり2個（まず主食で埋める）","ご飯＋汁物（消化しやすく）","バナナ＋ヨーグルト（補食でCを足す）"]:h==="f"?["ナッツひと握り（20g目安）","オリーブオイルを料理に小さじ1〜2追加","サバ缶（脂質もPも足せる）"]:["主食＋主菜＋果物（まず“セット”で増やす）","補食：おにぎり＋乳製品（簡単に底上げ）","夕食：丼もの/定食スタイルで“量”を確保"]}function tt(a){if(!a)return[];if(Array.isArray(a))return a;if(typeof a=="string")try{const t=JSON.parse(a);return Array.isArray(t)?t:[]}catch{return[]}if(typeof a=="object"){const t=Object.values(a);return Array.isArray(t)?t:[]}return[]}function at(a){if(!a)return"";if(typeof a=="string")return a;const t=(a==null?void 0:a.name)??"",r=a!=null&&a.note?`(${a.note})`:"",l=a!=null&&a.estimated_amount?` ${a.estimated_amount}`:"";return`${t}${r}${l}`.trim()||""}function rt({user:a,latestInbody:t,latestWeightKg:r,date:l,trainingRecords:u,badgeText:i="栄養(β)",nutritionLogs:h=[],nutritionTotals:d={cal:0,p:0,f:0,c:0},nutritionLoading:m=!1,nutritionError:p=null,onSaved:x}){const o=g.useRef(null),[y,_]=g.useState(!1),[s,N]=g.useState(null),[P,E]=g.useState(null),[S,G]=g.useState("朝食"),[J,D]=g.useState(1),R=pe(l)??pe(new Date)??new Date().toISOString().slice(0,10),[A,q]=g.useState(Array.isArray(h)?h:[]);g.useEffect(()=>{q(Array.isArray(h)?h:[])},[h]);const M=g.useMemo(()=>{const n=(Array.isArray(A)?A:[]).reduce((k,j)=>(k.cal+=c(j==null?void 0:j.total_calories,0),k.p+=c(j==null?void 0:j.p,0),k.f+=c(j==null?void 0:j.f,0),k.c+=c(j==null?void 0:j.c,0),k),{cal:0,p:0,f:0,c:0});return m&&(!Array.isArray(A)||A.length===0)&&d?{cal:c(d.cal,0),p:c(d.p,0),f:c(d.f,0),c:c(d.c,0)}:n},[A,m,d]),[b,v]=g.useState(!1),[F,T]=g.useState(null);async function Ne(n){const{data:f,error:k}=await I.functions.invoke("nutrition-gemini",{body:n});if(k){const j=(k==null?void 0:k.message)??JSON.stringify(k);throw new Error(j||"nutrition-gemini invoke error")}return f}const oe=g.useMemo(()=>{const n=c(a==null?void 0:a.weight_kg,NaN),f=c((t==null?void 0:t.weight)??(t==null?void 0:t.weight_kg),NaN),k=c(r,NaN),j=Number.isFinite(f)?f:Number.isFinite(k)?k:Number.isFinite(n)?n:NaN,w=c(a==null?void 0:a.height_cm,NaN),U=Ve(a==null?void 0:a.date_of_birth),Q=Je(a==null?void 0:a.gender),W=c((t==null?void 0:t.body_fat_percent)??(t==null?void 0:t.body_fat_perc)??(t==null?void 0:t.body_fat_percent),NaN);if(!Number.isFinite(j)||j<=0)return{weightKg:null,targets:null,refs:null};const C=Ae({weightKg:j,bodyFatPercent:Number.isFinite(W)?W:null,heightCm:Number.isFinite(w)?w:null,age:Number.isFinite(Number(U))?Number(U):null,sex:Q??null,activityLevel:"moderate",goalType:"maintain"});return{weightKg:j,targets:(C==null?void 0:C.target)??null,refs:{ffmKg:(C==null?void 0:C.ffmKg)??null,bmrKcal:(C==null?void 0:C.bmrKcal)??null,tdeeKcal:(C==null?void 0:C.tdeeKcal)??null}}},[a,t,r]),K=oe.targets,$=oe.refs,V=g.useMemo(()=>He(M,K),[M,K]),ee=g.useMemo(()=>{if(!V)return null;const n=V.filter(f=>f.remain>0&&Number.isFinite(f.remain));return n.sort((f,k)=>k.remain-f.remain),n},[V]),ke=g.useMemo(()=>et(V),[V]),Y=g.useMemo(()=>K?Pe({today:{cal:c(M==null?void 0:M.cal,0),p:c(M==null?void 0:M.p,0),f:c(M==null?void 0:M.f,0),c:c(M==null?void 0:M.c,0)},target:K}):null,[M,K]),je=async n=>{if(!n)return;const f=Ye(S,J);if((Array.isArray(A)?A:[]).some(w=>String(w==null?void 0:w.record_date)===String(R)&&(w==null?void 0:w.meal_type)===S&&Number(w==null?void 0:w.meal_slot)===Number(f))){N(he(S,f)),o.current&&(o.current.value="");return}_(!0),N(null),E(null);let j=null;try{const w=a==null?void 0:a.id;if(!w)throw new Error("user.id が取れません");const U=(n.name.split(".").pop()||"jpg").toLowerCase(),Q=crypto.randomUUID(),W=`nutrition/${w}/${R}/${Q}.${U}`,{error:C}=await I.storage.from("nutrition-images").upload(W,n,{upsert:!1,contentType:n.type||"image/jpeg"});if(C)throw C;const{data:te}=I.storage.from("nutrition-images").getPublicUrl(W),we=(te==null?void 0:te.publicUrl)??null,{data:X,error:ae}=await I.from("nutrition_logs").insert({user_id:w,record_date:R,meal_type:S,meal_slot:f,image_path:W,image_url:we,image_meta:{original_name:n.name,size:n.size,type:n.type},analysis_status:"pending",analysis_error:null}).select("*").single();if(ae)throw Ze(ae)?new Error(he(S,f)):ae;j=(X==null?void 0:X.id)??null;const ve=await Qe(n),_e=`meal_type=${S}${S==="補食"?` slot=${f}`:""}`,Z=await Ne({type:"analyze_meal",imageBase64:ve,context:_e}),L=Xe(Z),B=(Z==null?void 0:Z.meta)??null,{data:me,error:xe}=await I.from("nutrition_logs").update({total_calories:L.total_calories,p:L.p,f:L.f,c:L.c,menu_items:L.menu_items,advice_markdown:L.advice_markdown,analysis_status:"success",analysis_error:null,analysis_meta:B??{},analysis_model:(B==null?void 0:B.used_model)??null,analysis_reason:(B==null?void 0:B.reason)??null}).eq("id",X.id).select("*").single();if(xe)throw xe;q(ue=>[...Array.isArray(ue)?ue:[],me].sort((re,se)=>{const Me=new Date((re==null?void 0:re.created_at)??0).getTime(),Se=new Date((se==null?void 0:se.created_at)??0).getTime();return Me-Se})),E("記録完了"),typeof x=="function"&&x(me)}catch(w){console.error("[NutritionCard] photo/analyze error:",w);const U=String((w==null?void 0:w.message)??w);if(N(U),j!=null)try{await I.from("nutrition_logs").update({analysis_status:"failed",analysis_error:U.slice(0,2e3)}).eq("id",j)}catch(Q){console.error("[NutritionCard] failed status update error:",Q)}}finally{_(!1),o.current&&(o.current.value="")}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300 text-xs font-medium",children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),i]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:R})]}),e.jsx("h3",{className:"mt-2 text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"栄養"}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400 space-x-3",children:[($==null?void 0:$.bmrKcal)!=null&&e.jsxs("span",{children:["推定基礎代謝量: ",$.bmrKcal," kcal"]}),($==null?void 0:$.tdeeKcal)!=null&&e.jsxs("span",{children:["今日必要なカロリー(推定TDEE): ",$.tdeeKcal," kcal"]})]}),K&&e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:["目標: ",K.cal," kcal / P ",K.p," g / F ",K.f," g / C ",K.c," g"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:S,onChange:n=>{const f=n.target.value;G(f),f!=="補食"&&D(1)},className:"px-2 py-1.5 text-xs border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200",disabled:y,children:[e.jsx("option",{value:"朝食",children:"朝食"}),e.jsx("option",{value:"昼食",children:"昼食"}),e.jsx("option",{value:"夕食",children:"夕食"}),e.jsx("option",{value:"補食",children:"補食"})]}),S==="補食"&&e.jsxs("select",{value:J,onChange:n=>D(Number(n.target.value)),className:"px-2 py-1.5 text-xs border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200",disabled:y,children:[e.jsx("option",{value:1,children:"補食1"}),e.jsx("option",{value:2,children:"補食2"})]}),e.jsxs("button",{type:"button",onClick:()=>{var n;return(n=o.current)==null?void 0:n.click()},disabled:y,className:"inline-flex items-center gap-1 px-3 py-2 text-sm rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",title:"写真を選択",children:[y?e.jsx(de,{className:"w-4 h-4 animate-spin"}):e.jsx(Ee,{className:"w-4 h-4"}),"写真"]}),e.jsx("input",{ref:o,type:"file",accept:"image/*",className:"absolute -left-[9999px] top-0 w-px h-px opacity-0",onChange:n=>{var f;return je(((f=n.target.files)==null?void 0:f[0])??null)}})]})]}),P&&e.jsxs("div",{className:"mt-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg p-3 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-emerald-600 dark:text-emerald-300"}),e.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:P})]}),s&&e.jsx("div",{className:"mt-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 whitespace-pre-wrap",children:["写真/解析に失敗しました：",s]})}),p&&e.jsx("div",{className:"mt-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300",children:["栄養ログの取得に失敗しました：",p]})}),e.jsxs("div",{className:"mt-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-slate-50 dark:bg-slate-900/20 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-slate-700 dark:text-slate-200"}),e.jsx("p",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:"今日の結論"})]}),e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"※ 目安です"})]}),K?m?e.jsx("div",{className:"mt-2 text-sm text-slate-600 dark:text-slate-300",children:"集計中…"}):e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:"不足（優先度）"}),ee&&ee.length>0?e.jsx("div",{className:"mt-1 space-y-1",children:ee.slice(0,2).map(n=>e.jsxs("div",{className:"text-sm text-slate-800 dark:text-slate-100",children:[e.jsx("span",{className:"font-semibold",children:n.label}),e.jsxs("span",{className:"ml-2 text-slate-600 dark:text-slate-300",children:["あと ",e.jsx("b",{children:n.remain})," ",n.unit]})]},n.key))}):e.jsx("div",{className:"mt-1 text-sm text-slate-700 dark:text-slate-200",children:"目標はだいたい到達（超過が気になる場合は脂質/間食を見直し）"}),Y&&e.jsxs("div",{className:"mt-2 text-[11px] text-slate-600 dark:text-slate-300",children:["残り目安：P ",c(Y.p,0).toFixed(1)," g / F ",c(Y.f,0).toFixed(1)," g / C"," ",c(Y.c,0).toFixed(1)," g / kcal ",Math.round(c(Y.cal,0))]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:"次の一手（候補）"}),e.jsx("ul",{className:"mt-1 list-disc pl-5 space-y-1 text-sm text-slate-800 dark:text-slate-100",children:ke.slice(0,3).map((n,f)=>e.jsx("li",{children:n},f))})]})]}):e.jsx("div",{className:"mt-2 text-sm text-slate-600 dark:text-slate-300",children:"体重データがあると、推定目標（BMR/TDEE/PFC）が出せます。"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Te,{dateLabel:R,totals:M,targets:K,loading:m,bmrKcal:($==null?void 0:$.bmrKcal)??null,tdeeKcal:($==null?void 0:$.tdeeKcal)??null,onPrimaryAction:()=>{var n;return(n=o.current)==null?void 0:n.click()},primaryLabel:"食事を記録"})}),e.jsxs("div",{className:"mt-5",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"今日の記録"}),m?e.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"読み込み中..."}):!Array.isArray(A)||A.length===0?e.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"まだ栄養記録がありません（朝/昼/夕/補食を追加していこう）"}):e.jsx("div",{className:"mt-2 space-y-2",children:A.map(n=>{const k=tt(n==null?void 0:n.menu_items).map(j=>at(j)).filter(Boolean).join(" / ");return e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 min-w-0",children:[n.image_url?e.jsx("img",{src:n.image_url,alt:"meal",className:"w-14 h-14 rounded-lg object-cover border border-gray-200 dark:border-gray-700 flex-none",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-14 h-14 rounded-lg bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 flex-none"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[Le(n.meal_type,n.meal_slot),e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:[c(n.total_calories,0)," kcal"]}),n.analysis_status&&e.jsx("span",{className:"ml-2 text-[10px] px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:String(n.analysis_status)})]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["P ",c(n.p,0).toFixed(1)," / F ",c(n.f,0).toFixed(1)," / C ",c(n.c,0).toFixed(1),n.is_edited?"（編集済）":""]}),k&&e.jsxs("p",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400 break-words",children:["推定メニュー: ",k]}),n.advice_markdown&&e.jsx("p",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400 whitespace-pre-wrap",children:String(n.advice_markdown)}),n.analysis_status==="failed"&&n.analysis_error&&e.jsxs("p",{className:"mt-1 text-[11px] text-red-600 dark:text-red-400 whitespace-pre-wrap",children:["解析失敗: ",String(n.analysis_error)]})]})]}),e.jsx("button",{type:"button",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",onClick:()=>{T(n),v(!0)},children:"詳細"})]})},n.id)})})]}),b&&F&&e.jsx(ze,{open:b,log:F,onClose:()=>{v(!1),T(null)},onSaved:n=>{q(f=>Array.isArray(f)?f.map(k=>k.id===n.id?n:k):[]),v(!1),T(null),typeof x=="function"&&x(n)},onDeleted:n=>{q(f=>Array.isArray(f)?f.filter(k=>(k==null?void 0:k.id)!==n):[]),v(!1),T(null),typeof x=="function"&&x(null)}})]})}function lt({user:a,date:t,nutritionLogs:r,nutritionTotals:l,nutritionLoading:u,nutritionError:i,onBackHome:h,latestInbody:d=null,trainingRecords:m=[],latestWeightKg:p=null,onRefreshNutrition:x}){const o=g.useMemo(()=>{const s=(r==null?void 0:r.filter(N=>(N==null?void 0:N.status)==="confirmed"||(N==null?void 0:N.is_confirmed)===!0||(N==null?void 0:N.analysis_status)==="success").length)??0;return s>0?s:(r==null?void 0:r.length)??0},[r]),y=g.useMemo(()=>{const s=Math.min(o,3);return s===0?"まだ記録がありません":s===1?"1つ進んだ":s===2?"2つ進んだ":"今日の基本3食がそろった"},[o]),_=g.useMemo(()=>{const s=l??{},N=Number((s==null?void 0:s.cal)??(s==null?void 0:s.kcal)??(s==null?void 0:s.calories)??(s==null?void 0:s.total_calories)??0)||0,P=Number((s==null?void 0:s.p)??(s==null?void 0:s.protein_g)??(s==null?void 0:s.p_g)??(s==null?void 0:s.protein)??0)||0,E=Number((s==null?void 0:s.f)??(s==null?void 0:s.fat_g)??(s==null?void 0:s.f_g)??(s==null?void 0:s.fat)??0)||0,S=Number((s==null?void 0:s.c)??(s==null?void 0:s.carbs_g)??(s==null?void 0:s.c_g)??(s==null?void 0:s.carbs)??0)||0;return{cal:N,p:P,f:E,c:S}},[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-500"}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"栄養（詳細）"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"AIは下書き。最後に決めるのはあなた。"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[(a==null?void 0:a.name)??"ユーザー","さん · ",t]}),e.jsx("div",{className:"mt-3",children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-200",children:["今日の進捗：",e.jsxs("b",{children:[Math.min(o,3),"/3"]}),e.jsx("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:y})]})})]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"ホームへ"})]})]})}),e.jsx(rt,{user:a,latestInbody:d,date:t,trainingRecords:m,nutritionLogs:r,nutritionTotals:_,nutritionLoading:u,nutritionError:i,latestWeightKg:p,onSaved:()=>{typeof x=="function"&&x()}})]})}export{lt as default};

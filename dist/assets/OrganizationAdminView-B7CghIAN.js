import{u as H,s as R,j as e,A as N,H as _,X as q,B as S,U as F,a as V,b as G,c as C,S as L,d as X,C as J,e as K,O as Q,f as W,g as Y,h as Z,i as ee,k as re,l as te,m as ae,T as se,n as ne,o as oe}from"./index-C7IL5YWP.js";import{r}from"./chart-vendor-B8I3tXXj.js";import"./supabase-vendor-CRHRt2Ih.js";function ue({user:c,alerts:g,organizationId:t,organizationName:m,onNavigateToPrivacy:de,onNavigateToTerms:ie,onNavigateToCommercial:le,onNavigateToHelp:xe}){const[i,T]=r.useState([]),[s,b]=r.useState("overview"),[l,y]=r.useState("invite"),[n,d]=r.useState("members"),[h,v]=r.useState("single"),[p,A]=r.useState(!0),[ce,$]=r.useState(!1),[M,k]=r.useState(!1),[ge,me]=r.useState(!1),{isActive:U,shouldShowTutorial:j,startTutorial:u,completeTutorial:O,skipTutorial:D,currentStepIndex:I,setCurrentStepIndex:E}=H();r.useEffect(()=>{j()&&!p&&u()},[j,u,p]);const x=g.filter(a=>a.priority==="high"),z=g.filter(a=>a.type==="no_data"||a.type==="reminder");r.useEffect(()=>{const a=localStorage.getItem("criticalAlertDismissed"),o=a?parseInt(a,10):0,f=Date.now(),w=30*60*1e3;o&&f-o<w?k(!0):o&&f-o>=w&&localStorage.removeItem("criticalAlertDismissed")},[]);const P=()=>{k(!0),localStorage.setItem("criticalAlertDismissed",Date.now().toString())};r.useEffect(()=>{B()},[t]);const B=async()=>{try{const{data:a,error:o}=await R.from("teams").select("*").eq("organization_id",t).order("name");if(o)throw o;T(a||[])}catch(a){console.error("Error fetching teams:",a)}finally{A(!1)}};return p?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700 transition-colors sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"組織管理ダッシュボード"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[x.length>0&&e.jsxs("button",{onClick:()=>$(!0),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors relative",title:"アラート",children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),e.jsx("button",{onClick:u,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:"チュートリアル",children:e.jsx(_,{className:"w-5 h-5"})})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[x.length>0&&!M&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"w-6 h-6 text-red-600 dark:text-red-400 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-red-900 dark:text-red-100",children:"高リスクアラート"}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-200",children:[x.length,"件の注意が必要です"]})]}),e.jsx("button",{onClick:P,className:"ml-3 p-1 text-red-400 hover:text-red-600 transition-colors flex-shrink-0",title:"30分間非表示",children:e.jsx(q,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(S,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"組織概要"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1",children:g.length}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"総アラート数"})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mb-1",children:x.length}),e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:"高優先度"})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-1",children:z.length}),e.jsx("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"システム通知"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1",children:i.length}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"登録チーム数"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-8 transition-colors",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex px-6 overflow-x-auto scrollbar-hide",children:[e.jsxs("button",{onClick:()=>b("overview"),className:`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${s==="overview"?"border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"概要"})]}),e.jsxs("button",{onClick:()=>b("users"),className:`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${s==="users"?"border-green-500 text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,"data-tutorial":"users-tab",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"ユーザー管理"})]}),e.jsxs("button",{onClick:()=>b("organization"),className:`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${s==="organization"?"border-orange-500 text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,"data-tutorial":"organization-tab",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"組織管理"})]})]})}),(s==="users"||s==="organization")&&e.jsx("div",{className:"border-b border-gray-100 dark:border-gray-700/50 bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:[s==="users"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("invite"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${l==="invite"?"border-green-500 text-green-700 dark:text-green-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(G,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"招待"})]}),e.jsxs("button",{onClick:()=>y("manage"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${l==="manage"?"border-green-500 text-green-700 dark:text-green-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(C,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"管理"})]})]}),s==="organization"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>d("members"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${n==="members"?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(L,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"メンバー"})]}),e.jsxs("button",{onClick:()=>d("settings"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${n==="settings"?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(X,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"設定"})]}),e.jsxs("button",{onClick:()=>d("subscription"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${n==="subscription"?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(J,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"サブスクリプション"})]}),e.jsxs("button",{onClick:()=>d("transfers"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${n==="transfers"?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(C,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"選手移籍"})]}),e.jsxs("button",{onClick:()=>d("team-access"),className:`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${n==="team-access"?"border-orange-500 text-orange-700 dark:text-orange-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(K,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"チームアクセス"})]})]})]})}),e.jsx("div",{className:"p-6",children:s==="overview"?e.jsx(Q,{organizationId:t,organizationName:m}):s==="users"?e.jsx("div",{children:l==="invite"?e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>v("single"),className:`py-3 px-1 border-b-2 font-medium text-sm ${h==="single"?"border-green-500 text-green-600 dark:text-green-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:"個別招待"}),e.jsx("button",{onClick:()=>v("bulk"),className:`py-3 px-1 border-b-2 font-medium text-sm ${h==="bulk"?"border-green-500 text-green-600 dark:text-green-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:"一括招待 (CSV)"})]})}),h==="single"?e.jsx("div",{"data-tutorial":"single-invite",children:e.jsx(W,{teams:i,onUserInvited:()=>{},restrictToOrganizationId:t,allowAdminInvite:!1})}):e.jsx("div",{"data-tutorial":"bulk-invite",children:e.jsx(Y,{teams:i,onUsersInvited:()=>{},restrictToOrganizationId:t,allowAdminInvite:!1})})]}):l==="manage"?e.jsx("div",{"data-tutorial":"user-list",children:e.jsx(Z,{teams:i,restrictToOrganizationId:t})}):null}):s==="organization"?e.jsx("div",{children:n==="members"?e.jsx(ee,{organizationId:t,organizationName:m}):n==="settings"?e.jsx(re,{organizationId:t}):n==="subscription"?e.jsx(te,{organizationId:t,organizationName:m}):n==="transfers"?e.jsx(ae,{userId:c.id,organizationId:t,isAdmin:isGlobalAdmin(c.role)}):n==="team-access"?e.jsx(se,{userId:c.id,organizationId:t,isAdmin:!0}):null}):null})]})]})}),e.jsx(ne,{steps:oe("global_admin"),isActive:U,onComplete:O,onSkip:D,currentStepIndex:I,onStepChange:E})]})}export{ue as OrganizationAdminView};

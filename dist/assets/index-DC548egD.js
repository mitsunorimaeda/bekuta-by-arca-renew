const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GamificationView-DcmE6WMq.js","assets/chart-vendor-DEPfNMx8.js","assets/supabase-vendor-BgrwFlS9.js","assets/AthleteNutritionDashboardView-B0c06uVF.js","assets/ExportPanel-Ge-XKF4b.js","assets/exportUtils-CPsb9qem.js","assets/MessagingPanel-BRo3Mj6D.js","assets/AthletePerformanceView-COoFGWZu.js","assets/TeamExportPanel-BaFUi1FW.js","assets/ReportView-CAQjuW-Q.js","assets/CoachRankingsView-jr4dmQys.js","assets/GrowthUnderstandingQuadrantSummary-BAII9Axz.js","assets/GrowthUnderstandingMatrix-G4SRsLvV.js","assets/OrganizationAdminView-BLDffxYf.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,r,a)=>((t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a)(t,"symbol"!=typeof r?r+"":r,a);import{r,a,R as s,L as n,C as l,X as i,Y as d,T as o,b as c,c as x,d as m,e as u,S as g,f as h,g as b,B as p,h as y,i as f}from"./chart-vendor-DEPfNMx8.js";import{c as j}from"./supabase-vendor-BgrwFlS9.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var v={exports:{}},w={},N=r,k=Symbol.for("react.element"),_=Symbol.for("react.fragment"),C=Object.prototype.hasOwnProperty,S=N.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,D={key:!0,ref:!0,__self:!0,__source:!0};function M(e,t,r){var a,s={},n=null,l=null;for(a in void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(l=t.ref),t)C.call(t,a)&&!D.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:k,type:e,key:n,ref:l,props:s,_owner:S.current}}w.Fragment=_,w.jsx=M,w.jsxs=M,v.exports=w;var E,R=v.exports,T=a;E=T.createRoot,T.hydrateRoot;const A={},$=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in A)return;A[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,r&&s.setAttribute("nonce",r),document.head.appendChild(s),t?new Promise((t,r)=>{s.addEventListener("load",t),s.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},z=globalThis,q=z.__bekuta_supabase??(z.__bekuta_supabase=j("http://127.0.0.1:54321","sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:"undefined"!=typeof window?window.localStorage:void 0},realtime:{params:{eventsPerSecond:0}}}));async function F(e){const t=String(e&&"object"==typeof e&&"message"in e?e.message:e??"");if(t.includes("Invalid Refresh Token")||t.includes("Refresh Token Not Found")||t.includes("refresh_token")){try{await q.auth.signOut()}catch(r){}try{const e=Object.keys(window.localStorage);for(const t of e)t.startsWith("sb-")&&t.endsWith("-auth-token")&&window.localStorage.removeItem(t)}catch(r){}window.location.reload()}}const I=Object.freeze(Object.defineProperty({__proto__:null,recoverFromInvalidRefreshToken:F,supabase:q},Symbol.toStringTag,{value:"Module"}));function L(e){return new Promise(t=>setTimeout(t,e))}async function P(e,t){let r;try{return await Promise.race([e,new Promise(e=>{r=setTimeout(()=>e(null),t)})])}finally{clearTimeout(r)}}function O(){const[e,t]=r.useState(null),[a,s]=r.useState(null),[n,l]=r.useState("booting"),i="ready"!==n,[d,o]=r.useState(!1),c=r.useRef(!0),x=r.useRef(0),m=r.useCallback(async e=>{const t=++x.current,r=[0,300,800,1500];for(let a=0;a<r.length;a++){if(!c.current)return;if(t!==x.current)return;r[a]>0&&await L(r[a]);const n=await P(q.from("users").select("*").eq("id",e).maybeSingle(),8e3);if(!c.current)return;if(t!==x.current)return;if(null===n)continue;const{data:l,error:i}=n;if(i)return console.error("[useAuth] fetchUserProfile error:",i),void s(null);if(l)return void s(l)}s(null)},[]),u=r.useCallback(async e=>{const r=(null==e?void 0:e.user)??null;t(r),r?((e=>{var t;const r=!0===(null==(t=e.user_metadata)?void 0:t.requires_password_change);o(r)})(r),m(r.id)):(s(null),o(!1))},[m]),g=r.useCallback(async()=>{var e;try{const{data:t,error:r}=await q.auth.getUser();if(r)return void console.error("[useAuth] refreshUserProfile getUser error:",r);const a=null==(e=t.user)?void 0:e.id;if(!a)return;await m(a)}catch(t){console.error("[useAuth] refreshUserProfile failed:",t)}},[m]);r.useEffect(()=>{c.current=!0;const{data:e}=q.auth.onAuthStateChange(async(e,t)=>{c.current&&(await u(t),c.current&&l("ready"))});return(async()=>{var e;try{const t=await P(q.auth.getSession(),8e3);if(!c.current)return;(null==(e=null==t?void 0:t.data)?void 0:e.session)&&await u(t.data.session)}catch(t){console.error("[useAuth] init getSession failed:",t)}finally{c.current&&l("ready")}})(),()=>{var t;c.current=!1,null==(t=null==e?void 0:e.subscription)||t.unsubscribe()}},[u]);return{user:e,userProfile:a,loading:i,requiresPasswordChange:d,signIn:async(e,t)=>{var r,a;const{data:s,error:n}=await q.auth.signInWithPassword({email:e.trim(),password:t});if(n)throw n;return(null==(a=null==(r=s.user)?void 0:r.user_metadata)?void 0:a.requires_password_change)&&o(!0),s},signOut:async()=>{try{await q.auth.signOut()}catch(e){console.error("[useAuth] signOut error:",e)}finally{t(null),s(null),o(!1),l("ready")}},changePassword:async e=>{const{error:t}=await q.auth.updateUser({password:e,data:{requires_password_change:!1}});if(t)throw t;o(!1)},acceptTerms:async()=>{if(!e)throw new Error("User not logged in");const t=(new Date).toISOString(),{error:r}=await q.from("users").update({terms_accepted:!0,terms_accepted_at:t}).eq("id",e.id);if(r)throw console.error("[useAuth] acceptTerms failed:",r),r;s(e=>e?{...e,terms_accepted:!0,terms_accepted_at:t}:e)},refreshUserProfile:g}}function W(e){return new Date(e.getTime()+324e5)}function B(e){const t=W(e);return`${t.getUTCFullYear()}-${String(t.getUTCMonth()+1).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`}function U(){return W(new Date)}function H(){return B(new Date)}function V(e){return function(e){const t=U();return t.setUTCFullYear(t.getUTCFullYear()-e),B(t)}(e)}function K(e){return function(e){const t=U();return t.setUTCDate(t.getUTCDate()-e),B(t)}(e)}function J(e){return B(e)}function Y(e){return B(e)}function Z(){return new Date(Date.now()+324e5).toISOString().replace("Z","+09:00")}const G=[{type:"high_risk",condition:"acwr_above",threshold:1.5,enabled:!0,description:"ACWR ãŒ 1.5 ã‚’è¶…ãˆãŸå ´åˆï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰"},{type:"caution",condition:"acwr_above",threshold:1.3,enabled:!0,description:"ACWR ãŒ 1.3 ã‚’è¶…ãˆãŸå ´åˆï¼ˆæ³¨æ„ãƒ¬ãƒ™ãƒ«ï¼‰"},{type:"low_load",condition:"acwr_below",threshold:.8,enabled:!0,description:"ACWR ãŒ 0.8 ã‚’ä¸‹å›ã£ãŸå ´åˆï¼ˆä½è² è·ï¼‰"},{type:"no_data",condition:"no_training_days",threshold:5,enabled:!0,description:"5æ—¥é–“ç·´ç¿’è¨˜éŒ²ãŒãªã„å ´åˆ"},{type:"reminder",condition:"no_training_today",threshold:1,enabled:!1,description:"å½“æ—¥ã®ç·´ç¿’è¨˜éŒ²ãŒãªã„å ´åˆï¼ˆ22æ™‚ä»¥é™ï¼‰"},{type:"srpe_high",condition:"srpe_above",threshold:600,enabled:!0,description:"sRPEï¼ˆRPEÃ—åˆ†ï¼‰ãŒ600ã‚’è¶…ãˆãŸå ´åˆï¼ˆå˜ç™ºé«˜è² è·ï¼‰"},{type:"srpe_spike",condition:"srpe_spike_ratio",threshold:1.6,enabled:!0,description:"å½“æ—¥ã®sRPEãŒç›´è¿‘å¹³å‡æ¯”ã§æ€¥å¢—ï¼ˆä¾‹ï¼š1.6å€ä»¥ä¸Šï¼‰"}];function Q(e,t,r,a,s){const n=[],l=new Date,i=Y(l),d=r.length>0?r[r.length-1]:null,o=a.length>0?a[a.length-1]:null,c=a.find(e=>e.date===i),x=Array.from(new Set(a.map(e=>e.date))).length>=21,m=e=>{const t=Number((null==e?void 0:e.rpe)??0),r=Number((null==e?void 0:e.duration_min)??0);return t&&r?Math.round(t*r):0},u=new Map;for(const y of a){const e=y.date;e&&u.set(e,(u.get(e)??0)+m(y))}const g=u.get(i)??0,h=Array.from(u.keys()).sort().filter(e=>e<i).slice(-7).map(e=>u.get(e)??0).filter(e=>e>0),b=h.length?Math.round(h.reduce((e,t)=>e+t,0)/h.length):0,p=b>0?Number((g/b).toFixed(2)):0;return s.forEach(r=>{if(!r.enabled)return;let a=!1,s={user_id:e,user_name:t,type:r.type,is_read:!1,is_dismissed:!1,created_at:l.toISOString()};switch(r.condition){case"acwr_above":if(!x)break;d&&d.acwr>r.threshold&&(a=!0,s={...s,priority:"high_risk"===r.type?"high":"medium",title:"high_risk"===r.type?"ğŸš¨ é«˜ãƒªã‚¹ã‚¯è­¦å‘Š":"âš ï¸ æ³¨æ„ãƒ¬ãƒ™ãƒ«",message:`${t}ã•ã‚“ã®ACWRãŒ${d.acwr}ã¨ãªã‚Šã€${r.threshold}ã‚’è¶…ãˆã¾ã—ãŸã€‚æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚`,acwr_value:d.acwr,threshold_exceeded:`${r.threshold}ä»¥ä¸Š`,expires_at:new Date(l.getTime()+1728e5).toISOString()});break;case"acwr_below":if(!x)break;d&&d.acwr<r.threshold&&(a=!0,s={...s,priority:"low",title:"ğŸ“‰ ä½è² è·é€šçŸ¥",message:`${t}ã•ã‚“ã®ACWRãŒ${d.acwr}ã¨ãªã‚Šã€${r.threshold}ã‚’ä¸‹å›ã‚Šã¾ã—ãŸã€‚ç·´ç¿’è² è·ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`,acwr_value:d.acwr,threshold_exceeded:`${r.threshold}æœªæº€`,expires_at:new Date(l.getTime()+2592e5).toISOString()});break;case"no_training_days":if(o){const e=Math.floor((l.getTime()-new Date(o.date).getTime())/864e5);e>=r.threshold&&(a=!0,s={...s,priority:"medium",title:"ğŸ“… ç·´ç¿’è¨˜éŒ²ãªã—",message:`${t}ã•ã‚“ã®ç·´ç¿’è¨˜éŒ²ãŒ${e}æ—¥é–“ã‚ã‚Šã¾ã›ã‚“ã€‚ç¶™ç¶šçš„ãªãƒ‡ãƒ¼ã‚¿è¨˜éŒ²ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`,last_training_date:o.date,days_since_last_training:e,expires_at:new Date(l.getTime()+6048e5).toISOString()})}break;case"no_training_today":l.getHours()>=22&&!c&&(a=!0,s={...s,priority:"low",title:"â° ä»Šæ—¥ã®è¨˜éŒ²å¿˜ã‚Œ",message:`${t}ã•ã‚“ã€ä»Šæ—¥ã®ç·´ç¿’è¨˜éŒ²ã‚’ã¾ã å…¥åŠ›ã—ã¦ã„ã¾ã›ã‚“ã€‚å¿˜ã‚Œãšã«è¨˜éŒ²ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`,expires_at:new Date(l.getTime()+72e5).toISOString()});break;case"srpe_above":g>0&&g>=r.threshold&&(a=!0,s={...s,priority:"medium",title:"ğŸ”¥ é«˜è² è·ï¼ˆsRPEï¼‰",message:`${t}ã•ã‚“ã®ä»Šæ—¥ã®è² è·ï¼ˆsRPEï¼‰ãŒ${g}ã§ã™ã€‚ç–²åŠ´ãŒæºœã¾ã‚Šã‚„ã™ã„ã®ã§ç¡çœ ãƒ»è£œé£Ÿãƒ»å›å¾©ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚`,srpe_value:g,expires_at:new Date(l.getTime()+1728e5).toISOString()});break;case"srpe_spike_ratio":g>0&&b>0&&p>=r.threshold&&(a=!0,s={...s,priority:"high",title:"âš¡ æ€¥å¢—ï¼ˆsRPEï¼‰",message:`${t}ã•ã‚“ã®ä»Šæ—¥ã®è² è·ï¼ˆsRPEï¼‰ãŒæ€¥å¢—ã—ã¦ã„ã¾ã™ï¼ˆ${g} / ç›´è¿‘å¹³å‡${b} = ${p}å€ï¼‰ã€‚æ€ªæˆ‘ãƒªã‚¹ã‚¯ãŒä¸ŠãŒã‚Šã‚„ã™ã„ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚`,srpe_value:g,srpe_avg_7d:b,srpe_spike_ratio:p,expires_at:new Date(l.getTime()+2592e5).toISOString()})}a&&n.push({id:`${e}-${r.type}-${Date.now()}`,...s})}),n}function X(e){switch(e.priority){case"high":return{bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-600",icon:"ğŸš¨"};case"medium":return{bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-600",icon:"âš ï¸"};case"low":return{bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-600",icon:"ğŸ’¡"};default:return{bgColor:"bg-gray-50",borderColor:"border-gray-200",textColor:"text-gray-800",iconColor:"text-gray-600",icon:"â„¹ï¸"}}}function ee(e){switch(e){case"high_risk":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"low_load":return"ä½è² è·";case"no_data":return"ãƒ‡ãƒ¼ã‚¿ãªã—";case"reminder":return"ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼";case"srpe_high":return"é«˜è² è·ï¼ˆsRPEï¼‰";case"srpe_spike":return"æ€¥å¢—ï¼ˆsRPEï¼‰";default:return"ä¸æ˜"}}function te(e){return e.filter(e=>!e.is_dismissed&&!function(e){return!!e.expires_at&&new Date>new Date(e.expires_at)}(e))}function re(e){const[t,r,a]=e.split("-").map(e=>Number(e));return new Date(Date.UTC(t,(r||1)-1,a||1))}function ae(e){return e.toISOString().slice(0,10)}function se(e,t){const r=new Date(e);return r.setUTCDate(r.getUTCDate()+t),r}function ne(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"good":return"è‰¯å¥½";case"low":return"ä½è² è·";default:return"ä¸æ˜"}}function le(e){if("string"==typeof e)switch(e){case"high":return"#ef4444";case"caution":return"#f59e0b";case"good":return"#22c55e";case"low":return"#3b82f6";default:return"#94a3b8"}const t=e;return null!=t&&Number.isFinite(t)?t>1.5?"#ef4444":t>=1.3?"#f59e0b":t>=.8?"#22c55e":"#3b82f6":"#94a3b8"}function ie(e){const t=new Map;for(const i of e){if(!(null==i?void 0:i.date))continue;const e="number"==typeof i.load&&Number.isFinite(i.load)?i.load:0;t.set(i.date,(t.get(i.date)??0)+e)}const r=Array.from(t.keys()).sort();if(0===r.length)return[];const a=re(r[0]),s=re(r[r.length-1]),n=[];for(let i=a;i<=s;i=se(i,1)){const e=ae(i);n.push({date:e,load:t.get(e)??0})}const l=[];for(let i=0;i<n.length;i++){const e=n[i].date;if(i<27){l.push({date:e,acwr:null,acuteLoad:null,chronicLoad:null,riskLevel:"unknown"});continue}const t=n.slice(i-6,i+1).reduce((e,t)=>e+t.load,0),r=n.slice(i-27,i+1).reduce((e,t)=>e+t.load,0)/4,a=r>0?t/r:null,s=null!=a?Number(a.toFixed(2)):null,d=null==s?"unknown":s>1.5?"high":s>=1.3?"caution":s>=.8?"good":"low";l.push({date:e,acuteLoad:Number(t.toFixed(1)),chronicLoad:r>0?Number(r.toFixed(1)):null,acwr:s,riskLevel:d})}return l}const de=r.createContext(null);function oe({children:e}){const[t,a]=r.useState(()=>"undefined"==typeof document||!document.hidden),[s,n]=r.useState(()=>"undefined"==typeof navigator||navigator.onLine),l=r.useRef(new Map),i=r.useRef(t),d=r.useRef(s);r.useEffect(()=>{i.current=t},[t]),r.useEffect(()=>{d.current=s},[s]),r.useEffect(()=>{const e=()=>a(!document.hidden),t=()=>n(!0),r=()=>n(!1);return document.addEventListener("visibilitychange",e),window.addEventListener("online",t),window.addEventListener("offline",r),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("online",t),window.removeEventListener("offline",r)}},[]);const o=r.useCallback(e=>{l.current.delete(e)},[]),c=r.useCallback(async e=>{try{await e.run(),e.failCount=0,e.nextAt=Date.now()+e.intervalMs}catch(t){e.failCount+=1;const r=2e3,a=Math.min(3e5,r*Math.pow(2,Math.min(8,e.failCount)));e.nextAt=Date.now()+a}},[]);r.useEffect(()=>{const e=window.setInterval(()=>{const e=Date.now(),t=i.current,r=d.current;for(const a of l.current.values())a.enabled&&(a.requireVisible&&!t||a.requireOnline&&!r||e<a.nextAt||c(a))},1e3);return()=>window.clearInterval(e)},[c]);const x=r.useCallback(e=>{const{key:t,intervalMs:r,run:a,enabled:s=!0,requireVisible:n=!0,requireOnline:i=!0,immediate:d=!1}=e,o=l.current.get(t)??{key:t,intervalMs:r,run:a,enabled:s,requireVisible:n,requireOnline:i,nextAt:Date.now(),failCount:0};return o.intervalMs=r,o.run=a,o.enabled=s,o.requireVisible=n,o.requireOnline=i,s&&(o.nextAt=d?Date.now():Date.now()+r),l.current.set(t,o),d&&s&&c(o),()=>{l.current.delete(t)}},[c]),m=r.useMemo(()=>{const e=t&&s;return{isVisible:t,isOnline:s,canRun:e,canRealtime:e}},[t,s]),u=r.useMemo(()=>({state:m,registerPollJob:x,unregisterJob:o}),[m,x,o]);return R.jsx(de.Provider,{value:u,children:e})}function ce(){const e=r.useContext(de);if(!e)throw new Error("useRealtimeHub must be used within RealtimeHubProvider");return e}function xe(e,t){var a,s;const[n,l]=r.useState([]),[i,d]=r.useState([]),[o,c]=r.useState(!0),[x,m]=r.useState(0),{registerPollJob:u}=ce(),g=r.useRef((null==(s=null==(a=globalThis.crypto)?void 0:a.randomUUID)?void 0:s.call(a))??Math.random().toString(36).slice(2)),h=r.useRef(null),b=r.useCallback(async()=>{if(!e||!t)return[];let r=[];if("athlete"===t){const{data:t}=await q.from("users").select("id, name").eq("id",e).single();t&&(r=[t])}if("staff"===t){const{data:t,error:a}=await q.from("staff_team_links").select("\n          team_id,\n          teams!inner (\n            users!inner (\n              id,\n              name\n            )\n          )\n        ").eq("staff_user_id",e);a&&console.error("[useAlerts] staff team fetch error:",a);const s=(null==t?void 0:t.flatMap(e=>{var t;return(null==(t=e.teams)?void 0:t.users)||[]}))||[],n=new Map;for(const e of s)(null==e?void 0:e.id)&&(n.has(e.id)||n.set(e.id,{id:e.id,name:e.name??""}));r=Array.from(n.values())}if("global_admin"===t){const{data:e,error:t}=await q.from("users").select("id, name").eq("role","athlete");t&&console.error("[useAlerts] admin athletes fetch error:",t);const a=new Map;for(const r of e||[])(null==r?void 0:r.id)&&(a.has(r.id)||a.set(r.id,{id:r.id,name:r.name??""}));r=Array.from(a.values())}return r},[e,t]),p=r.useCallback(async()=>{if(e&&t)try{const e=await b();if(!e.length)return;const r=(i??[]).filter(e=>"athlete"===t||"no_data"!==e.type),a=e.map(async e=>{const{data:t,error:r}=await q.from("training_records").select("*").eq("user_id",e.id).order("date",{ascending:!0});if(r)throw{user:e,error:r};return{user:e,trainingRecords:t||[]}}),s=await Promise.allSettled(a),n=[];for(const t of s){if("rejected"===t.status){console.error("[useAlerts] training_records fetch failed:",t.reason);continue}const{user:e,trainingRecords:a}=t.value,s=ie(a),l=Q(e.id,e.name,s,a,r);n.push(...l)}l(e=>{const t=new Set(e.map(e=>`${e.user_id}-${e.type}-${e.created_at.split("T")[0]}`)),r=n.filter(e=>!t.has(`${e.user_id}-${e.type}-${e.created_at.split("T")[0]}`));if(r.length>0){false;return function(e){const t={high:3,medium:2,low:1};return e.sort((e,r)=>{const a=t[r.priority]-t[e.priority];return 0!==a?a:new Date(r.created_at).getTime()-new Date(e.created_at).getTime()})}(te([...e,...r]))}return te(e)})}catch(r){console.error("Error checking and generating alerts:",r)}},[e,t,i,b]),y=r.useCallback(async()=>{const e=G.map((e,t)=>({id:`default-${t}`,...e}));d(e)},[]);r.useEffect(()=>{let r=!1;return(async()=>{if(e&&t){c(!0);try{await y()}catch(a){console.error("Error loading alert rules:",a),await y()}finally{r||c(!1)}}else c(!1)})(),()=>{r=!0}},[e,t,y]),r.useEffect(()=>{i.length>0&&e&&t&&p()},[i.length,e,t,p]),r.useEffect(()=>{if(h.current&&(h.current(),h.current=null),!e||!t)return;if(0===i.length)return;const r=`alerts:${e}:${t}:${g.current}`,a=u({key:r,intervalMs:18e5,run:async()=>{await p()},enabled:!0,requireVisible:!0,requireOnline:!0,immediate:!1});return h.current=a,()=>{h.current&&(h.current(),h.current=null)}},[e,t,i.length,u,p]),r.useEffect(()=>{const e=n.filter(e=>!e.is_read&&!e.is_dismissed).length;m(e)},[n]);const f=r.useCallback(async e=>{l(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t))},[]),j=r.useCallback(async e=>{l(t=>t.map(t=>t.id===e?{...t,is_dismissed:!0}:t))},[]),v=r.useCallback(async()=>{l(e=>e.map(e=>({...e,is_read:!0})))},[]),w=r.useCallback(()=>{l(e=>e.filter(e=>!e.is_dismissed))},[]),N=r.useCallback(()=>te(n),[n]),k=r.useCallback(()=>n.filter(e=>!e.is_read&&!e.is_dismissed),[n]),_=r.useCallback(e=>N().filter(t=>t.priority===e),[N]),C=r.useCallback(e=>N().filter(t=>t.user_id===e),[N]);return{alerts:N(),alertRules:i,loading:o,unreadCount:x,markAsRead:f,dismissAlert:j,markAllAsRead:v,clearDismissedAlerts:w,getUnreadAlerts:k,getAlertsByPriority:_,getAlertsByUser:C,refreshAlerts:p}}const me=r.createContext(void 0);function ue({userId:e,role:t,children:a}){const s=function(e,t){const[a,s]=r.useState(null),[n,l]=r.useState(!0),[i,d]=r.useState(null),o=r.useCallback(async()=>{if(e&&t)try{l(!0),d(null);const{data:r,error:a}=await q.from("tutorial_progress").select("*").eq("user_id",e).eq("role",t).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(a)throw a;s(r||{user_id:e,role:t,completed_steps:[],current_step:null,is_completed:!1,skipped:!1})}catch(r){console.error("Error loading tutorial progress:",r),d(r.message??String(r))}finally{l(!1)}else l(!1)},[e,t]);r.useEffect(()=>{o()},[o]);const c=r.useCallback(async r=>{if(!e||!t)return null;try{d(null);const n={...a??{user_id:e,role:t,completed_steps:[],current_step:null,is_completed:!1,skipped:!1},...r,user_id:e,role:t},{data:l,error:i}=await q.from("tutorial_progress").upsert(n,{onConflict:"user_id,role"}).select().single();if(i)throw i;return s(l),l}catch(n){console.error("Error saving tutorial progress:",n),d(n.message??String(n));const l={...a??{user_id:e,role:t,completed_steps:[],current_step:null,is_completed:!1,skipped:!1},...r,user_id:e,role:t};return s(l),l}},[e,t,a]),x=r.useCallback(async e=>{if(!a)return null;const t=[...a.completed_steps];return t.includes(e)||t.push(e),await c({completed_steps:t,current_step:e})},[a,c]),m=r.useCallback(async e=>await c({current_step:e}),[c]),u=r.useCallback(async()=>await c({is_completed:!0,current_step:null}),[c]),g=r.useCallback(async()=>await c({skipped:!0,current_step:null}),[c]),h=r.useCallback(async()=>await c({completed_steps:[],current_step:null,is_completed:!1,skipped:!1}),[c]),b=r.useCallback(()=>!!a&&!a.is_completed&&!a.skipped,[a]);return{progress:a,loading:n,error:i,completeStep:x,setCurrentStep:m,completeTutorial:u,skipTutorial:g,resetTutorial:h,shouldShowTutorial:b,refreshProgress:o}}(e,t),[n,l]=r.useState(!1),[i,d]=r.useState(0),o=r.useCallback(()=>{l(!0),d(0)},[]),c=r.useCallback(()=>{l(!1)},[]),x=r.useCallback(async()=>{await s.completeTutorial(),l(!1)},[s]),m=r.useCallback(async()=>{await s.skipTutorial(),l(!1)},[s]),u={...s,isActive:n,currentStepIndex:i,startTutorial:o,stopTutorial:c,completeTutorial:x,skipTutorial:m,setCurrentStepIndex:d};return R.jsx(me.Provider,{value:u,children:a})}function ge(){const e=r.useContext(me);if(void 0===e)throw new Error("useTutorialContext must be used within a TutorialProvider");return e}
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var he={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=(e,t)=>{const a=r.forwardRef(({color:a="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:l,className:i="",children:d,...o},c)=>{return r.createElement("svg",{ref:c,...he,width:s,height:s,stroke:a,strokeWidth:l?24*Number(n)/Number(s):n,className:["lucide",`lucide-${x=e,x.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,i].join(" "),...o},[...t.map(([e,t])=>r.createElement(e,t)),...Array.isArray(d)?d:[d]]);var x});return a.displayName=`${e}`,a},pe=be("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),ye=be("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),fe=be("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),je=be("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),ve=be("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),we=be("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Ne=be("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),ke=be("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),_e=be("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]),Ce=be("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Se=be("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]),De=be("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),Me=be("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Ee=be("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Re=be("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Te=be("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Ae=be("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),$e=be("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),ze=be("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),qe=be("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Fe=be("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Ie=be("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]),Le=be("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),Pe=be("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Oe=be("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),We=be("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),Be=be("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Ue=be("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),He=be("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ve=be("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),Ke=be("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]),Je=be("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Ye=be("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Ze=be("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ge=be("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),Qe=be("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Xe=be("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),et=be("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),tt=be("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),rt=be("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]),at=be("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),st=be("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),nt=be("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),lt=be("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),it=be("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),dt=be("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),ot=be("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),ct=be("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),xt=be("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),mt=be("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),ut=be("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),gt=be("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),ht=be("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),bt=be("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),pt=be("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),yt=be("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),ft=be("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]),jt=be("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),vt=be("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),wt=be("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Nt=be("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),kt=be("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),_t=be("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),Ct=be("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),St=be("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Dt=be("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),Mt=be("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Et=be("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),Rt=be("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Tt=be("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),At=be("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),$t=be("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),zt=be("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),qt=be("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Ft=be("Sliders",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),It=be("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Lt=be("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),Pt=be("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Ot=be("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Wt=be("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),Bt=be("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),Ut=be("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ht=be("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Vt=be("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Kt=be("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Jt=be("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Yt=be("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Zt=be("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Gt=be("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),Qt=be("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Xt=be("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),er=be("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),tr=be("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]),rr=be("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ar=be("Wind",[["path",{d:"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2",key:"1k4u03"}],["path",{d:"M9.6 4.6A2 2 0 1 1 11 8H2",key:"b7d0fd"}],["path",{d:"M12.6 19.4A2 2 0 1 0 14 16H2",key:"1p5cb3"}]]),sr=be("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),nr=be("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function lr({onLogin:e}){const[t,a]=r.useState(""),[s,n]=r.useState(""),[l,i]=r.useState(!1),[d,o]=r.useState(""),[c,x]=r.useState(!1),[m,u]=r.useState(!1),[g,h]=r.useState(""),[b,p]=r.useState(!1),[y,f]=r.useState("");return R.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4 transition-colors",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md transition-colors",children:[R.jsxs("div",{className:"text-center mb-8",children:[R.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-colors",children:R.jsx(mt,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),R.jsxs("h1",{className:"flex items-baseline justify-center space-x-2 mb-2 transition-colors",children:[R.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"-0.02em"},children:"Bekuta"}),R.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",style:{letterSpacing:"0.05em"},children:"by ARCA"})]}),R.jsx("p",{className:"text-gray-600 dark:text-gray-300 transition-colors",children:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¸ãƒ­ã‚°ã‚¤ãƒ³"})]}),R.jsxs("form",{onSubmit:async r=>{var a,n,l,d,c;if(r.preventDefault(),t.trim()&&s)if(t.includes("@")){i(!0),o("");try{console.log("ğŸ” Login attempt for:",t.trim()),await e(t.trim(),s),console.log("âœ… Login successful")}catch(x){console.error("âŒ Login error:",x),console.error("Error message:",x.message),console.error("Error details:",x),(null==(a=x.message)?void 0:a.includes("Invalid login credentials"))||(null==(n=x.message)?void 0:n.includes("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"))?o("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚\n\nè€ƒãˆã‚‰ã‚Œã‚‹åŸå› ï¼š\nâ€¢ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ãªã„\nâ€¢ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹\nâ€¢ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé–“é•ã£ã¦ã„ã‚‹\n\nç®¡ç†è€…ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚"):(null==(l=x.message)?void 0:l.includes("Email not confirmed"))?o("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚"):(null==(d=x.message)?void 0:d.includes("Too many requests"))?o("ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒå¤šã™ãã¾ã™ã€‚5åˆ†ç¨‹åº¦å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"):(null==(c=x.message)?void 0:c.includes("Missing Supabase environment variables"))?o("ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚¨ãƒ©ãƒ¼ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚"):o(x.message||"ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã™ã‚‹ã‹ã€ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚")}finally{i(!1)}}else o("æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");else o("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")},className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsx("input",{type:"email",id:"email",value:t,onChange:e=>a(e.target.value),className:"\n                w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg \n                focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent \n                transition-colors text-base\n                bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                placeholder-gray-500 dark:placeholder-gray-400\n              ",placeholder:"your-email@example.com",required:!0,disabled:l,autoComplete:"email",style:{fontSize:"16px",WebkitAppearance:"none",WebkitBorderRadius:"0.5rem"}})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"}),R.jsxs("div",{className:"relative",children:[R.jsx("input",{type:c?"text":"password",id:"password",value:s,onChange:e=>n(e.target.value),className:"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent \n                  transition-colors text-base\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                ",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,disabled:l,autoComplete:"current-password",style:{fontSize:"16px",WebkitAppearance:"none",WebkitBorderRadius:"0.5rem"}}),R.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),x(e=>!e)},className:"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors touch-target\n                ",disabled:l,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:c?R.jsx(Ye,{className:"w-5 h-5"}):R.jsx(Ze,{className:"w-5 h-5"})})]})]}),d&&R.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors",children:[R.jsx(ye,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),R.jsxs("div",{className:"text-sm",children:[R.jsx("p",{className:"font-medium mb-1",children:"ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼"}),R.jsx("p",{className:"whitespace-pre-line",children:d})]})]}),R.jsx("button",{type:"submit",disabled:l,className:"\n              w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg\n              hover:bg-blue-700 dark:hover:bg-blue-600\n              focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800\n              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium touch-target\n            ",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:l?"ãƒ­ã‚°ã‚¤ãƒ³ä¸­...":"ãƒ­ã‚°ã‚¤ãƒ³"}),R.jsx("div",{className:"mt-4 text-center",children:R.jsx("button",{type:"button",onClick:()=>{u(!0),h(t),f(""),p(!1)},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆ"})})]}),R.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 transition-colors",children:[R.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 transition-colors",children:R.jsxs("div",{className:"flex items-start space-x-2",children:[R.jsx(lt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"åˆå›åˆ©ç”¨ã®æ–¹ã¸"}),R.jsxs("div",{className:"text-blue-700 dark:text-blue-400 space-y-1 text-left text-xs",children:[R.jsx("p",{children:"1. ç®¡ç†è€…ã‹ã‚‰ã€ŒBekuta æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã€ã‚’å—ã‘å–ã‚‹"}),R.jsx("p",{children:"2. ãƒ¡ãƒ¼ãƒ«å†…ã®ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™"}),R.jsx("p",{children:"3. è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€ãã®å¾Œã“ã®ç”»é¢ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³"})]})]})]})}),R.jsx("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg transition-colors",children:R.jsxs("div",{className:"flex items-start space-x-2",children:[R.jsx(ye,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),R.jsxs("div",{className:"text-amber-700 dark:text-amber-400 text-xs text-left",children:[R.jsx("p",{className:"font-medium mb-1",children:"ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å ´åˆ"}),R.jsx("p",{children:"ç®¡ç†è€…ã«ä»¥ä¸‹ã®æƒ…å ±ã‚’ãŠä¼ãˆãã ã•ã„ï¼š"}),R.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[R.jsx("li",{children:"ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsx("li",{children:"ã€Œæ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã€ã¾ãŸã¯ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã€ã‚’å—ã‘å–ã£ã¦ã„ã‚‹ã‹"}),R.jsx("li",{children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼ˆå¤‰æ›´ï¼‰ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã©ã†ã‹"}),R.jsx("li",{children:"ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹"})]})]})]})}),R.jsx("p",{className:"mt-4 text-xs",children:"ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒä¸æ˜ãªå ´åˆã¯ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„"})]})]}),m&&R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ"}),b?R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[R.jsx("p",{className:"text-green-800 dark:text-green-300 text-sm",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚"}),R.jsx("p",{className:"text-green-700 dark:text-green-400 text-sm mt-2",children:"ãƒ¡ãƒ¼ãƒ«ã«è¨˜è¼‰ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’æŠ¼ã—ã¦ã€è¡¨ç¤ºã•ã‚ŒãŸç”»é¢ã§æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"})]}),R.jsx("button",{onClick:()=>{u(!1),p(!1),h("")},className:"w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors",children:"é–‰ã˜ã‚‹"})]}):R.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(""),p(!1);const t=g.trim();if(!t||!t.includes("@"))return void f("æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const r="sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH";i(!0);try{console.log("ğŸ” Requesting password reset for:",t);const e=await fetch("http://127.0.0.1:54321/functions/v1/request-password-reset",{method:"POST",headers:{"Content-Type":"application/json",apikey:r,Authorization:`Bearer ${r}`},body:JSON.stringify({email:t,redirectUrl:window.location.origin})}),a=await e.json().catch(()=>({}));if(!e.ok)return console.error("âŒ request-password-reset error:",e.status,a),void(404===e.status?f("ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™»éŒ²ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã‹ã€ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚"):f((null==a?void 0:a.error)||"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"));console.log("âœ… Password reset request accepted:",a),p(!0)}catch(a){console.error("âŒ Password reset request failed:",a),f("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã‚’ç¢ºèªã™ã‚‹ã‹ã€ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚")}finally{i(!1)}},className:"space-y-4",children:[R.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨ã®ãƒªãƒ³ã‚¯ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚",R.jsx("br",{}),R.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€»ä»¥å‰ã¨åŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã¯å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsx("input",{type:"email",value:g,onChange:e=>h(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors",placeholder:"email@example.com",disabled:l})]}),y&&R.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400",children:[R.jsx(ye,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),R.jsx("p",{className:"text-sm whitespace-pre-line",children:y})]}),R.jsxs("div",{className:"flex space-x-3",children:[R.jsx("button",{type:"button",onClick:()=>{u(!1),f(""),h("")},className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",disabled:l,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{type:"submit",disabled:l,className:"flex-1 bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?"é€ä¿¡ä¸­...":"ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡"})]})]})]})})]})}var ir={};!function e(t,r,a,s){var n=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),l="function"==typeof Path2D&&"function"==typeof DOMMatrix;function i(){}function d(e){var a=r.exports.Promise,s=void 0!==a?a:t.Promise;return"function"==typeof s?new s(e):(e(i,i),null)}var o,c,x,m,u,g,h=function(e,t){return{transform:function(r){if(e)return r;if(t.has(r))return t.get(r);var a=new OffscreenCanvas(r.width,r.height);return a.getContext("2d").drawImage(r,0,0),t.set(r,a),a},clear:function(){t.clear()}}}(function(){if(!t.OffscreenCanvas)return!1;try{var e=new OffscreenCanvas(1,1),r=e.getContext("2d");r.fillRect(0,0,1,1);var a=e.transferToImageBitmap();r.createPattern(a,"no-repeat")}catch(s){return!1}return!0}(),new Map),b=(x=Math.floor(1e3/60),m={},u=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(o=function(e){var t=Math.random();return m[t]=requestAnimationFrame(function r(a){u===a||u+x-1<a?(u=a,delete m[t],e()):m[t]=requestAnimationFrame(r)}),t},c=function(e){m[e]&&cancelAnimationFrame(m[e])}):(o=function(e){return setTimeout(e,x)},c=function(e){return clearTimeout(e)}),{frame:o,cancel:c}),p=function(){var t,r,s={};return function(){if(t)return t;if(!a&&n){var l=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{t=new Worker(URL.createObjectURL(new Blob([l])))}catch(i){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("ğŸŠ Could not load worker",i),null}!function(e){function t(t,r){e.postMessage({options:t||{},callback:r})}e.init=function(t){var r=t.transferControlToOffscreen();e.postMessage({canvas:r},[r])},e.fire=function(a,n,l){if(r)return t(a,null),r;var i=Math.random().toString(36).slice(2);return r=d(function(n){function d(t){t.data.callback===i&&(delete s[i],e.removeEventListener("message",d),r=null,h.clear(),l(),n())}e.addEventListener("message",d),t(a,i),s[i]=d.bind(null,{data:{callback:i}})})},e.reset=function(){for(var t in e.postMessage({reset:!0}),s)s[t](),delete s[t]}}(t)}return t}}(),y={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function f(e,t,r){return function(e,t){return t?t(e):e}(e&&null!=e[t]?e[t]:y[t],r)}function j(e){return e<0?0:Math.floor(e)}function v(e,t){return Math.floor(Math.random()*(t-e))+e}function w(e){return parseInt(e,16)}function N(e){return e.map(k)}function k(e){var t=String(e).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:w(t.substring(0,2)),g:w(t.substring(2,4)),b:w(t.substring(4,6))}}function _(e){e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight}function C(e){var t=e.getBoundingClientRect();e.width=t.width,e.height=t.height}function S(e){var t=e.angle*(Math.PI/180),r=e.spread*(Math.PI/180);return{x:e.x,y:e.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*e.startVelocity+Math.random()*e.startVelocity,angle2D:-t+(.5*r-Math.random()*r),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:e.color,shape:e.shape,tick:0,totalTicks:e.ticks,decay:e.decay,drift:e.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*e.gravity,ovalScalar:.6,scalar:e.scalar,flat:e.flat}}function D(e,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var r=t.tick++/t.totalTicks,a=t.x+t.random*t.tiltCos,s=t.y+t.random*t.tiltSin,n=t.wobbleX+t.random*t.tiltCos,i=t.wobbleY+t.random*t.tiltSin;if(e.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-r)+")",e.beginPath(),l&&"path"===t.shape.type&&"string"==typeof t.shape.path&&Array.isArray(t.shape.matrix))e.fill(function(e,t,r,a,s,n,l){var i=new Path2D(e),d=new Path2D;d.addPath(i,new DOMMatrix(t));var o=new Path2D;return o.addPath(d,new DOMMatrix([Math.cos(l)*s,Math.sin(l)*s,-Math.sin(l)*n,Math.cos(l)*n,r,a])),o}(t.shape.path,t.shape.matrix,t.x,t.y,.1*Math.abs(n-a),.1*Math.abs(i-s),Math.PI/10*t.wobble));else if("bitmap"===t.shape.type){var d=Math.PI/10*t.wobble,o=.1*Math.abs(n-a),c=.1*Math.abs(i-s),x=t.shape.bitmap.width*t.scalar,m=t.shape.bitmap.height*t.scalar,u=new DOMMatrix([Math.cos(d)*o,Math.sin(d)*o,-Math.sin(d)*c,Math.cos(d)*c,t.x,t.y]);u.multiplySelf(new DOMMatrix(t.shape.matrix));var g=e.createPattern(h.transform(t.shape.bitmap),"no-repeat");g.setTransform(u),e.globalAlpha=1-r,e.fillStyle=g,e.fillRect(t.x-x/2,t.y-m/2,x,m),e.globalAlpha=1}else if("circle"===t.shape)e.ellipse?e.ellipse(t.x,t.y,Math.abs(n-a)*t.ovalScalar,Math.abs(i-s)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):function(e,t,r,a,s,n,l,i,d){e.save(),e.translate(t,r),e.rotate(n),e.scale(a,s),e.arc(0,0,1,l,i,d),e.restore()}(e,t.x,t.y,Math.abs(n-a)*t.ovalScalar,Math.abs(i-s)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if("star"===t.shape)for(var b=Math.PI/2*3,p=4*t.scalar,y=8*t.scalar,f=t.x,j=t.y,v=5,w=Math.PI/v;v--;)f=t.x+Math.cos(b)*y,j=t.y+Math.sin(b)*y,e.lineTo(f,j),b+=w,f=t.x+Math.cos(b)*p,j=t.y+Math.sin(b)*p,e.lineTo(f,j),b+=w;else e.moveTo(Math.floor(t.x),Math.floor(t.y)),e.lineTo(Math.floor(t.wobbleX),Math.floor(s)),e.lineTo(Math.floor(n),Math.floor(i)),e.lineTo(Math.floor(a),Math.floor(t.wobbleY));return e.closePath(),e.fill(),t.tick<t.totalTicks}function M(e,r){var l,i=!e,o=!!f(r||{},"resize"),c=!1,x=f(r,"disableForReducedMotion",Boolean),m=n&&!!f(r||{},"useWorker")?p():null,u=i?_:C,g=!(!e||!m)&&!!e.__confetti_initialized,y="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function w(t,r,n){for(var i=f(t,"particleCount",j),o=f(t,"angle",Number),c=f(t,"spread",Number),x=f(t,"startVelocity",Number),m=f(t,"decay",Number),g=f(t,"gravity",Number),p=f(t,"drift",Number),y=f(t,"colors",N),w=f(t,"ticks",Number),k=f(t,"shapes"),_=f(t,"scalar"),C=!!f(t,"flat"),M=function(e){var t=f(e,"origin",Object);return t.x=f(t,"x",Number),t.y=f(t,"y",Number),t}(t),E=i,R=[],T=e.width*M.x,A=e.height*M.y;E--;)R.push(S({x:T,y:A,angle:o,spread:c,startVelocity:x,color:y[E%y.length],shape:k[v(0,k.length)],ticks:w,decay:m,gravity:g,drift:p,scalar:_,flat:C}));return l?l.addFettis(R):(l=function(e,t,r,n,l){var i,o,c=t.slice(),x=e.getContext("2d"),m=d(function(t){function d(){i=o=null,x.clearRect(0,0,n.width,n.height),h.clear(),l(),t()}i=b.frame(function t(){!a||n.width===s.width&&n.height===s.height||(n.width=e.width=s.width,n.height=e.height=s.height),n.width||n.height||(r(e),n.width=e.width,n.height=e.height),x.clearRect(0,0,n.width,n.height),(c=c.filter(function(e){return D(x,e)})).length?i=b.frame(t):d()}),o=d});return{addFettis:function(e){return c=c.concat(e),m},canvas:e,promise:m,reset:function(){i&&b.cancel(i),o&&o()}}}(e,R,u,r,n),l.promise)}function k(r){var a=x||f(r,"disableForReducedMotion",Boolean),s=f(r,"zIndex",Number);if(a&&y)return d(function(e){e()});i&&l?e=l.canvas:i&&!e&&(e=function(e){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=e,t}(s),document.body.appendChild(e)),o&&!g&&u(e);var n={width:e.width,height:e.height};function h(){if(m){var t={getBoundingClientRect:function(){if(!i)return e.getBoundingClientRect()}};return u(t),void m.postMessage({resize:{width:t.width,height:t.height}})}n.width=n.height=null}function b(){l=null,o&&(c=!1,t.removeEventListener("resize",h)),i&&e&&(document.body.contains(e)&&document.body.removeChild(e),e=null,g=!1)}return m&&!g&&m.init(e),g=!0,m&&(e.__confetti_initialized=!0),o&&!c&&(c=!0,t.addEventListener("resize",h,!1)),m?m.fire(r,n,b):w(r,n,b)}return k.reset=function(){m&&m.reset(),l&&l.reset()},k}function E(){return g||(g=M(null,{useWorker:!0,resize:!0})),g}r.exports=function(){return E().apply(this,arguments)},r.exports.reset=function(){E().reset()},r.exports.create=M,r.exports.shapeFromPath=function(e){if(!l)throw new Error("path confetti are not supported in this browser");var t,r;"string"==typeof e?t=e:(t=e.path,r=e.matrix);var a=new Path2D(t),s=document.createElement("canvas").getContext("2d");if(!r){for(var n,i,d=1e3,o=d,c=d,x=0,m=0,u=0;u<d;u+=2)for(var g=0;g<d;g+=2)s.isPointInPath(a,u,g,"nonzero")&&(o=Math.min(o,u),c=Math.min(c,g),x=Math.max(x,u),m=Math.max(m,g));n=x-o,i=m-c;var h=Math.min(10/n,10/i);r=[h,0,0,h,-Math.round(n/2+o)*h,-Math.round(i/2+c)*h]}return{type:"path",path:t,matrix:r}},r.exports.shapeFromText=function(e){var t,r=1,a="#000000",s='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';"string"==typeof e?t=e:(t=e.text,r="scalar"in e?e.scalar:r,s="fontFamily"in e?e.fontFamily:s,a="color"in e?e.color:a);var n=10*r,l=n+"px "+s,i=new OffscreenCanvas(n,n),d=i.getContext("2d");d.font=l;var o=d.measureText(t),c=Math.ceil(o.actualBoundingBoxRight+o.actualBoundingBoxLeft),x=Math.ceil(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent),m=o.actualBoundingBoxLeft+2,u=o.actualBoundingBoxAscent+2;c+=4,x+=4,(d=(i=new OffscreenCanvas(c,x)).getContext("2d")).font=l,d.fillStyle=a,d.fillText(t,m,u);var g=1/r;return{type:"bitmap",bitmap:i.transferToImageBitmap(),matrix:[g,0,0,g,-c*g/2,-x*g/2]}}}(function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:this||{}}(),ir,!1);const dr=ir.exports;var or=ir.exports.create;const cr=Object.freeze(Object.defineProperty({__proto__:null,create:or,default:dr},Symbol.toStringTag,{value:"Module"}));function xr({onPasswordChange:e,userName:t}){const[a,s]=r.useState(""),[n,l]=r.useState(""),[i,d]=r.useState(!1),[o,c]=r.useState(!1),[x,m]=r.useState(!1),[u,g]=r.useState(""),[h,b]=r.useState(0),[p,y]=r.useState(0);r.useEffect(()=>{setTimeout(()=>b(1),100),setTimeout(()=>b(2),400)},[]),r.useEffect(()=>{const e=[f.minLength,f.hasUpperCase,f.hasLowerCase,f.hasNumbers,f.hasSpecialChar],t=e.filter(Boolean).length/e.length*100;y(t)},[a]);const f=(e=>{const t=e.length>=8,r=/[A-Z]/.test(e),a=/[a-z]/.test(e),s=/\d/.test(e),n=/[!@#$%^&*(),.?":{}|<>]/.test(e);return{minLength:t,hasUpperCase:r,hasLowerCase:a,hasNumbers:s,hasSpecialChar:n,isValid:t&&r&&a&&s&&n}})(a),j=a===n&&n.length>0;return R.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md transition-all duration-700 "+(h>=1?"opacity-100 scale-100":"opacity-0 scale-95"),children:[R.jsxs("div",{className:"text-center mb-8",children:[R.jsx("div",{className:"bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-all duration-500 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:R.jsx(It,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),R.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2 transition-all duration-500 delay-100 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:"ã‚ã¨1ã‚¹ãƒ†ãƒƒãƒ—ï¼"}),R.jsxs("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-2 transition-all duration-500 delay-200 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:["ã‚ˆã†ã“ãã€",t,"ã•ã‚“"]}),R.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-4 transition-all duration-500 delay-300 "+(h>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[R.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[R.jsx("div",{className:"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold",children:"1"}),R.jsx("div",{className:"w-12 h-1 bg-blue-600 dark:bg-blue-500 rounded"}),R.jsx("div",{className:"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold",children:"2"}),R.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded"}),R.jsx("div",{className:"w-8 h-8 bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 rounded-full flex items-center justify-center text-sm font-bold",children:"3"})]}),R.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„"})]})]}),R.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),g(""),f.isValid)if(j){m(!0);try{dr({particleCount:100,spread:70,origin:{y:.6}}),setTimeout(()=>{dr({particleCount:50,angle:60,spread:55,origin:{x:0}}),dr({particleCount:50,angle:120,spread:55,origin:{x:1}})},250),await e(a)}catch(r){console.error("Password change error:",r);const e=(null==r?void 0:r.message)||(null==r?void 0:r.error_description)||"";e.includes("different from the old password")?g("ä»¥å‰ã¨åŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚åˆ¥ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"):e.includes("Password should be at least")?g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å½¢å¼ãŒè¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚"):e.includes("Auth session missing")?g("ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãƒªãƒ³ã‚¯ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚"):g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")}finally{m(!1)}}else g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚");else g("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚")},className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"}),R.jsxs("div",{className:"relative",children:[R.jsx("input",{type:i?"text":"password",id:"newPassword",value:a,onChange:e=>s(e.target.value),className:"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent \n                  transition-colors\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                ",placeholder:"æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›",required:!0}),R.jsx("button",{type:"button",onClick:()=>d(!i),className:"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors\n                ",children:i?R.jsx(Ye,{className:"w-5 h-5"}):R.jsx(Ze,{className:"w-5 h-5"})})]})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª"}),R.jsxs("div",{className:"relative",children:[R.jsx("input",{type:o?"text":"password",id:"confirmPassword",value:n,onChange:e=>l(e.target.value),className:"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent \n                  transition-colors\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                ",placeholder:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†å…¥åŠ›",required:!0}),R.jsx("button",{type:"button",onClick:()=>c(!o),className:"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors\n                ",children:o?R.jsx(Ye,{className:"w-5 h-5"}):R.jsx(Ze,{className:"w-5 h-5"})})]})]}),a&&R.jsxs("div",{className:"mb-4",children:[R.jsxs("div",{className:"flex items-center justify-between mb-2",children:[R.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦"}),R.jsx("span",{className:"text-sm font-bold "+(p<40?"text-red-600 dark:text-red-400":p<80?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"),children:0===p?"":p<40?"å¼±ã„":p<80?"æ™®é€š":"å¼·ã„"})]}),R.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:R.jsx("div",{className:`h-full ${p<40?"bg-red-500":p<80?"bg-yellow-500":"bg-green-500"} transition-all duration-500 rounded-full`,style:{width:`${p}%`}})})]}),R.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-700 dark:to-blue-900/20 rounded-lg p-4 transition-colors",children:[R.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 transition-colors",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶"}),R.jsxs("div",{className:"space-y-2 text-sm",children:[R.jsxs("div",{className:"flex items-center transition-colors "+(f.minLength?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[R.jsx(Te,{className:"w-4 h-4 mr-2"}),R.jsx("span",{children:"8æ–‡å­—ä»¥ä¸Š"})]}),R.jsxs("div",{className:"flex items-center transition-colors "+(f.hasUpperCase?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[R.jsx(Te,{className:"w-4 h-4 mr-2"}),R.jsx("span",{children:"å¤§æ–‡å­—ã‚’å«ã‚€"})]}),R.jsxs("div",{className:"flex items-center transition-colors "+(f.hasLowerCase?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[R.jsx(Te,{className:"w-4 h-4 mr-2"}),R.jsx("span",{children:"å°æ–‡å­—ã‚’å«ã‚€"})]}),R.jsxs("div",{className:"flex items-center transition-colors "+(f.hasNumbers?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[R.jsx(Te,{className:"w-4 h-4 mr-2"}),R.jsx("span",{children:"æ•°å­—ã‚’å«ã‚€"})]}),R.jsxs("div",{className:"flex items-center transition-colors "+(f.hasSpecialChar?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[R.jsx(Te,{className:"w-4 h-4 mr-2"}),R.jsx("span",{children:"ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€ (!@#$%^&*)"})]})]})]}),n.length>0&&R.jsxs("div",{className:"flex items-center text-sm transition-colors "+(j?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[R.jsx(Te,{className:"w-4 h-4 mr-2"}),R.jsx("span",{children:j?"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¦ã„ã¾ã™":"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“"})]}),u&&R.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors",children:[R.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),R.jsx("span",{className:"text-sm",children:u})]}),R.jsx("button",{type:"submit",disabled:x||!f.isValid||!j,className:"\n              w-full bg-orange-600 dark:bg-orange-700 text-white py-3 px-4 rounded-lg \n              hover:bg-orange-700 dark:hover:bg-orange-600 \n              focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800 \n              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium\n            ",children:x?"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ä¸­...":"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´"})]}),R.jsxs("div",{className:"mt-6 text-center",children:[R.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 mb-3",children:R.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 font-medium",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å¾Œã€ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ã§ã™ï¼"})}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"è‡ªå‹•çš„ã«ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚Œã¾ã™"})]})]})})}function mr({onContinue:e}){const[t,a]=r.useState(!0),[s,n]=r.useState(null),[l,i]=r.useState(null),[d,o]=r.useState(0),c=new URL(window.location.href).searchParams.get("token")??"";r.useEffect(()=>{(async()=>{try{if(!c)return n("æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆURLã« token ãŒã‚ã‚Šã¾ã›ã‚“ï¼‰"),void a(!1);console.log("ğŸ” Fetching invitation with token:",c),console.log("ğŸ“¡ Supabase URL:","http://127.0.0.1:54321");const e=await fetch(`http://127.0.0.1:54321/rest/v1/invitation_tokens?token=eq.${c}&select=email,name,role,team_id,organization_id,invited_by,expires_at`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json",Prefer:"return=representation"}});if(console.log("ğŸ“¬ Response status:",e.status),!e.ok){const t=await e.text();return console.error("âŒ API Error:",t),n(`æ‹›å¾…æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ (${e.status})`),void a(!1)}const t=await e.json();if(console.log("ğŸ“¦ Received data:",t),!t||0===t.length)return console.warn("âš ï¸ No invitation found for token"),n("æ‹›å¾…ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã¾ãŸã¯æœŸé™åˆ‡ã‚Œã§ã™"),void a(!1);const r=t[0];let s,l;if(console.log("âœ… Invitation found:",r),r.team_id){console.log("ğŸ¢ Fetching team info for:",r.team_id);const e=await fetch(`http://127.0.0.1:54321/rest/v1/teams?id=eq.${r.team_id}&select=name`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json"}});if(e.ok){const t=await e.json();t&&t.length>0&&(s=t[0].name,console.log("âœ… Team found:",s))}}if(r.organization_id){console.log("ğŸ¢ Fetching organization info for:",r.organization_id);const e=await fetch(`http://127.0.0.1:54321/rest/v1/organizations?id=eq.${r.organization_id}&select=name`,{headers:{apikey:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",Authorization:"Bearer sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH","Content-Type":"application/json"}});if(e.ok){const t=await e.json();t&&t.length>0&&(l=t[0].name,console.log("âœ… Organization found:",l))}}i({email:r.email,name:r.name,role:r.role,team_name:s,organization_name:l,expires_at:r.expires_at}),a(!1),setTimeout(()=>o(1),100),setTimeout(()=>o(2),400),setTimeout(()=>o(3),800),setTimeout(()=>{dr({particleCount:100,spread:70,origin:{y:.6}})},1200)}catch(e){console.error("âŒ Error fetching invitation:",e),n("æ‹›å¾…æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"),a(!1)}})()},[c]);return t?R.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors",children:R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 dark:border-blue-400 mx-auto mb-4"}),R.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg",children:"æ‹›å¾…æƒ…å ±ã‚’ç¢ºèªä¸­..."})]})}):s||!l?R.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-900 dark:to-red-900 flex items-center justify-center p-4 transition-colors",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[R.jsx("div",{className:"bg-red-100 dark:bg-red-900 rounded-full p-4 w-16 h-16 mx-auto mb-4",children:R.jsx(Oe,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),R.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"æ‹›å¾…ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã§ã™"}),R.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:s||"æ‹›å¾…ãƒªãƒ³ã‚¯ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æœŸé™åˆ‡ã‚Œã§ã™"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ç®¡ç†è€…ã«æ–°ã—ã„æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãã ã•ã„"})]})}):R.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden",children:R.jsxs("div",{className:"max-w-2xl w-full",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden transform transition-all duration-700 "+(d>=1?"opacity-100 scale-100":"opacity-0 scale-95"),children:[R.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 px-8 py-12 text-center relative overflow-hidden",children:[R.jsx("div",{className:"absolute inset-0 bg-white dark:bg-gray-900 opacity-10",children:R.jsx("div",{className:"absolute top-0 left-0 w-full h-full",style:{backgroundImage:"radial-gradient(circle, white 1px, transparent 1px)",backgroundSize:"30px 30px"}})}),R.jsxs("div",{className:"transform transition-all duration-700 delay-200 "+(d>=2?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-full p-4 w-20 h-20 mx-auto mb-6 shadow-lg",children:R.jsx(It,{className:"w-12 h-12 text-indigo-600 dark:text-indigo-400"})}),R.jsxs("h1",{className:"text-4xl font-bold text-white mb-3",children:["ã‚ˆã†ã“ãã€",l.name,"ã•ã‚“ï¼"]}),(l.organization_name||l.team_name)&&R.jsxs("div",{className:"space-y-2",children:[l.organization_name&&R.jsxs("div",{className:"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg",children:[R.jsx(rr,{className:"w-5 h-5"}),R.jsx("span",{className:"font-semibold",children:l.organization_name}),l.team_name&&R.jsx("span",{children:"-"}),l.team_name&&R.jsx("span",{className:"font-semibold",children:l.team_name}),R.jsx("span",{children:"ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™"})]}),!l.organization_name&&l.team_name&&R.jsxs("div",{className:"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg",children:[R.jsx(rr,{className:"w-5 h-5"}),R.jsx("span",{className:"font-semibold",children:l.team_name}),R.jsx("span",{children:"ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™"})]})]}),R.jsx("p",{className:"text-blue-100 dark:text-blue-200 text-lg mt-2",children:"Bekuta ã¸ã®æ‹›å¾…"})]})]}),R.jsx("div",{className:"px-8 py-10",children:R.jsxs("div",{className:"transform transition-all duration-700 delay-400 "+(d>=3?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[R.jsxs("div",{className:"space-y-6 mb-8",children:[R.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl",children:[R.jsx("div",{className:"flex-shrink-0 mt-1",children:R.jsx(Re,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"ã‚ãªãŸã®å½¹å‰²"}),R.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[(e=>{switch(e){case"athlete":return"ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ";case"staff":return"ã‚¹ã‚¿ãƒƒãƒ•";case"global_admin":return"ç®¡ç†è€…";default:return e}})(l.role),"ã¨ã—ã¦å‚åŠ ã—ã¾ã™"]})]})]}),R.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl",children:[R.jsx("div",{className:"flex-shrink-0 mt-1",children:R.jsx(Re,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:l.email})]})]}),R.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl",children:[R.jsx("div",{className:"flex-shrink-0 mt-1",children:R.jsx(Oe,{className:"w-6 h-6 text-amber-600 dark:text-amber-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"æ‹›å¾…ã®æœ‰åŠ¹æœŸé™"}),R.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:(e=>{const t=new Date,r=new Date(e).getTime()-t.getTime(),a=Math.floor(r/36e5),s=Math.floor(r%36e5/6e4);return a>0?`ã‚ã¨${a}æ™‚é–“`:s>0?`ã‚ã¨${s}åˆ†`:"é–“ã‚‚ãªãæœŸé™åˆ‡ã‚Œ"})(l.expires_at)})]})]})]}),R.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-8",children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3 text-center",children:"æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—"}),R.jsxs("ol",{className:"space-y-2 text-gray-600 dark:text-gray-300 text-sm",children:[R.jsxs("li",{className:"flex items-start space-x-2",children:[R.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),R.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«ã«è¨˜è¼‰ã•ã‚ŒãŸä¸€æ™‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³"})]}),R.jsxs("li",{className:"flex items-start space-x-2",children:[R.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),R.jsx("span",{children:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«å¤‰æ›´"})]}),R.jsxs("li",{className:"flex items-start space-x-2",children:[R.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),R.jsx("span",{children:"ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ï¼"})]})]})]}),R.jsxs("button",{onClick:()=>{l&&(dr({particleCount:50,angle:60,spread:55,origin:{x:0}}),dr({particleCount:50,angle:120,spread:55,origin:{x:1}}),setTimeout(()=>{e()},500))},className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 text-white py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 dark:hover:from-blue-600 dark:hover:to-indigo-600 transition-all duration-300 font-semibold text-lg flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105",children:[R.jsx("span",{children:"ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å§‹ã‚ã‚‹"}),R.jsx(ve,{className:"w-5 h-5"})]})]})})]}),R.jsx("p",{className:"text-center text-sm text-gray-600 dark:text-gray-400 mt-6",children:"å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„"})]})})}function ur({isOpen:e,onClose:t,onOverwrite:a,onCancel:s,title:n,date:l,existingValues:i,newValues:d}){return r.useEffect(()=>{if(!e)return;const t=document.body.style.overflow,r=document.body.style.touchAction;return document.body.style.overflow="hidden",document.body.style.touchAction="none",()=>{document.body.style.overflow=t,document.body.style.touchAction=r}},[e]),e?R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 overscroll-contain",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[85vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[R.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center",children:R.jsx(fe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™"})]}),R.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",type:"button",children:R.jsx(sr,{className:"w-5 h-5"})})]}),R.jsxs("div",{className:"p-6",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"ã“ã®æ—¥ä»˜ã«ã¯æ—¢ã«ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ"}),R.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 mb-4",children:R.jsxs("div",{className:"space-y-3",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:"è¨˜éŒ²ã‚¿ã‚¤ãƒ—"}),R.jsx("p",{className:"text-base text-gray-900 dark:text-white",children:n})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:"æ—¥ä»˜"}),R.jsx("p",{className:"text-base text-gray-900 dark:text-white",children:new Date(l).toLocaleDateString("ja-JP")})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-gray-200 dark:border-gray-700",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"ç¾åœ¨ã®å€¤"}),R.jsx("div",{className:"space-y-1",children:i.map((e,t)=>R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.label}),R.jsx("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:e.value})]},t))})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"æ–°ã—ã„å€¤"}),R.jsx("div",{className:"space-y-1",children:d.map((e,t)=>R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.label}),R.jsx("p",{className:"text-base font-semibold text-blue-600 dark:text-blue-400",children:e.value})]},t))})]})]})]})}),R.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4",children:R.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"ä¸Šæ›¸ãã™ã‚‹ã¨ã€ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"})})]}),R.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-lg",children:[R.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",type:"button",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",type:"button",children:"ä¸Šæ›¸ãã™ã‚‹"})]})]})}):null}const gr=(e,t,r)=>Math.max(t,Math.min(r,e));function hr({value:e,onChange:t,label:a="æˆé•·å®Ÿæ„Ÿ",hint:s="ä»Šæ—¥ã®ç·´ç¿’ã§ã®æˆé•·å®Ÿæ„Ÿã¯ï¼Ÿ"}){const n=r.useRef(null),l=r.useRef(!1),[i,d]=r.useState(!1),o=gr(Math.round(e),0,100),c=r.useMemo(()=>0===o?0:o<=20?1:o<=40?2:o<=60?3:o<=80?4:5,[o]),x=r.useMemo(()=>{switch(c){case 0:return"ãªã—";case 1:return"ã¡ã‚‡ã„";case 2:return"å°‘ã—";case 3:return"ãã“ãã“";case 4:return"ã‹ãªã‚Š";case 5:return"ã‚ã¡ã‚ƒ";default:return""}},[c]),m=r.useMemo(()=>{const e=2.5+o/100*11.5;return{x0:24,y:70,x1:24+(18+o/100*202),stroke:e,head:10+1.2*e}},[o]),u=e=>{const r=n.current;if(!r)return;const a=r.getBoundingClientRect(),s=gr(e-a.left,24,a.width-24),l=a.width-24-24,i=Math.round((s-24)/l*100);t(gr(i,0,100))};return r.useEffect(()=>{const e=()=>(l.current=!1,void d(!1));return window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointercancel",e)}},[]),R.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a}),R.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-300 mt-1",children:s})]}),R.jsx("div",{className:"text-right",children:R.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:x})})]}),R.jsx("div",{ref:n,className:"mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none "+(i?"ring-2 ring-blue-500":""),onPointerDown:e=>{var t,r;l.current=!0,d(!0),null==(r=(t=e.currentTarget).setPointerCapture)||r.call(t,e.pointerId),u(e.clientX)},onPointerMove:e=>{l.current&&u(e.clientX)},style:{touchAction:"none",WebkitTapHighlightColor:"transparent"},children:R.jsxs("svg",{viewBox:"0 0 300 140",className:"w-full h-20",children:[R.jsx("line",{x1:"24",y1:"70",x2:"276",y2:"70",stroke:"currentColor",opacity:"0.10",strokeWidth:"2"}),(()=>{const e=m.x1,t=m.y,r=Math.max(14,2.2*m.stroke),a=Math.max(10,1.2*m.stroke),s=e-r;return R.jsxs(R.Fragment,{children:[R.jsx("line",{x1:m.x0,y1:t,x2:s,y2:t,stroke:"currentColor",className:"text-blue-600 dark:text-blue-400",strokeWidth:m.stroke,strokeLinecap:"butt"}),R.jsx("polygon",{points:`\n                  ${e},${t}\n                  ${s},${t-a}\n                  ${s},${t+a}\n                `,fill:"currentColor",className:"text-blue-600 dark:text-blue-400"}),R.jsx("circle",{cx:e,cy:t,r:18,fill:"transparent",pointerEvents:"all"})]})})()]})})]})}const br=(e,t,r)=>Math.max(t,Math.min(r,e));function pr({value:e,onChange:t,label:a="ç†è§£åº¦",hint:s="ä»Šæ—¥ã®ç·´ç¿’ã®ç†è§£åº¦(ç›®çš„/ã‚³ãƒ„)ã¯ï¼Ÿ"}){const n=r.useRef(null),l=r.useRef(!1),[i,d]=r.useState(!1),o=br(Math.round(e),0,100),c=r.useMemo(()=>0===o?0:o<=20?1:o<=40?2:o<=60?3:o<=80?4:5,[o]),x=r.useMemo(()=>{switch(c){case 0:return"åˆ†ã‹ã‚‰ã‚“";case 1:return"ã†ã£ã™ã‚‰";case 2:return"å°‘ã—";case 3:return"ã ã„ãŸã„";case 4:return"ã‹ãªã‚Š";case 5:return"è…¹è½ã¡";default:return""}},[c]),m=r.useMemo(()=>{const e=1+o/100*.18,t=o/100*5;return[18,30,44,60,78].map((r,a)=>{const s=br(t-a,0,1);return{height:Math.round(r*e),lit:s}})},[o]),u=e=>{const r=n.current;if(!r)return;const a=r.getBoundingClientRect(),s=br(e-a.left,16,a.width-16),l=a.width-16-16,i=Math.round((s-16)/l*100);t(br(i,0,100))};return r.useEffect(()=>{const e=()=>(l.current=!1,void d(!1));return window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointercancel",e)}},[]),R.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a}),R.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-300 mt-1",children:s})]}),R.jsx("div",{className:"text-right",children:R.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:x})})]}),R.jsx("div",{ref:n,className:"mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none "+(i?"ring-2 ring-blue-500":""),onPointerDown:e=>{var t,r;l.current=!0,d(!0),null==(r=(t=e.currentTarget).setPointerCapture)||r.call(t,e.pointerId),u(e.clientX)},onPointerMove:e=>{l.current&&u(e.clientX)},style:{touchAction:"none",WebkitTapHighlightColor:"transparent"},children:R.jsx("div",{className:"flex items-end justify-center gap-3 h-24",children:m.map((e,t)=>{const r=.25+.75*e.lit,a=10+8*e.lit;return R.jsx("div",{className:"flex flex-col items-center gap-2",children:R.jsx("div",{className:"rounded-full bg-blue-600 dark:bg-blue-400",style:{height:e.height,width:a,opacity:r,transition:"height 120ms ease, width 120ms ease, opacity 120ms ease"}})},t)})})})]})}function yr({open:e,message:t,type:a="success",durationMs:s=1800,onClose:n}){if(r.useEffect(()=>{if(!e)return;const t=window.setTimeout(n,s);return()=>window.clearTimeout(t)},[e,s,n]),!e)return null;const l="success"===a,i="error"===a;return R.jsx("div",{className:"fixed bottom-5 left-1/2 -translate-x-1/2 z-[80] px-4",children:R.jsxs("div",{className:["flex items-center gap-3 rounded-xl shadow-xl border px-4 py-3 w-[min(92vw,420px)]","bg-white dark:bg-gray-900",l?"border-green-200 dark:border-green-900/40":i?"border-red-200 dark:border-red-900/40":"border-gray-200 dark:border-gray-700"].join(" "),role:"status","aria-live":"polite",children:[l?R.jsx(Re,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):i?R.jsx(fe,{className:"w-5 h-5 text-red-600 dark:text-red-400"}):R.jsx(Re,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"}),R.jsx("div",{className:"flex-1 text-sm text-gray-900 dark:text-gray-100",children:t}),R.jsx("button",{type:"button",onClick:n,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200","aria-label":"é–‰ã˜ã‚‹",children:R.jsx(sr,{className:"w-4 h-4"})})]})})}function fr({userId:e,onSubmit:t,onCheckExisting:a,onUpdate:s,loading:n,lastRecord:l,weeklyAverage:i,daysWithData:d=0,consecutiveDays:o=0}){var c,x;const m=(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})(),[u,g]=r.useState(0),[h,b]=r.useState(0),[p,y]=r.useState(m),[f,j]=r.useState(50),[v,w]=r.useState(50),[N,k]=r.useState(!1),[_,C]=r.useState(""),[S,D]=r.useState(""),[M,E]=r.useState(null),[T,A]=r.useState(!1),[$,z]=r.useState(null),[q,F]=r.useState(null),[I,L]=r.useState(!1),[P,O]=r.useState("success"),[W,B]=r.useState(""),U=(e,t)=>{O(e),B(t),L(!0)},H=()=>{g(0),b(0),j(50),w(50),y(m)},V=()=>{const e=function(e,t){return 21===e?{title:"ğŸ‰ ACWRåˆ†æãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼",message:"3é€±é–“ã®ãƒ‡ãƒ¼ã‚¿è“„ç©å®Œäº†ã€‚ã“ã‚Œã‹ã‚‰ACWRã§æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’ç®¡ç†ã§ãã¾ã™ã€‚",type:"milestone",showConfetti:!0}:28===e?{title:"âœ¨ æ¨å¥¨æœŸé–“é”æˆï¼",message:"4é€±é–“ã®å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ãŒæƒã„ã¾ã—ãŸã€‚é«˜ç²¾åº¦ãªACWRåˆ†æãŒå¯èƒ½ã§ã™ã€‚",type:"milestone",showConfetti:!0}:7===e?{title:"ğŸ¯ 1é€±ç›®å®Œäº†ï¼",message:"é †èª¿ã§ã™ã€‚ã‚ã¨2é€±é–“ã§ACWRåˆ†æãŒå§‹ã¾ã‚Šã¾ã™ã€‚",type:"milestone"}:14===e?{title:"ğŸ“ˆ 2é€±ç›®å®Œäº†ï¼",message:"æŠ˜ã‚Šè¿”ã—åœ°ç‚¹ã‚’é€šéã€‚ã‚ã¨1é€±é–“ã§ACWRåˆ†æé–‹å§‹ã§ã™ã€‚",type:"milestone"}:3===t?{title:"ğŸ”¥ 3æ—¥é€£ç¶šè¨˜éŒ²ï¼",message:"ç¶™ç¶šã¯åŠ›ãªã‚Šã€‚ã“ã®èª¿å­ã§ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ã—ã¾ã—ã‚‡ã†ã€‚",type:"success"}:7===t?{title:"ğŸ’ª 1é€±é–“é€£ç¶šè¨˜éŒ²ï¼",message:"ç´ æ™´ã‚‰ã—ã„ç¿’æ…£åŒ–ã§ã™ã€‚ç¶™ç¶šçš„ãªè¨˜éŒ²ãŒæ­£ç¢ºãªåˆ†æã«ã¤ãªãŒã‚Šã¾ã™ã€‚",type:"success"}:14===t?{title:"â­ 2é€±é–“é€£ç¶šè¨˜éŒ²ï¼",message:"é©šç•°çš„ãªç¶™ç¶šåŠ›ã§ã™ã€‚ã‚‚ã†ã™ãACWRåˆ†æãŒå§‹ã¾ã‚Šã¾ã™ã€‚",type:"success"}:e%5==0&&e<21?{title:"è¨˜éŒ²ç¶™ç¶šä¸­",message:`${e}æ—¥ç›®ã®è¨˜éŒ²å®Œäº†ã€‚ACWRåˆ†æã¾ã§ã‚ã¨${21-e}æ—¥ã§ã™ã€‚`,type:"encouragement"}:null}(d+1,o+1);e&&(E(e),e.showConfetti&&dr({particleCount:100,spread:70,origin:{y:.6}}))},K=()=>{A(!1),z(null),F(null)},J=(e,t)=>{if(0===e||0===t)return void D("");const r=e*t;i&&r>2*i.load?D("ã„ã¤ã‚‚ã®2å€ä»¥ä¸Šã®è² è·ã§ã™ã€‚å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"):i&&r>1.5*i.load?D("ã„ã¤ã‚‚ã‚ˆã‚Šé«˜ã„è² è·ã§ã™ã€‚"):D(r>1e3?"éå¸¸ã«é«˜ã„è² è·ã§ã™ã€‚å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚":"")};r.useEffect(()=>{if(!M)return;const e=setTimeout(()=>E(null),5e3);return()=>clearTimeout(e)},[M]);const Y=u*h;return R.jsxs(R.Fragment,{children:[R.jsx(yr,{open:I,type:P,message:W,onClose:()=>L(!1)}),R.jsx(ur,{isOpen:T,onClose:K,onOverwrite:async()=>{if($&&q&&!N&&!n){k(!0),A(!1),C("");try{await s($.id,{rpe:q.rpe,duration_min:q.duration_min,arrow_score:q.arrow_score,signal_score:q.signal_score}),V(),U("success","ä¸Šæ›¸ãã—ã¦ä¿å­˜ã—ã¾ã—ãŸ âœ…"),H(),z(null),F(null)}catch(e){console.error("Error updating record:",e),C("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ"),U("error","è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{k(!1)}}},onCancel:K,title:"ç·´ç¿’è¨˜éŒ²",date:p,existingValues:[{label:"RPE",value:(null==(c=null==$?void 0:$.rpe)?void 0:c.toString())||"-"},{label:"æ™‚é–“",value:`${(null==$?void 0:$.duration_min)||0}åˆ†`},{label:"çŸ¢å°",value:`${(null==$?void 0:$.arrow_score)??"-"} / 100`},{label:"é›»æ³¢",value:`${(null==$?void 0:$.signal_score)??"-"} / 100`}],newValues:[{label:"RPE",value:(null==(x=null==q?void 0:q.rpe)?void 0:x.toString())||"-"},{label:"æ™‚é–“",value:`${(null==q?void 0:q.duration_min)||0}åˆ†`},{label:"çŸ¢å°",value:`${(null==q?void 0:q.arrow_score)??"-"} / 100`},{label:"é›»æ³¢",value:`${(null==q?void 0:q.signal_score)??"-"} / 100`}]}),R.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!N&&!n){if(C(""),0===u&&h>0)return C("RPE 0ï¼ˆä¼‘é¤Šæ—¥ï¼‰ã®å ´åˆã¯ã€æ™‚é–“ã‚‚ 0 åˆ†ã«ã—ã¦ãã ã•ã„ã€‚"),void U("error","å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆä¼‘é¤Šæ—¥ã®ãƒ«ãƒ¼ãƒ«ï¼‰");if(u>0&&0===h)return C("RPE ãŒ 1 ä»¥ä¸Šã®ã¨ãã¯ã€ç·´ç¿’æ™‚é–“ã‚‚ 1 åˆ†ä»¥ä¸Šã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"),void U("error","å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆæ™‚é–“ãŒ 0 åˆ†ï¼‰");try{const e=await a(p);if(e)return z(e),F({rpe:u,duration_min:h,date:p,arrow_score:f,signal_score:v}),void A(!0)}catch(r){return console.error("Error checking existing training record:",r),C("æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ"),void U("error","æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ")}k(!0);try{await t({rpe:u,duration_min:h,date:p,arrow_score:f,signal_score:v}),V(),U("success","ç·´ç¿’è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ âœ…"),H()}catch(s){if(console.error("Error submitting training record:",s),s instanceof Error)if(s.message.includes("duplicate key value violates unique constraint")){const e=`${new Date(p).toLocaleDateString("ja-JP")}ã®è¨˜éŒ²ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚`;C(e),U("error",e)}else C(s.message||"è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),U("error",s.message||"è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ");else C("è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),U("error","è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{k(!1)}}},className:"space-y-6",children:[M&&R.jsx("div",{className:"rounded-lg border-2 p-4 animate-in slide-in-from-top-2 duration-300 "+("milestone"===M.type?"bg-green-50 dark:bg-green-900/20 border-green-500 dark:border-green-700":"success"===M.type?"bg-blue-50 dark:bg-blue-900/20 border-blue-500 dark:border-blue-700":"bg-purple-50 dark:bg-purple-900/20 border-purple-500 dark:border-purple-700"),children:R.jsxs("div",{className:"flex items-start gap-3",children:["milestone"===M.type?R.jsx(Te,{className:"w-6 h-6 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}):R.jsx(It,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("h4",{className:"font-semibold text-base mb-1 "+("milestone"===M.type?"text-green-700 dark:text-green-300":"success"===M.type?"text-blue-700 dark:text-blue-300":"text-purple-700 dark:text-purple-300"),children:M.title}),R.jsx("p",{className:"text-sm "+("milestone"===M.type?"text-green-600 dark:text-green-400":"success"===M.type?"text-blue-600 dark:text-blue-400":"text-purple-600 dark:text-purple-400"),children:M.message})]})]})}),l&&R.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-sm",children:[R.jsx("p",{className:"text-blue-600 dark:text-blue-400 mb-1",children:"å‰å›ã®è¨˜éŒ²"}),R.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["RPE ",l.rpe??"-"," Ã— ",l.duration_min??"-","åˆ† = è² è·"," ",(l.rpe??0)*(l.duration_min??0)]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Me,{className:"w-4 h-4 mr-2"}),"æ—¥ä»˜"]}),R.jsx("input",{type:"date",value:p,onChange:e=>y(e.target.value),disabled:N||n,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(nr,{className:"w-4 h-4 mr-2"}),"RPEï¼ˆé‹å‹•å¼·åº¦ï¼‰"]}),R.jsx("input",{type:"range",min:"0",max:"10",value:u,onChange:e=>{const t=Number(e.target.value);g(t),J(t,h)},disabled:N||n,className:"w-full"}),R.jsx("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-200",children:["0 - ä¼‘é¤Šãƒ»ã¾ã£ãŸãé‹å‹•ã—ã¦ã„ãªã„","1 - éå¸¸ã«æ¥½ã§ã‚ã‚‹","2 - æ¥½ã§ã‚ã‚‹","3 - å°‘ã—ãã¤ã„","4 - ã‚„ã‚„ãã¤ã„","5 - ãã¤ã„","6 - ã•ã‚‰ã«ãã¤ã„","7 - ã¨ã¦ã‚‚ãã¤ã„","8 - ã‹ãªã‚Šãã¤ã„","9 - éå¸¸ã«ãã¤ã„","10 - æœ€å¤§é™ã«ãã¤ã„ (é™ç•Œ)"][u]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Oe,{className:"w-4 h-4 mr-2"}),"ç·´ç¿’æ™‚é–“ï¼ˆåˆ†ï¼‰"]}),R.jsx("input",{type:"number",min:"0",max:"480",value:h,onChange:e=>{const t=Number(e.target.value);b(t),J(u,t)},disabled:N||n,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60",style:{fontSize:"16px"}}),R.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"â€» ä¼‘é¤Šæ—¥ã¯ã€ŒRPE=0 / æ™‚é–“=0ã€"})]}),R.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"ä»Šæ—¥ã®è² è·"}),R.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:Y})]})}),R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:[R.jsx(hr,{value:f,onChange:j}),R.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:["çŸ¢å°ï¼ˆæˆé•·å®Ÿæ„Ÿï¼‰: ",f,"/100"]})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4",children:[R.jsx(pr,{value:v,onChange:w}),R.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:["é›»æ³¢ï¼ˆæ„å›³ç†è§£ï¼‰: ",v,"/100"]})]})]}),S&&R.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg text-yellow-700 dark:text-yellow-300",children:[R.jsx(ye,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm",children:S})]}),_&&R.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300",children:[R.jsx(ye,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm",children:_})]}),R.jsxs("button",{type:"submit",disabled:n||N,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[R.jsx(kt,{className:"w-4 h-4 mr-2"}),N?"ä¿å­˜ä¸­...":"è¨˜éŒ²ã™ã‚‹"]})]})]})}function jr({daysWithData:e,isDarkMode:t}){const r=Math.min(e/28*100,100),a=e>=21,s=e>=28,n=(()=>{if(s)return{icon:Te,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",progressColor:"bg-green-500",title:"ACWRåˆ†æï¼šåˆ©ç”¨å¯èƒ½",message:"ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œã¾ã—ãŸã€‚ç²¾åº¦ã®é«˜ã„ACWRåˆ†æãŒå¯èƒ½ã§ã™ã€‚"};if(a)return{icon:ye,color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",progressColor:"bg-yellow-500",title:"ACWRåˆ†æï¼šåˆ©ç”¨å¯èƒ½ï¼ˆç²¾åº¦å‘ä¸Šä¸­ï¼‰",message:`ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆã‚‹ã»ã©ç²¾åº¦ãŒä¸ŠãŒã‚Šã¾ã™ã€‚ã‚ã¨${28-e}æ—¥ã§æ¨å¥¨æœŸé–“ã«åˆ°é”ã—ã¾ã™ã€‚`};{const t=Math.floor(e/7)+1;return{icon:Me,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",progressColor:"bg-blue-500",title:`ãƒ‡ãƒ¼ã‚¿åé›†ä¸­ï¼ˆ${t}é€±ç›®ï¼‰`,message:`ACWRåˆ†æã¾ã§ã‚ã¨${21-e}æ—¥ã€‚ç¶™ç¶šã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼`}}})(),l=n.icon,i=()=>[{day:7,label:"1é€±ç›®",reached:e>=7},{day:14,label:"2é€±ç›®",reached:e>=14},{day:21,label:"3é€±ç›®\n(æœ€ä½ãƒ©ã‚¤ãƒ³)",reached:e>=21},{day:28,label:"4é€±ç›®\n(æ¨å¥¨)",reached:e>=28}];return R.jsxs("div",{className:`rounded-lg border ${n.borderColor} ${n.bgColor} p-4 sm:p-6`,children:[R.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[R.jsx(l,{className:`${n.color} flex-shrink-0 mt-0.5`,size:24}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("h3",{className:`font-semibold ${n.color} text-base sm:text-lg mb-1`,children:n.title}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n.message})]})]}),R.jsxs("div",{className:"space-y-3",children:[R.jsxs("div",{className:"flex items-center justify-between text-sm",children:[R.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["è¨˜éŒ²æ—¥æ•°: ",e,"æ—¥"]}),R.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[Math.round(r),"%"]})]}),R.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[R.jsx("div",{className:`absolute inset-y-0 left-0 ${n.progressColor} rounded-full transition-all duration-500 ease-out`,style:{width:`${r}%`}}),i().map(e=>{const t=e.day/28*100;return R.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white dark:bg-gray-600",style:{left:`${t}%`}},e.day)})]}),R.jsx("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:i().map(e=>R.jsxs("div",{className:"flex flex-col items-center "+(e.reached?"text-gray-700 dark:text-gray-300 font-medium":""),children:[R.jsx("span",{className:"whitespace-pre-line text-center leading-tight",children:e.label}),e.reached&&R.jsx(Te,{size:12,className:"text-green-500 mt-0.5"})]},e.day))})]}),!s&&R.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:R.jsxs("div",{className:"flex items-start gap-2",children:[R.jsx(Vt,{size:16,className:"text-gray-400 flex-shrink-0 mt-0.5"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ACWRã¯æ€¥æ€§è² è·ï¼ˆç›´è¿‘1é€±é–“ï¼‰ã¨æ…¢æ€§è² è·ï¼ˆéå»4é€±é–“ï¼‰ã®æ¯”ç‡ã§ã™ã€‚ ç¶™ç¶šçš„ãªè¨˜éŒ²ã§ã€ã‚ˆã‚Šæ­£ç¢ºãªæ€ªæˆ‘ãƒªã‚¹ã‚¯è©•ä¾¡ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚"})]})})]})}function vr({data:e,daysWithData:t=0,isDarkMode:a=!1,teamAverageData:m=[],showTeamAverage:u=!1}){const[g,h]=r.useState("month"),[b,p]=r.useState(u),y=t>=21,f=r.useMemo(()=>{if(0===e.length)return[];const t=new Date;let r;switch(g){case"week":r=new Date(t),r.setDate(t.getDate()-7);break;case"month":r=new Date(t),r.setDate(t.getDate()-30);break;case"quarter":r=new Date(t),r.setDate(t.getDate()-90);break;default:return e}return e.filter(e=>{const a=new Date(e.date);return a>=r&&a<=t})},[e,g]),j=r.useMemo(()=>{if(0===m.length)return[];const e=new Date;let t;switch(g){case"week":t=new Date(e),t.setDate(e.getDate()-7);break;case"month":t=new Date(e),t.setDate(e.getDate()-30);break;case"quarter":t=new Date(e),t.setDate(e.getDate()-90);break;default:return m}return m.filter(r=>{const a=new Date(r.date);return a>=t&&a<=e})},[m,g]);if(0===e.length)return R.jsxs("div",{className:"space-y-4",children:[t>0&&R.jsx(jr,{daysWithData:t,isDarkMode:a}),R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400",children:R.jsxs("div",{className:"text-center px-4",children:[R.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-sm",children:"ç·´ç¿’è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ACWRã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†"})]})})]});if(!y)return R.jsxs("div",{className:"space-y-4",children:[R.jsx(jr,{daysWithData:t,isDarkMode:a}),R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:R.jsxs("div",{className:"text-center px-4",children:[R.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ACWRåˆ†ææº–å‚™ä¸­"}),R.jsxs("p",{className:"text-sm",children:["ã‚ã¨",21-t,"æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã§ACWRåˆ†æãŒå§‹ã¾ã‚Šã¾ã™"]})]})})]});const v=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}(${["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][t.getDay()]})`},w=({active:e,payload:t,label:r})=>{if(!e||!t||0===t.length)return null;const a=t.find(e=>"å€‹äºº ACWR"===(null==e?void 0:e.name))||t.find(e=>"acwr"===(null==e?void 0:e.dataKey)),s=t.find(e=>"ãƒãƒ¼ãƒ å¹³å‡"===(null==e?void 0:e.name)),n=null==a?void 0:a.payload,l="number"==typeof(null==a?void 0:a.value)&&Number.isFinite(a.value)?a.value:"number"==typeof(null==n?void 0:n.acwr)?n.acwr:null,i=new Date(r),d=0===i.getDay()||6===i.getDay(),o=b?j.find(e=>e.date===r):null,c=o&&"number"==typeof o.acwr&&Number.isFinite(o.acwr)?o.acwr:"number"==typeof(null==s?void 0:s.value)&&Number.isFinite(s.value)?s.value:null;if(!n)return null;const x="number"==typeof l&&"number"==typeof c?l-c:null;return R.jsxs("div",{className:"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs",children:[R.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[R.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base",children:v(r)}),d&&R.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium",children:"é€±æœ«"})]}),R.jsxs("div",{className:"space-y-1 text-xs sm:text-sm",children:[R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"å€‹äºº ACWR:"}),R.jsx("span",{className:"font-semibold",style:{color:le(n.riskLevel)},children:"number"==typeof l?l.toFixed(2):"-"})]}),b&&null!=c&&R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"ãƒãƒ¼ãƒ å¹³å‡:"}),R.jsx("span",{className:"font-semibold text-purple-600",children:c.toFixed(2)})]}),b&&null!=x&&R.jsxs("p",{className:"flex justify-between text-xs",children:[R.jsx("span",{children:"å·®:"}),R.jsxs("span",{className:"font-semibold "+(x>.3?"text-red-600":"text-gray-600"),children:[x>0?"+":"",x.toFixed(2)]})]}),R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"æ€¥æ€§è² è·:"}),R.jsx("span",{className:"font-semibold",children:n.acuteLoad??"-"})]}),R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"æ…¢æ€§è² è·:"}),R.jsx("span",{className:"font-semibold",children:n.chronicLoad??"-"})]}),R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"ãƒªã‚¹ã‚¯:"}),R.jsx("span",{className:"font-semibold",style:{color:le(n.riskLevel)},children:wr(n.riskLevel)})]})]})]})},N=e=>{const{cx:t,cy:r,payload:a}=e;if(t&&r&&a){const e=new Date(a.date),s=0===e.getDay()||6===e.getDay();return R.jsx("circle",{cx:t,cy:r,r:s?5:4,fill:le(a.riskLevel),strokeWidth:2,stroke:s?"#3B82F6":"white",opacity:s?.9:1})}return null};return R.jsxs("div",{className:"w-full space-y-4",children:[t<28&&R.jsx(jr,{daysWithData:t,isDarkMode:a}),R.jsxs("div",{className:"mb-4 space-y-3",children:[R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx(Me,{className:"w-5 h-5 text-gray-500"}),R.jsx("span",{className:"text-sm font-medium text-gray-700",children:"è¡¨ç¤ºæœŸé–“"})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx(Xe,{className:"w-4 h-4 text-gray-500"}),R.jsx("div",{className:"flex space-x-1",children:[{value:"week",label:"1é€±é–“"},{value:"month",label:"1ãƒ¶æœˆ"},{value:"quarter",label:"3ãƒ¶æœˆ"},{value:"all",label:"å…¨æœŸé–“"}].map(e=>R.jsx("button",{onClick:()=>h(e.value),className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors "+(g===e.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))})]}),R.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:R.jsxs("div",{className:"flex items-center justify-between text-sm text-blue-700",children:[R.jsxs("div",{children:[R.jsx("span",{className:"font-medium",children:"è¡¨ç¤ºä¸­:"})," ",f.length,"æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿","all"!==g&&R.jsxs("span",{className:"ml-2",children:["(","week"===g?"éå»7æ—¥é–“":"month"===g?"éå»30æ—¥é–“":"éå»90æ—¥é–“",")"]})]}),R.jsxs("div",{className:"flex items-center space-x-1",children:[R.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full border-2 border-blue-600"}),R.jsx("span",{className:"text-xs",children:"é€±æœ«ã¯é’ã„æ ã§å¼·èª¿"})]})]})}),m.length>0&&R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("button",{onClick:()=>p(!b),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(b?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"),children:b?"ãƒãƒ¼ãƒ å¹³å‡ã‚’éè¡¨ç¤º":"ãƒãƒ¼ãƒ å¹³å‡ã¨æ¯”è¼ƒ"}),b&&R.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ç´«è‰²ã®ç‚¹ç·šãŒãƒãƒ¼ãƒ å¹³å‡ã§ã™"})]})]}),R.jsx("div",{className:"h-64 sm:h-96",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:f,margin:{top:20,right:30,left:20,bottom:20},children:[R.jsx(l,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),R.jsx(i,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},stroke:"#6b7280",fontSize:10,interval:"preserveStartEnd"}),R.jsx(d,{domain:[0,"dataMax + 0.5"],stroke:"#6b7280",fontSize:10,width:40}),R.jsx(o,{content:R.jsx(w,{})}),R.jsx(c,{y:1.5,stroke:"#EF4444",strokeDasharray:"5 5"}),R.jsx(c,{y:1.3,stroke:"#F59E0B",strokeDasharray:"5 5"}),R.jsx(c,{y:.8,stroke:"#10B981",strokeDasharray:"5 5"}),R.jsx(x,{type:"monotone",dataKey:"acwr",stroke:"#6366f1",strokeWidth:2,dot:R.jsx(N,{}),activeDot:{r:6,stroke:"#6366f1",strokeWidth:2,fill:"white"},name:"å€‹äºº ACWR"}),b&&j.length>0&&R.jsx(x,{type:"monotone",data:j,dataKey:"acwr",stroke:"#9333ea",strokeWidth:2,strokeDasharray:"5 5",dot:{r:3,fill:"#9333ea",stroke:"#9333ea"},activeDot:{r:5,stroke:"#9333ea",strokeWidth:2,fill:"white"},name:"ãƒãƒ¼ãƒ å¹³å‡"})]})})}),R.jsx("div",{className:"mt-4 flex justify-center",children:R.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),R.jsx("span",{children:"é«˜ãƒªã‚¹ã‚¯ (>1.5)"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),R.jsx("span",{children:"æ³¨æ„ (1.3-1.5)"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),R.jsx("span",{children:"è‰¯å¥½ (0.8-1.3)"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),R.jsx("span",{children:"ä½è² è· (<0.8)"})]})]})})]})}function wr(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"good":return"è‰¯å¥½";case"low":return"ä½è² è·";default:return"ä¸æ˜"}}function Nr({record:e,onClose:t,onUpdate:a,onDelete:s,allowDateEdit:n=!1,allowDelete:l=!1}){const[i,d]=r.useState({rpe:e.rpe,duration_min:e.duration_min,date:e.date}),[o,c]=r.useState(!1),[x,m]=r.useState(""),[u,g]=r.useState(!1);return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[R.jsx("div",{className:"bg-blue-600 text-white p-6 rounded-t-2xl",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("div",{className:"bg-blue-500 rounded-full p-2",children:R.jsx(Me,{className:"w-6 h-6"})}),R.jsxs("div",{children:[R.jsx("h2",{className:"text-xl font-bold",children:"ç·´ç¿’è¨˜éŒ²ã‚’ç·¨é›†"}),R.jsxs("p",{className:"text-blue-100",children:[new Date(e.date).toLocaleDateString("ja-JP"),"ã®è¨˜éŒ²"]})]})]}),R.jsx("button",{onClick:t,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:R.jsx(sr,{className:"w-5 h-5"})})]})}),R.jsxs("div",{className:"p-6",children:[R.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[R.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"ç¾åœ¨ã®å€¤"}),R.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center text-sm",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-gray-600",children:"RPE"}),R.jsx("div",{className:"font-bold text-lg text-blue-600",children:e.rpe})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-gray-600",children:"æ™‚é–“"}),R.jsxs("div",{className:"font-bold text-lg text-green-600",children:[e.duration_min,"åˆ†"]})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-gray-600",children:"è² è·"}),R.jsx("div",{className:"font-bold text-lg text-purple-600",children:e.load})]})]})]}),R.jsxs("form",{onSubmit:async r=>{r.preventDefault(),c(!0),m("");try{const r={rpe:i.rpe,duration_min:i.duration_min};n&&i.date!==e.date&&(r.date=i.date),await a(e.id,r),t()}catch(s){console.error("Error updating record:",s),m(s.message||"æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{c(!1)}},className:"space-y-6",children:[n&&R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[R.jsx(Me,{className:"w-4 h-4 mr-2"}),"ç·´ç¿’æ—¥"]}),R.jsx("input",{type:"date",value:i.date,onChange:e=>d(t=>({...t,date:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[R.jsx(nr,{className:"w-4 h-4 mr-2"}),"RPEï¼ˆé‹å‹•å¼·åº¦ï¼‰"]}),R.jsxs("div",{className:"space-y-3",children:[R.jsx("input",{type:"range",min:"0",max:"10",value:i.rpe,onChange:e=>d(t=>({...t,rpe:Number(e.target.value)})),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{WebkitAppearance:"none",background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${i.rpe/10*100}%, #9ca3af ${i.rpe/10*100}%, #9ca3af 100%)`}}),R.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[R.jsx("span",{children:"0"}),R.jsx("span",{children:"5"}),R.jsx("span",{children:"10"})]}),R.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[R.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:i.rpe}),R.jsx("div",{className:"text-sm text-blue-700",children:["0 - ã¾ã£ãŸãæ¥½ã§ã‚ã‚‹","1 - éå¸¸ã«æ¥½ã§ã‚ã‚‹","2 - æ¥½ã§ã‚ã‚‹","3 - å°‘ã—ãã¤ã„","4 - ã‚„ã‚„ãã¤ã„","5 - ãã¤ã„","6 - ã•ã‚‰ã«ãã¤ã„","7 - ã¨ã¦ã‚‚ãã¤ã„","8 - ã‹ãªã‚Šãã¤ã„","9 - éå¸¸ã«ãã¤ã„","10 - æœ€å¤§é™ã«ãã¤ã„ (é™ç•Œ)"][i.rpe]})]})]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-3",children:[R.jsx(Oe,{className:"w-4 h-4 mr-2"}),"ç·´ç¿’æ™‚é–“ï¼ˆåˆ†ï¼‰"]}),R.jsx("input",{type:"number",min:"1",max:"480",value:i.duration_min,onChange:e=>d(t=>({...t,duration_min:Number(e.target.value)})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base",style:{fontSize:"16px"}})]}),R.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[R.jsxs("div",{className:"flex justify-between items-center mb-2",children:[R.jsx("span",{className:"text-sm text-gray-600",children:"æ–°ã—ã„è² è·å€¤"}),R.jsx("span",{className:"text-lg font-semibold text-gray-900",children:i.rpe*i.duration_min})]}),R.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[R.jsxs("span",{children:["å¤‰æ›´å‰: ",e.load]}),R.jsx("span",{className:"font-medium "+(i.rpe*i.duration_min>e.load?"text-red-600":i.rpe*i.duration_min<e.load?"text-blue-600":"text-gray-600"),children:i.rpe*i.duration_min>e.load?"å¢—åŠ ":i.rpe*i.duration_min<e.load?"æ¸›å°‘":"å¤‰æ›´ãªã—"})]})]}),x&&R.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:[R.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),R.jsx("span",{className:"text-sm",children:x})]}),R.jsxs("div",{className:"flex space-x-3",children:[l&&s&&R.jsxs("button",{type:"button",onClick:()=>g(!0),className:"bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center space-x-2",children:[R.jsx(Ut,{className:"w-4 h-4"}),R.jsx("span",{children:"å‰Šé™¤"})]}),R.jsx("button",{type:"button",onClick:t,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsxs("button",{type:"submit",disabled:o,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[o?R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):R.jsx(Mt,{className:"w-4 h-4 mr-2"}),o?"æ›´æ–°ä¸­...":"æ›´æ–°"]})]})]})]}),u&&R.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 rounded-2xl",children:R.jsx("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",children:R.jsxs("div",{className:"text-center",children:[R.jsx(Ut,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),R.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"}),R.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:[new Date(e.date).toLocaleDateString("ja-JP"),"ã®ç·´ç¿’è¨˜éŒ²ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"]}),R.jsxs("div",{className:"flex space-x-3",children:[R.jsx("button",{onClick:()=>g(!1),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:async()=>{if(s){c(!0),m("");try{await s(e.id),t()}catch(r){console.error("Error deleting record:",r),m(r.message||"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{c(!1)}}},disabled:o,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50",children:"å‰Šé™¤ã™ã‚‹"})]})]})})})]})})}const kr=m.memo(function({records:e,onUpdate:t,onDelete:a,loading:s=!1,allowEdit:n=!0,allowDelete:l=!1,allowDateEdit:i=!1,showLimited:d=!1,limitCount:o=10}){const[c,x]=r.useState(null),[m,u]=r.useState(!1),[g,h]=r.useState(!1),b=r.useMemo(()=>d&&!g?e.slice(-o):e,[e,d,g,o]),p=r.useMemo(()=>[...b].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[b]),y=r.useCallback(e=>{x(e),u(!0)},[]),f=r.useCallback(()=>{u(!1),x(null)},[]),j=e=>e>=8?"text-red-600 dark:text-red-400":e>=6?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400";return s?R.jsx("div",{className:"space-y-3",children:[1,2,3].map(e=>R.jsx("div",{className:"animate-pulse",children:R.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded-lg"})},e))}):0===e.length?R.jsxs("div",{className:"text-center py-8",children:[R.jsx(Me,{className:"w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),R.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"ç·´ç¿’è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"æœ€åˆã®ç·´ç¿’è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"})]}):R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"ç·´ç¿’è¨˜éŒ²"}),d&&e.length>o&&R.jsxs("button",{onClick:()=>h(!g),className:"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 flex items-center space-x-1",children:[R.jsx("span",{children:g?`æœ€æ–°${o}ä»¶ã®ã¿è¡¨ç¤º`:`å…¨${e.length}ä»¶ã‚’è¡¨ç¤º`}),g?R.jsx(Fe,{className:"w-4 h-4"}):R.jsx($e,{className:"w-4 h-4"})]})]}),R.jsx("div",{className:"space-y-3",children:p.map(e=>R.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[R.jsx("div",{className:"block sm:hidden",children:R.jsxs("div",{className:"flex items-center justify-between mb-3",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[R.jsx(Me,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),R.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:new Date(e.date).toLocaleDateString("ja-JP")})]}),R.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"RPE"}),R.jsx("div",{className:`font-bold ${j(e.rpe)}`,children:e.rpe})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"æ™‚é–“"}),R.jsxs("div",{className:"font-bold text-blue-600 dark:text-blue-400",children:[e.duration_min,"åˆ†"]})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-gray-600 dark:text-gray-400 text-xs",children:"è² è·"}),R.jsx("div",{className:"font-bold text-purple-600 dark:text-purple-400",children:e.load})]})]})]}),n&&R.jsx("button",{onClick:()=>y(e),className:"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors ml-2",title:"ç·¨é›†",children:R.jsx(Lt,{className:"w-4 h-4"})})]})}),R.jsxs("div",{className:"hidden sm:flex items-center justify-between",children:[R.jsxs("div",{className:"flex-1 grid grid-cols-4 gap-6",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx(Me,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 mr-2"}),R.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:new Date(e.date).toLocaleDateString("ja-JP")})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"RPE"}),R.jsx("div",{className:`text-xl font-bold ${j(e.rpe)}`,children:e.rpe})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"æ™‚é–“"}),R.jsxs("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:[e.duration_min,"åˆ†"]})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"è² è·"}),R.jsx("div",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:e.load})]})]}),n&&R.jsxs("div",{className:"flex space-x-2 ml-4",children:[R.jsx("button",{onClick:()=>y(e),className:"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors",title:"ç·¨é›†",children:R.jsx(Lt,{className:"w-4 h-4"})}),l&&R.jsx("button",{onClick:()=>y(e),className:"bg-red-50 hover:bg-red-100 text-red-600 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-300 p-2 rounded-lg transition-colors",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"w-4 h-4"})})]})]})]},e.id))}),d&&e.length>o&&!g&&R.jsx("div",{className:"text-center pt-4",children:R.jsxs("button",{className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",onClick:()=>h(!0),children:["ã•ã‚‰ã«",e.length-o,"ä»¶ã®è¨˜éŒ²ã‚’è¡¨ç¤º"]})}),m&&c&&R.jsx(Nr,{record:c,onClose:f,onUpdate:t,onDelete:l?a:void 0,allowDateEdit:i,allowDelete:l})]})});function _r({alerts:e,onViewAll:t,className:a=""}){const[s,n]=r.useState(!1);r.useEffect(()=>{const e=localStorage.getItem("alertSummaryDismissed"),t=e?parseInt(e,10):0,r=Date.now(),a=36e5;t&&r-t<a?n(!0):t&&r-t>=a&&localStorage.removeItem("alertSummaryDismissed")},[]);const l=e.filter(e=>!e.is_dismissed),i=l.filter(e=>"high"===e.priority),d=l.filter(e=>!e.is_read);return s||0===l.length?null:R.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${a}`,children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center",children:[R.jsx(fe,{className:"w-5 h-5 text-orange-500 mr-2"}),"ã‚¢ãƒ©ãƒ¼ãƒˆæ¦‚è¦"]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("button",{onClick:t,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"å…¨ã¦è¡¨ç¤º"}),R.jsx("button",{onClick:()=>{n(!0),localStorage.setItem("alertSummaryDismissed",Date.now().toString())},className:"text-gray-400 hover:text-gray-600 transition-colors",title:"1æ™‚é–“éè¡¨ç¤º",children:R.jsx(sr,{className:"w-5 h-5"})})]})]}),R.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-red-600",children:i.length}),R.jsx("div",{className:"text-xs text-gray-600",children:"é«˜å„ªå…ˆåº¦"})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d.length}),R.jsx("div",{className:"text-xs text-gray-600",children:"æœªèª­"})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-gray-600",children:l.length}),R.jsx("div",{className:"text-xs text-gray-600",children:"åˆè¨ˆ"})]})]}),i.length>0&&R.jsxs("div",{className:"space-y-2",children:[R.jsxs("h4",{className:"text-sm font-medium text-gray-700 flex items-center",children:[R.jsx(fe,{className:"w-4 h-4 text-red-500 mr-1"}),"ç·Šæ€¥å¯¾å¿œãŒå¿…è¦"]}),i.slice(0,3).map(e=>{const t=X(e);return R.jsx("div",{className:`${t.bgColor} ${t.borderColor} border rounded p-3`,children:R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[R.jsx("span",{className:"text-sm",children:t.icon}),R.jsx("h5",{className:`font-medium text-sm ${t.textColor}`,children:e.title}),!e.is_read&&R.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"})]}),R.jsx("p",{className:`text-xs ${t.textColor} line-clamp-2`,children:e.message}),e.acwr_value&&R.jsxs("div",{className:"mt-1",children:[R.jsx("span",{className:"text-xs text-gray-600",children:"ACWR: "}),R.jsx("span",{className:`text-xs font-bold ${t.textColor}`,children:e.acwr_value})]})]}),R.jsx("div",{className:"ml-2",children:R.jsx(Oe,{className:"w-3 h-3 text-gray-400"})})]})},e.id)}),i.length>3&&R.jsx("div",{className:"text-center",children:R.jsxs("button",{onClick:t,className:"text-xs text-red-600 hover:text-red-700 font-medium",children:["ä»– ",i.length-3,"ä»¶ã®é«˜å„ªå…ˆåº¦ã‚¢ãƒ©ãƒ¼ãƒˆ"]})})]}),R.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:R.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[R.jsx(lt,{className:"w-3 h-3 mr-1"}),R.jsx("span",{children:"ã‚¢ãƒ©ãƒ¼ãƒˆã¯5åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™"})]})})]})}function Cr({onSubmit:e,onCheckExisting:t,onUpdate:a,loading:s,lastRecord:n}){const l=r.useMemo(()=>H(),[]),[i,d]=r.useState(""),[o,c]=r.useState(l),[x,m]=r.useState(""),[u,g]=r.useState(!1),[h,b]=r.useState(""),[p,y]=r.useState(!1),[f,j]=r.useState(null),[v,w]=r.useState(null),[N,k]=r.useState(!1),[_,C]=r.useState("success"),[S,D]=r.useState(""),M=(e,t)=>{C(e),D(t),k(!0)},E=()=>{d(""),m(""),c(l)};r.useEffect(()=>{n&&""===i.trim()&&d(String(n.weight_kg??""))},[n,i]),r.useEffect(()=>{(async()=>{b("");try{const e=await t(o);j(e),e?(d(String(e.weight_kg??"")),m(e.notes??""),M("success","ã“ã®æ—¥ã®ä½“é‡è¨˜éŒ²ã¯æ—¢ã«ã‚ã‚Šã¾ã™ï¼ˆç·¨é›†ã§ãã¾ã™ï¼‰")):m("")}catch(e){console.error("Error checking existing weight record:",e),j(null),b("æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ"),M("error","æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ")}})()},[o]);const T=()=>{y(!1),j(null),w(null)};return R.jsxs(R.Fragment,{children:[R.jsx(yr,{open:N,type:_,message:S,onClose:()=>k(!1)}),R.jsx(ur,{isOpen:p,onClose:T,onOverwrite:async()=>{if(f&&v&&!u&&!s){g(!0),y(!1),b("");try{await a(f.id,{weight_kg:v.weight_kg,notes:v.notes}),M("success","ä¸Šæ›¸ãã—ã¦ä¿å­˜ã—ã¾ã—ãŸ âœ…"),E(),j(null),w(null)}catch(e){console.error("Error updating record:",e),b("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ"),M("error","è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{g(!1)}}},onCancel:T,title:"ä½“é‡è¨˜éŒ²",date:o,existingValues:[{label:"ä½“é‡",value:`${(null==f?void 0:f.weight_kg)||0} kg`}],newValues:[{label:"ä½“é‡",value:`${(null==v?void 0:v.weight_kg)||0} kg`}]}),R.jsxs("form",{onSubmit:async r=>{if(r.preventDefault(),u||s)return;b("");const a=parseFloat(i);if(isNaN(a)||a<=0||a>=500)return b("ä½“é‡ã¯0ã€œ500kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"),void M("error","å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆä½“é‡ã®ç¯„å›²ï¼‰");let n=null;try{n=await t(o)}catch(l){return console.error("Error checking existing weight record:",l),b("æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ"),void M("error","æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ")}if(n)return j(n),w({weight_kg:a,date:o,notes:x.trim()||void 0}),void y(!0);g(!0);try{await e({weight_kg:a,date:o,notes:x.trim()||void 0}),M("success","ä½“é‡è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ âœ…"),E()}catch(l){console.error("Error submitting weight record:",l);const e=l instanceof Error&&l.message||"è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";b(e),M("error",e)}finally{g(!1)}},className:"space-y-6",children:[R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[R.jsx(Me,{className:"w-4 h-4 mr-2"}),"æ¸¬å®šæ—¥"]}),R.jsx("input",{type:"date",value:o,onChange:e=>c(e.target.value),max:l,disabled:u||s,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60",style:{fontSize:"16px"}}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:o===l?"ä»Šæ—¥ã®ä½“é‡è¨˜éŒ²":"éå»ã®ä½“é‡è¨˜éŒ²"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[R.jsx(Et,{className:"w-4 h-4 mr-2"}),"ä½“é‡ï¼ˆkgï¼‰"]}),R.jsx("input",{type:"number",step:"0.1",min:"1",max:"499",value:i,onChange:e=>d(e.target.value),disabled:u||s,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60",placeholder:"65.5",required:!0,style:{fontSize:"16px"}}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å°æ•°ç‚¹ç¬¬1ä½ã¾ã§å…¥åŠ›å¯èƒ½ï¼ˆä¾‹: 65.5kgï¼‰"}),n&&R.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["å‰å›: ",Number(n.weight_kg).toFixed(1)," kgï¼ˆ",new Date(n.date).toLocaleDateString("ja-JP"),"ï¼‰"]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[R.jsx(Qe,{className:"w-4 h-4 mr-2"}),"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"]}),R.jsx("textarea",{value:x,onChange:e=>m(e.target.value),disabled:u||s,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60",placeholder:"ä½“èª¿ã‚„é£Ÿäº‹ã®è¨˜éŒ²ãªã©...",rows:3,maxLength:500,style:{fontSize:"16px"}}),R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[x.length,"/500æ–‡å­—"]})]}),h&&R.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(ye,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),R.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:h})]})}),R.jsx("button",{type:"submit",disabled:u||s||!i,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center touch-target",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:u?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"è¨˜éŒ²ä¸­..."]}):R.jsxs(R.Fragment,{children:[R.jsx(Et,{className:"w-5 h-5 mr-2"}),"ä½“é‡ã‚’è¨˜éŒ²"]})})]})]})}function Sr({data:e}){const t=e.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).map(e=>({date:e.date,weight:Number(e.weight_kg),displayDate:new Date(e.date).toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}));if(0===t.length)return R.jsx("div",{className:"h-64 sm:h-80 flex items-center justify-center text-gray-500 dark:text-gray-400",children:"ä½“é‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"});const r=t.map(e=>e.weight),a=Math.min(...r),c=Math.max(...r),m=c-a,g=Math.max(0,a-.1*m),h=c+.1*m;return R.jsxs("div",{className:"h-64 sm:h-80",children:[R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:t,margin:{top:5,right:20,left:0,bottom:5},children:[R.jsx(l,{strokeDasharray:"3 3",stroke:"#e5e7eb",className:"dark:stroke-gray-700"}),R.jsx(i,{dataKey:"displayDate",stroke:"#6b7280",style:{fontSize:"12px"},tick:{fill:"currentColor"},className:"dark:text-gray-400"}),R.jsx(d,{stroke:"#6b7280",style:{fontSize:"12px"},tick:{fill:"currentColor"},className:"dark:text-gray-400",domain:[g,h],tickFormatter:e=>`${e.toFixed(1)}`,label:{value:"ä½“é‡ (kg)",angle:-90,position:"insideLeft",fill:"#6b7280"}}),R.jsx(o,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"},labelStyle:{color:"#374151",fontWeight:600},formatter:e=>[`${e.toFixed(1)} kg`,"ä½“é‡"],labelFormatter:e=>{const r=t.find(t=>t.displayDate===e);return r?new Date(r.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}):e}}),R.jsx(u,{wrapperStyle:{paddingTop:"20px"},iconType:"line"}),R.jsx(x,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"ä½“é‡ (kg)"})]})}),t.length>1&&R.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-6 text-sm",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),R.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["æœ€å°: ",a.toFixed(1)," kg"]})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),R.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["æœ€å¤§: ",c.toFixed(1)," kg"]})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),R.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["å¤‰åŒ–: ",(c-a).toFixed(1)," kg"]})]})]})]})}function Dr({records:e,onUpdate:t,onDelete:a,loading:s}){const[n,l]=r.useState(null),[i,d]=r.useState(""),[o,c]=r.useState(""),x=()=>{l(null),d(""),c("")};return s?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):0===e.length?R.jsxs("div",{className:"text-center py-12",children:[R.jsx(Et,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),R.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"ä½“é‡è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„"})]}):R.jsxs("div",{className:"space-y-4",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ä½“é‡è¨˜éŒ²å±¥æ­´"}),R.jsx("div",{className:"space-y-3",children:e.map(e=>R.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:n===e.id?R.jsxs("div",{className:"space-y-3",children:[R.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[R.jsxs("div",{children:[R.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"æ¸¬å®šæ—¥"}),R.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:[R.jsx(Me,{className:"w-4 h-4 mr-2"}),new Date(e.date).toLocaleDateString("ja-JP")]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"ä½“é‡ï¼ˆkgï¼‰"}),R.jsx("input",{type:"number",step:"0.1",min:"1",max:"499",value:i,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white",style:{fontSize:"16px"}})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"ãƒ¡ãƒ¢"}),R.jsx("textarea",{value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white resize-none",rows:2,maxLength:500,style:{fontSize:"16px"}})]}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsx("button",{onClick:()=>(async e=>{const r=parseFloat(i);if(isNaN(r)||r<=0||r>=500)alert("ä½“é‡ã¯0ã€œ500kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");else try{await t(e,{weight_kg:r,notes:o.trim()||void 0}),l(null),d(""),c("")}catch(a){console.error("Error updating weight record:",a),alert("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(e.id),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"ä¿å­˜"}),R.jsx("button",{onClick:x,className:"flex-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors text-sm font-medium",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]}):R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1 space-y-2",children:[R.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[R.jsx(Me,{className:"w-4 h-4 mr-2"}),new Date(e.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx(Et,{className:"w-5 h-5 mr-2 text-blue-600 dark:text-blue-400"}),R.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.weight_kg}),R.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-400 ml-1",children:"kg"})]}),e.notes&&R.jsxs("div",{className:"flex items-start text-sm text-gray-600 dark:text-gray-400 mt-2",children:[R.jsx(Qe,{className:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),R.jsx("span",{className:"whitespace-pre-wrap",children:e.notes})]})]}),R.jsxs("div",{className:"flex space-x-2 ml-4",children:[R.jsx("button",{onClick:()=>(e=>{l(e.id),d(e.weight_kg.toString()),c(e.notes||"")})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors",title:"ç·¨é›†",children:R.jsx(Ue,{className:"w-4 h-4"})}),R.jsx("button",{onClick:()=>(async(e,t)=>{if(confirm(`${new Date(t).toLocaleDateString("ja-JP")}ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`))try{await a(e)}catch(r){console.error("Error deleting weight record:",r),alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(e.id,e.date),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"w-4 h-4"})})]})]})},e.id))})]})}function Mr({acwrData:e,weightData:t}){const r=e.map(e=>{const r=t.find(t=>t.date===e.date);return{date:new Date(e.date).toLocaleDateString("ja-JP",{month:"numeric",day:"numeric"}),fullDate:e.date,acwr:Number(e.acwr),weight:r?Number(r.weight_kg):null}});if(0===r.length)return R.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"});const a=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return R.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[R.jsx("p",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:e.fullDate}),t.map((e,t)=>R.jsxs("p",{className:"text-sm",style:{color:e.color},children:[e.name,": ",null!==e.value?Number(e.value).toFixed(2):"-"]},t))]})}return null};return R.jsx("div",{className:"w-full h-96",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[R.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),R.jsx(i,{dataKey:"date",stroke:"#6B7280",tick:{fill:"#6B7280"}}),R.jsx(d,{yAxisId:"left",stroke:"#3B82F6",tick:{fill:"#3B82F6"},label:{value:"ACWR",angle:-90,position:"insideLeft",fill:"#3B82F6"}}),R.jsx(d,{yAxisId:"right",orientation:"right",stroke:"#10B981",tick:{fill:"#10B981"},label:{value:"ä½“é‡ (kg)",angle:90,position:"insideRight",fill:"#10B981"}}),R.jsx(o,{content:R.jsx(a,{})}),R.jsx(u,{wrapperStyle:{paddingTop:"20px"}}),R.jsx(x,{yAxisId:"left",type:"monotone",dataKey:"acwr",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",r:4},name:"ACWR",connectNulls:!0}),R.jsx(x,{yAxisId:"right",type:"monotone",dataKey:"weight",stroke:"#10B981",strokeWidth:2,dot:{fill:"#10B981",r:4},name:"ä½“é‡ (kg)",connectNulls:!0})]})})})}function Er({acwrData:e,weightData:t}){const r=(()=>{const r=[];if(t.length<2||e.length<2)return[{type:"info",title:"ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ä¸­",description:"ã‚‚ã†å°‘ã—ãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œã‚‹ã¨ã€ä½“é‡ã¨ACWRã®é–¢é€£æ€§ã‚’åˆ†æã§ãã¾ã™ã€‚",icon:R.jsx(lt,{className:"w-5 h-5"})}];const a=[...t].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),s=a.slice(-7);if(s.length>=2){const t=Number(s[0].weight_kg),a=Number(s[s.length-1].weight_kg)-t,n=(a/t*100).toFixed(1);if(Math.abs(a)>=2){const t=e.slice(-7).filter(e=>"high"===e.riskLevel||"caution"===e.riskLevel).length;a<0&&t>=2?r.push({type:"warning",title:"æ³¨æ„: ä½“é‡æ¸›å°‘ã¨é«˜è² è·ã®çµ„ã¿åˆã‚ã›",description:`æœ€è¿‘1é€±é–“ã§ä½“é‡ãŒ${Math.abs(a).toFixed(1)}kgæ¸›å°‘ã—ã€åŒæ™‚ã«ACWRãƒªã‚¹ã‚¯ãŒé«˜ã„æ—¥ãŒ${t}æ—¥ã‚ã‚Šã¾ã—ãŸã€‚ç–²åŠ´è“„ç©ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚`,icon:R.jsx(fe,{className:"w-5 h-5"})}):Math.abs(a)>=2&&r.push({type:"info",title:`ä½“é‡ãŒ${a>0?"å¢—åŠ ":"æ¸›å°‘"}å‚¾å‘`,description:`æœ€è¿‘1é€±é–“ã§${n}%ï¼ˆ${a>0?"+":""}${a.toFixed(1)}kgï¼‰å¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚`,icon:a>0?R.jsx(Vt,{className:"w-5 h-5"}):R.jsx(Ht,{className:"w-5 h-5"})})}}const n=e.slice(-30),l=n.filter(e=>"good"===e.riskLevel).length,i=n.filter(e=>"high"===e.riskLevel).length;if(l>=20&&t.length>=10){const e=a.slice(-10),t=e.reduce((e,t)=>e+Number(t.weight_kg),0)/e.length;e.reduce((e,r)=>e+Math.pow(Number(r.weight_kg)-t,2),0)/e.length<1&&r.push({type:"success",title:"è‰¯å¥½ãªãƒãƒ©ãƒ³ã‚¹",description:"ä½“é‡ãŒå®‰å®šã—ã€ACWRã‚‚è‰¯å¥½ãªç¯„å›²ã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¹ã‚’ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚",icon:R.jsx(dt,{className:"w-5 h-5"})})}i>=5&&r.push({type:"warning",title:"é«˜è² è·ã®æ—¥ãŒå¤šã‚",description:`éå»30æ—¥é–“ã§${i}æ—¥ãŒé«˜ãƒªã‚¹ã‚¯ã§ã—ãŸã€‚ä¼‘é¤Šã¨æ „é¤Šè£œçµ¦ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚`,icon:R.jsx(fe,{className:"w-5 h-5"})});const d=a.map(e=>Number(e.weight_kg));if(d.length>=14){const t=d.slice(0,7),a=d.slice(-7),s=t.reduce((e,t)=>e+t,0)/t.length,n=a.reduce((e,t)=>e+t,0)/a.length,l=e.slice(0,7).map(e=>Number(e.acwr)),i=e.slice(-7).map(e=>Number(e.acwr)),o=l.reduce((e,t)=>e+t,0)/l.length,c=i.reduce((e,t)=>e+t,0)/i.length;n<s-1&&c>o+.2&&r.push({type:"discovery",title:"ç™ºè¦‹: ä½“é‡æ¸›å°‘æ™‚ã«ACWRä¸Šæ˜‡",description:"ä½“é‡ãŒæ¸›å°‘ã—ã¦ã„ã‚‹æœŸé–“ã¯ã€ACWRãŒé«˜ããªã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚æ „é¤Šè£œçµ¦ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚",icon:R.jsx(dt,{className:"w-5 h-5"})})}return 0===r.length&&r.push({type:"info",title:"é †èª¿ã§ã™",description:"ç¾åœ¨ã®ã¨ã“ã‚ã€ç‰¹ã«æ³¨æ„ã™ã¹ãç‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ãƒšãƒ¼ã‚¹ã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚",icon:R.jsx(lt,{className:"w-5 h-5"})}),r})();return R.jsxs("div",{className:"space-y-4",children:[R.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[R.jsx(dt,{className:"w-5 h-5 mr-2 text-yellow-500"}),"ã‚¤ãƒ³ã‚µã‚¤ãƒˆ"]}),r.map((e,t)=>{const r=(e=>{switch(e){case"warning":return{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",icon:"text-yellow-600 dark:text-yellow-400",title:"text-yellow-900 dark:text-yellow-200",desc:"text-yellow-700 dark:text-yellow-300"};case"success":return{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",icon:"text-green-600 dark:text-green-400",title:"text-green-900 dark:text-green-200",desc:"text-green-700 dark:text-green-300"};case"discovery":return{bg:"bg-purple-50 dark:bg-purple-900/20",border:"border-purple-200 dark:border-purple-800",icon:"text-purple-600 dark:text-purple-400",title:"text-purple-900 dark:text-purple-200",desc:"text-purple-700 dark:text-purple-300"};default:return{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",icon:"text-blue-600 dark:text-blue-400",title:"text-blue-900 dark:text-blue-200",desc:"text-blue-700 dark:text-blue-300"}}})(e.type);return R.jsx("div",{className:`${r.bg} ${r.border} border rounded-lg p-4 transition-colors`,children:R.jsxs("div",{className:"flex items-start",children:[R.jsx("div",{className:`${r.icon} mr-3 mt-0.5`,children:e.icon}),R.jsxs("div",{className:"flex-1",children:[R.jsx("h4",{className:`font-semibold ${r.title} mb-1`,children:e.title}),R.jsx("p",{className:`text-sm ${r.desc}`,children:e.description})]})]})},t)})]})}function Rr(e){const t=e/100;return{min:18.5*t*t,max:24.9*t*t}}function Tr({weightKg:e,heightCm:t,dateOfBirth:r,gender:a}){const s=r?function(e){const t=new Date(e),r=new Date;let a=r.getFullYear()-t.getFullYear();const s=r.getMonth()-t.getMonth();return(s<0||0===s&&r.getDate()<t.getDate())&&a--,a}(r):void 0,n=function(e,t,r,a){const s=function(e,t){const r=t/100;return e/(r*r)}(e,t),{category:n,label:l,healthRisk:i}=function(e){return e<18.5?{category:"underweight",label:"ä½ä½“é‡",healthRisk:"increased"}:e<25?{category:"normal",label:"æ¨™æº–ä½“é‡",healthRisk:"normal"}:e<30?{category:"overweight",label:"éä½“é‡",healthRisk:"increased"}:{category:"obese",label:"è‚¥æº€",healthRisk:"high"}}(s);let d;const o="male"===a||"female"===a?a:null;if(r&&o){const e=function(e,t,r){if(!r)return null;const a=e/100;let s,n;return t<20?(s="male"===r?19:18,n="male"===r?24:23):t<30?(s="male"===r?20:19,n="male"===r?25:24):t<50?(s="male"===r?21:20,n="male"===r?26:25):(s="male"===r?22:21,n="male"===r?27:26),{min:s*a*a,max:n*a*a}}(t,r,o);d=e||Rr(t)}else if(o){const e=function(e,t){if(!t)return null;const r=e/100;return"male"===t?{min:20*r*r,max:25*r*r}:{min:19*r*r,max:24*r*r}}(t,o);d=e||Rr(t)}else d=Rr(t);return{bmi:s,category:n,categoryLabel:l,healthRisk:i,idealWeightRange:d}}(e,t,s,a),l=e>=n.idealWeightRange.min&&e<=n.idealWeightRange.max;return R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"BMIåˆ†æ"}),"high"===n.healthRisk?R.jsx(ye,{className:"w-5 h-5 text-red-500"}):"increased"===n.healthRisk?R.jsx(ye,{className:"w-5 h-5 text-yellow-500"}):R.jsx(pe,{className:"w-5 h-5 text-green-500"})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex-1",children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ç¾åœ¨ã®BMI"}),R.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:n.bmi.toFixed(1)})]}),R.jsx("div",{className:`px-4 py-2 rounded-lg font-medium text-sm ${(e=>{switch(e){case"underweight":return"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20 dark:text-yellow-400";case"normal":return"text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400";case"overweight":return"text-orange-600 bg-orange-50 dark:bg-orange-900/20 dark:text-orange-400";case"obese":return"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400";default:return"text-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-gray-400"}})(n.category)}`,children:n.categoryLabel})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:[s&&a?`${s}æ­³ãƒ»${"male"===a?"ç”·æ€§":"female"===a?"å¥³æ€§":""}ã®`:"","é©æ­£ä½“é‡ç¯„å›²"]}),R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"æœ€å°"}),R.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[n.idealWeightRange.min.toFixed(1)," kg"]})]}),R.jsx("div",{className:"flex-1 mx-4",children:R.jsxs("div",{className:"relative h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden",children:[R.jsx("div",{className:"absolute h-full bg-green-500 rounded-full",style:{left:"0%",width:"100%"}}),!l&&R.jsx("div",{className:"absolute h-full w-1 bg-red-500",style:{left:`${Math.min(100,Math.max(0,(e-n.idealWeightRange.min)/(n.idealWeightRange.max-n.idealWeightRange.min)*100))}%`}})]})}),R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"æœ€å¤§"}),R.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[n.idealWeightRange.max.toFixed(1)," kg"]})]})]})]}),R.jsx("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:e<n.idealWeightRange.min?R.jsxs(R.Fragment,{children:[R.jsx(Vt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),R.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3",children:["é©æ­£ç¯„å›²ã¾ã§ ",R.jsxs("strong",{children:[(n.idealWeightRange.min-e).toFixed(1)," kg"]})," ã®å¢—é‡ãŒæ¨å¥¨ã•ã‚Œã¾ã™"]})]}):e>n.idealWeightRange.max?R.jsxs(R.Fragment,{children:[R.jsx(Ht,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),R.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3",children:["é©æ­£ç¯„å›²ã¾ã§ ",R.jsxs("strong",{children:[(e-n.idealWeightRange.max).toFixed(1)," kg"]})," ã®æ¸›é‡ãŒæ¨å¥¨ã•ã‚Œã¾ã™"]})]}):R.jsxs(R.Fragment,{children:[R.jsx(pe,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),R.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 flex-1 ml-3",children:"é©æ­£ä½“é‡ç¯„å›²å†…ã§ã™"})]})}),s&&a&&R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€» å¹´é½¢ãƒ»æ€§åˆ¥ã‚’è€ƒæ…®ã—ãŸé©æ­£ä½“é‡ç¯„å›²ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™"})]})]})}function Ar(e){if(!e)return"";let t=e.replace(/[ï¼-ï¼™]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\D/g,"");return t.startsWith("81")&&(t="0"+t.slice(2)),t}function $r({user:e,onUpdate:t,onClose:a}){var s;const[n,l]=r.useState(e.name??""),[i,d]=r.useState(e.gender||""),[o,c]=r.useState((null==(s=e.height_cm)?void 0:s.toString())||""),[x,m]=r.useState(e.date_of_birth||""),[u,g]=r.useState(e.phone_number||""),[h,b]=r.useState(!1),[p,y]=r.useState(""),[f,j]=r.useState(!1),v=(()=>{if(!x)return null;const e=new Date(x),t=new Date;let r=t.getFullYear()-e.getFullYear();const a=t.getMonth()-e.getMonth();return(a<0||0===a&&t.getDate()<e.getDate())&&r--,r})(),w=Ar(u);return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:R.jsxs("div",{className:"p-6",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[R.jsx(er,{className:"w-6 h-6 mr-2"}),"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†"]}),R.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",type:"button",children:R.jsx("span",{className:"text-2xl",children:"Ã—"})})]}),R.jsxs("form",{onSubmit:async r=>{r.preventDefault(),y(""),j(!1),b(!0);try{const r=n.trim();if(!r)throw new Error("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const l=o?Number(o):null;if(null!==l&&(Number.isNaN(l)||l<100||l>250))throw new Error("èº«é•·ã¯100ã€œ250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(x){const e=new Date(x),t=(new Date).getFullYear()-e.getFullYear();if(Number.isNaN(e.getTime())||t<10||t>150)throw new Error("ç”Ÿå¹´æœˆæ—¥ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ10æ­³ä»¥ä¸Šï¼‰ã€‚")}const d=Ar(u);if((s=d)&&!/^0[7-9]0\d{8}$/.test(s))throw new Error("é›»è©±ç•ªå·ã¯070 / 080 / 090ã‹ã‚‰å§‹ã¾ã‚‹æºå¸¯ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆãƒã‚¤ãƒ•ãƒ³OKï¼‰ã€‚");const c={name:r,gender:i||null,height_cm:l,date_of_birth:x||null,phone_number:d||null},{error:m}=await q.from("users").update(c).eq("id",e.id);if(m)throw m;j(!0),setTimeout(()=>{t(),a()},1200)}catch(l){console.error("Error updating profile:",l),y(l instanceof Error?l.message:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{b(!1)}var s},className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"åå‰"}),R.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",required:!0})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[R.jsx(Nt,{className:"w-4 h-4 mr-2"}),"é›»è©±ç•ªå·ï¼ˆæºå¸¯ã®ã¿ãƒ»ä»»æ„ï¼‰"]}),R.jsx("input",{type:"tel",inputMode:"tel",value:u,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",placeholder:"090-1234-5678ï¼ˆ+81 ã§ã‚‚OKï¼‰"}),R.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-1",children:[R.jsx("p",{children:"CSVã§å–ã‚Šè¾¼ã‚€ InBody ãƒ‡ãƒ¼ã‚¿ã®æœ¬äººç´ä»˜ã‘ã«ä½¿ç”¨ã—ã¾ã™ã€‚"}),!!u&&R.jsxs("p",{children:["ä¿å­˜å½¢å¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ï¼‰: ",R.jsx("span",{className:"font-mono",children:w})]})]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[R.jsx(rr,{className:"w-4 h-4 mr-2"}),"æ€§åˆ¥ï¼ˆä»»æ„ï¼‰"]}),R.jsxs("select",{value:i,onChange:e=>d(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",children:[R.jsx("option",{value:"",children:"é¸æŠã—ãªã„"}),R.jsx("option",{value:"male",children:"ç”·æ€§"}),R.jsx("option",{value:"female",children:"å¥³æ€§"}),R.jsx("option",{value:"other",children:"ãã®ä»–"}),R.jsx("option",{value:"prefer_not_to_say",children:"å›ç­”ã—ãªã„"})]}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å¥³æ€§ã‚’é¸æŠã™ã‚‹ã¨ã€åŸºç¤ä½“æ¸©ã‚„æœˆçµŒå‘¨æœŸã®è¨˜éŒ²æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[R.jsx(Dt,{className:"w-4 h-4 mr-2"}),"èº«é•·ï¼ˆcmï¼‰ï¼ˆä»»æ„ï¼‰"]}),R.jsx("input",{type:"number",step:"0.1",min:"100",max:"250",value:o,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white",placeholder:"175.5"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"èº«é•·ã‚’å…¥åŠ›ã™ã‚‹ã¨BMIãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ï¼ˆ100ã€œ250cmï¼‰"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[R.jsx(Me,{className:"w-4 h-4 mr-2"}),"ç”Ÿå¹´æœˆæ—¥ï¼ˆä»»æ„ï¼‰"]}),R.jsx("input",{type:"date",value:x,onChange:e=>m(e.target.value),max:V(10),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white"}),null!==v&&R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ç¾åœ¨ã®å¹´é½¢: ",v,"æ­³"]}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å¹´é½¢åˆ¥ã®é©æ­£ä½“é‡ç¯„å›²ã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–å€¤ã®è¡¨ç¤ºã«ä½¿ç”¨ã•ã‚Œã¾ã™"})]}),p&&R.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(ye,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),R.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:p})]})}),f&&R.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(Mt,{className:"w-5 h-5 text-green-600 dark:text-green-400 mr-2"}),R.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ"})]})}),R.jsxs("div",{className:"flex space-x-3 pt-4",children:[R.jsx("button",{type:"submit",disabled:h||f,className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:h?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"ä¿å­˜ä¸­..."]}):R.jsxs(R.Fragment,{children:[R.jsx(Mt,{className:"w-5 h-5 mr-2"}),"ä¿å­˜"]})}),R.jsx("button",{type:"button",onClick:a,disabled:h,className:"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]})]})})})}function zr({targetElement:e,padding:t=8,zIndex:a=1e4,onClick:s}){const[n,l]=r.useState(null),i=r.useRef(null),d=r.useId();r.useEffect(()=>{if(!e)return void l(null);const t=()=>{const t=e.getBoundingClientRect();l(t)};return t(),window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[e]);return R.jsx("div",{ref:i,className:"fixed inset-0 transition-all duration-300",style:{zIndex:a},onClick:e=>{e.target===i.current&&(null==s||s())},"aria-hidden":"true",children:R.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:a+1},children:[R.jsx("defs",{children:R.jsxs("mask",{id:`tutorial-mask-${d}`,children:[R.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),n&&R.jsx("rect",{x:n.left-t,y:n.top-t,width:n.width+2*t,height:n.height+2*t,rx:"8",fill:"black"})]})}),R.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"rgba(0, 0, 0, 0.7)",mask:`url(#tutorial-mask-${d})`}),n&&R.jsx("rect",{x:n.left-t,y:n.top-t,width:n.width+2*t,height:n.height+2*t,rx:"8",fill:"none",stroke:"#3B82F6",strokeWidth:"3",className:"animate-pulse"})]})})}function qr({targetElement:e,position:t="bottom",title:a,description:s,currentStep:n,totalSteps:l,onNext:i,onPrev:d,onSkip:o,onClose:c,showPrev:x=!0,nextLabel:m="æ¬¡ã¸",zIndex:u=9999}){const g=r.useRef(null),[h,b]=r.useState({});return r.useEffect(()=>{if(e&&g.current){const r=()=>{const r=e.getBoundingClientRect(),a=g.current.getBoundingClientRect(),s=16;let n=0,l=0;if("center"===t)n=window.innerHeight/2-a.height/2,l=window.innerWidth/2-a.width/2;else{switch(t){case"top":n=r.top-a.height-s,l=r.left+(r.width-a.width)/2;break;case"bottom":n=r.bottom+s,l=r.left+(r.width-a.width)/2;break;case"left":n=r.top+(r.height-a.height)/2,l=r.left-a.width-s;break;case"right":n=r.top+(r.height-a.height)/2,l=r.right+s}l=Math.max(s,Math.min(l,window.innerWidth-a.width-s)),n=Math.max(s,Math.min(n,window.innerHeight-a.height-s))}b({position:"fixed",top:`${n}px`,left:`${l}px`,zIndex:u})};return r(),window.addEventListener("resize",r),window.addEventListener("scroll",r,!0),()=>{window.removeEventListener("resize",r),window.removeEventListener("scroll",r,!0)}}e||"center"!==t||b({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:u})},[e,t,u]),R.jsxs("div",{ref:g,style:h,className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl border-2 border-blue-500 dark:border-blue-400 w-[90vw] max-w-3xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-300",role:"dialog","aria-labelledby":"tutorial-title","aria-describedby":"tutorial-description",children:[R.jsxs("div",{className:"p-5 sm:p-6 md:p-8",children:[R.jsxs("div",{className:"flex items-start justify-between mb-3",children:[R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("div",{className:"flex items-center gap-2 mb-1.5",children:R.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",children:[n," / ",l]})}),R.jsx("h3",{id:"tutorial-title",className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900 dark:text-white pr-1",children:a})]}),c&&R.jsx("button",{onClick:c,className:"ml-1 flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‰ã˜ã‚‹",children:R.jsx(sr,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),R.jsx("p",{id:"tutorial-description",className:"text-sm sm:text-base md:text-lg text-gray-600 dark:text-gray-300 mb-5 sm:mb-6 leading-relaxed",children:s}),R.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap sm:flex-nowrap",children:[R.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[x&&d&&n>1&&R.jsx("button",{onClick:d,className:"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"æˆ»ã‚‹"}),o&&R.jsx("button",{onClick:o,className:"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors",children:"ã‚¹ã‚­ãƒƒãƒ—"})]}),i&&R.jsx("button",{onClick:i,className:"px-5 py-2 sm:px-7 sm:py-2.5 text-sm sm:text-base font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors shadow-sm",children:n===l?"å®Œäº†":m})]})]}),R.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700",children:R.jsx("div",{className:"h-full bg-blue-600 dark:bg-blue-500 transition-all duration-300",style:{width:n/l*100+"%"}})})]})}function Fr({currentStep:e,totalSteps:t,stepTitles:r,className:a=""}){return R.jsx("div",{className:`flex items-center justify-center gap-2 ${a}`,children:Array.from({length:t},(e,t)=>t+1).map(a=>{const s=a<e,n=a===e,l=null==r?void 0:r[a-1];return R.jsxs("div",{className:"flex items-center gap-2",title:l,children:[R.jsxs("div",{className:"relative flex items-center justify-center",children:[s?R.jsx(Te,{className:"w-6 h-6 text-green-500 dark:text-green-400"}):R.jsx(Pe,{className:"w-6 h-6 "+(n?"text-blue-600 dark:text-blue-400 fill-blue-100 dark:fill-blue-900":"text-gray-300 dark:text-gray-600")}),n&&R.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-blue-600 dark:border-blue-400 animate-ping"})]}),a<t&&R.jsx("div",{className:"w-8 h-0.5 "+(s?"bg-green-500 dark:bg-green-400":"bg-gray-300 dark:bg-gray-600")})]},a)})})}function Ir({steps:e,isActive:t,onComplete:a,onSkip:s,currentStepIndex:n,onStepChange:l,showProgress:i=!0}){const[d,o]=r.useState(0),[c,x]=r.useState(null),[m,u]=r.useState(!1),g=n??d,h=l??o,b=e[g];r.useEffect(()=>{if(!t||!b)return void x(null);let e=!1;const r=()=>{if(!e)if(b.targetSelector){const e=document.querySelector(b.targetSelector);if(e){x(e);try{e.scrollIntoView({behavior:"smooth",block:"center"})}catch{}}else x(null)}else x(null)};(async()=>{try{b.beforeStep&&await b.beforeStep()}catch(e){console.warn("[Tutorial] beforeStep error",e)}})().then(r);const a=new MutationObserver(r);return a.observe(document.body,{childList:!0,subtree:!0}),()=>{e=!0,a.disconnect()}},[t,b,g]);const p=r.useCallback(async()=>{if(!m&&b)try{u(!0);try{b.afterStep&&await b.afterStep()}catch(t){console.warn("[Tutorial] afterStep error",t)}try{b.action&&await b.action()}catch(t){console.warn("[Tutorial] action error",t)}g<e.length-1?h(g+1):a()}finally{u(!1)}},[g,e.length,b,a,h,m]),y=r.useCallback(()=>{g>0&&!m&&h(g-1)},[g,h,m]),f=r.useCallback(()=>{m||s()},[s,m]);return r.useEffect(()=>{const r=r=>{t&&("Escape"===r.key?f():"Enter"===r.key?p():"ArrowLeft"===r.key&&g>0?y():"ArrowRight"===r.key&&g<e.length-1&&p())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,g,e.length,p,y,f]),t&&b?R.jsxs(R.Fragment,{children:[R.jsx(zr,{targetElement:c,onClick:f}),R.jsx("div",{className:"fixed inset-0 z-[10001] pointer-events-none",children:R.jsx("div",{className:"pointer-events-auto",onClick:e=>{e.stopPropagation()},children:R.jsx(qr,{targetElement:c,position:b.position||"bottom",title:b.title,description:b.description,currentStep:g+1,totalSteps:e.length,onNext:p,onPrev:g>0?y:void 0,onSkip:f,showPrev:g>0})})}),i&&R.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-[10002] pointer-events-none",children:R.jsx(Fr,{currentStep:g+1,totalSteps:e.length,stepTitles:e.map(e=>e.title)})})]}):null}function Lr(e){if(null==e||""===e)return null;const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null}function Pr(e){if(!e)return null;const t=String(e).match(/^(\d{4}-\d{2}-\d{2})/);return t?t[1]:null}function Or(e){const t=Pr(e);if(!t)throw new Error("Invalid date");return t}function Wr(e){if(!e)return null;if("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;return Pr(String(e))??null}function Br(e,t){const r=String((null==e?void 0:e.date)??""),a=String((null==t?void 0:t.date)??"");return r.localeCompare(a)}function Ur(e,t){const r=[...e||[]],a=r.findIndex(e=>e.id===t.id);return a>=0?r[a]=t:r.push(t),r.sort(Br),r}function Hr(e){const[t,a]=r.useState([]),[s,n]=r.useState([]),[l,i]=r.useState([]),[d,o]=r.useState(!0),c=r.useRef(!1),x=r.useRef(null),m=r.useCallback(async(t,r)=>{await async function({userId:e,eventType:t,payload:r={}}){if(e)try{const{error:a}=await q.from("events").insert({user_id:e,event_type:t,payload:r});if(a)throw a}catch(a){console.warn("[logEvent] failed:",a)}else console.warn("[logEvent] skipped: missing userId",{eventType:t,payload:r})}({userId:e,eventType:t,payload:r})},[e]),u=r.useCallback(async()=>{if(!e)return;const r=`user:${e}`;if(!(c.current||x.current===r&&t.length>0)){c.current=!0,x.current=r,o(!0);try{const[t,r]=await Promise.all([q.from("training_records").select("*").eq("user_id",e).order("date",{ascending:!0}),q.from("weight_records").select("*").eq("user_id",e).order("date",{ascending:!0})]);if(t.error)throw t.error;if(r.error)throw r.error;a(t.data||[]),n(r.data||[])}catch(s){console.error("[useTrainingData] Error fetching data:",s),a([]),n([]),i([]),x.current=null}finally{c.current=!1,o(!1)}}},[e,!1,t.length]);r.useEffect(()=>{e&&u()},[e,u]),r.useEffect(()=>{const e=(t||[]).map(e=>{const t=Wr(null==e?void 0:e.date);if(!t)return null;const r=Lr(null==e?void 0:e.load),a=Lr(null==e?void 0:e.rpe),s=Lr(null==e?void 0:e.duration_min);return{date:t,load:null!=r?r:null!=a&&null!=s?a*s:null}}).filter(Boolean);i(ie(e))},[t]);const g=r.useCallback(async t=>{const r=Pr(t);if(!r)return null;{const{data:t,error:a}=await q.from("training_records").select("*").eq("user_id",e).eq("date",r).maybeSingle();if(a)throw a;return t}},[e]),h=r.useCallback(async t=>{const r=Pr(t.date);if(!r)throw new Error("Invalid date");const s=Or(t.date),{data:n,error:l}=await q.from("training_records").insert([{user_id:e,date:s,rpe:t.rpe,duration_min:t.duration_min,arrow_score:t.arrow_score,signal_score:t.signal_score}]).select().single();if(l)throw l;return a(e=>Ur(e,n)),await m("training_completed",{date:r,rpe:t.rpe,duration_min:t.duration_min,arrow_score:t.arrow_score,signal_score:t.signal_score,overwrite:!1}),n},[e,m]),b=r.useCallback(async(t,r)=>{const s=r.date?Pr(r.date):null,n=r.date?Or(r.date):null,l={...void 0!==r.rpe?{rpe:r.rpe}:{},...void 0!==r.duration_min?{duration_min:r.duration_min}:{},...void 0!==r.arrow_score?{arrow_score:r.arrow_score}:{},...void 0!==r.signal_score?{signal_score:r.signal_score}:{},...n?{date:n}:{}},{data:i,error:d}=await q.from("training_records").update(l).eq("id",t).eq("user_id",e).select().single();if(d)throw d;a(e=>Ur(e,i));const o=s??Wr(null==i?void 0:i.date)??void 0;return await m("training_completed",{date:o,rpe:r.rpe??(null==i?void 0:i.rpe),duration_min:r.duration_min??(null==i?void 0:i.duration_min),arrow_score:r.arrow_score??(null==i?void 0:i.arrow_score),signal_score:r.signal_score??(null==i?void 0:i.signal_score),overwrite:!0}),i},[e,m]),p=r.useCallback(async t=>{const{error:r}=await q.from("training_records").delete().eq("id",t).eq("user_id",e);if(r)throw r;a(e=>function(e,t){const r=(e||[]).filter(e=>e.id!==t);return r.sort(Br),r}(e,t))},[e]);return{records:t,weightRecords:s,acwrData:l,loading:d,fetchAll:u,checkExistingRecord:g,addTrainingRecord:h,updateTrainingRecord:b,deleteTrainingRecord:p}}function Vr(e){if(!e)return null;const t=String(e).slice(0,10).replace(/\//g,"-").match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(t){const e=Number(t[1]),r=Number(t[2]),a=Number(t[3]);if(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(a))return new Date(e,r-1,a)}const r=new Date(String(e)).getTime();return Number.isFinite(r)?new Date(r):null}function Kr(e){return e?String(e).slice(0,10).replace(/\//g,"-"):""}function Jr(e,t){var r,a;const s=Kr(e.date),n=Kr(t.date);if(s&&n)return n.localeCompare(s);const l=(null==(r=Vr(e.date))?void 0:r.getTime())??0;return((null==(a=Vr(t.date))?void 0:a.getTime())??0)-l}function Yr(e,t){return-Jr(e,t)}function Zr(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null),d=r.useCallback(e=>{const t=[...e].sort(Jr);a(t)},[]),o=r.useCallback(async()=>{try{n(!0),i(null);const{data:t,error:r}=await q.from("weight_records").select("*").eq("user_id",e).order("date",{ascending:!1});if(r)throw r;d(t||[])}catch(t){console.error("Error fetching weight records:",t),i(t instanceof Error?t.message:"ä½“é‡è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),d([])}finally{n(!1)}},[e,d]);r.useEffect(()=>{e&&o()},[e,o]);const c=r.useCallback(async t=>{try{const r=Kr(t),{data:a,error:s}=await q.from("weight_records").select("*").eq("user_id",e).eq("date",r).maybeSingle();if(s)throw s;return a??null}catch(r){return console.error("Error checking existing record:",r),null}},[e]),x=r.useCallback(async e=>{try{const{data:t}=await q.auth.getUser();if(!t.user)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r={user_id:t.user.id,weight_kg:e.weight_kg,date:Kr(e.date),notes:e.notes||null},{data:s,error:n}=await q.from("weight_records").insert(r).select().single();if(n)throw n;a(e=>[s,...e].sort(Jr))}catch(t){throw console.error("Error adding weight record:",t),t}},[]),m=r.useCallback(async(e,t)=>{try{const r={weight_kg:t.weight_kg,notes:t.notes||null},{data:s,error:n}=await q.from("weight_records").update(r).eq("id",e).select().single();if(n)throw n;a(t=>t.map(t=>t.id===e?s:t).sort(Jr))}catch(r){throw console.error("Error updating weight record:",r),r}},[]),u=r.useCallback(async e=>{try{const{error:t}=await q.from("weight_records").delete().eq("id",e);if(t)throw t;a(t=>t.filter(t=>t.id!==e))}catch(t){throw console.error("Error deleting weight record:",t),t}},[]),g=r.useCallback(()=>{if(!t||0===t.length)return null;const e=t.reduce((e,t)=>{if(!e)return t;const r=Kr(e.date);return Kr(t.date)>r?t:e},null),r=Number(null==e?void 0:e.weight_kg);return Number.isFinite(r)?r:null},[t]),h=r.useCallback((e=30)=>{if(!t||t.length<2)return null;const r=new Date,a=new Date(r.getFullYear(),r.getMonth(),r.getDate());a.setDate(a.getDate()-e);const s=[...t].sort(Yr).filter(e=>{const t=Vr(e.date);return!!t&&t.getTime()>=a.getTime()});if(s.length<2)return null;const n=Number(s[0].weight_kg),l=Number(s[s.length-1].weight_kg);return Number.isFinite(n)&&Number.isFinite(l)?l-n:null},[t]);return{records:t,loading:s,error:l,checkExistingRecord:c,addWeightRecord:x,updateWeightRecord:m,deleteWeightRecord:u,getLatestWeight:g,getWeightChange:h,refresh:o}}function Gr(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{d()},[e]);const d=async()=>{try{n(!0);const{data:t,error:r}=await q.from("menstrual_cycles").select("*").eq("user_id",e).order("cycle_start_date",{ascending:!1});if(r)throw r;a(t||[])}catch(t){i(t instanceof Error?t.message:"Failed to fetch menstrual cycles")}finally{n(!1)}},o=(e,t)=>{const r=new Date(e.cycle_start_date),a=Math.floor((t.getTime()-r.getTime())/864e5);if(a<0)return null;if(e.period_duration_days&&a<e.period_duration_days)return"menstrual";if(e.cycle_length_days){const t=Math.floor(e.cycle_length_days/2);if(a<t)return"follicular";if(a<t+2)return"ovulatory";if(a<e.cycle_length_days)return"luteal"}return null};return{cycles:t,loading:s,error:l,addCycle:async t=>{try{const{data:r}=await q.auth.getUser();if(!r.user)throw new Error("User not authenticated");const{data:s}=await q.from("users").select("team_id").eq("user_id",r.user.id).maybeSingle();let n=null;if(null==s?void 0:s.team_id){const{data:e}=await q.from("teams").select("organization_id").eq("id",s.team_id).maybeSingle();n=(null==e?void 0:e.organization_id)||null}const{data:l,error:i}=await q.from("menstrual_cycles").insert({...t,user_id:e,organization_id:n}).select().single();if(i)throw i;return l&&a(e=>[l,...e]),l}catch(r){throw i(r instanceof Error?r.message:"Failed to add menstrual cycle"),r}},updateCycle:async(e,t)=>{try{const{data:r,error:s}=await q.from("menstrual_cycles").update(t).eq("id",e).select().single();if(s)throw s;return r&&a(t=>t.map(t=>t.id===e?r:t)),r}catch(r){throw i(r instanceof Error?r.message:"Failed to update menstrual cycle"),r}},deleteCycle:async e=>{try{const{error:t}=await q.from("menstrual_cycles").delete().eq("id",e);if(t)throw t;a(t=>t.filter(t=>t.id!==e))}catch(t){throw i(t instanceof Error?t.message:"Failed to delete menstrual cycle"),t}},getCyclePhase:o,getCurrentCyclePhase:()=>{const e=new Date;for(const r of t){const t=o(r,e);if(t)return{cycle:r,phase:t}}return null},refetch:d}}const Qr=[{id:"athlete-welcome",title:"Bekuta ã¸ã‚ˆã†ã“ã",description:"ç·åˆã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒªBekutaã¸ã‚ˆã†ã“ãã€‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ä½“é‡ã€ç¡çœ ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ä¸€å…ƒç®¡ç†ã—ã€ãƒ‡ãƒ¼ã‚¿ã§ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚",position:"center"},{id:"athlete-unified-checkin",title:"çµ±åˆãƒ‡ã‚¤ãƒªãƒ¼ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³",description:"1ã¤ã®ç”»é¢ã§ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ã€Œä½“é‡ã€ã€Œç¡çœ ã€ã€Œãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚’è¨˜éŒ²ã€‚æ¯æ—¥ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã€ç¶šã‘ã‚„ã™ãè¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚",targetSelector:'[data-tutorial="daily-checkin"]',position:"bottom"},{id:"athlete-performance",title:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨˜éŒ²",description:"ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹ã€ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆãªã©ã®ç­‹åŠ›ã€æŒä¹…åŠ›ã€ã‚¹ãƒ—ãƒªãƒ³ãƒˆãªã©ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã‚’è¨˜éŒ²ã€‚æˆé•·ã‚’å¯è¦–åŒ–ã—ã€ãƒ™ã‚¹ãƒˆæ›´æ–°ã‚’ç¥ã„ã¾ã™ã€‚",targetSelector:'[data-tutorial="performance-tab"]',position:"bottom"},{id:"athlete-acwr-chart",title:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã®å¯è¦–åŒ–",description:"æ€¥æ€§ãƒ»æ…¢æ€§ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰æ¯”ï¼ˆACWRï¼‰ã§æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’ç§‘å­¦çš„ã«ç®¡ç†ã€‚0.8ã€œ1.3ãŒç†æƒ³çš„ã§ã€æ€¥æ¿€ãªè² è·å¢—åŠ ã‚’é˜²ãã¾ã™ã€‚",targetSelector:'[data-tutorial="acwr-chart"]',position:"top"},{id:"athlete-multi-metric",title:"ç·åˆã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³",description:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ä½“é‡ã€ç¡çœ ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åŒæ™‚è¡¨ç¤ºã€‚ç›¸é–¢é–¢ä¿‚ã‚’è¦‹ã¤ã‘ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã®å…¨ä½“åƒã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="multi-metric-timeline"]',position:"top"},{id:"athlete-alerts",title:"ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆ",description:"è¤‡æ•°ã®æŒ‡æ¨™ã‚’çµ±åˆåˆ†æã—ã€æ€ªæˆ‘ãƒªã‚¹ã‚¯ã€ã‚ªãƒ¼ãƒãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€å›å¾©ä¸è¶³ã‚’æ—©æœŸã«ç™ºè¦‹ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆã§å¯¾å¿œã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚",targetSelector:'[data-tutorial="alert-badge"]',position:"bottom"},{id:"athlete-gamification",title:"ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³",description:"æ¥½ã—ããƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒï¼è¨˜éŒ²ã‚’ç¶šã‘ã¦ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ä¼¸ã°ã—ã€ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã¦ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã€‚ãƒãƒƒã‚¸ã‚’é›†ã‚ã¦é”æˆæ„Ÿã‚’å‘³ã‚ã„ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="gamification-tab"]',position:"bottom"},{id:"athlete-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"Bekutaã§ç·åˆçš„ãªã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚æ¯æ—¥ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã—ã€ç§‘å­¦çš„ãªæ ¹æ‹ ã«åŸºã¥ã„ãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€å¤§åŒ–ã—ã¾ã™ã€‚",position:"center"}],Xr=[{id:"staff-welcome",title:"Bekuta ã‚¹ã‚¿ãƒƒãƒ•ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ã‚ˆã†ã“ã",description:"ãƒãƒ¼ãƒ å…¨ä½“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çŠ¶æ³ã‚’ç§‘å­¦çš„ã«ç›£è¦–ã—ã€é¸æ‰‹ã®æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ç®¡ç†ã§ãã¾ã™ã€‚",position:"center"},{id:"staff-team-selector",title:"ãƒãƒ¼ãƒ é¸æŠ",description:"æ‹…å½“ã™ã‚‹ãƒãƒ¼ãƒ ã‚’é¸æŠã§ãã¾ã™ã€‚è¤‡æ•°ã®ãƒãƒ¼ãƒ ã‚’ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã“ã§åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚",targetSelector:'[data-tutorial="team-selector"]',position:"bottom"},{id:"staff-alert-summary",title:"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ",description:"ãƒãƒ¼ãƒ å…¨ä½“ã®æ³¨æ„ãŒå¿…è¦ãªé¸æ‰‹ãŒä¸€ç›®ã§åˆ†ã‹ã‚Šã¾ã™ã€‚AIãŒåˆ†æã—ãŸå„ªå…ˆåº¦ã®é«˜ã„ã‚¢ãƒ©ãƒ¼ãƒˆã«ç´ æ—©ãå¯¾å¿œã—ã€æ€ªæˆ‘ã‚’äº‹å‰ã«é˜²ãã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="alert-summary"]',position:"bottom"},{id:"staff-athletes-tab",title:"é¸æ‰‹ä¸€è¦§",description:"ãƒãƒ¼ãƒ ã®å…¨é¸æ‰‹ã‚’ä¸€è¦§ã§ç¢ºèªã§ãã¾ã™ã€‚å„é¸æ‰‹ã®çŠ¶æ…‹ã‚’æŠŠæ¡ã—ã€å€‹åˆ¥ã«ã‚µãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="athletes-tab"]',position:"bottom"},{id:"staff-athlete-list",title:"é¸æ‰‹ã®è©³ç´°ç¢ºèª",description:"é¸æ‰‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è©³ç´°ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å±¥æ­´ã¨ACWRã‚°ãƒ©ãƒ•ã‚’ç¢ºèªã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="athlete-list"]',position:"right"},{id:"staff-team-average",title:"ãƒãƒ¼ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ",description:"ãƒãƒ¼ãƒ å…¨ä½“ã®å¹³å‡ACWRã®æ¨ç§»ã‚’ç§‘å­¦çš„ã«åˆ†æã§ãã¾ã™ã€‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åŠ¹æœã‚’å®šé‡çš„ã«è©•ä¾¡ã—ã€æœ€é©åŒ–ã«å½¹ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="team-average-tab"]',position:"bottom"},{id:"staff-trends",title:"å‚¾å‘åˆ†æ",description:"ãƒãƒ¼ãƒ ã®é•·æœŸçš„ãªå‚¾å‘ã‚’åˆ†æã—ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨ˆç”»ã®æœ€é©åŒ–ã«å½¹ç«‹ã¦ã‚‰ã‚Œã¾ã™ã€‚",targetSelector:'[data-tutorial="trends-tab"]',position:"bottom"},{id:"staff-export",title:"ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ",description:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã€è©³ç´°ãªåˆ†æã‚„è¨˜éŒ²ä¿ç®¡ãŒã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="export-button"]',position:"bottom"},{id:"staff-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"ã“ã‚Œã§Bekutaã‚¹ã‚¿ãƒƒãƒ•ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’å­¦ã³ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§é¸æ‰‹ã®å®‰å…¨ã‚’å®ˆã‚Šã€æœ€å¤§é™ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†ã€‚",position:"center"}],ea=[{id:"admin-welcome",title:"Bekuta ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ã‚ˆã†ã“ã",description:"çµ„ç¹”å…¨ä½“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€å…ƒç®¡ç†ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ã€ãƒãƒ¼ãƒ ç®¡ç†ã€ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ã‚’åŠ¹ç‡çš„ã«è¡Œãˆã¾ã™ã€‚",position:"center"},{id:"admin-alert-summary",title:"çµ±åˆã‚¢ãƒ©ãƒ¼ãƒˆç›£è¦–",description:"çµ„ç¹”å…¨ä½“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ä¸€ç”»é¢ã§ç›£è¦–ã§ãã¾ã™ã€‚é‡å¤§ãªæ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚„ã‚·ã‚¹ãƒ†ãƒ å•é¡Œã«ç´ æ—©ãå¯¾å¿œã—ã€å®‰å…¨ãªç’°å¢ƒã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="admin-alert-summary"]',position:"bottom"},{id:"admin-overview-tab",title:"æ¦‚è¦ã‚¿ãƒ–",description:"ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®çµ±è¨ˆæƒ…å ±ã‚„é‡è¦ãªæŒ‡æ¨™ã‚’ç¢ºèªã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="overview-tab"]',position:"bottom"},{id:"admin-invite-tab",title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ ",description:"æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‹›å¾…ã—ã€Bekutaã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ‹¡å¤§ã§ãã¾ã™ã€‚å€‹åˆ¥æ‹›å¾…ã¨CSVä¸€æ‹¬æ‹›å¾…ã®2ã¤ã®æ–¹æ³•ã§ã€åŠ¹ç‡çš„ãªã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒå¯èƒ½ã§ã™ã€‚",targetSelector:'[data-tutorial="invite-tab"]',position:"bottom"},{id:"admin-single-invite",title:"å€‹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…",description:"1äººãšã¤æ‹›å¾…ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ã‚’ä½¿ã„ã¾ã™ã€‚åå‰ã€ãƒ¡ãƒ¼ãƒ«ã€å½¹å‰²ã€ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-tutorial="single-invite"]',position:"right"},{id:"admin-bulk-invite",title:"ä¸€æ‹¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…",description:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¸€åº¦ã«æ‹›å¾…ã§ãã¾ã™ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-tutorial="bulk-invite"]',position:"right"},{id:"admin-manage-tab",title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†",description:"æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç·¨é›†ã€å‰Šé™¤ã§ãã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚‚ã“ã“ã‹ã‚‰è¡Œãˆã¾ã™ã€‚",targetSelector:'[data-tutorial="manage-tab"]',position:"bottom"},{id:"admin-user-list",title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§",description:"å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™ã€‚æ¤œç´¢æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚",targetSelector:'[data-tutorial="user-list"]',position:"top"},{id:"admin-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"Bekutaç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®åŸºæœ¬æ©Ÿèƒ½ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€çµ„ç¹”å…¨ä½“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã¨å®‰å…¨ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç’°å¢ƒã‚’å®Ÿç¾ã—ã¾ã—ã‚‡ã†ã€‚",position:"center"}],ta=[{id:"parent-welcome",title:"ä¿è­·è€…ãƒ“ãƒ¥ãƒ¼ã¸ã‚ˆã†ã“ã",description:"ãŠå­ã•ã‚“ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã€å¿…è¦ãªã‚µãƒãƒ¼ãƒˆã«ç¹‹ã’ã‚‹ãŸã‚ã®ç”»é¢ã§ã™ã€‚",position:"center"},{id:"parent-complete",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼",description:"ã“ã“ã‹ã‚‰æ—¥ã€…ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",position:"center"}],ra=[{id:"gamification-welcome",title:"ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã‚ˆã†ã“ãï¼",description:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã—ãªãŒã‚‰ç¶™ç¶šçš„ãªè¨˜éŒ²ã‚’æ¥½ã—ã‚‚ã†ï¼ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã€ãƒã‚¤ãƒ³ãƒˆã€ãƒãƒƒã‚¸ã€ç›®æ¨™ã§æˆé•·ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚",position:"center"},{id:"gamification-streaks",title:"ã‚¹ãƒˆãƒªãƒ¼ã‚¯ - é€£ç¶šè¨˜éŒ²",description:"æ¯æ—¥è¨˜éŒ²ã‚’ç¶šã‘ã¦ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ä¼¸ã°ãã†ï¼ç·´ç¿’ã€ä½“é‡ã€ç¡çœ ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®4ç¨®é¡ã€‚é€£ç¶šè¨˜éŒ²ãŒé€”åˆ‡ã‚Œãã†ãªæ™‚ã¯è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚",targetSelector:'[data-tutorial="streaks-section"]',position:"right"},{id:"gamification-level",title:"ãƒ¬ãƒ™ãƒ« & ãƒã‚¤ãƒ³ãƒˆ",description:"è¨˜éŒ²ã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ï¼ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨æ–°ã—ã„ãƒ©ãƒ³ã‚¯ã‚¿ã‚¤ãƒˆãƒ«ãŒæ‰‹ã«å…¥ã‚Šã¾ã™ã€‚ãƒ“ã‚®ãƒŠãƒ¼ã‹ã‚‰ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã¾ã§ã€7æ®µéšã®ãƒ©ãƒ³ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚",targetSelector:'[data-tutorial="level-section"]',position:"right"},{id:"gamification-badges",title:"ãƒãƒƒã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³",description:"ç‰¹åˆ¥ãªé”æˆã§ãƒãƒƒã‚¸ã‚’ç²å¾—ï¼7æ—¥é€£ç¶šè¨˜éŒ²ã€ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ™ã‚¹ãƒˆæ›´æ–°ã€å®Œç’§ãªé€±ãªã©ã€‚ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã¯4æ®µéšï¼ˆCommon, Rare, Epic, Legendaryï¼‰ã€‚",targetSelector:'[data-tutorial="badges-card"]',position:"bottom"},{id:"gamification-goals",title:"ç›®æ¨™è¨­å®š",description:"è‡ªåˆ†ã ã‘ã®ç›®æ¨™ã‚’è¨­å®šã—ã¦é”æˆã‚’ç›®æŒ‡ãã†ï¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ä½“é‡ã€ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã€ç¿’æ…£ã€ã‚«ã‚¹ã‚¿ãƒ ãªã©æ§˜ã€…ãªç›®æ¨™ã‚¿ã‚¤ãƒ—ã‹ã‚‰é¸ã¹ã¾ã™ã€‚",targetSelector:'[data-tutorial="goals-section"]',position:"left"},{id:"gamification-rankings",title:"ãƒãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°",description:"ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ç«¶ã„åˆãŠã†ï¼é€±é–“è¨˜éŒ²æ•°ã¨ãƒã‚¤ãƒ³ãƒˆã®2ã¤ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒã‚ã‚Šã¾ã™ã€‚åˆ‡ç£‹ç¢ç£¨ã—ã¦æˆé•·ã—ã¾ã—ã‚‡ã†ã€‚",targetSelector:'[data-tutorial="rankings-section"]',position:"left"},{id:"gamification-complete",title:"ã•ã‚ã€å§‹ã‚ã‚ˆã†ï¼",description:"æ¥½ã—ã¿ãªãŒã‚‰è¨˜éŒ²ã‚’ç¶šã‘ã¦ã€ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ä¼¸ã°ã—ã€ãƒãƒƒã‚¸ã‚’é›†ã‚ã¾ã—ã‚‡ã†ã€‚ç¶™ç¶šã¯åŠ›ãªã‚Šï¼",position:"center"}];function aa(e){switch(e){case"athlete":return Qr;case"staff":return Xr;case"parent":return ta;case"global_admin":return ea;case"gamification":return ra;default:return[]}}function sa({onSubmit:e,onCheckExisting:t,onUpdate:a,loading:s=!1,lastRecord:n}){const[l,i]=r.useState(""),[d,o]=r.useState(H()),[c,x]=r.useState(3),[m,u]=r.useState(""),[g,h]=r.useState(""),[b,p]=r.useState(!1),[y,f]=r.useState(null),[j,v]=r.useState(null),[w,N]=r.useState(!1),[k,_]=r.useState(!1),[C,S]=r.useState("success"),[D,M]=r.useState(""),E=(e,t)=>{S(e),M(t),_(!0)},T=()=>{i(""),o(H()),x(3),u("")};r.useEffect(()=>{n&&(null!=n.sleep_hours&&i(String(n.sleep_hours)),null!=n.sleep_quality&&x(n.sleep_quality))},[n]);const A=()=>{p(!1),f(null),v(null)},$=s||w;return R.jsxs(R.Fragment,{children:[R.jsx(yr,{open:k,type:C,message:D,onClose:()=>_(!1)}),R.jsx(ur,{isOpen:b,onClose:A,onOverwrite:async()=>{if(y&&j&&!w&&!s){p(!1),N(!0),h("");try{await a(y.id,j),T(),f(null),v(null),E("success","ä¸Šæ›¸ãã—ã¦è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(e){h("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error updating record:",e),E("error",`ä¸Šæ›¸ãã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==e?void 0:e.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{N(!1)}}},onCancel:A,title:"ç¡çœ è¨˜éŒ²",date:d,existingValues:[{label:"ç¡çœ æ™‚é–“",value:`${(null==y?void 0:y.sleep_hours)||0}æ™‚é–“`},{label:"ç¡çœ ã®è³ª",value:`${(null==y?void 0:y.sleep_quality)||0}/5`}],newValues:[{label:"ç¡çœ æ™‚é–“",value:`${(null==j?void 0:j.sleep_hours)||0}æ™‚é–“`},{label:"ç¡çœ ã®è³ª",value:`${(null==j?void 0:j.sleep_quality)||0}/5`}]}),R.jsxs("form",{onSubmit:async r=>{if(r.preventDefault(),h(""),w||s)return;const a=(()=>{const e=parseFloat(l);return isNaN(e)||e<0||e>24?(h("ç¡çœ æ™‚é–“ã¯0ã€œ24æ™‚é–“ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),null):e})();if(null==a)return;const n={sleep_hours:a,date:d,sleep_quality:c,notes:m||void 0};N(!0);try{const r=await t(d);if(r)return f(r),v(n),void p(!0);await e(n),T(),E("success","è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(i){h("ç¡çœ è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error submitting sleep record:",i),E("error",`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==i?void 0:i.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{N(!1)}},className:"space-y-4",children:[g&&R.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:g}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"æ—¥ä»˜"}),R.jsx("input",{type:"date",value:d,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:$})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ç¡çœ æ™‚é–“ï¼ˆæ™‚é–“ï¼‰"}),n&&R.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["å‰å›ï¼ˆ",n.date,"ï¼‰ï¼š",n.sleep_hours,"æ™‚é–“"]}),R.jsx("input",{type:"number",step:"0.5",min:"0",max:"24",value:l,onChange:e=>i(e.target.value),placeholder:"ä¾‹: 7.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:$}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"æ¨å¥¨: 7-9æ™‚é–“"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ç¡çœ ã®è³ª"}),n&&R.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["å‰å›ã®è³ªï¼š",n.sleep_quality??"-"," / 5"]}),R.jsx("div",{className:"flex items-center justify-center space-x-2",children:[1,2,3,4,5].map(e=>R.jsx("button",{type:"button",onClick:()=>x(e),className:"transition-colors "+(e<=c?"text-yellow-400 hover:text-yellow-500":"text-gray-300 dark:text-gray-600 hover:text-gray-400"),children:R.jsx(Pt,{className:"w-6 h-6 "+(e<=c?"fill-current":"")})},e))}),R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:[5===c&&"æœ€é«˜ã®ç¡çœ ",4===c&&"è‰¯ã„ç¡çœ ",3===c&&"æ™®é€š",2===c&&"ã‚„ã‚„ä¸è¶³",1===c&&"ç¡çœ ä¸è¶³"]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),R.jsx("textarea",{value:m,onChange:e=>u(e.target.value),placeholder:"å¤œä¸­ã«ç›®ãŒè¦šã‚ãŸã€å¯ã¤ããŒæ‚ªã‹ã£ãŸ ãªã©...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none",disabled:$})]}),R.jsx("button",{type:"submit",disabled:$,className:"w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center "+($?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"),children:$?R.jsxs("span",{className:"inline-flex items-center gap-2",children:[R.jsx(ct,{className:"w-5 h-5 animate-spin"}),"ä¿å­˜ä¸­â€¦"]}):R.jsxs(R.Fragment,{children:[R.jsx(pt,{className:"w-5 h-5 mr-2"}),"ç¡çœ ã‚’è¨˜éŒ²ã™ã‚‹"]})})]})]})}function na({isOpen:e,onClose:t,onOverwrite:r,onCancel:a,existingRecord:s,newValue:n}){return e?R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[R.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center",children:R.jsx(fe,{className:"w-5 h-5 text-yellow-600"})}),R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãã®æ—¥ä»˜ã®è¨˜éŒ²ãŒæ—¢ã«ã‚ã‚Šã¾ã™"})]}),R.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"é–‰ã˜ã‚‹",children:R.jsx(sr,{className:"w-5 h-5"})})]}),R.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"ã“ã®æ—¥ä»˜ã«ã¯æ—¢ã«è¨˜éŒ²ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ"}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 space-y-3",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"æ—¥ä»˜"}),R.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:new Date(s.date).toLocaleDateString("ja-JP")})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"ç¾åœ¨"}),R.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["æ„æ¬² ",s.motivation_level," /10"]}),R.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["ä½“åŠ› ",s.energy_level," /10"]}),R.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["ã‚¹ãƒˆãƒ¬ã‚¹ ",s.stress_level," /10"]})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300 mb-1",children:"æ–°è¦"}),R.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-semibold",children:["æ„æ¬² ",n.motivation_level," /10"]}),R.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 font-semibold",children:["ä½“åŠ› ",n.energy_level," /10"]}),R.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 font-semibold",children:["ã‚¹ãƒˆãƒ¬ã‚¹ ",n.stress_level," /10"]})]})]})]}),R.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3",children:R.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"ä¸Šæ›¸ãã™ã‚‹ã¨ã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯æ›´æ–°ã•ã‚Œã¾ã™ã€‚"})})]}),R.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30",children:[R.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"ä¸Šæ›¸ãã™ã‚‹"})]})]})}):null}function la({onSubmit:e,onCheckExisting:t,onUpdate:a,loading:s=!1,lastRecord:n}){const[l,i]=r.useState(5),[d,o]=r.useState(5),[c,x]=r.useState(5),[m,u]=r.useState(H()),[g,h]=r.useState(""),[b,p]=r.useState(""),[y,f]=r.useState(!1),[j,v]=r.useState(!1),[w,N]=r.useState(!1),[k,_]=r.useState("success"),[C,S]=r.useState(""),D=(e,t)=>{_(e),S(t),N(!0)},[M,E]=r.useState(!1),[T,A]=r.useState(null),[$,z]=r.useState(null);r.useEffect(()=>{n&&!y&&(i(n.motivation_level),o(n.energy_level),x(n.stress_level),f(!0))},[n,y]);const q=()=>{i(5),o(5),x(5),u(H()),h(""),f(!1)},F=s||j,I=(e,t,r,a,s,l,i,d,o)=>{const c=11.11*(e-1),x=o??"#3b82f6",m="#9ca3af";return R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a,r]}),void 0!==d&&R.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-1",children:["å‰å›: ",R.jsx("span",{className:"font-semibold",children:d})," / 10",(null==n?void 0:n.date)&&R.jsxs("span",{className:"ml-1",children:["ï¼ˆ",n.date,"ï¼‰"]})]}),R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-12",children:s}),R.jsx("input",{type:"range",min:"1",max:"10",value:e,onChange:e=>t(parseInt(e.target.value)),disabled:F,className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-60 disabled:cursor-not-allowed",style:{background:`linear-gradient(to right, ${x} 0%, ${x} ${c}%, ${m} ${c}%, ${m} 100%)`}}),R.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 w-12 text-right",children:l})]}),R.jsxs("div",{className:"text-center mt-2",children:[R.jsx("span",{className:`text-2xl font-bold ${i}`,children:e}),R.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" / 10"})]})]})};return R.jsxs(R.Fragment,{children:[R.jsx(yr,{open:w,type:k,message:C,onClose:()=>N(!1)}),R.jsxs("form",{onSubmit:async r=>{if(r.preventDefault(),p(""),F)return;const a={motivation_level:l,energy_level:d,stress_level:c,date:m,notes:g||void 0};v(!0);try{if(t){const e=await t(m);if(e)return A(e),z(a),void E(!0)}await e(a),q(),D("success","è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(s){p("ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error submitting motivation record:",s),D("error",`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==s?void 0:s.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{v(!1)}},className:"space-y-6",children:[b&&R.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:b}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"æ—¥ä»˜"}),R.jsx("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,disabled:F})]}),I(l,i,"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³",R.jsx(at,{className:"w-4 h-4 inline mr-2 text-blue-500"}),"ä½ã„","é«˜ã„","text-blue-500",null==n?void 0:n.motivation_level,"#3b82f6"),I(d,o,"ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¬ãƒ™ãƒ«",R.jsx(nr,{className:"w-4 h-4 inline mr-2 text-green-500"}),"ç–²åŠ´","å……å®Ÿ","text-green-500",null==n?void 0:n.energy_level,"#10b981"),I(c,x,"ã‚¹ãƒˆãƒ¬ã‚¹ãƒ¬ãƒ™ãƒ«",R.jsx(ye,{className:"w-4 h-4 inline mr-2 text-red-500"}),"ãƒªãƒ©ãƒƒã‚¯ã‚¹","é«˜ã‚¹ãƒˆãƒ¬ã‚¹","text-red-500",null==n?void 0:n.stress_level,"#ef4444"),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),R.jsx("textarea",{value:g,onChange:e=>h(e.target.value),placeholder:"ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚„æ°—æŒã¡ã‚’è¨˜éŒ²...",rows:3,disabled:F,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60"})]}),R.jsx("button",{type:"submit",disabled:F,className:"w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center "+(F?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:F?R.jsxs("span",{className:"inline-flex items-center gap-2",children:[R.jsx(ct,{className:"w-5 h-5 animate-spin"}),"ä¿å­˜ä¸­â€¦"]}):R.jsxs(R.Fragment,{children:[R.jsx(at,{className:"w-5 h-5 mr-2"}),"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜éŒ²ã™ã‚‹"]})})]}),T&&$&&R.jsx(na,{isOpen:M,onClose:()=>{E(!1),A(null),z(null)},onCancel:()=>{E(!1),A(null),z(null)},onOverwrite:async()=>{if(T&&$&&!F){p(""),E(!1),v(!0);try{a?await a(T.id,{motivation_level:$.motivation_level,energy_level:$.energy_level,stress_level:$.stress_level,notes:$.notes}):await e($),A(null),z(null),q(),D("success","ä¸Šæ›¸ãã—ã¦è¨˜éŒ²ã—ã¾ã—ãŸ âœ…")}catch(t){p("ä¸Šæ›¸ãã«å¤±æ•—ã—ã¾ã—ãŸ"),console.error("Error overwriting motivation record:",t),D("error",`ä¸Šæ›¸ãã«å¤±æ•—ã—ã¾ã—ãŸï¼š${(null==t?void 0:t.message)??"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}finally{v(!1)}}},existingRecord:T,newValue:{motivation_level:$.motivation_level,energy_level:$.energy_level,stress_level:$.stress_level,notes:$.notes}})]})}function ia({data:e}){const t=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},a=r.useMemo(()=>e.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).slice(-30).map(e=>({date:e.date,sleepHours:Number(e.sleep_hours),sleepQuality:e.sleep_quality,displayDate:t(e.date)})),[e]);if(0===e.length)return R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:R.jsxs("div",{className:"text-center px-4",children:[R.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-sm",children:"ç¡çœ è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†"})]})});const m=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return R.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[R.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:e.displayDate}),R.jsxs("div",{className:"space-y-1 text-sm",children:[R.jsxs("p",{className:"flex items-center",children:[R.jsx("span",{className:"w-3 h-3 bg-indigo-500 rounded-full mr-2"}),"ç¡çœ æ™‚é–“: ",R.jsxs("span",{className:"font-semibold ml-1",children:[e.sleepHours,"æ™‚é–“"]})]}),e.sleepQuality&&R.jsxs("p",{className:"flex items-center",children:[R.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),"ç¡çœ ã®è³ª: ",R.jsxs("span",{className:"font-semibold ml-1",children:[e.sleepQuality,"/5"]})]})]})]})}return null};return R.jsx("div",{className:"w-full h-64 sm:h-96",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:a,margin:{top:5,right:20,left:0,bottom:5},children:[R.jsx(l,{strokeDasharray:"3 3",className:"stroke-gray-300 dark:stroke-gray-700"}),R.jsx(i,{dataKey:"displayDate",tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),R.jsx(d,{label:{value:"æ™‚é–“",angle:-90,position:"insideLeft"},tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400",domain:[0,12]}),R.jsx(o,{content:R.jsx(m,{})}),R.jsx(u,{}),R.jsx(c,{y:7,stroke:"#10b981",strokeDasharray:"3 3",label:{value:"æ¨å¥¨æœ€ä½",position:"right",fill:"#10b981"}}),R.jsx(c,{y:9,stroke:"#3b82f6",strokeDasharray:"3 3",label:{value:"ç†æƒ³",position:"right",fill:"#3b82f6"}}),R.jsx(x,{type:"monotone",dataKey:"sleepHours",stroke:"#6366f1",strokeWidth:2,dot:{fill:"#6366f1",r:4},activeDot:{r:6},name:"ç¡çœ æ™‚é–“"})]})})})}function da({data:e}){const t=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},a=r.useMemo(()=>e.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).slice(-30).map(e=>({date:e.date,motivation:e.motivation_level,energy:e.energy_level,stress:e.stress_level,displayDate:t(e.date)})),[e]);if(0===e.length)return R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:R.jsxs("div",{className:"text-center px-4",children:[R.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-sm",children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†"})]})});const m=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return R.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[R.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:e.displayDate}),R.jsxs("div",{className:"space-y-1 text-sm",children:[R.jsxs("p",{className:"flex items-center",children:[R.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³: ",R.jsxs("span",{className:"font-semibold ml-1",children:[e.motivation,"/10"]})]}),R.jsxs("p",{className:"flex items-center",children:[R.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),"ã‚¨ãƒãƒ«ã‚®ãƒ¼: ",R.jsxs("span",{className:"font-semibold ml-1",children:[e.energy,"/10"]})]}),R.jsxs("p",{className:"flex items-center",children:[R.jsx("span",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),"ã‚¹ãƒˆãƒ¬ã‚¹: ",R.jsxs("span",{className:"font-semibold ml-1",children:[e.stress,"/10"]})]})]})]})}return null};return R.jsx("div",{className:"w-full h-64 sm:h-96",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:a,margin:{top:5,right:20,left:0,bottom:5},children:[R.jsx(l,{strokeDasharray:"3 3",className:"stroke-gray-300 dark:stroke-gray-700"}),R.jsx(i,{dataKey:"displayDate",tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),R.jsx(d,{domain:[0,10],tick:{fill:"currentColor"},className:"text-gray-600 dark:text-gray-400"}),R.jsx(o,{content:R.jsx(m,{})}),R.jsx(u,{}),R.jsx(c,{y:5,stroke:"#94a3b8",strokeDasharray:"3 3",label:{value:"ä¸­é–“",position:"right",fill:"#94a3b8"}}),R.jsx(x,{type:"monotone",dataKey:"motivation",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³"}),R.jsx(x,{type:"monotone",dataKey:"energy",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",r:3},name:"ã‚¨ãƒãƒ«ã‚®ãƒ¼"}),R.jsx(x,{type:"monotone",dataKey:"stress",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:3},name:"ã‚¹ãƒˆãƒ¬ã‚¹"})]})})})}function oa({latestACWR:e,sleepHours:t,sleepQuality:r,motivationLevel:a,energyLevel:s,stressLevel:n}){const l=(()=>{let r=0,l=0;if(e&&(l++,"good"===e.riskLevel?r+=3:"caution"===e.riskLevel?r+=2:"low"===e.riskLevel?r+=2.5:r+=1),null!==t&&(l++,r+=t>=7&&t<=9?3:t>=6&&t<7?2:1),null!==a&&(l++,r+=a>=7?3:a>=5?2:1),null!==s&&(l++,r+=s>=7?3:s>=5?2:1),null!==n&&(l++,r+=n<=4?3:n<=6?2:1),0===l)return{level:"unknown",color:"gray",label:"ãƒ‡ãƒ¼ã‚¿ãªã—"};const i=r/l;return i>=2.5?{level:"excellent",color:"green",label:"æœ€é«˜",icon:Te}:i>=2?{level:"good",color:"blue",label:"è‰¯å¥½",icon:Vt}:i>=1.5?{level:"fair",color:"yellow",label:"æ³¨æ„",icon:fe}:{level:"poor",color:"red",label:"è­¦å‘Š",icon:Ht}})(),i=l.icon||fe,d=(()=>{const r=e&&("high"===e.riskLevel||"caution"===e.riskLevel),s=null!==t&&t<7;return r&&s?{text:"æ€ªæˆ‘ãƒªã‚¹ã‚¯æ¥µå¤§ï¼šç·´ç¿’è² è·ãŒé«˜ãã€ç¡çœ ä¸è¶³ã§ã™ã€‚ä¼‘æ¯ã‚’å„ªå…ˆã—ã¦ãã ã•ã„ã€‚",color:"text-red-700 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/20"}:null!==a&&a<5&&(null!==n&&n>7)?{text:"ãƒ¡ãƒ³ã‚¿ãƒ«æ³¨æ„ï¼šãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ä½ä¸‹ã¨ã‚¹ãƒˆãƒ¬ã‚¹éå¤šã§ã™ã€‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’æ¨å¥¨ã—ã¾ã™ã€‚",color:"text-orange-700 dark:text-orange-400",bg:"bg-orange-50 dark:bg-orange-900/20"}:s?{text:"ç¡çœ ä¸è¶³ï¼šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚ç¡çœ æ™‚é–“ã‚’ç¢ºä¿ã—ã¾ã—ã‚‡ã†ã€‚",color:"text-yellow-700 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"}:r?{text:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·æ³¨æ„ï¼šå›å¾©ã‚’å„ªå…ˆã—ã€è² è·ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚",color:"text-blue-700 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20"}:{text:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è‰¯å¥½ï¼šã“ã®ã¾ã¾è¨ˆç”»çš„ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚",color:"text-green-700 dark:text-green-400",bg:"bg-green-50 dark:bg-green-900/20"}})();return R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ä»Šæ—¥ã®ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),R.jsxs("div",{className:`flex items-center space-x-2 px-4 py-2 bg-${l.color}-100 dark:bg-${l.color}-900/20 rounded-full`,children:[R.jsx(i,{className:`w-5 h-5 text-${l.color}-600 dark:text-${l.color}-400`}),R.jsx("span",{className:`font-semibold text-${l.color}-700 dark:text-${l.color}-400`,children:l.label})]})]}),R.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6",children:[e&&R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[R.jsxs("div",{className:"flex items-center mb-2",children:[R.jsx(pe,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),R.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ACWR"})]}),R.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.acwr})]}),null!==t&&R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[R.jsxs("div",{className:"flex items-center mb-2",children:[R.jsx(pt,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),R.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ç¡çœ "})]}),R.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t.toFixed(1),"h"]})]}),null!==a&&R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors",children:[R.jsxs("div",{className:"flex items-center mb-2",children:[R.jsx(at,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2"}),R.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"æ„æ¬²"})]}),R.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a,"/10"]})]})]}),R.jsx("div",{className:`${d.bg} border border-${l.color}-200 dark:border-${l.color}-800 rounded-lg p-4`,children:R.jsx("p",{className:`text-sm ${d.color}`,children:d.text})})]})}const ca=[{value:"cramps",label:"ç”Ÿç†ç—›",icon:nr},{value:"mood_changes",label:"æ°—åˆ†ã®å¤‰åŒ–",icon:We},{value:"fatigue",label:"ç–²åŠ´æ„Ÿ",icon:_e},{value:"headache",label:"é ­ç—›",icon:Se},{value:"bloating",label:"è†¨æº€æ„Ÿ",icon:ar},{value:"breast_tenderness",label:"èƒ¸ã®å¼µã‚Š",icon:at},{value:"acne",label:"ãƒ‹ã‚­ãƒ“",icon:It},{value:"back_pain",label:"è…°ç—›",icon:Ot}];function xa({selectedDate:e,periodStart:t,setPeriodStart:a,flowIntensity:s,setFlowIntensity:n,symptoms:l,setSymptoms:i,cycleNotes:d,setCycleNotes:o,periodDuration:c,setPeriodDuration:x,cycleLength:m,setCycleLength:u,error:g}){const[h,b]=r.useState(""),p=r.useMemo(()=>{if(!e||!h)return null;const t=new Date(e),r=new Date(h),a=Math.floor((r.getTime()-t.getTime())/864e5)+1;return Number.isFinite(a)&&a>0?a:null},[e,h]);return R.jsxs("div",{className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[R.jsx(Ve,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),R.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"æœˆçµŒå‘¨æœŸã‚’è¨˜éŒ²"})]}),g&&R.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[R.jsx(ye,{className:"w-5 h-5"}),R.jsx("span",{children:g})]}),R.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-4",children:[R.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[R.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:"ä»Šæ—¥ãŒæœˆçµŒé–‹å§‹ï¼ˆå‡ºè¡€1æ—¥ç›®ï¼‰"}),R.jsx("input",{type:"checkbox",checked:t,onChange:e=>a(e.target.checked),className:"h-5 w-5 accent-pink-600"})]}),R.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"â€»é–‹å§‹æ—¥ã®ç™»éŒ²ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«å‘¨æœŸã‚’ä¿å­˜ã—ã¾ã™"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Me,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†é–‹å§‹æ—¥ï¼ˆä»Šæ—¥ã®å…¥åŠ›æ—¥ï¼‰"]}),R.jsx("div",{className:"w-full px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-100",children:e})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Me,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†çµ‚äº†æ—¥ï¼ˆä»»æ„ï¼‰"]}),R.jsx("input",{type:"date",value:h,min:e,onChange:t=>{const r=t.target.value;if(b(r),r){const t=new Date(e),a=new Date(r),s=Math.floor((a.getTime()-t.getTime())/864e5)+1;Number.isFinite(s)&&s>0&&x(s)}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"}),null!=p&&R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ç”Ÿç†æœŸé–“: ",p,"æ—¥é–“"]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"çµŒè¡€é‡"}),R.jsxs("select",{value:s,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white",children:[R.jsx("option",{value:"light",children:"å°‘ãªã„"}),R.jsx("option",{value:"moderate",children:"æ™®é€š"}),R.jsx("option",{value:"heavy",children:"å¤šã„"})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç—‡çŠ¶"}),R.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:ca.map(e=>{const t=e.icon,r=l.includes(e.value);return R.jsxs("button",{type:"button",onClick:()=>(e=>{i(l.includes(e)?l.filter(t=>t!==e):[...l,e])})(e.value),className:"px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 "+(r?"border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-105":"border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300 hover:scale-105"),children:[R.jsx(t,{className:"w-4 h-4"}),R.jsx("span",{children:e.label})]},e.value)})})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"æœˆçµŒæœŸé–“ï¼ˆæ—¥ï¼‰"}),R.jsx("input",{type:"number",min:1,max:14,value:c,onChange:e=>x(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"å‘¨æœŸï¼ˆæ—¥ï¼‰"}),R.jsx("input",{type:"number",min:20,max:45,value:m,onChange:e=>u(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white"})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢"}),R.jsx("textarea",{value:d,onChange:e=>o(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"ãã®ä»–ã®ãƒ¡ãƒ¢..."})]}),R.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€» ä¿å­˜ã¯ä¸‹ã®ã€Œæ¬¡ã¸/å®Œäº†ã€ãƒœã‚¿ãƒ³ã§è¡Œã„ã¾ã™"})]})}function ma({userId:e,userGender:t,enableCycle:a,onTrainingSubmit:s,onTrainingCheckExisting:n,onTrainingUpdate:l,onWeightSubmit:i,onWeightCheckExisting:d,onWeightUpdate:o,onSleepSubmit:c,onSleepCheckExisting:x,onSleepUpdate:m,onMotivationSubmit:u,onMotivationCheckExisting:g,onMotivationUpdate:h,onCycleSubmit:b,onCycleUpdate:p,onClose:y,lastTrainingRecord:f,lastWeightRecord:j,lastSleepRecord:v,lastMotivationRecord:w}){const N=H(),k=!0===(a??"female"===t),[_,C]=r.useState(N),[S,D]=r.useState("training"),[M,E]=r.useState((null==f?void 0:f.rpe)??5),[T,A]=r.useState((null==f?void 0:f.duration_min)??60),[$,z]=r.useState((null==f?void 0:f.arrow_score)??50),[q,F]=r.useState((null==f?void 0:f.signal_score)??50),[I,L]=r.useState(null!=(null==j?void 0:j.weight_kg)?String(j.weight_kg):""),[P,O]=r.useState(""),[W,B]=r.useState((null==v?void 0:v.sleep_hours)??7),[U,V]=r.useState((null==v?void 0:v.sleep_quality)??3),[K,J]=r.useState(""),[Y,Z]=r.useState((null==w?void 0:w.motivation_level)??7),[G,Q]=r.useState((null==w?void 0:w.energy_level)??7),[X,ee]=r.useState((null==w?void 0:w.stress_level)??5),[te,re]=r.useState(""),[ae,se]=r.useState(!1),[ne,le]=r.useState(5),[ie,de]=r.useState(28),[oe,ce]=r.useState("moderate"),[xe,me]=r.useState([]),[ue,ge]=r.useState(""),[he,be]=r.useState(new Set),[ye,fe]=r.useState(!1),[je,ve]=r.useState(""),[we,Ne]=r.useState(!1),[ke,_e]=r.useState(!1),[Ce,Se]=r.useState(null),[De,Ee]=r.useState(null),[Re,Ae]=r.useState(null),$e=()=>{_e(!1),Ee(null),Ae(null),Se(null)},ze=({values:e,highlight:t})=>R.jsx("div",{className:"mt-1 flex justify-between text-[10px] leading-none text-gray-500 dark:text-gray-400 select-none",children:e.map(e=>R.jsx("span",{className:e===t?"font-semibold text-gray-700 dark:text-gray-200":"",children:e},e))}),qe=(()=>{var e,t;if(!De||!Re)return{existing:[],pending:[]};switch(Ce){case"training":return{existing:[{label:"RPE",value:(null==(e=De.rpe)?void 0:e.toString())||"-"},{label:"æ™‚é–“",value:`${De.duration_min||0}åˆ†`},{label:"æˆé•·å®Ÿæ„Ÿ",value:null!=De.arrow_score?"å…¥åŠ›ã‚ã‚Š":"â€”"},{label:"æ„å›³ç†è§£",value:null!=De.signal_score?"å…¥åŠ›ã‚ã‚Š":"â€”"}],pending:[{label:"RPE",value:(null==(t=Re.rpe)?void 0:t.toString())||"-"},{label:"æ™‚é–“",value:`${Re.duration_min||0}åˆ†`},{label:"æˆé•·å®Ÿæ„Ÿ",value:"å…¥åŠ›ã‚ã‚Š"},{label:"æ„å›³ç†è§£",value:"å…¥åŠ›ã‚ã‚Š"}]};case"weight":return{existing:[{label:"ä½“é‡",value:`${De.weight_kg||0} kg`}],pending:[{label:"ä½“é‡",value:`${Re.weight_kg||0} kg`}]};case"conditioning":{const e=De;return{existing:[{label:"ç¡çœ æ™‚é–“",value:e.sleep?`${e.sleep.sleep_hours??0}æ™‚é–“`:"â€”"},{label:"ç¡çœ ã®è³ª",value:e.sleep?`${e.sleep.sleep_quality??0}/5`:"â€”"},{label:"ãƒ¢ãƒãƒ™",value:e.motivation?`${e.motivation.motivation_level??0}/10`:"â€”"},{label:"ã‚¨ãƒãƒ«ã‚®ãƒ¼",value:e.motivation?`${e.motivation.energy_level??0}/10`:"â€”"},{label:"ã‚¹ãƒˆãƒ¬ã‚¹",value:e.motivation?`${e.motivation.stress_level??0}/10`:"â€”"}],pending:[{label:"ç¡çœ æ™‚é–“",value:`${Re.sleep.sleep_hours??0}æ™‚é–“`},{label:"ç¡çœ ã®è³ª",value:`${Re.sleep.sleep_quality??0}/5`},{label:"ãƒ¢ãƒãƒ™",value:`${Re.motivation.motivation_level??0}/10`},{label:"ã‚¨ãƒãƒ«ã‚®ãƒ¼",value:`${Re.motivation.energy_level??0}/10`},{label:"ã‚¹ãƒˆãƒ¬ã‚¹",value:`${Re.motivation.stress_level??0}/10`}]}}default:return{existing:[],pending:[]}}})();return R.jsxs(R.Fragment,{children:[R.jsx(ur,{isOpen:ke,onClose:$e,onOverwrite:async()=>{if(De&&Re&&Ce){_e(!1),fe(!0);try{if("training"===Ce)await l(De.id,{rpe:Re.rpe,duration_min:Re.duration_min,arrow_score:Re.arrow_score,signal_score:Re.signal_score}),be(e=>new Set(e).add("training")),D("weight");else if("weight"===Ce)await o(De.id,{weight_kg:Re.weight_kg,notes:Re.notes}),be(e=>new Set(e).add("weight")),D("conditioning");else if("conditioning"===Ce){const e=De,t=Re;e.sleep?await m(e.sleep.id,t.sleep):await c(t.sleep),e.motivation?await h(e.motivation.id,t.motivation):await u(t.motivation),be(e=>new Set(e).add("conditioning")),k?D("cycle"):setTimeout(()=>y(),500)}Ee(null),Ae(null),Se(null)}catch(e){ve("è¨˜éŒ²ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{fe(!1)}}},onCancel:$e,title:(()=>{switch(Ce){case"training":return"ç·´ç¿’è¨˜éŒ²";case"weight":return"ä½“é‡è¨˜éŒ²";case"conditioning":return"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³";default:return""}})(),date:_,existingValues:qe.existing,newValues:qe.pending}),R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] "+(we?"overflow-hidden":"overflow-y-auto"),children:[R.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 z-10",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ä»Šæ—¥ã®è¨˜éŒ²"}),R.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",type:"button",children:R.jsx(sr,{className:"w-6 h-6"})})]}),R.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[R.jsx(Me,{className:"w-4 h-4"}),R.jsx("input",{type:"date",value:_,onChange:e=>C(e.target.value),className:"bg-transparent border-none text-gray-900 dark:text-white font-medium focus:outline-none"})]}),R.jsx("div",{className:"flex space-x-2",children:(k?["training","weight","conditioning","cycle"]:["training","weight","conditioning"]).map(e=>{const t=(e=>{switch(e){case"training":default:return pe;case"weight":return Et;case"conditioning":return at;case"cycle":return Me}})(e),r=S===e,a=he.has(e);return R.jsxs("button",{onClick:()=>D(e),className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all flex items-center justify-center space-x-2 "+(r?"bg-blue-600 text-white shadow-lg":a?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),type:"button",children:[a?R.jsx(Te,{className:"w-4 h-4"}):R.jsx(t,{className:"w-4 h-4"}),R.jsx("span",{className:"hidden sm:inline",children:"training"===e?"ç·´ç¿’":"weight"===e?"ä½“é‡":"cycle"===e?"å‘¨æœŸ":"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"})]},e)})})]}),R.jsxs("div",{className:"p-6",children:["training"===S&&R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[R.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-lg",children:R.jsx(pe,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ç·´ç¿’è¨˜éŒ²"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"RPEã¨ç·´ç¿’æ™‚é–“ã‚’è¨˜éŒ²"})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"RPE (ä¸»è¦³çš„é‹å‹•å¼·åº¦)"}),R.jsx("input",{type:"range",min:"0",max:"10",value:M,onChange:e=>E(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600"}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:["0 - ã¾ã£ãŸãæ¥½ã§ã‚ã‚‹","1 - éå¸¸ã«æ¥½ã§ã‚ã‚‹","2 - æ¥½ã§ã‚ã‚‹","3 - å°‘ã—ãã¤ã„","4 - ã‚„ã‚„ãã¤ã„","5 - ãã¤ã„","6 - ã‹ãªã‚Šãã¤ã„","7 - éå¸¸ã«ãã¤ã„","8 - æ¥µåº¦ã«ãã¤ã„","9 - é™ç•Œã«è¿‘ã„","10 - é™ç•Œ"][M]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ç·´ç¿’æ™‚é–“ï¼š",T,"åˆ†",R.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["ï¼ˆ",Math.floor(T/60),"æ™‚é–“",T%60,"åˆ†ï¼‰"]})]}),R.jsx("div",{className:"py-3 -my-3",children:R.jsx("input",{type:"range",min:"0",max:"480",step:"5",value:T,onChange:e=>A(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600"})}),R.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[R.jsx("span",{children:"0åˆ†"}),R.jsx("span",{children:"4æ™‚é–“"}),R.jsx("span",{children:"8æ™‚é–“"})]})]}),R.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:R.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-200",children:[R.jsx("strong",{children:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·:"})," ",M*T]})}),R.jsx(hr,{value:$,onChange:z}),R.jsx(pr,{value:q,onChange:F})]}),"weight"===S&&R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[R.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg",children:R.jsx(Et,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ä½“é‡è¨˜éŒ²"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ä½“é‡ã‚’è¨˜éŒ²"})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ä½“é‡ (kg)"}),R.jsx("input",{type:"number",step:"0.1",value:I,onChange:e=>L(e.target.value),placeholder:"ä¾‹: 65.5",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white text-lg"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ (ä»»æ„)"}),R.jsx("textarea",{value:P,onChange:e=>O(e.target.value),placeholder:"æ¸¬å®šæ™‚ã®çŠ¶æ³ãªã©",rows:2,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"})]}),j&&R.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:R.jsxs("p",{className:"text-sm text-green-900 dark:text-green-200",children:[R.jsx("strong",{children:"å‰å›ã®è¨˜éŒ²:"})," ",Number(j.weight_kg).toFixed(1)," kg"]})})]}),"conditioning"===S&&R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[R.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg",children:R.jsx(at,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç¡çœ ã¨ãƒ¡ãƒ³ã‚¿ãƒ«çŠ¶æ…‹ã‚’è¨˜éŒ²"})]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(pt,{className:"w-4 h-4 inline mr-1"}),"ç¡çœ æ™‚é–“ï¼š",R.jsxs("span",{className:"font-semibold",children:[W,"æ™‚é–“"]}),R.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["ï¼ˆ",Math.floor(W),"æ™‚é–“",Math.round(W%1*60),"åˆ†ï¼‰"]})]}),v&&R.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-2",children:["å‰å›ï¼ˆ",v.date,"ï¼‰ï¼š",v.sleep_hours,"æ™‚é–“",null!=(null==v?void 0:v.sleep_quality)?` / è³ª ${v.sleep_quality}/5`:""]}),R.jsx("div",{className:"py-3 -my-3",children:R.jsx("input",{type:"range",min:"0",max:"12",step:"0.25",value:W,onChange:e=>B(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),R.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[R.jsx("span",{children:"0h"}),R.jsx("span",{children:"6h"}),R.jsx("span",{children:"12h"})]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ç¡çœ ã®è³ªï¼š",R.jsx("span",{className:"font-semibold",children:U}),"/5"]}),v&&R.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",v.date,"ï¼‰ï¼š",(null==v?void 0:v.sleep_quality)??"â€”","/5"]}),R.jsx("div",{className:"py-3 -my-3",children:R.jsx("input",{type:"range",min:"1",max:"5",step:"1",value:U,onChange:e=>V(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),R.jsx(ze,{values:[1,2,3,4,5],highlight:U}),R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[5===U&&"æœ€é«˜ã®ç¡çœ ",4===U&&"è‰¯ã„ç¡çœ ",3===U&&"æ™®é€š",2===U&&"ã‚„ã‚„ä¸è¶³",1===U&&"ç¡çœ ä¸è¶³"]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(nr,{className:"w-4 h-4 inline mr-1"}),"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ï¼š",R.jsx("span",{className:"font-semibold",children:Y}),"/10"]}),w&&R.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",w.date,"ï¼‰ï¼š",w.motivation_level,"/10"]}),R.jsx("div",{className:"py-3 -my-3",children:R.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:Y,onChange:e=>Z(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),R.jsx(ze,{values:[1,2,3,4,5,6,7,8,9,10],highlight:Y})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼š",R.jsx("span",{className:"font-semibold",children:G}),"/10"]}),w&&R.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",w.date,"ï¼‰ï¼š",w.energy_level,"/10"]}),R.jsx("div",{className:"py-3 -my-3",children:R.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:G,onChange:e=>Q(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),R.jsx(ze,{values:[1,2,3,4,5,6,7,8,9,10],highlight:G})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ã‚¹ãƒˆãƒ¬ã‚¹ï¼š",R.jsx("span",{className:"font-semibold",children:X}),"/10"]}),w&&R.jsxs("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2",children:["å‰å›ï¼ˆ",w.date,"ï¼‰ï¼š",w.stress_level,"/10"]}),R.jsx("div",{className:"py-3 -my-3",children:R.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:X,onChange:e=>ee(Number(e.target.value)),onPointerDown:()=>Ne(!0),onPointerUp:()=>Ne(!1),onPointerCancel:()=>Ne(!1),className:"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),R.jsx(ze,{values:[1,2,3,4,5,6,7,8,9,10],highlight:X})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ (ä»»æ„)"}),R.jsx("textarea",{value:te,onChange:e=>re(e.target.value),placeholder:"ä½“èª¿ã®è©³ç´°ãªã©",rows:2,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"})]})]}),je&&"cycle"!==S&&R.jsx("div",{className:"mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:R.jsx("p",{className:"text-sm text-red-700 dark:text-red-400",children:je})}),"cycle"===S&&k&&R.jsx(xa,{selectedDate:_,periodStart:ae,setPeriodStart:se,flowIntensity:oe,setFlowIntensity:ce,symptoms:xe,setSymptoms:me,cycleNotes:ue,setCycleNotes:ge,periodDuration:ne,setPeriodDuration:le,cycleLength:ie,setCycleLength:de,error:je||null}),R.jsx("div",{className:"mt-6",children:R.jsx("button",{type:"button",onClick:()=>{(async e=>{fe(!0),ve("");try{if("training"===e){const e=await n(_);return e?(Se("training"),Ee(e),Ae({rpe:M,duration_min:T,date:_,arrow_score:$,signal_score:q}),_e(!0),void fe(!1)):(await s({rpe:M,duration_min:T,date:_,arrow_score:$??50,signal_score:q??50}),be(e=>new Set(e).add("training")),void D("weight"))}if("weight"===e){if(I){const e=await d(_);if(e)return Se("weight"),Ee(e),Ae({weight_kg:Number(I),date:_,notes:P||void 0}),_e(!0),void fe(!1);await i({weight_kg:Number(I),date:_,notes:P||void 0}),be(e=>new Set(e).add("weight"))}return void D("conditioning")}if("conditioning"===e){const[e,t]=await Promise.all([x(_),g(_)]);return e||t?(Se("conditioning"),Ee({sleep:e,motivation:t}),Ae({sleep:{sleep_hours:W,sleep_quality:U,date:_,notes:K||void 0},motivation:{motivation_level:Y,energy_level:G,stress_level:X,date:_,notes:te||void 0}}),_e(!0),void fe(!1)):(await c({sleep_hours:W,sleep_quality:U,date:_,notes:K||void 0}),await u({motivation_level:Y,energy_level:G,stress_level:X,date:_,notes:te||void 0}),be(e=>new Set(e).add("conditioning")),void(k?D("cycle"):setTimeout(()=>y(),500)))}if("cycle"===e){if(ae){if(!b)throw new Error("onCycleSubmit ãŒæœªè¨­å®šã§ã™");await b({cycle_start_date:_,period_duration_days:ne,cycle_length_days:ie,flow_intensity:oe,symptoms:xe.length>0?xe:void 0,notes:ue||void 0})}return be(e=>new Set(e).add("cycle")),void setTimeout(()=>y(),500)}}catch(t){const r=t instanceof Error?t.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";ve(`${"training"===e?"ç·´ç¿’":"weight"===e?"ä½“é‡":"cycle"===e?"å‘¨æœŸ":"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r}`)}finally{fe(!1)}})(S)},disabled:ye,className:"w-full py-3 rounded-xl font-semibold transition-colors "+(ye?"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:ye?"ä¿å­˜ä¸­...":(k?"cycle"===S:"conditioning"===S)?"å®Œäº†":"æ¬¡ã¸"})}),R.jsx("div",{className:"mt-4 flex justify-center",children:R.jsx("button",{onClick:y,className:"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",type:"button",children:"å¾Œã§è¨˜éŒ²ã™ã‚‹"})})]})]})})]})}function ua({acwrData:e,weightRecords:t,sleepRecords:a,motivationRecords:s,trainingRecords:n,menstrualCycles:l=[],userGender:i,onOpenDetailView:d,onQuickAdd:o}){const c=r.useMemo(()=>{if(!e||0===e.length)return null;const t=e.filter(e=>null==e?void 0:e.date);return 0===t.length?e[e.length-1]??null:t.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t)},[e]),x=r.useMemo(()=>t&&0!==t.length?t.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[t]),u=r.useMemo(()=>a&&0!==a.length?a.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[a]),g=r.useMemo(()=>s&&0!==s.length?s.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[s]),h=r.useMemo(()=>n&&0!==n.length?n.reduce((e,t)=>new Date(e.date).getTime()>=new Date(t.date).getTime()?e:t):null,[n]),b=()=>{if(t.length<2)return null;const e=Number(t[0].weight_kg)-Number(t[1].weight_kg);return{value:e,isUp:e>0}},p=(()=>{let e=0,r=0;if(c&&(r++,"good"===c.riskLevel?e+=25:"caution"===c.riskLevel?e+=15:"low"===c.riskLevel?e+=20:e+=10),u){r++;const t=Number(u.sleep_hours),a=u.sleep_quality;e+=t>=7&&t<=9&&a>=7?25:t>=6&&a>=5?15:5}if(g){r++;const t=(g.motivation_level+g.energy_level+(10-g.stress_level))/3;e+=t>=7?25:t>=5?15:5}if(x&&t.length>=2){r++;const t=b();t&&Math.abs(t.value)<.5?e+=25:t&&Math.abs(t.value)<1?e+=15:e+=10}return 0===r?0:Math.round(e/r*4)})(),y=b(),f=(()=>{if(0===a.length)return null;const e=a.slice(0,7);return e.reduce((e,t)=>e+Number(t.sleep_hours),0)/e.length})(),j=e=>{switch(e){case"menstrual":return"text-red-600 dark:text-red-400";case"follicular":return"text-green-600 dark:text-green-400";case"ovulatory":return"text-yellow-600 dark:text-yellow-400";case"luteal":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}},v=e=>{switch(e){case"menstrual":return"bg-red-100 dark:bg-red-900/30";case"follicular":return"bg-green-100 dark:bg-green-900/30";case"ovulatory":return"bg-yellow-100 dark:bg-yellow-900/30";case"luteal":return"bg-blue-100 dark:bg-blue-900/30";default:return"bg-gray-100 dark:bg-gray-700"}},w=(()=>{if(!l||0===l.length)return null;const e=new Date;e.setHours(0,0,0,0);for(const t of l){const r=new Date(t.cycle_start_date);r.setHours(0,0,0,0);const a=t.cycle_end_date?new Date(t.cycle_end_date):null;if(a&&a.setHours(0,0,0,0),e>=r&&(!a||e<=a)){const a=Math.floor((e.getTime()-r.getTime())/864e5);if(t.period_duration_days&&a<t.period_duration_days)return{phase:"menstrual",cycle:t,daysSinceStart:a};if(t.cycle_length_days){const e=Math.floor(t.cycle_length_days/2);if(a<e)return{phase:"follicular",cycle:t,daysSinceStart:a};if(a<e+2)return{phase:"ovulatory",cycle:t,daysSinceStart:a};if(a<t.cycle_length_days)return{phase:"luteal",cycle:t,daysSinceStart:a}}}}return null})(),N=(()=>{if(!l||0===l.length)return null;const e=[...l].sort((e,t)=>new Date(t.cycle_start_date).getTime()-new Date(e.cycle_start_date).getTime())[0];if(!e.cycle_length_days)return null;const t=new Date(e.cycle_start_date),r=new Date(t);return r.setDate(r.getDate()+e.cycle_length_days),r})(),k="female"===i,_=r.useMemo(()=>[...t??[]].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[t]),C=r.useMemo(()=>{const e=_[0];if(!(null==e?void 0:e.date)||null==e.weight_kg)return null;const t=new Date(e.date),r=new Date(t);r.setDate(r.getDate()-30);const a=_.find(e=>(null==e?void 0:e.date)&&new Date(e.date)<=r&&null!=e.weight_kg);return a?Number(e.weight_kg)-Number(a.weight_kg):null},[_]);return m.useEffect(()=>{},[i,k,null==l?void 0:l.length]),R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 rounded-2xl shadow-lg p-6 text-white",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-bold mb-1",children:"ç·åˆã‚¹ã‚³ã‚¢"}),R.jsx("p",{className:"text-blue-100 text-sm",children:"ã™ã¹ã¦ã®æŒ‡æ¨™ã‚’çµ±åˆã—ãŸå¥åº·çŠ¶æ…‹"})]}),R.jsxs("div",{className:"bg-white/20 rounded-full px-6 py-3",children:[R.jsx("div",{className:"text-4xl font-bold",children:p}),R.jsx("div",{className:"text-xs text-center text-blue-100",children:"/ 100"})]})]}),R.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4",children:[R.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[R.jsx(pe,{className:"w-5 h-5 mb-1"}),R.jsx("div",{className:"text-xs text-blue-100",children:"ACWR"}),R.jsx("div",{className:"text-lg font-bold",children:"number"==typeof(null==c?void 0:c.acwr)?c.acwr.toFixed(2):"-"})]}),R.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[R.jsx(Et,{className:"w-5 h-5 mb-1"}),R.jsx("div",{className:"text-xs text-blue-100",children:"ä½“é‡"}),R.jsx("div",{className:"text-lg font-bold",children:x?`${Number(x.weight_kg).toFixed(1)}kg`:"-"})]}),R.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[R.jsx(at,{className:"w-5 h-5 mb-1"}),R.jsx("div",{className:"text-xs text-blue-100",children:"ç¡çœ "}),R.jsx("div",{className:"text-lg font-bold",children:u?`${Number(u.sleep_hours).toFixed(1)}h`:"-"})]}),R.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[R.jsx(at,{className:"w-5 h-5 mb-1"}),R.jsx("div",{className:"text-xs text-blue-100",children:"æ„æ¬²"}),R.jsx("div",{className:"text-lg font-bold",children:g?`${g.motivation_level}/10`:"-"})]})]})]}),R.jsxs("div",{className:"grid grid-cols-1 gap-6 "+(k?"md:grid-cols-2 lg:grid-cols-4":"md:grid-cols-3"),children:[R.jsxs("div",{onClick:()=>d("training"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("div",{className:`p-3 rounded-lg ${c?(e=>{switch(e){case"good":return"bg-green-50 dark:bg-green-900/20";case"caution":return"bg-yellow-50 dark:bg-yellow-900/20";case"high":return"bg-red-50 dark:bg-red-900/20";default:return"bg-blue-50 dark:bg-blue-900/20"}})(c.riskLevel):"bg-gray-100 dark:bg-gray-700"}`,children:R.jsx(pe,{className:`w-6 h-6 ${c?(e=>{switch(e){case"good":return"text-green-600 dark:text-green-400";case"caution":return"text-yellow-600 dark:text-yellow-400";case"high":return"text-red-600 dark:text-red-400";default:return"text-blue-600 dark:text-blue-400"}})(c.riskLevel):"text-gray-400"}`})}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ç·´ç¿’è¨˜éŒ²"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Training Load"})]})]}),R.jsx(qe,{className:"w-5 h-5 text-gray-400"})]}),c?R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"mb-4",children:[R.jsxs("div",{className:"flex items-baseline space-x-2",children:[R.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-300",children:"number"==typeof(null==c?void 0:c.acwr)?c.acwr.toFixed(2):"ä¸æ˜"}),R.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ACWR"})]}),R.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:["high"===c.riskLevel&&R.jsx(fe,{className:"w-4 h-4 text-red-600"}),R.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["good"===c.riskLevel&&"ç†æƒ³çš„ãªè² è·","caution"===c.riskLevel&&"è² è·ãŒã‚„ã‚„é«˜ã‚","high"===c.riskLevel&&"æ€ªæˆ‘ãƒªã‚¹ã‚¯è­¦å‘Š","low"===c.riskLevel&&"è² è·ãŒã‚„ã‚„ä½ã‚"]})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"æ€¥æ€§è² è·"}),R.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:c.acuteLoad})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"æ…¢æ€§è² è·"}),R.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:c.chronicLoad})]})]}),h&&R.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:R.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[R.jsx("span",{children:"æœ€çµ‚è¨˜éŒ²"}),R.jsx("span",{children:new Date(h.date).toLocaleDateString("ja-JP")})]})})]}):R.jsxs("div",{className:"text-center py-8",children:[R.jsx(pe,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),R.jsxs("div",{onClick:()=>d("weight"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg",children:R.jsx(Et,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ä½“é‡ç®¡ç†"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Weight Tracking"})]})]}),R.jsx(qe,{className:"w-5 h-5 text-gray-400"})]}),x?R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"mb-4",children:[R.jsxs("div",{className:"flex items-baseline space-x-2",children:[R.jsx("span",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:Number(x.weight_kg).toFixed(1)}),R.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"kg"})]}),y&&R.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[y.isUp?R.jsx(Vt,{className:"w-4 h-4 text-red-500"}):R.jsx(Ht,{className:"w-4 h-4 text-blue-500"}),R.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["å‰å›æ¯” ",y.isUp?"+":"",y.value.toFixed(1),"kg"]})]})]}),R.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 mb-3",children:[R.jsx("p",{className:"text-xs text-green-700 dark:text-green-400 mb-1",children:"30æ—¥é–“ã®å¤‰åŒ–"}),R.jsx("p",{className:"text-lg font-bold text-green-800 dark:text-green-300",children:null!==C?`${C.toFixed(1)}kg`:"-"})]}),R.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:R.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[R.jsx("span",{children:"æœ€çµ‚è¨˜éŒ²"}),R.jsx("span",{children:new Date(x.date).toLocaleDateString("ja-JP")})]})})]}):R.jsxs("div",{className:"text-center py-8",children:[R.jsx(Et,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),R.jsxs("div",{onClick:()=>d("conditioning"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg",children:R.jsx(at,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sleep & Wellness"})]})]}),R.jsx(qe,{className:"w-5 h-5 text-gray-400"})]}),u&&g?R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"space-y-3 mb-4",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç¡çœ æ™‚é–“"}),R.jsxs("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[Number(u.sleep_hours).toFixed(1),"h"]})]}),R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç¡çœ ã®è³ª"}),R.jsxs("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:[u.sleep_quality,"/10"]})]})]}),R.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mb-3",children:R.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"æ„æ¬²"}),R.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:g.motivation_level})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"æ´»åŠ›"}),R.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:g.energy_level})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"ã‚¹ãƒˆãƒ¬ã‚¹"}),R.jsx("p",{className:"font-bold text-purple-900 dark:text-purple-300",children:g.stress_level})]})]})}),f&&R.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["é€±å¹³å‡ç¡çœ : ",f.toFixed(1),"æ™‚é–“"]}),R.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:R.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[R.jsx("span",{children:"æœ€çµ‚è¨˜éŒ²"}),R.jsx("span",{children:new Date(u.date).toLocaleDateString("ja-JP")})]})})]}):R.jsxs("div",{className:"text-center py-8",children:[R.jsx(at,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),k&&R.jsxs("div",{onClick:()=>d("cycle"),className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx("div",{className:`${w?v(w.phase):"bg-pink-100 dark:bg-pink-900/30"} p-3 rounded-lg`,children:R.jsx(Ve,{className:`w-6 h-6 ${w?j(w.phase):"text-pink-600 dark:text-pink-400"}`})}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"æœˆçµŒå‘¨æœŸ"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Menstrual Cycle"})]})]}),R.jsx(qe,{className:"w-5 h-5 text-gray-400"})]}),w?R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"mb-4",children:[R.jsx("div",{className:"flex items-baseline space-x-2",children:R.jsx("span",{className:`text-2xl font-bold ${j(w.phase)}`,children:(e=>{switch(e){case"menstrual":return"æœˆçµŒæœŸ";case"follicular":return"åµèƒæœŸ";case"ovulatory":return"æ’åµæœŸ";case"luteal":return"é»„ä½“æœŸ";default:return"ä¸æ˜"}})(w.phase)})}),R.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["å‘¨æœŸé–‹å§‹ã‹ã‚‰",w.daysSinceStart+1,"æ—¥ç›®"]})]}),R.jsxs("div",{className:`${v(w.phase)} rounded-lg p-3 mb-3`,children:[R.jsx("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ¨å¥¨"}),R.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:(e=>{switch(e){case"menstrual":return"ä½ï½ä¸­å¼·åº¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’æ¨å¥¨";case"follicular":return"é«˜å¼·åº¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«æœ€é©";case"ovulatory":return"ãƒ”ãƒ¼ã‚¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœŸ";case"luteal":return"å›å¾©é‡è¦–ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’";default:return""}})(w.phase)})]}),N&&R.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3",children:[R.jsx("p",{className:"text-xs text-pink-700 dark:text-pink-400 mb-1",children:"æ¬¡å›äºˆæ¸¬æ—¥"}),R.jsx("p",{className:"text-lg font-bold text-pink-800 dark:text-pink-300",children:N.toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}),R.jsxs("p",{className:"text-xs text-pink-600 dark:text-pink-400 mt-1",children:[Math.ceil((N.getTime()-(new Date).getTime())/864e5),"æ—¥å¾Œ"]})]})]}):R.jsxs("div",{className:"text-center py-8",children:[R.jsx(Ve,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"å‘¨æœŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"æœˆçµŒå‘¨æœŸã‚’è¨˜éŒ²ã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’æœ€é©åŒ–"})]})]})]}),R.jsxs("button",{onClick:o,className:"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl p-4 flex items-center justify-center space-x-2 font-medium transition-colors shadow-lg",children:[R.jsx(kt,{className:"w-5 h-5"}),R.jsx("span",{children:"ä»Šæ—¥ã®è¨˜éŒ²ã‚’è¿½åŠ "})]})]})}function ga({acwrData:e,weightRecords:t,sleepRecords:a,motivationRecords:c}){const[m,g]=r.useState({acwr:!0,weight:!0,sleep:!0,motivation:!0,energy:!1}),[h,b]=r.useState("30d"),p=e=>e>=(e=>{const t=(new Date).getTime()+324e5,r=new Date(t);return r.setUTCDate(r.getUTCDate()-e),Y(r)})("7d"===h?7:"30d"===h?30:90),y=(()=>{const r=new Map;return e.filter(e=>p(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).acwr=e.acwr,r.get(e.date).acuteLoad=e.acuteLoad}),t.filter(e=>p(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).weight=Number(e.weight_kg)}),a.filter(e=>p(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).sleep=Number(e.sleep_hours),r.get(e.date).sleepQuality=e.sleep_quality}),c.filter(e=>p(e.date)).forEach(e=>{r.has(e.date)||r.set(e.date,{date:e.date}),r.get(e.date).motivation=e.motivation_level,r.get(e.date).energy=e.energy_level,r.get(e.date).stress=e.stress_level}),Array.from(r.values()).sort((e,t)=>e.date.localeCompare(t.date))})(),f=e=>{g(t=>({...t,[e]:!t[e]}))},j=({active:e,payload:t,label:r})=>e&&t&&t.length?R.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4",children:[R.jsx("p",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:new Date(r).toLocaleDateString("ja-JP",{month:"short",day:"numeric"})}),R.jsx("div",{className:"space-y-1",children:t.map(e=>R.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[R.jsxs("span",{className:"text-sm",style:{color:e.color},children:[e.name,":"]}),R.jsxs("span",{className:"font-semibold text-sm",style:{color:e.color},children:[void 0!==e.value?e.value.toFixed(1):"-","weight"===e.dataKey&&"kg",("sleep"===e.dataKey||"sleepHours"===e.dataKey)&&"h"]})]},e.dataKey))})]}):null;return R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 space-y-4 sm:space-y-0",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:"çµ±åˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ã™ã¹ã¦ã®æŒ‡æ¨™ã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤º"})]}),R.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[R.jsx("button",{onClick:()=>b("7d"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("7d"===h?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:"7æ—¥"}),R.jsx("button",{onClick:()=>b("30d"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("30d"===h?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:"30æ—¥"}),R.jsx("button",{onClick:()=>b("90d"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("90d"===h?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:"90æ—¥"})]})]}),R.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[R.jsxs("button",{onClick:()=>f("acwr"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(m.acwr?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-2 border-blue-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[R.jsx(pe,{className:"w-4 h-4"}),R.jsx("span",{children:"ACWR"})]}),R.jsxs("button",{onClick:()=>f("weight"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(m.weight?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-2 border-green-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[R.jsx(Et,{className:"w-4 h-4"}),R.jsx("span",{children:"ä½“é‡"})]}),R.jsxs("button",{onClick:()=>f("sleep"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(m.sleep?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 border-2 border-purple-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[R.jsx(pt,{className:"w-4 h-4"}),R.jsx("span",{children:"ç¡çœ æ™‚é–“"})]}),R.jsxs("button",{onClick:()=>f("motivation"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(m.motivation?"bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-400 border-2 border-pink-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[R.jsx(at,{className:"w-4 h-4"}),R.jsx("span",{children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³"})]}),R.jsxs("button",{onClick:()=>f("energy"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(m.energy?"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 border-2 border-orange-500":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent"),children:[R.jsx(nr,{className:"w-4 h-4"}),R.jsx("span",{children:"ã‚¨ãƒãƒ«ã‚®ãƒ¼"})]})]}),0===y.length?R.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-500 dark:text-gray-400",children:[R.jsx(pe,{className:"w-16 h-16 mb-4 opacity-20"}),R.jsx("p",{children:"é¸æŠã—ãŸæœŸé–“ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]}):R.jsx(s,{width:"100%",height:400,children:R.jsxs(n,{data:y,children:[R.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),R.jsx(i,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},stroke:"#9CA3AF",style:{fontSize:"12px"}}),R.jsx(d,{stroke:"#9CA3AF",style:{fontSize:"12px"}}),R.jsx(o,{content:R.jsx(j,{})}),R.jsx(u,{wrapperStyle:{fontSize:"12px"},iconType:"line"}),m.acwr&&R.jsx(x,{type:"monotone",dataKey:"acwr",name:"ACWR",stroke:"#3B82F6",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),m.weight&&R.jsx(x,{type:"monotone",dataKey:"weight",name:"ä½“é‡ (kg)",stroke:"#10B981",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),m.sleep&&R.jsx(x,{type:"monotone",dataKey:"sleep",name:"ç¡çœ  (h)",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),m.motivation&&R.jsx(x,{type:"monotone",dataKey:"motivation",name:"æ„æ¬²",stroke:"#EC4899",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),m.energy&&R.jsx(x,{type:"monotone",dataKey:"energy",name:"æ´»åŠ›",stroke:"#F59E0B",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})}),R.jsxs("div",{className:"mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4",children:[R.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[R.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-400 mb-1",children:"è¨˜éŒ²æ•°"}),R.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-300",children:y.length}),R.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"æ—¥åˆ†"})]}),R.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[R.jsx("p",{className:"text-xs text-green-700 dark:text-green-400 mb-1",children:"å¹³å‡ACWR"}),R.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-300",children:y.filter(e=>e.acwr).length>0?(y.reduce((e,t)=>e+(t.acwr||0),0)/y.filter(e=>e.acwr).length).toFixed(2):"-"})]}),R.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[R.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-1",children:"å¹³å‡ç¡çœ "}),R.jsx("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-300",children:y.filter(e=>e.sleep).length>0?(y.reduce((e,t)=>e+(t.sleep||0),0)/y.filter(e=>e.sleep).length).toFixed(1):"-"}),R.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:"æ™‚é–“"})]}),R.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3",children:[R.jsx("p",{className:"text-xs text-pink-700 dark:text-pink-400 mb-1",children:"å¹³å‡æ„æ¬²"}),R.jsx("p",{className:"text-2xl font-bold text-pink-900 dark:text-pink-300",children:y.filter(e=>e.motivation).length>0?(y.reduce((e,t)=>e+(t.motivation||0),0)/y.filter(e=>e.motivation).length).toFixed(1):"-"}),R.jsx("p",{className:"text-xs text-pink-600 dark:text-pink-400",children:"/10"})]})]})]})}function ha({onClick:e,onCameraClick:t}){return R.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex items-center gap-3",children:[t&&R.jsx("button",{type:"button",onClick:t,className:"h-14 w-14 rounded-full shadow-lg\n                     bg-blue-600 text-white\n                     flex items-center justify-center\n                     active:scale-95 transition","aria-label":"é£Ÿäº‹ã‚’æ’®å½±ãƒ»é¸æŠ",children:R.jsx(Ee,{className:"w-6 h-6"})}),R.jsx("button",{type:"button",onClick:e,className:"h-14 w-14 rounded-full shadow-lg\n                   bg-blue-600 text-white\n                   flex items-center justify-center\n                   active:scale-95 transition","aria-label":"ä»Šæ—¥ã®è¨˜éŒ²ã‚’è¿½åŠ ",children:R.jsx(kt,{className:"w-7 h-7"})})]})}function ba(e,t){const r=new Date(e+"T00:00:00.000Z");return r.setUTCDate(r.getUTCDate()+t),r.toISOString().slice(0,10)}function pa(e){if(!e)return[];const t=e.next_action_items??[];return Array.isArray(t)&&t.length>0?t:e.next_action&&e.next_action.trim()?[{text:e.next_action.trim(),done:!1,done_at:null}]:[]}const ya=["æ „é¤Š","ç¡çœ ","ä½“èª¿","ç–²åŠ´","ç—›ã¿","ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·","è©¦åˆãƒ»é€£æˆ¦","ç§»å‹•","ç”¨å…·","ãƒ¡ãƒ³ã‚¿ãƒ«","é›†ä¸­","ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³","æ™‚é–“ç®¡ç†","å­¦æ¥­","äººé–“é–¢ä¿‚","ç’°å¢ƒ","ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³"];function fa({userId:e}){const t=r.useMemo(()=>new Date((new Date).getTime()+324e5).toISOString().slice(0,10),[]),a=r.useMemo(()=>function(){const e=new Date((new Date).getTime()+324e5);return e.setDate(e.getDate()-1),e.toISOString().slice(0,10)}(),[]),[s,n]=r.useState(0),l=r.useMemo(()=>function(e=0){const t=new Date((new Date).getTime()+324e5),r=(t.getDay()+6)%7;return t.setDate(t.getDate()-r+7*e),t.setHours(0,0,0,0),t.toISOString().slice(0,10)}(s),[s]),i=r.useMemo(()=>ba(l,6),[l]),[d,o]=r.useState(!0),[c,x]=r.useState(null),[m,u]=r.useState(null),[g,h]=r.useState([]),[b,p]=r.useState(!1),[y,f]=r.useState([]),[j,v]=r.useState([{text:"",done:!1,done_at:null}]),[w,N]=r.useState(""),[k,_]=r.useState(""),[C,S]=r.useState([]),[D,M]=r.useState(""),[E,T]=r.useState(!1),[A,$]=r.useState(!1);r.useEffect(()=>{if(!e)return;(async()=>{o(!0);try{const{data:r,error:s}=await q.from("reflections").select("*").eq("user_id",e).in("reflection_date",[t,a]);if(s)throw s;const n=(r||[]).find(e=>e.reflection_date===t)??null,l=(r||[]).find(e=>e.reflection_date===a)??null;x(n),u(l);const i=pa(l);if(f(i),n){N(n.did??""),_(n.didnt??""),S(n.cause_tags??[]),M(n.free_note??"");const e=pa(n);v(e.length?e:[{text:"",done:!1,done_at:null}])}else v([{text:"",done:!1,done_at:null}])}catch(r){console.error("Failed to load reflections (daily):",r)}finally{o(!1)}})()},[e,t,a]),r.useEffect(()=>{if(!e)return;(async()=>{p(!0);try{const t=ba(l,7),{data:r,error:a}=await q.from("reflections").select("id, user_id, reflection_date, did, didnt, cause_tags, next_action_items").eq("user_id",e).gte("reflection_date",l).lt("reflection_date",t).order("reflection_date",{ascending:!0});if(a)throw a;h(r||[])}catch(t){console.error("Failed to load reflections (week):",t)}finally{p(!1)}})()},[e,l]);const z=r.useMemo(()=>{const e=g.filter(e=>(e.did??"").trim().length>0).length,t=g.filter(e=>(e.didnt??"").trim().length>0).length,r={};g.forEach(e=>{(e.cause_tags??[]).forEach(e=>{const t=(e??"").trim();t&&(r[t]=(r[t]??0)+1)})});const a=Object.entries(r).sort((e,t)=>t[1]-e[1]).slice(0,3);let s=0,n=0;const l={};g.forEach(e=>{(e.next_action_items??[]).forEach(e=>{const t=((null==e?void 0:e.text)??"").trim();t&&(s+=1,e.done&&(n+=1),l[t]=l[t]??{total:0,done:0},l[t].total+=1,e.done&&(l[t].done+=1))})});const i=s?Math.round(n/s*100):0,d=Object.entries(l).map(([e,t])=>({text:e,total:t.total,done:t.done,rate:t.total?Math.round(t.done/t.total*100):0})).sort((e,t)=>t.total-e.total).slice(0,3);return{didCount:e,didntCount:t,topTags:a,goals:s,done:n,completionRate:i,topGoals:d,days:g.length}},[g]);return d?R.jsx("div",{className:"rounded-xl p-6 shadow-sm bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100",children:"èª­ã¿è¾¼ã¿ä¸­..."}):R.jsxs("div",{className:"rounded-xl p-6 shadow-sm space-y-6 bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100",children:[R.jsxs("div",{className:"rounded-lg border p-4\n        border-amber-200 bg-amber-50 text-amber-950\n        dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-100\n      ",children:[R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold",children:"é€±ã®å‚¾å‘"}),R.jsxs("div",{className:"text-xs mt-1 text-amber-800 dark:text-amber-200/80",children:[l," ã€œ ",i,"ï¼ˆ",z.days,"æ—¥åˆ†ï¼‰",b&&R.jsx("span",{className:"ml-2",children:"èª­ã¿è¾¼ã¿ä¸­â€¦"})]})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{type:"button",onClick:()=>n(e=>e-1),className:"\n                text-xs px-3 py-1 rounded-lg border\n                border-amber-300 bg-white hover:bg-amber-100\n                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800\n              ",children:"ï¼œ å…ˆé€±"}),R.jsx("button",{type:"button",onClick:()=>n(0),disabled:0===s,className:"\n                text-xs px-3 py-1 rounded-lg border\n                border-amber-300 bg-white hover:bg-amber-100 disabled:opacity-50\n                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800\n              ",children:"ä»Šé€±ã¸æˆ»ã‚‹"})]})]}),R.jsxs("div",{className:"mt-3 text-sm",children:["ã§ããŸï¼š",z.didCount,"ä»¶ ï¼ ã§ããªã‹ã£ãŸï¼š",z.didntCount,"ä»¶"]}),R.jsxs("div",{className:"mt-1 text-sm",children:["è¡Œå‹•ç›®æ¨™ï¼š",z.goals,"ä»¶ ï¼ å®Œäº†ï¼š",z.done,"ä»¶ï¼ˆ",z.completionRate,"%ï¼‰"]}),R.jsxs("div",{className:"mt-3 space-y-2",children:[R.jsx("div",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200/80",children:"åŸå› ã‚¿ã‚° TOP3"}),0===z.topTags.length?R.jsx("div",{className:"text-sm text-amber-800 dark:text-amber-200/80",children:"ã¾ã åŸå› ã‚¿ã‚°ãŒã‚ã‚Šã¾ã›ã‚“"}):R.jsx("div",{className:"flex flex-wrap gap-2",children:z.topTags.map(([e,t])=>R.jsxs("span",{className:"\n                    px-3 py-1 rounded-full text-xs border\n                    border-amber-200 bg-white text-amber-950\n                    dark:border-amber-900/60 dark:bg-gray-950 dark:text-amber-100\n                  ",children:[e,"ï¼š",t]},e))})]}),z.topGoals.length>0&&R.jsxs("div",{className:"mt-4 space-y-2",children:[R.jsx("div",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200/80",children:"ã‚ˆãç«‹ã¦ã‚‹è¡Œå‹•ç›®æ¨™ TOP3"}),z.topGoals.map(e=>R.jsxs("div",{className:"flex items-center justify-between gap-3",children:[R.jsx("div",{className:"text-sm flex-1",children:e.text}),R.jsxs("div",{className:"text-xs text-amber-800 dark:text-amber-200/80 w-28 text-right",children:[e.done,"/",e.total,"ï¼ˆ",e.rate,"%ï¼‰"]})]},e.text))]})]}),R.jsxs("div",{className:"rounded-lg border p-4\n        border-blue-200 bg-blue-50 text-blue-950\n        dark:border-blue-900/40 dark:bg-blue-950/30 dark:text-blue-100\n      ",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("h3",{className:"font-semibold",children:"ä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨ï¼ˆæ˜¨æ—¥ã®ç›®æ¨™ï¼‰"}),R.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-200/80",children:[a," ã«è¨­å®š"]})]}),0===y.length?R.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200/80 mt-2",children:"æ˜¨æ—¥ã®ã€Œè¡Œå‹•ç›®æ¨™ã€ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚æ˜¨æ—¥ã®æŒ¯ã‚Šè¿”ã‚Šã§è¡Œå‹•ç›®æ¨™ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã“ã“ã«å‡ºã¾ã™ã€‚"}):R.jsxs("div",{className:"mt-3 space-y-2",children:[y.map((e,t)=>R.jsxs("label",{className:"\n                  flex items-center gap-3 rounded-lg px-3 py-2 border\n                  bg-white border-blue-200\n                  dark:bg-gray-950 dark:border-blue-900/50\n                ",children:[R.jsx("input",{type:"checkbox",checked:!!e.done,onChange:()=>(async e=>{var t;if(!m)return;const r=[...y],a=r[e];if(!a)return;const s=(new Date).toISOString(),n={...a,done:!a.done,done_at:a.done?null:s};r[e]=n,f(r),T(!0);try{const{error:e}=await q.from("reflections").update({next_action_items:r,next_action:(null==(t=r[0])?void 0:t.text)??null,updated_at:(new Date).toISOString()}).eq("id",m.id);if(e)throw e;u(e=>{var t;return e?{...e,next_action_items:r,next_action:(null==(t=r[0])?void 0:t.text)??null}:e}),h(e=>e.map(e=>e.id===m.id?{...e,next_action_items:r}:e))}catch(l){console.error("Failed to save todo:",l),f(pa(m))}finally{T(!1)}})(t),disabled:E,className:"h-4 w-4 accent-green-600"}),R.jsxs("div",{className:"flex-1",children:[R.jsx("div",{className:"text-sm "+(e.done?"line-through text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"),children:e.text}),e.done_at&&R.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["å®Œäº†: ",new Date(e.done_at).toLocaleString("ja-JP")]})]}),e.done&&R.jsx(Te,{className:"h-4 w-4 text-green-600"})]},t)),R.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-200/80 mt-2",children:E?"ä¿å­˜ä¸­â€¦":"ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨å³ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆå®Œäº†ä¿å­˜ï¼‰"})]})]}),R.jsxs("div",{className:"space-y-3",children:[R.jsx("h3",{className:"font-semibold",children:"ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š"}),R.jsxs("div",{children:[R.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ã§ããŸã“ã¨"}),R.jsx("input",{value:w,onChange:e=>N(e.target.value),className:"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            ",placeholder:"ä¾‹ï¼šå¼·åº¦é«˜ã‚ã®ç·´ç¿’ã‚’æœ€å¾Œã¾ã§ã‚„ã‚Šåˆ‡ã‚ŒãŸ"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ã§ããªã‹ã£ãŸã“ã¨"}),R.jsx("input",{value:k,onChange:e=>_(e.target.value),className:"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            ",placeholder:"ä¾‹ï¼šç¡çœ æ™‚é–“ã‚’ç¢ºä¿ã§ããªã‹ã£ãŸ"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"åŸå› ã‚¿ã‚°"}),R.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ya.map(e=>{const t=C.includes(e);return R.jsx("button",{type:"button",onClick:()=>(e=>{S(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:`\n                    px-3 py-1 rounded-full text-xs border transition\n                    ${t?"bg-gray-900 text-white border-gray-900":"bg-slate-100 text-slate-800 border-slate-200 hover:bg-slate-200"}\n                    dark:${t?"bg-green-600 text-white border-green-600":"bg-slate-700 text-slate-100 border-slate-600 hover:bg-slate-600"}\n                  `,children:e},e)})}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"ã€Œã§ããªã‹ã£ãŸã€ã®ä¸»å› ã‚’ä»®èª¬ã§OKã€‚é€±ã®å‚¾å‘ã«é›†è¨ˆã•ã‚Œã¾ã™ã€‚"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ãƒ¡ãƒ¢"}),R.jsx("textarea",{value:D,onChange:e=>M(e.target.value),className:"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            ",rows:3,placeholder:"è‡ªç”±ãƒ¡ãƒ¢"})]}),R.jsxs("div",{className:"rounded-lg border p-4 border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("h4",{className:"font-semibold",children:"æ˜æ—¥ã®è¡Œå‹•ç›®æ¨™ï¼ˆè¤‡æ•°ï¼‰"}),R.jsxs("button",{type:"button",onClick:()=>{v(e=>[...e,{text:"",done:!1,done_at:null}])},className:"\n                text-sm px-3 py-1 rounded-lg flex items-center gap-2\n                bg-gray-900 text-white hover:bg-gray-800\n                dark:bg-green-600 dark:hover:bg-green-700\n              ",children:[R.jsx(kt,{className:"h-4 w-4"}),"è¿½åŠ "]})]}),R.jsx("div",{className:"mt-3 space-y-2",children:j.map((e,t)=>R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("input",{value:e.text,onChange:e=>((e,t)=>{v(r=>{const a=[...r];return a[e]={...a[e],text:t},a})})(t,e.target.value),className:"\n                    flex-1 border rounded-lg px-3 py-2\n                    bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n                    focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n                    dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n                    dark:focus:ring-green-500 dark:focus:border-green-500\n                  ",placeholder:"ä¾‹ï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’10åˆ†é–“è¡Œã†"}),R.jsx("button",{type:"button",onClick:()=>(e=>{v(t=>{const r=t.filter((t,r)=>r!==e);return r.length?r:[{text:"",done:!1,done_at:null}]})})(t),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"})})]},t))}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"ã“ã“ã§è¨­å®šã—ãŸã€Œæ˜æ—¥ã®è¡Œå‹•ç›®æ¨™ã€ã¯ã€ç¿Œæ—¥ã®ã‚«ãƒ¼ãƒ‰ä¸Šéƒ¨ã«â€œä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨â€ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"})]}),R.jsx("button",{onClick:async()=>{var r;if(e){$(!0);try{const a=j.map(e=>({...e,text:(e.text??"").trim()})).filter(e=>e.text.length>0),s={user_id:e,reflection_date:t,did:w.trim(),didnt:k.trim(),cause_tags:C,free_note:D.trim(),next_action_items:a,next_action:(null==(r=a[0])?void 0:r.text)??null,metadata:{source:"daily_reflection_card"},updated_at:(new Date).toISOString()};if(null==c?void 0:c.id){const{error:e}=await q.from("reflections").update(s).eq("id",c.id);if(e)throw e;x(e=>e?{...e,...s}:e),h(e=>e.map(e=>e.id===c.id?{...e,...s}:e))}else{const{data:e,error:r}=await q.from("reflections").insert(s).select("*").single();if(r)throw r;x(e),t>=l&&t<=i&&h(t=>{const r={id:e.id,user_id:e.user_id,reflection_date:e.reflection_date,did:e.did,didnt:e.didnt,cause_tags:e.cause_tags??s.cause_tags,next_action_items:e.next_action_items??s.next_action_items};return[...t.filter(e=>e.id!==r.id),r].sort((e,t)=>e.reflection_date.localeCompare(t.reflection_date))})}}catch(a){console.error("Failed to save reflection:",a)}finally{$(!1)}}},disabled:A,className:"\n            w-full rounded-lg px-4 py-3 font-medium\n            bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50\n            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\n            dark:focus:ring-offset-gray-900\n          ",children:A?"ä¿å­˜ä¸­â€¦":"ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Šã‚’ä¿å­˜"})]})]})}function ja({userId:e,highlight:t}){const[a,s]=r.useState(!1),[n,l]=r.useState(""),[i,d]=r.useState(!1),[o,c]=r.useState(!1),[x,m]=r.useState(!1),u=r.useMemo(()=>i&&!o,[i,o]);return R.jsxs(R.Fragment,{children:[R.jsxs("button",{type:"button",onClick:()=>s(!0),className:["w-full rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-colors","border",t?"bg-blue-600 text-white border-blue-600 hover:bg-blue-700 active:bg-blue-800":"bg-white dark:bg-gray-900 text-gray-900 dark:text-white border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/60 active:bg-gray-100 dark:active:bg-gray-800"].join(" "),children:[R.jsx(Tt,{className:"w-4 h-4"}),R.jsx("span",{className:"font-medium",children:"çŠ¶æ…‹ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«å…±æœ‰ã™ã‚‹"})]}),a&&R.jsxs("div",{className:"fixed inset-0 z-50",children:[R.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>!o&&s(!1)}),R.jsxs("div",{className:"absolute left-1/2 top-1/2 w-[92vw] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-2xl bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-2xl overflow-hidden",children:[R.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[R.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:"å…±æœ‰å†…å®¹ã®ç¢ºèª"}),R.jsx("button",{type:"button",onClick:()=>!o&&s(!1),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 active:bg-gray-200 dark:active:bg-white/15","aria-label":"é–‰ã˜ã‚‹",children:R.jsx(sr,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})})]}),R.jsxs("div",{className:"p-4 space-y-4",children:[R.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-200 space-y-1",children:[R.jsx("p",{children:"ã‚¹ã‚¿ãƒƒãƒ•ã«ä»¥ä¸‹ã®æƒ…å ±ãŒå…±æœ‰ã•ã‚Œã¾ã™ï¼š"}),R.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[R.jsx("li",{children:"ç›´è¿‘ã®ç·´ç¿’è² è·ï¼ˆsRPE / ACWRï¼‰"}),R.jsx("li",{children:"æœ€è¿‘ã®ä½“é‡ãƒ»ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³"}),R.jsx("li",{children:"ç¾åœ¨å‡ºã¦ã„ã‚‹ã‚¢ãƒ©ãƒ¼ãƒˆ"})]}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"â€»è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿è‡ªä½“ã¯ä¿å­˜ã›ãšã€å…±æœ‰ãƒ­ã‚°ã®ã¿æ®‹ã—ã¾ã™ã€‚"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),R.jsx("textarea",{value:n,onChange:e=>l(e.target.value),rows:3,className:"w-full rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 text-gray-900 dark:text-white px-3 py-2 text-sm placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/60",placeholder:"ä¾‹ï¼šè†ã«é•å’Œæ„Ÿã€ç¡çœ ãŒæµ…ã„ã€ä»Šæ—¥ã¯ã‚„ã‚Šåˆ‡ã‚Œãªã„æ„Ÿã˜ ãªã©"})]}),R.jsxs("button",{type:"button",onClick:()=>d(e=>!e),className:["w-full text-left rounded-xl border px-3 py-3 transition","flex items-start gap-3",i?"border-blue-500/60 bg-blue-50 dark:bg-blue-500/10":"border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10"].join(" "),"aria-pressed":i,children:[R.jsx("span",{className:["mt-0.5 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 transition",i?"bg-blue-600 border-blue-600":"bg-transparent border-gray-400/60 dark:border-gray-300/40"].join(" "),children:i&&R.jsx(Re,{className:"w-4 h-4 text-white"})}),R.jsxs("div",{className:"min-w-0",children:[R.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["å…±æœ‰ã™ã‚‹å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ãŸ"," ",R.jsx("span",{className:"text-xs text-amber-700 dark:text-amber-300",children:"ï¼ˆå¿…é ˆï¼‰"})]}),!i&&R.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:"ã“ã“ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ç¢ºèªã™ã‚‹ã¨ã€Œå…±æœ‰ã™ã‚‹ã€ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™"})]})]}),!i&&!x&&R.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-700 dark:text-amber-300",children:[R.jsx(fe,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),R.jsx("div",{children:"å…±æœ‰ã™ã‚‹ã«ã¯ã€Œå…±æœ‰å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ãŸï¼ˆå¿…é ˆï¼‰ã€ã‚’ONã«ã—ã¦ãã ã•ã„"})]}),R.jsx("button",{type:"button",onClick:async()=>{if(u){c(!0);try{const{error:t}=await q.from("shared_reports").insert({user_id:e,note:n.trim()?n.trim():null});if(t)throw t;m(!0),setTimeout(()=>{s(!1),m(!1),l(""),d(!1)},900)}catch(t){console.error("[ShareStatusButton] insert failed:",t),alert("å…±æœ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚é€šä¿¡çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")}finally{c(!1)}}},disabled:!u,className:["w-full rounded-xl px-4 py-3 font-semibold transition-colors",u?"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800":"bg-gray-200 text-gray-500 dark:bg-white/10 dark:text-white/40 cursor-not-allowed"].join(" "),children:x?"å…±æœ‰ã—ã¾ã—ãŸ":o?"é€ä¿¡ä¸­...":"å…±æœ‰ã™ã‚‹"}),x&&R.jsx("div",{className:"text-center text-sm text-gray-700 dark:text-gray-200",children:"ã‚¹ã‚¿ãƒƒãƒ•ã«å…±æœ‰ã—ã¾ã—ãŸã€‚çŠ¶æ…‹ã‚’ä¼ãˆã‚‹ã“ã¨ã¯ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’å®ˆã‚‹è¡Œå‹•ã§ã™ã€‚"})]})]})]})]})}function va(e){return"string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)}function wa(e){if(!va(e))return null;const t=new Date(e).getTime();return Number.isFinite(t)?t:null}function Na(e){let t=null,r=-1/0;for(const a of e){const e=wa(null==a?void 0:a.date);null!==e&&((!t||e>r)&&(t=a,r=e))}return t}function ka(e){const{daysWithData:t,consecutiveDays:r,weeklyAverage:a}=e;return R.jsxs("div",{className:"mb-3 rounded-lg bg-gray-50 dark:bg-gray-700/40 px-3 py-2 text-xs text-gray-600 dark:text-gray-300",children:["è¨˜éŒ²æ—¥æ•°: ",R.jsx("span",{className:"font-semibold",children:t})," ï¼ é€£ç¶š: ",R.jsx("span",{className:"font-semibold",children:r}),a&&R.jsxs(R.Fragment,{children:[" ","ï¼ 7æ—¥å¹³å‡RPE:"," ",R.jsx("span",{className:"font-semibold",children:a.rpe.toFixed(1)})," ","å¹³å‡æ™‚é–“:"," ",R.jsxs("span",{className:"font-semibold",children:[a.duration.toFixed(0),"åˆ†"]})]})]})}function _a(e){return"string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)}function Ca(e){if(_a(e))return e;if(e instanceof Date&&!isNaN(e.getTime()))return e.toISOString().slice(0,10);if("string"==typeof e){const t=e.match(/^(\d{4}-\d{2}-\d{2})/);if((null==t?void 0:t[1])&&_a(t[1]))return t[1]}return null}function Sa(e){if(null==e||""===e)return null;const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null}function Da(e){const t=Sa(e);return null===t?null:Math.round(t)}const Ma=(e,t,r)=>Math.min(r,Math.max(t,e));function Ea(e,t={}){const r=function(e){if(!e)return null;const t=Ca(e.date);if(!t)return null;const r=Sa(e.motivation_level??e.motivation);return{id:"string"==typeof e.id?e.id:void 0,date:t,motivation_level:r,energy_level:Sa(e.energy_level),stress_level:Sa(e.stress_level),notes:e.notes??null}}(e);if(!r)return null;const a=Ma(r.motivation_level??t.motivation??5,1,10),s=Ma(r.energy_level??t.energy??5,1,10),n=Ma(r.stress_level??t.stress??5,1,10);return{date:r.date,motivation_level:a,energy_level:s,stress_level:n,notes:r.notes??null}}function Ra({lastTrainingRecord:e,lastWeightRecord:t,lastSleepRecord:r,lastMotivationRecord:a}){const s=e?function(e){if(!e)return null;const t=Ca(e.date);return t?{id:"string"==typeof e.id?e.id:void 0,date:t,rpe:Sa(e.rpe),duration_min:Da(e.duration_min??e.duration_time??e.duration),arrow_score:Sa(e.arrow_score),signal_score:Sa(e.signal_score)}:null}(e):null;var n;return{normalizedLastTrainingRecord:s,normalizedLastTrainingRecordForCheckIn:s?(n=s)?{...n}:null:null,normalizedLastWeightRecord:t?function(e){if(!e)return null;const t=Ca(e.date);return t?{id:"string"==typeof e.id?e.id:void 0,date:t,weight_kg:Sa(e.weight_kg)}:null}(t):null,normalizedLastSleepRecord:r?function(e){if(!e)return null;const t=Ca(e.date);return t?{id:"string"==typeof e.id?e.id:void 0,date:t,sleep_hours:Sa(e.sleep_hours),sleep_quality:Sa(e.sleep_quality)}:null}(r):null,normalizedLastMotivationRecord:a?Ea(a):null}}function Ta(e){if(null==e)return null;const t=Number(e);return Number.isFinite(t)?t:null}function Aa(e){const t=String(e||"").trim();if(!t)return 0;const r=t.includes("T")?t:t.replace(/\//g,"-"),a=new Date(r+(r.includes("T")?"":"T00:00:00")).getTime();return Number.isFinite(a)?a:0}function $a(e){const[t,a]=r.useState([]),[s,n]=r.useState(!1),[l,i]=r.useState(null),d=r.useMemo(()=>0===t.length?null:t.reduce((e,t)=>e?Aa(t.measured_at)>Aa(e.measured_at)?t:e:t,null),[t]);return r.useEffect(()=>{if(!e)return;let t=!1;return(async()=>{n(!0),i(null);try{const{data:r,error:s}=await q.from("inbody_records").select("id, measured_at, height, weight, body_fat_percent, user_id").eq("user_id",e).order("measured_at",{ascending:!0});if(s)throw s;if(t)return;const n=(r??[]).map(e=>{const t=Ta(e.height),r=Ta(e.weight),a=Ta(e.body_fat_percent),s=function(e,t){if(null==e||null==t)return null;const r=e*(t/100);return Number.isFinite(r)?r:null}(r,a),n=function(e,t){if(null==e||null==t)return null;const r=e-t;return Number.isFinite(r)?r:null}(r,s);return{id:e.id,measured_at:String(e.measured_at),height:t,weight:r,body_fat_percent:a,fat_mass:s,fat_free_mass:n}});a(n)}catch(r){console.error("[useInbodyData]",r),i((null==r?void 0:r.message)??"InBodyãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),a([])}finally{t||n(!1)}})(),()=>{t=!0}},[e]),{records:t,latest:d,loading:s,error:l}}function za(e){const t=new Date(e+"T00:00:00");return Number.isNaN(t.getTime())?e:t.toLocaleDateString("ja-JP")}function qa({latest:e,loading:t,error:r}){return R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"InBodyï¼ˆæœ€æ–°ï¼‰"}),R.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[R.jsx(Me,{className:"w-4 h-4 mr-1"}),(null==e?void 0:e.measured_at)?za(e.measured_at):"â€”"]})]}),t?R.jsx("div",{className:"animate-pulse h-20 bg-gray-100 dark:bg-gray-700 rounded-lg"}):r?R.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:r}):e?R.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[R.jsx(Et,{className:"w-4 h-4 mr-1"})," ä½“é‡"]}),R.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.weight?`${e.weight.toFixed(1)} kg`:"â€”"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[R.jsx(Ke,{className:"w-4 h-4 mr-1"})," é™¤è„‚è‚ªé‡"]}),R.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.fat_free_mass?`${e.fat_free_mass.toFixed(1)} kg`:"â€”"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[R.jsx(Ve,{className:"w-4 h-4 mr-1"})," ä½“è„‚è‚ªé‡"]}),R.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.fat_mass?`${e.fat_mass.toFixed(1)} kg`:"â€”"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsxs("div",{className:"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1",children:[R.jsx(wt,{className:"w-4 h-4 mr-1"})," ä½“è„‚è‚ªç‡"]}),R.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:null!=e.body_fat_percent?`${e.body_fat_percent.toFixed(1)} %`:"â€”"})]})]}):R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"InBodyãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ï¼ˆCSVå–ã‚Šè¾¼ã¿å¾Œã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"})]})}function Fa(e){const t=String(e||"").trim();if(!t)return"";const r=t.includes("T")?t:t.replace(/\//g,"-"),a=new Date(r+(r.includes("T")?"":"T00:00:00"));return Number.isNaN(a.getTime())?t:a.toLocaleDateString("ja-JP")}function Ia(e){if(null==e)return null;const t=Number(e);return!Number.isFinite(t)||t<=0?null:t/100}function La(e){if(null==e)return null;const t=Math.round(100*e)/100;return Number.isFinite(t)?t:null}function Pa(e){if(null==e)return null;const t=Math.round(10*e)/10;return Number.isFinite(t)?t:null}const Oa={general:{male:{bmi:{low:18.5,high:25},pbf:{low:12,high:20}},female:{bmi:{low:18.5,high:25},pbf:{low:20,high:30}}},athlete:{male:{bmi:{low:20,high:27},pbf:{low:8,high:15}},female:{bmi:{low:18,high:25},pbf:{low:18,high:25}}}};function Wa({records:e,gender:t}){const[a,m]=r.useState(!0),[p,y]=r.useState("general"),f=a&&("male"===t||"female"===t),j=r.useMemo(()=>f?Oa[p][t]:null,[f,p,t]),v=r.useMemo(()=>{var t;const r=[...e??[]].sort((e,t)=>e.measured_at>t.measured_at?1:-1);for(let e=r.length-1;e>=0;e--){const a=null==(t=r[e])?void 0:t.height;if(null!=a&&Number.isFinite(a))return a}return null},[e]),w=r.useMemo(()=>[...e??[]].sort((e,t)=>e.measured_at>t.measured_at?1:-1).map(e=>{const t=e.height??v,r=e.weight??null,a=e.fat_free_mass??null,s=e.body_fat_percent??null,n=La(function(e,t){const r=Ia(t);if(null==e||null==r)return null;const a=e/(r*r);return Number.isFinite(a)?a:null}(a,t));return{date:e.measured_at,dateLabel:Fa(e.measured_at),weight:Pa(r),fat_free_mass:Pa(a),body_fat_percent:Pa(s),ffmi:n}}),[e,v]),N=r.useMemo(()=>[...e??[]].sort((e,t)=>e.measured_at>t.measured_at?1:-1).map((e,t)=>{const r=e.height??v,a=e.body_fat_percent??null,s=function(e,t){const r=Ia(t);if(null==e||null==r)return null;const a=e/(r*r);return Number.isFinite(a)?a:null}(e.weight??null,r);return{idx:t,date:e.measured_at,dateLabel:Fa(e.measured_at),pbf:Pa(a),bmi:La(s)}}).filter(e=>null!=e.pbf&&null!=e.bmi),[e,v]),k=w.some(e=>null!=e.weight||null!=e.fat_free_mass||null!=e.body_fat_percent||null!=e.ffmi);return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[R.jsx("div",{className:"flex items-start justify-between mb-4 gap-3",children:R.jsxs("div",{children:[R.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"InBody æ¨ç§»ï¼ˆå·¦å³2è»¸ï¼‰"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"å·¦ï¼šä½“é‡ / é™¤è„‚è‚ªé‡ã€€å³ï¼šä½“è„‚è‚ªç‡ / FFMIï¼ˆå³è»¸ã®æœ€å°ã¯0ï¼‰"})]})}),k?R.jsx("div",{className:"h-72 sm:h-80",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:w,children:[R.jsx(l,{strokeDasharray:"3 3"}),R.jsx(i,{dataKey:"dateLabel",tick:{fontSize:12}}),R.jsx(d,{yAxisId:"left",tick:{fontSize:12},width:52,domain:["auto","auto"]}),R.jsx(d,{yAxisId:"right",orientation:"right",tick:{fontSize:12},width:52,domain:[0,"auto"]}),R.jsx(o,{formatter:(e,t)=>{const r="number"==typeof e?e:null;return null==r?["â€”",t]:"weight"===t?[`${r.toFixed(1)} kg`,"ä½“é‡"]:"fat_free_mass"===t?[`${r.toFixed(1)} kg`,"é™¤è„‚è‚ªé‡"]:"body_fat_percent"===t?[`${r.toFixed(1)} %`,"ä½“è„‚è‚ªç‡"]:"ffmi"===t?[`${r.toFixed(2)}`,"FFMI"]:[String(e),t]},labelFormatter:e=>`æ¸¬å®šæ—¥ï¼š${e}`}),R.jsx(u,{}),R.jsx(x,{type:"monotone",dataKey:"weight",name:"ä½“é‡",yAxisId:"left",dot:{r:2},connectNulls:!0}),R.jsx(x,{type:"monotone",dataKey:"fat_free_mass",name:"é™¤è„‚è‚ªé‡",yAxisId:"left",dot:{r:2},connectNulls:!0}),R.jsx(x,{type:"monotone",dataKey:"body_fat_percent",name:"ä½“è„‚è‚ªç‡",yAxisId:"right",dot:{r:2},connectNulls:!0}),R.jsx(x,{type:"monotone",dataKey:"ffmi",name:"FFMI",yAxisId:"right",dot:{r:2},connectNulls:!0})]})})}):R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"è¡¨ç¤ºã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆä½“é‡/ä½“è„‚è‚ªç‡/èº«é•·ãŒå¿…è¦ã§ã™ï¼‰"})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-start justify-between mb-4 gap-3",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆBMI Ã— ä½“è„‚è‚ªç‡ï¼‰"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"æ¨ªï¼šä½“è„‚è‚ªç‡ï¼ˆ%ï¼‰ã€€ç¸¦ï¼šBMI"})]}),R.jsxs("div",{className:"flex flex-col items-end gap-2",children:[R.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[R.jsx("input",{type:"checkbox",className:"rounded",checked:a,onChange:e=>m(e.target.checked)}),"å¸¯ã‚’è¡¨ç¤º"]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"åŸºæº–"}),R.jsxs("select",{className:"text-xs px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100",value:p,onChange:e=>y(e.target.value),disabled:!f,children:[R.jsx("option",{value:"general",children:"ä¸€èˆ¬"}),R.jsx("option",{value:"athlete",children:"ç«¶æŠ€è€…"})]})]}),"male"!==t&&"female"!==t?R.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"æ€§åˆ¥æœªè¨­å®šã®ãŸã‚å¸¯ã¯OFF"}):R.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["æ€§åˆ¥ï¼š","male"===t?"ç”·æ€§":"å¥³æ€§"]})]})]}),0===N.length?R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"æ•£å¸ƒå›³ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆä½“é‡ãƒ»èº«é•·ãƒ»ä½“è„‚è‚ªç‡ãŒå¿…è¦ã§ã™ï¼‰"}):R.jsx("div",{className:"h-72 sm:h-80",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(g,{children:[R.jsx(l,{strokeDasharray:"3 3"}),R.jsx(i,{type:"number",dataKey:"pbf",name:"ä½“è„‚è‚ªç‡",unit:"%",tick:{fontSize:12},domain:["auto","auto"]}),R.jsx(d,{type:"number",dataKey:"bmi",name:"BMI",tick:{fontSize:12},domain:["auto","auto"]}),f&&j&&R.jsx(h,{x1:j.pbf.low,x2:j.pbf.high,y1:j.bmi.low,y2:j.bmi.high,fill:"rgba(59,130,246,0.18)",fillOpacity:1,stroke:"rgba(59,130,246,0.9)",strokeWidth:1.5,ifOverflow:"extendDomain"}),f&&j&&R.jsxs(R.Fragment,{children:[R.jsx(h,{x1:j.pbf.low,x2:j.pbf.high,y1:j.bmi.low,y2:j.bmi.high,fill:"rgba(59,130,246,0.12)",stroke:"rgba(59,130,246,0.55)",strokeWidth:1}),R.jsx(c,{x:j.pbf.low,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`PBF ${j.pbf.low}%`,position:"insideTopLeft",fontSize:11}}),R.jsx(c,{x:j.pbf.high,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`PBF ${j.pbf.high}%`,position:"insideTopRight",fontSize:11}}),R.jsx(c,{y:j.bmi.low,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`BMI ${j.bmi.low}`,position:"insideLeft",fontSize:11}}),R.jsx(c,{y:j.bmi.high,stroke:"rgba(59,130,246,0.75)",strokeDasharray:"4 4",label:{value:`BMI ${j.bmi.high}`,position:"insideLeft",fontSize:11}})]}),R.jsx(o,{cursor:{strokeDasharray:"3 3"},formatter:(e,t)=>{const r="number"==typeof e?e:null;return"pbf"===t?[`${null==r?void 0:r.toFixed(1)} %`,"ä½“è„‚è‚ªç‡"]:"bmi"===t?[`${null==r?void 0:r.toFixed(2)}`,"BMI"]:[String(e),t]},labelFormatter:(e,t)=>{var r;const a=null==(r=null==t?void 0:t[0])?void 0:r.payload;return(null==a?void 0:a.dateLabel)?`æ¸¬å®šæ—¥ï¼š${a.dateLabel}`:""}}),R.jsx(b,{name:"éå»â†’æœ€æ–°",data:N})]})})})]})]})}function Ba(e){var t,r,a,s,n,l,i,d,o,c;const x="number"==typeof e.intakeCalories?e.intakeCalories:null;let m=null,u="none";const g=(null==(t=e.snapshot)?void 0:t.bmr)??null;if("number"==typeof g&&Number.isFinite(g)&&g>0)m=g,u="snapshot";else{const t=(null==(r=e.fallback)?void 0:r.leanMassKg)??null;if("number"==typeof t&&t>0)h=t,m=Math.round(370+21.6*h),u="leanMass";else{const t=(null==(a=e.fallback)?void 0:a.weightKg7dAvg)??null,r=(null==(s=e.fallback)?void 0:s.heightCm)??null,i=(null==(n=e.fallback)?void 0:n.age)??null,d=(null==(l=e.fallback)?void 0:l.gender)??null;"number"==typeof t&&t>0&&"number"==typeof r&&r>0&&"number"==typeof i&&i>0&&("male"===d||"female"===d)&&(m=function(e){const{weightKg:t,heightCm:r,age:a,gender:s}=e,n=10*t+6.25*r-5*a;return Math.round("male"===s?n+5:n-161)}({weightKg:t,heightCm:r,age:i,gender:d}),u="mifflin")}}var h;let b=null,p="none";const y=(null==(i=e.snapshot)?void 0:i.tdee)??null;if("number"==typeof y&&Number.isFinite(y)&&y>0)b=y,p="snapshot";else if(m){const t=(null==(d=e.snapshot)?void 0:d.activity_factor)??null??1.55,r=(null==(o=e.fallback)?void 0:o.todayLoad)??(null==(c=e.snapshot)?void 0:c.srpe)??0,a=function(e){return e>=600?700:e>=400?500:e>=150?300:200}(Number(r??0));b=Math.round(m*t+a),p="estimated"}const f=null!=x&&null!=b?Math.round(x-b):null;let j="unknown",v="æœªåˆ¤å®š";return null!=f&&(f<=-350?(j="low",v="ä¸è¶³æ°—å‘³"):f>=350?(j="high",v="éå¤šæ°—å‘³"):(j="ok",v="æ¦‚ã­é©æ­£")),{date:e.date,bmr:m,tdee:b,intake:x,balance:f,status:j,statusLabel:v,meta:{bmrSource:u,tdeeSource:p}}}function Ua(e,t=0){const r=Number(e);return Number.isFinite(r)?r:t}function Ha(e){switch(e){case"low":return"bg-blue-600";case"ok":return"bg-emerald-600";case"high":return"bg-orange-600";default:return"bg-gray-400"}}function Va(e){switch(e){case"low":return"text-blue-700 dark:text-blue-300";case"ok":return"text-emerald-700 dark:text-emerald-300";case"high":return"text-orange-700 dark:text-orange-300";default:return"text-gray-500 dark:text-gray-400"}}function Ka({totals:e,targets:t,loading:a=!1,subtitle:s,onOpen:n}){const l=r.useMemo(()=>{if(!t)return null;const r=Ua(null==e?void 0:e.cal,0),a=Ua(null==e?void 0:e.p,0),s=Ua(null==e?void 0:e.f,0),n=Ua(null==e?void 0:e.c,0);return[{key:"cal",label:"ã‚«ãƒ­ãƒªãƒ¼",unit:"kcal",now:Math.round(r),goal:Math.round(Ua(null==t?void 0:t.cal,0))},{key:"p",label:"ãŸã‚“ã±ãè³ª",unit:"g",now:Math.round(10*a)/10,goal:Math.round(10*Ua(null==t?void 0:t.p,0))/10},{key:"f",label:"è„‚è³ª",unit:"g",now:Math.round(10*s)/10,goal:Math.round(10*Ua(null==t?void 0:t.f,0))/10},{key:"c",label:"ç‚­æ°´åŒ–ç‰©",unit:"g",now:Math.round(10*n)/10,goal:Math.round(10*Ua(null==t?void 0:t.c,0))/10}]},[e,t]);return R.jsxs("div",{className:["bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-5 transition-colors",n?"cursor-pointer hover:shadow-md":""].join(" "),onClick:n,role:n?"button":void 0,tabIndex:n?0:-1,onKeyDown:e=>{n&&("Enter"!==e.key&&" "!==e.key||n())},children:[R.jsx("div",{className:"flex items-start justify-between gap-3",children:R.jsxs("div",{children:[R.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"ä»Šæ—¥ã®æ „é¤Šé€²æ—"}),s&&R.jsx("p",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:s})]})}),a?R.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"èª­ã¿è¾¼ã¿ä¸­â€¦"}):l?R.jsx("div",{className:"mt-4 space-y-3",children:l.map(e=>{const t=function(e,t){if(!Number.isFinite(t)||t<=0)return"na";const r=e/t;return r<.7?"low":r<=1.1?"ok":"high"}(e.now,e.goal),r=function(e,t){if(!Number.isFinite(t)||t<=0)return 0;const r=e/t*100;return Math.min(100,Math.max(0,r))}(e.now,e.goal);return R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-baseline justify-between",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-200",children:e.label}),R.jsxs("span",{className:`text-[11px] ${Va(t)}`,children:[Math.round(r),"%"]})]}),R.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[e.now,"/",e.goal," ",e.unit]})]}),R.jsx("div",{className:"mt-1.5 h-2.5 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:R.jsx("div",{className:`h-full ${Ha(t)}`,style:{width:`${r}%`}})})]},e.key)})}):R.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"ç›®æ¨™å€¤ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ä½“é‡ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™"}),n&&R.jsx("div",{className:"mt-3 text-[11px] text-gray-500 dark:text-gray-400",children:"ã‚¿ãƒƒãƒ—ã§è©³ç´°ã‚’è¦‹ã‚‹"})]})}function Ja(e,t,r){return"number"==typeof e&&Number.isFinite(e)?Math.min(Math.max(e,t),r):t}function Ya(e){return Math.round(10*e)/10}function Za(e){return Math.round(e)}function Ga(e,t=0){return"number"==typeof e&&Number.isFinite(e)?e:t}function Qa({weightKg:e,bodyFatPercent:t,ffmKg:r,heightCm:a,age:s,sex:n,activityLevel:l="moderate",goalType:i="maintain",targetCaloriesOverride:d=null,proteinPerKg:o=null,proteinPerFFM:c=null,fatPerKg:x=null,minFatG:m=40,minCarbG:u=0,deficitKcal:g=0,surplusKcal:h=0,minCaloriesByBMRRatio:b=1.05,maxCalories:p=6e3}){const y=Ga(e,NaN);if(!Number.isFinite(y)||y<=0)throw new Error("weightKg is required");const f=[];Number.isFinite(t)||f.push("bodyFatPercent"),Number.isFinite(r)||f.push("ffmKg"),Number.isFinite(a)||f.push("heightCm"),Number.isFinite(s)||f.push("age"),n||f.push("sex");const j=Number.isFinite(r)?Ya(r):function(e,t){const r=Ga(e,0),a=Ga(t,NaN);if(!Number.isFinite(a))return null;const s=r*(1-a/100);return s>0?Ya(s):null}(y,t),v=j?function(e){const t=Ga(e,NaN);if(!Number.isFinite(t))return null;const r=370+21.6*t;return r>0?Za(r):null}(j):null,w=function({weightKg:e,heightCm:t,age:r,sex:a}){const s=Ga(e,NaN),n=Ga(t,NaN),l=Ga(r,NaN);if(![s,n,l].every(Number.isFinite))return null;const i=10*s+6.25*n-5*l,d=(a||"").toLowerCase(),o=i+("male"===d?5:"female"===d?-161:-78);return o>0?Za(o):null}({weightKg:y,heightCm:a,age:s,sex:n}),N=v??w??null,k=v?"katch":w?"mifflin":"none",_=N?function(e,t){const r=Ga(e,NaN);if(!Number.isFinite(r))return null;const a=r*function(e){switch((e||"").toLowerCase()){case"sedentary":case"low":return 1.2;case"light":return 1.375;case"moderate":default:return 1.55;case"high":return 1.725;case"athlete":case"very_high":return 1.9}}(t);return a>0?Za(a):null}(N,l):null,C=_?"bmr_x_activity":"none";let S=null;if(Number.isFinite(d))S=Za(d);else if(_)S=Za("loss_maintain_muscle"===i?_-(g||300):"gain"===i?_+(h||200):_);else{const e=function(e,t="moderate"){const r=Ga(e,NaN);if(!Number.isFinite(r)||r<=0)return null;const a=(t||"").toLowerCase();return Za(r*("sedentary"===a||"low"===a?28:"light"===a?30:"moderate"===a?33:"high"===a?36:"athlete"===a||"very_high"===a?40:33))}(y,l);S=Za(e??33*y)}let D=S;if(N){D=Ja(D,Za(N*Ga(b,1.05)),p)}else D=Ja(D,800,p);const M="loss_maintain_muscle"===i?2:"gain"===i?1.8:1.6,E=Number.isFinite(c)&&j?Za(j*c):Number.isFinite(o)?Za(y*o):Za(j&&"loss_maintain_muscle"===i?2.4*j:y*M),R="loss_maintain_muscle"===i?.8:"gain"===i?1:.9,T=Ja(Za(y*(Number.isFinite(x)?x:R)),m,200),A=4*E+9*T,$=D-A;let z=Math.max(0,Za($/4));const q=Math.max(0,Za(Ga(u,0)));let F=D,I=null;q>0&&z<q&&(z=q,F=Za(A+4*z),I="minCarbG_applied");const L=(()=>{const e=!!j,t=[a,s].every(Number.isFinite)&&!!n;return e||t?"high":l?"mid":"low"})();return{ffmKg:j,bmrKcal:N,tdeeKcal:_,activityLevel:l,goalType:i,meta:{bmrMethod:k,tdeeMethod:C,confidence:L,missing:f,targetCalRaw:S,targetCalAdjusted:F,adjustedReason:I},target:{cal:F,p:E,f:T,c:z}}}function Xa({today:e,target:t}){const r=e||{cal:0,p:0,f:0,c:0},a=t||{cal:0,p:0,f:0,c:0};return{cal:Za(Ga(a.cal,0)-Ga(r.cal,0)),p:Ya(Ga(a.p,0)-Ga(r.p,0)),f:Ya(Ga(a.f,0)-Ga(r.f,0)),c:Ya(Ga(a.c,0)-Ga(r.c,0))}}const es=1e4;function ts(e){return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}function rs(){return new Date((new Date).getTime()+324e5).toISOString().slice(0,10)}function as(e){switch(e){case"good":return"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200";case"fatigue":return"bg-amber-50 text-amber-700 ring-1 ring-amber-200";case"danger":case"stop":return"bg-rose-50 text-rose-700 ring-1 ring-rose-200";default:return"bg-slate-50 text-slate-600 ring-1 ring-slate-200"}}function ss({userId:e,onBackHome:t}){const[a,s]=r.useState("standby"),n=r.useRef(!1),[l,i]=r.useState(!1),[d,o]=r.useState(es),[c,x]=r.useState(0),[m,u]=r.useState(0),[g,h]=r.useState(0),[b,p]=r.useState([]),[y,f]=r.useState("calibrating"),[j,v]=r.useState(""),[w,N]=r.useState(!1),[k,_]=r.useState(!1),[C,S]=r.useState(""),D=r.useRef(0),M=r.useRef([]),E=r.useRef(null),T=r.useRef(null),A=r.useRef(null),$=r.useRef(null),z=r.useMemo(()=>{return e=1-d/es,t=0,r=1,Math.max(t,Math.min(r,e));var e,t,r},[d]);function F(){E.current&&(window.clearInterval(E.current),E.current=null)}function I(){F(),i(!1),n.current=!1,o(es),x(0),M.current=[],D.current=0,A.current=null,N(!1),_(!1),S("")}r.useEffect(()=>()=>{n.current=!1,F()},[]);const L="standby"===a?"10ç§’ã‚¿ãƒƒãƒ—ã§ã€è„³ã®ã‚­ãƒ¬ã¨å®‰å®šæ€§ã‚’ãƒã‚§ãƒƒã‚¯":"measure"===a?"ã§ãã‚‹ã ã‘é€Ÿãã€ä¸€å®šã®ãƒªã‚ºãƒ ã§":"çµæœã‚’ç¢ºèªã—ã¦ã€å¿…è¦ãªã‚‰ä¿å­˜",P=Bt;return R.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900",children:R.jsxs("div",{className:"mx-auto max-w-md px-4 py-8",children:[R.jsx("div",{className:"mb-6",children:R.jsxs("div",{className:"flex items-center justify-between gap-3",children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx("div",{className:"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center",children:R.jsx(P,{className:"h-5 w-5 text-slate-700"})}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xl font-extrabold tracking-tight",children:"FTT Check"}),R.jsx("div",{className:"text-sm text-slate-500",children:L})]})]}),t&&R.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:[R.jsx(je,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"æˆ»ã‚‹"})]})]})}),R.jsxs("div",{className:"rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden",children:[R.jsxs("div",{className:"px-5 py-4 border-b border-slate-100 flex items-center justify-between",children:[R.jsxs("div",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[R.jsx(Bt,{className:"h-4 w-4"}),"standby"===a?"Standby":"measure"===a?"Measuring":"Result"]}),R.jsx("div",{className:"text-xs text-slate-400",children:"Bekuta"})]}),R.jsxs("div",{className:"p-5",children:["standby"===a&&R.jsxs("div",{className:"space-y-4",children:[R.jsx("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:R.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[R.jsxs("li",{className:"flex items-start gap-2",children:[R.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"1"}),R.jsx("span",{children:"ã‚¹ãƒãƒ›ã‚’æœºã«ç½®ã„ã¦å›ºå®š"})]}),R.jsxs("li",{className:"flex items-start gap-2",children:[R.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"2"}),R.jsx("span",{children:"åˆ©ãæ‰‹ã®äººå·®ã—æŒ‡ 1æœ¬ã§ã‚¿ãƒƒãƒ—"})]}),R.jsxs("li",{className:"flex items-start gap-2",children:[R.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700",children:"3"}),R.jsx("span",{children:"10ç§’é–“ã€é€Ÿããƒ»ä¸€å®šã®ãƒªã‚ºãƒ ã§"})]})]})}),R.jsx("button",{onClick:function(){I(),s("measure"),i(!0),n.current=!0,D.current=performance.now(),E.current=window.setInterval(()=>{if(!n.current)return;const t=performance.now()-D.current,r=Math.max(0,es-t);o(r),r<=0&&(F(),async function(){s("result"),i(!1),n.current=!1,F();const t=M.current,r=t.length,a=[];for(let e=1;e<t.length;e++)a.push(t[e]-t[e-1]);const l=function(e){if(e.length<=1)return 0;const t=ts(e),r=e.reduce((e,r)=>e+(r-t)*(r-t),0)/e.length;return Math.sqrt(r)}(a);u(r),h(l),p(a);const d=await async function(t,r){const a=5,s=30,n=.9,l=.25;if(!e)return{condition:"calibrating",message:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚"};const i=await async function(t){const{minSamples:r,windowDays:a}=t;if(!e)return{ok:!1,reason:"no_user",sampleCount:0};const s=rs(),n=`${e}:${s}`,l=$.current;if(l&&l.key===n&&l.windowDays===a&&l.minSamples===r)return l.sampleCount<r?{ok:!1,reason:"not_enough_samples",sampleCount:l.sampleCount}:{ok:!0,baselineSpeed:l.baselineSpeed,baselineSD:l.baselineSD,sampleCount:l.sampleCount};const i=function(e){const t=new Date((new Date).getTime()+324e5),r=new Date(t);return r.setDate(r.getDate()-e),r.toISOString().slice(0,10)}(a),{data:d,error:o}=await q.from("ftt_records").select("date,total_count,interval_sd_ms,measured_at").eq("user_id",e).gte("date",i).order("measured_at",{ascending:!1}).limit(200);if(o)return $.current={key:n,windowDays:a,minSamples:r,sampleCount:0,baselineSpeed:0,baselineSD:0,fetchedAt:Date.now()},{ok:!1,reason:"fetch_error",sampleCount:0};const c=(d??[]).filter(e=>{const t=Number(null==e?void 0:e.total_count),r=Number(null==e?void 0:e.interval_sd_ms);return Number.isFinite(t)&&t>0&&Number.isFinite(r)&&r>=0}),x=c.length;if(x<r)return $.current={key:n,windowDays:a,minSamples:r,sampleCount:x,baselineSpeed:0,baselineSD:0,fetchedAt:Date.now()},{ok:!1,reason:"not_enough_samples",sampleCount:x};const m=ts(c.map(e=>Number(e.total_count))),u=ts(c.map(e=>Number(e.interval_sd_ms)));return $.current={key:n,windowDays:a,minSamples:r,sampleCount:x,baselineSpeed:m,baselineSD:u,fetchedAt:Date.now()},{ok:!0,baselineSpeed:m,baselineSD:u,sampleCount:x}}({minSamples:a,windowDays:s});if(!i.ok)return"not_enough_samples"===i.reason?{condition:"calibrating",message:"ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ï¼ˆã‚ã¨æ•°å›ã§åˆ¤å®šãŒå‡ºã¾ã™ï¼‰ã€‚"}:{condition:"calibrating",message:"ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆåˆå›ã¯åˆ¤å®šã—ã¾ã›ã‚“ï¼‰ã€‚"};const d=i.baselineSpeed,o=i.baselineSD,c=t<d*n,x=o>0&&r>o*(1+l);if(c&&x)return{condition:"stop",message:"å¿ƒèº«ã¨ã‚‚ã«é™ç•Œã§ã™ã€‚å‹‡æ°—ã‚’æŒã£ã¦ä¼‘æ¯ã‚’ã¨ã£ã¦ãã ã•ã„ã€‚"};if(x)return{condition:"danger",message:"ä½“ã¯å‹•ãã¾ã™ãŒåˆ¶å¾¡ãŒåŠ¹ã„ã¦ã„ã¾ã›ã‚“ã€‚æ€ªæˆ‘ãƒªã‚¹ã‚¯ãŒé«˜ã„çŠ¶æ…‹ã§ã™ã€‚ã‚¢ãƒƒãƒ—ã‚’å¿µå…¥ã‚Šã«ã€‚"};if(c)return{condition:"fatigue",message:"è„³ãŒå°‘ã—ãŠç–²ã‚Œãƒ¢ãƒ¼ãƒ‰ã€‚ä»Šæ—¥ã¯è³ªã®é«˜ã„ç¡çœ ã‚’å„ªå…ˆã—ã¾ã—ã‚‡ã†ã€‚"};return{condition:"good",message:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è‰¯å¥½ã€‚é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæœŸå¾…ã§ãã¾ã™ã€‚"}}(r,l);f(d.condition),v(d.message),await async function(){if(!e)return;try{const{data:t,error:r}=await q.from("ftt_events").insert({user_id:e,did_save:!1}).select("id").single();if(r)return void console.error("[FTT events insert error]",r);A.current=(null==t?void 0:t.id)??null}catch(t){console.error("[FTT events insert exception]",t)}}()}())},50)},className:"w-full rounded-2xl bg-slate-900 text-white py-3.5 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition",children:"START"}),R.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:"â€» åŸºæœ¬ã¯1æ—¥1å›ã€‚ãƒŸã‚¹ã£ãŸã‚‰RETRYã§ã‚„ã‚Šç›´ã›ã¾ã™ï¼ˆæ¸¬å®šãƒ­ã‚°ã¯æ®‹ã‚Šã¾ã™ï¼‰ã€‚"})]}),"measure"===a&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"flex items-end justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Remaining"}),R.jsx("div",{className:"text-4xl font-extrabold tracking-tight tabular-nums",children:(d/1e3).toFixed(2)})]}),R.jsxs("div",{className:"text-sm text-slate-600 font-semibold flex items-center gap-2",children:[R.jsx(rt,{className:"h-4 w-4"}),"TAPS ",R.jsx("span",{className:"font-extrabold tabular-nums",children:c})]})]}),R.jsx("div",{className:"h-2 w-full rounded-full bg-slate-100 overflow-hidden ring-1 ring-slate-200",children:R.jsx("div",{className:"h-full rounded-full bg-blue-500",style:{width:100*z+"%",transition:"width 50ms linear"}})}),R.jsxs("div",{ref:T,onPointerDown:function(e){if(!n.current)return;e.cancelable&&e.preventDefault();const t=performance.now();M.current.push(t),x(M.current.length),function(e){const t=T.current;if(!t)return;const r=t.getBoundingClientRect(),a=document.createElement("div");a.style.position="absolute",a.style.borderRadius="999px",a.style.pointerEvents="none",a.style.width="54px",a.style.height="54px",a.style.left=e.clientX-r.left-27+"px",a.style.top=e.clientY-r.top-27+"px",a.style.background="rgba(59,130,246,.20)",a.style.transform="scale(0)",a.style.transition="transform 420ms ease, opacity 420ms ease",t.appendChild(a),requestAnimationFrame(()=>{a.style.transform="scale(5)",a.style.opacity="0"}),setTimeout(()=>a.remove(),450)}(e)},className:"relative h-72 rounded-3xl bg-gradient-to-b from-slate-50 to-white ring-1 ring-slate-200 shadow-sm overflow-hidden select-none",style:{touchAction:"manipulation",WebkitUserSelect:"none",WebkitTouchCallout:"none"},children:[R.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[R.jsx("div",{className:"absolute -top-12 -right-12 h-40 w-40 rounded-full bg-blue-100/50 blur-2xl"}),R.jsx("div",{className:"absolute -bottom-16 -left-16 h-44 w-44 rounded-full bg-emerald-100/40 blur-2xl"})]}),R.jsxs("div",{className:"h-full flex flex-col items-center justify-center gap-3 select-none",children:[R.jsxs("div",{className:"relative h-24 w-24 flex items-center justify-center",children:[R.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/40 animate-ftt-ripple"}),R.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/30 animate-ftt-ripple delay-300"}),R.jsx("span",{className:"absolute h-full w-full rounded-full border border-slate-300/20 animate-ftt-ripple delay-600"}),R.jsx("span",{className:"relative z-10 h-3 w-3 rounded-full bg-slate-800 shadow-[0_0_0_6px_rgba(15,23,42,0.08)]"})]}),R.jsx("div",{className:"text-sm font-extrabold tracking-widest text-slate-800",children:"TAP FAST"}),R.jsx("div",{className:"text-xs text-slate-500",children:"äººå·®ã—æŒ‡1æœ¬ã§"})]})]}),R.jsxs("button",{onClick:()=>{I(),s("standby")},className:"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2",children:[R.jsx(St,{className:"h-4 w-4"}),"CANCEL"]})]}),"result"===a&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[R.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:[R.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Speed (Total)"}),R.jsx("div",{className:"mt-1 text-3xl font-extrabold tabular-nums",children:m})]}),R.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4",children:[R.jsx("div",{className:"text-xs text-slate-500 font-semibold uppercase tracking-wider",children:"Stability (SD)"}),R.jsxs("div",{className:"mt-1 text-3xl font-extrabold tabular-nums",children:[g.toFixed(1),R.jsx("span",{className:"text-sm font-bold text-slate-500 ml-1",children:"ms"})]})]})]}),(()=>{const e=function(e){switch(e){case"good":return{title:"GOOD",sub:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è‰¯å¥½",icon:It};case"fatigue":return{title:"FATIGUE",sub:"å°‘ã—ãŠç–²ã‚Œãƒ¢ãƒ¼ãƒ‰",icon:Bt};case"danger":return{title:"DANGER",sub:"åˆ¶å¾¡ãŒåŠ¹ãã«ãã„çŠ¶æ…‹",icon:$t};case"stop":return{title:"STOP",sub:"ä¼‘æ¯ãŒå¿…è¦",icon:$t};default:return{title:"CALIBRATING",sub:"åˆ¤å®šæº–å‚™ä¸­",icon:Bt}}}(y),t=e.icon;return R.jsxs("div",{className:`rounded-2xl px-4 py-3 ${as(y)} flex items-center gap-3`,children:[R.jsx("div",{className:"h-9 w-9 rounded-xl bg-white/70 flex items-center justify-center",children:R.jsx(t,{className:"h-5 w-5"})}),R.jsxs("div",{className:"flex-1",children:[R.jsx("div",{className:"text-sm font-extrabold tracking-wide",children:e.title}),R.jsx("div",{className:"text-xs opacity-80",children:e.sub})]}),R.jsxs("div",{className:"text-xs font-bold opacity-80 tabular-nums",children:["intervals: ",b.length]})]})})(),R.jsx("div",{className:"text-sm text-slate-700 leading-relaxed",children:j}),R.jsxs("button",{disabled:k||w,onClick:async function(){if(k||w)return;if(!e)return void S("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");_(!0),S("é€ä¿¡ã‚­ãƒ¥ãƒ¼å¾…æ©Ÿä¸­â€¦ï¼ˆè² è·åˆ†æ•£ï¼‰");const t=Math.floor(5e3*Math.random());var r;await(r=t,new Promise(e=>setTimeout(e,r)));try{S("ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ä¸­â€¦");const t=rs(),{error:r}=await q.from("ftt_records").upsert({user_id:e,date:t,duration_sec:Math.round(10),total_count:m,interval_sd_ms:g,raw_intervals_ms:b,condition_result:y,meta:{ua:"undefined"!=typeof navigator?navigator.userAgent:null,tz:Intl.DateTimeFormat().resolvedOptions().timeZone,source:"ftt_check"}},{onConflict:"user_id,date"});if(r)return console.error("[FTT records upsert error]",r),S(`ä¿å­˜å¤±æ•—: ${r.message}`),void _(!1);const a=A.current;if(a){const{error:t}=await q.from("ftt_events").update({did_save:!0}).eq("id",a).eq("user_id",e);t&&console.error("[FTT events update error]",t)}N(!0),S("âœ… ä¿å­˜å®Œäº†"),_(!1)}catch(a){console.error("[FTT save exception]",a),S(`ä¿å­˜å¤±æ•—: ${(null==a?void 0:a.message)??"unknown error"}`),_(!1)}},className:["w-full rounded-2xl py-3.5 font-extrabold tracking-wide flex items-center justify-center gap-2 transition active:scale-[0.99]",w?"bg-emerald-600 text-white":k?"bg-slate-200 text-slate-600 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-500"].join(" "),children:[R.jsx(Mt,{className:"h-4 w-4"}),w?"SAVED âœ…":k?"SAVING...":"SAVE DATA"]}),R.jsx("div",{className:["min-h-[18px] text-xs text-center",w?"text-emerald-700":C.includes("å¤±æ•—")?"text-rose-700":"text-slate-500"].join(" "),children:C}),R.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:"â€» è¨ˆæ¸¬çµ‚äº†æ™‚ç‚¹ã§ã€Œæœªä¿å­˜ãƒ­ã‚°ï¼ˆftt_eventsï¼‰ã€ãŒæ®‹ã‚Šã¾ã™ã€‚ ä¿å­˜ãƒœã‚¿ãƒ³ã§ã€Œãã®æ—¥ã®æ­£å¼ãƒ‡ãƒ¼ã‚¿ï¼ˆftt_recordsï¼‰ã€ã¨ã—ã¦æ¡ç”¨ã•ã‚Œã¾ã™ã€‚"}),R.jsxs("button",{onClick:()=>{I(),s("standby")},className:"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2",children:[R.jsx(St,{className:"h-4 w-4"}),"RETRY"]})]})]})]}),R.jsx("div",{className:"mt-6 text-center text-xs text-slate-400",children:"â€œfast & steadyâ€ ãŒã‚³ãƒ„ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰ã ã‘ã§ãªãå®‰å®šæ€§ã‚‚è¦‹ã¾ã™ã€‚"})]})})}const ns=r.lazy(()=>$(()=>import("./GamificationView-DcmE6WMq.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.GamificationView})));function ls({user:e}){return R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:R.jsx(ns,{userId:e.id,userTeamId:e.team_id})})}const is=[{value:"cramps",label:"ç”Ÿç†ç—›",icon:nr},{value:"mood_changes",label:"æ°—åˆ†ã®å¤‰åŒ–",icon:We},{value:"fatigue",label:"ç–²åŠ´æ„Ÿ",icon:_e},{value:"headache",label:"é ­ç—›",icon:Se},{value:"bloating",label:"è†¨æº€æ„Ÿ",icon:ar},{value:"breast_tenderness",label:"èƒ¸ã®å¼µã‚Š",icon:at},{value:"acne",label:"ãƒ‹ã‚­ãƒ“",icon:It},{value:"back_pain",label:"è…°ç—›",icon:Ot}];function ds({userId:e,onSuccess:t}){const{addCycle:a}=Gr(e),[s,n]=r.useState(!1),[l,i]=r.useState(null),[d,o]=r.useState(!1),[c,x]=r.useState("success"),[m,u]=r.useState(""),g=(e,t)=>{x(e),u(t),o(!0)},[h,b]=r.useState({cycle_start_date:"",period_end_date:"",flow_intensity:"",symptoms:[],notes:""}),p=(e,t)=>{const r=new Date(e),a=new Date(t);return Math.floor((a.getTime()-r.getTime())/864e5)+1},y=h.cycle_start_date&&h.period_end_date?p(h.cycle_start_date,h.period_end_date):null;return R.jsxs(R.Fragment,{children:[R.jsx(yr,{open:d,type:c,message:m,onClose:()=>o(!1)}),R.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!s){n(!0),i(null);try{if(!h.cycle_start_date)throw new Error("ç”Ÿç†é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const e={cycle_start_date:h.cycle_start_date,symptoms:h.symptoms};if(h.period_end_date){const t=p(h.cycle_start_date,h.period_end_date);if(t<=0)throw new Error("ç”Ÿç†çµ‚äº†æ—¥ã¯é–‹å§‹æ—¥ä»¥é™ã‚’é¸æŠã—ã¦ãã ã•ã„");e.period_duration_days=t}h.flow_intensity&&(e.flow_intensity=h.flow_intensity),h.notes&&(e.notes=h.notes),await a(e),b({cycle_start_date:"",period_end_date:"",flow_intensity:"",symptoms:[],notes:""}),g("success","å‘¨æœŸã‚’è¨˜éŒ²ã—ã¾ã—ãŸ âœ…"),t&&t()}catch(r){const e=r instanceof Error?r.message:"å‘¨æœŸãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ";i(e),g("error",`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e}`)}finally{n(!1)}}},className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[R.jsx(Ve,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),R.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"æœˆçµŒå‘¨æœŸã‚’è¨˜éŒ²"})]}),l&&R.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[R.jsx(ye,{className:"w-5 h-5"}),R.jsx("span",{children:l})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Me,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†é–‹å§‹æ—¥ *"]}),R.jsx("input",{type:"date",required:!0,value:h.cycle_start_date,onChange:e=>b({...h,cycle_start_date:e.target.value}),disabled:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Me,{className:"inline w-4 h-4 mr-1"}),"ç”Ÿç†çµ‚äº†æ—¥"]}),R.jsx("input",{type:"date",value:h.period_end_date,min:h.cycle_start_date||void 0,onChange:e=>b({...h,period_end_date:e.target.value}),disabled:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60"}),null!=y&&R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ç”Ÿç†æœŸé–“: ",y,"æ—¥é–“"]})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"çµŒè¡€é‡"}),R.jsxs("select",{value:h.flow_intensity,onChange:e=>b({...h,flow_intensity:e.target.value}),disabled:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60",children:[R.jsx("option",{value:"",children:"é¸æŠ..."}),R.jsx("option",{value:"light",children:"å°‘ãªã„"}),R.jsx("option",{value:"moderate",children:"æ™®é€š"}),R.jsx("option",{value:"heavy",children:"å¤šã„"})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç—‡çŠ¶"}),R.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:is.map(e=>{const t=e.icon,r=h.symptoms.includes(e.value);return R.jsxs("button",{type:"button",onClick:()=>(e=>{b(t=>({...t,symptoms:t.symptoms.includes(e)?t.symptoms.filter(t=>t!==e):[...t.symptoms,e]}))})(e.value),disabled:s,className:"px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 disabled:opacity-60 disabled:cursor-not-allowed "+(r?"border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-[1.02]":"border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300"),children:[R.jsx(t,{className:"w-4 h-4"}),R.jsx("span",{children:e.label})]},e.value)})})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢"}),R.jsx("textarea",{value:h.notes,onChange:e=>b({...h,notes:e.target.value}),rows:3,disabled:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60",placeholder:"ãã®ä»–ã®ãƒ¡ãƒ¢..."})]}),R.jsx("button",{type:"submit",disabled:s,className:"w-full py-3 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s?"ä¿å­˜ä¸­...":"å‘¨æœŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜"})]})]})}function os(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{d()},[e]);const d=async()=>{try{n(!0);const{data:t,error:r}=await q.from("basal_body_temperature").select("*").eq("user_id",e).order("measurement_date",{ascending:!1});if(r)throw r;a(t||[])}catch(t){i(t instanceof Error?t.message:"Failed to fetch basal body temperature")}finally{n(!1)}};return{temperatures:t,loading:s,error:l,addTemperature:async t=>{try{const{data:r}=await q.auth.getUser();if(!r.user)throw new Error("User not authenticated");const{data:s}=await q.from("users").select("team_id").eq("user_id",r.user.id).maybeSingle();let n=null;if(null==s?void 0:s.team_id){const{data:e}=await q.from("teams").select("organization_id").eq("id",s.team_id).maybeSingle();n=(null==e?void 0:e.organization_id)||null}const{data:l,error:i}=await q.from("basal_body_temperature").insert({...t,user_id:e,organization_id:n}).select().single();if(i)throw i;return l&&a(e=>[l,...e]),l}catch(r){throw i(r instanceof Error?r.message:"Failed to add basal body temperature"),r}},updateTemperature:async(e,t)=>{try{const{data:r,error:s}=await q.from("basal_body_temperature").update(t).eq("id",e).select().single();if(s)throw s;return r&&a(t=>t.map(t=>t.id===e?r:t)),r}catch(r){throw i(r instanceof Error?r.message:"Failed to update basal body temperature"),r}},deleteTemperature:async e=>{try{const{error:t}=await q.from("basal_body_temperature").delete().eq("id",e);if(t)throw t;a(t=>t.filter(t=>t.id!==e))}catch(t){throw i(t instanceof Error?t.message:"Failed to delete basal body temperature"),t}},getTemperatureTrend:(e=7)=>{const r=t.slice(0,e).sort((e,t)=>new Date(e.measurement_date).getTime()-new Date(t.measurement_date).getTime());if(r.length<3)return"stable";const a=r.slice(0,Math.floor(r.length/2)),s=r.slice(Math.floor(r.length/2)),n=a.reduce((e,t)=>e+Number(t.temperature_celsius),0)/a.length,l=s.reduce((e,t)=>e+Number(t.temperature_celsius),0)/s.length-n;return l>.1?"rising":l<-.1?"falling":"stable"},getAverageTemperature:(e=7)=>{const r=t.slice(0,e);if(0===r.length)return null;return r.reduce((e,t)=>e+Number(t.temperature_celsius),0)/r.length},refetch:d}}function cs({userId:e,onSuccess:t}){const{addTemperature:a}=os(e),[s,n]=r.useState(!1),[l,i]=r.useState(null),d=H(),o=(new Date).toTimeString().slice(0,5),[c,x]=r.useState({measurement_date:d,temperature_celsius:"",measurement_time:o,notes:""});return R.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0),i(null);try{const e={measurement_date:c.measurement_date,temperature_celsius:parseFloat(c.temperature_celsius)};c.measurement_time&&(e.measurement_time=c.measurement_time),c.notes&&(e.notes=c.notes),await a(e),x({measurement_date:d,temperature_celsius:"",measurement_time:o,notes:""}),t&&t()}catch(r){i(r instanceof Error?r.message:"ä½“æ¸©ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}},className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[R.jsx(Wt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),R.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"åŸºç¤ä½“æ¸©ã‚’è¨˜éŒ²"})]}),l&&R.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg",children:[R.jsx(ye,{className:"w-5 h-5"}),R.jsx("span",{children:l})]}),R.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:R.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[R.jsx("strong",{children:"ãƒ’ãƒ³ãƒˆ:"})," åŸºç¤ä½“æ¸©ã¯èµ·åºŠå¾Œã™ãã€ãƒ™ãƒƒãƒ‰ã‹ã‚‰å‡ºã‚‹å‰ã‚„èº«ä½“æ´»å‹•ã‚’ã™ã‚‹å‰ã«æ¸¬å®šã—ã¦ãã ã•ã„ã€‚"]})}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Me,{className:"inline w-4 h-4 mr-1"}),"æ¸¬å®šæ—¥ *"]}),R.jsx("input",{type:"date",required:!0,value:c.measurement_date,max:d,onChange:e=>x({...c,measurement_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Oe,{className:"inline w-4 h-4 mr-1"}),"æ¸¬å®šæ™‚åˆ»"]}),R.jsx("input",{type:"time",value:c.measurement_time,onChange:e=>x({...c,measurement_time:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[R.jsx(Wt,{className:"inline w-4 h-4 mr-1"}),"ä½“æ¸©ï¼ˆâ„ƒï¼‰ *"]}),R.jsx("input",{type:"number",step:"0.01",min:"35.0",max:"42.0",required:!0,value:c.temperature_celsius,onChange:e=>x({...c,temperature_celsius:e.target.value}),placeholder:"ä¾‹: 36.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"æ­£å¸¸ç¯„å›²: 36.1 - 37.0â„ƒ"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢"}),R.jsx("textarea",{value:c.notes,onChange:e=>x({...c,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ä½“æ¸©ã«å½±éŸ¿ã™ã‚‹è¦å› ï¼ˆä½“èª¿ä¸è‰¯ã€å¯ä¸è¶³ãªã©ï¼‰..."})]}),R.jsx("button",{type:"submit",disabled:s,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s?"ä¿å­˜ä¸­...":"ä½“æ¸©ã‚’ä¿å­˜"})]})}function xs({userId:e,days:t=90}){const{cycles:r,getCurrentCyclePhase:a}=Gr(e),{temperatures:m}=os(e),g=a(),h=(()=>{const e=new Date,a=new Date(e);a.setDate(a.getDate()-t);const s=new Map;for(let t=new Date(a);t<=e;t.setDate(t.getDate()+1)){const e=Y(t);s.set(e,{date:e,displayDate:`${t.getMonth()+1}/${t.getDate()}`,temperature:null,cyclePhase:null})}return m.forEach(e=>{const t=s.get(e.measurement_date);t&&(t.temperature=Number(e.temperature_celsius))}),r.forEach(t=>{const a=new Date(t.cycle_start_date),n=t.cycle_end_date?new Date(t.cycle_end_date):e;for(let l=new Date(a);l<=n&&l<=e;l.setDate(l.getDate()+1)){const t=Y(l),a=s.get(t);if(a){r.find(t=>{const r=new Date(t.cycle_start_date+"T00:00:00"),a=t.cycle_end_date?new Date(t.cycle_end_date+"T00:00:00"):e;return l>=r&&l<=a})&&(a.cyclePhase=1)}}}),Array.from(s.values())})();return R.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx(Ve,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),R.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã¨ä½“æ¸©"})]}),g&&R.jsxs("div",{className:"text-sm",children:[R.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º: "}),R.jsx("span",{className:`font-semibold capitalize ${(e=>{switch(e){case"menstrual":return"text-red-600 dark:text-red-400";case"follicular":return"text-green-600 dark:text-green-400";case"ovulatory":return"text-yellow-600 dark:text-yellow-400";case"luteal":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}})(g.phase)}`,children:g.phase})]})]}),R.jsx(s,{width:"100%",height:400,children:R.jsxs(n,{data:h,children:[R.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),R.jsx(i,{dataKey:"displayDate",stroke:"#6B7280",style:{fontSize:"12px"}}),R.jsx(d,{yAxisId:"temp",domain:[35.5,37.5],stroke:"#3B82F6",style:{fontSize:"12px"},label:{value:"ä½“æ¸©ï¼ˆâ„ƒï¼‰",angle:-90,position:"insideLeft"}}),R.jsx(d,{yAxisId:"cycle",orientation:"right",domain:[0,1],ticks:[0,1],stroke:"#EC4899",style:{fontSize:"12px"},label:{value:"å‘¨æœŸ",angle:90,position:"insideRight"}}),R.jsx(o,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px",color:"#F3F4F6"},formatter:(e,t)=>"temperature"===t?[e?`${e.toFixed(2)}â„ƒ`:"ãƒ‡ãƒ¼ã‚¿ãªã—","ä½“æ¸©"]:"cyclePhase"===t?[e?"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–":"å‘¨æœŸãªã—","å‘¨æœŸ"]:[e,t]}),R.jsx(u,{}),R.jsx(c,{yAxisId:"temp",y:36.5,stroke:"#6B7280",strokeDasharray:"3 3"}),R.jsx(x,{yAxisId:"temp",type:"monotone",dataKey:"temperature",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",r:3},connectNulls:!0,name:"ä½“æ¸©"}),R.jsx(x,{yAxisId:"cycle",type:"stepAfter",dataKey:"cyclePhase",stroke:"#EC4899",strokeWidth:2,dot:!1,name:"æœˆçµŒå‘¨æœŸ"})]})}),R.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),R.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"æœˆçµŒæœŸ"})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),R.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"åµèƒæœŸ"})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),R.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"æ’åµæœŸ"})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),R.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"é»„ä½“æœŸ"})]})]})]})}function ms({userId:e}){const{cycles:t,getCurrentCyclePhase:a}=Gr(e),[s,n]=r.useState(new Date),l=a(),i=new Date;i.setHours(0,0,0,0);let d=null;if(l){const e=new Date(l.cycle.cycle_start_date);e.setHours(0,0,0,0),d=Math.floor((i.getTime()-e.getTime())/864e5)+1}const o=(()=>{const e=s.getFullYear(),t=s.getMonth(),r=new Date(e,t,1),a=new Date(e,t+1,0),n=new Date(r);n.setDate(n.getDate()-r.getDay());const l=[],i=new Date(n);for(;i<=a||0!==i.getDay();)l.push(new Date(i)),i.setDate(i.getDate()+1);return l})(),c=(()=>{if(0===t.length)return null;const e=[...t].sort((e,t)=>new Date(t.cycle_start_date).getTime()-new Date(e.cycle_start_date).getTime()),r=e[0];if(!r.cycle_end_date)return null;const a=e.reduce((e,t)=>{if(!t.cycle_end_date)return e;const r=new Date(t.cycle_start_date),a=new Date(t.cycle_end_date);return e+Math.floor((a.getTime()-r.getTime())/864e5)},0)/e.filter(e=>e.cycle_end_date).length,s=new Date(r.cycle_end_date),n=new Date(s);n.setDate(n.getDate()+1);const l=new Date(n);return l.setDate(l.getDate()+Math.round(a)),{start:n,end:l}})(),x=e=>{switch(e){case"menstrual":return"bg-red-100 dark:bg-red-900/30 border-red-400 dark:border-red-600";case"follicular":return"bg-green-100 dark:bg-green-900/30 border-green-400 dark:border-green-600";case"ovulatory":return"bg-yellow-100 dark:bg-yellow-900/30 border-yellow-400 dark:border-yellow-600";case"luteal":return"bg-blue-100 dark:bg-blue-900/30 border-blue-400 dark:border-blue-600";default:return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}};return R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(Me,{className:"w-6 h-6 text-pink-600 dark:text-pink-400"}),R.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:()=>{n(new Date(s.getFullYear(),s.getMonth()-1))},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:R.jsx(ze,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),R.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white min-w-[120px] text-center",children:[s.getFullYear(),"å¹´ ",s.getMonth()+1,"æœˆ"]}),R.jsx("button",{onClick:()=>{n(new Date(s.getFullYear(),s.getMonth()+1))},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:R.jsx(qe,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})]}),l&&R.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-lg border border-pink-200 dark:border-pink-800",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º"}),R.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[(e=>{switch(e){case"menstrual":return"æœˆçµŒæœŸ";case"follicular":return"åµèƒæœŸ";case"ovulatory":return"æ’åµæœŸ";case"luteal":return"é»„ä½“æœŸ";default:return""}})(l.phase)," - å‘¨æœŸ",d??"-","æ—¥ç›®"]})]}),"follicular"===l.phase||"ovulatory"===l.phase?R.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[R.jsx(Vt,{className:"w-5 h-5"}),R.jsx("span",{className:"text-sm font-medium",children:"ãƒã‚¤ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœŸ"})]}):"luteal"===l.phase||"menstrual"===l.phase?R.jsxs("div",{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:[R.jsx(fe,{className:"w-5 h-5"}),R.jsx("span",{className:"text-sm font-medium",children:"æ€ªæˆ‘ãƒªã‚¹ã‚¯æ³¨æ„"})]}):null]})}),c&&R.jsx("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:R.jsxs("div",{className:"flex items-start gap-2",children:[R.jsx(lt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5"}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"æ¬¡å›ã®å‘¨æœŸäºˆæ¸¬"}),R.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[c.start.getMonth()+1,"æœˆ",c.start.getDate(),"æ—¥ -"," ",c.end.getMonth()+1,"æœˆ",c.end.getDate(),"æ—¥ ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã®ç‚¹ç·šæ ã§è¡¨ç¤ºï¼‰"]})]})]})}),R.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map((e,t)=>R.jsx("div",{className:"text-center text-sm font-semibold py-2 "+(0===t?"text-red-600 dark:text-red-400":6===t?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"),children:e},e))}),R.jsx("div",{className:"grid grid-cols-7 gap-1",children:o.map((e,r)=>{const a=(e=>{for(const r of t){const t=new Date(r.cycle_start_date),a=r.cycle_end_date?new Date(r.cycle_end_date):new Date;if(e>=t&&e<=a){const r=Math.floor((e.getTime()-t.getTime())/864e5)+1;let a=null,s=!1,n=!1;return r>=1&&r<=5?(a="menstrual",n=!0):r>=6&&r<=13?(a="follicular",s=!0):r>=14&&r<=16?(a="ovulatory",s=!0):r>=17&&r<=28&&(a="luteal",n=!0),{phase:a,day:r,isHighPerformance:s,isInjuryRisk:n}}}return{phase:null,day:0,isHighPerformance:!1,isInjuryRisk:!1}})(e),n=(l=e,!!c&&l>=c.start&&l<=c.end);var l;const d=e.getTime()===i.getTime(),o=e.getMonth()===s.getMonth();return R.jsx("div",{className:`\n                relative aspect-square p-1 border rounded-lg transition-all\n                ${x(a.phase)}\n                ${n?"border-dashed border-2":"border"}\n                ${o?"":"opacity-40"}\n                ${d?"ring-2 ring-purple-500 dark:ring-purple-400":""}\n              `,children:R.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[R.jsx("span",{className:"text-sm font-medium "+(d?"text-purple-700 dark:text-purple-300 font-bold":a.phase?"text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"),children:e.getDate()}),a.phase&&R.jsxs("div",{className:"flex gap-0.5 mt-1",children:[a.isHighPerformance&&R.jsx(Vt,{className:"w-3 h-3 text-green-600 dark:text-green-400"}),a.isInjuryRisk&&R.jsx(fe,{className:"w-3 h-3 text-orange-600 dark:text-orange-400"})]}),n&&!a.phase&&R.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium mt-1",children:"äºˆæ¸¬"})]})},r)})}),R.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.jsxs("div",{className:"space-y-2",children:[R.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"å‘¨æœŸãƒ•ã‚§ãƒ¼ã‚º"}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-4 h-4 rounded bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-600"}),R.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"æœˆçµŒæœŸï¼ˆ1-5æ—¥ç›®ï¼‰"})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-4 h-4 rounded bg-green-100 dark:bg-green-900/30 border border-green-400 dark:border-green-600"}),R.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"åµèƒæœŸï¼ˆ6-13æ—¥ç›®ï¼‰"})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-4 h-4 rounded bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600"}),R.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"æ’åµæœŸï¼ˆ14-16æ—¥ç›®ï¼‰"})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-4 h-4 rounded bg-blue-100 dark:bg-blue-900/30 border border-blue-400 dark:border-blue-600"}),R.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"é»„ä½“æœŸï¼ˆ17-28æ—¥ç›®ï¼‰"})]})]}),R.jsxs("div",{className:"space-y-2",children:[R.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¬ã‚¤ãƒ‰"}),R.jsxs("div",{className:"flex items-start gap-2 bg-green-50 dark:bg-green-900/20 p-2 rounded",children:[R.jsx(Vt,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5"}),R.jsxs("div",{className:"text-xs text-green-800 dark:text-green-200",children:[R.jsx("p",{className:"font-medium mb-1",children:"ãƒã‚¤ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœŸ"}),R.jsx("p",{children:"åµèƒæœŸãƒ»æ’åµæœŸï¼šé«˜å¼·åº¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«é©ã—ãŸæ™‚æœŸ"})]})]}),R.jsxs("div",{className:"flex items-start gap-2 bg-orange-50 dark:bg-orange-900/20 p-2 rounded",children:[R.jsx(fe,{className:"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5"}),R.jsxs("div",{className:"text-xs text-orange-800 dark:text-orange-200",children:[R.jsx("p",{className:"font-medium mb-1",children:"æ€ªæˆ‘ãƒªã‚¹ã‚¯æ³¨æ„æœŸ"}),R.jsx("p",{children:"æœˆçµŒæœŸãƒ»é»„ä½“æœŸï¼šç„¡ç†ã›ãšèª¿æ•´ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ¨å¥¨"})]})]})]})]})]})}function us(e,t,a){const[s,n]=r.useState([]),[l,i]=r.useState([]),[d,o]=r.useState([]),[c,x]=r.useState([]),[m,u]=r.useState(!0),[g,h]=r.useState(null);r.useEffect(()=>{b()},[]),r.useEffect(()=>{p()},[t]),r.useEffect(()=>{e&&y()},[e,t]);const b=async()=>{try{const{data:e,error:t}=await q.from("performance_categories").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;n(e||[])}catch(e){console.error("Error fetching categories:",e),h("ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}},p=async()=>{try{let e=q.from("performance_test_types").select("\n          *,\n          performance_categories:category_id (\n            id,\n            name,\n            display_name\n          )\n        ").eq("is_active",!0);if(t){const{data:r}=await q.from("performance_categories").select("id").eq("name",t).single();r&&(e=e.eq("category_id",r.id))}const{data:r,error:a}=await e.order("sort_order");if(a)throw a;i(r||[])}catch(e){console.error("Error fetching test types:",e),h("æ¸¬å®šç¨®ç›®ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}},y=async()=>{try{u(!0);let r=q.from("performance_records").select("\n          *,\n          performance_test_types:test_type_id (\n            id,\n            category_id,\n            name,\n            display_name,\n            description,\n            unit,\n            higher_is_better,\n            fields,\n            sort_order,\n            is_active,\n            created_at\n          )\n      ").eq("user_id",e).order("date",{ascending:!1});if(t){const{data:e}=await q.from("performance_categories").select("id").eq("name",t).maybeSingle();if(e){const{data:t}=await q.from("performance_test_types").select("id").eq("category_id",e.id);t&&t.length>0&&(r=r.in("test_type_id",t.map(e=>e.id)))}}const{data:a,error:s}=await r;if(s)throw s;const n=(a||[]).map(e=>({...e,test_type:e.performance_test_types}));o(n),f(n)}catch(r){console.error("Error fetching records:",r),h("è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{u(!1)}},f=e=>{const t=new Map;e.forEach(e=>{if(!e.test_type)return;const r=e.values.primary_value,a="string"==typeof r?parseFloat(r):r;if(null==a||isNaN(a))return;const s=t.get(e.test_type_id);(!s||(e.test_type.higher_is_better?a>s.value:a<s.value))&&t.set(e.test_type_id,{test_type_id:e.test_type_id,test_name:e.test_type.name,test_display_name:e.test_type.display_name,value:a,date:e.date,record:e})}),x(Array.from(t.values()))},j=(e,t,r)=>{const a=c.find(t=>t.test_type_id===e);return!a||(r?t>a.value:t<a.value)},v=e=>d.filter(t=>t.test_type_id===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return{categories:s,testTypes:l,records:d,personalBests:c,loading:m,error:g,addRecord:async t=>{try{const{data:r,error:a}=await q.from("performance_records").insert([{user_id:e,...t}]).select().single();if(a)throw a;await y();const s=l.find(e=>e.id===t.test_type_id),n=t.values.primary_value;return{data:r,isNewPersonalBest:(s&&j(t.test_type_id,n,s.higher_is_better))??!1}}catch(r){throw console.error("Error adding record:",r),r}},updateRecord:async(t,r)=>{try{const{data:a,error:s}=await q.from("performance_records").update(r).eq("id",t).eq("user_id",e).select().single();if(s)throw s;return await y(),a}catch(a){throw console.error("Error updating record:",a),a}},deleteRecord:async t=>{try{const{error:r}=await q.from("performance_records").delete().eq("id",t).eq("user_id",e);if(r)throw r;await y()}catch(r){throw console.error("Error deleting record:",r),r}},checkIfPersonalBest:j,checkExistingRecord:async(t,r)=>{try{const{data:a,error:s}=await q.from("performance_records").select("\n          *,\n          performance_test_types:test_type_id (\n            id,\n            name,\n            display_name,\n            unit,\n            higher_is_better,\n            fields\n          )\n        ").eq("user_id",e).eq("test_type_id",t).eq("date",r).maybeSingle();if(s)throw s;return a?{...a,test_type:a.performance_test_types}:null}catch(a){return console.error("Error checking existing record:",a),null}},getRecordsByTestType:v,getPersonalBest:e=>c.find(t=>t.test_type_id===e),getImprovementPercentage:(e,t)=>{const r=v(e);if(r.length<2)return null;const a=r[r.length-1].values.primary_value;return a&&0!==a?(t-a)/Math.abs(a)*100:null},refresh:y}}function gs({userId:e}){const{cycles:t,getCyclePhase:r}=Gr(e),{records:a}=Hr(e),{records:n}=us(e,"jump"),c=(()=>{const e={menstrual:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},follicular:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},ovulatory:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0},luteal:{count:0,totalLoad:0,totalRPE:0,performances:0,totalScore:0}};return a.forEach(a=>{const s=new Date(a.date);for(const n of t){const t=r(n,s);if(t&&t in e){e[t].count++,e[t].totalLoad+=a.load,e[t].totalRPE+=a.rpe;break}}}),n.forEach(a=>{const s=new Date(a.test_date);for(const n of t){const t=r(n,s);if(t&&t in e){e[t].performances++,e[t].totalScore+=a.score;break}}}),Object.entries(e).map(([e,t])=>({phase:"menstrual"===e?"æœˆçµŒæœŸ":"follicular"===e?"åµèƒæœŸ":"ovulatory"===e?"æ’åµæœŸ":"é»„ä½“æœŸ",avgLoad:t.count>0?(t.totalLoad/t.count).toFixed(1):0,avgRPE:t.count>0?(t.totalRPE/t.count).toFixed(1):0,avgPerformance:t.performances>0?(t.totalScore/t.performances).toFixed(1):0,sessionCount:t.count}))})(),x=c.some(e=>e.sessionCount>0),m=(()=>{var e,t;if(!x)return[];const r=[],a=[...c].sort((e,t)=>Number(t.avgLoad)-Number(e.avgLoad)),s=[...c].sort((e,t)=>Number(t.avgPerformance)-Number(e.avgPerformance));(null==(e=a[0])?void 0:e.avgLoad)>0&&r.push(`${a[0].phase}ã«æœ€ã‚‚é«˜ã„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ï¼ˆå¹³å‡${a[0].avgLoad}ï¼‰`),(null==(t=s[0])?void 0:t.avgPerformance)>0&&r.push(`${s[0].phase}ã«æœ€é«˜ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹`);const n=c.find(e=>"Follicular"===e.phase),l=c.find(e=>"Luteal"===e.phase);return n&&l&&Number(n.avgRPE)<Number(l.avgRPE)&&r.push("åµèƒæœŸã¯ä¸»è¦³çš„é‹å‹•å¼·åº¦ãŒä½ã„ - ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å¼·åº¦ã‚’ä¸Šã’ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„"),r})();return R.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[R.jsx(Vt,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),R.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç›¸é–¢"})]}),x?R.jsxs(R.Fragment,{children:[R.jsx(s,{width:"100%",height:300,children:R.jsxs(p,{data:c,children:[R.jsx(l,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),R.jsx(i,{dataKey:"phase",stroke:"#6B7280",style:{fontSize:"12px"}}),R.jsx(d,{stroke:"#6B7280",style:{fontSize:"12px"}}),R.jsx(o,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px",color:"#F3F4F6"}}),R.jsx(u,{}),R.jsx(y,{dataKey:"avgLoad",fill:"#3B82F6",name:"å¹³å‡è² è·"}),R.jsx(y,{dataKey:"avgRPE",fill:"#EF4444",name:"å¹³å‡RPE"}),R.jsx(y,{dataKey:"avgPerformance",fill:"#10B981",name:"å¹³å‡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹"})]})}),m.length>0&&R.jsxs("div",{className:"mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[R.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"ã‚¤ãƒ³ã‚µã‚¤ãƒˆ"}),R.jsx("ul",{className:"space-y-2 text-sm text-purple-800 dark:text-purple-200",children:m.map((e,t)=>R.jsxs("li",{className:"flex items-start gap-2",children:[R.jsx("span",{className:"text-purple-500 mt-1",children:"â€¢"}),R.jsx("span",{children:e})]},t))})]}),R.jsx("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:R.jsxs("p",{children:[a.length,"å›ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¨",n.length,"å›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã«åŸºã¥ã"]})})]}):R.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[R.jsx(pe,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),R.jsx("p",{children:"ç›¸é–¢ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚"}),R.jsx("p",{className:"text-sm mt-2",children:"å‘¨æœŸã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã—ç¶šã‘ã¦ãã ã•ã„ï¼"})]})]})}function hs({userId:e,gender:t}){const[a,s]=r.useState("calendar");return"female"!==t?R.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6 text-center",children:[R.jsx(Ve,{className:"w-12 h-12 text-yellow-600 dark:text-yellow-400 mx-auto mb-4"}),R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"ã“ã®æ©Ÿèƒ½ã¯å¥³æ€§ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨ã§ã™"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã§æ€§åˆ¥ã‚’ã€Œå¥³æ€§ã€ã«è¨­å®šã™ã‚‹ã¨ã€æœˆçµŒå‘¨æœŸãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚"})]}):R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[R.jsx(ds,{userId:e}),R.jsx(cs,{userId:e})]}),R.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border dark:border-gray-700",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"å‘¨æœŸã®è¡¨ç¤ºå½¢å¼"}),R.jsxs("div",{className:"flex gap-2",children:[R.jsx("button",{onClick:()=>s("calendar"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("calendar"===a?"bg-pink-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"}),R.jsx("button",{onClick:()=>s("chart"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("chart"===a?"bg-pink-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"ã‚°ãƒ©ãƒ•"})]})]}),"calendar"===a?R.jsx(ms,{userId:e}):R.jsx(xs,{userId:e,days:90}),R.jsx(gs,{userId:e})]})}function bs(e){try{return localStorage.getItem(e)}catch{return null}}function ps(e,t){try{localStorage.setItem(e,t)}catch{}}function ys(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function fs(e){const{userId:t,keyPrefix:a="athlete",thresholdDays:s=3,enableDailyTip:n=!0}=e,l=r.useMemo(()=>({lastOpenAt:`bekuta:${a}:last_open_at:${t}`,lastDailyShown:`bekuta:${a}:last_daily_tip_shown:${t}`,dismissedToday:`bekuta:${a}:dismissed_today:${t}`}),[a,t]),[i,d]=r.useState({open:!1,mode:"none",daysAway:0});r.useEffect(()=>{const e=new Date,t=ys(e);if(bs(l.dismissedToday)===t)return void ps(l.lastOpenAt,e.toISOString());const r=bs(l.lastOpenAt),a=bs(l.lastDailyShown);let i="none",o=0;if(r){o=function(e,t){const r=t.getTime()-e.getTime();return Math.floor(r/864e5)}(new Date(r),e),Number.isFinite(o)&&o>=s&&(i="welcome_back")}"none"===i&&n&&a!==t&&(i="daily_tip"),"none"!==i&&(d({open:!0,mode:i,daysAway:o}),"daily_tip"===i&&ps(l.lastDailyShown,t)),ps(l.lastOpenAt,e.toISOString())},[l,s,n]);return{...i,dismiss:()=>{const e=ys(new Date);ps(l.dismissedToday,e),d(e=>({...e,open:!1,mode:"none"}))}}}function js(e){const{open:t,mode:r,daysAway:a=0,title:s,message:n,primaryLabel:l,onClose:i}=e;if(!t)return null;const d="welcome_back"===r?"ãŠã‹ãˆã‚Šãªã•ã„":"ä»Šæ—¥ã®ä¸€è¨€",o="welcome_back"===r?"ä»Šæ—¥ã¯ã“ã“ã‹ã‚‰":"OK";return R.jsxs("div",{className:"fixed inset-0 z-[60] flex items-start justify-center px-4 pt-16",children:[R.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:i}),R.jsxs("div",{className:"relative w-full max-w-sm rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 shadow-2xl p-4",children:[R.jsx("button",{type:"button",onClick:i,className:"absolute right-3 top-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"é–‰ã˜ã‚‹",children:R.jsx(sr,{className:"w-5 h-5 text-gray-500"})}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"p-2 rounded-xl bg-blue-50 dark:bg-blue-900/20",children:R.jsx(It,{className:"w-5 h-5 text-blue-600 dark:text-blue-300"})}),R.jsxs("div",{className:"min-w-0",children:[R.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:s??d}),"welcome_back"===r&&R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ã‹ã‚‰ ",a,"æ—¥"]})]})]}),R.jsx("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-200 whitespace-pre-line",children:n}),R.jsxs("div",{className:"mt-4 flex gap-2",children:[R.jsx("button",{type:"button",onClick:i,className:"flex-1 rounded-xl bg-blue-600 text-white py-2.5 text-sm font-semibold active:opacity-90",children:l??o}),R.jsx("button",{type:"button",onClick:i,className:"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-200",children:"é–‰ã˜ã‚‹"})]})]})]})}const vs={preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:80,maxTagHints:1},ws={off:"å›å¾©ãƒ•ã‚§ãƒ¼ã‚ºã€‚ç¡çœ ã¨ç–²åŠ´æŠœãã‚’æœ€å„ªå…ˆã«ã€‚",pre:"åœŸå°ã¥ãã‚Šãƒ•ã‚§ãƒ¼ã‚ºã€‚ãƒ•ã‚©ãƒ¼ãƒ ãƒ»åŸºç¤ã‚’å„ªå…ˆã€ä¸Šã’ã™ãæ³¨æ„ã€‚",in:"ç©ã¿ä¸Šã’ãƒ•ã‚§ãƒ¼ã‚ºã€‚å¼·åº¦ã®æ³¢ã‚’æ•´ãˆã€ç¶™ç¶šã§ãã‚‹è² è·ã§ã€‚",peak:"ä»•ä¸Šã’ãƒ•ã‚§ãƒ¼ã‚ºã€‚è³ªã‚’æœ€å¤§åŒ–ã—ã¤ã¤ã€ç¡çœ ã¨ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’æœ€å„ªå…ˆã«ã€‚",transition:"åˆ‡ã‚Šæ›¿ãˆãƒ•ã‚§ãƒ¼ã‚ºã€‚ç–²åŠ´ç®¡ç†ã¨æ¬¡ã®æº–å‚™ã‚’ä¸å¯§ã«ã€‚",unknown:"ãƒ•ã‚§ãƒ¼ã‚ºæœªè¨­å®šã€‚ä»Šã®ç‹™ã„ã‚’ç¢ºèªã—ã¦ã€ç„¡ç†ã®ãªã„è¨ˆç”»ã§é€²ã‚ã‚ˆã†ã€‚"},Ns=[{match:e=>/ãƒ•ã‚©ãƒ¼ãƒ |å§¿å‹¢|åŸºç¤|åŸºæœ¬|å‹•ä½œ|ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯|æŠ€è¡“/i.test(e),text:"ã€Œé€Ÿã•ã€ã‚ˆã‚Šã€Œå½¢ã€ã€‚ç›´ã™ç‚¹ã¯1ã¤ã«çµã‚ã†ã€‚"},{match:e=>/å¯å‹•åŸŸ|ãƒ¢ãƒ“ãƒªãƒ†ã‚£|æŸ”è»Ÿ|ã‚¹ãƒˆãƒ¬ãƒƒãƒ|é–¢ç¯€/i.test(e),text:"å¯å‹•åŸŸã¯â€œæ¯æ—¥å°‘ã—â€ã€‚ç—›ã¿ã‚¼ãƒ­ã§ç©ã‚€ã€‚"},{match:e=>/ä½“å¹¹|ã‚³ã‚¢|è…¹åœ§|ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£|å®‰å®š/i.test(e),text:"ä½“å¹¹ã¯â€œå›ºã‚ã‚‹â€ã‚ˆã‚Šâ€œæ”¯ãˆã‚‹â€ã€‚å‘¼å¸ã‚‚ã‚»ãƒƒãƒˆã§ã€‚"},{match:e=>/å‘¼å¸|ãƒ–ãƒ¬ã‚¹|æ¨ªéš”è†œ/i.test(e),text:"å‘¼å¸ã‚’æ•´ãˆã‚‹ã¨å‹•ãã‚‚æ•´ã†ã€‚æœ€åˆã®1åˆ†ã§ãƒªã‚»ãƒƒãƒˆã€‚"},{match:e=>/ç­‹åŠ›|ç­‹è‚¥å¤§|ã‚¦ã‚¨ã‚¤ãƒˆ|ã‚¦ã‚§ã‚¤ãƒˆ|strength|S&C/i.test(e),text:"é‡ã‚ˆã‚Šè³ªã€‚ãƒ•ã‚©ãƒ¼ãƒ ã¨å¯å‹•åŸŸãŒå´©ã‚ŒãŸã‚‰æ­¢ã‚ã‚‹ã€‚"},{match:e=>/ãƒ‘ãƒ¯ãƒ¼|çˆ†ç™º|ç¬ç™º|ãƒ‘ãƒ¯ãƒ¼ç³»|power/i.test(e),text:"å‡ºåŠ›ã¯â€œçŸ­ãæ¿ƒãâ€ã€‚å›å¾©ã¾ã§å«ã‚ã¦1ã‚»ãƒƒãƒˆã€‚"},{match:e=>/ãƒ—ãƒ©ã‚¤ã‚ª|ãƒ—ãƒ©ã‚¤ã‚ªãƒ¡ãƒˆãƒªã‚¯ã‚¹|plyo|ã‚¸ãƒ£ãƒ³ãƒ—/i.test(e),text:"è·³ã¶å‰ã«ç€åœ°ã€‚é™ã‹ãªç€åœ°ãŒã§ããŸã‚‰å¼·åº¦UPã€‚"},{match:e=>/ã‚¹ãƒ—ãƒªãƒ³ãƒˆ|ã‚¹ãƒ”ãƒ¼ãƒ‰|speed|åŠ é€Ÿ|ãƒˆãƒƒãƒ—ã‚¹ãƒ”ãƒ¼ãƒ‰/i.test(e),text:"å‡ºåŠ›æ—¥ã¯å›å¾©ã¨ã‚»ãƒƒãƒˆã€‚æ¬¡ã®æ—¥ã«ç–²åŠ´ã‚’æ®‹ã•ãªã„ã€‚"},{match:e=>/æ¸›é€Ÿ|ãƒ–ãƒ¬ãƒ¼ã‚­|åœæ­¢|decel/i.test(e),text:"æ¸›é€Ÿã¯ã‚±ã‚¬äºˆé˜²ã®è¦ã€‚å°ã•ãæ­¢ã¾ã‚Œã‚‹å¼·ã•ã‚’ã€‚"},{match:e=>/åˆ‡ã‚Šè¿”ã—|æ–¹å‘è»¢æ›|ã‚¢ã‚¸ãƒªãƒ†ã‚£|agility|ã‚¿ãƒ¼ãƒ³/i.test(e),text:"æ›²ãŒã‚‹å‰ã«æ¸›é€Ÿã€‚å§¿å‹¢ãŒé«˜ã„ãªã‚‰ä¸€æ®µä¸‹ã’ã‚‹ã€‚"},{match:e=>/åå¿œ|ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³|åˆ¤æ–­|reaction/i.test(e),text:"åå¿œã¯â€œå…ˆã«è¦‹ã‚‹â€ã€‚è¦–ç·šã¨æº–å‚™å§¿å‹¢ã‚’ãã‚ãˆã‚‹ã€‚"},{match:e=>/ãƒªã‚ºãƒ |ãƒ†ãƒ³ãƒ|ãƒ”ãƒƒãƒ/i.test(e),text:"ãƒªã‚ºãƒ ãŒå´©ã‚ŒãŸã‚‰ä¸€åº¦æ­¢ã‚ã‚‹ã€‚æ•´ãˆã¦ã‹ã‚‰å†é–‹ã€‚"},{match:e=>/æŒä¹…|ã‚¹ã‚¿ãƒŸãƒŠ|aerobic|endurance|æœ‰é…¸ç´ /i.test(e),text:"ç–²åŠ´ã®æºœã‚ã™ãã«æ³¨æ„ã€‚ç¿Œæ—¥ã«èµ°ã‚Œã‚‹å¼·åº¦ã§ã€‚"},{match:e=>/ç„¡é…¸ç´ |ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«|ä¹³é…¸|anaerobic/i.test(e),text:"è¿½ã„è¾¼ã¿ã™ãæ³¨æ„ã€‚è³ªã®è½ã¡å§‹ã‚ãŒâ€œçµ‚äº†ã‚µã‚¤ãƒ³â€ã€‚"},{match:e=>/å›å¾©|ãƒªã‚«ãƒãƒªãƒ¼|ç–²åŠ´æŠœã|ä¼‘é¤Š|ãƒ¬ã‚¹ãƒˆ/i.test(e),text:"å›å¾©ã¯ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€‚ç¡çœ ãƒ»æ „é¤Šãƒ»æ°´åˆ†ã‚’å…ˆã«æ•´ãˆã‚‹ã€‚"},{match:e=>/è‚¡é–¢ç¯€|ãƒ’ãƒƒãƒ—|éª¨ç›¤/i.test(e),text:"è‚¡é–¢ç¯€ãŒå‹•ãã¨å…¨èº«ãŒè»½ã„ã€‚è©°ã¾ã‚Šæ„Ÿã¯è¦èª¿æ•´ã€‚"},{match:e=>/è¶³é¦–|ã‚¢ãƒ³ã‚¯ãƒ«|ãµãã‚‰ã¯ã|ã‚¢ã‚­ãƒ¬ã‚¹/i.test(e),text:"è¶³é¦–ãŒç¡¬ã„æ—¥ã¯ç„¡ç†ã«ä¸Šã’ãªã„ã€‚æ¥åœ°ã®è³ªã‚’å„ªå…ˆã€‚"},{match:e=>/è†|ãƒ‹ãƒ¼|è†ç—›/i.test(e),text:"è†ã¯çµæœã€‚è‚¡é–¢ç¯€ã¨è¶³éƒ¨ã®ä½ç½®ã‚’å…ˆã«æ•´ãˆã‚‹ã€‚"},{match:e=>/ãƒãƒ |ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°|è‚‰é›¢ã‚Œ/i.test(e),text:"ãƒãƒ ã¯â€œå¼µã‚Šå§‹ã‚â€ã§æ­¢ã‚ã‚‹ã€‚æ—©ã‚ã®ã‚±ã‚¢ãŒå‹ã¡ã€‚"},{match:e=>/è‚©|è‚©ç”²éª¨|ã‚¹ã‚­ãƒ£ãƒ—ãƒ©|èƒ¸éƒ­|T-spine|èƒ¸æ¤/i.test(e),text:"è‚©ã¯èƒ¸éƒ­ã‹ã‚‰ã€‚ä¸Šã’ã‚‹å‰ã«å›ã™ãƒ»åºƒã’ã‚‹ã€‚"},{match:e=>/RPE|ä¸»è¦³|ãã¤ã•/i.test(e),text:"ä¸»è¦³ã¯æ­£è§£ã€‚ã„ã¤ã‚‚ã‚ˆã‚Šé‡ã„ãªã‚‰è² è·ã‚’ä¸‹ã’ã‚‹åˆ¤æ–­ã‚‚â—ã€‚"},{match:e=>/FTT|ãƒ‹ãƒ¥ãƒ¼ãƒ­|åå¿œãƒ†ã‚¹ãƒˆ/i.test(e),text:"åå¿œãŒéˆã„æ—¥ã¯â€œé‡ã‚ˆã‚Šè³ªâ€ã€‚ç¥çµŒã®å›å¾©ã‚’å„ªå…ˆã€‚"},{match:e=>/ç¡çœ |å¯ä¸è¶³|çœ ã„/i.test(e),text:"å¯ä¸è¶³ã®æ—¥ã¯ä¸Šã’ã™ãæ³¨æ„ã€‚ç²¾åº¦ã¨å›å¾©ã‚’æœ€å„ªå…ˆã€‚"},{match:e=>/æ „é¤Š|è£œé£Ÿ|ã‚¿ãƒ³ãƒ‘ã‚¯|ç‚­æ°´åŒ–ç‰©|æ°´åˆ†/i.test(e),text:"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã€‚ã¾ãšå›å¾©ã®åœŸå°ã‹ã‚‰ã€‚"},{match:e=>/é›†ä¸­|ãƒ¡ãƒ³ã‚¿ãƒ«|æ°—æŒã¡|ãƒ¢ãƒãƒ™/i.test(e),text:"é›†ä¸­ãŒåˆ‡ã‚Œã‚‹å‰ã«åŒºåˆ‡ã‚‹ã€‚çŸ­ãã¦ã‚‚é«˜å“è³ªãŒå‹ã¡ã€‚"},{match:e=>/è©¦åˆ|ã‚²ãƒ¼ãƒ |å¤§ä¼š|æœ¬ç•ª/i.test(e),text:"æœ¬ç•ªã¯â€œä»•ä¸ŠãŒã‚Šâ€ãŒå…¨ã¦ã€‚ç–²åŠ´ã‚’æ®‹ã•ãªã„èª¿æ•´ã¸ã€‚"},{match:e=>/èª¿æ•´|ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°|è»½ã‚/i.test(e),text:"è»½ãã¦ã‚‚OKã€‚ã‚­ãƒ¬ã‚’å‡ºã™å‹•ãã ã‘æ®‹ã™ã€‚"},{match:e=>/ç¢ºèª|å¾©ç¿’|è¦‹ç›´ã—/i.test(e),text:"â€œã§ããŸ/ã§ããªã„â€ã‚ˆã‚Šâ€œæ°—ã¥ã‘ãŸã‹â€ã€‚ãã‚ŒãŒæˆé•·ã€‚"},{match:e=>/ç©ã¿ä¸Šã’|ç¶™ç¶š|ç¿’æ…£/i.test(e),text:"ç¶šã‘ã‚‹è¨­è¨ˆãŒæœ€å¼·ã€‚æ˜æ—¥ã‚‚ã§ãã‚‹ä½™ç™½ã‚’æ®‹ãã†ã€‚"}];function ks(e,t,r,a){const s={...vs,...a??{}},n=ws[e]??ws.unknown,l=((e,t=1)=>{const r=Array.isArray(e)?e:[],a=[];for(const s of r){const e=Ns.find(e=>e.match(s));if(e&&!a.includes(e.text)&&a.push(e.text),a.length>=Math.max(0,t))break}return a.length?a.join(" "):""})(t,s.maxTagHints),i="string"==typeof r&&r.trim().length>0;if(s.preferNote&&i){const e=((e,t)=>{const r=(e=>e.replace(/\s+/g," ").replace(/ã€€+/g," ").trim())(e);return r.length<=t?r:r.slice(0,Math.max(0,t-1))+"â€¦"})(r,s.maxNoteChars);return s.appendTagHintsWhenNote&&l?`${e} ${l}`:e}return l?`${n} ${l}`:n}function _s(e){return e?e.replace(/åœŸå°ã¥ãã‚Šã®é€±/g,"åœŸå°ã¥ãã‚Šã®æœŸé–“").replace(/ç©ã¿ä¸Šã’ã®é€±/g,"ç©ã¿ä¸Šã’ã®æœŸé–“").replace(/ä»•ä¸Šã’ã®é€±/g,"ä»•ä¸Šã’ã®æœŸé–“").replace(/åˆ‡ã‚Šæ›¿ãˆã®é€±/g,"åˆ‡ã‚Šæ›¿ãˆã®æœŸé–“").replace(/ä»Šé€±/g,"ã“ã®æœŸé–“").replace(/é€±/g,"æœŸé–“"):e}function Cs(e,t){return e?e.length<=t?e:e.slice(0,Math.max(0,t-1))+"â€¦":e}const Ss={"pre:åŸºç¤":{oneWord:"ğŸ§± åœŸå°ã¥ãã‚Šã®æœŸé–“ã€‚åŸºæœ¬ã‚’ä¸å¯§ã«ã€ä¸Šã’ã™ãæ³¨æ„ã€‚",training:"åœŸå°ã¥ãã‚Šï¼šãƒ•ã‚©ãƒ¼ãƒ ãƒ»åŸºç¤ã‚’å„ªå…ˆã€‚ä¸Šã’ã™ãæ³¨æ„ã€‚"},"pre:ãƒ•ã‚©ãƒ¼ãƒ ":{oneWord:"ğŸ§± ãƒ•ã‚©ãƒ¼ãƒ æœ€å„ªå…ˆã€‚é€Ÿã•ã‚ˆã‚Šâ€œè³ªâ€ã§ç©ã‚€ã€‚",training:"ãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆã€‚é€Ÿã•ã‚ˆã‚Šâ€œå†ç¾æ€§â€ã§ç©ã‚‚ã†ã€‚"},"pre:ç­‹åŠ›":{oneWord:"ğŸ§± ç­‹åŠ›ã¯ç©ã¿ä¸Šã’ã€‚è¿½ã„è¾¼ã¿ã™ããšç¶™ç¶šã§å‹ã¤ã€‚",training:"ç­‹åŠ›ã¯â€œç¶šã‘ã¦ä¼¸ã°ã™â€ã€‚ã‚„ã‚Šåˆ‡ã‚‹ã‚ˆã‚Šç¶™ç¶šã€‚"},"in:ç©ã¿ä¸Šã’":{oneWord:"ğŸ“ˆ ç©ã¿ä¸Šã’æœŸã€‚ç‹™ã„ã‚’æ±ºã‚ã¦è¨˜éŒ²ã—ã‚ˆã†ã€‚",training:"ç©ã¿ä¸Šã’ï¼šç‹™ã„ã‚’æ±ºã‚ã¦ã€ã‚„ã£ãŸå†…å®¹ã‚’æ®‹ãã†ã€‚"},"in:å¼·åº¦":{oneWord:"ğŸ“ˆ å¼·åº¦ã‚’ä½¿ã†æœŸé–“ã€‚å›å¾©ã‚‚ã‚»ãƒƒãƒˆã§è¨­è¨ˆã€‚",training:"å¼·åº¦ã‚’ä½¿ã†æ—¥ã€‚å›å¾©ï¼ˆç¡çœ /æ „é¤Šï¼‰ã‚‚ã‚»ãƒƒãƒˆã§ã€‚"},"peak:ã‚­ãƒ¬":{oneWord:"âš¡ ä»•ä¸Šã’æœŸã€‚ç–²åŠ´ã‚’æ®‹ã•ãšã‚­ãƒ¬é‡è¦–ã€‚",training:"ä»•ä¸Šã’ï¼šé‡ã‚ˆã‚Šã‚­ãƒ¬ã€‚ç–²åŠ´ã‚’æ®‹ã•ãªã„ã€‚"},"peak:è©¦åˆ":{oneWord:"âš¡ è©¦åˆãƒ¢ãƒ¼ãƒ‰ã€‚è»½ãé‹­ãã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³æœ€å„ªå…ˆã€‚",training:"è©¦åˆå„ªå…ˆï¼šè»½ãé‹­ãã€‚ã‚„ã‚Šéããªã„ã€‚",sleep:"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚",nutrition:"èƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚"},"transition:å›å¾©":{oneWord:"ğŸ”„ åˆ‡ã‚Šæ›¿ãˆæœŸã€‚æ•´ãˆã¦æ¬¡ã®ä¼¸ã³ã«ç¹‹ã’ã‚‹ã€‚",training:"æ•´ãˆã‚‹æ—¥ã€‚è»½ã‚ã§OKã€å¯å‹•åŸŸã¨å®‰å®šæ€§ã€‚"},"off:ä¼‘é¤Š":{oneWord:"ğŸŒ¿ å›å¾©ãŒä»•äº‹ã€‚ç¡çœ ã¨æ „é¤Šã§æº€ã‚¿ãƒ³ã«ã€‚",training:"å›å¾©å„ªå…ˆã€‚å¼·åº¦ã¯æ§ãˆã‚ã§OKã€‚",sleep:"ç¡çœ ã§å›å¾©ã‚’ä½œã‚‹ã€‚æ—©å¯ã‚‚æ¤œè¨ã€‚",nutrition:"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚"},"unknown:":{oneWord:"âœ… ä»Šæ—¥ã®æ„Ÿè¦šã‚’æ­£ç›´ã«è¨˜éŒ²ã—ã‚ˆã†ã€‚"}};function Ds(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),r=atob(t),a=new Uint8Array(r.length);for(let s=0;s<r.length;++s)a[s]=r.charCodeAt(s);return a}async function Ms(){if(!("serviceWorker"in navigator))return null;return await navigator.serviceWorker.register("/sw.js")}async function Es(e){var t,r;const{data:{user:a}}=await q.auth.getUser();if(!a)throw new Error("Not logged in");await Ms();const s=await async function(e){if(!("serviceWorker"in navigator)||!("PushManager"in window))throw new Error("Push not supported");const t=await navigator.serviceWorker.ready,r=await t.pushManager.getSubscription();if(r)return r;if("granted"!==await Notification.requestPermission())throw new Error("Notification permission denied");return await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ds(e)})}(e),n=s.toJSON(),l={user_id:a.id,endpoint:s.endpoint,p256dh:(null==(t=n.keys)?void 0:t.p256dh)??"",auth:(null==(r=n.keys)?void 0:r.auth)??"",user_agent:navigator.userAgent},{error:i}=await q.from("push_subscriptions").upsert(l,{onConflict:"user_id,endpoint"});if(i)throw i;return s}const Rs="BOs4Yup3ijgFAgBaqEaRv10Lx6SuRLNuJdiJ1zZiDyIcPh6YgoUneI4iD3czij1Qz_g50DRRd9AtxvQoNb-emvc";function Ts({userId:e,userEmail:t}){const[a,s]=r.useState({alerts:!0,password_reset:!0,weekly_summary:!1}),[n,l]=r.useState(!1),[i,d]=r.useState(!1),[o,c]=r.useState(!1),[x,m]=r.useState(!0),[u,g]=r.useState(!1),[h,b]=r.useState(null);r.useEffect(()=>{(async()=>{m(!0),await Promise.all([p(),f()]),m(!1)})()},[e]);const p=async()=>{try{const{data:t,error:r}=await q.from("users").select("email_notifications").eq("id",e).single();if(r)throw r;const a=(null==t?void 0:t.email_notifications)??{};s(e=>({...e,...a}))}catch(t){console.error("Error loading email preferences:",t)}},y=e=>{s(t=>({...t,[e]:!t[e]}))},f=async()=>{try{const t=await Ms();l(!!t);const{data:r,error:a}=await q.from("push_subscriptions").select("id").eq("user_id",e).limit(1).maybeSingle();if(a)throw a;d(!!r)}catch(t){console.error("Error init push:",t),l(!1)}};return x?R.jsx("div",{className:"flex justify-center items-center py-8",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx(gt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),R.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"é€šçŸ¥è¨­å®š"})]}),R.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start",children:[R.jsx(gt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 mt-0.5 flex-shrink-0"}),R.jsxs("div",{children:[R.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[R.jsx("strong",{children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:"})," ",t]}),R.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:"ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã¯ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€ä¿¡ã•ã‚Œã¾ã™"})]})]})}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 space-y-6 transition-colors",children:[R.jsxs("div",{className:"flex items-start space-x-4",children:[R.jsx(Ce,{className:"w-6 h-6 text-purple-600 dark:text-purple-400 mt-1 flex-shrink-0"}),R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã„ãªã„æ™‚ã‚‚ã€å¿…è¦ãªã¨ãã ã‘ãã£ã¨å£°ã‚’ã‹ã‘ã¾ã™"})]}),R.jsx("button",{onClick:async()=>{c(!0),b(null);try{0,i?(await async function(){const{data:{user:e}}=await q.auth.getUser();if(!e)throw new Error("Not logged in");if("serviceWorker"in navigator){const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();if(t)try{await t.unsubscribe()}catch(r){console.warn("unsubscribe failed:",r)}}const{error:t}=await q.from("push_subscriptions").delete().eq("user_id",e.id);if(t)throw t;return!0}(),d(!1),b({type:"success",text:"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’OFFã«ã—ã¾ã—ãŸ"})):(await Ms(),await Es(Rs),d(!0),b({type:"success",text:"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’ONã«ã—ã¾ã—ãŸ"}))}catch(e){console.error("Push toggle error:",e),b({type:"error",text:e.message||"ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ"})}finally{c(!1),setTimeout(()=>b(null),3e3)}},disabled:!n||o,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"} ${!n||o?"opacity-50 cursor-not-allowed":""}`,title:n?"":"ã“ã®ç«¯æœ«ã§ã¯ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’åˆ©ç”¨ã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™",children:R.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(i?"translate-x-6":"translate-x-1")})})]}),R.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"â€» iPhoneã¯ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ãŸBekutaã‹ã‚‰ONã«ã—ã¦ãã ã•ã„"})]})]}),R.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),R.jsxs("div",{className:"flex items-start space-x-4",children:[R.jsx(Ce,{className:"w-6 h-6 text-red-600 dark:text-red-400 mt-1 flex-shrink-0"}),R.jsx("div",{className:"flex-1",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"é«˜ãƒªã‚¹ã‚¯ã®ACWRå€¤ã‚„æ€ªæˆ‘ã®äºˆæ¸¬ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ä¿¡"})]}),R.jsx("button",{onClick:()=>y("alerts"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(a.alerts?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"),children:R.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(a.alerts?"translate-x-6":"translate-x-1")})})]})})]}),R.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),R.jsxs("div",{className:"flex items-start space-x-4",children:[R.jsx(qt,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 mt-1 flex-shrink-0"}),R.jsx("div",{className:"flex-1",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆé€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸéš›ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é€šçŸ¥"})]}),R.jsx("button",{onClick:()=>y("password_reset"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(a.password_reset?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"),children:R.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(a.password_reset?"translate-x-6":"translate-x-1")})})]})})]}),R.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),R.jsxs("div",{className:"flex items-start space-x-4",children:[R.jsx(Me,{className:"w-6 h-6 text-green-600 dark:text-green-400 mt-1 flex-shrink-0"}),R.jsx("div",{className:"flex-1",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"é€±æ¬¡ã‚µãƒãƒªãƒ¼ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"æ¯é€±æœˆæ›œæ—¥ã«å…ˆé€±ã®çŠ¶æ³ã‚’ã¾ã¨ã‚ãŸãƒ¬ãƒãƒ¼ãƒˆã‚’å—ä¿¡"})]}),R.jsx("button",{onClick:()=>y("weekly_summary"),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(a.weekly_summary?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700"),children:R.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(a.weekly_summary?"translate-x-6":"translate-x-1")})})]})})]})]}),h&&R.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg ${"success"===h.type?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-600 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400"} transition-colors`,children:["success"===h.type?R.jsx(Te,{className:"w-5 h-5 flex-shrink-0"}):R.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),R.jsx("span",{className:"text-sm",children:h.text})]}),R.jsx("div",{className:"flex justify-end",children:R.jsx("button",{onClick:async()=>{g(!0),b(null);try{const{error:t}=await q.from("users").update({email_notifications:a}).eq("id",e);if(t)throw t;b({type:"success",text:"ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ"})}catch(t){console.error("Error saving preferences:",t),b({type:"error",text:t.message||"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ"})}finally{g(!1),setTimeout(()=>b(null),3e3)}},disabled:u,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white py-2 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center space-x-2",children:u?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),R.jsx("span",{children:"ä¿å­˜ä¸­..."})]}):R.jsxs(R.Fragment,{children:[R.jsx(Mt,{className:"w-4 h-4"}),R.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«è¨­å®šã‚’ä¿å­˜"})]})})}),R.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4 transition-colors",children:R.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[R.jsx("strong",{children:"æ³¨æ„:"})," ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹é‡è¦ãªé€šçŸ¥ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç­‰ï¼‰ã¯ã€è¨­å®šã«é–¢ã‚ã‚‰ãšé€ä¿¡ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚"]})})]})}function As({user:e,onOpenProfileEdit:t}){return R.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š"}),R.jsx("button",{onClick:t,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"ç·¨é›†"})]}),R.jsx("div",{className:"space-y-4",children:R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"åå‰"}),R.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.name??"-"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.email??"-"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"æ€§åˆ¥"}),R.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"male"===e.gender?"ç”·æ€§":"female"===e.gender?"å¥³æ€§":"other"===e.gender?"ãã®ä»–":"prefer_not_to_say"===e.gender?"å›ç­”ã—ãªã„":"æœªè¨­å®š"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"èº«é•·"}),R.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.height_cm?`${e.height_cm} cm`:"æœªè¨­å®š"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"ç”Ÿå¹´æœˆæ—¥"}),R.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.date_of_birth?new Date(e.date_of_birth).toLocaleDateString("ja-JP"):"æœªè¨­å®š"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"é›»è©±ç•ªå·"}),R.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.phone_number?e.phone_number:"æœªè¨­å®š"})]})]})})]}),R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:R.jsx(Ts,{userId:e.id,userEmail:e.email??""})})]})}const $s=r.lazy(()=>$(()=>import("./AthleteNutritionDashboardView-B0c06uVF.js"),__vite__mapDeps([3,1,2])).then(e=>({default:e.default}))),zs=r.lazy(()=>$(()=>import("./ExportPanel-Ge-XKF4b.js"),__vite__mapDeps([4,1,5,2])).then(e=>({default:e.ExportPanel})));r.lazy(()=>$(()=>import("./GamificationView-DcmE6WMq.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.GamificationView})));const qs=r.lazy(()=>$(()=>import("./MessagingPanel-BRo3Mj6D.js"),__vite__mapDeps([6,1,2])).then(e=>({default:e.MessagingPanel}))),Fs=r.lazy(()=>$(()=>import("./AthletePerformanceView-COoFGWZu.js"),__vite__mapDeps([7,1,2])).then(e=>({default:e.default})));function Is({user:e,alerts:t,onLogout:a,onHome:s,onNavigateToPrivacy:n,onNavigateToTerms:l,onNavigateToCommercial:i,onNavigateToHelp:d,onUserUpdated:o}){var c,x,m,u,g,h,b,p,y,f,j,v,w;r.useRef(!1),r.useEffect(()=>{},[e.id,e.role,e.gender,e.team_id]),r.useRef(!1),r.useEffect(()=>{},[]);const N=r.useMemo(()=>H(),[]),[k,_]=r.useState(null),[C,S]=r.useState([]),[D,M]=r.useState(!1),[E,T]=r.useState(null);r.useEffect(()=>{const t=e.team_id;if(!t)return _(null),void S([]);let r=!1;return(async()=>{M(!0),T(null);try{const{data:e,error:a}=await q.rpc("get_team_phase_on_date",{p_team_id:t,p_date:N});if(a)throw a;const s=((e,t)=>{const[r,a,s]=e.split("-").map(Number),n=new Date(r,(a??1)-1,s??1);return n.setDate(n.getDate()+t),`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`})(N,21),{data:n,error:l}=await q.rpc("get_team_phases_in_range",{p_team_id:t,p_start:N,p_end:s});if(l)throw l;if(r)return;const i=Array.isArray(e)?e[0]:e;_(i??null);const d=((Array.isArray(n)?n:[])??[]).filter(e=>!i||!(e.phase_type===i.phase_type&&e.start_date===i.start_date&&e.end_date===i.end_date));d.sort((e,t)=>e.start_date>t.start_date?1:e.start_date<t.start_date?-1:0),S(d)}catch(e){if(r)return;console.error("[team phase fetch error]",e),T((null==e?void 0:e.message)??"team phase fetch error"),_(null),S([])}finally{r||M(!1)}})(),()=>{r=!0}},[e.team_id,N]);const A=e=>{switch(e){case"off":return"ã‚ªãƒ•";case"pre":return"ãƒ—ãƒ¬";case"in":return"ã‚¤ãƒ³";case"peak":return"ãƒ”ãƒ¼ã‚¯";case"transition":return"ç§»è¡Œ";default:return"æœªè¨­å®š"}},z=(e,t)=>{const r=Number(e.slice(5,7)),a=Number(e.slice(8,10)),s=Number(t.slice(5,7)),n=Number(t.slice(8,10));return r&&a&&s&&n?`${r}/${a}â€“${s}/${n}`:`${e}ã€œ${t}`},[F,I]=r.useState(null),[L,P]=r.useState(!1),[O,W]=r.useState(!1),[B,U]=r.useState(!1),[V,K]=r.useState(!1),[Y,Z]=r.useState("unified"),G=!!e.ftt_enabled,Q=!!e.nutrition_enabled;r.useEffect(()=>{const e=navigator.connection,t=!!(null==e?void 0:e.saveData),r=null==e?void 0:e.effectiveType;if(t||("slow-2g"===r||"2g"===r||"3g"===r))return;let a=!1;const s=()=>{$(()=>import("./AthletePerformanceView-COoFGWZu.js"),__vite__mapDeps([7,1,2]))};if("requestIdleCallback"in window){const e=window.requestIdleCallback(()=>{a||s()},{timeout:4e3});return()=>{var t;a=!0,null==(t=window.cancelIdleCallback)||t.call(window,e)}}const n=setTimeout(()=>{a||s()},2500);return()=>{a=!0,clearTimeout(n)}},[]);const X=r.useCallback(e=>{("ftt"!==e||G)&&("nutrition"!==e||Q)&&Z(e)},[G,Q]);r.useEffect(()=>{G||"ftt"!==Y||Z("unified")},[G,Y]),r.useEffect(()=>{Q||"nutrition"!==Y||Z("unified")},[Q,Y]);const[ee,te]=r.useState(null),[re,ae]=r.useState(!1),se=r.useMemo(()=>"female"===e.gender||"male"===e.gender?e.gender:null,[e.gender]),ie=r.useMemo(()=>"female"===e.gender||"male"===e.gender||"other"===e.gender||"prefer_not_to_say"===e.gender?e.gender:null,[e.gender]);r.useEffect(()=>{},[e.gender,se,ie]),r.useEffect(()=>{"cycle"===Y&&"female"!==se&&Z("unified")},[Y,se]);const{records:de,loading:oe,checkExistingRecord:ce,addTrainingRecord:xe,updateTrainingRecord:me,deleteTrainingRecord:ue,acwrData:he}=Hr(e.id),be=r.useMemo(()=>he&&he.length>0?he[he.length-1]:null,[he]),{records:ye,loading:je,checkExistingRecord:ve,addWeightRecord:we,updateWeightRecord:Ne,deleteWeightRecord:ke,getLatestWeight:_e,getWeightChange:Ce}=Zr(e.id),Se=r.useMemo(()=>_e(),[_e]),Ee=r.useMemo(()=>0===ye.length?null:ye.reduce((e,t)=>!e||new Date(t.date)>new Date(e.date)?t:e,null),[ye]),{records:Re,loading:Te,checkExistingRecord:Ae,addSleepRecord:$e,updateSleepRecord:ze,getAverageSleepHours:qe,getAverageSleepQuality:Fe,getLatestSleep:Ie}=function(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null),d=async()=>{try{n(!0),i(null);const{data:t,error:r}=await q.from("sleep_records").select("*").eq("user_id",e).order("date",{ascending:!1});if(r)throw r;a(t||[])}catch(t){console.error("Error fetching sleep records:",t),i(t instanceof Error?t.message:"ç¡çœ è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}};r.useEffect(()=>{e&&d()},[e]);const o=(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const a=t.filter(e=>new Date(e.date)>=r);return 0===a.length?null:a.reduce((e,t)=>e+Number(t.sleep_hours),0)/a.length};return{records:t,loading:s,error:l,checkExistingRecord:async t=>{try{const{data:r,error:a}=await q.from("sleep_records").select("*").eq("user_id",e).eq("date",t).maybeSingle();if(a)throw a;return r}catch(r){return console.error("Error checking existing record:",r),null}},addSleepRecord:async e=>{try{const{data:t}=await q.auth.getUser();if(!t.user)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r={user_id:t.user.id,date:e.date,sleep_hours:e.sleep_hours,sleep_quality:e.sleep_quality||null,bedtime:e.bedtime||null,waketime:e.waketime||null,notes:e.notes||null},{data:s,error:n}=await q.from("sleep_records").insert(r).select().single();if(n)throw n;a(e=>[s,...e].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}catch(t){throw console.error("Error adding sleep record:",t),t}},updateSleepRecord:async(e,t)=>{try{const r={sleep_hours:t.sleep_hours,sleep_quality:void 0!==t.sleep_quality?t.sleep_quality:null,bedtime:void 0!==t.bedtime?t.bedtime:null,waketime:void 0!==t.waketime?t.waketime:null,notes:void 0!==t.notes?t.notes:null},{data:s,error:n}=await q.from("sleep_records").update(r).eq("id",e).select().single();if(n)throw n;a(t=>t.map(t=>t.id===e?s:t))}catch(r){throw console.error("Error updating sleep record:",r),r}},deleteSleepRecord:async e=>{try{const{error:t}=await q.from("sleep_records").delete().eq("id",e);if(t)throw t;a(t=>t.filter(t=>t.id!==e))}catch(t){throw console.error("Error deleting sleep record:",t),t}},getAverageSleepHours:o,getAverageSleepQuality:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const a=t.filter(e=>new Date(e.date)>=r&&null!==e.sleep_quality);return 0===a.length?null:a.reduce((e,t)=>e+(t.sleep_quality||0),0)/a.length},getLatestSleep:()=>0===t.length?null:t[0],getSleepDeficit:(e=7)=>{const t=o(e);return null===t?null:8-t},refresh:d}}(e.id),Le=r.useMemo(()=>(null==Ie?void 0:Ie())??null,[Ie]),Pe=r.useMemo(()=>{const e=Number((null==Le?void 0:Le.sleep_hours)??0),t=Number((null==Le?void 0:Le.sleep_quality)??0);return{isPoor:e>0&&e<6||t>0&&t<=2,hours:e||null,quality:t||null}},[Le]),{records:Oe,loading:We,checkExistingRecord:Be,addMotivationRecord:Ue,updateMotivationRecord:He,getAverageMotivation:Ke,getAverageEnergy:Je,getAverageStress:Ye,getLatestMotivation:Ze}=function(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null),d=async()=>{try{n(!0),i(null);const{data:t,error:r}=await q.from("motivation_records").select("*").eq("user_id",e).order("date",{ascending:!1});if(r)throw r;a(t||[])}catch(t){console.error("Error fetching motivation records:",t),i(t instanceof Error?t.message:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}};return r.useEffect(()=>{e&&d()},[e]),{records:t,loading:s,error:l,checkExistingRecord:async t=>{try{const{data:r,error:a}=await q.from("motivation_records").select("*").eq("user_id",e).eq("date",t).maybeSingle();if(a)throw a;return r}catch(r){return console.error("Error checking existing record:",r),null}},addMotivationRecord:async t=>{try{if(!e)throw new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒã‚ã‚Šã¾ã›ã‚“");const r={user_id:e,date:t.date,motivation_level:t.motivation_level,energy_level:t.energy_level,stress_level:t.stress_level,mood:t.mood||null,notes:t.notes||null},{data:s,error:n}=await q.from("motivation_records").upsert(r,{onConflict:"user_id,date"}).select().single();if(n)throw n;a(e=>{const t=e.filter(e=>!(e.user_id===s.user_id&&e.date===s.date));return[s,...t].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())})}catch(r){throw console.error("Error adding motivation record:",r),r}},updateMotivationRecord:async(e,t)=>{try{const r={motivation_level:t.motivation_level,energy_level:t.energy_level,stress_level:t.stress_level,mood:void 0!==t.mood?t.mood:null,notes:void 0!==t.notes?t.notes:null},{data:s,error:n}=await q.from("motivation_records").update(r).eq("id",e).select().single();if(n)throw n;a(t=>t.map(t=>t.id===e?s:t))}catch(r){throw console.error("Error updating motivation record:",r),r}},deleteMotivationRecord:async e=>{try{const{error:t}=await q.from("motivation_records").delete().eq("id",e);if(t)throw t;a(t=>t.filter(t=>t.id!==e))}catch(t){throw console.error("Error deleting motivation record:",t),t}},getAverageMotivation:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const a=t.filter(e=>new Date(e.date)>=r);return 0===a.length?null:a.reduce((e,t)=>e+t.motivation_level,0)/a.length},getAverageEnergy:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const a=t.filter(e=>new Date(e.date)>=r);return 0===a.length?null:a.reduce((e,t)=>e+t.energy_level,0)/a.length},getAverageStress:(e=7)=>{if(0===t.length)return null;const r=new Date;r.setDate(r.getDate()-e);const a=t.filter(e=>new Date(e.date)>=r);return 0===a.length?null:a.reduce((e,t)=>e+t.stress_level,0)/a.length},getLatestMotivation:()=>0===t.length?null:t[0],getMotivationTrend:(e=7)=>{if(t.length<2)return null;const r=new Date;r.setDate(r.getDate()-e);const a=t.filter(e=>new Date(e.date)>=r).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());if(a.length<2)return null;const s=Math.floor(a.length/2),n=a.slice(0,s),l=a.slice(s),i=n.reduce((e,t)=>e+t.motivation_level,0)/n.length,d=l.reduce((e,t)=>e+t.motivation_level,0)/l.length-i;return d>.5?"improving":d<-.5?"declining":"stable"},refresh:d}}(e.id),{records:Ge,latest:Xe,loading:tt,error:rt}=$a(e.id),{cycles:nt,addCycle:lt,updateCycle:dt}=Gr(e.id),{isActive:ot,shouldShowTutorial:ct,startTutorial:xt,completeTutorial:mt,skipTutorial:gt,currentStepIndex:bt,setCurrentStepIndex:yt}=ge(),{isDarkMode:ft}=function(){const[e,t]=r.useState(()=>window.matchMedia("(prefers-color-scheme: dark)").matches);return r.useEffect(()=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[e]),r.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),r=e=>{t(e.matches)};return e.addEventListener("change",r),()=>e.removeEventListener("change",r)},[]),{isDarkMode:e}}(),{logs:jt,totals:vt,loading:wt,error:Nt,refetch:kt}=function(e,t){const[a,s]=r.useState([]),[n,l]=r.useState("idle"),[i,d]=r.useState(null),[o,c]=r.useState(0),x=r.useRef({cal:0,p:0,f:0,c:0}),m=r.useCallback(()=>{c(e=>e+1)},[]);r.useEffect(()=>{if(!e||!t)return;let r=!1;return async function(){l("loading"),d(null);try{const{data:a,error:n}=await q.from("nutrition_logs").select("id, record_date, meal_type, meal_slot, total_calories, p, f, c, is_edited, advice_markdown, image_url, image_path, analysis_status, analysis_error, created_at").eq("user_id",e).eq("record_date",t).order("meal_type",{ascending:!0}).order("meal_slot",{ascending:!0}).order("created_at",{ascending:!0});if(n)throw n;r||(s(a??[]),l("ready"))}catch(a){console.error("[useTodayNutritionTotals] fetch error:",a),r||(s([]),l("error"),d(String((null==a?void 0:a.message)??a)))}}(),()=>{r=!0}},[e,t,o]);const u=r.useMemo(()=>{if("loading"===n)return x.current;const e={cal:0,p:0,f:0,c:0};let t=!1;for(const s of a)null!=s.total_calories&&null!=s.p&&null!=s.f&&null!=s.c||(t=!0),e.cal+=Number(s.total_calories??0),e.p+=Number(s.p??0),e.f+=Number(s.f??0),e.c+=Number(s.c??0);e.p=Math.round(10*e.p)/10,e.f=Math.round(10*e.f)/10,e.c=Math.round(10*e.c)/10;const r={...e,hasAnyLog:a.length>0,hasUnparsed:t};return x.current=r,r},[a,n]);return{logs:a,totals:u,loading:"loading"===n,status:n,error:i,refetch:m}}(e.id,N),_t=r.useMemo(()=>{const e=vt??{};return{cal:Number((null==e?void 0:e.cal)??(null==e?void 0:e.kcal)??(null==e?void 0:e.calories)??(null==e?void 0:e.total_calories)??0)||0,p:Number((null==e?void 0:e.p)??(null==e?void 0:e.protein_g)??(null==e?void 0:e.protein)??0)||0,f:Number((null==e?void 0:e.f)??(null==e?void 0:e.fat_g)??(null==e?void 0:e.fat)??0)||0,c:Number((null==e?void 0:e.c)??(null==e?void 0:e.carbs_g)??(null==e?void 0:e.carbs)??0)||0}},[vt]),Ct=function(e){const t=e.trainingRecords??[],a=e.weightRecords??[],s=e.sleepRecords??[],n=e.motivationRecords??[];return{lastTrainingRecord:r.useMemo(()=>Na(t),[t]),lastWeightRecord:r.useMemo(()=>Na(a),[a]),lastSleepRecord:r.useMemo(()=>Na(s),[s]),lastMotivationRecord:r.useMemo(()=>Na(n),[n]),daysWithTrainingData:r.useMemo(()=>{const e=new Set;for(const r of t)va(null==r?void 0:r.date)&&e.add(r.date);return e.size},[t]),consecutiveTrainingDays:r.useMemo(()=>{const e=new Set;for(const i of t)va(null==i?void 0:i.date)&&e.add(i.date);if(0===e.size)return 0;const r=new Date;r.setHours(0,0,0,0);const a=new Date(r),s=J(a);e.has(s)||a.setDate(a.getDate()-1);let n=0;const l=new Date(a);for(let t=0;t<365;t++){const t=J(l);if(!e.has(t))break;n++,l.setDate(l.getDate()-1)}return n},[t]),weeklyAverage:r.useMemo(()=>{if(!t.length)return null;const e=new Date;e.setDate(e.getDate()-7);const r=e.getTime();let a=0,s=0,n=0,l=0;for(const i of t){const e=wa(null==i?void 0:i.date);null!==e&&(e<r||(a++,s+=Number.isFinite(Number(i.rpe))?Number(i.rpe):0,n+=Number.isFinite(Number(i.duration_min))?Number(i.duration_min):0,l+=Number.isFinite(Number(i.load))?Number(i.load):0))}return 0===a?null:{rpe:s/a,duration:n/a,load:l/a}},[t])}}({trainingRecords:de,weightRecords:ye,sleepRecords:Re,motivationRecords:Oe}),St=Ct.daysWithTrainingData,Dt=Ct.consecutiveTrainingDays,Mt=Ct.weeklyAverage,{normalizedLastTrainingRecord:Rt,normalizedLastTrainingRecordForCheckIn:Tt,normalizedLastWeightRecord:$t,normalizedLastSleepRecord:zt,normalizedLastMotivationRecord:Ft}=Ra({lastTrainingRecord:Ct.lastTrainingRecord,lastWeightRecord:Ct.lastWeightRecord,lastSleepRecord:Ct.lastSleepRecord,lastMotivationRecord:Ct.lastMotivationRecord}),It=r.useMemo(()=>Re.map(e=>({...e,sleep_quality:e.sleep_quality??0})),[Re]),Lt=r.useMemo(()=>It.map(e=>({sleep_hours:e.sleep_hours,sleep_quality:e.sleep_quality,date:e.date})),[It]),Pt=r.useMemo(()=>t.filter(t=>t.user_id===e.id),[t,e.id]),Ot=r.useMemo(()=>Pt.filter(e=>"high"===e.priority),[Pt]),Wt=r.useMemo(()=>ye.find(e=>e.date===N),[ye,N]),Bt=r.useMemo(()=>{const e=function(e){var t;const r=e.phase,a=e.poorSleep,s=e.risk??null,n=(null==r?void 0:r.phase_type)??"unknown",l=null==(t=(null==r?void 0:r.focus_tags)??[])?void 0:t.filter(Boolean),i=(null==r?void 0:r.note)??null,d=!!(null==s?void 0:s.hasHighPriorityAlert),o=(null==s?void 0:s.riskLevel)??"unknown",c=d||"high"===o;if(null==a?void 0:a.isPoor){const e=(x=a).hours&&x.hours>0?`ï¼ˆç¡çœ ${x.hours.toFixed(1)}hï¼‰`:x.quality&&x.quality>0?`ï¼ˆç¡çœ ã®è³ª${x.quality}/5ï¼‰`:"ï¼ˆç¡çœ ä¸è¶³ï¼‰";return{oneWord:`âš ï¸ ${e} ä»Šæ—¥ã¯ä¸Šã’ã™ãæ³¨æ„ã€‚å¼·åº¦ã‚’æŠ‘ãˆã¦ç²¾åº¦é‡è¦–ã€‚`,trainingHint:`âš ï¸ ${e} ä»Šæ—¥ã¯ä¸Šã’ã™ãæ³¨æ„ã€‚å¼·åº¦ã‚’æŠ‘ãˆã¦ç²¾åº¦é‡è¦–ã§ã€‚`,sleepHint:`âš ï¸ ${e} ä»Šæ—¥ã¯å›å¾©ãŒæœ€å„ªå…ˆã€‚æ˜¼å¯ã‚„æ—©å¯ã‚‚æ¤œè¨ã€‚`,nutritionHint:`âš ï¸ ${e} å›å¾©å„ªå…ˆï¼šæ°´åˆ†ï¼‹ç‚­æ°´åŒ–ç‰©ï¼‹ãŸã‚“ã±ãè³ªã‚’ç¢ºå®Ÿã«ã€‚`,reason:"poor_sleep"}}var x;if(c)return{oneWord:"âš ï¸ ã‚±ã‚¬ãƒªã‚¹ã‚¯é«˜ã‚ã€‚è² è·ã‚’è½ã¨ã—ã¦å›å¾©/å¯å‹•åŸŸã‚’å„ªå…ˆã€‚",trainingHint:"âš ï¸ ãƒªã‚¹ã‚¯é«˜ã‚ã€‚ä»Šæ—¥ã¯å¼·åº¦ã‚’è½ã¨ã—ã¦ç²¾åº¦ãƒ»å›å¾©å„ªå…ˆã§ã€‚",sleepHint:"ç¡çœ ã§å›å¾©ã‚’æœ€å¤§åŒ–ã€‚å…¥çœ /èµ·åºŠãƒªã‚ºãƒ ã‚’æ•´ãˆã‚ˆã†ã€‚",nutritionHint:"å›å¾©å„ªå…ˆï¼šæ°´åˆ†ï¼‹ç‚­æ°´åŒ–ç‰©ï¼‹ãŸã‚“ã±ãè³ªã‚’å…ˆã«ç¢ºä¿ã€‚",reason:"high_risk"};if(r){const e=l.find(e=>Ss[`${n}:${e}`]);if(e){const t=Ss[`${n}:${e}`];return{oneWord:Cs(t.oneWord,80),trainingHint:Cs(t.training??t.oneWord,80),sleepHint:Cs(t.sleep??("peak"===n?"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚":"in"===n?"ç¡çœ ã§å›å¾©ã‚’ç©ã‚€ã€‚çŸ­ãã¦ã‚‚è³ªã‚’ç¢ºä¿ã€‚":"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚"),80),nutritionHint:Cs(t.nutrition??("pre"===n?"åœŸå°ã¥ãã‚Šï¼šã¾ãšã¯ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã‹ã‚‰ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç·´ç¿’é‡ã«åˆã‚ã›ã¦ç‚­æ°´åŒ–ç‰©ã‚’ç¢ºä¿ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šèƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚":"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚"),80),reason:"phase"}}return i&&i.trim().length>0?{oneWord:Cs(_s(i.trim()),80),trainingHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆã€ä¸Šã’ã™ãæ³¨æ„ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç‹™ã„ã‚’æ±ºã‚ã¦è¨˜éŒ²ã—ã‚ˆã†ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šç–²åŠ´ã‚’æºœã‚ãšã«ã‚­ãƒ¬é‡è¦–ã€‚":"transition"===n?"åˆ‡ã‚Šæ›¿ãˆæœŸï¼šæ•´ãˆã‚‹ãƒ»è»½ã‚ã§OKã€‚":"ä»Šæ—¥ã¯å›å¾©å„ªå…ˆã€‚å¼·åº¦ã¯æ§ãˆã‚ã§OKã€‚",sleepHint:"peak"===n?"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚":"in"===n?"ç¡çœ ã§å›å¾©ã‚’ç©ã‚€ã€‚çŸ­ãã¦ã‚‚è³ªã‚’ç¢ºä¿ã€‚":"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚",nutritionHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šã¾ãšã¯ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã‹ã‚‰ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç·´ç¿’é‡ã«åˆã‚ã›ã¦ç‚­æ°´åŒ–ç‰©ã‚’ç¢ºä¿ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šèƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚":"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚",reason:"phase"}:{oneWord:Cs(_s(ks(n,l,i,{preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:80})),80),trainingHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆã€ä¸Šã’ã™ãæ³¨æ„ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç‹™ã„ã‚’æ±ºã‚ã¦è¨˜éŒ²ã—ã‚ˆã†ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šç–²åŠ´ã‚’æºœã‚ãšã«ã‚­ãƒ¬é‡è¦–ã€‚":"transition"===n?"åˆ‡ã‚Šæ›¿ãˆæœŸï¼šæ•´ãˆã‚‹ãƒ»è»½ã‚ã§OKã€‚":"ä»Šæ—¥ã¯å›å¾©å„ªå…ˆã€‚å¼·åº¦ã¯æ§ãˆã‚ã§OKã€‚",sleepHint:"peak"===n?"ç¡çœ ã¯æœ€å„ªå…ˆï¼ˆé‡ã¨è³ªã©ã¡ã‚‰ã‚‚ï¼‰ã€‚":"in"===n?"ç¡çœ ã§å›å¾©ã‚’ç©ã‚€ã€‚çŸ­ãã¦ã‚‚è³ªã‚’ç¢ºä¿ã€‚":"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚",nutritionHint:"pre"===n?"åœŸå°ã¥ãã‚Šï¼šã¾ãšã¯ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªã€ã‹ã‚‰ã€‚":"in"===n?"ç©ã¿ä¸Šã’æœŸï¼šç·´ç¿’é‡ã«åˆã‚ã›ã¦ç‚­æ°´åŒ–ç‰©ã‚’ç¢ºä¿ã€‚":"peak"===n?"ä»•ä¸Šã’æœŸï¼šèƒƒè…¸ã«å„ªã—ãã€å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å„ªå…ˆã€‚":"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚",reason:"phase"}}return{oneWord:"âœ… ä»Šæ—¥ã¯â€œ1ã¤ã ã‘â€ã‚„ã‚‹ã€‚ã¾ãšè¨˜éŒ²ã‹ã‚‰ã€‚",trainingHint:"ä»Šæ—¥ã®ç·´ç¿’ã‚’æ­£ç›´ã«è¨˜éŒ²ã—ã‚ˆã†ã€‚",sleepHint:"ç¡çœ ã¯å›å¾©ã®åœŸå°ã€‚èµ·åºŠæ™‚ã®æ„Ÿè¦šã‚‚å¤§äº‹ã€‚",nutritionHint:"è¿·ã£ãŸã‚‰ã€Œä¸»é£Ÿï¼‹ãŸã‚“ã±ãè³ªï¼‹é‡èœã€ã‹ã‚‰ã€‚",reason:"default"}}({phase:k,poorSleep:Pe.isPoor,risk:{riskLevel:(null==be?void 0:be.riskLevel)??"unknown",hasHighPriorityAlert:((null==Ot?void 0:Ot.length)??0)>0}});return{base:e.oneWord,training:e.trainingHint,sleep:e.sleepHint,nutrition:e.nutritionHint}},[k,null==Pe?void 0:Pe.isPoor,null==be?void 0:be.riskLevel,null==Ot?void 0:Ot.length]),Ut=fs({userId:e.id,keyPrefix:"athlete",thresholdDays:3,enableDailyTip:!0}),Ht="unified"===Y&&Ut.open,Jt=r.useMemo(()=>"welcome_back"===Ut.mode?"ãŠã‹ãˆã‚Šï¼\nã¾ãšã¯ã€Œä»Šæ—¥ã®çŠ¶æ…‹ã€ã‚’è»½ãè¨˜éŒ²ã—ã¦ã€ç„¡ç†ãªãå†å§‹å‹•ã—ã‚ˆã†ã€‚":`ä»Šæ—¥ã®ä¸€è¨€ï¼š\n${Bt.base}`,[Ut.mode,Bt.base]),Yt=r.useMemo(()=>{const t=Number((null==Xe?void 0:Xe.weight)??(null==Xe?void 0:Xe.weight_kg))||Number(null==e?void 0:e.weight_kg)||0;if(!t||t<=0)return null;const r=Number((null==Xe?void 0:Xe.body_fat_percent)??(null==Xe?void 0:Xe.body_fat_perc)),a=Number.isFinite(r)&&r>0?r:null,s=Number(null==e?void 0:e.height_cm),n=Qa({weightKg:t,bodyFatPercent:a,heightCm:Number.isFinite(s)&&s>0?s:null,age:null,sex:null,activityLevel:"moderate",goalType:"maintain"});return(null==n?void 0:n.target)??null},[null==e?void 0:e.weight_kg,null==e?void 0:e.height_cm,null==Xe?void 0:Xe.weight,null==Xe?void 0:Xe.weight_kg,null==Xe?void 0:Xe.body_fat_percent,null==Xe?void 0:Xe.body_fat_perc]),Zt=r.useMemo(()=>de.find(e=>e.date===N)??null,[de,N]),Gt=r.useMemo(()=>Zt?(Zt.rpe??0)*(Zt.duration_min??0):0,[Zt]);r.useMemo(()=>Ba({date:N,snapshot:F?{bmr:F.bmr,tdee:F.tdee,srpe:F.srpe,activity_factor:Number(F.activity_factor)}:null,intakeCalories:0,fallback:{todayLoad:Gt}}),[N,F,0,Gt]),r.useEffect(()=>{re||oe||ct()&&(xt(),ae(!0))},[oe,re,ct,xt]);const Qt=r.useCallback(async t=>{await xe({rpe:t.rpe,duration_min:t.duration_min,date:t.date,arrow_score:t.arrow_score??50,signal_score:t.signal_score??50}),await async function(e){const{userId:t,date:r,rpe:a,durationMin:s}=e,n=(a??0)*(s??0),{data:l,error:i}=await q.from("nutrition_metabolism_snapshots").select("bmr").eq("user_id",t).order("calculated_at",{ascending:!1}).limit(1).maybeSingle();if(i)throw i;const d=null==l?void 0:l.bmr;if(!d)return;const o=0===n?1.2:n<300?1.4:n<600?1.6:n<900?1.8:2,c=Math.round(d*o),{error:x}=await q.from("daily_energy_snapshots").upsert({user_id:t,date:r,bmr:d,srpe:n,activity_factor:o,tdee:c},{onConflict:"user_id,date"});if(x)throw x}({userId:e.id,date:t.date,rpe:t.rpe,durationMin:t.duration_min})},[xe,e.id]),Xt=r.useCallback(async(e,t)=>{await me(e,t)},[me]),er=r.useCallback(async(e,t)=>{await me(e,t)},[me]),tr=r.useCallback(async e=>{await xe({rpe:e.rpe,duration_min:e.duration_min,date:e.date,arrow_score:e.arrow_score??50,signal_score:e.signal_score??50})},[xe]),rr=r.useCallback(async(e,t)=>{await me(e,{rpe:t.rpe,duration_min:t.duration_min,arrow_score:t.arrow_score??50,signal_score:t.signal_score??50})},[me]),ar=N,lr=r.useRef(null);r.useRef(null);const ir=r.useCallback(e=>{Z("nutrition")},[]);return r.useCallback(e=>{switch(e){case"jump":return"ã‚¸ãƒ£ãƒ³ãƒ—æ¸¬å®š";case"endurance":return"å…¨èº«æŒä¹…åŠ›æ¸¬å®š";case"strength":return"ç­‹åŠ›æ¸¬å®š";case"sprint":return"ã‚¹ãƒ—ãƒªãƒ³ãƒˆæ¸¬å®š";case"agility":return"ã‚¢ã‚¸ãƒªãƒ†ã‚£æ¸¬å®š";default:return"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š"}},[]),r.useEffect(()=>{},[null==(c=Ct.lastTrainingRecord)?void 0:c.date,null==(x=Ct.lastSleepRecord)?void 0:x.date,null==(m=Ct.lastMotivationRecord)?void 0:m.date,Ct.daysWithTrainingData,Ct.consecutiveTrainingDays]),R.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[R.jsx("header",{className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 shadow-lg transition-colors",children:R.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("button",{type:"button",onClick:s,className:"flex items-baseline gap-2 active:opacity-70 cursor-pointer",style:{WebkitTapHighlightColor:"transparent"},children:[R.jsx("span",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Bekuta"}),R.jsx("span",{className:"text-xs font-medium text-blue-100 hidden sm:inline",children:"by ARCA"})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx("button",{type:"button",onClick:xt,className:"p-2 rounded-lg text-white/90 hover:bg-white/10 hover:text-white transition-colors","aria-label":"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",children:R.jsx(st,{className:"w-5 h-5"})}),R.jsx("button",{type:"button",onClick:()=>K(e=>!e),className:"p-2 rounded-lg text-white hover:bg-white/10 transition-colors","aria-label":"ãƒ¡ãƒ‹ãƒ¥ãƒ¼",title:"ãƒ¡ãƒ‹ãƒ¥ãƒ¼",children:V?R.jsx(sr,{className:"w-6 h-6"}):R.jsx(ht,{className:"w-6 h-6"})})]})]})})}),R.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 transition-colors",children:R.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-2",children:R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.name,"ã•ã‚“ Â·"," ","unified"===Y?"ã™ã¹ã¦ã®è¨˜éŒ²ã‚’ä¸€ç›®ã§ç¢ºèª":"overview"===Y?"ä»Šæ—¥ã®ç·´ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²":"weight"===Y?"ä½“é‡ã®å¤‰åŒ–ã‚’ç®¡ç†":"insights"===Y?"ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ–°ã—ã„ç™ºè¦‹ã‚’":"performance"===Y?"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¸¬å®š":"conditioning"===Y?"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†":"cycle"===Y?"æœˆçµŒå‘¨æœŸã¨ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’è¨˜éŒ²":"nutrition"===Y?"æ „é¤Šï¼šAIä¸‹æ›¸ãâ†’ã‚ãªãŸãŒç¢ºå®š":"gamification"===Y?"ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã€ãƒãƒƒã‚¸ã€ç›®æ¨™ã‚’ç®¡ç†":"è¨­å®šã¨ãŠçŸ¥ã‚‰ã›"]})})}),V&&R.jsxs("div",{className:"fixed inset-0 z-50",onClick:()=>K(!1),children:[R.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50"}),R.jsx("div",{className:"absolute top-20 right-4 bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-72 max-h-[calc(100vh-6rem)] overflow-y-auto",onClick:e=>e.stopPropagation(),children:R.jsxs("div",{className:"p-2",children:[R.jsxs("button",{type:"button",onClick:()=>{Z("unified"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("unified"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(it,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ãƒ›ãƒ¼ãƒ "})]}),R.jsxs("button",{type:"button",onClick:()=>{Z("weight"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("weight"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(Et,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ä½“é‡ç®¡ç†"})]}),R.jsxs("button",{type:"button",onClick:()=>{Z("conditioning"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("conditioning"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(at,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†"})]}),"female"===se&&R.jsxs("button",{type:"button",onClick:()=>{Z("cycle"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("cycle"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(Ve,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"æœˆçµŒå‘¨æœŸ"})]}),R.jsxs("button",{type:"button",onClick:()=>{Z("overview"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("overview"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(pe,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ç·´ç¿’è¨˜éŒ²"})]}),G&&R.jsxs("button",{type:"button",onClick:()=>{Z("ftt"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("ftt"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(pe,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒã‚§ãƒƒã‚¯ï¼ˆ10ç§’ï¼‰"})]}),Q&&R.jsxs("button",{type:"button",onClick:()=>{X("nutrition"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("nutrition"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(et,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"æ „é¤Š"})]}),R.jsxs("button",{type:"button",onClick:()=>{Z("performance"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("performance"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(nr,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹"})]}),R.jsxs("button",{type:"button",onClick:()=>{Z("gamification"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("gamification"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),"data-tutorial":"gamification-tab",children:[R.jsx(Kt,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³"})]}),R.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),R.jsxs("button",{type:"button",onClick:()=>{Z("settings"),K(!1)},className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors "+("settings"===Y?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[R.jsx(At,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"è¨­å®š"})]}),R.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),d&&R.jsxs("button",{type:"button",onClick:()=>{K(!1),d()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[R.jsx(st,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ãƒ˜ãƒ«ãƒ—ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«"})]}),n&&R.jsxs("button",{type:"button",onClick:()=>{K(!1),n()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[R.jsx(qt,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼"})]}),l&&R.jsxs("button",{type:"button",onClick:()=>{K(!1),l()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[R.jsx(Qe,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"åˆ©ç”¨è¦ç´„"})]}),i&&R.jsxs("button",{type:"button",onClick:()=>{K(!1),i()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:[R.jsx(De,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜"})]}),a&&R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),R.jsxs("button",{type:"button",onClick:async()=>{K(!1),await a()},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[R.jsx(ut,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm font-medium",children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]})]})]})})]}),R.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-4 sm:pt-4 sm:pb-8",children:"unified"===Y?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"mb-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-5 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º"}),D?R.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"èª­ã¿è¾¼ã¿ä¸­â€¦"}):E?R.jsx("span",{className:"text-xs text-red-600 dark:text-red-400",children:"å–å¾—ã‚¨ãƒ©ãƒ¼"}):k?R.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:z(k.start_date,k.end_date)}):R.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"æœªè¨­å®š"})]}),D?R.jsxs("div",{className:"mt-3",children:[R.jsx("div",{className:"h-7 w-28 bg-gray-100 dark:bg-gray-700 rounded animate-pulse"}),R.jsxs("div",{className:"mt-3 flex gap-2",children:[R.jsx("div",{className:"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse"}),R.jsx("div",{className:"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse"}),R.jsx("div",{className:"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse"})]}),R.jsx("div",{className:"mt-3 h-4 w-4/5 bg-gray-100 dark:bg-gray-700 rounded animate-pulse"})]}):E?R.jsxs("div",{className:"mt-3 text-sm text-red-700 dark:text-red-300",children:["å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼š",E]}):k?R.jsxs(R.Fragment,{children:[R.jsx("h3",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:A(k.phase_type)}),Array.isArray(k.focus_tags)&&k.focus_tags.length>0&&R.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[k.focus_tags.slice(0,6).map((e,t)=>R.jsx("span",{className:"text-xs px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/15 text-blue-700 dark:text-blue-200",children:e},`${e}-${t}`)),k.focus_tags.length>6&&R.jsxs("span",{className:"text-xs px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:["+",k.focus_tags.length-6]})]}),R.jsx("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-200 line-clamp-2",children:Bt.base})]}):R.jsx("div",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300",children:"ãƒ•ã‚§ãƒ¼ã‚ºãŒæœªè¨­å®šã§ã™ï¼ˆã‚³ãƒ¼ãƒãŒè¨­å®šã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"}),!D&&!E&&Array.isArray(C)&&C.length>0&&R.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[R.jsxs("div",{className:"flex items-center justify-between mb-2",children:[R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ä»Šå¾Œ"}),R.jsx("p",{className:"text-[11px] text-gray-400 dark:text-gray-500",children:"æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«"})]}),R.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1",children:C.slice(0,8).map((e,t)=>R.jsx("div",{className:"min-w-[140px] rounded-lg border border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2",children:R.jsxs("div",{className:"flex items-center justify-between gap-2",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate",children:A(e.phase_type)}),R.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 whitespace-nowrap",children:z(e.start_date,e.end_date)})]})},`${e.start_date}-${e.end_date}-${t}`))})]})]})}),R.jsx(ua,{acwrData:he,weightRecords:ye,sleepRecords:It,motivationRecords:Oe,trainingRecords:de,menstrualCycles:nt,userGender:ie,onOpenDetailView:e=>{"training"===e?Z("overview"):"weight"===e?Z("weight"):"conditioning"===e?Z("conditioning"):"cycle"===e&&"female"===se&&Z("cycle")},onQuickAdd:()=>W(!0)}),Q&&R.jsx("div",{className:"mt-6",children:R.jsx("button",{type:"button",onClick:()=>Z("nutrition"),className:"w-full text-left","aria-label":"æ „é¤Šã®è©³ç´°ã¸",children:R.jsx("div",{className:"rounded-xl hover:opacity-95 active:opacity-90 transition",children:R.jsx(Ka,{totals:vt,targets:Yt,loading:wt,subtitle:`${ar} Â· ${Bt.nutrition}`})})})}),R.jsx("div",{className:"mt-6",children:R.jsx(fa,{userId:e.id})}),R.jsx("div",{className:"mt-4",children:R.jsx(ja,{userId:e.id,highlight:Ot.length>0})}),R.jsx("div",{className:"mt-6",children:R.jsx(ga,{acwrData:he,weightRecords:ye,sleepRecords:Lt,motivationRecords:Oe})}),Ot.length>0&&R.jsx("div",{className:"mt-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(fe,{className:"w-6 h-6 text-red-600 dark:text-red-400 mr-3"}),R.jsxs("div",{className:"flex-1",children:[R.jsx("h3",{className:"font-semibold text-red-900 dark:text-red-200",children:"ç·Šæ€¥æ³¨æ„"}),R.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:"æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚ç·´ç¿’å¼·åº¦ã®èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"})]})]})})]}):"nutrition"===Y?Q?R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:R.jsx($s,{user:e,date:N,nutritionLogs:jt,nutritionTotals:_t,nutritionLoading:wt,nutritionError:Nt,onBackHome:()=>Z("unified"),latestInbody:Xe??null,trainingRecords:de??[],latestWeightKg:Se??null,onRefreshNutrition:kt})}):null:"ftt"===Y?G?R.jsx(ss,{userId:e.id,onBackHome:()=>Z("unified")}):null:"overview"===Y?R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[R.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[Pt.length>0&&R.jsx(_r,{alerts:Pt,onViewAll:()=>{}}),R.jsx("div",{className:"mt-3",children:R.jsx(ja,{userId:e.id,highlight:Ot.length>0})}),Ot.length>0&&R.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(fe,{className:"w-6 h-6 text-red-600 mr-3"}),R.jsxs("div",{className:"flex-1",children:[R.jsx("h3",{className:"font-semibold text-red-900",children:"ç·Šæ€¥æ³¨æ„"}),R.jsx("p",{className:"text-sm text-red-700",children:"æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚ç·´ç¿’å¼·åº¦ã®èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"})]})]})}),Wt&&R.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4 transition-colors",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:"ä»Šæ—¥ã®ä½“é‡"}),R.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[Number(Wt.weight_kg).toFixed(1)," kg"]})]}),R.jsx("button",{type:"button",onClick:()=>Z("weight"),className:"text-sm text-green-600 dark:text-green-400 hover:underline",children:"ä½“é‡ç®¡ç†ã¸ â†’"})]})}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors","data-tutorial":"training-form",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[R.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"ç·´ç¿’è¨˜éŒ²"}),R.jsx(Me,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]}),R.jsx(ka,{daysWithData:St,consecutiveDays:Dt,weeklyAverage:Mt}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:Bt.training}),R.jsx(fr,{userId:e.id,onSubmit:Qt,onCheckExisting:ce,onUpdate:Xt,loading:oe,lastRecord:Rt,weeklyAverage:Mt,daysWithData:St,consecutiveDays:Dt})]}),be&&R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"ç¾åœ¨ã®ACWR"}),R.jsx(Vt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 dark:text-gray-500"})]}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"text-2xl sm:text-3xl font-bold mb-2",style:{color:le(be.riskLevel)},children:be.acwr}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:ne(be.riskLevel??"unknown")}),R.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4 text-sm",children:[R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm",children:"æ€¥æ€§è² è·"}),R.jsx("p",{className:"font-semibold text-sm sm:text-base dark:text-white",children:be.acuteLoad})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm",children:"æ…¢æ€§è² è·"}),R.jsx("p",{className:"font-semibold text-sm sm:text-base dark:text-white",children:be.chronicLoad})]})]})]})]})]}),R.jsx("div",{className:"lg:col-span-2",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors","data-tutorial":"acwr-chart",children:[R.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"ACWRæ¨ç§»ã‚°ãƒ©ãƒ•"}),oe?R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):R.jsx(vr,{data:he,daysWithData:St,isDarkMode:ft})]})})]}),R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mt-6 transition-colors",children:R.jsx(kr,{records:de,onUpdate:er,onDelete:ue,loading:oe,allowEdit:!0,allowDelete:!0,allowDateEdit:!1,showLimited:!0,limitCount:10})})]}):"weight"===Y?R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[R.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[be&&R.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 transition-colors",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"ç¾åœ¨ã®ACWR"}),R.jsx("p",{className:"text-2xl font-bold",style:{color:le(be.riskLevel)},children:be.acwr}),R.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:ne(be.riskLevel??"unknown")})]}),R.jsx("button",{type:"button",onClick:()=>Z("overview"),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"ç·´ç¿’è¨˜éŒ²ã¸ â†’"})]})}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[R.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ä½“é‡ã‚µãƒãƒªãƒ¼"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[R.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"ç¾åœ¨ã®ä½“é‡"}),R.jsx("p",{className:"text-2xl font-bold text-blue-700",children:null!==_e()?`${_e().toFixed(1)} kg`:"æœªè¨˜éŒ²"})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"30æ—¥å¤‰åŒ–"}),R.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:null!==Ce(30)?R.jsxs(R.Fragment,{children:[Ce(30)>0?"+":"",Ce(30).toFixed(1)," kg"]}):"-"})]}),R.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"è¨˜éŒ²æ•°"}),R.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:ye.length})]})]})]})]}),tt?R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:R.jsx("div",{className:"flex items-center justify-center h-24",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):rt?R.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:R.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300",children:["InBodyãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š",rt]})}):Xe?R.jsxs("div",{className:"space-y-6",children:[R.jsx(qa,{latest:Xe,loading:tt,error:rt}),R.jsx(Wa,{records:Ge,gender:se})]}):R.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-6 text-center",children:R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"InBodyãƒ‡ãƒ¼ã‚¿ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"})}),e.height_cm&&Se&&R.jsx(Tr,{weightKg:Se,heightCm:e.height_cm,dateOfBirth:e.date_of_birth,gender:ie}),!e.height_cm&&R.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 transition-colors",children:R.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"èº«é•·ã‚’è¨­å®šã™ã‚‹ã¨BMIãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚è¨­å®šã‚¿ãƒ–ã‹ã‚‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚"})}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[R.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"ä½“é‡è¨˜éŒ²"}),R.jsx(Et,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]}),R.jsx(Cr,{onSubmit:we,onCheckExisting:ve,onUpdate:Ne,loading:je,lastRecord:Ee})]})]}),R.jsxs("div",{className:"lg:col-span-2",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mb-6 transition-colors",children:[R.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•"}),je?R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-80",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):R.jsx(Sr,{data:ye})]}),R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:R.jsx(Dr,{records:ye,onUpdate:Ne,onDelete:ke,loading:je})})]})]}):"insights"===Y?R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[R.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6",children:"ä½“é‡ã¨ACWRã®ç›¸é–¢ã‚°ãƒ©ãƒ•"}),oe||je?R.jsx("div",{className:"flex items-center justify-center h-96",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):R.jsx(Mr,{acwrData:he,weightData:ye})]}),R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:R.jsx(Er,{acwrData:he,weightData:ye})})]}):"performance"===Y?R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:R.jsx(Fs,{user:e,onBackHome:()=>Z("unified")})}):"conditioning"===Y?R.jsxs("div",{className:"space-y-6",children:[R.jsx(oa,{latestACWR:be,sleepHours:(null==(u=Ie())?void 0:u.sleep_hours)?Number(Ie().sleep_hours):null,sleepQuality:(null==(g=Ie())?void 0:g.sleep_quality)??null,motivationLevel:(null==(h=Ze())?void 0:h.motivation_level)??null,energyLevel:(null==(b=Ze())?void 0:b.energy_level)??null,stressLevel:(null==(p=Ze())?void 0:p.stress_level)??null}),R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ç¡çœ è¨˜éŒ²"}),R.jsx(pt,{className:"w-6 h-6 text-indigo-500"})]}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:Bt.sleep}),R.jsx(sa,{onSubmit:$e,onCheckExisting:Ae,onUpdate:ze,loading:Te,lastRecord:zt})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç¡çœ æ¨ç§»ã‚°ãƒ©ãƒ•"}),Te?R.jsx("div",{className:"flex items-center justify-center h-96",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):R.jsx(ia,{data:Re})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"7æ—¥å¹³å‡ç¡çœ æ™‚é–“"}),R.jsxs("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:[(null==(y=qe(7))?void 0:y.toFixed(1))||"-","h"]})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"7æ—¥å¹³å‡ç¡çœ ã®è³ª"}),R.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[(null==(f=Fe(7))?void 0:f.toFixed(1))||"-","/5"]})]})]})]}),R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²"}),R.jsx(at,{className:"w-6 h-6 text-blue-500"})]}),R.jsx(la,{onSubmit:Ue,onCheckExisting:Be,onUpdate:He,loading:We,lastRecord:Ft??void 0})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ¨ç§»ã‚°ãƒ©ãƒ•"}),We?R.jsx("div",{className:"flex items-center justify-center h-96",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):R.jsx(da,{data:Oe})]}),R.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"å¹³å‡æ„æ¬²"}),R.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[(null==(j=Ke(7))?void 0:j.toFixed(1))||"-","/10"]})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"å¹³å‡ä½“åŠ›"}),R.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[(null==(v=Je(7))?void 0:v.toFixed(1))||"-","/10"]})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors",children:[R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"å¹³å‡ã‚¹ãƒˆãƒ¬ã‚¹"}),R.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[(null==(w=Ye(7))?void 0:w.toFixed(1))||"-","/10"]})]})]})]})]}):"cycle"===Y?R.jsx(hs,{userId:e.id,gender:se}):"gamification"===Y?R.jsx(ls,{user:e}):"messages"===Y?R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:R.jsx(qs,{userId:e.id,userName:e.name,onClose:()=>Z("unified")})}):"settings"===Y?R.jsx(As,{user:e,onOpenProfileEdit:()=>U(!0)}):null}),L&&R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:R.jsx(zs,{user:e,trainingRecords:de,acwrData:he,onClose:()=>P(!1)})}),B&&R.jsx($r,{user:e,onUpdate:async()=>{await(null==o?void 0:o())},onClose:()=>U(!1)}),R.jsx(Ir,{steps:aa("athlete"),isActive:ot,onComplete:mt,onSkip:gt,currentStepIndex:bt,onStepChange:yt}),O&&R.jsx(ma,{userId:e.id,userGender:se,onTrainingSubmit:tr,onTrainingCheckExisting:ce,onTrainingUpdate:rr,onWeightSubmit:we,onWeightCheckExisting:ve,onWeightUpdate:Ne,onSleepSubmit:$e,onSleepCheckExisting:Ae,onSleepUpdate:ze,onMotivationSubmit:Ue,onMotivationCheckExisting:Be,onMotivationUpdate:He,onCycleSubmit:lt,onCycleUpdate:dt,onClose:()=>W(!1),lastTrainingRecord:Tt??null,lastWeightRecord:$t?{weight_kg:Number($t.weight_kg),date:$t.date}:null,lastSleepRecord:zt??null,lastMotivationRecord:Ft??null}),"unified"===Y&&R.jsx(ha,{onClick:()=>W(!0),onCameraClick:Q?()=>{var e;return null==(e=lr.current)?void 0:e.click()}:void 0}),R.jsx("input",{ref:lr,type:"file",accept:"image/*",className:"absolute -left-[9999px] top-0 w-px h-px opacity-0",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];e.target.value="",r&&ir(r)}}),Ht&&"none"!==Ut.mode&&R.jsx(js,{open:Ht,mode:"welcome_back"===Ut.mode?"welcome_back":"daily_tip",daysAway:Ut.daysAway,message:Jt,onClose:Ut.dismiss})]})}function Ls({athletes:e,onAthleteSelect:t,athleteACWRMap:a={},weekCardMap:s={}}){const[n,l]=r.useState(""),[i,d]=r.useState("all"),[o,c]=r.useState("all"),x=e=>(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||"åå‰æœªè¨­å®š",m=r.useMemo(()=>{const t=n.trim().toLowerCase();return e.filter(e=>{const r=a[e.id],n=(null==r?void 0:r.daysOfData)??("number"==typeof e.training_days_28d?e.training_days_28d:null),l=null!==n&&n>=21&&"number"==typeof(null==r?void 0:r.currentACWR)&&Number.isFinite(r.currentACWR)&&r.currentACWR>0?(null==r?void 0:r.riskLevel)??"unknown":"unknown",d="all"===i||"high"===l,c=s[e.id],m="all"===o||!!(null==c?void 0:c.is_sharing_active),u=`${x(e)}`.toLowerCase(),g=""===t||u.includes(t);return d&&m&&g})},[e,n,i,o,a,s]),u=e=>{switch(e){case"high":return R.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700",children:"é«˜ãƒªã‚¹ã‚¯"});case"caution":return R.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-700",children:"æ³¨æ„"});case"good":return R.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",children:"è‰¯å¥½"});case"low":return R.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-sky-100 text-sky-700",children:"ä½è² è·"});default:return R.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-500",children:"ä¸æ˜"})}},g=e=>{if(!e)return"è¨˜éŒ²ãªã—";const t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){const r=Number(t[2]),a=Number(t[3]);return Number.isFinite(r)&&Number.isFinite(a)?`${r}/${a}`:e}try{const t=new Date(e);return Number.isNaN(t.getTime())?e:`${t.getMonth()+1}/${t.getDate()}`}catch{return e}},h=e=>null==e||Number.isNaN(e)?"-":e.toFixed(1),b=e=>null==e||Number.isNaN(e)?"-":String(Math.round(e)),p=e=>!!(null==e?void 0:e.is_sharing_active)?R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200",children:[R.jsx(Jt,{className:"w-3 h-3"}),"å…±æœ‰ON"]}):R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-600 border border-gray-200",children:[R.jsx(xt,{className:"w-3 h-3"}),"å…±æœ‰OFF"]});return R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[R.jsxs("div",{className:"relative flex-1",children:[R.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"åå‰ã§æ¤œç´¢",className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),R.jsx(pe,{className:"w-4 h-4 text-gray-400 absolute left-2.5 top-2.5"})]}),R.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[R.jsx("button",{type:"button",onClick:()=>d("all"),className:"px-3 py-1.5 rounded-full text-xs font-medium border "+("all"===i?"bg-green-50 text-green-700 border-green-200":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50"),children:"å…¨å“¡è¡¨ç¤º"}),R.jsxs("button",{type:"button",onClick:()=>d("high"),className:"px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 "+("high"===i?"bg-red-50 text-red-700 border-red-200":"bg-white text-gray-600 border-gray-200 hover:bg-red-50 hover:text-red-700"),children:[R.jsx(fe,{className:"w-3 h-3"}),"é«˜ãƒªã‚¹ã‚¯ã®ã¿"]}),R.jsxs("button",{type:"button",onClick:()=>c("on"===o?"all":"on"),className:"px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 "+("on"===o?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-white text-gray-600 border-gray-200 hover:bg-emerald-50 hover:text-emerald-700"),title:"å…±æœ‰ONã®é¸æ‰‹ã ã‘è¡¨ç¤º",children:[R.jsx(Jt,{className:"w-3 h-3"}),"å…±æœ‰ONã®ã¿"]})]})]}),R.jsx("div",{className:"divide-y divide-gray-100 border border-gray-100 rounded-xl bg-white",children:0===m.length?R.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"æ¡ä»¶ã«åˆã†é¸æ‰‹ãŒã„ã¾ã›ã‚“"}):m.map(e=>{const r=a[e.id],n=(null==r?void 0:r.daysOfData)??("number"==typeof e.training_days_28d?e.training_days_28d:null),l=null!==n&&n>=21&&"number"==typeof(null==r?void 0:r.currentACWR)&&Number.isFinite(r.currentACWR)&&r.currentACWR>0,i=l?(null==r?void 0:r.riskLevel)??"unknown":"unknown",d=l?r.currentACWR.toFixed(2):"æº–å‚™ä¸­",o=null!==n?Math.max(21-n,0):null,c=s[e.id],m=!!(null==c?void 0:c.is_sharing_active),y=!m;return R.jsxs("button",{type:"button",onClick:()=>{y||t(e)},disabled:y,className:"w-full flex items-stretch justify-between px-4 sm:px-5 py-3 sm:py-4 text-left transition-colors "+(y?"opacity-60 cursor-not-allowed bg-white":"hover:bg-gray-50"),title:y?"ã“ã®é¸æ‰‹ã¯ç¾åœ¨ã€å…±æœ‰ãŒOFFã§ã™ï¼ˆğŸ”’ï¼‰":"è©³ç´°ã‚’é–‹ã",children:[R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[R.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:x(e)}),e.nickname&&e.name&&R.jsxs("p",{className:"text-xs text-gray-400 truncate",children:["(",e.name,")"]}),p(c)]}),R.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-[11px] sm:text-xs text-gray-500",children:[R.jsxs("span",{children:["ç›´è¿‘28æ—¥ï¼š ",e.training_days_28d??0,"æ—¥ / ",e.training_sessions_28d??0,"å›"]}),R.jsxs("span",{children:["æœ€çµ‚å…¥åŠ›ï¼š ",g(e.last_training_date??null)]})]}),m&&c&&R.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] sm:text-xs",children:[c.action_total>0?R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:[R.jsx(Re,{className:"w-3 h-3"}),"è¡Œå‹• ",c.action_done,"/",c.action_total]}):R.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-50 text-gray-600 border border-gray-200",children:"è¡Œå‹• -"}),R.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200",children:["ç¡çœ  ",h(c.sleep_hours_avg),"h / è³ª ",h(c.sleep_quality_avg)]}),R.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:["ãƒ¢ãƒ ",b(c.motivation_avg),"ãƒ»ã‚¨ãƒ ",b(c.energy_avg),"ãƒ»ã‚¹ãƒˆ ",b(c.stress_avg)]})]}),!m&&R.jsx("div",{className:"mt-2 text-[11px] sm:text-xs text-gray-500",children:"ğŸ”’ å…±æœ‰ãŒOFFã®ãŸã‚ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã¯è¡¨ç¤ºã§ãã¾ã›ã‚“"})]}),R.jsxs("div",{className:"flex flex-col items-end justify-center ml-4",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[R.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500",children:"ACWR"}),R.jsx("span",{className:"text-sm sm:text-base font-semibold "+(l?"text-gray-900":"text-gray-400"),children:d})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[u(i),R.jsx(qe,{className:"w-4 h-4 text-gray-300"})]}),!l&&R.jsxs("p",{className:"mt-1 text-[10px] sm:text-xs text-gray-400 text-right",children:["ACWRæº–å‚™ï¼š",n??0,"/",21,"æ—¥",null!==o&&o>0?`ï¼ˆã‚ã¨${o}æ—¥ï¼‰`:""]})]})]},e.id)})})]})}const Ps=e=>Array.from(new Set(e)).slice(0,2),Os={high:3,caution:2,low:1};function Ws(e){const{id:t,name:r,acwrInfo:a,weekCard:s,noData:n}=e,l=!!(null==s?void 0:s.is_sharing_active),i=(null==a?void 0:a.currentACWR)??null,d=(null==s?void 0:s.sleep_hours_avg)??null,o=(null==n?void 0:n.daysSinceLast)??null,c=[];let x=!1;if(null!=o&&o>=14&&(x=!0,c.push("æœªå…¥åŠ›")),l&&"number"==typeof i&&i>=1.5&&(x=!0,c.push("è² è·æ€¥å¢—")),l&&"number"==typeof d&&d<=5&&(x=!0,c.push("ç¡çœ â†“")),x)return{id:t,name:r,riskLevel:"high",reasons:Ps(c),acwr:i};let m=!1;return null!=o&&o>=7&&(m=!0,c.push("æœªå…¥åŠ›")),l&&"number"==typeof i&&i>=1.3&&(m=!0,c.push("è² è·ã‚„ã‚„é«˜")),l&&"number"==typeof d&&d<=5.5&&(m=!0,c.push("ç¡çœ â†“")),m?{id:t,name:r,riskLevel:"caution",reasons:Ps(c),acwr:i}:{id:t,name:r,riskLevel:"low",reasons:[],acwr:i}}function Bs(e){switch(e){case"high":return"bg-red-50 text-red-700 border-red-200";case"caution":return"bg-amber-50 text-amber-700 border-amber-200";case"low":return"bg-emerald-50 text-emerald-700 border-emerald-200";default:return"bg-gray-50 text-gray-500 border-gray-200"}}function Us(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"low":return"å®‰å®š";default:return"ä¸æ˜"}}function Hs(e){const t=e.reasons||[],r=t.includes("æœªå…¥åŠ›"),a=t.includes("è² è·æ€¥å¢—")||t.includes("è² è·ã‚„ã‚„é«˜"),s=t.includes("ç¡çœ â†“");return"high"===e.riskLevel?[r?"å…¥åŠ›ãŒæ­¢ã¾ã£ã¦ã„ã‚‹ç†ç”±ã‚’ç¢ºèªï¼ˆä½“èª¿/å¿™ã—ã•/å…¥åŠ›å°ç·šï¼‰":"ä¸»è¦³ç–²åŠ´ãƒ»ç—›ã¿ãƒ»é•å’Œæ„Ÿã®æœ‰ç„¡ã‚’ç¢ºèª",a?"ç·´ç¿’å¾ŒRPEã®ç¢ºèªï¼‹æ¬¡å›ã¯å¼·åº¦oré‡ã‚’ä¸€æ®µè½ã¨ã™æ¤œè¨":"ä»Šæ—¥ã€œæ˜æ—¥ã®å›å¾©æŒ‡æ¨™ï¼ˆç¡çœ /é£Ÿæ¬²/æ°—åˆ†ï¼‰ã‚’ç¢ºèª",s?"ä»Šå¤œã®ç¡çœ ç¢ºä¿ï¼ˆå°±å¯æ™‚åˆ»ã®ææ¡ˆãƒ»ã‚¹ãƒãƒ›/ã‚«ãƒ•ã‚§ã‚¤ãƒ³ï¼‰":"48æ™‚é–“ã®çµŒéè¦³å¯Ÿï¼ˆç—‡çŠ¶ãŒã‚ã‚Œã°ç·´ç¿’å†…å®¹èª¿æ•´ï¼‰"]:"caution"===e.riskLevel?[a?"æ¬¡å›ã®è² è·ã‚’å¾®èª¿æ•´ï¼ˆé‡/å¼·åº¦ã®ã©ã¡ã‚‰ã‹ã‚’è»½ãï¼‰":"å›å¾©çŠ¶æ³ã‚’ä¸€è¨€ãƒ’ã‚¢ãƒªãƒ³ã‚°",s?"ç¡çœ ã®ç¢ºä¿ï¼ˆæœ€ä½6hç›®æ¨™ã€å°±å¯å‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ï¼‰":"ç·´ç¿’å¾Œã®ãƒªã‚«ãƒãƒªãƒ¼ï¼ˆè£œé£Ÿ/å…¥æµ´/ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‰ã‚’ä¿ƒã™",r?"å…¥åŠ›ã®ç¿’æ…£ã¥ã‘ï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°å›ºå®šï¼šç·´ç¿’å¾Œ/å°±å¯å‰ãªã©ï¼‰":"çŠ¶æ…‹ãŒä¸Šå‘ã‘ã°é€šå¸¸é‹ç”¨ã¸"]:["çŠ¶æ…‹ã¯å®‰å®šã€‚è‰¯ã„ç¿’æ…£ã‚’ç¶™ç¶š","è‰¯ã‹ã£ãŸç‚¹ã‚’ä¸€è¨€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆç¶™ç¶šã®å¼·åŒ–ï¼‰","ä»Šé€±ã®ç›®æ¨™ã‚’å†ç¢ºèªã—ã¦é€²ã‚ã‚‹"]}function Vs(e){if(!e)return"";if("string"==typeof e){const t=e.includes("T")?e.split("T")[0]:e;if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t}const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}function Ks(e){const t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return e||"";const r=Number(t[2]),a=Number(t[3]);return Number.isFinite(r)&&Number.isFinite(a)?`${r}/${a}`:e}function Js(e){return null!=e&&Number.isFinite(e)?e>0?{arrow:"â†‘",tone:"text-red-600"}:e<0?{arrow:"â†“",tone:"text-emerald-600"}:{arrow:"â†’",tone:"text-gray-600"}:{arrow:"â€“",tone:"text-gray-500"}}function Ys({athlete:e,onClose:t,risk:a,weekCard:n}){var m;const{records:g,weightRecords:h,acwrData:b,loading:p}=Hr(e.id),[j,v]=r.useState("overview"),w=b.length>0?b[b.length-1]:null,N=g.slice(-7),k=b.length>=2?b[b.length-2]:null,_=null!=(null==w?void 0:w.acwr)&&Number.isFinite(Number(w.acwr))?Number(w.acwr):null,C=null!=(null==k?void 0:k.acwr)&&Number.isFinite(Number(k.acwr))?Number(k.acwr):null,S=null!=_&&null!=C?_-C:null,D=Js(S),M=r.useMemo(()=>(Array.isArray(h)?h:[]).map(e=>{const t=e.weight_kg??e.weight??e.body_weight??null,r=Vs(e.date);if(!r)return null;const a=null!=t?Number(t):null;return null!=a&&Number.isFinite(a)?{rawDate:r,date:Ks(r),weight:a}:null}).filter(Boolean),[h]),E=M.length>0?M[M.length-1]:null,T=M.length>=2?M[M.length-2]:null,A=null!=(null==E?void 0:E.weight)&&Number.isFinite(E.weight)?E.weight:null,$=null!=(null==T?void 0:T.weight)&&Number.isFinite(T.weight)?T.weight:null,z=null!=A&&null!=$?A-$:null,q=Js(z),F=g.slice(-7),I=g.slice(-14,-7),L=e=>e.reduce((e,t)=>{const r=Number(t.rpe??t.session_rpe),a=Number(t.duration_min??t.duration_minutes??t.duration);return Number.isFinite(r)&&Number.isFinite(a)?e+r*a:e},0),P=F.length>0?L(F):null,O=I.length>0?L(I):null,W=null!=P&&null!=O?P-O:null,B=Js(W),U=r.useMemo(()=>{if(!Array.isArray(g)||0===g.length)return[];const e={};Array.isArray(b)&&b.forEach(t=>{const r=Vs(null==t?void 0:t.date);if(!r)return;const a=t.acwr??t.ACWR??t.value??null,s=null!=a?Number(a):null;null!=s&&Number.isFinite(s)&&(e[r]=s)});const t=g.map(t=>{const r=Vs(t.date);if(!r)return null;const a=t.rpe??t.session_rpe??null,s=t.duration_min??t.duration_minutes??t.duration??null,n=null!=a?Number(a):null,l=null!=s?Number(s):null;let i=null;null!=n&&null!=l&&Number.isFinite(n)&&Number.isFinite(l)&&(i=n*l);const d=null!=e[r]?e[r]:null;return null==i&&null==d&&null==n?null:{rawDate:r,date:Ks(r),rpe:null!=n&&Number.isFinite(n)?n:null,load:i,acwr:d}}).filter(Boolean);return t.sort((e,t)=>e.rawDate<t.rawDate?-1:e.rawDate>t.rawDate?1:0),console.log("[AthleteDetailModal] rpeLoadAcwrChartData sample:",t.slice(0,5)),t},[g,b]),H=r.useMemo(()=>{const e=new Map;for(const r of U)e.set(r.rawDate,{...r});for(const r of M){const t=e.get(r.rawDate)??{rawDate:r.rawDate,date:r.date};e.set(r.rawDate,{...t,weight:r.weight,date:t.date??r.date})}const t=Array.from(e.values());return t.sort((e,t)=>e.rawDate<t.rawDate?-1:e.rawDate>t.rawDate?1:0),t},[U,M]);if(p)return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:R.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] flex items-center justify-center",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})});const V=w?Ks(Vs(w.date)):"";return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[R.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[R.jsx(pe,{className:"w-5 h-5"}),e.nickname||e.name||"é¸æ‰‹"]}),R.jsx("p",{className:"text-sm text-blue-100 mt-1",children:e.email})]}),R.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:R.jsx(sr,{className:"w-5 h-5"})})]}),a&&R.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 mb-4",children:[R.jsx("div",{className:"flex items-start justify-between gap-3",children:R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${Bs(a.riskLevel)}`,children:Us(a.riskLevel)}),"number"==typeof a.acwr&&R.jsxs("span",{className:"text-xs text-gray-600",children:["ACWR ",R.jsx("b",{children:a.acwr.toFixed(2)})]}),!1===(null==n?void 0:n.is_sharing_active)&&R.jsx("span",{className:"text-xs px-2 py-1 rounded-full border bg-gray-50 text-gray-600 border-gray-200",children:"ğŸ”’ å…±æœ‰OFF"})]}),(null==(m=a.reasons)?void 0:m.length)>0&&R.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a.reasons.slice(0,2).map(e=>R.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full border bg-gray-50 text-gray-700 border-gray-200",children:e},e))})]})}),R.jsxs("div",{className:"mt-3 text-sm text-gray-800",children:[R.jsx("div",{className:"font-semibold mb-1",children:"æ¬¡ã®ä¸€æ‰‹"}),R.jsx("ul",{className:"list-disc pl-5 space-y-1",children:Hs(a).map(e=>R.jsx("li",{children:e},e))})]})]}),R.jsx("div",{className:"border-b border-gray-200 px-6 pt-3",children:R.jsxs("div",{className:"flex gap-4 overflow-x-auto text-sm",children:[R.jsx("button",{onClick:()=>v("overview"),className:"pb-3 border-b-2 "+("overview"===j?"border-blue-500 text-blue-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"),children:"æ¦‚è¦"}),R.jsxs("button",{onClick:()=>v("weight"),className:"pb-3 border-b-2 flex items-center gap-1 "+("weight"===j?"border-green-500 text-green-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"),children:[R.jsx(Et,{className:"w-4 h-4"}),"ä½“é‡æ¨ç§»"]}),R.jsxs("button",{onClick:()=>v("rpe"),className:"pb-3 border-b-2 flex items-center gap-1 "+("rpe"===j?"border-purple-500 text-purple-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-700"),children:[R.jsx(Ne,{className:"w-4 h-4"}),"RPE / è² è· / ACWR"]})]})}),R.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:["overview"===j&&R.jsx("div",{className:"space-y-4",children:R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-4",children:[R.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[R.jsx("p",{className:"text-xs text-blue-700 mb-1",children:"æœ€æ–° ACWR"}),R.jsx("p",{className:"text-2xl font-bold text-blue-900",children:null!=(null==w?void 0:w.acwr)?Number(w.acwr).toFixed(2):"--"}),R.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[R.jsx("span",{className:`${D.tone} font-semibold`,children:D.arrow}),R.jsxs("span",{className:"text-gray-600",children:["å‰å›æ¯”ï¼š",R.jsx("b",{className:"ml-1",children:null!=S?`${S>=0?"+":""}${S.toFixed(2)}`:"--"})]})]}),w&&R.jsx("p",{className:"text-xs text-blue-700 mt-1",children:V})]}),R.jsxs("div",{className:"bg-green-50 rounded-xl p-4",children:[R.jsx("p",{className:"text-xs text-green-700 mb-1",children:"ç›´è¿‘7æ—¥é–“ã®è¨˜éŒ²æ•°"}),R.jsx("p",{className:"text-2xl font-bold text-green-900",children:N.length})]}),R.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[R.jsx("p",{className:"text-xs text-gray-700 mb-1",children:"ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°"}),R.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.length})]}),R.jsxs("div",{className:"bg-green-50 rounded-xl p-4",children:[R.jsx("p",{className:"text-xs text-green-700 mb-1",children:"æœ€æ–° ä½“é‡"}),R.jsx("p",{className:"text-2xl font-bold text-green-900",children:null!=A?A.toFixed(1):"--"}),R.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[R.jsx("span",{className:`${q.tone} font-semibold`,children:q.arrow}),R.jsxs("span",{className:"text-gray-600",children:["å‰å›æ¯”ï¼š",R.jsx("b",{className:"ml-1",children:null!=z?`${z>=0?"+":""}${z.toFixed(1)}kg`:"--"})]})]})]}),R.jsxs("div",{className:"bg-purple-50 rounded-xl p-4",children:[R.jsx("p",{className:"text-xs text-purple-700 mb-1",children:"ç›´è¿‘7æ—¥ Load"}),R.jsx("p",{className:"text-2xl font-bold text-purple-900",children:null!=P?Math.round(P):"--"}),R.jsxs("div",{className:"mt-1 text-xs flex items-center gap-2",children:[R.jsx("span",{className:`${B.tone} font-semibold`,children:B.arrow}),R.jsxs("span",{className:"text-gray-600",children:["å‰é€±æ¯”ï¼š",R.jsx("b",{className:"ml-1",children:null!=W?`${W>=0?"+":""}${Math.round(W)}`:"--"})]})]})]})]})}),"weight"===j&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[R.jsx(Et,{className:"w-4 h-4 text-green-500"}),"ä½“é‡æ¨ç§» ï¼‹ è² è·ï¼ˆRPEÃ—æ™‚é–“ï¼‰"]}),R.jsxs("p",{className:"text-xs text-gray-500",children:["ä½“é‡ï¼š",M.length,"ä»¶ / ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ï¼š",U.length,"ä»¶"]}),0===H.length?R.jsx("p",{className:"text-sm text-gray-500",children:"ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚"}):R.jsx("div",{className:"h-72",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(f,{data:H,children:[R.jsx(l,{strokeDasharray:"3 3"}),R.jsx(i,{dataKey:"date"}),R.jsx(d,{yAxisId:"left",orientation:"left",tick:{fontSize:12},tickFormatter:e=>`${Math.round(e)}`}),R.jsx(d,{yAxisId:"right",orientation:"right",tick:{fontSize:12},tickFormatter:e=>`${e.toFixed(1)}`}),R.jsx(o,{formatter:(e,t)=>"number"!=typeof e?e:"ä½“é‡"===t?[e.toFixed(1),t]:[Math.round(e),t]}),R.jsx(u,{}),R.jsx(y,{yAxisId:"left",dataKey:"load",name:"è² è·ï¼ˆRPEÃ—æ™‚é–“ï¼‰",fill:"#60a5fa",opacity:.85}),R.jsx(x,{yAxisId:"right",type:"monotone",dataKey:"weight",name:"ä½“é‡",stroke:"#22c55e",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0})]})})}),R.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["ãƒ»é’ã„æ£’ï¼šè² è·ï¼ˆRPEÃ—æ™‚é–“ or loadã‚«ãƒ©ãƒ ï¼‰",R.jsx("br",{}),"ãƒ»ç·‘ã®ç·šï¼šä½“é‡ï¼ˆkgï¼‰",R.jsx("br",{}),"â€» æ—¥ä»˜ã¯YYYY-MM-DDã‚’æ–‡å­—åˆ—å‡¦ç†ã—ã¦ã„ã‚‹ã®ã§ã€JSTã§ã‚‚ã‚ºãƒ¬ã¾ã›ã‚“ã€‚"]})]}),"rpe"===j&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[R.jsx(Ne,{className:"w-4 h-4 text-purple-500"}),"RPEãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³è² è·ãƒ»ACWR"]}),R.jsxs("p",{className:"text-xs text-gray-500",children:["ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ï¼š",U.length," ä»¶"]}),0===U.length?R.jsx("p",{className:"text-sm text-gray-500",children:"RPE ã¾ãŸã¯ç·´ç¿’æ™‚é–“ãŒè¨˜éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚"}):R.jsx("div",{className:"h-72",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(f,{data:U,children:[R.jsx(l,{strokeDasharray:"3 3"}),R.jsx(i,{dataKey:"date"}),R.jsx(d,{yAxisId:"left",orientation:"left",tick:{fontSize:12},tickFormatter:e=>`${Math.round(e)}`}),R.jsx(d,{yAxisId:"right",orientation:"right",tick:{fontSize:12},domain:[0,10],tickFormatter:e=>e.toFixed(1)}),R.jsx(o,{formatter:(e,t)=>"number"!=typeof e?e:"ACWR"===t?[e.toFixed(2),t]:"RPE"===t?[e.toFixed(1),t]:[Math.round(e),t]}),R.jsx(u,{}),R.jsx(y,{yAxisId:"left",dataKey:"load",name:"è² è·ï¼ˆRPEÃ—æ™‚é–“ï¼‰",fill:"#60a5fa",opacity:.85}),R.jsx(x,{yAxisId:"right",type:"monotone",dataKey:"rpe",name:"RPE",stroke:"#f97316",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0}),R.jsx(x,{yAxisId:"right",type:"monotone",dataKey:"acwr",name:"ACWR",stroke:"#a855f7",strokeWidth:2,dot:{r:3},activeDot:{r:5},connectNulls:!0}),R.jsx(c,{yAxisId:"right",y:.8,stroke:"#22c55e",strokeDasharray:"4 4",ifOverflow:"extendDomain"}),R.jsx(c,{yAxisId:"right",y:1.3,stroke:"#f97316",strokeDasharray:"4 4",ifOverflow:"extendDomain"})]})})}),R.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["ãƒ»æ£’ï¼šè² è·ï¼ˆRPE Ã— ç·´ç¿’æ™‚é–“ or loadï¼‰",R.jsx("br",{}),"ãƒ»ã‚ªãƒ¬ãƒ³ã‚¸ï¼šRPEï¼ˆå³è»¸ï¼‰",R.jsx("br",{}),"ãƒ»ç´«ï¼šACWRï¼ˆå³è»¸ï¼‰"]})]})]})]})})}const Zs=e=>e.averageRPE??e.avg_rpe??e.rpe_avg??null,Gs=e=>e.averageLoad??e.avg_load??e.load_avg??null;function Qs({showRPE:e,showLoad:t,onToggle:r}){return R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("span",{className:"hidden sm:inline text-xs text-gray-500 mr-1",children:"å³è»¸ã®è¡¨ç¤º"}),R.jsxs("button",{type:"button",onClick:()=>r("rpe"),className:["inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold","shadow-sm transition","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",e?"bg-white border-blue-200 text-blue-700":"bg-gray-50 border-gray-200 text-gray-500 hover:bg-white"].join(" "),"aria-pressed":e,children:[R.jsx("span",{className:["inline-flex h-5 w-9 items-center rounded-full p-0.5 transition",e?"bg-blue-600":"bg-gray-300"].join(" "),children:R.jsx("span",{className:["h-4 w-4 rounded-full bg-white shadow transition",e?"translate-x-4":"translate-x-0"].join(" ")})}),"å¹³å‡RPE"]}),R.jsxs("button",{type:"button",onClick:()=>r("load"),className:["inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold","shadow-sm transition","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",t?"bg-white border-emerald-200 text-emerald-700":"bg-gray-50 border-gray-200 text-gray-500 hover:bg-white"].join(" "),"aria-pressed":t,children:[R.jsx("span",{className:["inline-flex h-5 w-9 items-center rounded-full p-0.5 transition",t?"bg-emerald-600":"bg-gray-300"].join(" "),children:R.jsx("span",{className:["h-4 w-4 rounded-full bg-white shadow transition",t?"translate-x-4":"translate-x-0"].join(" ")})}),"å¹³å‡Load"]})]})}function Xs({data:e,teamName:t,showAvgRPE:a=!0,showAvgLoad:m=!1}){const[g,h]=r.useState("month"),[b,p]=r.useState(a),[y,f]=r.useState(m),j=r.useMemo(()=>{if(!e||0===e.length)return[];const t=new Date;let r;switch(g){case"week":r=new Date(t),r.setDate(t.getDate()-7);break;case"month":r=new Date(t),r.setDate(t.getDate()-30);break;case"quarter":r=new Date(t),r.setDate(t.getDate()-90);break;default:return e}return e.filter(e=>{const a=new Date(e.date);return a>=r&&a<=t})},[e,g]),v=r.useMemo(()=>(j||[]).map(e=>({...e,avgRPE:Zs(e),avgLoad:Gs(e)})),[j]),w=r.useMemo(()=>(v||[]).filter(e=>!(!e||"string"!=typeof e.date)&&!("number"!=typeof e.averageACWR||!Number.isFinite(e.averageACWR))).map(e=>({...e,averageACWR:Math.max(0,e.averageACWR),avgRPE:"number"==typeof e.avgRPE&&Number.isFinite(e.avgRPE)?e.avgRPE:null,avgLoad:"number"==typeof e.avgLoad&&Number.isFinite(e.avgLoad)?e.avgLoad:null})),[v]),N=r.useMemo(()=>w.some(e=>"number"==typeof e.avgRPE),[w]),k=r.useMemo(()=>w.some(e=>"number"==typeof e.avgLoad),[w]),_=!!b&&N,C=!!y&&k,S=_||C;if(!e||0===e.length)return R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:R.jsxs("div",{className:"text-center px-4",children:[R.jsx("p",{className:"text-base sm:text-lg mb-2",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-sm",children:"é¸æ‰‹ã®ç·´ç¿’è¨˜éŒ²ãŒè“„ç©ã•ã‚Œã‚‹ã¨å¹³å‡ACWRãŒè¡¨ç¤ºã•ã‚Œã¾ã™"})]})});if(0===w.length)return R.jsx("div",{className:"flex items-center justify-center h-64 sm:h-96 text-gray-500",children:R.jsxs("div",{className:"text-center px-4",children:[R.jsx("p",{className:"text-base sm:text-lg mb-2",children:"æœ‰åŠ¹ãªACWRãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-sm",children:"ï¼ˆä¸æ­£ãªæ•°å€¤ãƒ»æ¬ æãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–ã—ã¾ã—ãŸï¼‰"})]})});const D=e=>{const t=new Date(e),r=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][t.getDay()];return`${t.getMonth()+1}/${t.getDate()}(${r})`},M=({active:e,payload:t,label:r})=>{var a;if(e&&t&&t.length){const e=null==(a=null==t?void 0:t[0])?void 0:a.payload,s=new Date(r),n=0===s.getDay()||6===s.getDay(),l=null==e?void 0:e.averageACWR,i=null==e?void 0:e.avgRPE,d=null==e?void 0:e.avgLoad;return R.jsxs("div",{className:"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs",children:[R.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[R.jsx("p",{className:"font-medium text-gray-900 text-sm sm:text-base",children:D(r)}),n&&R.jsx("span",{className:"bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-medium",children:"é€±æœ«"})]}),R.jsxs("div",{className:"space-y-1 text-xs sm:text-sm",children:[R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"å¹³å‡ACWR:"}),R.jsx("span",{className:"font-semibold",style:{color:le(null==e?void 0:e.riskLevel)},children:"number"==typeof l?l.toFixed(2):"-"})]}),_&&R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"å¹³å‡RPE:"}),R.jsx("span",{className:"font-semibold",children:"number"==typeof i?i.toFixed(2):"-"})]}),C&&R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"å¹³å‡Load:"}),R.jsx("span",{className:"font-semibold",children:"number"==typeof d?Math.round(d):"-"})]}),R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"å¹³å‡ã«ä½¿ç”¨:"}),R.jsxs("span",{className:"font-semibold",children:[null==e?void 0:e.athleteCount," / ",(null==e?void 0:e.rosterCount)??"-","å"]})]}),R.jsxs("p",{className:"flex justify-between",children:[R.jsx("span",{children:"ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«:"}),R.jsx("span",{className:"font-semibold",style:{color:le(null==e?void 0:e.riskLevel)},children:en(null==e?void 0:e.riskLevel)})]})]})]})}return null},E=e=>{const{cx:t,cy:r,payload:a}=e;if(t&&r&&a){const e=new Date(a.date),s=0===e.getDay()||6===e.getDay();return R.jsx("circle",{cx:t,cy:r,r:s?5:4,fill:le(a.riskLevel),strokeWidth:2,stroke:s?"#8B5CF6":"white",opacity:s?.9:1})}return null};return R.jsxs("div",{className:"w-full",children:[R.jsxs("div",{className:"mb-4 space-y-4",children:[R.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[R.jsxs("div",{children:[R.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 truncate",children:[R.jsxs("span",{className:"hidden sm:inline",children:[t," - "]}),"ãƒãƒ¼ãƒ å¹³å‡ACWRæ¨ç§»"]}),R.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:["å·¦è»¸ï¼šACWR",S?" / å³è»¸ï¼šRPEãƒ»Load":""]})]}),R.jsx(Qs,{showRPE:b,showLoad:y,onToggle:e=>{"rpe"===e&&p(e=>!e),"load"===e&&f(e=>!e)}})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx(Xe,{className:"w-4 h-4 text-gray-500"}),R.jsx("div",{className:"flex space-x-1",children:[{value:"week",label:"1é€±é–“"},{value:"month",label:"1ãƒ¶æœˆ"},{value:"quarter",label:"3ãƒ¶æœˆ"},{value:"all",label:"å…¨æœŸé–“"}].map(e=>R.jsx("button",{onClick:()=>h(e.value),className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors "+(g===e.value?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value))})]}),R.jsx("div",{className:"bg-purple-50 rounded-lg p-3",children:R.jsxs("div",{className:"flex items-center justify-between text-sm",children:[R.jsxs("div",{className:"flex items-center space-x-4",children:[R.jsxs("div",{children:[R.jsx("span",{className:"text-purple-600 font-medium",children:"è¡¨ç¤ºæœŸé–“:"}),R.jsx("span",{className:"text-purple-800 ml-1",children:"week"===g?"éå»7æ—¥é–“":"month"===g?"éå»30æ—¥é–“":"quarter"===g?"éå»90æ—¥é–“":"å…¨æœŸé–“"})]}),R.jsxs("div",{children:[R.jsx("span",{className:"text-purple-600 font-medium",children:"ãƒ‡ãƒ¼ã‚¿æ•°:"}),R.jsxs("span",{className:"text-purple-800 ml-1",children:[w.length,"æ—¥"]})]})]}),R.jsxs("div",{className:"flex items-center space-x-1",children:[R.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full border-2 border-purple-600"}),R.jsx("span",{className:"text-xs text-purple-600",children:"é€±æœ«ã¯ç´«ã®æ ã§å¼·èª¿"})]})]})}),b&&!N||y&&!k?R.jsx("div",{className:"text-xs bg-amber-50 border border-amber-200 text-amber-800 rounded-lg px-3 py-2",children:"è¡¨ç¤ºONã®æŒ‡æ¨™ãŒãƒ‡ãƒ¼ã‚¿ã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆå¹³å‡RPE/å¹³å‡Loadã®åˆ—ãŒæœªå–å¾—ã®å¯èƒ½æ€§ï¼‰ã€‚"}):null]}),R.jsx("div",{className:"h-64 sm:h-96",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:w,margin:{top:20,right:36,left:20,bottom:20},children:[R.jsx(l,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),R.jsx(i,{dataKey:"date",tickFormatter:e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`},stroke:"#6b7280",fontSize:10,interval:"preserveStartEnd"}),R.jsx(d,{yAxisId:"acwr",domain:[0,e=>Number.isFinite(e)?e+.5:2],stroke:"#6b7280",fontSize:10,width:40}),R.jsx(d,{yAxisId:"aux",orientation:"right",domain:[0,e=>Number.isFinite(e)?e:10],stroke:"#6b7280",fontSize:10,width:40,hide:!S}),R.jsx(o,{content:R.jsx(M,{})}),R.jsx(u,{}),R.jsx(c,{yAxisId:"acwr",y:1.5,stroke:"#EF4444",strokeDasharray:"5 5"}),R.jsx(c,{yAxisId:"acwr",y:1.3,stroke:"#F59E0B",strokeDasharray:"5 5"}),R.jsx(c,{yAxisId:"acwr",y:.8,stroke:"#10B981",strokeDasharray:"5 5"}),R.jsx(x,{type:"monotone",dataKey:"averageACWR",name:"å¹³å‡ACWR",yAxisId:"acwr",stroke:"#8B5CF6",strokeWidth:3,dot:R.jsx(E,{}),activeDot:{r:6,stroke:"#8B5CF6",strokeWidth:2,fill:"white"},connectNulls:!0}),_&&R.jsx(x,{type:"monotone",dataKey:"avgRPE",name:"å¹³å‡RPE",yAxisId:"aux",stroke:"#0EA5E9",strokeWidth:2,dot:!1,connectNulls:!0}),C&&R.jsx(x,{type:"monotone",dataKey:"avgLoad",name:"å¹³å‡Load",yAxisId:"aux",stroke:"#22C55E",strokeWidth:2,dot:!1,connectNulls:!0})]})})}),R.jsx("div",{className:"mt-4 flex justify-center",children:R.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),R.jsx("span",{children:"é«˜ãƒªã‚¹ã‚¯ (>1.5)"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-2"}),R.jsx("span",{children:"æ³¨æ„ (1.3-1.5)"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),R.jsx("span",{children:"è‰¯å¥½ (0.8-1.3)"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),R.jsx("span",{children:"ä½è² è· (<0.8)"})]})]})})]})}function en(e){switch(e){case"high":return"é«˜ãƒªã‚¹ã‚¯";case"caution":return"æ³¨æ„";case"good":return"è‰¯å¥½";case"low":return"ä½è² è·";default:return"ä¸æ˜"}}const tn={high:3,medium:2,low:1};function rn(e){return"high"===e||"medium"===e||"low"===e}function an(e,t){return tn[t]-tn[e]}function sn({alerts:e,onMarkAsRead:t,onDismiss:a,onMarkAllAsRead:s,onClose:n,userRole:l,selectedUserId:i,userNameMap:d={}}){const[o,c]=r.useState("all"),[x,m]=r.useState(!1),[u,g]=r.useState({}),h=e=>{const t=new Date,r=new Date(e),a=Math.floor((t.getTime()-r.getTime())/6e4);if(a<1)return"ãŸã£ãŸä»Š";if(a<60)return`${a}åˆ†å‰`;const s=Math.floor(a/60);if(s<24)return`${s}æ™‚é–“å‰`;return`${Math.floor(s/24)}æ—¥å‰`},b=e=>e.user_id??e.target_user_id??e.athlete_id,p=r.useMemo(()=>e.filter(e=>!(!x&&e.is_dismissed)),[e,x]),y=r.useMemo(()=>i?p.filter(e=>b(e)===i):p,[p,i]),f=r.useMemo(()=>y.filter(e=>!e.is_read&&!e.is_dismissed).length,[y]),j=r.useMemo(()=>y.filter(e=>"high"===e.priority&&!e.is_dismissed).length,[y]),v=r.useMemo(()=>{const e=new Map;for(const r of y){const t=b(r);t&&(e.has(t)||e.set(t,[]),e.get(t).push(r))}const t=[];for(const[r,a]of e.entries()){const e=a.map(e=>rn(e.priority)?e.priority:"low").sort(an)[0]??"low",s=a.filter(t=>(rn(t.priority)?t.priority:"low")===e).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),n=a.filter(e=>"medium"===(rn(e.priority)?e.priority:"low")).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),l=a.filter(e=>"low"===(rn(e.priority)?e.priority:"low")).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());t.push({userId:r,topPriority:e,topAlerts:s,included:{medium:"high"===e?n:[],low:"low"!==e?l:[]},totalCount:a.length,unreadCount:a.filter(e=>!e.is_read).length})}return t.sort((e,t)=>{var r,a;const s=an(e.topPriority,t.topPriority);if(0!==s)return s;if(t.unreadCount!==e.unreadCount)return t.unreadCount-e.unreadCount;const n=new Date((null==(r=e.topAlerts[0])?void 0:r.created_at)??0).getTime();return new Date((null==(a=t.topAlerts[0])?void 0:a.created_at)??0).getTime()-n})},[y]),w=r.useMemo(()=>v.filter(e=>"unread"===o?e.unreadCount>0:"high"!==o&&"medium"!==o&&"low"!==o||e.topPriority===o),[v,o]),N=!!i;return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[R.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center space-x-4",children:[R.jsx("div",{className:"bg-blue-500 rounded-full p-3",children:R.jsx(Vt,{className:"w-8 h-8"})}),R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-bold",children:N?"é¸æ‰‹ã‚¢ãƒ©ãƒ¼ãƒˆè©³ç´°":"ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥"}),R.jsxs("p",{className:"text-blue-100",children:[f>0?`${f}ä»¶ã®æœªèª­é€šçŸ¥`:"å…¨ã¦ç¢ºèªæ¸ˆã¿",j>0&&R.jsxs("span",{className:"ml-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs",children:["é«˜å„ªå…ˆåº¦ ",j,"ä»¶"]})]})]})]}),R.jsx("button",{onClick:n,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:R.jsx(sr,{className:"w-6 h-6"})})]})}),R.jsx("div",{className:"bg-gray-50 border-b border-gray-200 p-4",children:R.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-3 sm:space-y-0",children:[R.jsxs("div",{className:"flex flex-wrap items-center space-x-2",children:[R.jsx(Xe,{className:"w-4 h-4 text-gray-500"}),R.jsxs("select",{value:o,onChange:e=>c(e.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[R.jsx("option",{value:"all",children:N?"å…¨ã¦ï¼ˆã“ã®é¸æ‰‹ï¼‰":"å…¨ã¦ï¼ˆé¸æ‰‹å˜ä½ï¼‰"}),R.jsx("option",{value:"unread",children:N?"æœªèª­ã®ã¿ï¼ˆã“ã®é¸æ‰‹ï¼‰":"æœªèª­ã‚ã‚Šï¼ˆé¸æ‰‹ï¼‰"}),R.jsx("option",{value:"high",children:"é«˜ãƒªã‚¹ã‚¯"}),R.jsx("option",{value:"medium",children:"ä¸­ãƒªã‚¹ã‚¯"}),R.jsx("option",{value:"low",children:"ä½ãƒªã‚¹ã‚¯"})]}),R.jsxs("label",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[R.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"rounded"}),R.jsx("span",{children:"éè¡¨ç¤ºã‚’å«ã‚€"})]})]}),R.jsx("div",{className:"flex space-x-2",children:f>0&&R.jsxs("button",{onClick:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center space-x-1",children:[R.jsx(Ae,{className:"w-4 h-4"}),R.jsx("span",{children:"å…¨ã¦æ—¢èª­"})]})})]})}),R.jsx("div",{className:"overflow-y-auto max-h-[60vh] p-6",children:0===w.length?R.jsxs("div",{className:"text-center py-12",children:[R.jsx("div",{className:"text-gray-400 mb-4",children:R.jsx(Vt,{className:"w-16 h-16 mx-auto"})}),R.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"unread"===o?"æœªèª­ã®é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“":"é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-gray-600",children:"unread"===o?"å…¨ã¦ã®é€šçŸ¥ã‚’ç¢ºèªæ¸ˆã¿ã§ã™ã€‚":"ã‚·ã‚¹ãƒ†ãƒ ãŒç¶™ç¶šçš„ã«ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚"})]}):R.jsx("div",{className:"space-y-4",children:w.map(e=>{const r=e.topAlerts[0],s=X(r||{priority:e.topPriority}),n=d[e.userId]??"å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼",i=!!u[e.userId];return R.jsxs("div",{className:`${s.bgColor} ${s.borderColor} border rounded-lg p-4`,children:[R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[R.jsx("span",{className:"text-lg",children:s.icon}),R.jsx("h3",{className:`font-semibold ${s.textColor}`,children:"athlete"!==l?n:null==r?void 0:r.title}),R.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.bgColor} ${s.textColor} border ${s.borderColor}`,children:"high"===e.topPriority?"é«˜ãƒªã‚¹ã‚¯":"medium"===e.topPriority?"ä¸­ãƒªã‚¹ã‚¯":"ä½ãƒªã‚¹ã‚¯"}),e.unreadCount>0&&R.jsxs("span",{className:"ml-1 inline-flex items-center text-xs",children:[R.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full mr-2"}),R.jsxs("span",{className:"text-gray-600",children:["æœªèª­ ",e.unreadCount]})]}),e.included.medium.length+e.included.low.length>0&&R.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["é–¢é€£è¦å›  ",e.included.medium.length+e.included.low.length,"ä»¶"]})]}),R.jsxs("div",{className:"space-y-2",children:[e.topAlerts.slice(0,2).map(e=>R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.bgColor} ${s.textColor} border ${s.borderColor}`,children:ee(e.type)}),R.jsx("span",{className:`font-semibold ${s.textColor}`,children:e.title})]}),R.jsx("p",{className:`${s.textColor} mt-1`,children:e.message}),e.acwr_value&&R.jsx("div",{className:"bg-white bg-opacity-50 rounded p-2 mt-2",children:R.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[R.jsxs("div",{children:[R.jsx("span",{className:"text-gray-600",children:"ACWRå€¤:"}),R.jsx("span",{className:`font-bold ml-1 ${s.textColor}`,children:e.acwr_value})]}),e.threshold_exceeded&&R.jsxs("div",{children:[R.jsx("span",{className:"text-gray-600",children:"é–¾å€¤:"}),R.jsx("span",{className:"font-medium ml-1",children:e.threshold_exceeded})]})]})}),R.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:[R.jsxs("div",{className:"flex items-center space-x-1",children:[R.jsx(Oe,{className:"w-3 h-3"}),R.jsx("span",{children:h(e.created_at)})]}),"athlete"!==l&&R.jsxs("div",{className:"flex items-center space-x-1",children:[R.jsx(er,{className:"w-3 h-3"}),R.jsx("span",{children:n})]})]}),R.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[!e.is_read&&R.jsx("button",{onClick:()=>t(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${s.iconColor}`,title:"æ—¢èª­ã«ã™ã‚‹",children:R.jsx(Ze,{className:"w-4 h-4"})}),!e.is_dismissed&&R.jsx("button",{onClick:()=>a(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${s.iconColor}`,title:"éè¡¨ç¤ºã«ã™ã‚‹",children:R.jsx(Ye,{className:"w-4 h-4"})})]})]},e.id)),e.topAlerts.length>2&&R.jsxs("div",{className:"text-xs text-gray-600",children:["ã»ã‹ ",e.topAlerts.length-2," ä»¶ã®åŒå„ªå…ˆåº¦ã‚¢ãƒ©ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã™"]})]})]}),e.included.medium.length+e.included.low.length>0&&R.jsx("button",{onClick:()=>{return t=e.userId,void g(e=>({...e,[t]:!e[t]}));var t},className:"ml-4 text-gray-700 hover:text-gray-900 flex items-center space-x-1",title:"é–¢é€£è¦å› ã‚’è¡¨ç¤º",children:i?R.jsx($e,{className:"w-5 h-5"}):R.jsx(qe,{className:"w-5 h-5"})})]}),e.included.medium.length+e.included.low.length>0&&i&&R.jsxs("div",{className:"mt-4 bg-white bg-opacity-60 rounded-lg p-4",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-800 mb-3",children:"é–¢é€£è¦å› ï¼ˆå‚è€ƒï¼‰"}),e.included.medium.length>0&&R.jsxs("div",{className:"mb-4",children:[R.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["ä¸­ãƒªã‚¹ã‚¯ï¼ˆ",e.included.medium.length,"ï¼‰"]}),R.jsx("div",{className:"space-y-3",children:e.included.medium.map(e=>{const r=X(e);return R.jsxs("div",{className:`${r.bgColor} ${r.borderColor} border rounded p-3`,children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("span",{className:"text-base",children:r.icon}),R.jsx("span",{className:`text-sm font-semibold ${r.textColor}`,children:e.title}),R.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.bgColor} ${r.textColor} border ${r.borderColor}`,children:ee(e.type)})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[!e.is_read&&R.jsx("button",{onClick:()=>t(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"æ—¢èª­ã«ã™ã‚‹",children:R.jsx(Ze,{className:"w-4 h-4"})}),!e.is_dismissed&&R.jsx("button",{onClick:()=>a(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"éè¡¨ç¤ºã«ã™ã‚‹",children:R.jsx(Ye,{className:"w-4 h-4"})})]})]}),R.jsx("p",{className:`${r.textColor} mt-2 text-sm`,children:e.message}),R.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mt-2",children:[R.jsx(Oe,{className:"w-3 h-3"}),R.jsx("span",{children:h(e.created_at)})]})]},e.id)})})]}),e.included.low.length>0&&R.jsxs("div",{children:[R.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["ä½ãƒªã‚¹ã‚¯ï¼ˆ",e.included.low.length,"ï¼‰"]}),R.jsx("div",{className:"space-y-3",children:e.included.low.map(e=>{const r=X(e);return R.jsxs("div",{className:`${r.bgColor} ${r.borderColor} border rounded p-3`,children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("span",{className:"text-base",children:r.icon}),R.jsx("span",{className:`text-sm font-semibold ${r.textColor}`,children:e.title}),R.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.bgColor} ${r.textColor} border ${r.borderColor}`,children:ee(e.type)})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[!e.is_read&&R.jsx("button",{onClick:()=>t(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"æ—¢èª­ã«ã™ã‚‹",children:R.jsx(Ze,{className:"w-4 h-4"})}),!e.is_dismissed&&R.jsx("button",{onClick:()=>a(e.id),className:`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${r.iconColor}`,title:"éè¡¨ç¤ºã«ã™ã‚‹",children:R.jsx(Ye,{className:"w-4 h-4"})})]})]}),R.jsx("p",{className:`${r.textColor} mt-2 text-sm`,children:e.message}),R.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mt-2",children:[R.jsx(Oe,{className:"w-3 h-3"}),R.jsx("span",{children:h(e.created_at)})]})]},e.id)})})]})]})]},e.userId)})})}),R.jsx("div",{className:"bg-gray-50 border-t border-gray-200 p-4",children:R.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[R.jsxs("div",{children:["è¡¨ç¤ºä¸­: ",w.length,N?"ï¼ˆã“ã®é¸æ‰‹ï¼‰":"äºº"," / å¯¾è±¡: ",v.length,N?"":"äºº","ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆç·æ•°: ",y.length,"ä»¶ï¼‰"]}),R.jsxs("div",{className:"flex items-center space-x-4",children:[R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("div",{className:"w-3 h-3 bg-red-100 border border-red-200 rounded"}),R.jsx("span",{children:"é«˜å„ªå…ˆåº¦"})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("div",{className:"w-3 h-3 bg-yellow-100 border border-yellow-200 rounded"}),R.jsx("span",{children:"ä¸­å„ªå…ˆåº¦"})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-200 rounded"}),R.jsx("span",{children:"ä½å„ªå…ˆåº¦"})]})]})]})})]})})}const nn=Object.freeze(Object.defineProperty({__proto__:null,AlertPanel:sn},Symbol.toStringTag,{value:"Module"}));class ln extends m.Component{constructor(){super(...arguments),t(this,"state",{hasError:!1,message:""})}static getDerivedStateFromError(e){return{hasError:!0,message:String((null==e?void 0:e.message)||e)}}componentDidCatch(e){console.error(`[ChartErrorBoundary] ${this.props.name}`,e)}render(){return this.state.hasError?R.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:["ãƒãƒ£ãƒ¼ãƒˆæç”»ã‚¨ãƒ©ãƒ¼ï¼š",this.props.name,R.jsx("div",{className:"text-xs mt-1 opacity-80",children:this.state.message})]}):this.props.children}}const dn=e=>{if(null==e)return null;const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null},on=e=>new Date(e.toLocaleString("en-US",{timeZone:"Asia/Tokyo"})).toISOString().slice(0,10);const cn={async getUserOrganizations(e){const{data:t,error:r}=await q.rpc("get_user_organizations",{user_uuid:e});if(r)throw r;return t},async getOrganizationHierarchy(e){const{data:t,error:r}=await q.rpc("get_organization_hierarchy",{org_id:e});if(r)throw r;return t},async getOrganizations(){const{data:e,error:t}=await q.from("organizations").select("*").order("name");if(t)throw console.error("Organizations query error:",{message:t.message,details:t.details,hint:t.hint,code:t.code}),new Error(`Failed to load organizations: ${t.message} (${t.code})`);return e},async getOrganizationById(e){const{data:t,error:r}=await q.from("organizations").select("*").eq("id",e).maybeSingle();if(r)throw r;return t},async createOrganization(e){const{data:t,error:r}=await q.from("organizations").insert(e).select().single();if(r)throw r;return t},async updateOrganization(e,t){const{data:r,error:a}=await q.from("organizations").update(t).eq("id",e).select().single();if(a)throw a;return r},async deleteOrganization(e){const{error:t}=await q.from("organizations").delete().eq("id",e);if(t)throw t},async getOrganizationTeams(e){const{data:t,error:r}=await q.from("teams").select("*").eq("organization_id",e).order("name");if(r)throw console.error("Organization teams query error:",{message:r.message,details:r.details,hint:r.hint,code:r.code}),new Error(`Failed to load organization teams: ${r.message}`);return t},async getTeamById(e){const{data:t,error:r}=await q.from("teams").select("*").eq("id",e).maybeSingle();if(r)throw r;return t},async createTeam(e){const t={name:e.name,organization_id:e.organization_id,department_id:e.department_id};console.log("Creating team with data:",t);const{data:r,error:a}=await q.from("teams").insert(t).select().single();if(a)throw console.error("Team creation error:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),a;return console.log("Team created successfully:",r),r},async updateTeam(e,t){const{data:r,error:a}=await q.from("teams").update(t).eq("id",e).select().single();if(a)throw a;return r},async deleteTeam(e){const{error:t}=await q.from("teams").delete().eq("id",e);if(t)throw t},async getOrganizationMembers(e){const{data:t,error:r}=await q.from("organization_members").select("\n        *,\n        users:user_id (\n          id,\n          user_id,\n          name,\n          email,\n          role\n        )\n      ").eq("organization_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async addOrganizationMember(e){const{data:t,error:r}=await q.from("organization_members").insert(e).select().single();if(r)throw r;return t},async updateOrganizationMemberRole(e,t){const{data:r,error:a}=await q.from("organization_members").update({role:t}).eq("id",e).select().single();if(a)throw a;return r},async removeOrganizationMember(e){const{error:t}=await q.from("organization_members").delete().eq("id",e);if(t)throw t},async getOrganizationStats(){const{data:e,error:t}=await q.from("organization_stats").select("*").order("name");if(t)throw t;return e},async checkOrphanedRecords(){const{data:e,error:t}=await q.rpc("check_orphaned_records");if(t)throw t;return e},async assignTeamToOrganization(e,t){const{data:r,error:a}=await q.from("teams").update({organization_id:t}).eq("id",e).select().single();if(a)throw a;return r}};function xn(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{e?d():n(!1)},[e]);const d=async()=>{var e,t;try{n(!0),i(null);const{data:{session:r}}=await(await $(async()=>{const{supabase:e}=await Promise.resolve().then(()=>I);return{supabase:e}},void 0)).supabase.auth.getSession();console.log("Auth state when loading organizations:",{hasSession:!!r,userId:null==(e=null==r?void 0:r.user)?void 0:e.id,email:null==(t=null==r?void 0:r.user)?void 0:t.email});const s=await cn.getOrganizations();console.log("Organizations loaded successfully:",s.length),a(s)}catch(r){const e=r instanceof Error?r.message:"Failed to load organizations";i(e),console.error("Error loading organizations:",{error:r,message:e,stack:r instanceof Error?r.stack:void 0})}finally{n(!1)}};return{organizations:t,loading:s,error:l,createOrganization:async(e,t)=>{try{const r=await cn.createOrganization({name:e,description:t||""});return a(e=>[...e,r].sort((e,t)=>e.name.localeCompare(t.name))),r}catch(r){const e=r instanceof Error?r.message:"Failed to create organization";throw i(e),new Error(e)}},updateOrganization:async(e,t)=>{try{const r=await cn.updateOrganization(e,t);return a(t=>t.map(t=>t.id===e?r:t).sort((e,t)=>e.name.localeCompare(t.name))),r}catch(r){const e=r instanceof Error?r.message:"Failed to update organization";throw i(e),new Error(e)}},deleteOrganization:async e=>{try{await cn.deleteOrganization(e),a(t=>t.filter(t=>t.id!==e))}catch(t){const e=t instanceof Error?t.message:"Failed to delete organization";throw i(e),new Error(e)}},reload:d}}function mn(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null),d=r.useCallback(async()=>{if(e)try{n(!0),i(null);const t=await cn.getOrganizationTeams(e);console.log("Teams loaded:",t),a(t)}catch(t){i(t instanceof Error?t.message:"Failed to load teams"),console.error("Error loading teams:",t)}finally{n(!1)}},[e]);r.useEffect(()=>{if(!e)return a([]),void n(!1);d()},[e,d]);return{teams:t,loading:s,error:l,createTeam:async t=>{if(!e)throw new Error("Organization ID is required");try{const r=await cn.createTeam({organization_id:e,name:t});return console.log("New team created, reloading teams..."),await d(),console.log("Teams reloaded after creation"),r}catch(r){const e=r instanceof Error?r.message:"Failed to create team";throw i(e),new Error(e)}},updateTeam:async(e,t)=>{try{const r=await cn.updateTeam(e,t);return await d(),r}catch(r){const e=r instanceof Error?r.message:"Failed to update team";throw i(e),new Error(e)}},deleteTeam:async e=>{try{await cn.deleteTeam(e),a(t=>t.filter(t=>t.id!==e))}catch(t){const e=t instanceof Error?t.message:"Failed to delete team";throw i(e),new Error(e)}},reload:d}}const un=(e,t,r)=>Math.max(t,Math.min(r,e)),gn=(e,t)=>t>0?e/t:0;function hn(e){const{baseDate:t,athleteIds:a}=e,[s,n]=r.useState([]),[l,i]=r.useState(!1),[d,o]=r.useState(null),c=r.useMemo(()=>t?function(e){const t=new Date(`${e}T00:00:00+09:00`),r=(t.getDay()+6)%7,a=new Date(t);a.setDate(t.getDate()-r);const s=new Date(a);s.setDate(a.getDate()+6);const n=e=>new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(e);return{start:n(a),end:n(s)}}(t):{start:"",end:""},[t]),x=r.useMemo(()=>(Array.isArray(a)?a:[]).slice().sort().join(","),[a]);return r.useEffect(()=>{const e=x?x.split(",").filter(Boolean):[];if(!c.start||!c.end||0===e.length)return n([]),i(!1),void o(null);let t=!1;return(async()=>{try{i(!0),o(null);const r=[];for(const t of((e,t)=>{const r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r})(e,50)){const{data:e,error:a}=await q.from("training_records").select("user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score").in("user_id",t).gte("date",c.start).lte("date",c.end);if(a)throw a;r.push(...e??[])}if(t)return;const a=new Map;for(const e of r){const t=e.intent_signal??e.signal_score??50,r=e.growth_vector??e.arrow_score??50,s="number"==typeof e.load&&isFinite(e.load)?e.load:(e.rpe??0)*(e.duration_min??0),n=un(Number(t)||50,0,100),l=un(Number(r)||50,0,100),i=un(Number(s)||0,0,999999),d=un(Number(e.rpe)||0,0,10),o=e.date,c=a.get(o)??{sumX:0,sumY:0,sumLoad:0,sumRpe:0,n:0};c.sumX+=n,c.sumY+=l,c.sumLoad+=i,c.sumRpe+=d,c.n+=1,a.set(o,c)}const s=[],l=new Date(`${c.start}T00:00:00+09:00`);for(let e=0;e<7;e++){const t=new Date(l);t.setDate(l.getDate()+e);const r=new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(t);s.push(r)}const d=s.map(e=>{const t=a.get(e);return t&&0!==t.n?{date:e,x:Math.round(10*gn(t.sumX,t.n))/10,y:Math.round(10*gn(t.sumY,t.n))/10,load:Math.round(gn(t.sumLoad,t.n)),rpe:Math.round(10*gn(t.sumRpe,t.n))/10,n:t.n}:{date:e,x:50,y:50,load:0,rpe:0,n:0}});n(d)}catch(r){console.error("[useWeeklyGrowthCycle] error",r),t||(o((null==r?void 0:r.message)??"é€±ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),n([]))}finally{t||i(!1)}})(),()=>{t=!0}},[c.start,c.end,x]),{weekRange:c,teamDaily:s,loading:l,error:d}}function bn(e,t){if(!isFinite(e)||e<=0)return 5;if(!isFinite(t)||t<=0)return 5;var r,a,s;return 5+13*(r=e/t,a=0,s=1,Math.max(a,Math.min(s,r)))}function pn(e){const{teamDaily:t,weekLabel:a}=e,c=r.useMemo(()=>(null==t?void 0:t.length)?Math.max(...t.map(e=>e.load??0),0):0,[t]),m=r.useMemo(()=>(t??[]).map(e=>({...e,name:e.n>0?e.date:`${e.date}ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰`,opacity:e.n>0?.55:.12})),[t]),h=r.useMemo(()=>(t??[]).map(e=>({date:e.date.slice(5),load:e.load,growth:e.y,understanding:e.x,n:e.n})),[t]);return R.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5 space-y-4",children:[R.jsxs("div",{children:[R.jsxs("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:["é€±ã‚µã‚¤ã‚¯ãƒ«ï¼ˆ",a,"ï¼‰"]}),R.jsx("div",{className:"text-xs text-gray-500",children:"ä¸Šï¼šæ—¥åˆ¥å¹³å‡ã®ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆç‚¹ã‚µã‚¤ã‚ºï¼è² è· loadï¼‰ / ä¸‹ï¼šé€±ã®æ¨ç§»ï¼ˆloadãƒ»æˆé•·ãƒ»ç†è§£ï¼‰"})]}),R.jsx("div",{style:{width:"100%",height:360},children:R.jsx(s,{children:R.jsxs(g,{margin:{top:10,right:14,bottom:10,left:10},children:[R.jsx(l,{}),R.jsx(i,{type:"number",dataKey:"x",domain:[0,100],ticks:[0,25,50,75,100]}),R.jsx(d,{type:"number",dataKey:"y",domain:[0,100],ticks:[0,25,50,75,100]}),R.jsx(o,{cursor:{strokeDasharray:"3 3"},content:({active:e,payload:t})=>{if(!e||!(null==t?void 0:t.length))return null;const r=t[0].payload;return R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 shadow",children:[R.jsx("div",{className:"font-semibold mb-1",children:r.date}),R.jsxs("div",{className:"text-sm",children:["ç†è§£åº¦: ",Math.round(r.x)]}),R.jsxs("div",{className:"text-sm",children:["æˆé•·åº¦: ",Math.round(r.y)]}),R.jsxs("div",{className:"text-sm",children:["è² è·(load): ",Math.round(r.load)]}),R.jsxs("div",{className:"text-sm",children:["å¹³å‡RPE: ",r.rpe]}),R.jsxs("div",{className:"text-sm",children:["ä»¶æ•°: ",r.n]})]})}}),R.jsx(u,{}),R.jsx(b,{name:"æ—¥åˆ¥å¹³å‡",data:m,fill:"#3b82f6",shape:e=>{const{cx:t,cy:r,payload:a}=e,s=bn((null==a?void 0:a.load)??0,c);return R.jsx("circle",{cx:t,cy:r,r:s,fill:"#3b82f6",fillOpacity:(null==a?void 0:a.opacity)??.55,stroke:"#1d4ed8",strokeWidth:1})}})]})})}),R.jsx("div",{style:{width:"100%",height:260},children:R.jsx(s,{children:R.jsxs(n,{data:h,margin:{top:10,right:14,bottom:10,left:10},children:[R.jsx(l,{}),R.jsx(i,{dataKey:"date"}),R.jsx(d,{}),R.jsx(o,{}),R.jsx(u,{}),R.jsx(x,{type:"monotone",dataKey:"load",name:"è² è·(load)"}),R.jsx(x,{type:"monotone",dataKey:"growth",name:"æˆé•·(å¹³å‡)"}),R.jsx(x,{type:"monotone",dataKey:"understanding",name:"ç†è§£(å¹³å‡)"})]})})}),R.jsx("div",{className:"text-xs text-gray-500",children:"â€»ã€Œæˆé•·/ç†è§£ã€ã¯ 0â€“100 ã®å¹³å‡å€¤ã€‚n=0 ã®æ—¥ã¯ç‚¹ãŒè–„ãã€loadã¯0ã«ãªã‚Šã¾ã™ã€‚"})]})}const yn=(e,t,r)=>Math.max(t,Math.min(r,e));function fn(e){const{date:t,athletes:a}=e,[s,n]=r.useState([]),[l,i]=r.useState(!1),[d,o]=r.useState(null),c=r.useMemo(()=>Array.isArray(a)&&0!==a.length?a.map(e=>{const t=e.nickname||e.name||e.email||"åå‰æœªè¨­å®š";return`${e.id}:${t}`}).sort().join("|"):"",[a]),x=r.useMemo(()=>Array.isArray(a)&&0!==a.length?a.map(e=>e.id).filter(Boolean).sort().join(","):"",[a]),m=r.useMemo(()=>x?x.split(",").filter(Boolean):[],[x]),u=r.useMemo(()=>{const e={};if(!c)return e;for(const t of c.split("|")){const[r,...a]=t.split(":"),s=a.join(":")||"åå‰æœªè¨­å®š";r&&(e[r]=s)}return e},[c]),g=r.useRef(0);r.useEffect(()=>{if(!t||0===m.length)return n([]),o(null),void i(!1);let e=!1;const r=++g.current;return(async()=>{try{i(!0),o(null);const a=[];for(const e of((e,t)=>{const r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r})(m,50)){const{data:r,error:s}=await q.from("training_records").select("user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score").in("user_id",e).eq("date",t);if(s)throw s;a.push(...r??[])}if(e)return;if(r!==g.current)return;const s=new Map;for(const e of a){const t=e.intent_signal??e.signal_score??50,r=e.growth_vector??e.arrow_score??50,a="number"==typeof e.load&&isFinite(e.load)?e.load:(e.rpe??0)*(e.duration_min??0),n=yn(Number(t)||50,0,100),l=yn(Number(r)||50,0,100),i=yn(Number(a)||0,0,999999),d=yn(Number(e.rpe)||0,0,10),o=yn(Number(e.duration_min)||0,0,1e5),c=s.get(e.user_id)??{sumX:0,sumY:0,sumLoad:0,sumRpe:0,sumDur:0,n:0};c.sumX+=n,c.sumY+=l,c.sumLoad+=i,c.sumRpe+=d,c.sumDur+=o,c.n+=1,s.set(e.user_id,c)}const l=Array.from(s.entries()).map(([e,t])=>{const r=t.n||1;return{user_id:e,name:u[e]||"åå‰æœªè¨­å®š",x:Math.round(t.sumX/r*10)/10,y:Math.round(t.sumY/r*10)/10,load:Math.round(t.sumLoad/r),rpe:Math.round(t.sumRpe/r*10)/10,duration_min:Math.round(t.sumDur/r)}});n(l)}catch(a){console.error("[useDailyGrowthMatrix] error",a),e||(o((null==a?void 0:a.message)??"å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),n([]))}finally{e||i(!1)}})(),()=>{e=!0}},[t,x,c]);const h=r.useMemo(()=>{if(!s||0===s.length)return null;const e=e=>e.reduce((e,t)=>e+t,0)/e.length;return{x:e(s.map(e=>e.x)),y:e(s.map(e=>e.y)),load:e(s.map(e=>e.load))}},[s]);return{points:s,teamAvg:h,loading:l,error:d}}const jn=(e,t)=>{const r=Math.pow(10,t);return Math.round(e*r)/r},vn=(e,t,r)=>{const a=e.toFixed(t);return r?`${a} ${r}`:a},wn=e=>{const t=e.toLowerCase();return t.includes("10m")||t.includes("20m")||t.includes("30m")||t.includes("sprint")||t.includes("dash")||t.includes("time")||t.includes("ç§’")||t.includes("sec")?"lower":"higher"},Nn=(e,t,r)=>{const a=e-t;return"higher"===r?a:-a},kn=e=>{const{athleteName:t,testDisplayName:r,latestValue:a,bestValue:s,unitLabel:n,direction:l,teamAvg:i,p10:d,p90:o,prevValue:c}=e;if(null==a||!Number.isFinite(a))return null;const x=(e=>e?(e.toLowerCase().includes("rsi"),2):2)(r),m=`${t?t+"ï¼š":""}${r}ã®è¦ç‚¹`,u=[],g=[];if(u.push(`æœ€æ–°ï¼š${vn(a,x,n)}`),null!=s&&Number.isFinite(s)&&u.push(`ãƒ™ã‚¹ãƒˆï¼š${vn(s,x,n)}`),null!=c&&Number.isFinite(c)){const e=Nn(a,c,l),t=e>=0?"+":"";u.push(`å‰å›æ¯”ï¼š${t}${jn(e,x).toFixed(x)}ï¼ˆè‰¯åŒ–æ–¹å‘ åŸºæº–ï¼‰`),Math.abs(e)<Math.max(.003*Math.abs(a),1e-4)&&g.push("å¤‰åŒ–ãŒå°ã•ã„ã®ã§ã€ã¾ãšã¯ãƒ•ã‚©ãƒ¼ãƒ /æ¡ä»¶ï¼ˆã‚·ãƒ¥ãƒ¼ã‚ºãƒ»è·¯é¢ãƒ»ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ï¼‰ã‚’å›ºå®šã—ã¦å†æ¸¬å®š")}if(null!=i&&Number.isFinite(i)){const e=((e,t,r)=>{const a=Nn(e,t,r),s=Math.max(.002*Math.abs(t),1e-4);return a>s?"above":a<-s?"below":"equal"})(a,i,l),t=Nn(a,i,l),s=t>=0?"+":"";u.push(`ãƒãƒ¼ãƒ å¹³å‡ï¼š${vn(i,x,n)}ï¼ˆå¹³å‡ã¨ã®å·®ï¼š${s}${jn(t,x).toFixed(x)} è‰¯åŒ–æ–¹å‘ åŸºæº–ï¼‰`),"above"===e?(u.push("è©•ä¾¡ï¼šå¹³å‡ä»¥ä¸Šï¼ˆå¼·ã¿å€™è£œï¼‰"),g.push("å¼·ã¿ã‚’ç¶­æŒï¼šé€±1å›ã¯åŒæ¡ä»¶ã§å†ç¾æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆåŒã˜ã‚¢ãƒƒãƒ—â†’åŒã˜æ¸¬å®šï¼‰")):"below"===e?(u.push("è©•ä¾¡ï¼šå¹³å‡æœªæº€ï¼ˆèª²é¡Œå€™è£œï¼‰"),r.toLowerCase(),"lower"===l?(g.push("èª²é¡Œä»®èª¬ï¼šåŠ é€Ÿå±€é¢ã®å‡ºåŠ›/æ¥åœ°ã®ãƒ­ã‚¹ã€‚å‹•ç”»ã§â€œæ¥åœ°ä½ç½®ã¨ä¸Šä½“è§’â€ã‚’ç¢ºèª"),g.push("ãƒ‰ãƒªãƒ«ï¼š10mãªã‚‰ã€2æ­©åŠ é€Ÿâ†’10mã€ã‚’é€±2ï¼ˆçŸ­æ™‚é–“ï¼‰ã§åå¾©")):(g.push("èª²é¡Œä»®èª¬ï¼šå‡ºåŠ› or åç™ºã®ä¸è¶³ã€‚å¯å‹•åŸŸã¨åŠ›ç™ºæ®ã®ä¸¡é¢ã§ãƒã‚§ãƒƒã‚¯"),g.push("ãƒ‰ãƒªãƒ«ï¼šã‚¸ãƒ£ãƒ³ãƒ—ç³»ãªã‚‰ã€ä½å¼·åº¦ãƒã‚´â†’ä¸­å¼·åº¦ã€ã®æ¼¸é€²ã§åç™ºã‚’ä½œã‚‹"))):(u.push("è©•ä¾¡ï¼šå¹³å‡åŒç­‰"),g.push("æ¬¡ã®ä¼¸ã³ä»£ï¼šã¾ãšâ€œãƒ™ã‚¹ãƒˆãŒå‡ºã‚‹æ¡ä»¶â€ã‚’å†ç¾ï¼ˆæ¸¬å®šå‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã®å›ºå®šï¼‰"))}if(null!=d&&null!=o&&Number.isFinite(d)&&Number.isFinite(o)){u.push(`ç›®å®‰ãƒ¬ãƒ³ã‚¸ï¼šP10 ${vn(d,x,n)} / P90 ${vn(o,x,n)}`);("higher"===l?a>=Math.min(d,o)&&a<=Math.max(d,o):a<=Math.max(d,o)&&a>=Math.min(d,o))||g.push("ãƒ¬ãƒ³ã‚¸å¤–ï¼šæ¸¬å®šæ¡ä»¶ã®é•ã„ï¼ˆæ©Ÿå™¨/ãƒ•ã‚©ãƒ¼ãƒ /ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ï¼‰ã‚’ç–‘ã£ã¦å†æ¸¬å®š")}return{title:m,bullets:u.filter(Boolean),nextActions:Array.from(new Set(g)).slice(0,4),note:"â€»ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯å†…éƒ¨ãƒ«ãƒ¼ãƒ«ã§ç”Ÿæˆã—ã¦ã„ã¾ã™ï¼ˆåŸå› ã®æ–­å®šã¯ã›ãšã€æ¬¡ã®ç¢ºèªãƒ»è¡Œå‹•ã«ç¹‹ã’ã‚‹è¨­è¨ˆï¼‰ã€‚"}},_n=e=>{const[t,r,a]=e.split("-").map(Number);return t&&r&&a?`${r}/${a}`:e};function Cn({open:e,onClose:t,teamId:a,athleteUserId:m,athleteName:u,testTypeId:g,metricKey:h}){const[b,p]=r.useState(!1),[y,f]=r.useState(null),[j,v]=r.useState(null),[w,N]=r.useState([]),[k,_]=r.useState(null),C=!!(null==j?void 0:j.is_strength)?"relative_1rm"===h?"ç›¸å¯¾1RM":"æ¨å®š1RM":"",S=r.useMemo(()=>j?"relative_1rm"===h?"Ã—BW":j.unit||"":"",[j,h]),D=r.useMemo(()=>{const e=(e=>{const t=(e||"").trim();return"ç§’"===t||"s"===t||"sec"===t?2:new Set(["å›","ç‚¹"]).has(t)?0:2})(S);return t=>{if(null==t)return"â€”";const r=Number(t);return Number.isFinite(r)?0===e?String(Math.round(r)):r.toFixed(e):"â€”"}},[S]);r.useEffect(()=>{if(!e)return;let t=!1;return(async()=>{try{p(!0),f(null);const e=await q.from("performance_test_types").select("id, display_name, unit, is_strength").eq("id",g).single();if(e.error)throw e.error;t||v(e.data);const{data:r,error:s}=await q.rpc("get_athlete_test_timeseries",{p_team_id:a,p_user_id:m,p_test_type_id:g,p_metric:h,p_days:730});if(s)throw s;const n=(r??[]).map(e=>({date:e.date,value:Number(e.value)})).filter(e=>e.date&&Number.isFinite(e.value)).sort((e,t)=>e.date.localeCompare(t.date));t||N(n);const{data:l,error:i}=await q.rpc("get_my_team_benchmarks",{p_days:90,p_metric:h});if(!i&&l){const e=Array.isArray(l)?l[0]:l,r={avg_value:(null==e?void 0:e.avg_value)??(null==e?void 0:e.avg)??null,p10:(null==e?void 0:e.p10)??null,p90:(null==e?void 0:e.p90)??null};t||_(r)}else t||_(null)}catch(e){console.error("[CoachAthletePerformanceModal] error",e),t||(f((null==e?void 0:e.message)??"å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),N([]),_(null))}finally{t||p(!1)}})(),()=>{t=!0}},[e,a,m,g,h]);const M=w.length?w[w.length-1]:null,E=kn({athleteName:u,testDisplayName:(null==j?void 0:j.display_name)||"ç¨®ç›®",latestValue:(null==M?void 0:M.value)??null,prevValue:w.length>=2?w[w.length-2].value:null,unitLabel:S,direction:wn((null==j?void 0:j.display_name)||""),teamAvg:(null==k?void 0:k.avg_value)??null,p10:(null==k?void 0:k.p10)??null,p90:(null==k?void 0:k.p90)??null});return e?R.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",onClick:t,children:R.jsxs("div",{className:"bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[R.jsxs("div",{className:"px-5 py-4 border-b flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-sm text-gray-500",children:"æˆé•·ã‚°ãƒ©ãƒ•"}),R.jsxs("div",{className:"text-lg font-bold text-gray-900 truncate",children:[u," / ",(null==j?void 0:j.display_name)||"ç¨®ç›®",C?`ï¼ˆ${C}ï¼‰`:""]}),R.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["æœ€æ–°ï¼š",M?`${M.date} / ${D(M.value)} ${S}`:"â€”"]})]}),R.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100",onClick:t,"aria-label":"close",title:"é–‰ã˜ã‚‹",children:R.jsx(sr,{className:"w-5 h-5 text-gray-600"})})]}),R.jsxs("div",{className:"p-5 space-y-4",children:[y&&R.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:y}),E&&R.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900",children:E.title}),R.jsx("ul",{className:"mt-2 space-y-1 text-sm text-gray-800 list-disc pl-5",children:E.bullets.map((e,t)=>R.jsx("li",{children:e},t))}),E.nextActions.length>0&&R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"mt-3 text-xs font-semibold text-gray-700",children:"æ¬¡ã®ä¸€æ‰‹"}),R.jsx("ul",{className:"mt-1 space-y-1 text-sm text-gray-800 list-disc pl-5",children:E.nextActions.map((e,t)=>R.jsx("li",{children:e},t))})]}),E.note&&R.jsx("div",{className:"mt-2 text-xs text-gray-500",children:E.note})]}),b?R.jsx("div",{className:"flex items-center justify-center py-16",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):0===w.length?R.jsx("div",{className:"py-12 text-center text-sm text-gray-500",children:"ã“ã®ç¨®ç›®ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“"}):R.jsx("div",{className:"h-64",children:R.jsx(s,{width:"100%",height:"100%",children:R.jsxs(n,{data:w,margin:{top:10,right:10,left:0,bottom:0},children:[R.jsx(l,{strokeDasharray:"3 3"}),R.jsx(i,{dataKey:"date",tickFormatter:_n,minTickGap:18}),R.jsx(d,{}),R.jsx(o,{formatter:e=>`${D(Number(e))} ${S}`,labelFormatter:e=>`æ—¥ä»˜: ${e}`}),null!=(null==k?void 0:k.avg_value)&&R.jsx(c,{y:k.avg_value,strokeDasharray:"6 4",label:{value:"ãƒãƒ¼ãƒ å¹³å‡",position:"insideTopRight"}}),null!=(null==k?void 0:k.p10)&&R.jsx(c,{y:k.p10,strokeDasharray:"2 6"}),null!=(null==k?void 0:k.p90)&&R.jsx(c,{y:k.p90,strokeDasharray:"2 6"}),R.jsx(x,{type:"monotone",dataKey:"value",strokeWidth:3,dot:!1})]})})}),w.length>0&&R.jsxs("div",{className:"border rounded-xl overflow-hidden",children:[R.jsxs("div",{className:"px-4 py-2 bg-gray-50 text-xs text-gray-600 flex justify-between",children:[R.jsx("span",{children:"æ—¥ä»˜"}),R.jsxs("span",{children:["å€¤ï¼ˆ",S||"-","ï¼‰"]})]}),R.jsx("div",{className:"max-h-48 overflow-auto divide-y",children:w.slice().reverse().map(e=>R.jsxs("div",{className:"px-4 py-2 text-sm flex justify-between",children:[R.jsx("span",{className:"text-gray-700",children:e.date}),R.jsx("span",{className:"font-semibold text-gray-900",children:D(e.value)})]},e.date))})]}),R.jsx("div",{className:"text-xs text-gray-500",children:"â€» ã¾ãšã¯ã€Œå€‹äººæ¨ç§»ï¼‹ãƒãƒ¼ãƒ åŸºæº–ç·šï¼ˆã‚ã‚Œã°ï¼‰ã€ã§å®Œæˆã€‚æ¬¡ã«ã€Œãƒãƒ¼ãƒ å†…é †ä½ã®æ¨ç§»ã€ãªã©æ‹¡å¼µã§ãã¾ã™ã€‚"})]})]})}):null}const Sn={off:"ã‚ªãƒ•",pre:"ãƒ—ãƒ¬ï¼ˆæº–å‚™ï¼‰",in:"ã‚¤ãƒ³ï¼ˆé€šå¸¸ï¼‰",peak:"ãƒ”ãƒ¼ã‚¯",transition:"ç§»è¡Œ",unknown:"æœªè¨­å®š"},Dn={off:"bg-gray-100 text-gray-700 border-gray-200",pre:"bg-blue-50 text-blue-700 border-blue-200",in:"bg-emerald-50 text-emerald-700 border-emerald-200",peak:"bg-rose-50 text-rose-700 border-rose-200",transition:"bg-amber-50 text-amber-700 border-amber-200",unknown:"bg-slate-50 text-slate-700 border-slate-200"},Mn=(e,t)=>{const r=Number(e.slice(5,7)),a=Number(e.slice(8,10)),s=Number(t.slice(5,7)),n=Number(t.slice(8,10));return r&&a&&s&&n?`${r}/${a}â€“${s}/${n}`:`${e}ã€œ${t}`},En=()=>{const e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(e)},Rn=(e,t)=>{const[r,a,s]=e.split("-").map(Number),n=new Date(r,(a??1)-1,s??1);return n.setDate(n.getDate()+t),new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(n)},Tn=e=>e.split(/[,ã€\n\t ]+/).map(e=>e.trim()).filter(Boolean).slice(0,12);function An({teamId:e,teamName:t}){const[a,s]=r.useState(!1),[n,l]=r.useState(!1),[i,d]=r.useState(null),[o,c]=r.useState([]),[x,m]=r.useState(!1),[u,g]=r.useState("create"),[h,b]=r.useState(null),[p,y]=r.useState(()=>En()),[f,j]=r.useState(()=>Rn(En(),20)),[v,w]=r.useState("pre"),[N,k]=r.useState("åŸºç¤ ãƒ•ã‚©ãƒ¼ãƒ  ç­‹åŠ›"),[_,C]=r.useState(""),S=r.useMemo(()=>[...o].sort((e,t)=>(e.start_date||"").localeCompare(t.start_date||"")),[o]),D=En(),M=r.useMemo(()=>S.find(e=>{return t=D,r=e.start_date,a=e.end_date,r<=t&&t<=a;var t,r,a})??null,[S,D]),E=r.useMemo(()=>{const e=Rn(D,21);return S.filter(t=>!(t.end_date<D||e<t.start_date))},[S,D]);r.useMemo(()=>E.filter(e=>{return r=M,!((t=e)&&r&&t.phase_type===r.phase_type&&t.start_date===r.start_date&&t.end_date===r.end_date);var t,r}),[E,M]);const T=()=>m(!1),A=async()=>{if(e)try{s(!0),d(null);const{data:t,error:r}=await q.rpc("list_team_season_phases",{p_team_id:e});if(r)throw r;const a=(t??[]).map(t=>({id:t.id,team_id:t.team_id??e,start_date:t.start_date,end_date:t.end_date,phase_type:t.phase_type??"unknown",focus_tags:Array.isArray(t.focus_tags)?t.focus_tags:[],note:t.note??null}));c(a)}catch(t){console.error("[TeamSeasonPhaseSettings] fetch error",t),d((null==t?void 0:t.message)??"å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),c([])}finally{s(!1)}};r.useEffect(()=>{A()},[e]);return R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[R.jsxs("div",{className:"flex items-center justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-xs text-gray-500",children:"è¨­å®šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºï¼‰"}),R.jsxs("div",{className:"text-base font-bold text-gray-900 truncate",children:["ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º",t?` - ${t}`:""]}),R.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:"â€» é¸æ‰‹å´ãƒˆãƒƒãƒ—ã«ã€Œä»Šæ—¥ã€ã¨ã€Œä»Šå¾Œ3é€±é–“ã€ã‚’è¡¨ç¤º"})]}),R.jsxs("button",{onClick:()=>{(()=>{const e=En();y(e),j(Rn(e,20)),w("pre"),k("åŸºç¤ ãƒ•ã‚©ãƒ¼ãƒ  ç­‹åŠ›"),C(""),g("create"),b(null)})(),d(null),m(!0)},className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 text-xs font-semibold shrink-0",children:[R.jsx(kt,{className:"w-4 h-4"}),"è¿½åŠ "]})]}),i&&R.jsxs("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2 flex items-start gap-2",children:[R.jsx(fe,{className:"w-4 h-4 mt-0.5"}),R.jsx("div",{className:"min-w-0",children:i})]})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("span",{className:"text-xs font-medium text-gray-500",children:"ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º"}),R.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-600",children:"ä»Šæ—¥"})]}),R.jsx("span",{className:"text-xs text-gray-500",children:M?Mn(M.start_date,M.end_date):"æœªè¨­å®š"})]}),M?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"mt-2 flex items-end justify-between gap-3",children:R.jsx("div",{className:"min-w-0",children:R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("h3",{className:"text-xl font-semibold text-gray-900 truncate",children:Sn[M.phase_type]}),R.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${Dn[M.phase_type]}`,children:M.phase_type})]})})}),Array.isArray(M.focus_tags)&&M.focus_tags.length>0&&R.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[M.focus_tags.slice(0,6).map((e,t)=>R.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-50 text-blue-700",children:e},`${e}-${t}`)),M.focus_tags.length>6&&R.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:["+",M.focus_tags.length-6]})]}),R.jsx("p",{className:"mt-3 text-sm text-gray-700 line-clamp-2",children:ks((null==M?void 0:M.phase_type)??"unknown",(null==M?void 0:M.focus_tags)??[],(null==M?void 0:M.note)??null,{preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:80})})]}):R.jsx("div",{className:"mt-3 text-sm text-gray-600",children:"ãƒ•ã‚§ãƒ¼ã‚ºãŒæœªè¨­å®šã§ã™ï¼ˆï¼‹è¿½åŠ  ã‹ã‚‰ç™»éŒ²ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"})]}),R.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[R.jsxs("div",{className:"flex items-center justify-between mb-2",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"ä»Šå¾Œ3é€±é–“"}),R.jsx("div",{className:"text-xs text-gray-500",children:"æ¨ªã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«"})]}),R.jsxs("div",{className:"text-[11px] text-gray-400",children:[D,"ã€œ",Rn(D,21)]})]}),0===E.length?R.jsx("div",{className:"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-3",children:"æœŸé–“å†…ã®ãƒ•ã‚§ãƒ¼ã‚ºãŒã‚ã‚Šã¾ã›ã‚“"}):R.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1",children:E.slice(0,6).map((e,t)=>{const r=M&&e.phase_type===M.phase_type&&e.start_date===M.start_date&&e.end_date===M.end_date;return R.jsxs("div",{className:"min-w-[170px] rounded-lg border p-3 "+(r?"border-blue-200 bg-blue-50/60":"border-gray-200 bg-white"),children:[R.jsxs("div",{className:"flex items-center justify-between gap-2",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:Sn[e.phase_type]}),R.jsx("div",{className:"text-[11px] text-gray-500 whitespace-nowrap",children:Mn(e.start_date,e.end_date)})]}),Array.isArray(e.focus_tags)&&e.focus_tags.length>0&&R.jsxs("div",{className:"mt-2 flex flex-wrap gap-1.5",children:[e.focus_tags.slice(0,3).map((t,r)=>R.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:t},`${e.id}-${t}-${r}`)),e.focus_tags.length>3&&R.jsxs("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:["+",e.focus_tags.length-3]})]}),R.jsx("div",{className:"mt-2 text-xs text-gray-600 line-clamp-1",children:ks(e.phase_type??"unknown",e.focus_tags??[],e.note??null,{preferNote:!0,appendTagHintsWhenNote:!1,maxNoteChars:50})})]},`${e.id}-${t}`)})})]})]}),R.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[R.jsxs("div",{className:"px-4 py-3 bg-gray-50 flex items-center justify-between",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"ç™»éŒ²æ¸ˆã¿ãƒ•ã‚§ãƒ¼ã‚º"}),R.jsx("button",{onClick:A,className:"text-xs font-semibold px-3 py-1.5 rounded-lg border bg-white hover:bg-gray-50",disabled:a,children:a?"æ›´æ–°ä¸­â€¦":"æ›´æ–°"})]}),a?R.jsx("div",{className:"py-10 flex items-center justify-center",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):0===S.length?R.jsx("div",{className:"py-10 text-center text-sm text-gray-600",children:"ã¾ã ãƒ•ã‚§ãƒ¼ã‚ºãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œè¿½åŠ ã€ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚"}):R.jsx("div",{className:"divide-y",children:S.map(t=>{var r;return R.jsx("div",{className:"p-4",children:R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[R.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full border text-xs font-semibold ${Dn[t.phase_type]}`,children:Sn[t.phase_type]}),R.jsxs("span",{className:"text-xs text-gray-500",children:[t.start_date,"ã€œ",t.end_date]})]}),!!(null==(r=t.focus_tags)?void 0:r.length)&&R.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[t.focus_tags.slice(0,4).map(e=>R.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:e},e)),t.focus_tags.length>4&&R.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:["+",t.focus_tags.length-4]})]}),t.note&&R.jsx("div",{className:"mt-2 text-xs text-gray-600 line-clamp-2",children:t.note})]}),R.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[R.jsx("button",{onClick:()=>(e=>{g("edit"),b(e.id),y(e.start_date),j(e.end_date),w(e.phase_type),k((e.focus_tags??[]).join(" ")),C(e.note??""),d(null),m(!0)})(t),className:"p-2 rounded-lg border bg-white hover:bg-gray-50",title:"ç·¨é›†",children:R.jsx(vt,{className:"w-4 h-4 text-gray-700"})}),R.jsx("button",{onClick:()=>(async t=>{if(window.confirm(`å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n${t.start_date}ã€œ${t.end_date} / ${Sn[t.phase_type]}`))try{l(!0),d(null);const{error:r}=await q.from("team_season_phases").delete().eq("id",t.id).eq("team_id",e);if(r)throw r;await A()}catch(r){console.error("[TeamSeasonPhaseSettings] delete error",r),d((null==r?void 0:r.message)??"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{l(!1)}})(t),className:"p-2 rounded-lg border bg-white hover:bg-red-50",title:"å‰Šé™¤",disabled:n,children:R.jsx(Ut,{className:"w-4 h-4 text-red-600"})})]})]})},t.id)})})]}),x&&R.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",onClick:T,children:R.jsxs("div",{className:"bg-white w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[R.jsxs("div",{className:"px-5 py-4 border-b flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-sm text-gray-500",children:"ãƒãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚º"}),R.jsx("div",{className:"text-lg font-bold text-gray-900 truncate",children:"create"===u?"è¿½åŠ ":"ç·¨é›†"})]}),R.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100",onClick:T,"aria-label":"close",children:R.jsx(sr,{className:"w-5 h-5 text-gray-600"})})]}),R.jsxs("div",{className:"p-5 space-y-4",children:[R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"é–‹å§‹æ—¥"}),R.jsx("input",{type:"date",value:p,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300"})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"çµ‚äº†æ—¥"}),R.jsx("input",{type:"date",value:f,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300"})]})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ãƒ•ã‚§ãƒ¼ã‚º"}),R.jsxs("select",{value:v,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300",children:[R.jsx("option",{value:"off",children:"ã‚ªãƒ•"}),R.jsx("option",{value:"pre",children:"ãƒ—ãƒ¬ï¼ˆæº–å‚™ï¼‰"}),R.jsx("option",{value:"in",children:"ã‚¤ãƒ³ï¼ˆé€šå¸¸ï¼‰"}),R.jsx("option",{value:"peak",children:"ãƒ”ãƒ¼ã‚¯"}),R.jsx("option",{value:"transition",children:"ç§»è¡Œ"}),R.jsx("option",{value:"unknown",children:"æœªè¨­å®š"})]})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚°ï¼ˆã‚¹ãƒšãƒ¼ã‚¹/ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰"}),R.jsx("input",{type:"text",value:N,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300",placeholder:"ä¾‹ï¼šåŸºç¤ ãƒ•ã‚©ãƒ¼ãƒ  ç­‹åŠ›"}),R.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Tn(N).map(e=>R.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700",children:e},e))})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),R.jsx("textarea",{value:_,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 min-h-[90px]",placeholder:"ä¾‹ï¼šã¾ãšã¯åœŸå°ã¥ãã‚Šï¼ˆä»®ï¼‰"})]}),R.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[R.jsx("button",{onClick:T,className:"px-4 py-2 rounded-lg border bg-white hover:bg-gray-50 text-sm font-semibold",disabled:n,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsxs("button",{onClick:async()=>{try{l(!0),d(null);const t={start_date:p,end_date:f,phase_type:v,focus_tags:Tn(N),note:_.trim()?_.trim():null},r=function(e){const t=[];return e.start_date||t.push("é–‹å§‹æ—¥ãŒæœªå…¥åŠ›ã§ã™"),e.end_date||t.push("çµ‚äº†æ—¥ãŒæœªå…¥åŠ›ã§ã™"),e.start_date&&e.end_date&&e.start_date>e.end_date&&t.push("é–‹å§‹æ—¥ > çµ‚äº†æ—¥ ã«ãªã£ã¦ã„ã¾ã™"),e.phase_type||t.push("ãƒ•ã‚§ãƒ¼ã‚ºãŒæœªé¸æŠã§ã™"),t}(t);if(r.length>0)return void d(r.join(" / "));if("create"===u){const{error:r}=await q.from("team_season_phases").insert({team_id:e,start_date:t.start_date,end_date:t.end_date,phase_type:t.phase_type,focus_tags:t.focus_tags??[],note:t.note??null});if(r)throw r}else{if(!h)throw new Error("editingId is missing");const{error:r}=await q.from("team_season_phases").update({start_date:t.start_date,end_date:t.end_date,phase_type:t.phase_type,focus_tags:t.focus_tags??[],note:t.note??null}).eq("id",h).eq("team_id",e);if(r)throw r}await A(),T()}catch(t){console.error("[TeamSeasonPhaseSettings] save error",t),d((null==t?void 0:t.message)??"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{l(!1)}},className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-sm font-semibold disabled:opacity-50",disabled:n,children:[R.jsx(Mt,{className:"w-4 h-4"}),n?"ä¿å­˜ä¸­â€¦":"ä¿å­˜"]})]}),R.jsx("div",{className:"text-[11px] text-gray-500",children:"â€» æœŸé–“ãŒé‡è¤‡ã™ã‚‹ã¨DBå´ã®åˆ¶ç´„ï¼ˆEXCLUDEï¼‰ã§å¼¾ã‹ã‚Œã¾ã™ã€‚å¿…è¦ãªã‚‰æœŸé–“ã‚’èª¿æ•´ã—ã¦ã­ã€‚"})]})]})})]})}const $n=r.lazy(()=>$(()=>import("./TeamExportPanel-BaFUi1FW.js"),__vite__mapDeps([8,1,5,2])).then(e=>({default:e.TeamExportPanel}))),zn=r.lazy(()=>$(()=>import("./ReportView-CAQjuW-Q.js"),__vite__mapDeps([9,1,2])).then(e=>({default:e.ReportView}))),qn=r.lazy(async()=>({default:(await $(()=>import("./CoachRankingsView-jr4dmQys.js"),__vite__mapDeps([10,1,2]))).default})),Fn=r.lazy(async()=>{const e=await $(()=>import("./GrowthUnderstandingQuadrantSummary-BAII9Axz.js"),__vite__mapDeps([11,1,2]));return{default:e.GrowthUnderstandingQuadrantSummary??e.default}}),In=r.lazy(async()=>{const e=await $(()=>import("./GrowthUnderstandingMatrix-G4SRsLvV.js"),__vite__mapDeps([12,1,2]));return{default:e.GrowthUnderstandingMatrix??e.default}}),Ln=e=>e.toISOString().slice(0,10),Pn=e=>new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).format(e),On=e=>Math.round(100*e)/100,Wn=e=>e>=1.5?"high":e>=1.3?"caution":e>=.8?"good":"low",Bn=(e,t,r)=>"unknown"===e?`ãƒ‡ãƒ¼ã‚¿ä¸è¶³ï¼šæœ‰åŠ¹äººæ•°ãŒå°‘ãªã„ï¼ˆ${t}/${r}ï¼‰`:"danger"===e?"æ³¨æ„ï¼šè² è·ãŒé«˜ã„å¯èƒ½æ€§ã€‚å£°ã‹ã‘ãƒ»ç·´ç¿’å¾ŒRPEç¢ºèªæ¨å¥¨":"warn"===e?"æ³¨æ„ï¼šã‚„ã‚„é«˜ã‚ã€‚å›å¾©çŠ¶æ³ã®ç¢ºèªæ¨å¥¨":"å®‰å®šï¼šé€šå¸¸é‹ç”¨ã§OK",Un={danger:{box:"border-red-200 bg-red-50",badge:"bg-red-100 text-red-700 border-red-200",dot:"bg-red-500"},warn:{box:"border-amber-200 bg-amber-50",badge:"bg-amber-100 text-amber-700 border-amber-200",dot:"bg-amber-500"},ok:{box:"border-emerald-200 bg-emerald-50",badge:"bg-emerald-100 text-emerald-700 border-emerald-200",dot:"bg-emerald-500"},unknown:{box:"border-gray-200 bg-gray-50",badge:"bg-gray-100 text-gray-700 border-gray-200",dot:"bg-gray-400"}},Hn=(e,t)=>{const r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r};function Vn({user:e,alerts:t,onNavigateToPrivacy:a,onNavigateToTerms:s,onNavigateToCommercial:n,onNavigateToHelp:l}){const[i,d]=r.useState([]),[o,c]=r.useState(null),[x,m]=r.useState([]),[u,g]=r.useState(!1),[h,b]=r.useState(null),[p,y]=r.useState(!0),[f,j]=r.useState({}),[v,w]=r.useState(!1),[N,k]=r.useState(()=>(()=>{const e=new Date,t=(e.getDay()+6)%7,r=new Date(e);r.setDate(e.getDate()-t),r.setHours(0,0,0,0);const a=new Date(r);return a.setDate(r.getDate()+6),{start:Ln(r),end:Ln(a)}})()),[_,C]=r.useState([]),[S,D]=r.useState(!1),[M,E]=r.useState([]),[T,A]=r.useState(()=>Pn(new Date)),[$,z]=r.useState(null),[F,I]=r.useState("athletes"),[L,P]=r.useState({open:!1,athleteUserId:"",athleteName:"",testTypeId:"",metricKey:"primary_value"}),[O,W]=r.useState(!1),[B,U]=r.useState(!1),[H,V]=r.useState(!0),[K,J]=r.useState(!1),Y=r.useRef(null),Z=r.useRef(0),G=r.useRef("");r.useEffect(()=>{Y.current=(null==o?void 0:o.id)??null},[null==o?void 0:o.id]),r.useEffect(()=>{G.current=x.map(e=>e.id).slice().sort().join(",")},[x]);const Q=Pn(new Date),[X,ee]=r.useState(()=>{if("undefined"==typeof window)return!1;try{const t=`noDataDismissed-${e.id}-${Q}`;return"1"===localStorage.getItem(t)}catch{return!1}}),{isActive:te,shouldShowTutorial:re,startTutorial:ae,completeTutorial:se,skipTutorial:ne,currentStepIndex:le,setCurrentStepIndex:ie}=ge(),de=xn(e.id),oe=Array.isArray(null==de?void 0:de.organizations)?de.organizations:[],ce=Array.isArray(oe)?oe:[];(null==o?void 0:o.organization_id)||ce.length>0&&ce[0].id,r.useEffect(()=>{re()&&!p&&ae()},[re,ae,p]);const xe=function(e){const[t,a]=r.useState([]),[s,n]=r.useState({}),[l,i]=r.useState(!1),d=r.useRef(0);return r.useEffect(()=>{if(!e)return a([]),n({}),void i(!1);const t=++d.current;i(!0),a([]),n({}),(async()=>{try{const r=new Date,s=new Date(r);s.setDate(s.getDate()-90);const l=on(s),i=on(r),{data:o,error:c}=await q.from("team_acwr_daily").select("team_id,date,average_acwr,athlete_count").eq("team_id",e).gte("date",l).lte("date",i).order("date",{ascending:!0});if(c)throw c;if(d.current!==t)return;const x=(o||[]).map(e=>{const t=dn(e.average_acwr),r=dn(e.athlete_count);return{date:e.date,averageACWR:null!=t?(s=t,Math.round(100*s)/100):NaN,athleteCount:null!=r?Math.max(0,Math.round(r)):0,riskLevel:(a=t,null==a||!Number.isFinite(a)||a<=0?"unknown":a>=1.5?"high":a>=1.3?"caution":a>=.8?"good":"low"),averageRPE:null,averageLoad:null};var a,s}).filter(e=>Number.isFinite(e.averageACWR));let m=x;try{const{data:r,error:a}=await q.from("team_training_daily").select("team_id,date,average_rpe,average_load,athlete_count").eq("team_id",e).gte("date",l).lte("date",i).order("date",{ascending:!0});if(a)throw a;if(d.current!==t)return;const s=new Map;(r||[]).forEach(e=>s.set(e.date,e)),m=x.map(e=>{const t=s.get(e.date);return{...e,averageRPE:dn(null==t?void 0:t.average_rpe)??null,averageLoad:dn(null==t?void 0:t.average_load)??null}})}catch{m=x}if(d.current!==t)return;a(m),n({})}catch(r){console.error("[useTeamACWR] fetch failed",r),d.current===t&&(a([]),n({}))}finally{d.current===t&&i(!1)}})()},[e]),{teamACWRData:t,athleteACWRMap:s,loading:l}}((null==o?void 0:o.id)||null),me=!!xe.loading,ue=xe.teamACWRData??xe.data??[],he=Array.isArray(ue)?ue:[],be=Array.isArray(x)?x:[],ye=Array.isArray(t)?t:[],je=Array.isArray(_)?_:[],ve=r.useMemo(()=>{const e=null==o?void 0:o.id;return e?ye.filter(t=>null==(null==t?void 0:t.team_id)||t.team_id===e):ye},[ye,null==o?void 0:o.id]),we=r.useMemo(()=>ve.filter(e=>"high"===(null==e?void 0:e.priority)),[ve]),Ne=r.useMemo(()=>be.map(e=>e.id),[be]),_e=r.useMemo(()=>be.map(e=>({id:e.id,name:e.name,nickname:e.nickname,email:e.email})),[be]),{points:Ce,teamAvg:Se,loading:De,error:Ee}=fn({date:Q,athletes:_e}),[Re,Te]=r.useState([]),[Ae,$e]=r.useState(!1),[ze,qe]=r.useState(null),Fe=r.useRef(0),Ie=r.useMemo(()=>Ne.slice().sort().join(","),[Ne]);r.useEffect(()=>{if("team-average"!==F)return;if(!(null==o?void 0:o.id)||!N.start||!N.end||0===Ne.length)return Te([]),$e(!1),void qe(null);const e=++Fe.current;let t=!1;return(async()=>{try{$e(!0),qe(null);const r=[];for(const e of Hn(Ne,50)){const{data:t,error:a}=await q.from("training_records").select("user_id,date,rpe,duration_min,load,arrow_score,signal_score").in("user_id",e).gte("date",N.start).lte("date",N.end);if(a)throw a;r.push(...t??[])}if(t)return;if(e!==Fe.current)return;const a=r.map(e=>{const t="number"==typeof e.arrow_score&&Number.isFinite(e.arrow_score)?e.arrow_score:null,r="number"==typeof e.signal_score&&Number.isFinite(e.signal_score)?e.signal_score:null,a="number"==typeof e.load&&Number.isFinite(e.load)?e.load:(Number(e.rpe)||0)*(Number(e.duration_min)||0);return{arrow_score:t,signal_score:r,load:Number.isFinite(a)?a:0}});Te(a)}catch(r){console.error("[weeklyQuadrant] error",r),qe((null==r?void 0:r.message)??"é€±ã‚µãƒãƒªãƒ¼å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),Te([])}finally{t||$e(!1)}})(),()=>{t=!0}},[F,null==o?void 0:o.id,N.start,N.end,Ie]);const{weekRange:Le,teamDaily:Pe,loading:Oe,error:We}=hn({baseDate:T,athleteIds:Ne});r.useEffect(()=>{Be()},[e.id]),r.useEffect(()=>{(null==o?void 0:o.id)&&(m([]),C([]),E([]),j({}),w(!1),Ue(o.id),He(o.id,N.start,N.end))},[null==o?void 0:o.id,N.start,N.end]),r.useEffect(()=>{if("undefined"==typeof window)return;const t=`noDataDismissed-${e.id}-${Q}`;ee("1"===localStorage.getItem(t))},[e.id,Q]);const Be=async()=>{try{y(!0);const{data:t,error:r}=await q.from("staff_team_links").select("\n            team_id,\n            teams (\n              id,\n              name,\n              created_at,\n              organization_id\n            )\n          ").eq("staff_user_id",e.id);if(r)throw r;const a=(t||[]).map(e=>e.teams).filter(Boolean);d(a||[]),a&&a.length>0?c(a[0]):c(null)}catch(t){console.error("Error fetching staff teams:",t),d([]),c(null)}finally{y(!1)}},Ue=async e=>{try{g(!0),b(null);const t=e,{data:r,error:a}=await q.from("staff_team_athletes_with_activity").select("*").eq("team_id",e);if(a)throw a;if(Y.current!==t)return;const s=r||[];m(s);const n=s.map(e=>e.id);Ve(e,n)}catch(t){console.error(t),b("é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{g(!1)}},He=async(e,t,r)=>{try{D(!0);const[a,s]=await Promise.all([q.rpc("get_coach_week_athlete_cards",{p_team_id:e,p_start_date:t,p_end_date:r}),q.rpc("get_coach_week_cause_tags",{p_team_id:e,p_start_date:t,p_end_date:r})]);if(a.error)throw a.error;if(s.error)throw s.error;C(a.data||[]),E(s.data||[])}catch(a){console.error("Failed to fetch week summary",a),C([]),E([])}finally{D(!1)}},Ve=async(e,t)=>{if(!t||0===t.length)return void(Y.current===e&&(j({}),w(!1)));const r=++Z.current,a=t.slice().sort().join(",");try{w(!0);const s=new Date,n=new Date(s);n.setDate(n.getDate()-90);const l=Pn(n),i=Pn(s),d=Hn(t,50),o=[];for(const e of d){const{data:t,error:r}=await q.from("athlete_acwr_daily").select("user_id,date,acwr").in("user_id",e).gte("date",l).lte("date",i).order("date",{ascending:!1});if(r)throw r;o.push(...t||[])}if(Y.current!==e)return;if(r!==Z.current)return;if(G.current!==a)return;const c={};for(const e of o){if(c[e.user_id])continue;const t="number"==typeof e.acwr&&Number.isFinite(e.acwr)?e.acwr:null;c[e.user_id]={currentACWR:null!=t?On(t):null,riskLevel:null!=t?Wn(t):void 0,daysOfData:28}}for(const e of t)c[e]||(c[e]={currentACWR:null,riskLevel:void 0,daysOfData:null});j(c)}catch(s){console.error("[fetchAthleteACWRFromDaily] failed",s),Y.current===e&&j({})}finally{Y.current===e&&w(!1)}},Ke=he.length>0?he[he.length-1]:null,Je=r.useMemo(()=>{const e=new Date;return be.filter(e=>e.last_training_date).map(t=>{const r=new Date(t.last_training_date);return{athlete:t,daysSinceLast:Math.floor((e.getTime()-r.getTime())/864e5)}}).filter(e=>e.daysSinceLast>=14).sort((e,t)=>t.daysSinceLast-e.daysSinceLast)},[be]),Ye=(null==Ke?void 0:Ke.averageACWR)??null,Ze=(null==Ke?void 0:Ke.athleteCount)??0,Ge=be.length,Xe=((e,t,r)=>{const a=Math.min(5,Math.max(1,Math.floor(.2*r)));return null==e||t<a?"unknown":e>=1.5?"danger":e>=1.3?"warn":"ok"})("number"==typeof Ye?Ye:null,Ze,Ge),et=r.useMemo(()=>{const e=[];if(Je.slice(0,3).forEach(({athlete:t,daysSinceLast:r})=>{e.push({user_id:t.id,name:t.name||t.email||"unknown",category:"risk",reason:"è¨˜éŒ²ãŒé€”åˆ‡ã‚Œã¦ã„ã¾ã™",meta:`${r}æ—¥æœªå…¥åŠ›`})}),!je||0===je.length)return e.slice(0,5);je.forEach(t=>{var r;if(!t.is_sharing_active)return;const a=null==(r=null==f?void 0:f[t.athlete_user_id])?void 0:r.currentACWR;"number"==typeof a&&a>=1.5&&e.push({user_id:t.athlete_user_id,name:t.athlete_name||"unknown",category:"risk",reason:"ACWRé«˜å€¤",meta:`ACWR ${a.toFixed(2)}`})}),je.forEach(t=>{t.is_sharing_active&&null!=t.sleep_hours_avg&&t.sleep_hours_avg<=5.5&&e.push({user_id:t.athlete_user_id,name:t.athlete_name||"unknown",category:"checkin",reason:"ç¡çœ ãŒçŸ­ã‚",meta:`${t.sleep_hours_avg.toFixed(1)}h`})}),je.forEach(t=>{t.action_total>0&&(t.action_done_rate??0)>=90&&e.push({user_id:t.athlete_user_id,name:t.athlete_name||"unknown",category:"praise",reason:"è¡Œå‹•ç›®æ¨™ãŒè‰¯ã„",meta:`${Math.round(t.action_done_rate??0)}%`})});const t={risk:3,checkin:2,praise:1},r=new Map;for(const s of e){const e=r.get(s.user_id);(!e||t[s.category]>t[e.category])&&r.set(s.user_id,s)}const a=Array.from(r.values());return a.sort((e,r)=>t[r.category]-t[e.category]),a.slice(0,5)},[Je,je,f]),tt=r.useMemo(()=>{const e={};for(const t of je)e[t.athlete_user_id]=t;return e},[je]),rt=r.useMemo(()=>{const e={};for(const t of Je)e[t.athlete.id]={daysSinceLast:t.daysSinceLast};return e},[Je]),at=r.useMemo(()=>{const e={};for(const t of be)e[t.id]=Ws({id:t.id,name:t.name||t.email||"unknown",acwrInfo:(null==f?void 0:f[t.id])??null,weekCard:(null==tt?void 0:tt[t.id])??null,noData:(null==rt?void 0:rt[t.id])??null});return e},[be,f,tt,rt]),nt=r.useMemo(()=>function(e){const{athletes:t,riskMap:r,weekCardMap:a={}}=e;return[...t].sort((e,t)=>{var s,n,l,i,d,o,c,x;const m=(null==(s=a[e.id])?void 0:s.is_sharing_active)??!0,u=(null==(n=a[t.id])?void 0:n.is_sharing_active)??!0;if(!m&&u)return 1;if(m&&!u)return-1;const g=null==(l=r[e.id])?void 0:l.riskLevel,h=null==(i=r[t.id])?void 0:i.riskLevel,b=g?Os[g]:0,p=h?Os[h]:0;if(b!==p)return p-b;const y=null==(d=r[e.id])?void 0:d.acwr,f=null==(o=r[t.id])?void 0:o.acwr,j="number"==typeof y&&Number.isFinite(y)?y:-1/0,v="number"==typeof f&&Number.isFinite(f)?f:-1/0;if(j!==v)return v-j;const w=(null==(c=r[e.id])?void 0:c.reasons.length)??0,N=(null==(x=r[t.id])?void 0:x.reasons.length)??0;return w!==N?N-w:(e.name||"").localeCompare(t.name||"","ja")})}({athletes:be,riskMap:at,weekCardMap:tt}),[be,at,tt]);r.useEffect(()=>{if(!nt||0===nt.length)return;const e=nt.filter(e=>{var t;return null==(t=null==at?void 0:at[e.id])?void 0:t.riskLevel}).length;e>=Math.floor(.7*nt.length)?console.log("[sortedAthletes]",nt.map(e=>{var t,r,a,s,n;return{name:e.name,risk:null==(t=at[e.id])?void 0:t.riskLevel,sharing:null==(r=tt[e.id])?void 0:r.is_sharing_active,acwr:null==(a=f[e.id])?void 0:a.currentACWR,reasons:(null==(n=null==(s=at[e.id])?void 0:s.reasons)?void 0:n.length)??0}})):console.log(`[sortedAthletes] risk not ready: ${e}/${nt.length}`)},[nt,at,tt,f]);return p?R.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):R.jsxs("div",{className:"min-h-screen bg-gray-50",children:[R.jsx("header",{className:"bg-white shadow-sm border-b sticky top-0 z-40",children:R.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[R.jsxs("div",{className:"flex items-center justify-between py-3",children:[R.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"ã‚³ãƒ¼ãƒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"}),R.jsxs("div",{className:"flex items-center space-x-1",children:[we.length>0&&R.jsxs("button",{onClick:()=>W(!0),className:"p-2 text-gray-600 hover:text-red-600 transition-colors relative",title:"ã‚¢ãƒ©ãƒ¼ãƒˆ",children:[R.jsx(fe,{className:"w-5 h-5"}),R.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center",children:we.length})]}),R.jsx("button",{onClick:ae,className:"p-2 text-gray-600 hover:text-green-600 transition-colors",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",children:R.jsx(st,{className:"w-5 h-5"})})]})]}),i.length>0&&R.jsx("div",{className:"pb-3 border-t border-gray-100",children:R.jsxs("div",{className:"flex items-center gap-3 pt-3",children:[R.jsx(rr,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),R.jsx("select",{value:(null==o?void 0:o.id)||"",onChange:e=>{const t=i.find(t=>t.id===e.target.value);t&&c(t)},className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:i.map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))})]})})]})}),R.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:0===i.length?R.jsxs("div",{className:"text-center py-12",children:[R.jsx(rr,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),R.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"æ‹…å½“ãƒãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("p",{className:"text-gray-600",children:"ç®¡ç†è€…ã«ãƒãƒ¼ãƒ ã®å‰²ã‚Šå½“ã¦ã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚"})]}):R.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[o&&R.jsxs("div",{className:"space-y-4",children:[!me&&Ke&&R.jsx("div",{className:`rounded-xl border p-4 sm:p-5 ${Un[Xe].box}`,children:R.jsx("div",{className:"flex items-start justify-between gap-3",children:R.jsxs("div",{className:"min-w-0",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[R.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs font-semibold ${Un[Xe].badge}`,children:[R.jsx("span",{className:`w-2 h-2 rounded-full ${Un[Xe].dot}`}),"Today Summary"]}),R.jsx("span",{className:`inline-flex items-center px-3 py-1.5 rounded-full border text-sm font-bold ${Un[Xe].badge}`,children:(lt=Xe,"danger"===lt?"High":"warn"===lt?"Caution":"ok"===lt?"Good":"Unknown")})]}),R.jsx("div",{className:"text-sm sm:text-base text-gray-900 font-semibold",children:Bn(Xe,Ze,Ge)}),R.jsxs("div",{className:"mt-2 text-xs sm:text-sm text-gray-700 flex flex-wrap gap-x-4 gap-y-1",children:[R.jsxs("span",{children:["ãƒãƒ¼ãƒ ACWRï¼š",R.jsx("b",{children:Ke.averageACWR})]}),R.jsxs("span",{children:["æœ‰åŠ¹äººæ•°ï¼š",R.jsx("b",{children:Ze})," / åœ¨ç±ï¼š",R.jsx("b",{children:Ge})]})]})]})})}),!me&&!Ke&&R.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4 sm:p-5",children:[R.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Today Summary"}),R.jsxs("div",{className:"text-sm text-gray-700",children:["ã¾ã ãƒãƒ¼ãƒ ACWRã‚’ç®—å‡ºã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",R.jsx("br",{}),"ï¼ˆé¸æ‰‹ã®RPEã¨ç·´ç¿’æ™‚é–“ã®å…¥åŠ›ãŒå¢—ãˆã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"]})]}),et.length>0&&R.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[R.jsxs("div",{className:"flex items-center justify-between mb-3",children:[R.jsx("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"ä»Šæ—¥ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆæœ€å¤§5äººï¼‰"}),R.jsx("div",{className:"text-xs text-gray-500",children:"ã‚¿ãƒƒãƒ—ã§é¸æ‰‹è©³ç´°"})]}),R.jsx("ul",{className:"space-y-2",children:et.map(e=>R.jsx("li",{children:R.jsxs("button",{onClick:()=>(e=>{const t=be.find(t=>t.id===e.user_id);if(!t)return void window.alert("é¸æ‰‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");const r=je.find(e=>e.athlete_user_id===t.id);!r||r.is_sharing_active?z(t):window.alert("ã“ã®é¸æ‰‹ã¯ç¾åœ¨ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰ãŒOFFã§ã™ï¼ˆğŸ”’ï¼‰")})({user_id:e.user_id}),className:"w-full text-left rounded-lg border border-gray-200 hover:bg-gray-50 px-3 py-2 flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"font-semibold text-gray-900 truncate",children:e.name}),R.jsxs("div",{className:"text-xs text-gray-700",children:[e.reason,e.meta?R.jsxs("span",{className:"text-gray-500",children:["ï¼ˆ",e.meta,"ï¼‰"]}):null]})]}),R.jsx("span",{className:"shrink-0 text-[11px] px-2 py-1 rounded-full border "+("risk"===e.category?"bg-red-50 text-red-700 border-red-200":"checkin"===e.category?"bg-amber-50 text-amber-700 border-amber-200":"bg-emerald-50 text-emerald-700 border-emerald-200"),children:"risk"===e.category?"æ³¨æ„":"checkin"===e.category?"å£°ã‹ã‘":"ç§°è³›"})]})},e.user_id))})]})]}),Je.length>0&&!X&&R.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-amber-200 p-4 sm:p-5",children:[R.jsxs("div",{className:"flex items-start justify-between mb-3",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1",children:"ç·´ç¿’è¨˜éŒ²ãŒé€”åˆ‡ã‚Œã¦ã„ã‚‹é¸æ‰‹"}),R.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"æœ€çµ‚è¨˜éŒ²æ—¥ã‹ã‚‰ä¸€å®šæœŸé–“ã€è¨˜éŒ²ãŒãªã„é¸æ‰‹ã®ä¸€è¦§ã§ã™"})]}),R.jsx("button",{onClick:()=>{if("undefined"!=typeof window){const t=`noDataDismissed-${e.id}-${Q}`;localStorage.setItem(t,"1")}ee(!0)},className:"text-xs sm:text-sm text-blue-600 hover:text-blue-700 font-medium px-2 py-1 rounded-lg hover:bg-blue-50",children:"ä»Šæ—¥åˆ†ã¯æ—¢èª­ã«ã™ã‚‹"})]}),R.jsx("ul",{className:"space-y-1 sm:space-y-1.5 text-sm sm:text-base",children:Je.map(({athlete:e,daysSinceLast:t})=>R.jsxs("li",{className:"flex items-baseline justify-between border-t border-gray-100 pt-1.5 first:border-t-0 first:pt-0",children:[R.jsx("div",{className:"font-medium text-gray-900 truncate mr-2",children:e.name||e.email}),R.jsxs("div",{className:"text-xs sm:text-sm text-gray-600 whitespace-nowrap",children:["æœ€çµ‚æ—¥ ",e.last_training_date||"-","ï¼ˆ",t,"æ—¥é–“ï¼‰"]})]},e.id))})]}),o&&R.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[R.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 truncate",children:[R.jsxs("span",{className:"hidden sm:inline",children:[o.name," - "]}),R.jsx("span",{className:"sm:hidden",children:"ãƒãƒ¼ãƒ "}),"æ¦‚è¦"]}),R.jsx(Vt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 ml-2"})]}),me?R.jsx("div",{className:"flex items-center justify-center py-8",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):Ke?R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 sm:gap-6",children:[R.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 sm:p-6 text-center",children:[R.jsx("div",{className:"text-xl sm:text-2xl font-bold text-purple-600 mb-1",children:Ke.averageACWR}),R.jsx("div",{className:"text-xs sm:text-sm text-purple-700",children:"ãƒãƒ¼ãƒ å¹³å‡ACWR"})]}),R.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 sm:p-6 text-center",children:[R.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 mb-1",children:Ke.athleteCount}),R.jsx("div",{className:"text-xs sm:text-sm text-blue-700",children:"ãƒ‡ãƒ¼ã‚¿æœ‰åŠ¹é¸æ‰‹æ•°"})]}),R.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 sm:p-6 text-center",children:[R.jsx("div",{className:"text-xl sm:text-2xl font-bold text-gray-600 mb-1",children:be.length}),R.jsx("div",{className:"text-xs sm:text-sm text-gray-700",children:"ç·é¸æ‰‹æ•°"})]}),R.jsxs("div",{className:"bg-red-50 rounded-lg p-4 sm:p-6 text-center",children:[R.jsx("div",{className:"text-xl sm:text-2xl font-bold text-red-600 mb-1",children:ve.filter(e=>"high"===e.priority).length}),R.jsx("div",{className:"text-xs sm:text-sm text-red-700",children:"é«˜ãƒªã‚¹ã‚¯é¸æ‰‹"})]})]}):R.jsxs("div",{className:"py-6 text-center text-sm text-gray-500",children:["ã¾ã ACWRã‚’è¨ˆç®—ã§ãã‚‹ååˆ†ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",R.jsx("br",{}),"ï¼ˆé¸æ‰‹ã®RPEã¨ç·´ç¿’æ™‚é–“ã‚’å…¥åŠ›ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"]})]}),o&&R.jsxs("div",{className:"bg-white rounded-xl shadow-sm",children:[R.jsxs("div",{className:"border-b border-gray-200",children:[R.jsxs("nav",{className:"hidden sm:flex px-4 sm:px-6 overflow-x-auto",children:[R.jsx("button",{onClick:()=>I("athletes"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap "+("athletes"===F?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"athletes-tab",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(pe,{className:"w-4 h-4 mr-2"}),"é¸æ‰‹ä¸€è¦§"]})}),R.jsx("button",{onClick:()=>I("team-average"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("team-average"===F?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"team-average-tab",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(ke,{className:"w-4 h-4 mr-2"}),"ãƒãƒ¼ãƒ å¹³å‡ACWR"]})}),R.jsx("button",{onClick:()=>I("rankings"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("rankings"===F?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(Kt,{className:"w-4 h-4 mr-2"}),"ãƒ©ãƒ³ã‚­ãƒ³ã‚°"]})}),R.jsx("button",{onClick:()=>I("reports"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("reports"===F?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(Qe,{className:"w-4 h-4 mr-2"}),"ãƒ¬ãƒãƒ¼ãƒˆ"]})}),R.jsx("button",{onClick:()=>I("settings"),className:"py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap "+("settings"===F?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(Me,{className:"w-4 h-4 mr-2"}),"è¨­å®šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºï¼‰"]})})]}),R.jsx("div",{className:"sm:hidden px-4 py-3",children:R.jsxs("select",{value:F,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[R.jsx("option",{value:"athletes",children:"é¸æ‰‹ä¸€è¦§"}),R.jsx("option",{value:"team-average",children:"ãƒãƒ¼ãƒ å¹³å‡ACWR"}),R.jsx("option",{value:"rankings",children:"ãƒ©ãƒ³ã‚­ãƒ³ã‚°"}),R.jsx("option",{value:"settings",children:"è¨­å®šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºï¼‰"}),R.jsx("option",{value:"reports",children:"ãƒ¬ãƒãƒ¼ãƒˆ"})]})})]}),R.jsxs("div",{className:"p-4 sm:p-6",children:["athletes"===F&&R.jsxs("div",{children:[R.jsxs("div",{className:"text-xs text-gray-600 mb-3 flex items-center gap-2",children:[R.jsx(xt,{className:"w-4 h-4"}),"å…±æœ‰OFFï¼ˆğŸ”’ï¼‰ã®é¸æ‰‹ã¯ã€è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã‘ã¾ã›ã‚“",v&&R.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"ï¼ˆACWRå–å¾—ä¸­â€¦ï¼‰"})]}),u?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):h?R.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 text-sm text-red-700",children:[R.jsx("div",{className:"font-semibold mb-1",children:"é¸æ‰‹ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"}),R.jsx("div",{className:"mb-3",children:h}),R.jsx("button",{className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",onClick:()=>(null==o?void 0:o.id)&&Ue(o.id),children:"å†å–å¾—"})]}):0===be.length?R.jsxs("div",{className:"bg-white border rounded-xl p-6 text-center text-gray-600",children:[R.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:"é¸æ‰‹ãŒã¾ã ã„ã¾ã›ã‚“"}),R.jsx("div",{className:"text-sm",children:"ãƒãƒ¼ãƒ ã«é¸æ‰‹ãŒæ‰€å±ã—ã¦ã„ã‚‹ã‹ï¼ˆteam_id / view æ¡ä»¶ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"})]}):R.jsx(Ls,{athletes:nt,onAthleteSelect:e=>{const t=je.find(t=>t.athlete_user_id===e.id);(null==t?void 0:t.is_sharing_active)?z(e):window.alert("ã“ã®é¸æ‰‹ã¯ç¾åœ¨ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰ãŒOFFã§ã™ï¼ˆğŸ”’ï¼‰")},athleteACWRMap:f,weekCardMap:tt,athleteRiskMap:at})]}),"team-average"===F&&R.jsxs("div",{className:"space-y-4",children:[me?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):R.jsx(ln,{name:"TeamACWRChart",children:R.jsx(Xs,{data:he,teamName:(null==o?void 0:o.name)??"",showAvgRPE:H,showAvgLoad:K})}),R.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:[R.jsxs("div",{className:"flex items-center justify-between gap-3",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"é€±ã‚µã‚¤ã‚¯ãƒ«è¡¨ç¤ºï¼ˆ7æ—¥ï¼‰"}),R.jsx("div",{className:"text-xs text-gray-500",children:"æŒ‡å®šæ—¥ã‚’å«ã‚€é€±ï¼ˆæœˆã€œæ—¥ï¼‰ã‚’ã€Œæˆé•·Ã—ç†è§£ã€ã®å‹•ãï¼‹è² è·ã§å¯è¦–åŒ–ã—ã¾ã™"})]}),R.jsx("input",{type:"date",value:T,onChange:e=>A(e.target.value),className:"px-3 py-2 rounded-lg border border-gray-300",title:"ã“ã®æ—¥ä»˜ã‚’å«ã‚€é€±ï¼ˆæœˆã€œæ—¥ï¼‰ã‚’è¡¨ç¤º"})]}),R.jsx("div",{className:"mt-3",children:Oe?R.jsx("div",{className:"flex items-center justify-center py-10",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):We?R.jsx("div",{className:"text-sm text-red-600",children:We}):R.jsx(ln,{name:"WeeklyGrowthCycleView",children:R.jsx(pn,{teamDaily:Pe,weekLabel:`${Le.start} ã€œ ${Le.end}`})})})]}),R.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:Ae?R.jsx("div",{className:"flex items-center justify-center py-10",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):ze?R.jsx("div",{className:"text-sm text-red-600",children:ze}):R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center py-10",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}),children:R.jsx(ln,{name:"GrowthUnderstandingQuadrantSummary",children:R.jsx(Fn,{data:Re})})})}),R.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-5",children:De?R.jsx("div",{className:"flex items-center justify-center py-10",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):Ee?R.jsx("div",{className:"text-sm text-red-600",children:Ee}):R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center py-10",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}),children:R.jsx(ln,{name:"GrowthUnderstandingMatrix",children:R.jsx(In,{points:Ce,teamAvg:Se})})})})]}),"rankings"===F&&R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:R.jsx(ln,{name:"CoachRankingsView",children:R.jsx(qn,{team:o,onOpenAthlete:(e,t,r,a)=>{P({open:!0,athleteUserId:e,athleteName:a||"åå‰æœªè¨­å®š",testTypeId:t,metricKey:r})}})})}),"settings"===F&&o&&R.jsx("div",{className:"space-y-4",children:R.jsx(An,{teamId:o.id,teamName:o.name})}),"reports"===F&&R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:R.jsx(zn,{team:o})})]})]})]})}),$&&R.jsx(Ys,{athlete:$,onClose:()=>z(null),risk:at[$.id],weekCard:tt[$.id]}),O&&R.jsx(sn,{alerts:ve,onMarkAsRead:async e=>console.log("Mark as read:",e),onDismiss:async e=>console.log("Dismiss alert:",e),onMarkAllAsRead:async()=>console.log("Mark all as read"),onClose:()=>W(!1),userRole:e.role}),B&&o&&R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:R.jsx($n,{team:o,onClose:()=>U(!1)})}),R.jsx(Cn,{open:L.open,onClose:()=>P(e=>({...e,open:!1})),teamId:(null==o?void 0:o.id)??"",athleteUserId:L.athleteUserId,athleteName:L.athleteName,testTypeId:L.testTypeId,metricKey:L.metricKey}),R.jsx(Ir,{steps:aa("staff"),isActive:te,onComplete:se,onSkip:ne,currentStepIndex:le,onStepChange:ie})]});var lt}function Kn(e){return"global_admin"===e}function Jn({teams:e,onUserInvited:t,restrictToOrganizationId:a,allowAdminInvite:s=!0}){const[n,l]=r.useState([]),[i,d]=r.useState([]),[o,c]=r.useState(!1),[x,m]=r.useState({name:"",email:"",role:"athlete",organizationId:a||"",teamId:""}),[u,g]=r.useState(!1),[h,b]=r.useState(null),[p,y]=r.useState([]),[f,j]=r.useState({}),[v,w]=r.useState(null);r.useEffect(()=>{(async()=>{try{c(!0);const e=(await cn.getOrganizations()||[]).map(e=>({id:e.id,name:e.name,description:e.description??void 0}));l(e),a&&m(e=>({...e,organizationId:a}))}catch(e){console.error("Failed to load organizations:",e)}finally{c(!1)}})()},[a]),r.useEffect(()=>{(async()=>{if(x.organizationId)try{const e=await cn.getOrganizationTeams(x.organizationId);d(e)}catch(e){console.error("Failed to load organization teams:",e),d([])}else d([])})()},[x.organizationId]);const N=e=>{switch(e){case"athlete":return"é¸æ‰‹";case"staff":return"ã‚¹ã‚¿ãƒƒãƒ•";case"global_admin":return"ç®¡ç†è€…";default:return e}};return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx(Qt,{className:"w-6 h-6 text-blue-600"}),R.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…"})]}),p.length>0&&R.jsxs("button",{onClick:()=>{if(0===p.length)return;const e=[["åå‰","ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹","å½¹å‰²","çµ„ç¹”","ãƒãƒ¼ãƒ ","ãƒ¦ãƒ¼ã‚¶ãƒ¼ID","åˆå›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰","æ‹›å¾…URL","æ‹›å¾…æ—¥æ™‚","ãƒ¡ãƒ¼ãƒ«é€ä¿¡"].join(","),...p.map(e=>[e.name,e.email,N(e.role),e.organizationName||"-",e.teamName||"-",e.user_id||"ç”Ÿæˆä¸­",e.temporaryPassword||"-",e.inviteUrl||"-",e.invitedAt,e.emailSent?"é€ä¿¡æ¸ˆã¿":"æœªé€ä¿¡"].join(","))].join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(t);r.setAttribute("href",a),r.setAttribute("download",`æ‹›å¾…æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼_${H()}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm",children:[R.jsx(He,{className:"w-4 h-4"}),R.jsx("span",{children:"æ‹›å¾…å±¥æ­´ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"})]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[R.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[R.jsxs("div",{className:"flex items-center mb-6",children:[R.jsx(gt,{className:"w-5 h-5 text-blue-600 mr-2"}),R.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ãƒ•ã‚©ãƒ¼ãƒ "})]}),R.jsxs("form",{onSubmit:async e=>{var r,a,s;e.preventDefault(),g(!0),b(null);try{const{data:{session:e}}=await q.auth.getSession();if(!e)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const{data:d}=await q.from("users").select("name").eq("id",e.user.id).single(),o=null==(r=i.find(e=>e.id===x.teamId))?void 0:r.name,c=null==(a=n.find(e=>e.id===x.organizationId))?void 0:a.name;console.log("ğŸš€ Starting user creation process...");const u="http://127.0.0.1:54321",g={name:x.name,email:x.email,role:x.role,teamId:"athlete"===x.role||"staff"===x.role?x.teamId:void 0,organizationId:x.organizationId||void 0,redirectUrl:`${window.location.origin}/reset-password`};console.log("ğŸ“¤ Sending user creation request...");const h=await fetch(`${u}/functions/v1/create-user`,{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(g)}),p=await h.json();if(!h.ok)throw new Error(p.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ");console.log("âœ… User created successfully");const f=p.passwordSetupLink;if(console.log("ğŸ”— Password setup link received"),!f)throw new Error("Edge Functionã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒªãƒ³ã‚¯ãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ");console.log("âœ… Skipping token storage - using Supabase native password reset flow"),console.log("ğŸ“§ Preparing to send invitation email...");const j=`${window.location.origin}/invite-expired`,v=function(e){const t={athlete:"ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ",staff:"ã‚¹ã‚¿ãƒƒãƒ•",admin:"ç®¡ç†è€…"}[e.role]||e.role;return`\n<!DOCTYPE html>\n<html lang="ja">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Bekutaã¸ã®æ‹›å¾…</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      min-height: 100vh;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0 auto;\n      padding: 40px 20px;\n    }\n    .card {\n      background: white;\n      border-radius: 20px;\n      overflow: hidden;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    }\n    .header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      padding: 50px 30px;\n      text-align: center;\n      position: relative;\n    }\n    .header::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);\n      background-size: 30px 30px;\n    }\n    .icon {\n      background: white;\n      width: 80px;\n      height: 80px;\n      border-radius: 50%;\n      margin: 0 auto 20px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n      position: relative;\n    }\n    .icon svg {\n      width: 40px;\n      height: 40px;\n    }\n    .header h1 {\n      color: white;\n      font-size: 32px;\n      margin: 0 0 10px 0;\n      font-weight: bold;\n    }\n    .header p {\n      color: rgba(255, 255, 255, 0.9);\n      font-size: 18px;\n      margin: 0;\n    }\n    .content {\n      padding: 40px 30px;\n    }\n    .greeting {\n      font-size: 24px;\n      color: #1a202c;\n      margin: 0 0 20px 0;\n      font-weight: 600;\n    }\n    .message {\n      color: #4a5568;\n      line-height: 1.6;\n      margin-bottom: 30px;\n      font-size: 16px;\n    }\n    .info-box {\n      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);\n      border-left: 4px solid #667eea;\n      padding: 20px;\n      margin: 20px 0;\n      border-radius: 8px;\n    }\n    .info-item {\n      margin: 12px 0;\n      display: flex;\n      align-items: start;\n    }\n    .info-label {\n      font-weight: 600;\n      color: #2d3748;\n      min-width: 120px;\n      font-size: 14px;\n    }\n    .info-value {\n      color: #4a5568;\n      font-size: 14px;\n    }\n    .setup-box {\n      background: linear-gradient(135deg, #e6f7ff 0%, #d0edff 100%);\n      border: 2px solid #3b82f6;\n      padding: 25px;\n      margin: 20px 0;\n      border-radius: 12px;\n      text-align: center;\n    }\n    .setup-label {\n      font-size: 16px;\n      color: #1e40af;\n      font-weight: 600;\n      margin-bottom: 15px;\n    }\n    .setup-note {\n      font-size: 13px;\n      color: #1e40af;\n      margin-top: 12px;\n      line-height: 1.5;\n    }\n    .cta-button {\n      display: block;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      text-decoration: none;\n      padding: 18px 40px;\n      border-radius: 12px;\n      font-weight: 600;\n      font-size: 18px;\n      margin: 30px 0;\n      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);\n      transition: all 0.3s ease;\n      text-align: center;\n    }\n    .cta-button:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);\n    }\n    .steps {\n      background: #f7fafc;\n      padding: 25px;\n      border-radius: 12px;\n      margin: 25px 0;\n    }\n    .steps h3 {\n      color: #2d3748;\n      font-size: 18px;\n      margin: 0 0 20px 0;\n      text-align: center;\n    }\n    .step {\n      display: flex;\n      align-items: start;\n      margin: 15px 0;\n      color: #4a5568;\n    }\n    .step-number {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      width: 28px;\n      height: 28px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      margin-right: 12px;\n      flex-shrink: 0;\n      font-size: 14px;\n    }\n    .urgency {\n      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);\n      padding: 15px 20px;\n      border-radius: 10px;\n      margin: 20px 0;\n      text-align: center;\n      border: 2px solid #fdcb6e;\n    }\n    .urgency-icon {\n      font-size: 24px;\n      margin-bottom: 5px;\n    }\n    .urgency-text {\n      color: #7d6608;\n      font-weight: 600;\n      margin: 0;\n      font-size: 14px;\n    }\n    .footer {\n      padding: 30px;\n      text-align: center;\n      color: #718096;\n      font-size: 14px;\n      background: #f7fafc;\n      border-top: 1px solid #e2e8f0;\n    }\n    .footer a {\n      color: #667eea;\n      text-decoration: none;\n    }\n    @media only screen and (max-width: 600px) {\n      .container {\n        padding: 20px 10px;\n      }\n      .header {\n        padding: 30px 20px;\n      }\n      .header h1 {\n        font-size: 24px;\n      }\n      .content {\n        padding: 30px 20px;\n      }\n      .greeting {\n        font-size: 20px;\n      }\n      .cta-button {\n        padding: 16px 30px;\n        font-size: 16px;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <div class="card">\n      <div class="header">\n        <div class="icon">\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 2 L2 7 L12 12 L22 7 L12 2z"/>\n            <polyline points="2 17 12 22 22 17"/>\n            <polyline points="2 12 12 17 22 12"/>\n          </svg>\n        </div>\n        <h1>ã‚ˆã†ã“ãã€${e.name}ã•ã‚“ï¼</h1>\n        ${e.teamName?`<p>${e.teamName} ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™</p>`:"<p>ãƒãƒ¼ãƒ ãŒã‚ãªãŸã‚’å¾…ã£ã¦ã„ã¾ã™</p>"}\n      </div>\n\n      <div class="content">\n        <p class="greeting">Bekuta ã¸ã®æ‹›å¾…</p>\n\n        <p class="message">\n          ${e.inviterName?`${e.inviterName}ã‹ã‚‰ã€`:""}Bekutaï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã¸ã”æ‹›å¾…ã—ã¾ã™ã€‚<br/>\n          ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã‚’ç§‘å­¦çš„ã«ç®¡ç†ã—ã€æ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n        </p>\n\n        <div class="info-box">\n          <div class="info-item">\n            <span class="info-label">ã‚ãªãŸã®å½¹å‰²</span>\n            <span class="info-value">${t}</span>\n          </div>\n          <div class="info-item">\n            <span class="info-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>\n            <span class="info-value">${e.email}</span>\n          </div>\n          ${e.teamName?`\n          <div class="info-item">\n            <span class="info-label">ãƒãƒ¼ãƒ </span>\n            <span class="info-value">${e.teamName}</span>\n          </div>\n          `:""}\n        </div>\n\n        <div class="setup-box">\n          <div class="setup-label">ğŸ” ã¾ãšã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„</div>\n          <div class="setup-note">\n            ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€æœ€åˆã«ã€ŒBekutaã§ä½¿ã†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã‚’è‡ªåˆ†ã§è¨­å®šã—ã¦ã„ãŸã ãã¾ã™ã€‚<br>\n            ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒšãƒ¼ã‚¸ã‚’é–‹ãã€è¨­å®šãŒçµ‚ã‚ã£ãŸã‚‰ Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§\n            <br>ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã¨ã€Œè¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚\n          </div>\n        </div>\n\n        <div class="urgency">\n          <div class="urgency-icon">â°</div>\n          <p class="urgency-text">\n            ã“ã®ãƒªãƒ³ã‚¯ã¯ ${e.expiresInHours}æ™‚é–“å¾Œã«æœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã™ã€‚<br/>\n            æœŸé™ãŒåˆ‡ã‚ŒãŸå ´åˆã¯ã€ç®¡ç†è€…ã«æ–°ã—ã„æ‹›å¾…ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚\n          </p>\n        </div>\n\n        <a href="${e.passwordSetupLink}" class="cta-button">\n          ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹\n        </a>\n\n        <div class="steps">\n          <h3>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>\n          <div class="step">\n            <div class="step-number">1</div>\n            <div>ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒšãƒ¼ã‚¸ã‚’é–‹ã</div>\n          </div>\n          <div class="step">\n            <div class="step-number">2</div>\n            <div>ã‚ãªãŸå°‚ç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ä¿å­˜ã™ã‚‹</div>\n          </div>\n          <div class="step">\n            <div class="step-number">3</div>\n            <div>Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’é–‹ãã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³</div>\n          </div>\n          <div class="step">\n            <div class="step-number">4</div>\n            <div>ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ï¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’é–‹å§‹</div>\n          </div>\n        </div>\n\n        <p class="message" style="font-size: 14px; color: #718096;">\n          ãƒœã‚¿ãƒ³ãŒæ©Ÿèƒ½ã—ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š<br>\n          <span style="word-break: break-all; color: #667eea;">${e.passwordSetupLink}</span>\n        </p>\n      </div>\n\n      <div style="margin-top: 18px; font-size: 13px; color: #4a5568; line-height: 1.6;">\n        ã‚‚ã—ãƒªãƒ³ã‚¯ãŒé–‹ã‘ãªã„ï¼æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ã€ã“ã¡ã‚‰ã‹ã‚‰å†ç™ºè¡Œã§ãã¾ã™ï¼š<br />\n        <a href="${e.inviteExpiredUrl}" style="color:#667eea; text-decoration: underline;">\n          æ‹›å¾…ãƒªãƒ³ã‚¯ã®å†ç™ºè¡Œãƒšãƒ¼ã‚¸ã‚’é–‹ã\n        </a>\n      </div>\n\n      <div class="footer">\n        <p>ã“ã®ãƒ¡ãƒ¼ãƒ«ã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ç„¡è¦–ã—ã¦ã„ãŸã ã„ã¦æ§‹ã„ã¾ã›ã‚“ã€‚</p>\n        <p style="margin-top: 15px;">\n          è³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n        </p>\n        <p style="margin-top: 15px; font-size: 12px; color: #a0aec0;">\n          Â© ${(new Date).getFullYear()} Bekuta. All rights reserved.\n        </p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n  `.trim()}({name:x.name,email:x.email,role:x.role,teamName:o||c,passwordSetupLink:f,inviteExpiredUrl:j,inviterName:null==d?void 0:d.name,expiresInHours:24}),w=function(e){const t={athlete:"ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ",staff:"ã‚¹ã‚¿ãƒƒãƒ•",admin:"ç®¡ç†è€…"}[e.role]||e.role;return`\nBekuta ã¸ã®æ‹›å¾…\n\nã‚ˆã†ã“ãã€${e.name}ã•ã‚“ï¼\n\n${e.inviterName?`${e.inviterName}ã‹ã‚‰ã€`:""}Bekutaï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã¸ã”æ‹›å¾…ã—ã¾ã™ã€‚\n\nã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã‚’ç§‘å­¦çš„ã«ç®¡ç†ã—ã€\næ€ªæˆ‘ã®ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\næ‹›å¾…æƒ…å ±\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nã‚ãªãŸã®å½¹å‰²: ${t}\nãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ${e.email}\n${e.teamName?`ãƒãƒ¼ãƒ : ${e.teamName}\n`:""}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€ã¾ãš Bekuta ã§ä½¿ã†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\nè¨­å®šå¾Œã¯ã€Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§\nã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã¨ã€Œè¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n1. ä»¥ä¸‹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒšãƒ¼ã‚¸ã‚’é–‹ã\n   ${e.passwordSetupLink}\n\n2. ã‚ãªãŸå°‚ç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€ã€Œä¿å­˜ã€ã™ã‚‹\n\n3. Bekuta ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’é–‹ãã€\n   ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹\n\n4. ãƒãƒ¼ãƒ ã«å‚åŠ å®Œäº†ï¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’é–‹å§‹\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ° ã“ã®ãƒªãƒ³ã‚¯ã¯ ${e.expiresInHours}æ™‚é–“å¾Œã«æœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã™ã€‚\n   æœŸé™ãŒåˆ‡ã‚ŒãŸå ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«\n   æ–°ã—ã„æ‹›å¾…ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã®ç™ºè¡Œã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚\n\n  ãƒªãƒ³ã‚¯ãŒé–‹ã‘ãªã„ï¼æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ã€ã“ã¡ã‚‰ã‹ã‚‰å†ç™ºè¡Œã§ãã¾ã™ï¼š\n  ${e.inviteExpiredUrl}\n\nã“ã®ãƒ¡ãƒ¼ãƒ«ã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ç„¡è¦–ã—ã¦ã„ãŸã ã„ã¦æ§‹ã„ã¾ã›ã‚“ã€‚\nè³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€æ‹›å¾…ã‚’é€ã£ãŸç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n\nÂ© ${(new Date).getFullYear()} Bekuta\n  `.trim()}({name:x.name,email:x.email,role:x.role,teamName:o||c,passwordSetupLink:f,inviteExpiredUrl:j,inviterName:null==d?void 0:d.name,expiresInHours:24});let N=!1,k="";try{console.log("ğŸ“§ Sending invitation email to:",x.email);const t=await fetch(`${u}/functions/v1/send-email`,{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({to:x.email,subject:`ã€Bekutaã€‘ ${o||c||"Bekuta"}åˆå›ãƒ­ã‚°ã‚¤ãƒ³è¨­å®šã®ã”æ¡ˆå†…`,html:v,text:w})}),r=await t.json();N=t.ok,N?console.log("âœ… Email sent successfully to:",x.email):(k=r.error||"Unknown error",console.error("âŒ Email sending failed:",{status:t.status,error:k,result:r}))}catch(l){k=l.message||"Network error",console.error("âŒ Email sending exception:",l)}const _={name:x.name,email:x.email,role:x.role,teamName:o,organizationName:c,user_id:null==(s=p.user)?void 0:s.user_id,invitedAt:(new Date).toLocaleString("ja-JP"),emailSent:N,inviteUrl:f};y(e=>[_,...e]),b({type:"success",text:N?`${x.name}ã•ã‚“ï¼ˆ${x.email}ï¼‰ã‚’æ‹›å¾…ã—ã¾ã—ãŸã€‚æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚`:`${x.name}ã•ã‚“ï¼ˆ${x.email}ï¼‰ã‚’æ‹›å¾…ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ãŸãŸã‚ã€æ‹›å¾…URLã‚’ç›´æ¥å…±æœ‰ã—ã¦ãã ã•ã„ã€‚`}),m({name:"",email:"",role:"athlete",organizationId:"",teamId:""}),t()}catch(d){console.error("User invitation error:",d),b({type:"error",text:d.message||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ"})}finally{g(!1)}},className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åå‰"}),R.jsx("input",{type:"text",value:x.name,onChange:e=>m(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ç”°ä¸­å¤ªéƒ",required:!0})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsx("input",{type:"email",value:x.email,onChange:e=>m(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"tanaka@example.com",required:!0})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å½¹å‰²"}),R.jsxs("select",{value:x.role,onChange:e=>{const t=e.target.value;m(e=>({...e,role:t,teamId:"global_admin"===t?"":e.teamId}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[R.jsx("option",{value:"athlete",children:"é¸æ‰‹"}),R.jsx("option",{value:"staff",children:"ã‚¹ã‚¿ãƒƒãƒ•"}),s&&R.jsx("option",{value:"global_admin",children:"ç®¡ç†è€…"})]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[R.jsx(De,{className:"w-4 h-4 text-blue-600"}),R.jsx("span",{children:"çµ„ç¹”"})]}),R.jsxs("select",{value:x.organizationId,onChange:e=>m(t=>({...t,organizationId:e.target.value,teamId:""})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:o||!!a,children:[R.jsx("option",{value:"",children:o?"èª­ã¿è¾¼ã¿ä¸­...":"çµ„ç¹”ã‚’é¸æŠ"}),n.filter(e=>!a||e.id===a).map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))]}),R.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã“ã®çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒãƒ¼ãƒ "}),R.jsxs("select",{value:x.teamId,onChange:e=>m(t=>({...t,teamId:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:"athlete"===x.role,disabled:"global_admin"===x.role||!x.organizationId,children:[R.jsx("option",{value:"",children:"global_admin"===x.role?"ç®¡ç†è€…ã¯ãƒãƒ¼ãƒ ä¸è¦":x.organizationId?"ãƒãƒ¼ãƒ ã‚’é¸æŠ":"å…ˆã«çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),i.map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))]}),"global_admin"===x.role&&R.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ç®¡ç†è€…ã¯å…¨ã¦ã®ãƒãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™"}),"global_admin"!==x.role&&!x.organizationId&&R.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"å…ˆã«çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"})]}),h&&R.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg "+("success"===h.type?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"),children:["success"===h.type?R.jsx(Te,{className:"w-5 h-5 flex-shrink-0"}):R.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),R.jsx("span",{className:"text-sm",children:h.text})]}),R.jsxs("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:[u?R.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):R.jsx(gt,{className:"w-5 h-5 mr-2"}),u?"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­...":"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡"]})]})]}),R.jsxs("div",{className:"space-y-6",children:[R.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start",children:[R.jsx(lt,{className:"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0"}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ã«ã¤ã„ã¦"}),R.jsxs("div",{className:"text-sm text-blue-700 space-y-2",children:[R.jsx("p",{children:"1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚"}),R.jsx("p",{children:"2. ãƒ¡ãƒ¼ãƒ«ã«ã¯ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šç”¨ãƒªãƒ³ã‚¯ã€ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚"}),R.jsx("p",{children:"3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒªãƒ³ã‚¯å…ˆã§è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚"}),R.jsx("p",{children:"4.  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã‚·ã‚¹ãƒ†ãƒ ä¸Šã«ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚å†ç™ºè¡Œã¯å†åº¦ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã€ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚"}),R.jsx("p",{children:"5. æ‹›å¾…ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ã¯24æ™‚é–“ã§ã™ã€‚æœ‰åŠ¹æœŸé™åˆ‡ã‚Œã®å ´åˆã¯å†åº¦æ‹›å¾…ã—ã¦ãã ã•ã„ã€‚"})]})]})]})}),R.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[R.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"å½¹å‰²ã®èª¬æ˜"}),R.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[R.jsxs("div",{className:"flex items-start",children:[R.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"}),R.jsxs("div",{children:[R.jsx("strong",{children:"é¸æ‰‹:"})," è‡ªåˆ†ã®ç·´ç¿’è¨˜éŒ²ã®å…¥åŠ›ã¨é–²è¦§ã®ã¿å¯èƒ½"]})]}),R.jsxs("div",{className:"flex items-start",children:[R.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0"}),R.jsxs("div",{children:[R.jsx("strong",{children:"ã‚¹ã‚¿ãƒƒãƒ•:"})," æ‹…å½“ãƒãƒ¼ãƒ ã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ãƒ»ç®¡ç†å¯èƒ½"]})]}),R.jsxs("div",{className:"flex items-start",children:[R.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full mt-2 mr-3 flex-shrink-0"}),R.jsxs("div",{children:[R.jsx("strong",{children:"ç®¡ç†è€…:"})," å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãŒå¯èƒ½"]})]})]})]}),p.length>0&&R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h4",{className:"font-medium text-gray-900",children:"æœ€è¿‘ã®æ‹›å¾…å±¥æ­´"}),R.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:[p.length,"ä»¶"]})]}),R.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:p.slice(0,10).map((e,t)=>R.jsxs("div",{className:"bg-gray-50 rounded p-3",children:[R.jsxs("div",{className:"flex items-center justify-between mb-1",children:[R.jsx("span",{className:"font-medium text-gray-900",children:e.name}),R.jsx("span",{className:"text-xs text-gray-500",children:e.invitedAt})]}),R.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[R.jsx("p",{children:e.email}),R.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[R.jsx("span",{children:N(e.role)}),e.organizationName&&R.jsxs("span",{className:"flex items-center gap-1",children:["â€¢ ",R.jsx(De,{className:"w-3 h-3"})," ",e.organizationName]}),e.teamName&&R.jsxs("span",{children:["â€¢ ",e.teamName]}),e.user_id&&R.jsx("span",{className:"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:e.user_id}),e.emailSent?R.jsxs("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs flex items-center space-x-1",children:[R.jsx(gt,{className:"w-3 h-3"}),R.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ¸ˆã¿"})]}):R.jsxs("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-xs flex items-center space-x-1",children:[R.jsx(ye,{className:"w-3 h-3"}),R.jsx("span",{children:"ãƒ¡ãƒ¼ãƒ«æœªé€ä¿¡"})]})]}),e.temporaryPassword&&R.jsxs("div",{className:"flex items-center space-x-2 bg-yellow-50 border border-yellow-200 p-2 rounded",children:[R.jsx("span",{className:"text-xs font-medium text-yellow-800",children:"åˆå›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:"}),R.jsx("code",{className:"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-yellow-300",children:f[t]?e.temporaryPassword:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),R.jsx("button",{onClick:()=>j(e=>({...e,[t]:!e[t]})),className:"p-1 hover:bg-yellow-100 rounded transition-colors",title:f[t]?"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’éš ã™":"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¡¨ç¤º",children:f[t]?R.jsx(Ye,{className:"w-4 h-4 text-yellow-700"}):R.jsx(Ze,{className:"w-4 h-4 text-yellow-700"})}),R.jsx("button",{onClick:()=>(async(e,t)=>{try{await navigator.clipboard.writeText(e),w(t),setTimeout(()=>w(null),2e3)}catch(r){console.error("Failed to copy password:",r)}})(e.temporaryPassword,t),className:"p-1 hover:bg-yellow-100 rounded transition-colors",title:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼",children:R.jsx(Be,{className:"w-4 h-4 "+(v===t?"text-green-600":"text-yellow-700")})})]}),e.inviteUrl&&R.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 p-2 rounded",children:[R.jsx("span",{className:"text-xs font-medium text-blue-800",children:"æ‹›å¾…URL:"}),R.jsx("code",{className:"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-blue-300 truncate",children:e.inviteUrl}),R.jsx("button",{onClick:()=>(async(e,t)=>{try{await navigator.clipboard.writeText(e),w(t+1e3),setTimeout(()=>w(null),2e3)}catch(r){console.error("Failed to copy URL:",r)}})(e.inviteUrl,t),className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"æ‹›å¾…URLã‚’ã‚³ãƒ”ãƒ¼",children:R.jsx(Be,{className:"w-4 h-4 "+(v===t+1e3?"text-green-600":"text-blue-700")})}),R.jsx("a",{href:e.inviteUrl,className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"æ‹›å¾…ãƒšãƒ¼ã‚¸ã‚’é–‹ãï¼ˆåŒã˜ã‚¿ãƒ–ã§é–‹ãã¾ã™ï¼‰",children:R.jsx(ot,{className:"w-4 h-4 text-blue-700"})})]})]})]},t))})]})]})]})]})}function Yn({teams:e,onUsersInvited:t,restrictToOrganizationId:a,allowAdminInvite:s=!0}){const[n,l]=r.useState(null),[i,d]=r.useState(!1),[o,c]=r.useState([]),[x,m]=r.useState(!1),u=o.filter(e=>"success"===e.status).length,g=o.filter(e=>"error"===e.status).length;return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx(rr,{className:"w-6 h-6 text-purple-600"}),R.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€æ‹¬æ‹›å¾…"})]}),R.jsxs("button",{onClick:()=>{const e=[["ç”°ä¸­å¤ªéƒ","tanaka@example.com","athlete","æ„›å·¥å¤§åé›»é«˜æ ¡","ã‚µãƒƒã‚«ãƒ¼éƒ¨"],["ä½è—¤èŠ±å­","sato@example.com","staff","æ„›å·¥å¤§åé›»é«˜æ ¡","ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«éƒ¨"],s?["ç®¡ç†è€…","admin@example.com","global_admin","æ„›å·¥å¤§åé›»é«˜æ ¡",""]:null].filter(Boolean),t=["# Bekuta ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€æ‹¬æ‹›å¾…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ","# æ³¨æ„äº‹é …:",s?"# - role ã¯ athlete, staff, global_admin ã®ã„ãšã‚Œã‹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„":"# - role ã¯ athlete, staff ã®ã„ãšã‚Œã‹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„","# - organizationName ã¯ç®¡ç†ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹çµ„ç¹”åã¨å®Œå…¨ã«åŒã˜æ–‡å­—åˆ—ã§å…¥åŠ›ã—ã¦ãã ã•ã„","# - athlete ã®å ´åˆã¯ team_name ã‚’å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„","# - staff ã®å ´åˆã‚‚ team_name ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼ˆæŒ‡å®šã—ãŸãƒãƒ¼ãƒ ã‚’ç®¡ç†ã—ã¾ã™ï¼‰","# - global_admin ã®å ´åˆã¯ team_name ã¯ç©ºç™½ã§ã‚‚æ§‹ã„ã¾ã›ã‚“","",["name","email","role","organizationName","team_name"].join(","),...e.map(e=>e.join(","))].filter(Boolean).join("\n"),r=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),n=URL.createObjectURL(r);a.setAttribute("href",n),a.setAttribute("download","ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€æ‹¬æ‹›å¾…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm",children:[R.jsx(He,{className:"w-4 h-4"}),R.jsx("span",{children:"CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"})]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[R.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:R.jsxs("div",{className:"text-center",children:[R.jsx(Yt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),R.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),R.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å«ã‚€CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„"}),R.jsx("input",{type:"file",accept:".csv",onChange:e=>{var t;const r=(null==(t=e.target.files)?void 0:t[0])||null;l(r),m(!1),c([])},className:"hidden",id:"csv-upload"}),R.jsxs("label",{htmlFor:"csv-upload",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg cursor-pointer transition-colors inline-flex items-center space-x-2",children:[R.jsx(Ge,{className:"w-5 h-5"}),R.jsx("span",{children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"})]}),n&&R.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:R.jsxs("p",{className:"text-sm text-green-700",children:["é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:"," ",R.jsx("strong",{children:n.name})]})}),n&&R.jsxs("button",{onClick:async()=>{if(n){d(!0);try{const r=(e=>{const t=e.split("\n").map(e=>e.trim()).filter(e=>e&&!e.startsWith("#"));if(t.length<2)throw new Error("CSVã«ãƒ‡ãƒ¼ã‚¿è¡ŒãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‹1è¡Œä»¥ä¸Šå¿…è¦ã§ã™ï¼‰");const r=t[0].split(",").map(e=>e.trim().replace(/^"|"$/g,"")),a=e=>r.findIndex(t=>e.some(e=>t.toLowerCase()===e.toLowerCase())),n=a(["name"]),l=a(["email"]),i=a(["role"]),d=a(["organizationname","organization","organization_name"]),o=a(["team_name","team"]);if(-1===n||-1===l||-1===i||-1===d)throw new Error("CSVã«ã¯ name, email, role, organizationName ã®4åˆ—ãŒå¿…è¦ã§ã™");const c=[];for(let x=1;x<t.length;x++){const e=t[x].split(",").map(e=>e.trim().replace(/^"|"$/g,""));if(!(e[n]&&e[l]&&e[i]&&e[d]))continue;const r=e[i].toLowerCase();(s?["athlete","staff","global_admin"]:["athlete","staff"]).includes(r)&&c.push({name:e[n],email:e[l],role:r,organizationName:e[d],teamName:-1!==o&&e[o]||void 0})}if(0===c.length)throw new Error("CSVã«æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");return c})(await n.text()),l=await(async t=>{var r;const{data:{session:s}}=await q.auth.getSession();if(!s)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã—ã¦ãã ã•ã„ï¼‰");let n=q.from("organizations").select("id, name");a&&(n=n.eq("id",a));const{data:l,error:i}=await n;if(i||!l||0===l.length)throw new Error("çµ„ç¹”ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");const d="http://127.0.0.1:54321",o=[];for(const m of t){try{const t=l.find(e=>e.name===m.organizationName);if(!t){o.push({...m,status:"error",message:`çµ„ç¹” "${m.organizationName}" ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`});continue}if(a&&t.id!==a){o.push({...m,status:"error",message:`ã“ã®ç”»é¢ã‹ã‚‰ã¯çµ„ç¹”ID "${a}" ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿æ‹›å¾…ã§ãã¾ã™ï¼ˆCSVä¸Šã®çµ„ç¹”: ${m.organizationName}ï¼‰`});continue}let n;if(m.teamName){const r=e.find(e=>e.name===m.teamName&&e.organization_id===t.id);if(!r){o.push({...m,status:"error",message:`çµ„ç¹” "${t.name}" ã«ãƒãƒ¼ãƒ  "${m.teamName}" ã¯å­˜åœ¨ã—ã¾ã›ã‚“`});continue}n=r.id}if("athlete"===m.role&&!n){o.push({...m,status:"error",message:"athleteï¼ˆé¸æ‰‹ï¼‰ã«ã¯ team_nameï¼ˆãƒãƒ¼ãƒ åï¼‰ã®æŒ‡å®šãŒå¿…é ˆã§ã™"});continue}console.log("ğŸš€ Creating user:",m.email);const i=await fetch(`${d}/functions/v1/create-user`,{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({name:m.name,email:m.email,role:m.role,teamId:n,organizationId:t.id,redirectUrl:`${window.location.origin}/reset-password`})}),x=await i.json();if(!i.ok){console.error("âŒ create-user error:",x),o.push({...m,status:"error",message:x.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ"});continue}const u=x.passwordSetupLink;if(!u){o.push({...m,status:"error",message:"Edge Function ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒªãƒ³ã‚¯ãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"});continue}let g=!1,h="";try{console.log("ğŸ“§ Sending invitation email to:",m.email);const e=await fetch(`${d}/functions/v1/send-email`,{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({to:m.email,type:"invitation",data:{name:m.name,email:m.email,role:m.role,teamName:m.teamName,passwordSetupLink:u,expiresInHours:24}})}),t=await e.json();g=e.ok,g?console.log("âœ… Email sent successfully to:",m.email):(h=t.error||"Unknown error",console.error("âŒ Invitation email failed:",{status:e.status,error:h,result:t}))}catch(c){h=c.message||"Network error",console.error("âŒ Invitation email exception:",c)}o.push({...m,status:g?"success":"error",message:g?"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†":`ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå®Œäº†ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—: ${h}ï¼‰`,user_id:null==(r=x.user)?void 0:r.user_id,teamId:n})}catch(x){console.error("âŒ Bulk invite error for row:",m,x),o.push({...m,status:"error",message:x.message||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"})}await new Promise(e=>setTimeout(e,2e3))}return o})(r);c(l),m(!0);l.filter(e=>"success"===e.status).length>0&&t()}catch(r){console.error("Bulk invitation error:",r),alert(`ä¸€æ‹¬æ‹›å¾…ã‚¨ãƒ©ãƒ¼: ${r.message}`)}finally{d(!1)}}},disabled:i,className:"mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",children:[i?R.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):R.jsx(gt,{className:"w-5 h-5 mr-2"}),i?"æ‹›å¾…å‡¦ç†ä¸­...":"ä¸€æ‹¬æ‹›å¾…å®Ÿè¡Œ"]})]})}),R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[R.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"CSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼"}),R.jsxs("div",{className:"text-sm text-blue-700 space-y-2",children:[R.jsx("p",{children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®åˆ—ãŒå¿…è¦ã§ã™ï¼š"}),R.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[R.jsxs("li",{children:[R.jsx("strong",{children:"name:"})," ãƒ¦ãƒ¼ã‚¶ãƒ¼å"]}),R.jsxs("li",{children:[R.jsx("strong",{children:"email:"})," ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"]}),R.jsxs("li",{children:[R.jsx("strong",{children:"role:"})," athlete, staff, global_admin ã®ã„ãšã‚Œã‹"]}),R.jsxs("li",{children:[R.jsx("strong",{children:"organizationName:"})," çµ„ç¹”åï¼ˆç®¡ç†ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹åç§°ã¨å®Œå…¨ä¸€è‡´ï¼‰"]}),R.jsxs("li",{children:[R.jsx("strong",{children:"team_name:"})," ãƒãƒ¼ãƒ åï¼ˆathlete ã¯å¿…é ˆ / staff æ¨å¥¨ï¼‰"]})]})]})]}),R.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[R.jsx("h4",{className:"font-medium text-amber-900 mb-3",children:"æ³¨æ„äº‹é …"}),R.jsxs("div",{className:"text-sm text-amber-700 space-y-1",children:[R.jsx("p",{children:"â€¢ å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™"}),R.jsx("p",{children:"â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™"}),R.jsx("p",{children:"â€¢ çµ„ç¹”åã¨ãƒãƒ¼ãƒ åã¯ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®åç§°ã¨å®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"}),R.jsx("p",{children:"â€¢ å‡¦ç†ã«ã¯æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™"})]})]}),x&&R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h4",{className:"font-medium text-gray-900",children:"å‡¦ç†çµæœ"}),R.jsxs("button",{onClick:()=>{if(0===o.length)return;const e=[`# ä¸€æ‹¬æ‹›å¾…çµæœ - ${(new Date).toLocaleString("ja-JP")}`,`# æˆåŠŸ: ${o.filter(e=>"success"===e.status).length}ä»¶`,`# å¤±æ•—: ${o.filter(e=>"error"===e.status).length}ä»¶`,"",["åå‰","ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹","å½¹å‰²","çµ„ç¹”","ãƒãƒ¼ãƒ ","ãƒ¦ãƒ¼ã‚¶ãƒ¼ID","çŠ¶æ…‹","ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"].join(","),...o.map(e=>[e.name,e.email,"athlete"===e.role?"é¸æ‰‹":"staff"===e.role?"ã‚¹ã‚¿ãƒƒãƒ•":"ç®¡ç†è€…",e.organizationName,e.teamName||"-",e.user_id||"-","success"===e.status?"æˆåŠŸ":"å¤±æ•—",e.message].join(","))].join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(t);r.setAttribute("href",a),r.setAttribute("download",`ä¸€æ‹¬æ‹›å¾…çµæœ_${H()}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center space-x-1",children:[R.jsx(He,{className:"w-3 h-3"}),R.jsx("span",{children:"çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[R.jsxs("div",{className:"bg-green-50 rounded p-3 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-green-600",children:u}),R.jsx("div",{className:"text-sm text-green-700",children:"æˆåŠŸ"})]}),R.jsxs("div",{className:"bg-red-50 rounded p-3 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-red-600",children:g}),R.jsx("div",{className:"text-sm text-red-700",children:"å¤±æ•—"})]})]}),R.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:o.map((e,t)=>R.jsx("div",{className:"p-3 rounded border "+("success"===e.status?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:R.jsx("div",{className:"flex items-center justify-between",children:R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center space-x-2",children:["success"===e.status?R.jsx(Te,{className:"w-4 h-4 text-green-600"}):R.jsx(ye,{className:"w-4 h-4 text-red-600"}),R.jsx("span",{className:"font-medium",children:e.name}),e.user_id&&R.jsx("span",{className:"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:e.user_id})]}),R.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.email," â€¢ ",e.role," ","â€¢ ",e.organizationName,e.teamName&&` â€¢ ${e.teamName}`]}),R.jsx("div",{className:"text-xs mt-1 "+("success"===e.status?"text-green-600":"text-red-600"),children:e.message})]})})},t))})]})]})]})]})}function Zn({data:e,itemsPerPage:t=20,renderItem:a,renderHeader:s,loading:n=!1,emptyMessage:l="ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}){const[i,d]=r.useState(1),o=Math.ceil(e.length/t),c=(i-1)*t,x=c+t,u=r.useMemo(()=>e.slice(c,x),[e,c,x]),g=e=>{e>=1&&e<=o&&d(e)};return n?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):0===e.length?R.jsx("div",{className:"text-center py-12",children:R.jsx("p",{className:"text-gray-500",children:l})}):R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[R.jsxs("div",{children:[c+1," - ",Math.min(x,e.length)," / ",e.length,"ä»¶ã‚’è¡¨ç¤º"]}),R.jsxs("div",{children:["ãƒšãƒ¼ã‚¸ ",i," / ",o]})]}),s&&s(),R.jsx("div",{className:"space-y-2",children:u.map((e,t)=>a(e,c+t))}),o>1&&R.jsxs("div",{className:"flex items-center justify-center space-x-2 py-4",children:[R.jsx("button",{onClick:()=>g(1),disabled:1===i,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"æœ€åˆã®ãƒšãƒ¼ã‚¸",children:R.jsx(Ie,{className:"w-4 h-4"})}),R.jsx("button",{onClick:()=>g(i-1),disabled:1===i,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"å‰ã®ãƒšãƒ¼ã‚¸",children:R.jsx(ze,{className:"w-4 h-4"})}),R.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const e=[],t=[];for(let r=Math.max(2,i-2);r<=Math.min(o-1,i+2);r++)e.push(r);return i-2>2?t.push(1,"..."):t.push(1),t.push(...e),i+2<o-1?t.push("...",o):o>1&&t.push(o),t})().map((e,t)=>R.jsx(m.Fragment,{children:"..."===e?R.jsx("span",{className:"px-3 py-2 text-gray-500",children:"..."}):R.jsx("button",{onClick:()=>g(e),className:"px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(i===e?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"),children:e})},t))}),R.jsx("button",{onClick:()=>g(i+1),disabled:i===o,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"æ¬¡ã®ãƒšãƒ¼ã‚¸",children:R.jsx(qe,{className:"w-4 h-4"})}),R.jsx("button",{onClick:()=>g(o),disabled:i===o,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",title:"æœ€å¾Œã®ãƒšãƒ¼ã‚¸",children:R.jsx(Le,{className:"w-4 h-4"})})]}),R.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm",children:[R.jsx("span",{className:"text-gray-600",children:"è¡¨ç¤ºä»¶æ•°:"}),R.jsxs("select",{value:t,onChange:e=>{parseInt(e.target.value),d(1)},className:"border border-gray-300 rounded px-2 py-1",children:[R.jsx("option",{value:10,children:"10ä»¶"}),R.jsx("option",{value:20,children:"20ä»¶"}),R.jsx("option",{value:50,children:"50ä»¶"}),R.jsx("option",{value:100,children:"100ä»¶"})]})]})]})}function Gn({user:e,teams:t,onClose:a,onUserUpdated:s}){const[n,l]=r.useState({name:e.name,email:e.email,role:e.role,teamId:e.team_id||""}),[i,d]=r.useState(!1),[o,c]=r.useState(null),[x,m]=r.useState([]),[u,g]=r.useState(!1);r.useEffect(()=>{"staff"===e.role&&h()},[e.id,e.role]);const h=async()=>{try{const{data:t,error:r}=await q.from("staff_team_links").select("\n          team_id,\n          teams (\n            id,\n            name\n          )\n        ").eq("staff_user_id",e.id);if(r)return void console.error("Error fetching staff teams:",r);const a=null==t?void 0:t.map(e=>e.teams).filter(Boolean);m(a||[]),g((a||[]).length>1),a&&a.length>0&&l(e=>({...e,teamId:a[0].id}))}catch(t){console.error("Error fetching staff teams:",t)}};return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[R.jsx("div",{className:"bg-blue-600 text-white p-6 rounded-t-2xl",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("h2",{className:"text-xl font-bold",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†"}),R.jsx("button",{onClick:a,className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:R.jsx(sr,{className:"w-5 h-5"})})]})}),R.jsxs("div",{className:"p-6",children:[u&&R.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:R.jsxs("div",{className:"flex items-start",children:[R.jsx(fe,{className:"w-5 h-5 text-amber-600 mr-3 mt-0.5 flex-shrink-0"}),R.jsxs("div",{className:"flex-1",children:[R.jsxs("h3",{className:"font-medium text-amber-900 mb-2 flex items-center",children:[R.jsx(rr,{className:"w-4 h-4 mr-1"}),"è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ã‚¹ã‚¿ãƒƒãƒ•"]}),R.jsxs("div",{className:"text-sm text-amber-700 space-y-2",children:[R.jsx("p",{children:"ã“ã®ã‚¹ã‚¿ãƒƒãƒ•ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ï¼š"}),R.jsx("div",{className:"bg-amber-100 rounded p-2",children:x.map((e,t)=>R.jsxs("div",{className:"flex items-center",children:[R.jsx("span",{className:"w-2 h-2 bg-amber-600 rounded-full mr-2"}),R.jsx("span",{className:"font-medium",children:e.name})]},e.id))}),R.jsxs("div",{className:"bg-white border border-amber-300 rounded p-3 mt-3",children:[R.jsx("p",{className:"font-medium text-amber-900 mb-1",children:"âš ï¸ ç·¨é›†æ™‚ã®æ³¨æ„"}),R.jsxs("ul",{className:"text-xs space-y-1",children:[R.jsx("li",{children:"â€¢ ãƒãƒ¼ãƒ å¤‰æ›´ã¯æœ€åˆã®ãƒãƒ¼ãƒ ã®ã¿è¨­å®šã•ã‚Œã¾ã™"}),R.jsx("li",{children:"â€¢ è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ã‚’ç¶­æŒã™ã‚‹ã«ã¯Supabaseå´ã§è¨­å®šãŒå¿…è¦"}),R.jsx("li",{children:"â€¢ å½¹å‰²å¤‰æ›´æ™‚ã¯å…¨ã¦ã®ãƒãƒ¼ãƒ é–¢é€£ä»˜ã‘ãŒå‰Šé™¤ã•ã‚Œã¾ã™"})]})]})]})]})]})}),R.jsxs("form",{onSubmit:async t=>{t.preventDefault(),d(!0),c(null);try{const{data:{session:t}}=await q.auth.getSession();if(!t)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r="http://127.0.0.1:54321",a=await fetch(`${r}/functions/v1/update-user`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,name:n.name,email:n.email,role:n.role,teamId:n.teamId||void 0})}),l=await a.json();if(!a.ok)throw new Error(l.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");c({type:"success",text:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚"}),setTimeout(()=>{s()},1e3)}catch(r){console.error("Error updating user:",r),c({type:"error",text:`æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`})}finally{d(!1)}},className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åå‰"}),R.jsx("input",{type:"text",value:n.name,onChange:e=>l(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsx("input",{type:"email",value:n.email,onChange:e=>l(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["å½¹å‰²",u&&R.jsx("span",{className:"ml-2 text-xs text-amber-600 font-normal",children:"âš ï¸ å¤‰æ›´ã™ã‚‹ã¨è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ãŒè§£é™¤ã•ã‚Œã¾ã™"})]}),R.jsxs("select",{value:n.role,onChange:e=>{const t=e.target.value;l(e=>({...e,role:t,teamId:"global_admin"===t?"":e.teamId}))},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(u?"border-amber-300 bg-amber-50":"border-gray-300"),children:[R.jsx("option",{value:"athlete",children:"é¸æ‰‹"}),R.jsx("option",{value:"staff",children:"ã‚¹ã‚¿ãƒƒãƒ•"}),R.jsx("option",{value:"global_admin",children:"ç®¡ç†è€…"})]})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ãƒãƒ¼ãƒ ",u&&"staff"===n.role&&R.jsx("span",{className:"ml-2 text-xs text-amber-600 font-normal",children:"âš ï¸ æœ€åˆã®ãƒãƒ¼ãƒ ã®ã¿è¨­å®šã•ã‚Œã¾ã™"})]}),R.jsxs("select",{value:n.teamId,onChange:e=>l(t=>({...t,teamId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(u&&"staff"===n.role?"border-amber-300 bg-amber-50":"border-gray-300"),required:"athlete"===n.role,disabled:"global_admin"===n.role,children:[R.jsx("option",{value:"",children:"global_admin"===n.role?"ç®¡ç†è€…ã¯ãƒãƒ¼ãƒ ä¸è¦":"ãƒãƒ¼ãƒ ã‚’é¸æŠ"}),t.map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))]}),"global_admin"===n.role&&R.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ç®¡ç†è€…ã¯å…¨ã¦ã®ãƒãƒ¼ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™"}),"staff"===n.role&&!u&&R.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ã‚¹ã‚¿ãƒƒãƒ•ã¯é¸æŠã—ãŸãƒãƒ¼ãƒ ã‚’ç®¡ç†ã§ãã¾ã™"}),u&&"staff"===n.role&&R.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"è¤‡æ•°ãƒãƒ¼ãƒ ç®¡ç†ã‚’ç¶­æŒã™ã‚‹ã«ã¯ã€Supabaseå´ã§å†è¨­å®šãŒå¿…è¦ã§ã™"})]}),o&&R.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg "+("success"===o.type?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"),children:["success"===o.type?R.jsx(Te,{className:"w-5 h-5 flex-shrink-0"}):R.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),R.jsx("span",{className:"text-sm",children:o.text})]}),R.jsxs("div",{className:"flex space-x-3 pt-4",children:[R.jsx("button",{type:"button",onClick:a,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsxs("button",{type:"submit",disabled:i,className:"flex-1 py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center "+(u?"bg-amber-600 hover:bg-amber-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"),children:[i?R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):R.jsx(Mt,{className:"w-4 h-4 mr-2"}),i?"æ›´æ–°ä¸­...":u?"æ³¨æ„ã—ã¦æ›´æ–°":"æ›´æ–°"]})]})]})]})]})})}function Qn({user:e,onClose:t,onUserDeleted:a}){const[s,n]=r.useState(!1),[l,i]=r.useState(""),[d,o]=r.useState(null);return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:[R.jsx("div",{className:"bg-red-600 text-white p-6 rounded-t-2xl",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx(fe,{className:"w-6 h-6 mr-3"}),R.jsx("h2",{className:"text-xl font-bold",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤"})]}),R.jsx("button",{onClick:t,className:"bg-red-500 hover:bg-red-400 rounded-full p-2 transition-colors",children:R.jsx(sr,{className:"w-5 h-5"})})]})}),R.jsxs("div",{className:"p-6",children:[R.jsxs("div",{className:"mb-6",children:[R.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:R.jsxs("div",{className:"flex items-start",children:[R.jsx(fe,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-medium text-red-900 mb-2",children:"è­¦å‘Š: ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“"}),R.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[R.jsx("p",{children:"â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™"}),R.jsx("p",{children:"â€¢ é–¢é€£ã™ã‚‹ç·´ç¿’è¨˜éŒ²ã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™"}),R.jsx("p",{children:"â€¢ ãƒãƒ¼ãƒ ã¨ã®é–¢é€£ä»˜ã‘ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™"})]})]})]})}),R.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[R.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"å‰Šé™¤å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼"}),R.jsxs("div",{className:"text-sm text-gray-700",children:[R.jsxs("p",{children:[R.jsx("strong",{children:"åå‰:"})," ",e.name]}),R.jsxs("p",{children:[R.jsx("strong",{children:"ãƒ¡ãƒ¼ãƒ«:"})," ",e.email]}),R.jsxs("p",{children:[R.jsx("strong",{children:"å½¹å‰²:"})," ","athlete"===e.role?"é¸æ‰‹":"staff"===e.role?"ã‚¹ã‚¿ãƒƒãƒ•":"ç®¡ç†è€…"]})]})]})]}),R.jsxs("div",{className:"mb-6",children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["å‰Šé™¤ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€Œ",R.jsx("strong",{children:e.name}),"ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"]}),R.jsx("input",{type:"text",value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:e.name})]}),d&&R.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg mb-4 "+("success"===d.type?"bg-green-50 border border-green-200 text-green-600":"bg-red-50 border border-red-200 text-red-600"),children:["success"===d.type?R.jsx(Te,{className:"w-5 h-5 flex-shrink-0"}):R.jsx(fe,{className:"w-5 h-5 flex-shrink-0"}),R.jsx("span",{className:"text-sm",children:d.text})]}),R.jsxs("div",{className:"flex space-x-3",children:[R.jsx("button",{type:"button",onClick:t,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsxs("button",{onClick:async()=>{if(l===e.name){n(!0),o(null);try{const{data:{session:t}}=await q.auth.getSession();if(!t)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const r="http://127.0.0.1:54321",s=await fetch(`${r}/functions/v1/delete-user`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})}),n=await s.json();if(!s.ok)throw new Error(n.error||"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");o({type:"success",text:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚"}),setTimeout(()=>{a()},1e3)}catch(t){console.error("Error deleting user:",t),o({type:"error",text:`å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.message}`})}finally{n(!1)}}else o({type:"error",text:"ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚"})},disabled:s||l!==e.name,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[s?R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):R.jsx(Ut,{className:"w-4 h-4 mr-2"}),s?"å‰Šé™¤ä¸­...":"å‰Šé™¤ã™ã‚‹"]})]})]})]})})}function Xn({teams:e,restrictToOrganizationId:t}){const[a,s]=r.useState([]),[n,l]=r.useState([]),[i,d]=r.useState(!0),[o,c]=r.useState(null),[x,m]=r.useState(!1),[u,g]=r.useState(!1),[h,b]=r.useState(null),[p,y]=r.useState(""),[f,j]=r.useState("all"),v=r.useCallback(async()=>{d(!0),b(null);try{if(t){const{data:e,error:r}=await q.from("organization_members").select("user_id").eq("organization_id",t);if(r)throw r;const a=(null==e?void 0:e.map(e=>e.user_id))||[];if(0===a.length)return void s([]);const{data:n,error:l}=await q.from("users").select("*").in("id",a).neq("role","global_admin").order("created_at",{ascending:!1});if(l)throw l;s(n||[])}else{const{data:e,error:t}=await q.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;s(e||[])}}catch(e){console.error("Error fetching users:",e),b("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{d(!1)}},[t]);r.useEffect(()=>{v()},[v]),r.useEffect(()=>{let e=a;p&&(e=e.filter(e=>e.name.toLowerCase().includes(p.toLowerCase())||e.email.toLowerCase().includes(p.toLowerCase())||e.user_id&&e.user_id.toLowerCase().includes(p.toLowerCase()))),"all"!==f&&(e=e.filter(e=>e.role===f)),l(e)},[a,p,f]);const w=e=>{c(e),m(!0)},N=e=>{c(e),g(!0)},k=t=>{if(!t)return"-";const r=e.find(e=>e.id===t);return r?r.name:"ä¸æ˜ãªãƒãƒ¼ãƒ "},_=e=>{switch(e){case"athlete":return"é¸æ‰‹";case"staff":return"ã‚¹ã‚¿ãƒƒãƒ•";case"global_admin":return"ç®¡ç†è€…";default:return e}},C=e=>{switch(e){case"global_admin":return"bg-purple-100 text-purple-800";case"staff":return"bg-green-100 text-green-800";case"athlete":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx(rr,{className:"w-6 h-6 text-purple-600"}),R.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†"})]}),R.jsxs("div",{className:"text-sm text-gray-600",children:[a.length,"åã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™"]})]}),R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[R.jsx("div",{className:"flex-1",children:R.jsxs("div",{className:"relative",children:[R.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),R.jsx("input",{type:"text",placeholder:"åå‰ã€ãƒ¡ãƒ¼ãƒ«ã€ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§æ¤œç´¢...",value:p,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),R.jsx("div",{className:"sm:w-48",children:R.jsxs("div",{className:"relative",children:[R.jsx(Xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),R.jsxs("select",{value:f,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none",children:[R.jsx("option",{value:"all",children:"å…¨ã¦ã®å½¹å‰²"}),R.jsx("option",{value:"global_admin",children:"ç®¡ç†è€…"}),R.jsx("option",{value:"staff",children:"ã‚¹ã‚¿ãƒƒãƒ•"}),R.jsx("option",{value:"athlete",children:"é¸æ‰‹"})]})]})})]}),(p||"all"!==f)&&R.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:R.jsxs("div",{className:"flex items-center justify-between text-sm",children:[R.jsxs("div",{className:"text-gray-600",children:["ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœ: ",n.length,"å",p&&R.jsxs("span",{className:"ml-2",children:["ã€Œ",p,"ã€ã§æ¤œç´¢"]}),"all"!==f&&R.jsxs("span",{className:"ml-2",children:["å½¹å‰²: ",_(f)]})]}),R.jsx("button",{onClick:()=>{y(""),j("all")},className:"text-blue-600 hover:text-blue-700 underline",children:"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢"})]})})]}),h&&R.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:[R.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),R.jsx("span",{className:"text-sm",children:h})]}),R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[R.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-purple-600",children:a.filter(e=>"global_admin"===e.role).length}),R.jsx("div",{className:"text-sm text-purple-700",children:"ç®¡ç†è€…"})]}),R.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.filter(e=>"staff"===e.role).length}),R.jsx("div",{className:"text-sm text-green-700",children:"ã‚¹ã‚¿ãƒƒãƒ•"})]}),R.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.filter(e=>"athlete"===e.role).length}),R.jsx("div",{className:"text-sm text-blue-700",children:"é¸æ‰‹"})]}),R.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-gray-600",children:a.length}),R.jsx("div",{className:"text-sm text-gray-700",children:"åˆè¨ˆ"})]})]}),R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[R.jsx("div",{className:"p-4 border-b border-gray-200",children:R.jsx("h3",{className:"font-medium text-gray-900",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§"})}),R.jsx("div",{className:"p-4",children:R.jsx(Zn,{data:n,itemsPerPage:10,renderItem:(e,t)=>R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[R.jsx("div",{className:"block sm:hidden space-y-3",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[R.jsx("span",{className:"font-mono text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:e.user_id||"N/A"}),R.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${C(e.role)}`,children:_(e.role)})]}),R.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),R.jsx("p",{className:"text-sm text-gray-600 truncate",children:e.email}),R.jsx("p",{className:"text-xs text-gray-500",children:k(e.team_id)})]}),R.jsxs("div",{className:"flex space-x-2 ml-2",children:[R.jsx("button",{onClick:()=>w(e),className:"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors",title:"ç·¨é›†",children:R.jsx(Lt,{className:"w-4 h-4"})}),R.jsx("button",{onClick:()=>N(e),className:"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"w-4 h-4"})})]})]})}),R.jsxs("div",{className:"hidden sm:grid grid-cols-6 gap-4 items-center",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ID"}),R.jsx("div",{className:"font-mono text-sm bg-gray-100 text-gray-700 px-2 py-1 rounded inline-block",children:e.user_id||"N/A"})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"åå‰"}),R.jsx("div",{className:"font-semibold text-gray-900",children:e.name})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ãƒ¡ãƒ¼ãƒ«"}),R.jsx("div",{className:"text-sm text-gray-700 break-all",children:e.email})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"å½¹å‰²"}),R.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${C(e.role)}`,children:_(e.role)})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"ãƒãƒ¼ãƒ "}),R.jsx("div",{className:"text-sm text-gray-700",children:k(e.team_id)})]}),R.jsxs("div",{className:"flex justify-end space-x-2",children:[R.jsx("button",{onClick:()=>w(e),className:"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors",title:"ç·¨é›†",children:R.jsx(Lt,{className:"w-4 h-4"})}),R.jsx("button",{onClick:()=>N(e),className:"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"w-4 h-4"})})]})]})]},e.id),loading:i,emptyMessage:p||"all"!==f?"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã«è©²å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚":"ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"})})]}),o&&x&&R.jsx(Gn,{user:o,teams:e,onClose:()=>{m(!1),c(null)},onUserUpdated:()=>{m(!1),c(null),v()}}),o&&u&&R.jsx(Qn,{user:o,onClose:()=>{g(!1),c(null)},onUserDeleted:()=>{g(!1),c(null),v()}})]})}function el(){const[e,t]=r.useState("high"),[a,s]=r.useState(!1),[n,l]=r.useState(null),[i,d]=r.useState(null),[o,c]=r.useState(null),[x,m]=r.useState(!1),[u,g]=r.useState(null),h=r.useMemo(()=>{const e="http://127.0.0.1:54321";return e?`${e}/functions/v1/calculate-metabolism`:"/functions/v1/calculate-metabolism"},[]),b=async()=>{var t,r;s(!0),l(null);try{const{data:a}=await q.auth.getUser(),s=null==(t=null==a?void 0:a.user)?void 0:t.id;if(!s)throw new Error("ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå–å¾—ã§ãã¾ã›ã‚“");const{data:n}=await q.auth.getSession(),l=null==(r=null==n?void 0:n.session)?void 0:r.access_token;if(!l)throw new Error("ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—å¤±æ•—");const i=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({activity_level:e})}),o=await i.json();if(!i.ok)throw new Error((null==o?void 0:o.error)??"Edge Function error");d(o),await p(s)}catch(a){l(String((null==a?void 0:a.message)??a)),d(null)}finally{s(!1)}},p=async e=>{m(!0),g(null);try{const{data:t,error:r}=await q.from("nutrition_metabolism_7d_avg").select("*").eq("user_id",e).single();if(r)throw r;c(t)}catch(t){g(String((null==t?void 0:t.message)??t)),c(null)}finally{m(!1)}},y=r.useMemo(()=>i&&o?i.tdee-o.avg_tdee:null,[i,o]),f=r.useMemo(()=>null===y?null:y>150?"ä»Šæ—¥ã¯æ´»å‹•é‡ãŒã‹ãªã‚Šé«˜ã‚":y>50?"ä»Šæ—¥ã¯ã‚„ã‚„æ´»å‹•é‡å¤šã‚":y<-150?"ä»Šæ—¥ã¯æ´»å‹•é‡ãŒä½ã‚":y<-50?"ä»Šæ—¥ã¯ã‚„ã‚„æ´»å‹•é‡å°‘ãªã‚":"å¹³å‡çš„ãªæ´»å‹•é‡",[y]);return r.useEffect(()=>{b()},[]),R.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[R.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx(pe,{className:"w-5 h-5 text-indigo-600"}),R.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"æ „é¤Šãƒ‡ãƒãƒƒã‚°ï¼ˆéå…¬é–‹ï¼‰"})]}),R.jsxs("button",{onClick:b,disabled:a,className:"inline-flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:[R.jsx(Ct,{className:"w-4 h-4 "+(a?"animate-spin":"")}),"å†å–å¾—"]})]}),R.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 mb-4",children:[R.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[R.jsx(lt,{className:"w-4 h-4 text-gray-400"}),"InBody â†’ LBM â†’ BMR â†’ TDEEï¼ˆæ¤œè¨¼ç”¨ï¼‰"]}),R.jsxs("div",{className:"sm:ml-auto flex items-center gap-2",children:[R.jsx("span",{className:"text-xs text-gray-500",children:"æ´»å‹•ãƒ¬ãƒ™ãƒ«"}),R.jsxs("select",{value:e,onChange:e=>t(e.target.value),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg",children:[R.jsx("option",{value:"low",children:"low"}),R.jsx("option",{value:"medium",children:"medium"}),R.jsx("option",{value:"high",children:"high"}),R.jsx("option",{value:"elite",children:"elite"})]}),R.jsx("button",{onClick:b,disabled:a,className:"px-3 py-2 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:"åæ˜ "})]})]}),n&&R.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700 flex items-start gap-2",children:[R.jsx(fe,{className:"w-4 h-4 mt-0.5"}),R.jsx("div",{children:n})]}),i&&R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[R.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[R.jsx("div",{className:"text-xs text-gray-500",children:"ä½“é‡"}),R.jsxs("div",{className:"text-2xl font-bold",children:[i.weight," kg"]})]}),R.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[R.jsx("div",{className:"text-xs text-gray-500",children:"ä½“è„‚è‚ªç‡"}),R.jsxs("div",{className:"text-2xl font-bold",children:[i.body_fat_percent??"â€”","%"]})]}),R.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[R.jsx("div",{className:"text-xs text-gray-500",children:"é™¤è„‚è‚ªä½“é‡ï¼ˆLBMï¼‰"}),R.jsxs("div",{className:"text-2xl font-bold",children:[i.lean_mass??"â€”"," kg"]})]}),R.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[R.jsx("div",{className:"text-xs text-gray-500",children:"BMR"}),R.jsxs("div",{className:"text-2xl font-bold",children:[i.bmr," kcal"]})]}),R.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg sm:col-span-2",children:[R.jsx("div",{className:"text-xs text-indigo-700",children:"TDEE"}),R.jsxs("div",{className:"text-3xl font-extrabold text-indigo-900",children:[i.tdee," kcal"]})]})]}),x&&R.jsx("div",{className:"text-sm text-gray-500",children:"7æ—¥å¹³å‡ã‚’è¨ˆç®—ä¸­..."}),u&&R.jsxs("div",{className:"text-sm text-yellow-700",children:["7æ—¥å¹³å‡å–å¾—å¤±æ•—: ",u]}),o&&i&&null!==y&&R.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[R.jsx("div",{className:"font-semibold mb-2",children:"ç›´è¿‘7æ—¥å¹³å‡ã¨ã®å·®ï¼ˆæ´»å‹•é‡ï¼‰"}),R.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-gray-500",children:"ä»Šæ—¥"}),R.jsxs("div",{className:"font-bold",children:[i.tdee," kcal"]})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-gray-500",children:"7æ—¥å¹³å‡"}),R.jsxs("div",{className:"font-bold",children:[o.avg_tdee," kcal"]})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-gray-500",children:"å·®åˆ†"}),R.jsxs("div",{className:"font-bold "+(y>0?"text-red-600":y<0?"text-blue-600":"text-gray-700"),children:[y>0&&"+",y," kcal"]})]})]}),R.jsxs("div",{className:"text-xs text-gray-600 mt-2",children:["è©•ä¾¡ï¼š",R.jsx("span",{className:"font-semibold",children:f})]})]})]})}function tl(){const[e,t]=r.useState("æœé£Ÿ"),[a,s]=r.useState(1),[n,l]=r.useState(function(e=new Date){const t=e.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}).split("/");return`${t[0]}-${t[1].padStart(2,"0")}-${t[2].padStart(2,"0")}`}()),[i,d]=r.useState(null),[o,c]=r.useState(!1),[x,m]=r.useState(""),u="nutrition-images",g=r.useMemo(()=>i?URL.createObjectURL(i):"",[i]);return R.jsxs("div",{className:"bg-white border rounded-xl p-4 space-y-4",children:[R.jsx("div",{className:"text-lg font-semibold",children:"ğŸ“¸ é£Ÿäº‹å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"æ—¥ä»˜"}),R.jsx("input",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:n,onChange:e=>l(e.target.value)})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"é£Ÿäº‹ã‚¿ã‚¤ãƒ—"}),R.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:e,onChange:e=>{const r=e.target.value;t(r),"è£œé£Ÿ"!==r&&s(1)},children:[R.jsx("option",{value:"æœé£Ÿ",children:"æœé£Ÿ"}),R.jsx("option",{value:"æ˜¼é£Ÿ",children:"æ˜¼é£Ÿ"}),R.jsx("option",{value:"å¤•é£Ÿ",children:"å¤•é£Ÿ"}),R.jsx("option",{value:"è£œé£Ÿ",children:"è£œé£Ÿ"})]})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ã‚¹ãƒ­ãƒƒãƒˆ"}),R.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:a,disabled:"è£œé£Ÿ"!==e,onChange:e=>s(Number(e.target.value)),children:[R.jsx("option",{value:1,children:"1"}),R.jsx("option",{value:2,children:"2"})]}),R.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:"â€» è£œé£Ÿã®ã¿ 1 / 2ã€æœæ˜¼å¤•ã¯ 1 å›ºå®š"})]}),R.jsxs("div",{className:"space-y-2",children:[R.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;return d((null==(t=e.target.files)?void 0:t[0])??null)}}),g&&R.jsx("img",{src:g,className:"max-h-60 rounded border"})]}),R.jsx("button",{onClick:async()=>{var t,r;if(!i)return m("ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„");c(!0),m("");try{const{data:s}=await q.auth.getUser(),l=null==(t=null==s?void 0:s.user)?void 0:t.id;if(!l)throw new Error("æœªãƒ­ã‚°ã‚¤ãƒ³");const o=i.name.split(".").pop()||"jpg",c=crypto.randomUUID(),x=`nutrition/${l}/${n}/${c}.${o}`,{error:g}=await q.storage.from(u).upload(x,i,{contentType:i.type});if(g)throw g;const{data:h}=q.storage.from(u).getPublicUrl(x),{data:b,error:p}=await q.from("nutrition_logs").insert({user_id:l,record_date:n,meal_type:e,meal_slot:a,image_path:x,image_url:h.publicUrl}).select().single();if(p)throw p;const y=await async function(e){return new Promise((t,r)=>{const a=new FileReader;a.onload=()=>{const e=a.result;t(e.split(",")[1])},a.onerror=r,a.readAsDataURL(e)})}(i),{data:f}=await q.auth.getSession(),j=await fetch("http://127.0.0.1:54321/functions/v1/nutrition-analyze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${null==(r=null==f?void 0:f.session)?void 0:r.access_token}`},body:JSON.stringify({meal_type:e,image_base64:y,mime_type:i.type,user_name:"user"})}),v=await j.json();if(!j.ok)throw new Error(v.error);await q.from("nutrition_logs").update({total_calories:v.result.total_calories,p:v.result.nutrients.p,f:v.result.nutrients.f,c:v.result.nutrients.c,menu_items:v.result.menu_items,advice_markdown:v.result.advice_markdown}).eq("id",b.id),m("âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼†AIè§£æ å®Œäº†ï¼"),d(null)}catch(s){console.error(s),m(`âŒ ${s.message}`)}finally{c(!1)}},disabled:o||!i,className:"px-4 py-2 bg-indigo-600 text-white rounded disabled:opacity-50",children:o?"è§£æä¸­...":"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼†è§£æ"}),x&&R.jsx("div",{className:"text-sm",children:x})]})}function rl({userId:e}){const{organizations:t,loading:a,error:s,createOrganization:n,updateOrganization:l,deleteOrganization:i}=xn(e),[d,o]=r.useState(),[c,x]=r.useState(!1),[m,u]=r.useState(!1),[g,h]=r.useState(null);return a?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s?R.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:R.jsxs("div",{className:"flex items-start gap-3",children:[R.jsx("div",{className:"flex-shrink-0",children:R.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:R.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),R.jsxs("div",{className:"flex-1",children:[R.jsx("h3",{className:"text-sm font-medium text-red-800 mb-2",children:"çµ„ç¹”ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ"}),R.jsx("p",{className:"text-sm text-red-700 mb-3",children:s}),R.jsxs("details",{className:"text-xs text-red-600",children:[R.jsx("summary",{className:"cursor-pointer hover:text-red-800 font-medium mb-1",children:"ãƒ‡ãƒãƒƒã‚°æƒ…å ±"}),R.jsxs("div",{className:"mt-2 bg-red-100 p-2 rounded border border-red-200 font-mono",children:[R.jsxs("p",{children:["User ID: ",e]}),R.jsxs("p",{children:["Error: ",s]}),R.jsxs("p",{className:"mt-2 text-red-700",children:["è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :",R.jsx("br",{}),"â€¢ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®RLSãƒãƒªã‚·ãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹",R.jsx("br",{}),"â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®roleãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„",R.jsx("br",{}),"â€¢ auth.uid()ã¨users.idã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«å•é¡ŒãŒã‚ã‚‹"]})]})]}),R.jsx("button",{onClick:()=>window.location.reload(),className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿"})]})]})}):R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[R.jsx(De,{className:"h-6 w-6"}),"çµ„ç¹”ç®¡ç†"]}),R.jsx("p",{className:"text-gray-600 mt-1",children:"çµ„ç¹”ã¨ãƒãƒ¼ãƒ ã®ä½œæˆãƒ»ç®¡ç†"})]}),R.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[R.jsx(kt,{className:"h-4 w-4"}),"çµ„ç¹”ã‚’è¿½åŠ "]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[R.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[R.jsx("div",{className:"p-6 border-b",children:R.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"çµ„ç¹”ä¸€è¦§"})}),R.jsx("div",{className:"divide-y",children:0===t.length?R.jsx("div",{className:"p-6 text-center text-gray-500",children:"çµ„ç¹”ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):t.map(e=>R.jsx(al,{organization:e,isSelected:d===e.id,onSelect:()=>o(e.id),onEdit:()=>h(e),onDelete:async()=>{if(confirm(`${e.name}ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿé–¢é€£ã™ã‚‹ãƒãƒ¼ãƒ ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`))try{await i(e.id),d===e.id&&o(void 0)}catch(t){alert("çµ„ç¹”ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(t instanceof Error?t.message:"Unknown error"))}}},e.id))})]}),R.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:d?R.jsx(sl,{organizationId:d,onCreateClick:()=>u(!0)}):R.jsx("div",{className:"p-6 text-center text-gray-500",children:"å·¦å´ã‹ã‚‰çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"})})]}),c&&R.jsx(ll,{onClose:()=>x(!1),onCreate:async(e,t)=>{try{await n(e,t);const r=document.createElement("div");r.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",r.innerHTML=`\n                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n                </svg>\n                <span>çµ„ç¹”ã€Œ${e}ã€ã‚’ä½œæˆã—ã¾ã—ãŸ</span>\n              `,document.body.appendChild(r),setTimeout(()=>{r.style.opacity="0",r.style.transition="opacity 0.3s",setTimeout(()=>r.remove(),300)},3e3),x(!1)}catch(r){alert("çµ„ç¹”ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+(r instanceof Error?r.message:"Unknown error"))}}}),g&&R.jsx(il,{organization:g,onClose:()=>h(null),onUpdate:async e=>{try{await l(g.id,e);const t=document.createElement("div");t.className="fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",t.innerHTML='\n                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n                </svg>\n                <span>çµ„ç¹”ã‚’æ›´æ–°ã—ã¾ã—ãŸ</span>\n              ',document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transition="opacity 0.3s",setTimeout(()=>t.remove(),300)},3e3),h(null)}catch(t){alert("çµ„ç¹”ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(t instanceof Error?t.message:"Unknown error"))}}}),m&&d&&R.jsx(dl,{organizationId:d,onClose:()=>u(!1)})]})}function al({organization:e,isSelected:t,onSelect:r,onEdit:a,onDelete:s}){return R.jsx("div",{className:"p-4 cursor-pointer transition-colors "+(t?"bg-blue-50 border-l-4 border-blue-600":"hover:bg-gray-50"),onClick:r,children:R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:e.name}),e.description&&R.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.description}),R.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ä½œæˆæ—¥: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),R.jsxs("div",{className:"flex items-center gap-2 ml-4",onClick:e=>e.stopPropagation(),children:[R.jsx("button",{onClick:a,className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",title:"ç·¨é›†",children:R.jsx(jt,{className:"h-4 w-4"})}),R.jsx("button",{onClick:s,className:"p-1 text-gray-600 hover:text-red-600 transition-colors",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"h-4 w-4"})})]})]})})}function sl({organizationId:e,onCreateClick:t}){const{teams:r,loading:a,deleteTeam:s}=mn(e);return console.log("TeamPanel render:",{organizationId:e,loading:a,teamsCount:r.length,teams:r}),R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[R.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[R.jsx(rr,{className:"h-5 w-5"}),"ãƒãƒ¼ãƒ ä¸€è¦§ (",r.length,")"]}),R.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:[R.jsx(kt,{className:"h-4 w-4"}),"ãƒãƒ¼ãƒ ã‚’è¿½åŠ "]})]}),R.jsx("div",{className:"divide-y max-h-[500px] overflow-y-auto",children:a?R.jsx("div",{className:"p-6 text-center",children:R.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):0===r.length?R.jsx("div",{className:"p-6 text-center text-gray-500",children:"ãƒãƒ¼ãƒ ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):r.map(e=>R.jsx(nl,{team:e,onDelete:async()=>{if(confirm(`${e.name}ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿæ‰€å±ã™ã‚‹é¸æ‰‹ã¨ã‚³ãƒ¼ãƒã®ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`))try{await s(e.id)}catch(t){alert("ãƒãƒ¼ãƒ ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(t instanceof Error?t.message:"Unknown error"))}}},e.id))})]})}function nl({team:e,onDelete:t}){return R.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("h4",{className:"font-medium text-gray-900 truncate",children:e.name}),e.description&&R.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.description}),R.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[R.jsxs("span",{className:"flex items-center gap-1",children:[R.jsx(rr,{className:"h-3 w-3"}),"é¸æ‰‹: ",e.member_count||0,"å"]}),R.jsxs("span",{className:"flex items-center gap-1",children:["ã‚³ãƒ¼ãƒ: ",e.staff_count||0,"å"]})]})]}),R.jsx("button",{onClick:t,className:"p-1 text-gray-600 hover:text-red-600 transition-colors ml-4",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"h-4 w-4"})})]})})}function ll({onClose:e,onCreate:t}){const[a,s]=r.useState(""),[n,l]=r.useState(""),[i,d]=r.useState(!1);return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:R.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),a.trim()){d(!0);try{await t(a.trim(),n.trim())}finally{d(!1)}}},children:[R.jsxs("div",{className:"p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"çµ„ç¹”ã‚’è¿½åŠ "}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["çµ„ç¹”å ",R.jsx("span",{className:"text-red-600",children:"*"})]}),R.jsx("input",{type:"text",value:a,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ä¾‹: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«",required:!0,autoFocus:!0})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"èª¬æ˜"}),R.jsx("textarea",{value:n,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"çµ„ç¹”ã®èª¬æ˜ã‚’å…¥åŠ›ï¼ˆä»»æ„ï¼‰"})]})]})]}),R.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[R.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:i,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:i||!a.trim(),children:i?"ä½œæˆä¸­...":"ä½œæˆ"})]})]})})})}function il({organization:e,onClose:t,onUpdate:a}){const[s,n]=r.useState(e.name),[l,i]=r.useState(e.description||""),[d,o]=r.useState(!1);return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:R.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),s.trim()){o(!0);try{await a({name:s.trim(),description:l.trim()})}finally{o(!1)}}},children:[R.jsxs("div",{className:"p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"çµ„ç¹”ã‚’ç·¨é›†"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["çµ„ç¹”å ",R.jsx("span",{className:"text-red-600",children:"*"})]}),R.jsx("input",{type:"text",value:s,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,autoFocus:!0})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"èª¬æ˜"}),R.jsx("textarea",{value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]})]})]}),R.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[R.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:d,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:d||!s.trim(),children:d?"æ›´æ–°ä¸­...":"æ›´æ–°"})]})]})})})}function dl({organizationId:e,onClose:t}){const{createTeam:a}=mn(e),[s,n]=r.useState(""),[l,i]=r.useState(!1);return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:R.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),s.trim()){i(!0);try{const e=await a(s.trim());console.log("Team created successfully, closing modal:",e);const r=document.createElement("div");r.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",r.innerHTML=`\n        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n        </svg>\n        <span>ãƒãƒ¼ãƒ ã€Œ${s.trim()}ã€ã‚’ä½œæˆã—ã¾ã—ãŸ</span>\n      `,document.body.appendChild(r),setTimeout(()=>{r.style.opacity="0",r.style.transition="opacity 0.3s",setTimeout(()=>r.remove(),300)},3e3),t()}catch(r){alert("ãƒãƒ¼ãƒ ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+(r instanceof Error?r.message:"Unknown error"))}finally{i(!1)}}},children:[R.jsxs("div",{className:"p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ãƒãƒ¼ãƒ ã‚’è¿½åŠ "}),R.jsx("div",{className:"space-y-4",children:R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ãƒãƒ¼ãƒ å ",R.jsx("span",{className:"text-red-600",children:"*"})]}),R.jsx("input",{type:"text",value:s,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ä¾‹: U-15ã‚µãƒƒã‚«ãƒ¼ãƒãƒ¼ãƒ ",required:!0,autoFocus:!0})]})})]}),R.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[R.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",disabled:l,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",disabled:l||!s.trim(),children:l?"ä½œæˆä¸­...":"ä½œæˆ"})]})]})})})}function ol({organizationId:e,organizationName:t}){var a,s;const[n,l]=r.useState([]),[i,d]=r.useState(!0),[o,c]=r.useState(null),[x,m]=r.useState(new Set),[u,g]=r.useState(!1),[h,b]=r.useState(null),[p,y]=r.useState([]),[f,j]=r.useState("");r.useEffect(()=>{v(),w()},[e]);const v=async()=>{try{d(!0),c(null);const{data:t,error:r}=await q.from("teams").select("*").eq("organization_id",e).order("name");if(r)throw r;if(!t||0===t.length)return void l([]);const a=await Promise.all(t.map(async e=>{const{data:t,error:r}=await q.from("users").select("*").eq("team_id",e.id).eq("role","athlete").order("name");if(r)throw r;const{data:a,error:s}=await q.from("staff_team_links").select("\n              staff_user_id,\n              users!staff_team_links_staff_user_id_fkey (\n                id,\n                name,\n                email,\n                role\n              )\n            ").eq("team_id",e.id);if(s)throw s;const n=(null==a?void 0:a.map(e=>e.users).filter(Boolean))||[];return{...e,athletes:t||[],coaches:n}}));l(a)}catch(t){console.error("Error loading teams and members:",t),c(t instanceof Error?t.message:"çµ„ç¹”ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{d(!1)}},w=async()=>{try{const{data:t,error:r}=await q.from("organization_members").select("user_id").eq("organization_id",e);if(r)throw r;if(!t||0===t.length)return console.log("No organization members found"),void y([]);const a=t.map(e=>e.user_id),{data:s,error:n}=await q.from("users").select("id, name, email, role, team_id").in("id",a);if(n)throw n;console.log("Organization members loaded:",s),console.log("Total members:",(null==s?void 0:s.length)||0),y(s||[])}catch(t){console.error("Error loading organization members:",t)}},N=async(e,t,r)=>{if(confirm("ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒãƒ¼ãƒ ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{if(console.log("ğŸ—‘ï¸ Removing member:",{userId:e,memberRole:t,teamId:r}),"athlete"===t){console.log("ğŸ”„ Calling update_athlete_team function with null team_id");const{data:t,error:r}=await q.rpc("update_athlete_team",{athlete_id:e,new_team_id:null});if(console.log("ğŸ“Š Function response:",{data:t,error:r}),r)throw r;console.log("âœ… Athlete removed successfully")}else{console.log("ğŸ”„ Deleting staff_team_link");const{error:t}=await q.from("staff_team_links").delete().eq("staff_user_id",e).eq("team_id",r);if(t)throw t;console.log("âœ… Staff removed successfully")}console.log("ğŸ”„ Reloading teams and members..."),await v(),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒãƒ¼ãƒ ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ")}catch(a){console.error("âŒ Error removing member:",a),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(a instanceof Error?a.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}},k=p.filter(e=>"athlete"===e.role).length,_=p.filter(e=>"athlete"===e.role&&!e.team_id).length,C=p.filter(e=>"staff"===e.role).length;return i?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):o?R.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:R.jsx("p",{className:"text-red-800 dark:text-red-200",children:o})}):R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:t}),R.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"çµ„ç¹”å…¨ä½“ã®ãƒãƒ¼ãƒ ã¨ãƒ¡ãƒ³ãƒãƒ¼ã®æ¦‚è¦"})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-1",children:"ç™»éŒ²ãƒãƒ¼ãƒ æ•°"}),R.jsx("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-100",children:n.length})]}),R.jsx(rr,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})]})}),R.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-1",children:"é¸æ‰‹ç·æ•°"}),R.jsx("p",{className:"text-3xl font-bold text-green-900 dark:text-green-100",children:k}),_>0&&R.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["âš ï¸ ãƒãƒ¼ãƒ æœªæ‰€å±: ",_,"å"]})]}),R.jsx(Zt,{className:"h-8 w-8 text-green-600 dark:text-green-400"})]})}),R.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300 mb-1",children:"ã‚³ãƒ¼ãƒç·æ•°"}),R.jsx("p",{className:"text-3xl font-bold text-purple-900 dark:text-purple-100",children:C})]}),R.jsx(Xt,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"})]})})]}),_>0&&R.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800",children:[R.jsx("div",{className:"flex items-center justify-between mb-3",children:R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx(Xt,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"}),R.jsxs("h3",{className:"text-sm font-semibold text-orange-900 dark:text-orange-100",children:["ãƒãƒ¼ãƒ æœªæ‰€å±ã®é¸æ‰‹ (",_,"å)"]})]})}),R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:p.filter(e=>"athlete"===e.role&&!e.team_id).map(e=>R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-orange-200 dark:border-orange-600",children:[R.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.email})]},e.id))})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[R.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒãƒ¼ãƒ åˆ¥ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§"})}),R.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===n.length?R.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"ã“ã®çµ„ç¹”ã«ã¯ãƒãƒ¼ãƒ ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):n.map(e=>{const t=x.has(e.id);return R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[R.jsxs("button",{onClick:()=>{return t=e.id,void m(e=>{const r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r});var t},className:"flex-1 flex items-center gap-3 text-left",children:[t?R.jsx($e,{className:"h-5 w-5 text-gray-400"}):R.jsx(qe,{className:"h-5 w-5 text-gray-400"}),R.jsxs("div",{children:[R.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["é¸æ‰‹ ",e.athletes.length,"å / ã‚³ãƒ¼ãƒ ",e.coaches.length,"å"]})]})]}),R.jsxs("button",{onClick:()=>(e=>{b(e),g(!0),j("")})(e),className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[R.jsx(Qt,{className:"h-4 w-4"}),R.jsx("span",{children:"ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ "})]})]}),t&&R.jsx("div",{className:"px-4 pb-4 bg-gray-50 dark:bg-gray-700/30",children:R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[R.jsxs("div",{children:[R.jsxs("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[R.jsx(Zt,{className:"h-4 w-4"}),"é¸æ‰‹ (",e.athletes.length,")"]}),R.jsx("div",{className:"space-y-2",children:0===e.athletes.length?R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):e.athletes.map(t=>R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:t.email})]}),R.jsx("button",{onClick:()=>N(t.id,"athlete",e.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"å‰Šé™¤",children:R.jsx(Xt,{className:"h-4 w-4"})})]},t.id))})]}),R.jsxs("div",{children:[R.jsxs("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[R.jsx(Xt,{className:"h-4 w-4"}),"ã‚³ãƒ¼ãƒ (",e.coaches.length,")"]}),R.jsx("div",{className:"space-y-2",children:0===e.coaches.length?R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"ã‚³ãƒ¼ãƒãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“"}):e.coaches.map(t=>R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:t.email})]}),R.jsx("button",{onClick:()=>N(t.id,"staff",e.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"å‰Šé™¤",children:R.jsx(Xt,{className:"h-4 w-4"})})]},t.id))})]})]})})]},e.id)})})]}),u&&h&&R.jsx(cl,{team:h,allTeams:n,organizationMembers:p,currentTeamMembers:[...(null==(a=n.find(e=>e.id===h.id))?void 0:a.athletes)||[],...(null==(s=n.find(e=>e.id===h.id))?void 0:s.coaches)||[]],searchQuery:f,onSearchChange:j,onClose:()=>{g(!1),b(null),j("")},onAssign:async(e,t)=>{if(h)try{if("athlete"===t){console.log("â• Adding athlete to team using update_athlete_team function");const{data:t,error:r}=await q.rpc("update_athlete_team",{athlete_id:e,new_team_id:h.id});if(console.log("ğŸ“Š Function response:",{data:t,error:r}),r)throw r}else{const{error:t}=await q.from("staff_team_links").insert({staff_user_id:e,team_id:h.id});if(t)throw t}console.log("ğŸ”„ Reloading teams and members..."),await v(),await w(),g(!1),b(null),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒãƒ¼ãƒ ã«è¿½åŠ ã—ã¾ã—ãŸ")}catch(r){console.error("âŒ Error assigning member:",r),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(r instanceof Error?r.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}}})]})}function cl({team:e,allTeams:t,organizationMembers:a,currentTeamMembers:s,searchQuery:n,onSearchChange:l,onClose:i,onAssign:d}){const[o,c]=r.useState(!1),x=new Set(s.map(e=>e.id)),m=a.filter(t=>{var r,a;if(x.has(t.id))return!1;if("athlete"===t.role&&t.team_id&&t.team_id!==e.id)return!1;if(n){const e=n.toLowerCase(),s=null==(r=t.name)?void 0:r.toLowerCase().includes(e),l=null==(a=t.email)?void 0:a.toLowerCase().includes(e);return s||l}return!0});console.log("Search query:",n),console.log("Organization members:",a),console.log("Available members after filter:",m);const u=m.filter(e=>"athlete"===e.role),g=m.filter(e=>"staff"===e.role),h=async(r,s,n)=>{if("athlete"===s&&n&&n!==e.id){const e=a.find(e=>e.id===r),s=t.find(e=>e.id===n);if(!confirm(`${null==e?void 0:e.name}ã¯ç¾åœ¨ã€Œ${null==s?void 0:s.name}ã€ã«æ‰€å±ã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒãƒ¼ãƒ ã«ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ`))return}c(!0);try{await d(r,s)}finally{c(!1)}};return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[R.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[R.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[e.name," ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "]}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"çµ„ç¹”å†…ã®ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„"})]}),R.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:R.jsxs("div",{className:"relative",children:[R.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),R.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"åå‰ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})}),R.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:0===m.length?R.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:n?"æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“":"ã“ã®ãƒãƒ¼ãƒ ã«è¿½åŠ ã§ãã‚‹ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“"}):R.jsxs("div",{className:"space-y-6",children:[u.length>0&&R.jsxs("div",{children:[R.jsxs("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[R.jsx(Zt,{className:"h-4 w-4"}),"é¸æ‰‹ (",u.length,")"]}),R.jsx("div",{className:"space-y-2",children:u.map(e=>{const r=e.team_id?t.find(t=>t.id===e.team_id):null;return R.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:e.email}),r&&R.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["ç¾åœ¨: ",r.name]})]}),R.jsx("button",{onClick:()=>h(e.id,"athlete",e.team_id||void 0),disabled:o,className:"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap",children:r?"ç§»å‹•":"è¿½åŠ "})]},e.id)})})]}),g.length>0&&R.jsxs("div",{children:[R.jsxs("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[R.jsx(rr,{className:"h-4 w-4"}),"ã‚¹ã‚¿ãƒƒãƒ• (",g.length,")"]}),R.jsx("div",{className:"space-y-2",children:g.map(e=>R.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:e.email})]}),R.jsx("button",{onClick:()=>h(e.id,"staff"),disabled:o,className:"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap",children:"è¿½åŠ "})]},e.id))})]})]})}),R.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end border-t dark:border-gray-700",children:R.jsx("button",{onClick:i,disabled:o,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"é–‰ã˜ã‚‹"})})]})})}const xl=q,ml={async getSubscriptionPlans(){const{data:e,error:t}=await xl.from("subscription_plans").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;return e},async getSubscriptionPlanById(e){const{data:t,error:r}=await xl.from("subscription_plans").select("*").eq("id",e).maybeSingle();if(r)throw r;return t},async createSubscriptionPlan(e){const{data:t,error:r}=await xl.from("subscription_plans").insert(e).select().single();if(r)throw r;return t},async getOrganizationSubscription(e){const{data:t,error:r}=await xl.from("organization_subscriptions").select("\n        *,\n        plan:plan_id (*)\n      ").eq("organization_id",e).maybeSingle();if(r)throw r;return t},async createOrganizationSubscription(e){const{data:t,error:r}=await xl.from("organization_subscriptions").insert(e).select().single();if(r)throw r;return t},async updateOrganizationSubscription(e,t){const{data:r,error:a}=await xl.from("organization_subscriptions").update(t).eq("organization_id",e).select().single();if(a)throw a;return r},async getUserSubscription(e){const{data:t,error:r}=await xl.from("user_subscriptions").select("\n        *,\n        plan:plan_id (*)\n      ").eq("user_id",e).maybeSingle();if(r)throw r;return t},async getCurrentUsage(e){const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0),{data:s,error:n}=await xl.from("usage_tracking").select("*").eq("organization_id",e).gte("period_start",r.toISOString()).lte("period_end",a.toISOString()).maybeSingle();if(n)throw n;return s},async calculateCurrentUsage(e){const t=new Date(new Date);t.setDate(t.getDate()-30);const{data:r,error:a}=await q.from("users").select("id",{count:"exact",head:!1}).eq("role","athlete").eq("team_id",e).gte("created_at",t.toISOString());if(a)throw a;const{data:s,error:n}=await q.from("organization_members").select("id",{count:"exact",head:!1}).eq("organization_id",e);if(n)throw n;const{error:l}=await q.from("training_records").select("id",{count:"exact",head:!0}).gte("date",K(30));if(l)throw l;return{active_athletes:(null==r?void 0:r.length)||0,total_users:(null==s?void 0:s.length)||0,storage_used_mb:0,api_calls:0,data_exports:0}},async createUsageRecord(e){const{data:t,error:r}=await xl.from("usage_tracking").insert(e).select().single();if(r)throw r;return t},async getBillingHistory(e,t){let r=xl.from("billing_history").select("*").order("billing_date",{ascending:!1});e?r=r.eq("organization_id",e):t&&(r=r.eq("user_id",t));const{data:a,error:s}=await r;if(s)throw s;return a},async createBillingRecord(e){const{data:t,error:r}=await xl.from("billing_history").insert(e).select().single();if(r)throw r;return t},async updateBillingRecord(e,t){const{data:r,error:a}=await xl.from("billing_history").update(t).eq("id",e).select().single();if(a)throw a;return r},async getPermissionDefinitions(){const{data:e,error:t}=await xl.from("permission_definitions").select("*").eq("is_active",!0).order("category",{ascending:!0}).order("name",{ascending:!0});if(t)throw t;return e},async getRolePermissions(e){const{data:t,error:r}=await xl.from("role_permissions").select("\n        *,\n        permission:permission_id (*)\n      ").eq("role",e);if(r)throw r;return t},async getAllRolePermissions(){const{data:e,error:t}=await xl.from("role_permissions").select("\n        *,\n        permission:permission_id (*)\n      ").order("role");if(t)throw t;return e},async checkPlanLimits(e){const t=await this.getOrganizationSubscription(e);if(!t||!t.plan)return{withinLimits:!1,message:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",limits:{}};const r=t.plan,a=await this.calculateCurrentUsage(e),s=null===r.athlete_limit||a.active_athletes<=r.athlete_limit,n=a.storage_used_mb<=1024*r.storage_gb;return{withinLimits:s&&n,message:s&&n?"ãƒ—ãƒ©ãƒ³åˆ¶é™å†…ã§ã™":"ä½¿ç”¨é‡ãŒãƒ—ãƒ©ãƒ³åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™",limits:{athletes:{current:a.active_athletes,limit:r.athlete_limit,exceeded:!s},storage:{current:a.storage_used_mb,limit:1024*r.storage_gb,exceeded:!n}},plan:r,usage:a}},async hasFeature(e,t){const r=await this.getOrganizationSubscription(e);if(!r||!r.plan)return!1;const a=r.plan;return!(!a.features||!0!==a.features[t])},async upgradePlan(e,t,r){if(!(await this.getOrganizationSubscription(e)))throw new Error("ç¾åœ¨ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const a=new Date,s=new Date(a);"monthly"===r?s.setMonth(s.getMonth()+1):s.setFullYear(s.getFullYear()+1);const n={plan_id:t,billing_cycle:r,current_period_start:a.toISOString(),current_period_end:s.toISOString(),status:"active",updated_at:a.toISOString()};return await this.updateOrganizationSubscription(e,n)},async cancelSubscription(e,t=!1){const r=t?{status:"cancelled",updated_at:(new Date).toISOString()}:{cancel_at_period_end:!0,updated_at:(new Date).toISOString()};return await this.updateOrganizationSubscription(e,r)},async reactivateSubscription(e){const t={status:"active",cancel_at_period_end:!1,updated_at:(new Date).toISOString()};return await this.updateOrganizationSubscription(e,t)}};function ul({organizationId:e,organizationName:t}){var a,s,n,l,i,d,o,c,x,m,u;const{subscription:g,plans:h,billingHistory:b,limits:p,loading:y,error:f,upgradePlan:j,cancelSubscription:v,reactivateSubscription:w}=function(e){const[t,a]=r.useState(null),[s,n]=r.useState([]),[l,i]=r.useState(null),[d,o]=r.useState([]),[c,x]=r.useState(null),[m,u]=r.useState(!0),[g,h]=r.useState(null);r.useEffect(()=>{e?b():u(!1)},[e]);const b=async()=>{if(e)try{u(!0),h(null);const[t,r,s,l,d]=await Promise.all([ml.getOrganizationSubscription(e),ml.getSubscriptionPlans(),ml.getCurrentUsage(e),ml.getBillingHistory(e),ml.checkPlanLimits(e)]);a(t),n(r),i(s),o(l),x(d)}catch(t){console.warn("Subscription feature not yet implemented:",t),h(null),a(null),n([]),i(null),o([]),x(null)}finally{u(!1)}};return{subscription:t,plans:s,usage:l,billingHistory:d,limits:c,loading:m,error:g,upgradePlan:async(t,r)=>{if(!e)throw new Error("Organization ID is required");try{const a=await ml.upgradePlan(e,t,r);return await b(),a}catch(a){const e=a instanceof Error?a.message:"ãƒ—ãƒ©ãƒ³ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ";throw h(e),new Error(e)}},cancelSubscription:async(t=!1)=>{if(!e)throw new Error("Organization ID is required");try{const r=await ml.cancelSubscription(e,t);return await b(),r}catch(r){const e=r instanceof Error?r.message:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ";throw h(e),new Error(e)}},reactivateSubscription:async()=>{if(!e)throw new Error("Organization ID is required");try{const t=await ml.reactivateSubscription(e);return await b(),t}catch(t){const e=t instanceof Error?t.message:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å†é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ";throw h(e),new Error(e)}},hasFeature:async t=>{if(!e)return!1;try{return await ml.hasFeature(e,t)}catch(r){return console.error("Error checking feature:",r),!1}},refreshUsage:async()=>{if(e)try{const[t,r]=await Promise.all([ml.getCurrentUsage(e),ml.checkPlanLimits(e)]);i(t),x(r)}catch(t){console.error("Error refreshing usage:",t)}},reload:b}}(e),[N,k]=r.useState(null),[_,C]=r.useState("monthly"),[S,D]=r.useState(!1),[M,E]=r.useState(!1),[T,A]=r.useState(!1);if(y)return R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(f)return R.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:R.jsx("p",{className:"text-red-800 dark:text-red-200",children:f})});const $=null==g?void 0:g.plan,z="trial"===(null==g?void 0:g.status),q="cancelled"===(null==g?void 0:g.status),F=null==g?void 0:g.cancel_at_period_end,I=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}),L=e=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e);return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{children:[R.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[R.jsx(Ue,{className:"h-6 w-6"}),"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†"]}),R.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[t,"ã®ãƒ—ãƒ©ãƒ³ã¨è«‹æ±‚"]})]}),p&&!p.withinLimits&&R.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start gap-3",children:[R.jsx(ye,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-yellow-900 dark:text-yellow-200",children:"ä½¿ç”¨é‡ãŒãƒ—ãƒ©ãƒ³åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™"}),R.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300 mt-1",children:"ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã®åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ã”æ¤œè¨ãã ã•ã„ã€‚"}),(null==(a=p.limits.athletes)?void 0:a.exceeded)&&R.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-400 mt-1",children:["ã‚¢ã‚¹ãƒªãƒ¼ãƒˆæ•°: ",p.limits.athletes.current," / ",p.limits.athletes.limit||"ç„¡åˆ¶é™"]})]})]})}),F&&R.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"flex items-start gap-3",children:[R.jsx(ye,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5"}),R.jsxs("div",{children:[R.jsx("h3",{className:"font-semibold text-orange-900 dark:text-orange-200",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«äºˆå®šã§ã™"}),R.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-300 mt-1",children:[I(g.current_period_end),"ã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã—ã¾ã™"]})]})]}),R.jsx("button",{onClick:async()=>{A(!0);try{await w()}catch(e){alert(e instanceof Error?e.message:"å†é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{A(!1)}},disabled:T,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 whitespace-nowrap",children:"å†é–‹ã™ã‚‹"})]})}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³"}),$?R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-center justify-between mb-2",children:[R.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:$.name}),z&&R.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-xs font-semibold rounded-full",children:"ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­"}),q&&R.jsx("span",{className:"px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 text-xs font-semibold rounded-full",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿"})]}),R.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:$.description})]}),R.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[R.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[R.jsx("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:L("yearly"===g.billing_cycle?$.price_yearly:$.price_monthly)}),R.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["/ ","yearly"===g.billing_cycle?"å¹´":"æœˆ"]})]}),"yearly"===g.billing_cycle&&R.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["å¹´é–“ãƒ—ãƒ©ãƒ³ã§ ",L(12*$.price_monthly-$.price_yearly)," ãŠå¾—"]})]}),R.jsxs("div",{className:"space-y-2 pt-4 border-t dark:border-gray-700",children:[R.jsxs("div",{className:"flex items-center justify-between text-sm",children:[R.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"è«‹æ±‚ã‚µã‚¤ã‚¯ãƒ«"}),R.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"yearly"===g.billing_cycle?"å¹´æ¬¡":"æœˆæ¬¡"})]}),R.jsxs("div",{className:"flex items-center justify-between text-sm",children:[R.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"æ¬¡å›è«‹æ±‚æ—¥"}),R.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:I(g.current_period_end)})]}),z&&g.trial_end&&R.jsxs("div",{className:"flex items-center justify-between text-sm",children:[R.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"ãƒˆãƒ©ã‚¤ã‚¢ãƒ«çµ‚äº†"}),R.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:I(g.trial_end)})]})]}),R.jsxs("div",{className:"pt-4 space-y-2",children:[R.jsx("button",{onClick:()=>D(!0),disabled:q,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"ãƒ—ãƒ©ãƒ³ã‚’å¤‰æ›´"}),!q&&!F&&R.jsx("button",{onClick:()=>E(!0),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]}):R.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“"})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[R.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[R.jsx(Vt,{className:"h-5 w-5"}),"ä½¿ç”¨çŠ¶æ³"]}),p&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-center justify-between mb-2",children:[R.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ"}),R.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[(null==(s=p.usage)?void 0:s.active_athletes)||0," / ",(null==$?void 0:$.athlete_limit)||"ç„¡åˆ¶é™"]})]}),R.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:R.jsx("div",{className:"h-2 rounded-full "+((null==(l=null==(n=p.limits)?void 0:n.athletes)?void 0:l.exceeded)?"bg-red-600":"bg-blue-600"),style:{width:(null==$?void 0:$.athlete_limit)?`${Math.min(((null==(i=p.usage)?void 0:i.active_athletes)||0)/$.athlete_limit*100,100)}%`:"0%"}})})]}),R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-center justify-between mb-2",children:[R.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡"}),R.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[(((null==(d=p.usage)?void 0:d.storage_used_mb)||0)/1024).toFixed(2)," GB / ",(null==$?void 0:$.storage_gb)||0," GB"]})]}),R.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:R.jsx("div",{className:"h-2 rounded-full "+((null==(c=null==(o=p.limits)?void 0:o.storage)?void 0:c.exceeded)?"bg-red-600":"bg-green-600"),style:{width:(null==$?void 0:$.storage_gb)?`${Math.min(((null==(x=p.usage)?void 0:x.storage_used_mb)||0)/1024/$.storage_gb*100,100)}%`:"0%"}})})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t dark:border-gray-700",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==(m=p.usage)?void 0:m.total_users)||0}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°"})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==(u=p.usage)?void 0:u.data_exports)||0}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"})]})]})]})]})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6",children:[R.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[R.jsx(Me,{className:"h-5 w-5"}),"è«‹æ±‚å±¥æ­´"]}),b.length>0?R.jsx("div",{className:"overflow-x-auto",children:R.jsxs("table",{className:"w-full",children:[R.jsx("thead",{children:R.jsxs("tr",{className:"border-b dark:border-gray-700",children:[R.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"æ—¥ä»˜"}),R.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"é‡‘é¡"}),R.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"}),R.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white",children:"æ”¯æ‰•æ–¹æ³•"})]})}),R.jsx("tbody",{children:b.slice(0,10).map(e=>R.jsxs("tr",{className:"border-b dark:border-gray-700 last:border-0",children:[R.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 dark:text-white",children:I(e.billing_date)}),R.jsx("td",{className:"py-3 px-4 text-sm font-medium text-gray-900 dark:text-white",children:L(e.amount)}),R.jsx("td",{className:"py-3 px-4 text-sm",children:R.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold "+("paid"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":"pending"===e.status?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200"),children:"paid"===e.status?"æ”¯æ‰•æ¸ˆ":"pending"===e.status?"ä¿ç•™ä¸­":"å¤±æ•—"})}),R.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:e.payment_method||"-"})]},e.id))})]})}):R.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-4",children:"è«‹æ±‚å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“"})]}),S&&R.jsx(gl,{plans:h,currentPlan:$,selectedPlan:N,billingCycle:_,onSelectPlan:k,onSelectCycle:C,onConfirm:async()=>{if(N){A(!0);try{await j(N.id,_),D(!1),k(null)}catch(e){alert(e instanceof Error?e.message:"ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{A(!1)}}},onClose:()=>{D(!1),k(null)},processing:T}),M&&R.jsx(hl,{onCancel:async e=>{A(!0);try{await v(e),E(!1)}catch(t){alert(t instanceof Error?t.message:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{A(!1)}},onClose:()=>E(!1),processing:T})]})}function gl({plans:e,currentPlan:t,selectedPlan:r,billingCycle:a,onSelectPlan:s,onSelectCycle:n,onConfirm:l,onClose:i,processing:d}){const o=(e,t)=>e.features&&e.features[t];return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto",children:R.jsxs("div",{className:"p-6",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ"}),R.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:R.jsx(sr,{className:"h-6 w-6"})})]}),R.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[R.jsx("button",{onClick:()=>n("monthly"),className:"px-6 py-2 rounded-lg font-medium transition-colors "+("monthly"===a?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"æœˆæ¬¡"}),R.jsx("button",{onClick:()=>n("yearly"),className:"px-6 py-2 rounded-lg font-medium transition-colors "+("yearly"===a?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"å¹´æ¬¡ï¼ˆãŠå¾—ï¼‰"})]}),R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:e.map(e=>{const n=(null==t?void 0:t.id)===e.id,l=(null==r?void 0:r.id)===e.id,i="yearly"===a?e.price_yearly:e.price_monthly;return R.jsxs("div",{onClick:()=>s(e),className:"border-2 rounded-lg p-4 cursor-pointer transition-all "+(l?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":n?"border-gray-400 dark:border-gray-600":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700"),children:[n&&R.jsx("div",{className:"mb-2",children:R.jsx("span",{className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-xs font-semibold rounded",children:"ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³"})}),R.jsx("h4",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:e.name}),R.jsxs("div",{className:"mb-4",children:[R.jsx("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:(d=i,new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(d))}),R.jsxs("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["/ ","yearly"===a?"å¹´":"æœˆ"]})]}),R.jsxs("ul",{className:"space-y-2 text-sm",children:[R.jsxs("li",{className:"flex items-center gap-2",children:[R.jsx(Ae,{className:"h-4 w-4 text-green-600"}),R.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[e.athlete_limit?`${e.athlete_limit}äºº`:"ç„¡åˆ¶é™","ã®ã‚¢ã‚¹ãƒªãƒ¼ãƒˆ"]})]}),R.jsxs("li",{className:"flex items-center gap-2",children:[R.jsx(Ae,{className:"h-4 w-4 text-green-600"}),R.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[e.storage_gb,"GB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"]})]}),o(e,"advanced_analytics")&&R.jsxs("li",{className:"flex items-center gap-2",children:[R.jsx(Ae,{className:"h-4 w-4 text-green-600"}),R.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"é«˜åº¦ãªåˆ†æ"})]}),o(e,"priority_support")&&R.jsxs("li",{className:"flex items-center gap-2",children:[R.jsx(Ae,{className:"h-4 w-4 text-green-600"}),R.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"å„ªå…ˆã‚µãƒãƒ¼ãƒˆ"})]})]})]},e.id);var d})}),R.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t dark:border-gray-700",children:[R.jsx("button",{onClick:i,disabled:d,className:"px-6 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:l,disabled:!r||d,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"å‡¦ç†ä¸­...":"å¤‰æ›´ã‚’ç¢ºå®š"})]})]})})})}function hl({onCancel:e,onClose:t,processing:r}){return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:R.jsxs("div",{className:"p-6",children:[R.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ"}),R.jsxs("div",{className:"space-y-3",children:[R.jsxs("button",{onClick:()=>e(!1),disabled:r,className:"w-full px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 text-left",children:[R.jsx("div",{className:"font-semibold",children:"æœŸé–“çµ‚äº†æ™‚ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("div",{className:"text-sm opacity-90",children:"ç¾åœ¨ã®è«‹æ±‚æœŸé–“ã®çµ‚ã‚ã‚Šã¾ã§åˆ©ç”¨å¯èƒ½ã§ã™"})]}),R.jsxs("button",{onClick:()=>e(!0),disabled:r,className:"w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 text-left",children:[R.jsx("div",{className:"font-semibold",children:"å³åº§ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("div",{className:"text-sm opacity-90",children:"ã™ãã«ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ããªããªã‚Šã¾ã™ï¼ˆè¿”é‡‘ãªã—ï¼‰"})]}),R.jsx("button",{onClick:t,disabled:r,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"é–‰ã˜ã‚‹"})]})]})})})}function bl({organizationId:e}){const{organizations:t,updateOrganization:a}=xn(void 0),s=t.find(t=>t.id===e),[n,l]=r.useState("general"),[i,d]=r.useState(!1);if(!s)return R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"çµ„ç¹”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"})});const o=[{id:"general",name:"ä¸€èˆ¬è¨­å®š",icon:tt},{id:"notifications",name:"é€šçŸ¥",icon:Ce},{id:"security",name:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£",icon:qt},{id:"appearance",name:"å¤–è¦³",icon:yt}];return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{children:[R.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[R.jsx(At,{className:"h-6 w-6"}),"çµ„ç¹”è¨­å®š"]}),R.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[s.name,"ã®è©³ç´°è¨­å®š"]})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:[R.jsx("div",{className:"border-b dark:border-gray-700",children:R.jsx("nav",{className:"flex px-6",children:o.map(e=>{const t=e.icon;return R.jsxs("button",{onClick:()=>l(e.id),className:"py-4 px-1 mr-8 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors "+(n===e.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300"),children:[R.jsx(t,{className:"h-4 w-4"}),R.jsx("span",{children:e.name})]},e.id)})})}),R.jsxs("div",{className:"p-6",children:["general"===n&&R.jsx(pl,{organization:s,onUpdate:a,saving:i,setSaving:d}),"notifications"===n&&R.jsx(yl,{organization:s,onUpdate:a,saving:i,setSaving:d}),"security"===n&&R.jsx(fl,{organization:s,onUpdate:a,saving:i,setSaving:d}),"appearance"===n&&R.jsx(jl,{organization:s,onUpdate:a,saving:i,setSaving:d})]})]})]})}function pl({organization:e,onUpdate:t,saving:a,setSaving:s}){const[n,l]=r.useState(e.name),[i,d]=r.useState(e.description||""),o=e.settings||{},[c,x]=r.useState(o.timezone||"Asia/Tokyo"),[m,u]=r.useState(o.language||"ja");return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"çµ„ç¹”å"}),R.jsx("input",{type:"text",value:n,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"èª¬æ˜"}),R.jsx("textarea",{value:i,onChange:e=>d(e.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³"}),R.jsxs("select",{value:c,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[R.jsx("option",{value:"Asia/Tokyo",children:"æ—¥æœ¬æ¨™æº–æ™‚ (JST)"}),R.jsx("option",{value:"America/New_York",children:"æ±éƒ¨æ¨™æº–æ™‚ (EST)"}),R.jsx("option",{value:"America/Los_Angeles",children:"å¤ªå¹³æ´‹æ¨™æº–æ™‚ (PST)"}),R.jsx("option",{value:"Europe/London",children:"ã‚°ãƒªãƒ‹ãƒƒã‚¸æ¨™æº–æ™‚ (GMT)"}),R.jsx("option",{value:"UTC",children:"å”å®šä¸–ç•Œæ™‚ (UTC)"})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"è¨€èª"}),R.jsxs("select",{value:m,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[R.jsx("option",{value:"ja",children:"æ—¥æœ¬èª"}),R.jsx("option",{value:"en",children:"English"})]})]}),R.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:R.jsx("button",{onClick:async()=>{s(!0);try{await t(e.id,{name:n,description:i,settings:{...o,timezone:c,language:m}}),alert("è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{s(!1)}},disabled:a,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:a?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}function yl({organization:e,onUpdate:t,saving:a,setSaving:s}){const n=e.settings||{},l=n.notifications||{},[i,d]=r.useState(!1!==l.emailAlerts),[o,c]=r.useState(l.highPriorityOnly||!1),[x,m]=r.useState(l.weeklyReport||!1),[u,g]=r.useState(!1!==l.usageLimitWarnings);return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"space-y-4",children:[R.jsxs("label",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆ"}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ACWRã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ä¿¡"})]}),R.jsx("input",{type:"checkbox",checked:i,onChange:e=>d(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]}),R.jsxs("label",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"é«˜å„ªå…ˆåº¦ã®ã¿"}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"é«˜å„ªå…ˆåº¦ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿ã‚’é€šçŸ¥"})]}),R.jsx("input",{type:"checkbox",checked:o,onChange:e=>c(e.target.checked),disabled:!i,className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})]}),R.jsxs("label",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ"}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"æ¯é€±æœˆæ›œæ—¥ã«ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’å—ä¿¡"})]}),R.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]}),R.jsxs("label",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"ä½¿ç”¨é‡åˆ¶é™è­¦å‘Š"}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ—ãƒ©ãƒ³åˆ¶é™ã«è¿‘ã¥ã„ãŸéš›ã«é€šçŸ¥"})]}),R.jsx("input",{type:"checkbox",checked:u,onChange:e=>g(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]})]}),R.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:R.jsx("button",{onClick:async()=>{s(!0);try{await t(e.id,{settings:{...n,notifications:{emailAlerts:i,highPriorityOnly:o,weeklyReport:x,usageLimitWarnings:u}}}),alert("é€šçŸ¥è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{s(!1)}},disabled:a,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:a?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}function fl({organization:e,onUpdate:t,saving:a,setSaving:s}){const n=e.settings||{},l=n.security||{},[i,d]=r.useState(l.dataRetentionDays||365),[o,c]=r.useState(l.requireMFA||!1),[x,m]=r.useState(!1!==l.allowExport);return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ï¼ˆæ—¥æ•°ï¼‰"}),R.jsx("input",{type:"number",value:i,onChange:e=>d(parseInt(e.target.value)),min:"30",max:"3650",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"å¤ã„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã¯è‡ªå‹•çš„ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã¾ã™"})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("label",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"å¤šè¦ç´ èªè¨¼ã‚’è¦æ±‚"}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"å…¨ãƒ¡ãƒ³ãƒãƒ¼ã«MFAã‚’å¼·åˆ¶ï¼ˆé–‹ç™ºä¸­ï¼‰"})]}),R.jsx("input",{type:"checkbox",checked:o,onChange:e=>c(e.target.checked),disabled:!0,className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})]}),R.jsxs("label",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨±å¯"}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã‚‹"})]}),R.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"h-5 w-5 text-blue-600 rounded focus:ring-blue-500"})]})]}),R.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:R.jsx("button",{onClick:async()=>{s(!0);try{await t(e.id,{settings:{...n,security:{dataRetentionDays:i,requireMFA:o,allowExport:x}}}),alert("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{s(!1)}},disabled:a,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:a?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}function jl({organization:e,onUpdate:t,saving:a,setSaving:s}){const n=e.settings||{},l=n.appearance||{},[i,d]=r.useState(l.primaryColor||"#3B82F6"),[o,c]=r.useState(l.acwrThresholdLow||.8),[x,m]=r.useState(l.acwrThresholdHigh||1.3);return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚«ãƒ©ãƒ¼"}),R.jsxs("div",{className:"flex items-center gap-4",children:[R.jsx("input",{type:"color",value:i,onChange:e=>d(e.target.value),className:"h-10 w-20 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),R.jsx("input",{type:"text",value:i,onChange:e=>d(e.target.value),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"çµ„ç¹”ã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ï¼ˆé–‹ç™ºä¸­ï¼‰"})]}),R.jsxs("div",{className:"pt-4 border-t dark:border-gray-700",children:[R.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"ACWRé–¾å€¤ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ä½ãƒªã‚¹ã‚¯é–¾å€¤ï¼ˆä¸‹é™ï¼‰"}),R.jsx("input",{type:"number",value:o,onChange:e=>c(parseFloat(e.target.value)),step:"0.1",min:"0.5",max:"1.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ã“ã®å€¤æœªæº€ã¯ä½ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ã¨ã—ã¦è­¦å‘Š"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"é«˜ãƒªã‚¹ã‚¯é–¾å€¤ï¼ˆä¸Šé™ï¼‰"}),R.jsx("input",{type:"number",value:x,onChange:e=>m(parseFloat(e.target.value)),step:"0.1",min:"1.2",max:"2.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"ã“ã®å€¤ã‚’è¶…ãˆã‚‹ã¨é«˜ãƒªã‚¹ã‚¯ã¨ã—ã¦è­¦å‘Š"})]})]})]}),R.jsx("div",{className:"pt-4 border-t dark:border-gray-700",children:R.jsx("button",{onClick:async()=>{s(!0);try{await t(e.id,{settings:{...n,appearance:{primaryColor:i,acwrThresholdLow:o,acwrThresholdHigh:x}}}),alert("å¤–è¦³è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(r){alert(r instanceof Error?r.message:"è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{s(!1)}},disabled:a,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:a?"ä¿å­˜ä¸­...":"è¨­å®šã‚’ä¿å­˜"})})]})}const vl={async getMyRequests(e){const{data:t,error:r}=await q.from("team_access_requests").select("\n        *,\n        team:teams (\n          id,\n          name\n        )\n      ").eq("requester_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async getPendingRequestsForMyTeams(e){const{data:t,error:r}=await q.from("users").select("role").eq("id",e).maybeSingle();if(r)throw r;if("global_admin"===(null==t?void 0:t.role)){const{data:e,error:t}=await q.from("team_access_requests").select("\n          *,\n          requester:users!team_access_requests_requester_id_fkey (\n            id,\n            name,\n            email\n          ),\n          team:teams (\n            id,\n            name,\n            organization_id\n          )\n        ").eq("status","pending").order("created_at",{ascending:!1});if(t)throw t;return e}const{data:a,error:s}=await q.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(s)throw s;const n=(null==a?void 0:a.map(e=>e.team_id).filter(Boolean))||[];if(0===n.length)return[];const{data:l,error:i}=await q.from("team_access_requests").select("\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        )\n      ").eq("status","pending").in("team_id",n).order("created_at",{ascending:!1});if(i)throw i;return l},async getRequestsForOrganization(e){const{data:t,error:r}=await q.from("team_access_requests").select("\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        ),\n        reviewer:users!team_access_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("organization_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async getAvailableTeamsToRequest(e,t){const{data:r,error:a}=await q.from("users").select("team_id").eq("id",e).maybeSingle();if(a)throw a;const{data:s,error:n}=await q.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(n)throw n;const l=(s??[]).map(e=>e.team_id).filter(Boolean);(null==r?void 0:r.team_id)&&l.push(r.team_id);const{data:i,error:d}=await q.from("team_access_requests").select("team_id").eq("requester_id",e).eq("status","pending");if(d)throw d;const o=(i??[]).map(e=>e.team_id).filter(Boolean),c=Array.from(new Set([...l,...o])).filter(Boolean),{data:x,error:m}=await q.from("teams").select("id, name, organization_id").eq("organization_id",t).order("name");if(m)throw m;return c.length?(x??[]).filter(e=>!c.includes(e.id)):x??[]},async createRequest(e,t,r,a=""){const{data:s,error:n}=await q.from("team_access_requests").insert({requester_id:e,team_id:t,organization_id:r,status:"pending",request_message:a}).select().single();if(n)throw n;return s},async approveRequest(e,t,r=""){const{error:a}=await q.rpc("approve_team_access_request",{request_id:e,reviewer_user_id:t,notes:r});if(a)throw a},async rejectRequest(e,t,r=""){const{error:a}=await q.rpc("reject_team_access_request",{request_id:e,reviewer_user_id:t,notes:r});if(a)throw a},async cancelRequest(e){const{error:t}=await q.from("team_access_requests").delete().eq("id",e).eq("status","pending");if(t)throw t},async getRequestById(e){const{data:t,error:r}=await q.from("team_access_requests").select("\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        ),\n        reviewer:users!team_access_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("id",e).maybeSingle();if(r)throw r;return t}};function wl({userId:e,organizationId:t,isAdmin:a=!1}){var s,n;const{myRequests:l,pendingRequests:i,organizationRequests:d,availableTeams:o,loading:c,error:x,createRequest:m,approveRequest:u,rejectRequest:g,cancelRequest:h}=function(e,t){const[a,s]=r.useState([]),[n,l]=r.useState([]),[i,d]=r.useState([]),[o,c]=r.useState([]),[x,m]=r.useState(!0),[u,g]=r.useState(null),h=r.useCallback(async()=>{try{const t=await vl.getMyRequests(e);s(t)}catch(t){throw console.error("Error loading my requests:",t),t}},[e]),b=r.useCallback(async()=>{try{const t=await vl.getPendingRequestsForMyTeams(e);l(t)}catch(t){throw console.error("Error loading pending requests:",t),t}},[e]),p=r.useCallback(async()=>{if(t)try{const e=await vl.getRequestsForOrganization(t);d(e)}catch(e){throw console.error("Error loading organization requests:",e),e}},[t]),y=r.useCallback(async()=>{if(t)try{const r=await vl.getAvailableTeamsToRequest(e,t);c(r)}catch(r){throw console.error("Error loading available teams:",r),r}},[e,t]),f=r.useCallback(async()=>{m(!0),g(null);try{const e=await Promise.allSettled([h(),b(),t?p():Promise.resolve(),t?y():Promise.resolve()]);e.forEach((e,t)=>{if("rejected"===e.status){const r=["myRequests","pendingRequests","organizationRequests","availableTeams"];console.error(`Failed to load ${r[t]}:`,e.reason)}}),2===e.filter((e,t)=>t<2&&"rejected"===e.status).length&&g("Failed to load team access requests")}catch(e){g(e instanceof Error?e.message:"Failed to load team access requests")}finally{m(!1)}},[h,b,p,y,t]);return r.useEffect(()=>{f()},[f]),{myRequests:a,pendingRequests:n,organizationRequests:i,availableTeams:o,loading:x,error:u,createRequest:r.useCallback(async(r,a="")=>{if(!t)throw new Error("Organization ID is required");try{await vl.createRequest(e,r,t,a),await f()}catch(s){throw new Error(s instanceof Error?s.message:"Failed to create request")}},[e,t,f]),approveRequest:r.useCallback(async(t,r="")=>{try{await vl.approveRequest(t,e,r),await f()}catch(a){throw new Error(a instanceof Error?a.message:"Failed to approve request")}},[e,f]),rejectRequest:r.useCallback(async(t,r="")=>{try{await vl.rejectRequest(t,e,r),await f()}catch(a){throw new Error(a instanceof Error?a.message:"Failed to reject request")}},[e,f]),cancelRequest:r.useCallback(async e=>{try{await vl.cancelRequest(e),await f()}catch(t){throw new Error(t instanceof Error?t.message:"Failed to cancel request")}},[f]),refresh:f}}(e,t),[b,p]=r.useState(!1),[y,f]=r.useState(""),[j,v]=r.useState(""),[w,N]=r.useState(""),[k,_]=r.useState(null),[C,S]=r.useState(!1),[D,M]=r.useState("my");console.log("TeamAccessRequestManagement render:",{userId:e,organizationId:t,availableTeamsCount:o.length,loading:c,error:x});const E=e=>{switch(e){case"pending":return R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:[R.jsx(Oe,{className:"h-3 w-3"}),"æ‰¿èªå¾…ã¡"]});case"approved":return R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:[R.jsx(Ae,{className:"h-3 w-3"}),"æ‰¿èªæ¸ˆã¿"]});case"rejected":return R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:[R.jsx(sr,{className:"h-3 w-3"}),"å´ä¸‹"]});default:return null}};return c?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x?R.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx(ye,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),R.jsx("p",{className:"text-red-800 dark:text-red-200",children:x})]})}):R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[R.jsx(rr,{className:"h-6 w-6"}),"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†"]}),R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"ä»–ã®ãƒãƒ¼ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ç®¡ç†"})]}),o.length>0&&R.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[R.jsx(kt,{className:"h-4 w-4"}),"æ–°è¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"]})]}),R.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:R.jsxs("nav",{className:"flex gap-4",children:[R.jsxs("button",{onClick:()=>M("my"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("my"===D?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["è‡ªåˆ†ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (",l.length,")"]}),R.jsxs("button",{onClick:()=>M("pending"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("pending"===D?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["æ‰¿èªå¾…ã¡ (",i.length,")"]}),a&&R.jsxs("button",{onClick:()=>M("all"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("all"===D?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["ã™ã¹ã¦ (",d.length,")"]})]})}),"my"===D&&R.jsx("div",{className:"space-y-4",children:0===l.length?R.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):l.map(e=>{var t;return R.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.team)?void 0:t.name}),E(e.status)]}),e.request_message&&R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:e.request_message}),e.review_notes&&R.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¡ãƒ¢:"})," ",e.review_notes]})}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),"pending"===e.status&&R.jsx("button",{onClick:()=>(async e=>{if(confirm("ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ")){S(!0);try{await h(e)}catch(t){alert(t instanceof Error?t.message:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{S(!1)}}})(e.id),disabled:C,className:"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})},e.id)})}),"pending"===D&&R.jsx("div",{className:"space-y-4",children:0===i.length?R.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"æ‰¿èªå¾…ã¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):i.map(e=>{var t,r;return R.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.requester)?void 0:t.name}),R.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ãŒ ",null==(r=e.team)?void 0:r.name," ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"]})]}),e.request_message&&R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:e.request_message}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),R.jsxs("div",{className:"flex gap-2",children:[R.jsx("button",{onClick:()=>_(e),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"æ‰¿èª"}),R.jsx("button",{onClick:()=>{_(e),N("")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"å´ä¸‹"})]})]})},e.id)})}),"all"===D&&a&&R.jsx("div",{className:"space-y-4",children:0===d.length?R.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):d.map(e=>{var t,r;return R.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:R.jsx("div",{className:"flex items-start justify-between",children:R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.requester)?void 0:t.name}),R.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["â†’ ",null==(r=e.team)?void 0:r.name]}),E(e.status)]}),e.request_message&&R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:e.request_message}),e.review_notes&&R.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼:"})," ",e.review_notes,e.reviewer&&` by ${e.reviewer.name}`]})}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]})})},e.id)})}),b&&R.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒãƒ¼ãƒ ã‚’é¸æŠ"}),R.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[R.jsx("option",{value:"",children:"é¸æŠã—ã¦ãã ã•ã„"}),o.map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰"}),R.jsx("textarea",{value:j,onChange:e=>v(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç†ç”±ã‚„è©³ç´°ã‚’å…¥åŠ›..."})]})]}),R.jsxs("div",{className:"flex gap-3 mt-6",children:[R.jsx("button",{onClick:()=>p(!1),disabled:C,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:async()=>{if(y){S(!0);try{await m(y,j),p(!1),f(""),v("")}catch(e){alert(e instanceof Error?e.message:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{S(!1)}}},disabled:C||!y,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:C?"é€ä¿¡ä¸­...":"ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡"})]})]})}),k&&R.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{className:"font-medium",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…:"})," ",null==(s=k.requester)?void 0:s.name]}),R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{className:"font-medium",children:"ãƒãƒ¼ãƒ :"})," ",null==(n=k.team)?void 0:n.name]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),R.jsx("textarea",{value:w,onChange:e=>N(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..."})]})]}),R.jsxs("div",{className:"flex gap-3 mt-6",children:[R.jsx("button",{onClick:()=>{_(null),N("")},disabled:C,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:()=>(async e=>{S(!0);try{await g(e.id,w),_(null),N("")}catch(t){alert(t instanceof Error?t.message:"å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{S(!1)}})(k),disabled:C,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:"å´ä¸‹"}),R.jsx("button",{onClick:()=>(async e=>{S(!0);try{await u(e.id,w),_(null),N("")}catch(t){alert(t instanceof Error?t.message:"æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{S(!1)}})(k),disabled:C,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:"æ‰¿èª"})]})]})})]})}const Nl={async getMyTransferRequests(e){const{data:t,error:r}=await q.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        )\n      ").or(`athlete_id.eq.${e},requested_by.eq.${e}`).order("created_at",{ascending:!1});if(r)throw r;return t},async getPendingRequestsForMyTeams(e){const{data:t,error:r}=await q.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(r)throw r;const a=(null==t?void 0:t.map(e=>e.team_id))||[];if(0===a.length)return[];const{data:s,error:n}=await q.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        )\n      ").eq("status","pending").in("from_team_id",a).order("created_at",{ascending:!1});if(n)throw n;return s},async getRequestsForOrganization(e){const{data:t,error:r}=await q.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        ),\n        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("organization_id",e).order("created_at",{ascending:!1});if(r)throw r;return t},async getAthletesInMyTeams(e){const{data:t,error:r}=await q.from("staff_team_links").select("team_id").eq("staff_user_id",e);if(r)throw r;const a=(null==t?void 0:t.map(e=>e.team_id))||[];if(0===a.length)return[];const{data:s,error:n}=await q.from("users").select("\n        id,\n        name,\n        email,\n        team_id,\n        team:teams (\n          id,\n          name\n        )\n      ").eq("role","athlete").in("team_id",a).order("name");if(n)throw n;return s},async getAvailableDestinationTeams(e,t){const{data:r,error:a}=await q.from("teams").select("id, name, organization_id").eq("organization_id",e).neq("id",t).order("name");if(a)throw a;return r},async createTransferRequest(e,t,r,a,s,n=""){const{data:l,error:i}=await q.from("athlete_transfer_requests").insert({athlete_id:e,from_team_id:t,to_team_id:r,organization_id:a,requested_by:s,status:"pending",request_reason:n}).select().single();if(i)throw i;return l},async approveTransfer(e,t,r=""){const{error:a}=await q.rpc("approve_athlete_transfer",{request_id:e,reviewer_user_id:t,notes:r});if(a)throw a},async rejectTransfer(e,t,r=""){const{error:a}=await q.rpc("reject_athlete_transfer",{request_id:e,reviewer_user_id:t,notes:r});if(a)throw a},async cancelTransferRequest(e){const{error:t}=await q.from("athlete_transfer_requests").delete().eq("id",e).eq("status","pending");if(t)throw t},async getTransferHistory(e){const{data:t,error:r}=await q.from("team_transfer_history").select("\n        *,\n        athlete:users!team_transfer_history_athlete_id_fkey (\n          id,\n          name\n        ),\n        from_team:teams!team_transfer_history_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!team_transfer_history_to_team_id_fkey (\n          id,\n          name\n        ),\n        transferred_by_user:users!team_transfer_history_transferred_by_fkey (\n          id,\n          name\n        )\n      ").eq("athlete_id",e).order("transfer_date",{ascending:!1});if(r)throw r;return t},async getTeamTransferHistory(e){const{data:t,error:r}=await q.from("team_transfer_history").select("\n        *,\n        athlete:users!team_transfer_history_athlete_id_fkey (\n          id,\n          name\n        ),\n        from_team:teams!team_transfer_history_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!team_transfer_history_to_team_id_fkey (\n          id,\n          name\n        ),\n        transferred_by_user:users!team_transfer_history_transferred_by_fkey (\n          id,\n          name\n        )\n      ").or(`from_team_id.eq.${e},to_team_id.eq.${e}`).order("transfer_date",{ascending:!1});if(r)throw r;return t},async getRequestById(e){const{data:t,error:r}=await q.from("athlete_transfer_requests").select("\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        ),\n        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      ").eq("id",e).maybeSingle();if(r)throw r;return t}};function kl({userId:e,organizationId:t,isAdmin:a=!1}){var s,n,l,i,d;const{myRequests:o,pendingRequests:c,organizationRequests:x,myAthletes:m,loading:u,error:g,createTransferRequest:h,approveTransfer:b,rejectTransfer:p,cancelTransferRequest:y,getTransferHistory:f,getAvailableDestinationTeams:j}=function(e,t){const[a,s]=r.useState([]),[n,l]=r.useState([]),[i,d]=r.useState([]),[o,c]=r.useState([]),[x,m]=r.useState(!0),[u,g]=r.useState(null),h=r.useCallback(async()=>{try{const t=await Nl.getMyTransferRequests(e);s(t)}catch(t){throw console.error("Error loading my transfer requests:",t),t}},[e]),b=r.useCallback(async()=>{try{const t=await Nl.getPendingRequestsForMyTeams(e);l(t)}catch(t){throw console.error("Error loading pending transfer requests:",t),t}},[e]),p=r.useCallback(async()=>{if(t)try{const e=await Nl.getRequestsForOrganization(t);d(e)}catch(e){throw console.error("Error loading organization transfer requests:",e),e}},[t]),y=r.useCallback(async()=>{try{const t=await Nl.getAthletesInMyTeams(e);c(t)}catch(t){throw console.error("Error loading my athletes:",t),t}},[e]),f=r.useCallback(async()=>{m(!0),g(null);try{await Promise.all([h(),b(),y(),t?p():Promise.resolve()])}catch(e){g(e instanceof Error?e.message:"Failed to load transfer requests")}finally{m(!1)}},[h,b,y,p,t]);return r.useEffect(()=>{f()},[f]),{myRequests:a,pendingRequests:n,organizationRequests:i,myAthletes:o,loading:x,error:u,createTransferRequest:r.useCallback(async(r,a,s,n="")=>{if(!t)throw new Error("Organization ID is required");try{await Nl.createTransferRequest(r,a,s,t,e,n),await f()}catch(l){throw new Error(l instanceof Error?l.message:"Failed to create transfer request")}},[e,t,f]),approveTransfer:r.useCallback(async(t,r="")=>{try{await Nl.approveTransfer(t,e,r),await f()}catch(a){throw new Error(a instanceof Error?a.message:"Failed to approve transfer")}},[e,f]),rejectTransfer:r.useCallback(async(t,r="")=>{try{await Nl.rejectTransfer(t,e,r),await f()}catch(a){throw new Error(a instanceof Error?a.message:"Failed to reject transfer")}},[e,f]),cancelTransferRequest:r.useCallback(async e=>{try{await Nl.cancelTransferRequest(e),await f()}catch(t){throw new Error(t instanceof Error?t.message:"Failed to cancel transfer request")}},[f]),getTransferHistory:r.useCallback(async e=>{try{return await Nl.getTransferHistory(e)}catch(t){throw new Error(t instanceof Error?t.message:"Failed to get transfer history")}},[]),getAvailableDestinationTeams:r.useCallback(async e=>{if(!t)throw new Error("Organization ID is required");try{return await Nl.getAvailableDestinationTeams(t,e)}catch(r){throw new Error(r instanceof Error?r.message:"Failed to get available teams")}},[t]),refresh:f}}(e,t),[v,w]=r.useState(!1),[N,k]=r.useState(null),[_,C]=r.useState(""),[S,D]=r.useState(""),[M,E]=r.useState(""),[T,A]=r.useState(null),[$,z]=r.useState(!1),[q,F]=r.useState("my"),[I,L]=r.useState([]),[P,O]=r.useState(!1),[W,B]=r.useState([]),U=e=>{switch(e){case"pending":return R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:[R.jsx(Oe,{className:"h-3 w-3"}),"æ‰¿èªå¾…ã¡"]});case"approved":return R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:[R.jsx(Ae,{className:"h-3 w-3"}),"æ‰¿èªæ¸ˆã¿"]});case"completed":return R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:[R.jsx(Ae,{className:"h-3 w-3"}),"å®Œäº†"]});case"rejected":return R.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:[R.jsx(sr,{className:"h-3 w-3"}),"å´ä¸‹"]});default:return null}};return u?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):g?R.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx(ye,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),R.jsx("p",{className:"text-red-800 dark:text-red-200",children:g})]})}):R.jsxs("div",{className:"space-y-6",children:[R.jsx("div",{className:"flex items-center justify-between",children:R.jsxs("div",{children:[R.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[R.jsx(Gt,{className:"h-6 w-6"}),"é¸æ‰‹ç§»ç±ç®¡ç†"]}),R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"é¸æ‰‹ã®ãƒãƒ¼ãƒ é–“ç§»ç±ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ç®¡ç†"})]})}),R.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:R.jsxs("nav",{className:"flex gap-4",children:[R.jsxs("button",{onClick:()=>F("my"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("my"===q?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["è‡ªåˆ†ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (",o.length,")"]}),R.jsxs("button",{onClick:()=>F("pending"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("pending"===q?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["æ‰¿èªå¾…ã¡ (",c.length,")"]}),a&&R.jsxs("button",{onClick:()=>F("all"),className:"pb-3 px-1 border-b-2 font-medium text-sm transition-colors "+("all"===q?"border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:["ã™ã¹ã¦ (",x.length,")"]})]})}),"my"===q&&R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"æ‹…å½“é¸æ‰‹"}),R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>{var t;return R.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[R.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:null==(t=e.team)?void 0:t.name}),R.jsxs("div",{className:"flex gap-2 mt-3",children:[R.jsx("button",{onClick:()=>(async e=>{k(e);try{const t=await j(e.team_id);L(t),w(!0)}catch(t){alert(t instanceof Error?t.message:"åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ãƒ ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}})(e),className:"flex-1 px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"ç§»ç±ç”³è«‹"}),R.jsx("button",{onClick:()=>(async e=>{try{const t=await f(e);B(t),O(!0)}catch(t){alert(t instanceof Error?t.message:"å±¥æ­´ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}})(e.id),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:R.jsx(nt,{className:"h-4 w-4"})})]})]},e.id)})})]}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±¥æ­´"}),R.jsx("div",{className:"space-y-4",children:0===o.length?R.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):o.map(e=>{var t,r,a;return R.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[R.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.athlete)?void 0:t.name}),U(e.status)]}),R.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{children:null==(r=e.from_team)?void 0:r.name}),R.jsx(ve,{className:"h-4 w-4"}),R.jsx("span",{children:null==(a=e.to_team)?void 0:a.name})]}),e.request_reason&&R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ç†ç”±: ",e.request_reason]}),e.review_notes&&R.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼:"})," ",e.review_notes]})}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),"pending"===e.status&&R.jsx("button",{onClick:()=>(async e=>{if(confirm("ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ")){z(!0);try{await y(e)}catch(t){alert(t instanceof Error?t.message:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{z(!1)}}})(e.id),disabled:$,className:"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})},e.id)})})]})]}),"pending"===q&&R.jsx("div",{className:"space-y-4",children:0===c.length?R.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"æ‰¿èªå¾…ã¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):c.map(e=>{var t,r,a,s;return R.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[R.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.athlete)?void 0:t.name}),R.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ã®ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"})]}),R.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[R.jsx("span",{children:null==(r=e.from_team)?void 0:r.name}),R.jsx(ve,{className:"h-4 w-4"}),R.jsx("span",{children:null==(a=e.to_team)?void 0:a.name})]}),R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…: ",null==(s=e.requester)?void 0:s.name]}),e.request_reason&&R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ç†ç”±: ",e.request_reason]}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),R.jsxs("div",{className:"flex gap-2",children:[R.jsx("button",{onClick:()=>A(e),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"æ‰¿èª"}),R.jsx("button",{onClick:()=>{A(e),E("")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"å´ä¸‹"})]})]})},e.id)})}),"all"===q&&a&&R.jsx("div",{className:"space-y-4",children:0===x.length?R.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"}):x.map(e=>{var t,r,a,s;return R.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:R.jsx("div",{className:"flex items-start justify-between",children:R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[R.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:null==(t=e.athlete)?void 0:t.name}),U(e.status)]}),R.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[R.jsx("span",{children:null==(r=e.from_team)?void 0:r.name}),R.jsx(ve,{className:"h-4 w-4"}),R.jsx("span",{children:null==(a=e.to_team)?void 0:a.name})]}),R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…: ",null==(s=e.requester)?void 0:s.name]}),e.request_reason&&R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["ç†ç”±: ",e.request_reason]}),e.review_notes&&R.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{className:"font-medium",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼:"})," ",e.review_notes,e.reviewer&&` by ${e.reviewer.name}`]})}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]})})},e.id)})}),v&&N&&R.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"é¸æ‰‹"}),R.jsx("p",{className:"text-gray-900 dark:text-white",children:N.name}),R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ç¾åœ¨ã®ãƒãƒ¼ãƒ : ",null==(s=N.team)?void 0:s.name]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç§»ç±å…ˆãƒãƒ¼ãƒ "}),R.jsxs("select",{value:_,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[R.jsx("option",{value:"",children:"é¸æŠã—ã¦ãã ã•ã„"}),I.map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ç§»ç±ç†ç”±"}),R.jsx("textarea",{value:S,onChange:e=>D(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ç§»ç±ã®ç†ç”±ã‚’å…¥åŠ›..."})]})]}),R.jsxs("div",{className:"flex gap-3 mt-6",children:[R.jsx("button",{onClick:()=>{w(!1),k(null),C(""),D(""),L([])},disabled:$,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:async()=>{if(N&&_){z(!0);try{await h(N.id,N.team_id,_,S),w(!1),k(null),C(""),D(""),L([])}catch(e){alert(e instanceof Error?e.message:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{z(!1)}}},disabled:$||!_,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:$?"é€ä¿¡ä¸­...":"ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡"})]})]})}),T&&R.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ç§»ç±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.jsx("span",{className:"font-medium",children:"é¸æ‰‹:"})," ",null==(n=T.athlete)?void 0:n.name]}),R.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mt-1",children:[R.jsx("span",{children:null==(l=T.from_team)?void 0:l.name}),R.jsx(ve,{className:"h-4 w-4"}),R.jsx("span",{children:null==(i=T.to_team)?void 0:i.name})]}),R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[R.jsx("span",{className:"font-medium",children:"ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…:"})," ",null==(d=T.requester)?void 0:d.name]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),R.jsx("textarea",{value:M,onChange:e=>E(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..."})]})]}),R.jsxs("div",{className:"flex gap-3 mt-6",children:[R.jsx("button",{onClick:()=>{A(null),E("")},disabled:$,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{onClick:()=>(async e=>{z(!0);try{await p(e.id,M),A(null),E("")}catch(t){alert(t instanceof Error?t.message:"å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{z(!1)}})(T),disabled:$,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:"å´ä¸‹"}),R.jsx("button",{onClick:()=>(async e=>{var t;if(confirm(`${null==(t=e.athlete)?void 0:t.name}ã®ç§»ç±ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)){z(!0);try{await b(e.id,M),A(null),E("")}catch(r){alert(r instanceof Error?r.message:"æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{z(!1)}}})(T),disabled:$,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:"æ‰¿èª"})]})]})}),P&&R.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ç§»ç±å±¥æ­´"}),R.jsx("button",{onClick:()=>O(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:R.jsx(sr,{className:"h-5 w-5"})})]}),R.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===W.length?R.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"ç§»ç±å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“"}):W.map(e=>{var t;return R.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:[R.jsxs("div",{className:"flex items-center gap-2 text-sm mb-1",children:[e.from_team?R.jsxs(R.Fragment,{children:[R.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:e.from_team.name}),R.jsx(ve,{className:"h-4 w-4"})]}):R.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"æ–°è¦ç™»éŒ²"}),R.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:e.to_team.name})]}),e.transfer_reason&&R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.transfer_reason}),R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[new Date(e.transfer_date).toLocaleString("ja-JP")," by"," ",null==(t=e.transferred_by_user)?void 0:t.name]})]},e.id)})})]})})]})}function _l(e){return e.trim().toLowerCase()}function Cl({organizationId:e,organizationName:t}){const[a,s]=r.useState([]),[n,l]=r.useState([]),[i,d]=r.useState([]),[o,c]=r.useState(!0),[x,m]=r.useState(!1),[u,g]=r.useState(!1),[h,b]=r.useState(null),[p,y]=r.useState(""),[f,j]=r.useState({}),[v,w]=r.useState({});r.useEffect(()=>{N(),k(),_()},[e]);const N=async()=>{try{c(!0);const t=await cn.getOrganizationMembers(e);s(t||[])}catch(t){console.error("Error loading members:",t),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{c(!1)}},k=async()=>{try{const{data:e,error:t}=await q.from("users").select("*").order("name");if(t)throw t;l(e||[])}catch(e){console.error("Error loading users:",e)}},_=async()=>{try{const t=await cn.getOrganizationTeams(e);d(t||[])}catch(t){console.error("Error loading organization teams:",t)}},C=async(e,t)=>{try{await cn.updateOrganizationMemberRole(e,t),await N(),alert("æ¨©é™ã‚’æ›´æ–°ã—ã¾ã—ãŸ")}catch(r){console.error("Error updating role:",r),alert("æ¨©é™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}},S=async e=>{if(confirm("ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{await cn.removeOrganizationMember(e),await N(),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ")}catch(t){console.error("Error removing member:",t),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}},D=async e=>{const t=_l(e);if(t&&"sending"!==f[t]){j(e=>({...e,[t]:"sending"})),w(e=>({...e,[t]:""}));try{const{data:e,error:r}=await q.functions.invoke("request-password-reset",{body:{email:t,redirectUrl:`${window.location.origin}/reset-password`}});if(r)return console.error("[OrganizationMembersManagement] request-password-reset error:",r),j(e=>({...e,[t]:"error"})),void w(e=>({...e,[t]:"é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"}));console.log("[OrganizationMembersManagement] request-password-reset result:",e),j(e=>({...e,[t]:"success"})),w(e=>({...e,[t]:"å†è¨­å®šãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆè¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ï¼‰ã€‚"})),window.setTimeout(()=>{j(e=>({...e,[t]:"idle"})),w(e=>({...e,[t]:""}))},5e3)}catch(r){console.error("[OrganizationMembersManagement] exception:",r),j(e=>({...e,[t]:"error"})),w(e=>({...e,[t]:(null==r?void 0:r.message)||"é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"}))}}},M=e=>"organization_admin"===e?R.jsx(qt,{className:"h-4 w-4 text-blue-600"}):R.jsx(rr,{className:"h-4 w-4 text-gray-600"}),E=e=>{switch(e){case"organization_admin":return"çµ„ç¹”ç®¡ç†è€…";case"member":return"ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼";default:return e}},T=e=>{switch(e){case"organization_admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"member":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200";default:return"bg-gray-100 text-gray-800"}},A=r.useMemo(()=>a.filter(e=>{var t,r;if(!p)return!0;const a=e.users;if(!a)return!1;const s=p.toLowerCase();return(null==(t=a.name)?void 0:t.toLowerCase().includes(s))||(null==(r=a.email)?void 0:r.toLowerCase().includes(s))}),[a,p]);return o?R.jsx("div",{className:"flex items-center justify-center py-12",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[R.jsx(rr,{className:"h-6 w-6"}),"çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†"]}),R.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[t,"ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨æ¨©é™ã‚’ç®¡ç†"]})]}),R.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[R.jsx(kt,{className:"h-4 w-4"}),"ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "]})]}),R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4",children:R.jsxs("div",{className:"relative",children:[R.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),R.jsx("input",{type:"text",value:p,onChange:e=>y(e.target.value),placeholder:"åå‰ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:[R.jsx("div",{className:"p-6 border-b dark:border-gray-700",children:R.jsx("div",{className:"flex items-center justify-between",children:R.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ (",A.length,")"]})})}),R.jsx("div",{className:"divide-y dark:divide-gray-700",children:0===A.length?R.jsx("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:p?"æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“":"ãƒ¡ãƒ³ãƒãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}):A.map(e=>R.jsx(Sl,{member:e,onUpdateRole:C,onRemove:S,onAssignTeam:e=>{b(e),g(!0)},onResendPasswordLink:D,sendStateByEmail:f,sendMsgByEmail:v,getRoleIcon:M,getRoleLabel:E,getRoleBadgeColor:T},e.id))})]}),x&&R.jsx(Dl,{organizationId:e,existingMembers:a,availableUsers:n,onClose:()=>m(!1),onAdd:async(t,r)=>{try{await cn.addOrganizationMember({user_id:t,organization_id:e,role:r}),await N(),m(!1),alert("ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ")}catch(a){console.error("Error adding member:",a),alert("ãƒ¡ãƒ³ãƒãƒ¼ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(a instanceof Error?a.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}},getRoleIcon:M,getRoleLabel:E}),u&&h&&R.jsx(Ml,{member:h,teams:i,onClose:()=>{g(!1),b(null)},onAssign:async(t,r)=>{try{const{error:a}=await q.rpc("assign_user_to_team",{p_user_id:t,p_team_id:r,p_organization_id:e,p_assignment_type:"primary"});if(a)throw a;await N(),g(!1),b(null),alert("ãƒãƒ¼ãƒ ã¸ã®å‰²ã‚Šå½“ã¦ãŒå®Œäº†ã—ã¾ã—ãŸ")}catch(a){console.error("Error assigning to team:",a),alert("ãƒãƒ¼ãƒ ã¸ã®å‰²ã‚Šå½“ã¦ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(a instanceof Error?a.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"))}}})]})}function Sl({member:e,onUpdateRole:t,onRemove:r,onAssignTeam:a,onResendPasswordLink:s,sendStateByEmail:n,sendMsgByEmail:l,getRoleIcon:i,getRoleLabel:d,getRoleBadgeColor:o}){var c,x,m,u;const g=e.users;if(!g)return null;const h=_l(g.email||""),b=n[h]||"idle",p=l[h]||"",y="sending"===b;return R.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[R.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:R.jsx("span",{className:"text-blue-600 dark:text-blue-200 font-semibold",children:(null==(x=null==(c=g.name)?void 0:c[0])?void 0:x.toUpperCase())||(null==(u=null==(m=g.email)?void 0:m[0])?void 0:u.toUpperCase())||"?"})}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[R.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:g.name||"Unknown User"}),R.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${o(e.role)}`,children:[i(e.role),d(e.role)]})]}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:g.email}),R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["è¿½åŠ æ—¥: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),p&&R.jsxs("div",{className:"mt-2 text-xs rounded-md px-2 py-1 inline-flex items-start gap-1 border "+("success"===b?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200":"error"===b?"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200":"bg-gray-50 border-gray-200 text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200"),children:["success"===b?R.jsx(Te,{className:"h-3.5 w-3.5 mt-0.5"}):"error"===b?R.jsx(fe,{className:"h-3.5 w-3.5 mt-0.5"}):null,R.jsx("span",{children:p})]})]})]}),R.jsxs("div",{className:"flex items-center gap-2 ml-2 flex-shrink-0",children:[R.jsxs("button",{onClick:()=>a(e),className:"px-3 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1",title:"ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦",children:[R.jsx(Qt,{className:"h-4 w-4"}),R.jsx("span",{className:"hidden sm:inline",children:"ãƒãƒ¼ãƒ å‰²å½“"})]}),R.jsx("button",{onClick:()=>s(g.email),disabled:!g.email||y,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\n                       disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šãƒªãƒ³ã‚¯ã‚’å†é€",children:y?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),R.jsx("span",{className:"hidden sm:inline",children:"é€ä¿¡ä¸­"})]}):R.jsxs(R.Fragment,{children:[R.jsx(_t,{className:"h-4 w-4"}),R.jsx("span",{className:"hidden sm:inline",children:"å†é€"})]})}),R.jsxs("select",{value:e.role,onChange:r=>t(e.id,r.target.value),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[R.jsx("option",{value:"organization_admin",children:"çµ„ç¹”ç®¡ç†è€…"}),R.jsx("option",{value:"member",children:"ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼"})]}),R.jsx("button",{onClick:()=>r(e.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",title:"å‰Šé™¤",children:R.jsx(Ut,{className:"h-4 w-4"})})]})]})})}function Dl({organizationId:e,existingMembers:t,availableUsers:a,onClose:s,onAdd:n,getRoleIcon:l,getRoleLabel:i}){const[d,o]=r.useState(""),[c,x]=r.useState("organization_admin"),[m,u]=r.useState(!1),[g,h]=r.useState(""),b=new Set(t.map(e=>e.user_id)),p=a.filter(e=>!b.has(e.id)).filter(e=>{var t,r;if(!g)return!0;const a=g.toLowerCase();return(null==(t=e.name)?void 0:t.toLowerCase().includes(a))||(null==(r=e.email)?void 0:r.toLowerCase().includes(a))});return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:R.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d){u(!0);try{await n(d,c)}finally{u(!1)}}else alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„")},children:[R.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"çµ„ç¹”ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¦æ¨©é™ã‚’è¨­å®šã—ã¾ã™"})]}),R.jsxs("div",{className:"p-6 space-y-6",children:[R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ ",R.jsx("span",{className:"text-red-600",children:"*"})]}),R.jsx("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"åå‰ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-3"}),R.jsx("div",{className:"border dark:border-gray-600 rounded-lg max-h-60 overflow-y-auto",children:0===p.length?R.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:g?"è©²å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“":"è¿½åŠ å¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¾ã›ã‚“"}):R.jsx("div",{className:"divide-y dark:divide-gray-700",children:p.map(e=>R.jsxs("label",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors "+(d===e.id?"bg-blue-50 dark:bg-blue-900/20":""),children:[R.jsx("input",{type:"radio",name:"user",value:e.id,checked:d===e.id,onChange:e=>o(e.target.value),className:"h-4 w-4 text-blue-600"}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.name||"Unknown User"}),R.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:e.email}),e.role&&R.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ­ãƒ¼ãƒ«: ",e.role]})]})]},e.id))})})]}),R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:["æ¨©é™ã‚’é¸æŠ ",R.jsx("span",{className:"text-red-600",children:"*"})]}),R.jsx("div",{className:"space-y-3",children:[{value:"organization_admin",label:"çµ„ç¹”ç®¡ç†è€…",description:"çµ„ç¹”å†…ã®ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¨è¨­å®šã‚’ç®¡ç†ã§ãã¾ã™ï¼ˆç›£ç£ã€GMã€çµ±æ‹¬ã‚³ãƒ¼ãƒãªã©ï¼‰"},{value:"member",label:"ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼",description:"é€šå¸¸ã®ã‚³ãƒ¼ãƒ/é¸æ‰‹ã¨ã—ã¦æ´»å‹•ã—ã¾ã™ï¼ˆç®¡ç†æ¨©é™ãªã—ï¼‰"}].map(e=>R.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-colors "+(c===e.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[R.jsx("input",{type:"radio",name:"role",value:e.value,checked:c===e.value,onChange:e=>x(e.target.value),className:"mt-1 h-4 w-4 text-blue-600"}),R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[l(e.value),R.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.label})]}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]})]},e.value))})]})]}),R.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700",children:[R.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:m,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:m||!d,children:m?"è¿½åŠ ä¸­...":"ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ "})]})]})})})}function Ml({member:e,teams:t,onClose:a,onAssign:s}){const[n,l]=r.useState(""),[i,d]=r.useState(!1),o=e.users;if(!o)return null;return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:R.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),n){d(!0);try{await s(o.id,n)}finally{d(!1)}}else alert("ãƒãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„")},children:[R.jsxs("div",{className:"p-6 border-b dark:border-gray-700",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦"}),R.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[o.name,"ã•ã‚“ã‚’ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦ã¾ã™"]})]}),R.jsxs("div",{className:"p-6 space-y-4",children:[R.jsxs("div",{children:[R.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["ãƒãƒ¼ãƒ ã‚’é¸æŠ ",R.jsx("span",{className:"text-red-600",children:"*"})]}),R.jsxs("select",{value:n,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0,children:[R.jsx("option",{value:"",children:"ãƒãƒ¼ãƒ ã‚’é¸æŠ..."}),t.map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))]}),0===t.length&&R.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-2",children:"ã“ã®çµ„ç¹”ã«ã¯ã¾ã ãƒãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ãƒãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"})]}),R.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:R.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[R.jsx("strong",{children:"æ³¨æ„:"})," ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é¸æŠã—ãŸãƒãƒ¼ãƒ ã«ä¸»è¦ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚"]})})]}),R.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700",children:[R.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:i,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),R.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center gap-2",disabled:i||!n||0===t.length,children:i?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),R.jsx("span",{children:"å‰²ã‚Šå½“ã¦ä¸­..."})]}):R.jsxs(R.Fragment,{children:[R.jsx(Qt,{className:"h-4 w-4"}),R.jsx("span",{children:"ãƒãƒ¼ãƒ ã«å‰²ã‚Šå½“ã¦"})]})})]})]})})})}const El=2e3;function Rl(e){return(e??"").trim().replace(/^\uFEFF/,"").replace(/\u3000/g," ").replace(/\s+/g," ").replace(/^\s*\d+\s*[\.\)\-:]\s*/g,"").toLowerCase().replace(/\s+/g," ").replace(/[^a-z0-9\u3040-\u30ff\u4e00-\u9faf %/_-]/g,"")}function Tl(e){const t=(e??"").toString().trim();if(!t)return null;const r=Number(t.replace(/,/g,""));return Number.isFinite(r)?r:null}function Al(e,t){const r=e.map(e=>({raw:e,norm:Rl(e)})).find(e=>t.includes(e.norm));return(null==r?void 0:r.raw)??null}function $l(){const[e,t]=r.useState(""),[a,s]=r.useState(""),[n,l]=r.useState(!1),[i,d]=r.useState(!1),[o,c]=r.useState([]),[x,m]=r.useState([]),[u,g]=r.useState(""),h=o.length,b=x.length,p=r.useMemo(()=>h>0&&!i,[h,i]),y=async e=>{t(e.name),g(""),c([]),m([]),l(!0);try{const t=await e.text();s(t);const r=function(e){const t=[];let r=[],a="",s=!1;for(let n=0;n<e.length;n++){const l=e[n],i=e[n+1];'"'!==l?s||","!==l&&"\t"!==l?s||"\n"!==l&&"\r"!==l?a+=l:("\r"===l&&"\n"===i&&n++,r.push(a),a="",t.push(r),r=[]):(r.push(a),a=""):s&&'"'===i?(a+='"',n++):s=!s}for(r.push(a),t.push(r);t.length&&t[t.length-1].every(e=>""===(e??"").trim());)t.pop();return t}(t),{headers:a,rows:n}=function(e){if(!e.length)return{rows:[],headers:[]};const t=e[0].map(e=>(e??"").trim()),r=e.slice(1).map(e=>{const r={};for(let a=0;a<t.length;a++)r[t[a]]=(e[a]??"").toString();return r});return{headers:t,rows:r}}(r);if(!a.length)return void g("CSVã®ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");const l=Al(a,["mobile number","mobile","phone","phone number","phone_number","tel","telephone","æºå¸¯","æºå¸¯ç•ªå·","é›»è©±","é›»è©±ç•ªå·"]),i=Al(a,["test date / time","test date/time","test date time","test date","measured_at","date","æ¸¬å®šæ—¥","æ¸¬å®šæ—¥æ™‚","inbodyæ¸¬å®šæ—¥","inbody æ¸¬å®šæ—¥"]),d=Al(a,["height","height_cm","èº«é•·"]),o=Al(a,["weight","ä½“é‡"]),x=Al(a,["pbf (percent body fat)","pbf","percent body fat","percent_body_fat","body fat percent","body_fat_percent","ä½“è„‚è‚ªç‡"]),u=[l?null:"Mobile Number(é›»è©±ç•ªå·)",i?null:"Test Date / Time(æ¸¬å®šæ—¥)",d?null:"Height(èº«é•·)",o?null:"Weight(ä½“é‡)",x?null:"PBF(ä½“è„‚è‚ªç‡)"].filter(Boolean);if(u.length)return void g(`CSVãƒ˜ãƒƒãƒ€ãƒ¼ã«å¿…é ˆã‚«ãƒ©ãƒ ãŒä¸è¶³ã—ã¦ã„ã¾ã™: ${u.join(", ")}`);if(n.length>El)return void g("è¡Œæ•°ãŒå¤šã™ãã¾ã™ï¼ˆä¸Šé™ 2000 è¡Œï¼‰ã€‚CSVã‚’åˆ†å‰²ã—ã¦ãã ã•ã„ã€‚");const h=[],b=[];n.forEach((e,t)=>{const r=t+1,a=(e[l]??"").toString().replace(/\D/g,"");const s=function(e){const t=(e??"").toString().trim();if(!t)return null;const r=t.match(/(\d{4})[\/\.-](\d{1,2})[\/\.-](\d{1,2})/);if(r)return`${r[1]}-${String(Number(r[2])).padStart(2,"0")}-${String(Number(r[3])).padStart(2,"0")}`;const a=new Date(t);if(!Number.isNaN(a.getTime()))return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return null}(e[i]),n=Tl(e[d]),c=Tl(e[o]),m=Tl(e[x]);a?s?null==n||n<=0||n>250?b.push({rowIndex:r,message:"èº«é•·ãŒä¸æ­£ã§ã™ï¼ˆ0ã€œ250cmã®ç¯„å›²ã§ï¼‰",raw:e}):null==c||c<=0||c>300?b.push({rowIndex:r,message:"ä½“é‡ãŒä¸æ­£ã§ã™ï¼ˆ0ã€œ300kgã®ç¯„å›²ã§ï¼‰",raw:e}):null==m||m<0||m>80?b.push({rowIndex:r,message:"ä½“è„‚è‚ªç‡(PBF)ãŒä¸æ­£ã§ã™ï¼ˆ0ã€œ80%ã®ç¯„å›²ã§ï¼‰",raw:e}):h.push({rowIndex:r,phone_number:a,measured_at:s,height:n,weight:c,body_fat_percent:m,raw:e}):b.push({rowIndex:r,message:"æ¸¬å®šæ—¥(Test Date / Time)ãŒè§£é‡ˆã§ãã¾ã›ã‚“ï¼ˆä¾‹: 2025-12-21ï¼‰",raw:e}):b.push({rowIndex:r,message:"é›»è©±ç•ªå·ãŒç©º or ä¸æ­£ã§ã™ï¼ˆæ•°å­—ã®ã¿æŠ½å‡ºã§ãã¾ã›ã‚“ï¼‰",raw:e})}),c(h),m(b),g(`è§£æå®Œäº†ï¼šæœ‰åŠ¹ ${h.length} è¡Œ / ã‚¨ãƒ©ãƒ¼ ${b.length} è¡Œ`)}catch(r){console.error(r),g(`CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${String((null==r?void 0:r.message)??r)}`)}finally{l(!1)}};return R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[R.jsx(Qe,{className:"w-5 h-5 text-gray-600"}),R.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"InBody CSV ä¸€æ‹¬å–ã‚Šè¾¼ã¿"})]}),R.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[R.jsx("div",{className:"font-medium text-gray-800 mb-1",children:"å¿…é ˆã‚«ãƒ©ãƒ "}),R.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[R.jsx("li",{children:"Mobile Numberï¼ˆé›»è©±ç•ªå·ï¼‰â€»ã€Œ1. Mobile Numberã€ã§ã‚‚OK"}),R.jsx("li",{children:"Test Date / Timeï¼ˆâ€»æ™‚åˆ»è¾¼ã¿OK / ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯æ—¥ä»˜ã ã‘è¡¨ç¤ºï¼‰"}),R.jsx("li",{children:"Heightï¼ˆèº«é•·ï¼‰"}),R.jsx("li",{children:"Weightï¼ˆä½“é‡ï¼‰"}),R.jsx("li",{children:"PBFï¼ˆPercent Body Fat / ä½“è„‚è‚ªç‡ï¼‰"})]}),R.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"â€»ç•ªå·ä»˜ããƒ˜ãƒƒãƒ€ï¼ˆä¾‹: 1. Mobile Numberï¼‰ã‚‚è‡ªå‹•ã§å¸åã—ã¾ã™ã€‚"})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-blue-400 transition-colors cursor-pointer bg-gray-50",children:R.jsxs("div",{className:"text-center",children:[R.jsx(Yt,{className:"w-7 h-7 mx-auto text-gray-500 mb-2"}),R.jsx("div",{className:"text-sm font-medium text-gray-800",children:"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ã‚‚OKï¼‰"}),R.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["ä¸Šé™ ",El," è¡Œ"]}),e&&R.jsxs("div",{className:"text-xs text-gray-700 mt-2",children:["é¸æŠä¸­: ",e]})]})}),R.jsx("input",{type:"file",accept:".csv,text/csv",className:"hidden",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&y(r)}})]}),u&&R.jsxs("div",{className:"mt-4 flex items-start gap-2 text-sm",children:[u.startsWith("âœ…")?R.jsx(Re,{className:"w-5 h-5 text-green-600 mt-0.5"}):u.startsWith("âŒ")?R.jsx(fe,{className:"w-5 h-5 text-red-600 mt-0.5"}):R.jsx(fe,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),R.jsx("div",{className:"text-gray-700 whitespace-pre-wrap",children:u})]}),R.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[R.jsx("button",{onClick:async()=>{if(p){d(!0),g("");try{const{data:e,error:t}=await q.functions.invoke("import-inbody-csv",{body:{csv:a,source:"csv",note:null}});if(t)throw t;const r=(null==e?void 0:e.inserted_or_updated)??0,s=(null==e?void 0:e.rejected)??0;g(`âœ… å–ã‚Šè¾¼ã¿æˆåŠŸï¼š${r} è¡Œã‚’ upsertï¼ˆrejected: ${s}ï¼‰`)}catch(e){console.error(e),g(`âŒ å–ã‚Šè¾¼ã¿å¤±æ•—: ${String((null==e?void 0:e.message)??e)}`)}finally{d(!1)}}},disabled:!p,className:"px-4 py-2 rounded-lg text-white text-sm font-medium transition-colors "+(p?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 cursor-not-allowed"),children:i?R.jsxs("span",{className:"inline-flex items-center gap-2",children:[R.jsx(ct,{className:"w-4 h-4 animate-spin"}),"å–ã‚Šè¾¼ã¿ä¸­..."]}):"DBã¸ä¸€æ‹¬å–ã‚Šè¾¼ã¿ï¼ˆEdgeï¼‰"}),n&&R.jsxs("span",{className:"text-sm text-gray-600 inline-flex items-center gap-2",children:[R.jsx(ct,{className:"w-4 h-4 animate-spin"}),"è§£æä¸­..."]}),R.jsxs("div",{className:"text-sm text-gray-600",children:["æœ‰åŠ¹ ",R.jsx("span",{className:"font-semibold text-gray-900",children:h})," è¡Œ / ã‚¨ãƒ©ãƒ¼"," ",R.jsx("span",{className:"font-semibold text-gray-900",children:b})," è¡Œ"]})]})]}),x.length>0&&R.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[R.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[R.jsx(fe,{className:"w-5 h-5 text-red-600"}),R.jsx("h4",{className:"text-md font-semibold text-gray-900",children:"ã‚¨ãƒ©ãƒ¼è¡Œï¼ˆå–ã‚Šè¾¼ã¿å¯¾è±¡å¤–ï¼‰"})]}),R.jsx("div",{className:"overflow-x-auto",children:R.jsxs("table",{className:"min-w-full text-sm",children:[R.jsx("thead",{children:R.jsxs("tr",{className:"text-left text-gray-600",children:[R.jsx("th",{className:"py-2 pr-3",children:"è¡Œ"}),R.jsx("th",{className:"py-2 pr-3",children:"ç†ç”±"}),R.jsx("th",{className:"py-2 pr-3",children:"ãƒ‡ãƒ¼ã‚¿ï¼ˆæŠœç²‹ï¼‰"})]})}),R.jsx("tbody",{children:x.slice(0,50).map(e=>R.jsxs("tr",{className:"border-t",children:[R.jsx("td",{className:"py-2 pr-3 font-mono",children:e.rowIndex}),R.jsx("td",{className:"py-2 pr-3 text-red-700",children:e.message}),R.jsxs("td",{className:"py-2 pr-3 text-gray-600",children:[JSON.stringify(e.raw).slice(0,140),JSON.stringify(e.raw).length>140?"...":""]})]},`${e.rowIndex}-${e.message}`))})]})}),x.length>50&&R.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"â€»è¡¨ç¤ºã¯æœ€åˆã®50è¡Œã®ã¿"})]}),o.length>0&&R.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[R.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå…ˆé ­10è¡Œï¼‰"}),R.jsx("div",{className:"overflow-x-auto",children:R.jsxs("table",{className:"min-w-full text-sm",children:[R.jsx("thead",{children:R.jsxs("tr",{className:"text-left text-gray-600",children:[R.jsx("th",{className:"py-2 pr-3",children:"è¡Œ"}),R.jsx("th",{className:"py-2 pr-3",children:"é›»è©±"}),R.jsx("th",{className:"py-2 pr-3",children:"æ¸¬å®šæ—¥"}),R.jsx("th",{className:"py-2 pr-3",children:"èº«é•·"}),R.jsx("th",{className:"py-2 pr-3",children:"ä½“é‡"}),R.jsx("th",{className:"py-2 pr-3",children:"ä½“è„‚è‚ªç‡"})]})}),R.jsx("tbody",{children:o.slice(0,10).map(e=>R.jsxs("tr",{className:"border-t",children:[R.jsx("td",{className:"py-2 pr-3 font-mono",children:e.rowIndex}),R.jsx("td",{className:"py-2 pr-3 font-mono",children:e.phone_number}),R.jsx("td",{className:"py-2 pr-3 font-mono",children:e.measured_at}),R.jsx("td",{className:"py-2 pr-3",children:e.height}),R.jsx("td",{className:"py-2 pr-3",children:e.weight}),R.jsx("td",{className:"py-2 pr-3",children:e.body_fat_percent})]},e.rowIndex))})]})}),R.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"â€»å®Ÿéš›ã®ä¿å­˜ã¯ Edge å´ãŒæ—¥æ™‚ï¼ˆmeasured_at_tsï¼‰ã‚‚æ‰±ã„ã¾ã™"})]})]})}function zl({user:e,alerts:t,onNavigateToPrivacy:a,onNavigateToTerms:s,onNavigateToCommercial:n,onNavigateToHelp:l}){if(!e||!Kn(e.role))return R.jsx("div",{className:"min-h-screen flex items-center justify-center",children:R.jsxs("div",{className:"bg-white border rounded-xl p-6",children:[R.jsx("div",{className:"text-lg font-semibold",children:"æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"}),R.jsx("div",{className:"text-sm text-gray-600 mt-2",children:"ã“ã®ãƒšãƒ¼ã‚¸ã¯ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚"})]})});const[i,d]=r.useState([]),[o,c]=r.useState("system"),[x,m]=r.useState("overview"),[u,g]=r.useState("invite"),[h,b]=r.useState(""),[p,y]=r.useState("overview"),[f,j]=r.useState([]),[v,w]=r.useState(!1),[N,k]=r.useState("single"),[_,C]=r.useState(),[S,D]=r.useState(!0),[M,E]=r.useState(!1),[T,A]=r.useState(!1),[$,z]=r.useState(!1),{isActive:F,shouldShowTutorial:I,startTutorial:L,completeTutorial:P,skipTutorial:O,currentStepIndex:W,setCurrentStepIndex:B}=ge(),{organizations:U,loading:H}=xn(e.id);r.useEffect(()=>{I()&&!S&&L()},[I,L,S]),r.useEffect(()=>{const e=localStorage.getItem("admin_selected_organization");e&&U.some(t=>t.id===e)?C(e):U.length>0&&!_&&(C(U[0].id),localStorage.setItem("admin_selected_organization",U[0].id))},[U]);const V=U.find(e=>e.id===_),K=t.filter(e=>"high"===e.priority),J=t.filter(e=>"no_data"===e.type||"reminder"===e.type);r.useEffect(()=>{const e=localStorage.getItem("criticalAlertDismissed"),t=e?parseInt(e,10):0,r=Date.now(),a=18e5;t&&r-t<a?A(!0):t&&r-t>=a&&localStorage.removeItem("criticalAlertDismissed")},[]);r.useEffect(()=>{Y()},[]),r.useEffect(()=>{"system"===o&&"nutrition-dev"===x&&(async()=>{try{w(!0);const{data:e,error:t}=await q.from("inbody_records").select("user_id").not("user_id","is",null);if(t)throw t;const r=Array.from(new Set((e??[]).map(e=>e.user_id))).filter(Boolean),{data:a,error:s}=await q.from("app_users").select("id, nickname, email").in("id",r);if(s)return console.warn("fetchInbodyUsers: failed to fetch app_users info:",s),void j(r.map(e=>({user_id:e})));const n=(a??[]).map(e=>({user_id:e.id,name:e.nickname||e.email||e.id}))??[];j(n)}catch(e){console.error("fetchInbodyUsers error:",e)}finally{w(!1)}})()},[o,x]);const Y=async()=>{try{const{data:e,error:t}=await q.from("teams").select("*").order("name");if(t)throw t;d(e||[])}catch(e){console.error("Error fetching teams:",e)}finally{D(!1)}};return S?R.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):R.jsxs("div",{className:"min-h-screen bg-gray-50",children:[R.jsx("header",{className:"bg-white shadow-sm border-b sticky top-0 z-40",children:R.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[R.jsxs("div",{className:"flex items-center justify-between py-3",children:[R.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"}),R.jsxs("div",{className:"flex items-center space-x-1",children:[K.length>0&&R.jsxs("button",{onClick:()=>E(!0),className:"p-2 text-gray-600 hover:text-red-600 transition-colors relative",title:"ã‚¢ãƒ©ãƒ¼ãƒˆ",children:[R.jsx(fe,{className:"w-5 h-5"}),R.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),R.jsx("button",{onClick:L,className:"p-2 text-gray-600 hover:text-purple-600 transition-colors",title:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",children:R.jsx(st,{className:"w-5 h-5"})})]})]}),!H&&U.length>1&&R.jsx("div",{className:"pb-3 border-t border-gray-100",children:R.jsxs("div",{className:"flex items-center gap-3 pt-3",children:[R.jsx(De,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),R.jsx("select",{value:_||"",onChange:e=>{return t=e.target.value,C(t),void localStorage.setItem("admin_selected_organization",t);var t},className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:U.map(e=>R.jsx("option",{value:e.id,children:e.name},e.id))})]})})]})}),R.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:R.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[K.length>0&&!T&&R.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:R.jsxs("div",{className:"flex items-center",children:[R.jsx(fe,{className:"w-6 h-6 text-red-600 mr-3 flex-shrink-0"}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("h3",{className:"font-semibold text-red-900",children:"é«˜ãƒªã‚¹ã‚¯ã‚¢ãƒ©ãƒ¼ãƒˆ"}),R.jsxs("p",{className:"text-sm text-red-700",children:[K.length,"ä»¶ã®æ³¨æ„ãŒå¿…è¦ã§ã™"]})]}),R.jsx("button",{onClick:()=>{A(!0),localStorage.setItem("criticalAlertDismissed",Date.now().toString())},className:"ml-3 p-1 text-red-400 hover:text-red-600 transition-colors flex-shrink-0",title:"30åˆ†é–“éè¡¨ç¤º",children:R.jsx(sr,{className:"w-5 h-5"})})]})}),R.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[R.jsxs("div",{className:"flex items-center mb-6",children:[R.jsx(ke,{className:"w-6 h-6 text-blue-600 mr-3"}),R.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦"})]}),R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[R.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:t.length}),R.jsx("div",{className:"text-sm text-blue-700",children:"ç·ã‚¢ãƒ©ãƒ¼ãƒˆæ•°"})]}),R.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-red-600 mb-1",children:K.length}),R.jsx("div",{className:"text-sm text-red-700",children:"é«˜å„ªå…ˆåº¦"})]}),R.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-yellow-600 mb-1",children:J.length}),R.jsx("div",{className:"text-sm text-yellow-700",children:"ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥"})]}),R.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[R.jsx("div",{className:"text-2xl font-bold text-green-600 mb-1",children:i.length}),R.jsx("div",{className:"text-sm text-green-700",children:"ç™»éŒ²ãƒãƒ¼ãƒ æ•°"})]})]})]}),R.jsxs("div",{className:"bg-white rounded-xl shadow-sm mb-8",children:[R.jsx("div",{className:"border-b border-gray-200",children:R.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:[R.jsxs("button",{onClick:()=>c("system"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("system"===o?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"system-tab",children:[R.jsx(ke,{className:"w-4 h-4"}),R.jsx("span",{children:"ã‚·ã‚¹ãƒ†ãƒ "})]}),R.jsxs("button",{onClick:()=>c("users"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("users"===o?"border-green-500 text-green-600 bg-green-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"users-tab",children:[R.jsx(rr,{className:"w-4 h-4"}),R.jsx("span",{children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†"})]}),R.jsxs("button",{onClick:()=>c("organization"),className:"py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors "+("organization"===o?"border-orange-500 text-orange-600 bg-orange-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),"data-tutorial":"organization-tab",children:[R.jsx(De,{className:"w-4 h-4"}),R.jsx("span",{children:"çµ„ç¹”ç®¡ç†"})]})]})}),("system"===o||"users"===o||"organization"===o)&&R.jsx("div",{className:"border-b border-gray-100 bg-gray-50",children:R.jsxs("nav",{className:"flex px-6 overflow-x-auto",children:["system"===o&&R.jsxs(R.Fragment,{children:[R.jsxs("button",{onClick:()=>m("overview"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("overview"===x?"border-blue-500 text-blue-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(ke,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"æ¦‚è¦"})]}),R.jsxs("button",{onClick:()=>m("nutrition-dev"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("nutrition-dev"===x?"border-blue-500 text-blue-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(bt,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"æ „é¤ŠDev"})]})]}),"users"===o&&R.jsxs(R.Fragment,{children:[R.jsxs("button",{onClick:()=>g("invite"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("invite"===u?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(Qt,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"æ‹›å¾…"})]}),R.jsxs("button",{onClick:()=>g("manage"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("manage"===u?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(Gt,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"ç®¡ç†"})]}),R.jsxs("button",{onClick:()=>g("inbody"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("inbody"===u?"border-green-500 text-green-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(Qe,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"InBody(CSV)"})]})]}),"organization"===o&&R.jsxs(R.Fragment,{children:[R.jsxs("button",{onClick:()=>y("overview"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap "+("overview"===p?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(ft,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"æ¦‚è¦"})]}),R.jsxs("button",{onClick:()=>y("list"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("list"===p?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(De,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"çµ„ç¹”ä¸€è¦§"})]}),R.jsxs("button",{onClick:()=>y("members"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("members"===p?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(zt,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"ãƒ¡ãƒ³ãƒãƒ¼"})]}),R.jsxs("button",{onClick:()=>y("settings"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("settings"===p?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(Ft,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"è¨­å®š"})]}),R.jsxs("button",{onClick:()=>y("subscription"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("subscription"===p?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(Ue,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³"})]}),R.jsxs("button",{onClick:()=>y("transfers"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("transfers"===p?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(Gt,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"é¸æ‰‹ç§»ç±"})]}),R.jsxs("button",{onClick:()=>y("team-access"),className:"py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap "+("team-access"===p?"border-orange-500 text-orange-700":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"),children:[R.jsx(tr,{className:"w-3.5 h-3.5"}),R.jsx("span",{children:"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹"})]})]})]})}),R.jsx("div",{className:"p-6",children:"system"===o?R.jsx("div",{className:"space-y-6",children:"overview"===x?R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–"}),R.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:R.jsx("p",{className:"text-gray-600 text-center",children:"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ACWRãƒ‡ãƒ¼ã‚¿ã‚’ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚ ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ãŸå ´åˆã¯å³åº§ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚"})})]}):"nutrition-dev"===x?R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"æ „é¤Šã‚µãƒãƒ¼ãƒˆï¼ˆDevï¼‰"}),R.jsx("p",{className:"text-sm text-gray-600",children:"éå…¬é–‹ã®é–‹ç™ºç”¨ç”»é¢ã§ã™ï¼ˆä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ã›ãªã„æƒ³å®šï¼‰ã€‚"})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsx(tl,{}),R.jsx(el,{})]}),R.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 space-y-3",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"ãƒ†ã‚¹ãƒˆå¯¾è±¡ user_id"}),R.jsx("p",{className:"text-xs text-gray-500",children:"æ¸¬å®šãƒ‡ãƒ¼ã‚¿ï¼ˆinbody_recordsï¼‰ãŒå…¥ã£ã¦ã„ã‚‹é¸æ‰‹ã® user_id ã‚’è²¼ã£ã¦ãã ã•ã„"})]}),f.length>0&&R.jsxs("select",{value:h,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white",children:[R.jsx("option",{value:"",children:"ï¼ˆInBodyã‚ã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠï¼‰"}),f.map(e=>R.jsxs("option",{value:e.user_id,children:[e.name," â€” ",e.user_id.slice(0,8),"â€¦"]},e.user_id))]}),R.jsx("input",{value:h,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"ä¾‹: f7f3aea1-764f-4013-b51d-c7bca2ed6d20"}),R.jsx("button",{onClick:async()=>{var e;try{if(!h)return void alert("user_id ã‚’å…¥ã‚Œã¦ãã ã•ã„");const{data:t}=await q.auth.getSession(),r=null==(e=t.session)?void 0:e.access_token;if(!r)return void alert("ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå–å¾—ã§ãã¾ã›ã‚“ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ï¼Ÿï¼‰");const a=await fetch("https://cymnqmbdwaveccoooics.supabase.co/functions/v1/calculate-metabolism",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({user_id:h,activity_level:"medium"})}),s=await a.json();if(console.log("ğŸ§ª calculate-metabolism result:",s),!a.ok)return void alert(`å¤±æ•—: ${a.status}\n`+JSON.stringify(s,null,2));alert(JSON.stringify(s,null,2))}catch(t){console.error(t),alert("ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼ˆconsoleã‚’ç¢ºèªï¼‰")}},disabled:!h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"ğŸ§ª ä»£è¬è¨ˆç®— Edge Function ãƒ†ã‚¹ãƒˆ"}),R.jsx("p",{className:"text-xs text-gray-500",children:"â€» console / alert ã«çµæœã‚’è¡¨ç¤ºã—ã¾ã™"})]})]}):null}):"users"===o?R.jsx("div",{children:"invite"===u?R.jsxs("div",{children:[R.jsx("div",{className:"border-b border-gray-200 mb-6",children:R.jsxs("nav",{className:"flex space-x-8",children:[R.jsx("button",{onClick:()=>k("single"),className:"py-3 px-1 border-b-2 font-medium text-sm "+("single"===N?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"å€‹åˆ¥æ‹›å¾…"}),R.jsx("button",{onClick:()=>k("bulk"),className:"py-3 px-1 border-b-2 font-medium text-sm "+("bulk"===N?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"ä¸€æ‹¬æ‹›å¾… (CSV)"})]})}),"single"===N?R.jsx("div",{"data-tutorial":"single-invite",children:R.jsx(Jn,{teams:i,onUserInvited:()=>{}})}):R.jsx("div",{"data-tutorial":"bulk-invite",children:R.jsx(Yn,{teams:i,onUsersInvited:()=>{}})})]}):"manage"===u?R.jsx("div",{"data-tutorial":"user-list",children:R.jsx(Xn,{teams:i})}):"inbody"===u?R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"InBody ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿"}),R.jsx("p",{className:"text-sm text-gray-600",children:"CSVã‹ã‚‰ inbody_records ã« upsert ã—ã¾ã™ï¼ˆphone_number + measured_at ã§é‡è¤‡æ›´æ–°ï¼‰ã€‚"})]}),R.jsx($l,{})]}):null}):"organization"===o?R.jsx("div",{children:"overview"===p?_&&V?R.jsx(ol,{organizationId:_,organizationName:V.name}):R.jsxs("div",{className:"text-center py-12",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"çµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),R.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]}):"list"===p?R.jsx(rl,{userId:e.id}):"members"===p?R.jsx("div",{children:_&&V?R.jsx(Cl,{organizationId:_,organizationName:V.name}):R.jsxs("div",{className:"text-center py-12",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç®¡ç†ã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),R.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"settings"===p?R.jsx("div",{children:_?R.jsx(bl,{organizationId:_}):R.jsxs("div",{className:"text-center py-12",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"è¨­å®šã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),R.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"subscription"===p?R.jsx("div",{children:_?R.jsx(ul,{organizationId:_,organizationName:"ãƒ‡ãƒ¢çµ„ç¹”"}):R.jsxs("div",{className:"text-center py-12",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),R.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"transfers"===p?R.jsx("div",{children:_?R.jsx(kl,{userId:e.id,organizationId:_,isAdmin:Kn(e.role)}):R.jsxs("div",{className:"text-center py-12",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"é¸æ‰‹ç§»ç±ç®¡ç†ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),R.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):"team-access"===p?R.jsx("div",{children:_?R.jsx(wl,{userId:e.id,organizationId:_,isAdmin:Kn(e.role)}):R.jsxs("div",{className:"text-center py-12",children:[R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"ãƒãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãšçµ„ç¹”ã‚’é¸æŠã—ã¦ãã ã•ã„"}),R.jsx("button",{onClick:()=>y("list"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"çµ„ç¹”ä¸€è¦§ã¸"})]})}):null}):null})]})]})}),R.jsx(Ir,{steps:aa("global_admin"),isActive:F,onComplete:P,onSkip:O,currentStepIndex:W,onStepChange:B})]})}function ql(e,t={}){const a=t.enabled??!0,s=t.pollMs??0,n=t.pauseWhenHidden??!0,l=r.useRef(!0);r.useEffect(()=>(l.current=!0,()=>{l.current=!1}),[e]);const[i,d]=r.useState([]),[o,c]=r.useState([]),[x,m]=r.useState(!0),[u,g]=r.useState(null),{state:h,registerPollJob:b}=ce(),p=r.useMemo(()=>{var e,t;return(null==(t=null==(e=globalThis.crypto)?void 0:e.randomUUID)?void 0:t.call(e))??Math.random().toString(36).slice(2)},[]),y=r.useRef(null),f=r.useRef(null),j=r.useRef(!1),v=r.useRef(!1),w=r.useCallback(()=>{var e;const t=y.current;if(t){try{null==(e=t.unsubscribe)||e.call(t)}catch(r){}try{q.removeChannel(t)}catch(r){}y.current=null}},[]),N=r.useCallback(()=>{f.current&&(f.current(),f.current=null)},[]),k=r.useCallback(async()=>{const{data:e,error:t}=await q.from("badges").select("*").order("sort_order");if(t)throw t;l.current&&d(e??[])},[]),_=r.useCallback(async()=>{if(e&&a&&!v.current){v.current=!0;try{const{data:t,error:r}=await q.from("user_badges").select("*, badge:badges(*)").eq("user_id",e).order("earned_at",{ascending:!1});if(r)throw r;if(!l.current)return;c(t??[]),g(null)}catch(t){if(!l.current)return;g((null==t?void 0:t.message)??"ãƒãƒƒã‚¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{v.current=!1}}},[e,a]),C=r.useCallback(()=>(o??[]).filter(e=>{if("boolean"==typeof(null==e?void 0:e.is_new))return!0===e.is_new;const t=null==e?void 0:e.viewed_at,r=(null==e?void 0:e.is_viewed)??(null==e?void 0:e.viewed)??!1;return!t&&!r}),[o]),S=r.useCallback(()=>{const e=(o??[]).length,t=(i??[]).length;return{earned:e,total:t,percentage:t>0?Math.round(e/t*100):0}},[o,i]),D=r.useCallback(async e=>{if(!e)return;if(!(await q.from("user_badges").update({is_new:!1}).eq("id",e)).error)return c(t=>(t??[]).map(t=>(null==t?void 0:t.id)===e?{...t,is_new:!1}:t)),void(await _());if(!(await q.from("user_badges").update({viewed_at:(new Date).toISOString()}).eq("id",e)).error)return void(await _());if(!(await q.from("user_badges").update({is_viewed:!0}).eq("id",e)).error)return void(await _());const t=await q.from("user_badges").update({viewed:!0}).eq("id",e);if(t.error)throw console.warn("[useBadges] markBadgeAsViewed failed:",t.error),t.error;await _()},[_]);return r.useEffect(()=>{let t=!1;return(async()=>{if(w(),N(),e&&a)try{l.current&&m(!0),j.current||(await k(),j.current=!0),await _()}catch(r){l.current&&g((null==r?void 0:r.message)??"ãƒãƒƒã‚¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{!t&&l.current&&m(!1)}else l.current&&m(!1)})(),()=>{t=!0,w(),N()}},[e,a,k,_,w,N]),r.useEffect(()=>{w()},[e,a,h.canRealtime,_,w,p]),r.useEffect(()=>{N();if(!(!!e&&a&&s>0&&!0))return;const t=b({key:`badges:${e}:${p}`,intervalMs:s,run:async()=>{await _()},enabled:!0,requireVisible:n,requireOnline:!0,immediate:!1});return f.current=t,()=>N()},[e,a,s,n,h.canRealtime,b,_,N,p]),{allBadges:i,userBadges:o,loading:x,error:u,getNewBadges:C,getBadgeProgress:S,markBadgeAsViewed:D,refresh:async()=>{await Promise.all([k(),_()])}}}const Fl=(null==dr?void 0:dr.default)??dr;function Il({badge:e,onClose:t}){r.useEffect(()=>{"function"==typeof Fl&&Fl({particleCount:100,spread:70,origin:{y:.6}})},[null==e?void 0:e.id]);const a=r.useCallback(()=>{t()},[t]);return r.useEffect(()=>{const e=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a]),R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:a,role:"dialog","aria-modal":"true",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl relative",onClick:e=>e.stopPropagation(),children:[R.jsx("button",{onClick:a,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"é–‰ã˜ã‚‹",children:R.jsx(sr,{className:"w-6 h-6"})}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"w-20 h-20 bg-yellow-100 dark:bg-yellow-900/20 rounded-full flex items-center justify-center mx-auto mb-6",children:R.jsx(we,{className:"w-10 h-10 text-yellow-600 dark:text-yellow-400"})}),R.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"æ–°ã—ã„ãƒãƒƒã‚¸ç²å¾—ï¼"}),R.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[R.jsx(Pt,{className:"w-5 h-5 text-yellow-500"}),R.jsx("span",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:e.name}),R.jsx(Pt,{className:"w-5 h-5 text-yellow-500"})]}),R.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:e.description}),R.jsx("button",{onClick:a,className:"bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors",children:"ã‚„ã£ãŸï¼"})]})]})})}function Ll({userId:e}){const{userBadges:t,markBadgeAsViewed:a}=ql(e),[s,n]=r.useState(null),l=r.useRef(new Set),i=r.useMemo(()=>{const e=(t??[]).filter(e=>e.is_new),r={"ãƒ–ãƒ­ãƒ³ã‚ºåˆ°é”":10,"ã‚·ãƒ«ãƒãƒ¼åˆ°é”":20,"ã‚´ãƒ¼ãƒ«ãƒ‰åˆ°é”":30,"ãƒ—ãƒ©ãƒãƒŠåˆ°é”":40,"ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰åˆ°é”":50,"ãƒã‚¹ã‚¿ãƒ¼åˆ°é”":60};return[...e].sort((e,t)=>{var a,s;const n=new Date(e.earned_at).getTime(),l=new Date(t.earned_at).getTime();if(n!==l)return n-l;const i=(null==(a=e.badge)?void 0:a.name)??"",d=(null==(s=t.badge)?void 0:s.name)??"",o=r[i]??999,c=r[d]??999;return o!==c?o-c:i.localeCompare(d,"ja")})},[t]);r.useEffect(()=>{if(s)return;const e=i.find(e=>!l.current.has(e.id));e&&(l.current.add(e.id),n(e.id))},[i,s]);const d=(t??[]).find(e=>e.id===s)||null;return(null==d?void 0:d.badge)?R.jsx(Il,{badge:d.badge,onClose:async()=>{s&&await a(s),n(null)}}):null}function Pl({onDone:e}){const[t,r]=m.useState(!1),[a,s]=m.useState(null),n=new URL(window.location.href),l=function(e){return e?e.startsWith("http://")||e.startsWith("https://")?"/":e.startsWith("/")?e:"/":"/"}(n.searchParams.get("next")),i=n.searchParams.get("verify"),d=i?function(e){try{return decodeURIComponent(e)}catch{return e}}(i):null,o=n.searchParams.get("code"),c=window.location.hash,x=c?new URLSearchParams(c.replace("#","")):null,u=null==x?void 0:x.get("type"),g=null==x?void 0:x.get("access_token"),h=null==x?void 0:x.get("refresh_token"),b=m.useMemo(()=>d?"ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¾ã§èªè¨¼ãƒªãƒ³ã‚¯ã‚’é–‹ã‹ãªã„ãŸã‚ã€ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯å…ˆèª­ã¿å¯¾ç­–ã«ãªã‚Šã¾ã™ã€‚":o?"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã ã‘èªè¨¼ã‚’å®Œäº†ã—ã¾ã™ã€‚":"recovery"===u?"ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºå®šã—ã¾ã™ã€‚":"ãƒªãƒ³ã‚¯ãŒå¤±åŠ¹ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",[d,o,u]);return R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-6",children:R.jsxs("div",{className:"bg-white rounded-xl shadow p-6 max-w-md w-full space-y-4",children:[R.jsx("h1",{className:"text-lg font-bold",children:"ãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Œäº†ã—ã¾ã™"}),R.jsx("p",{className:"text-sm text-gray-600",children:b}),a&&R.jsx("p",{className:"text-sm text-red-600",children:a}),R.jsx("button",{onClick:async()=>{s(null),r(!0);try{if(d)return void(window.location.href=d);if(o){const{error:e}=await q.auth.exchangeCodeForSession(o);if(e)throw e;return window.history.replaceState({},document.title,n.pathname),void(window.location.href=l)}if("recovery"===u&&g&&h){const{error:e}=await q.auth.setSession({access_token:g,refresh_token:h});if(e)throw e;return window.history.replaceState({},document.title,n.pathname+n.search),void(window.location.href=l)}throw new Error("èªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆãƒªãƒ³ã‚¯ãŒä¸æ­£ã€ã¾ãŸã¯å…ˆèª­ã¿ã§å¤±åŠ¹ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰")}catch(e){console.error("[AuthCallback] failed:",e),s((null==e?void 0:e.message)??"èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{r(!1)}},disabled:t,className:"w-full bg-blue-600 text-white rounded-lg py-2 disabled:opacity-50",children:t?"å‡¦ç†ä¸­â€¦":"èªè¨¼ã‚’ç¢ºå®šã™ã‚‹"}),R.jsx("button",{type:"button",onClick:()=>window.location.href="/invite-expired",className:"w-full text-sm text-gray-600 underline",children:"æ‹›å¾…ãƒªãƒ³ã‚¯åˆ‡ã‚Œï¼ˆå†é€ï¼‰ã¸"}),R.jsx("button",{type:"button",onClick:()=>{window.history.replaceState({},"","/"),e()},className:"w-full text-sm text-gray-500 underline",children:"ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹"})]})})}function Ol(e){return e.trim().toLowerCase()}function Wl(){const[e,t]=r.useState(""),[a,s]=r.useState("idle"),[n,l]=r.useState(""),i=r.useMemo(()=>{const t=Ol(e);return t.includes("@")&&t.includes(".")&&"sending"!==a},[e,a]);return R.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:R.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[R.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:R.jsxs("div",{className:"flex items-start space-x-3",children:[R.jsx("div",{className:"mt-1",children:R.jsx(fe,{className:"w-6 h-6 text-amber-500"})}),R.jsxs("div",{children:[R.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"æ‹›å¾…ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸ"}),R.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šï¼ˆ= æ–°ã—ã„ãƒ­ã‚°ã‚¤ãƒ³æ‰‹æ®µï¼‰ã‚’ç™ºè¡Œã§ãã¾ã™ã€‚"})]})]})}),R.jsxs("div",{className:"p-6 space-y-4",children:[R.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 text-sm text-amber-900 dark:text-amber-200",children:[R.jsx("p",{className:"font-medium mb-1",children:"ã“ã†ã„ã†æ™‚ã®æ•‘æ¸ˆãƒ«ãƒ¼ãƒˆã§ã™"}),R.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[R.jsx("li",{children:"æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ãŒåˆ‡ã‚Œã¦ã—ã¾ã£ãŸ"}),R.jsx("li",{children:"ä¼šç¤¾ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã§ãƒªãƒ³ã‚¯ãŒå…ˆèª­ã¿ã•ã‚Œã¦ç„¡åŠ¹ã«ãªã£ãŸ"}),R.jsx("li",{children:"æ™‚é–“ãŒçµŒã£ã¦ã—ã¾ã£ãŸ"})]})]}),R.jsxs("label",{className:"block",children:[R.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),R.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[R.jsxs("div",{className:"relative flex-1",children:[R.jsx(gt,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),R.jsx("input",{value:e,onChange:e=>t(e.target.value),placeholder:"ä¾‹ï¼‰tanaka@example.com",className:"w-full pl-10 pr-3 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900\n                             text-gray-900 dark:text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",type:"email",autoComplete:"email"})]}),R.jsx("button",{onClick:async()=>{const t=Ol(e);if(t){s("sending"),l("");try{const{data:e,error:r}=await q.functions.invoke("request-password-reset",{body:{email:t,redirectUrl:`${window.location.origin}/reset-password`}});if(r)return console.error("[InviteExpired] request-password-reset error:",r),s("error"),void l("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");console.log("[InviteExpired] request-password-reset result:",e),s("success"),l("å†è¨­å®šãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚å—ä¿¡ç®±ã‚’ã”ç¢ºèªãã ã•ã„ã€‚è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚")}catch(r){console.error("[InviteExpired] exception:",r),s("error"),l((null==r?void 0:r.message)||"é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}}},disabled:!i,className:"px-4 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium\n                           disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",type:"button",children:"sending"===a?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),R.jsx("span",{children:"é€ä¿¡ä¸­"})]}):R.jsxs(R.Fragment,{children:[R.jsx(_t,{className:"w-4 h-4"}),R.jsx("span",{children:"å†é€"})]})})]})]}),n&&R.jsx("div",{className:"rounded-lg p-3 text-sm border "+("success"===a?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200":"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200"),children:R.jsxs("div",{className:"flex items-start space-x-2",children:["success"===a?R.jsx(Te,{className:"w-4 h-4 mt-0.5"}):R.jsx(fe,{className:"w-4 h-4 mt-0.5"}),R.jsx("p",{children:n})]})}),R.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[R.jsx("p",{children:"â€¢ ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆã¯ã€Œè¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã€ã€Œãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚"}),R.jsx("p",{children:"â€¢ ãã‚Œã§ã‚‚å±Šã‹ãªã„å ´åˆã€æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"})]}),R.jsx("div",{className:"pt-2",children:R.jsxs("button",{type:"button",onClick:()=>{window.history.replaceState({},"","/"),window.location.reload()},className:"text-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white flex items-center space-x-2",children:[R.jsx(je,{className:"w-4 h-4"}),R.jsx("span",{children:"ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹"})]})})]})]})})}function Bl({count:e,hasHighPriority:t=!1,onClick:r,className:a=""}){return 0===e?R.jsx("button",{onClick:r,className:`\n          relative p-2 text-gray-400 dark:text-gray-500 \n          hover:text-gray-600 dark:hover:text-gray-300 \n          transition-colors ${a}\n        `,children:R.jsx(Ce,{className:"w-6 h-6"})}):R.jsxs("button",{onClick:r,className:`\n        relative p-2 transition-colors ${t?"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300":"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300"} ${a}\n      `,children:[t?R.jsx(fe,{className:"w-6 h-6 animate-pulse"}):R.jsx(Ce,{className:"w-6 h-6"}),R.jsx("span",{className:`\n        absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white \n        transform translate-x-1/2 -translate-y-1/2 rounded-full min-w-[20px] h-5 ${t?"bg-red-600 dark:bg-red-500 animate-pulse":"bg-blue-600 dark:bg-blue-500"}\n      `,children:e>99?"99+":e})]})}function Ul({effectiveRole:e,userProfile:t,alertsLoading:r,unreadCount:a,hasHighPriorityAlerts:s,onOpenAlertPanel:n,onLogout:l,onHome:i,onNavigateToPrivacy:d,onNavigateToTerms:o,onNavigateToCommercial:c,onNavigateToHelp:x}){const[u,g]=m.useState(!1);if("athlete"===e)return null;const h=()=>g(!1);return R.jsxs(R.Fragment,{children:[R.jsx("nav",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 relative z-40 transition-colors",children:R.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:R.jsxs("div",{className:"flex justify-between items-center h-16",children:[R.jsx("div",{className:"flex items-center",children:R.jsxs("button",{type:"button",onClick:()=>{i(),h()},className:"flex items-baseline space-x-2 transition-colors active:opacity-70 cursor-pointer",style:{WebkitTapHighlightColor:"transparent"},children:[R.jsx("span",{className:"text-xl font-bold tracking-tight text-gray-900 dark:text-white",style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"-0.02em"},children:"Bekuta"}),R.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 hidden sm:inline",style:{letterSpacing:"0.05em"},children:"by ARCA"})]})}),R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300 hidden md:block transition-colors",children:[t.name,"ã•ã‚“"]}),!r&&R.jsx(Bl,{count:a,hasHighPriority:s,onClick:n,className:"touch-target"}),R.jsxs("button",{onClick:l,className:"hidden md:flex bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600\n                  text-gray-700 dark:text-gray-200 px-3 py-2 rounded-lg\n                  border border-gray-300 dark:border-gray-600\n                  transition-colors items-center space-x-2 text-sm",type:"button",children:[R.jsx(ut,{className:"w-4 h-4"}),R.jsx("span",{children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]}),R.jsx("button",{onClick:()=>g(e=>!e),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",type:"button","aria-label":"ãƒ¡ãƒ‹ãƒ¥ãƒ¼",children:u?R.jsx(sr,{className:"w-6 h-6"}):R.jsx(ht,{className:"w-6 h-6"})})]})]})})}),u&&R.jsx("div",{className:"md:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg transition-colors relative z-40",children:R.jsxs("div",{className:"px-4 py-3 space-y-2",children:[R.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-gray-200 dark:border-gray-700",children:[R.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:R.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-semibold text-sm",children:(t.name||"U").charAt(0)})}),R.jsxs("div",{className:"min-w-0",children:[R.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:[t.name,"ã•ã‚“"]}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t.email})]})]}),x&&R.jsxs("button",{onClick:()=>{h(),x()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[R.jsx(st,{className:"w-5 h-5"}),R.jsx("span",{children:"ãƒ˜ãƒ«ãƒ—ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«"})]}),d&&R.jsxs("button",{onClick:()=>{h(),d()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[R.jsx(qt,{className:"w-5 h-5"}),R.jsx("span",{children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼"})]}),o&&R.jsxs("button",{onClick:()=>{h(),o()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[R.jsx(Qe,{className:"w-5 h-5"}),R.jsx("span",{children:"åˆ©ç”¨è¦ç´„"})]}),c&&R.jsxs("button",{onClick:()=>{h(),c()},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[R.jsx(De,{className:"w-5 h-5"}),R.jsx("span",{children:"ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜"})]}),R.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),R.jsxs("button",{onClick:e=>{h(),l(e)},className:"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",type:"button",children:[R.jsx(ut,{className:"w-5 h-5"}),R.jsx("span",{children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]})]})})]})}function Hl({subtitle:e}){return R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950",children:R.jsxs("div",{className:"text-center px-6",children:[R.jsx("div",{className:"text-4xl font-extrabold tracking-tight text-gray-900 dark:text-white",children:"Bekuta"}),R.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:e??"èª­ã¿è¾¼ã¿ä¸­â€¦"}),R.jsx("div",{className:"mt-6 flex justify-center",children:R.jsx("div",{className:"h-6 w-6 rounded-full border-2 border-gray-300 dark:border-gray-700 border-t-transparent animate-spin"})})]})})}function Vl({loading:e,ready:t,onRetry:a,children:s,timeoutMs:n=12e3}){const[l,i]=r.useState(!1);return r.useEffect(()=>{if(!e)return void i(!1);const t=setTimeout(()=>i(!0),n);return()=>clearTimeout(t)},[e,n]),t?R.jsx(R.Fragment,{children:s}):l?R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950",children:R.jsxs("div",{className:"max-w-md w-full p-6 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900",children:[R.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Bekuta"}),R.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:"æ¥ç¶šãŒé•·å¼•ã„ã¦ã„ã¾ã™ã€‚é€šä¿¡çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã€å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"}),R.jsxs("div",{className:"mt-5 flex gap-2",children:[R.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg bg-gray-900 text-white dark:bg-white dark:text-gray-900 text-sm font-semibold",onClick:a,children:"å†è©¦è¡Œ"}),R.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 text-sm",onClick:async()=>{await q.auth.signOut(),window.location.href="/"},children:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"})]})]})}):R.jsx(Hl,{subtitle:"ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚’æº–å‚™ã—ã¦ã„ã¾ã™â€¦"})}function Kl({title:e="ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­",message:t="ç¾åœ¨ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šåŒ–å¯¾å¿œã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ã”ä¸ä¾¿ã‚’ãŠã‹ã‘ã—ã¾ã™ãŒã€ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",etaText:a="",showRetry:s=!0}){const n=r.useMemo(()=>function(){const e=new Date,t=e=>String(e).padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}`}(),[]);return R.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50 text-slate-900",children:[R.jsxs("div",{className:"pointer-events-none fixed inset-0 overflow-hidden",children:[R.jsx("div",{className:"absolute -top-24 -right-24 h-80 w-80 rounded-full bg-blue-200/35 blur-3xl"}),R.jsx("div",{className:"absolute -bottom-28 -left-28 h-96 w-96 rounded-full bg-emerald-200/30 blur-3xl"}),R.jsx("div",{className:"absolute top-1/3 left-1/2 h-72 w-72 -translate-x-1/2 rounded-full bg-violet-200/20 blur-3xl"})]}),R.jsxs("div",{className:"relative mx-auto max-w-2xl px-5 py-10",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx("div",{className:"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center",children:R.jsx(It,{className:"h-5 w-5 text-slate-700"})}),R.jsxs("div",{children:[R.jsxs("div",{className:"text-xl font-extrabold tracking-tight",children:["Bekuta",R.jsx("span",{className:"ml-2 text-xs font-semibold text-slate-500 align-middle",children:"maintenance"})]}),R.jsx("div",{className:"text-sm text-slate-500",children:"strength for the future"})]})]}),R.jsxs("div",{className:"text-xs text-slate-400",children:["JST ",n]})]}),R.jsxs("div",{className:"mt-8 rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden",children:[R.jsxs("div",{className:"border-b border-slate-100 px-6 py-5 flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700",children:[R.jsx($t,{className:"h-4 w-4 text-rose-500"}),e]}),R.jsx("div",{className:"text-xs text-slate-400",children:"System Status"})]}),R.jsxs("div",{className:"px-6 py-6",children:[R.jsxs("div",{className:"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-5",children:[R.jsx("p",{className:"text-slate-700 leading-relaxed",children:t}),a?R.jsxs("div",{className:"mt-3 text-sm text-slate-600",children:[R.jsx("span",{className:"font-semibold",children:"ç›®å®‰ï¼š"}),a]}):null,R.jsx("div",{className:"mt-4 text-xs text-slate-500 leading-relaxed",children:"â€» ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®åœæ­¢ãƒ»DBè² è·ã®è»½æ¸›ã®ãŸã‚ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”»é¢ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚"})]}),R.jsxs("div",{className:"mt-5 flex flex-col sm:flex-row gap-3",children:[s&&R.jsxs("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center justify-center gap-2 rounded-2xl bg-slate-900 text-white px-5 py-3 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition",children:[R.jsx(_t,{className:"h-4 w-4"}),"å†èª­ã¿è¾¼ã¿"]}),R.jsxs("a",{href:"https://bekuta.netlify.app/",className:"inline-flex items-center justify-center gap-2 rounded-2xl bg-white ring-1 ring-slate-200 px-5 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition",children:[R.jsx(Je,{className:"h-4 w-4"}),"ãƒˆãƒƒãƒ—ã¸"]})]}),R.jsx("div",{className:"mt-6 text-center text-xs text-slate-400",children:"â€œSmall steps, big futures.â€ â€” Bekuta"})]})]}),R.jsx("div",{className:"mt-8 text-center text-xs text-slate-400",children:"ãŠæ€¥ãã®å ´åˆã¯ã€ã‚¹ã‚¿ãƒƒãƒ•ã¸ã”é€£çµ¡ãã ã•ã„ã€‚"})]})]})}function Jl({onAccept:e,onDecline:t}){const[a,s]=r.useState(!1),[n,l]=r.useState(!1),[i,d]=r.useState(null),[o,c]=r.useState(!1),x=a&&n&&null!==i;return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[R.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx(qt,{className:"w-8 h-8"}),R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-bold",children:"Bekuta ã¸ã‚ˆã†ã“ã"}),R.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"ã”åˆ©ç”¨å‰ã«å¿…ãšãŠèª­ã¿ãã ã•ã„"})]})]})}),R.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:R.jsxs("div",{className:"space-y-6",children:[R.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-4 rounded",children:R.jsxs("div",{className:"flex items-start",children:[R.jsx(ye,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 mr-3 mt-0.5 flex-shrink-0"}),R.jsxs("div",{className:"text-sm space-y-2",children:[R.jsx("p",{className:"font-bold text-orange-900 dark:text-orange-200",children:"æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã®é‡è¦ãªãŠçŸ¥ã‚‰ã›"}),R.jsxs("ul",{className:"space-y-1 text-orange-800 dark:text-orange-300",children:[R.jsx("li",{children:"â€¢ å½“ã‚µãƒ¼ãƒ“ã‚¹ã¯åŒ»ç™‚æ©Ÿå™¨ã§ã¯ãªãã€è¨ºæ–­ãƒ»æ²»ç™‚ã‚’ç›®çš„ã¨ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“"}),R.jsx("li",{children:"â€¢ æ€ªæˆ‘ã®äºˆé˜²ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“"}),R.jsx("li",{children:"â€¢ ACWRã¯å‚è€ƒå€¤ã§ã‚ã‚Šã€æœ€çµ‚åˆ¤æ–­ã¯æœ¬äººãƒ»æŒ‡å°è€…ãƒ»åŒ»ç™‚å°‚é–€å®¶ãŒè¡Œã„ã¾ã™"}),R.jsx("li",{children:"â€¢ ã‚¹ãƒãƒ¼ãƒ„æ´»å‹•ã«ã¯å›ºæœ‰ã®ãƒªã‚¹ã‚¯ãŒä¼´ã„ã¾ã™"})]})]})]})}),R.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-5",children:[R.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white mb-3 flex items-center",children:[R.jsx(Qe,{className:"w-5 h-5 mr-2 text-purple-600 dark:text-purple-400"}),"å¹´é½¢ç¢ºèª"]}),R.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-4",children:"ã‚ãªãŸã¯18æ­³ä»¥ä¸Šã§ã™ã‹ï¼Ÿ"}),R.jsxs("div",{className:"flex space-x-4",children:[R.jsxs("button",{onClick:()=>d(!1),className:"flex-1 py-3 px-4 rounded-lg border-2 transition-all "+(!1===i?"border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"border-gray-300 dark:border-gray-600 hover:border-green-400"),children:[R.jsx(Te,{className:"w-5 h-5 mx-auto mb-1 "+(!1===i?"text-green-500":"text-gray-400")}),R.jsx("span",{className:"text-sm font-medium",children:"18æ­³ä»¥ä¸Šã§ã™"})]}),R.jsxs("button",{onClick:()=>d(!0),className:"flex-1 py-3 px-4 rounded-lg border-2 transition-all "+(!0===i?"border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":"border-gray-300 dark:border-gray-600 hover:border-yellow-400"),children:[R.jsx(ye,{className:"w-5 h-5 mx-auto mb-1 "+(!0===i?"text-yellow-500":"text-gray-400")}),R.jsx("span",{className:"text-sm font-medium",children:"18æ­³æœªæº€ã§ã™"})]})]}),null!==i&&i&&R.jsxs("div",{className:"mt-4 bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600 rounded-lg p-4",children:[R.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 font-medium mb-2",children:"ä¿è­·è€…ã®åŒæ„ãŒå¿…è¦ã§ã™"}),R.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mb-3",children:"18æ­³æœªæº€ã®æ–¹ã¯ã€ä¿è­·è€…ã®æ–¹ã¨ä¸€ç·’ã«ã“ã®ç”»é¢ã‚’ã”ç¢ºèªã„ãŸã ãã€ ä¿è­·è€…ã®æ–¹ã®åŒæ„ã‚’å¾—ãŸä¸Šã§ã”åˆ©ç”¨ãã ã•ã„ã€‚"}),R.jsx("div",{className:"bg-white dark:bg-yellow-800/20 rounded-lg p-3 text-xs text-yellow-900 dark:text-yellow-100",children:"ä¿è­·è€…ã®æ–¹ãŒã„ãªã„å ´åˆã¯ã€ã€ŒåŒæ„ã—ãªã„ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ å¾Œã»ã©ä¿è­·è€…ã®æ–¹ã¨ä¸€ç·’ã«å†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚"})]})]}),R.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800",children:R.jsxs("label",{className:"flex items-start cursor-pointer group",children:[R.jsxs("div",{className:"relative flex-shrink-0",children:[R.jsx("input",{type:"checkbox",checked:a,onChange:e=>s(e.target.checked),className:"sr-only peer"}),R.jsx("div",{className:`\n                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center\n                    ${a?"bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500"}\n                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800\n                  `,children:a&&R.jsx(Te,{className:"w-4 h-4 text-white",strokeWidth:3})})]}),R.jsxs("div",{className:"ml-4 flex-1",children:[R.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¾ã™"}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:R.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",onClick:e=>e.stopPropagation(),children:"åˆ©ç”¨è¦ç´„ã‚’ç¢ºèªã™ã‚‹ â†’"})})]})]})}),R.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800",children:R.jsxs("label",{className:"flex items-start cursor-pointer group",children:[R.jsxs("div",{className:"relative flex-shrink-0",children:[R.jsx("input",{type:"checkbox",checked:n,onChange:e=>l(e.target.checked),className:"sr-only peer"}),R.jsx("div",{className:`\n                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center\n                    ${n?"bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500"}\n                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800\n                  `,children:n&&R.jsx(Te,{className:"w-4 h-4 text-white",strokeWidth:3})})]}),R.jsxs("div",{className:"ml-4 flex-1",children:[R.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã—ã¾ã™"}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:R.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",onClick:e=>e.stopPropagation(),children:"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèªã™ã‚‹ â†’"})})]})]})}),R.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[R.jsx("h4",{className:"text-sm font-bold text-gray-900 dark:text-white mb-2",children:"åé›†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦"}),R.jsxs("ul",{className:"text-xs text-gray-700 dark:text-gray-300 space-y-1",children:[R.jsx("li",{children:"â€¢ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ï¼ˆRPEã€æ™‚é–“ã€è² è·ï¼‰"}),R.jsx("li",{children:"â€¢ ä½“é‡è¨˜éŒ²ï¼ˆãƒ¡ãƒ¢ã¯æœ¬äººã®ã¿é–²è¦§å¯èƒ½ï¼‰"}),R.jsx("li",{children:"â€¢ æ‰€å±ãƒãƒ¼ãƒ ã®ã‚¹ã‚¿ãƒƒãƒ•ã¯ã‚ãªãŸã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ã§ãã¾ã™"}),R.jsx("li",{children:"â€¢ ãƒ‡ãƒ¼ã‚¿ã¯æš—å·åŒ–ã—ã¦å®‰å…¨ã«ä¿ç®¡ã•ã‚Œã¾ã™"})]})]})]})}),R.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700",children:o?R.jsxs("div",{className:"text-center py-8",children:[R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),R.jsx("p",{className:"text-gray-700 dark:text-gray-300 font-medium mb-2",children:"ä¿è­·è€…ã®åŒæ„æ‰¿èªã‚’å¾—ã¦ã‹ã‚‰åˆ©ç”¨ã—ã¦ãã ã•ã„"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚Šã¾ã™..."})]}):R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"flex space-x-3",children:[R.jsx("button",{onClick:async()=>{c(!0),await t()},disabled:o,className:"flex-1 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"åŒæ„ã—ãªã„"}),R.jsx("button",{onClick:()=>{x&&!o&&e()},disabled:!x||o,className:"flex-1 py-3 px-4 rounded-lg font-medium transition-all "+(x&&!o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-500 cursor-not-allowed"),children:i?"ä¿è­·è€…ã®åŒæ„ã‚’å¾—ã¦åˆ©ç”¨é–‹å§‹":"åŒæ„ã—ã¦åˆ©ç”¨é–‹å§‹"})]}),R.jsx("p",{className:"text-xs text-center text-gray-500 dark:text-gray-400 mt-3",children:"åˆ©ç”¨é–‹å§‹å¾Œã‚‚ã„ã¤ã§ã‚‚è¨­å®šã‹ã‚‰ã“ã‚Œã‚‰ã®æ–‡æ›¸ã‚’ç¢ºèªã§ãã¾ã™"})]})})]})})}function Yl({id:e,message:t,type:a="success",duration:s=3e3,onClose:n}){r.useEffect(()=>{const t=setTimeout(()=>{n(e)},s);return()=>clearTimeout(t)},[e,s,n]);return R.jsxs("div",{className:`${(()=>{switch(a){case"success":default:return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"info":return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}})()} border rounded-lg shadow-lg p-4 flex items-center space-x-3 min-w-[300px] max-w-md animate-slide-in-right`,role:"alert",children:[(()=>{switch(a){case"success":default:return R.jsx(Te,{className:"w-5 h-5 text-green-600 dark:text-green-400"});case"error":return R.jsx(ye,{className:"w-5 h-5 text-red-600 dark:text-red-400"});case"info":return R.jsx(lt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}})(),R.jsx("p",{className:"flex-1 text-sm font-medium text-gray-900 dark:text-white",children:t}),R.jsx("button",{onClick:()=>n(e),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:R.jsx(sr,{className:"w-4 h-4"})})]})}function Zl({toasts:e,onClose:t}){return R.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>R.jsx(Yl,{...e,onClose:t},e.id))})}function Gl({onNavigateToPrivacy:e,onNavigateToTerms:t,onNavigateToCommercial:r}){const a=(new Date).getFullYear();return R.jsx("footer",{className:"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto",children:R.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8",children:[R.jsx("div",{className:"md:hidden",children:R.jsxs("div",{className:"text-center space-y-3",children:[R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Â© ",a," æ ªå¼ä¼šç¤¾ARCA. All Rights Reserved."]}),R.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"æ³•çš„æƒ…å ±ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã”è¦§ã„ãŸã ã‘ã¾ã™"})]})}),R.jsxs("div",{className:"hidden md:grid grid-cols-1 md:grid-cols-3 gap-8",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"Bekuta by ARCA"}),R.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 leading-relaxed",children:"ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è² è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚ ACWRã‚’ç”¨ã„ã¦æ€ªæˆ‘ãƒªã‚¹ã‚¯ã‚’å¯è¦–åŒ–ã—ã€ã‚¢ã‚¹ãƒªãƒ¼ãƒˆã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚"}),R.jsxs("div",{className:"mt-4 flex items-center text-xs text-gray-500 dark:text-gray-400",children:[R.jsx(Ql,{className:"w-4 h-4 mr-1"}),R.jsx("span",{children:"åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“"})]})]}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"æ³•çš„æƒ…å ±"}),R.jsxs("ul",{className:"space-y-2",children:[R.jsx("li",{children:R.jsxs("button",{onClick:e,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[R.jsx(qt,{className:"w-4 h-4 mr-2"}),"ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼"]})}),R.jsx("li",{children:R.jsxs("button",{onClick:t,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[R.jsx(Qe,{className:"w-4 h-4 mr-2"}),"åˆ©ç”¨è¦ç´„"]})}),R.jsx("li",{children:R.jsxs("button",{onClick:r,className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[R.jsx(De,{className:"w-4 h-4 mr-2"}),"ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜"]})})]})]}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-3",children:"ãŠå•ã„åˆã‚ã›"}),R.jsxs("div",{className:"space-y-3",children:[R.jsxs("a",{href:"mailto:info@arca.fit",className:"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[R.jsx(gt,{className:"w-4 h-4 mr-2"}),"info@arca.fit"]}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"å–¶æ¥­æ—¥2-3æ—¥ä»¥å†…ã«è¿”ä¿¡ã„ãŸã—ã¾ã™"})]}),R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"é‹å–¶äº‹æ¥­è€…"}),R.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["æ ªå¼ä¼šç¤¾ARCA",R.jsx("br",{}),"ä»£è¡¨å–ç· å½¹ å‰ç”°å……ç¯„"]})]})]})]}),R.jsx("div",{className:"hidden md:block mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:R.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-4 rounded",children:R.jsxs("p",{className:"text-xs text-yellow-800 dark:text-yellow-200 leading-relaxed",children:[R.jsx("strong",{children:"å…è²¬äº‹é …:"})," æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯åŒ»ç™‚æ©Ÿå™¨ã§ã¯ãªãã€è¨ºæ–­ãƒ»æ²»ç™‚ã‚’ç›®çš„ã¨ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ æ€ªæˆ‘ã®äºˆé˜²ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ACWRãã®ä»–ã®æŒ‡æ¨™ã¯å‚è€ƒå€¤ã§ã™ã€‚ æœ€çµ‚çš„ãªåˆ¤æ–­ã¯åˆ©ç”¨è€…æœ¬äººã€æŒ‡å°è€…ã€åŒ»ç™‚å°‚é–€å®¶ãŒè¡Œã£ã¦ãã ã•ã„ã€‚"]})})}),R.jsx("div",{className:"hidden md:block mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:R.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0",children:[R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Â© ",a," æ ªå¼ä¼šç¤¾ARCA. All Rights Reserved."]}),R.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[R.jsx("span",{children:"Version 1.0.0"}),R.jsx("span",{children:"â€¢"}),R.jsx("span",{children:"æ—¥æœ¬æ³•æº–æ‹ "})]})]})}),R.jsx("div",{className:"hidden md:block mt-4",children:R.jsxs("details",{className:"text-xs text-gray-500 dark:text-gray-400",children:[R.jsx("summary",{className:"cursor-pointer hover:text-gray-700 dark:hover:text-gray-300",children:"ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹"}),R.jsxs("div",{className:"mt-2 pl-4 space-y-1",children:[R.jsx("p",{children:"â€¢ React - MIT License"}),R.jsx("p",{children:"â€¢ Recharts - MIT License"}),R.jsx("p",{children:"â€¢ Supabase - Apache License 2.0"}),R.jsx("p",{children:"â€¢ Lucide Icons - ISC License"}),R.jsx("p",{children:"â€¢ Tailwind CSS - MIT License"})]})]})})]})})}function Ql({className:e}){return R.jsx("svg",{className:e,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}function Xl({userId:e}){var t,a;const{state:s,registerPollJob:n}=ce(),[l,i]=r.useState([]),[d,o]=r.useState(!1),[c,x]=r.useState(null),m=r.useRef((null==(a=null==(t=globalThis.crypto)?void 0:t.randomUUID)?void 0:a.call(t))??Math.random().toString(36).slice(2)),u=r.useRef(null),g=r.useRef(null),[h,b]=r.useState(!1),p=r.useCallback(()=>{var e;const t=u.current;if(t){try{null==(e=t.unsubscribe)||e.call(t)}catch(r){}try{q.removeChannel(t)}catch(r){}u.current=null}},[]),y=r.useCallback(async()=>{if(!e)return;const{data:t,error:r}=await q.from("team_achievement_notifications").select("\n        id, team_id, user_id, achievement_id, is_read, created_at,\n        achievement:team_achievements (\n          id, team_id, achievement_type, title, description, achieved_at, metadata, celebrated\n        )\n      ").eq("user_id",e).eq("is_read",!1).order("created_at",{ascending:!0});if(r)return void console.error("[team_achievement_notifications] load error:",r);if(!t)return;const a=t.filter(e=>e.achievement);i(a)},[e]);r.useEffect(()=>{e&&s.canRun&&y()},[e,s.canRun,y]),r.useEffect(()=>{p()},[e,s.canRealtime,h,y,p]),r.useEffect(()=>{if(g.current&&(g.current(),g.current=null),!e)return;const t=`team_achievements:${e}:${m.current}`,r=n({key:t,intervalMs:12e4,run:async()=>{await y()},enabled:!0,requireVisible:!0,requireOnline:!0,immediate:!0});return g.current=r,()=>{g.current&&(g.current(),g.current=null)}},[e,h,n,y]),r.useEffect(()=>{},[e,s.canRealtime,h]),r.useEffect(()=>{l.length>0&&!d&&(x(l[0]),o(!0),f())},[l,d]);const f=()=>{const e=Date.now()+2500,t={startVelocity:25,spread:360,ticks:60,zIndex:9999},r=setInterval(()=>{const a=e-Date.now();if(a<=0)return clearInterval(r);const s=a/2500*50;dr({...t,particleCount:s,origin:{x:.2,y:.2}}),dr({...t,particleCount:s,origin:{x:.8,y:.2}})},200)},j=async()=>{if(!c)return;const{error:e}=await q.rpc("mark_team_notification_read",{p_notification_id:c.id});e&&console.error("[mark_team_notification_read] error:",e),o(!1),i(e=>e.filter(e=>e.id!==c.id)),x(null)};if(!d||!c)return null;const v=c.achievement;if(!v)return null;const w=(e=>{switch(e){case"team_streak":case"streak_7":return rr;case"team_personal_best":case"pb":return we;case"team_acwr_safe":return Vt;default:return Kt}})(v.achievement_type);return R.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4 animate-fade-in",children:R.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-2xl shadow-2xl max-w-md w-full p-8 border-4 border-yellow-400 dark:border-yellow-600 animate-bounce-in",children:[R.jsx("div",{className:"flex justify-end mb-2",children:R.jsx("button",{onClick:j,className:"p-2 hover:bg-yellow-200 dark:hover:bg-yellow-800 rounded-lg transition-colors",children:R.jsx(sr,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-yellow-400 dark:bg-yellow-600 rounded-full mb-4 animate-pulse",children:R.jsx(w,{className:"w-10 h-10 text-white"})}),R.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900 dark:text-white",children:"ãƒãƒ¼ãƒ é”æˆï¼"}),R.jsxs("div",{className:"mb-4",children:[R.jsx("h3",{className:"text-xl font-semibold text-yellow-800 dark:text-yellow-200 mb-1",children:v.title}),v.description?R.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:v.description}):null]}),R.jsx("button",{onClick:j,className:"w-full py-3 bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 text-white font-semibold rounded-lg transition-colors",children:"ãŠã‚ã§ã¨ã†ï¼"})]})]})})}const ei=r.lazy(()=>$(()=>import("./OrganizationAdminView-BLDffxYf.js"),__vite__mapDeps([13,1,2])).then(e=>({default:e.OrganizationAdminView}))),ti=r.lazy(()=>$(()=>Promise.resolve().then(()=>nn),void 0).then(e=>({default:e.AlertPanel})));function ri(){const{user:e,userProfile:t,loading:a,requiresPasswordChange:s,signIn:n,signOut:l,changePassword:i,acceptTerms:d,refreshUserProfile:o}=O();m.useEffect(()=>{let e=!0;(async()=>{const{error:t}=await q.auth.getSession();e&&t&&await F(t)})();const{data:t}=q.auth.onAuthStateChange(async(t,r)=>{if(e&&!r&&("TOKEN_REFRESHED"===t||"SIGNED_IN"===t)){const{error:e}=await q.auth.getSession();e&&await F(e)}});return()=>{e=!1,t.subscription.unsubscribe()}},[]);const c="staff"===(null==t?void 0:t.role)||"global_admin"===(null==t?void 0:t.role)||"athlete"===(null==t?void 0:t.role)?t.role:"athlete",[x,u]=m.useState(!1),{isOrganizationAdmin:g,getOrganizationAdminRoles:h}=function(e){const[t,a]=r.useState([]),[s,n]=r.useState(!0),[l,i]=r.useState(null);r.useEffect(()=>{e?d():n(!1)},[e]);const d=async()=>{if(e)try{n(!0),i(null);const{data:t,error:r}=await q.from("organization_members").select("\n          organization_id,\n          role,\n          organizations (\n            id,\n            name\n          )\n        ").eq("user_id",e);if(r)throw r;const s=(t||[]).map(e=>{var t;return{organizationId:e.organization_id,organizationName:(null==(t=e.organizations)?void 0:t.name)||"Unknown",role:e.role}});a(s)}catch(t){const e=t instanceof Error?t.message:"Failed to load organization roles";i(e),console.error("Error loading organization roles:",t)}finally{n(!1)}};return{organizationRoles:t,loading:s,error:l,isOrganizationAdmin:e=>e?t.some(t=>t.organizationId===e&&"organization_admin"===t.role):t.some(e=>"organization_admin"===e.role),getOrganizationAdminRoles:()=>t.filter(e=>"organization_admin"===e.role),reload:d}}(null==t?void 0:t.id),{alerts:b,loading:p,unreadCount:y,markAsRead:f,dismissAlert:j,markAllAsRead:v,getAlertsByPriority:w}=xe((null==t?void 0:t.id)||"",c),{toasts:N,removeToast:k}=function(){const[e,t]=r.useState([]),a=r.useCallback((e,r="success",a=3e3)=>{const s={id:`toast-${Date.now()}-${Math.random()}`,message:e,type:r,duration:a};t(e=>[...e,s])},[]),s=r.useCallback(e=>{t(t=>t.filter(t=>t.id!==e))},[]),n=r.useCallback((e,t)=>{a(e,"success",t)},[a]),l=r.useCallback((e,t)=>{a(e,"error",t)},[a]),i=r.useCallback((e,t)=>{a(e,"info",t)},[a]);return{toasts:e,showToast:a,removeToast:s,success:n,error:l,info:i}}(),[_,C]=m.useState(!1),[S,D]=m.useState(!1),[M,E]=m.useState("app"),[T,A]=m.useState("staff"),[$,z]=m.useState(!1);if(m.useEffect(()=>{u(s)},[s]),m.useEffect(()=>{const e=new URL(window.location.href),t=e.pathname,r=e.searchParams;t.startsWith("/auth/callback")?E("auth-callback"):t.startsWith("/invite-expired")?E("invite-expired"):t.startsWith("/reset-password")?E("reset-password"):(t.startsWith("/welcome")||r.get("token"))&&E("welcome")},[]),m.useEffect(()=>{const e=window.location.hash;if(!e)return;const t=new URLSearchParams(e.replace("#",""));if("recovery"!==t.get("type"))return;const r=t.get("access_token"),a=t.get("refresh_token");r&&a&&(async()=>{var e;const{data:t}=await q.auth.setSession({access_token:r,refresh_token:a});(null==(e=t.session)?void 0:e.user)&&(u(!0),window.history.replaceState({},document.title,window.location.pathname),E("reset-password"))})()},[]),m.useEffect(()=>{e&&t&&!x?t.terms_accepted||$?D(!1):D(!0):D(!1)},[e,t,x,$]),"auth-callback"===M)return R.jsx(Pl,{onDone:()=>{E("app"),window.history.replaceState({},"","/")}});const I="true"===String("false"),L=window.location.pathname.startsWith("/auth/callback");return I&&!L?R.jsx(Kl,{etaText:"ï¼ˆå®‰å®šåŒ–ã‚’ç¢ºèªä¸­ã§ã™ã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ï¼‰"}):"invite-expired"===M?R.jsx(Wl,{}):"welcome"===M?R.jsx(mr,{onContinue:()=>{E("app"),window.history.replaceState({},"","/")}}):e?R.jsx(Vl,{loading:a||!!e&&!t,ready:!!e&&!!t,onRetry:o,children:(()=>{if(!t)return null;if(x)return R.jsx(xr,{onPasswordChange:async e=>{await i(e),u(!1),window.history.replaceState({},"","/")},userName:t.name});if(S)return R.jsx(Jl,{onAccept:async()=>{await d(),z(!0),D(!1)},onDecline:l});const e=w("high").length>0;return R.jsx(ue,{userId:t.id,role:c,children:R.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[R.jsx(Ul,{effectiveRole:c,userProfile:{id:t.id,name:t.name,email:t.email},alertsLoading:p,unreadCount:y,hasHighPriorityAlerts:e,onOpenAlertPanel:()=>C(!0),onLogout:async e=>{e.preventDefault(),await l(),E("app"),window.history.replaceState({},"","/")},onHome:()=>{console.log("ğŸ  Bekuta logo clicked"),E("app"),A("staff"),C(!1)},onNavigateToPrivacy:()=>E("privacy"),onNavigateToTerms:()=>E("terms"),onNavigateToCommercial:()=>E("commercial"),onNavigateToHelp:()=>E("help")}),R.jsxs("div",{className:"relative",children:[R.jsx(Ll,{userId:t.id}),"athlete"===c?R.jsx(Is,{user:t,alerts:b,onLogout:l,onUserUpdated:o,onHome:()=>{console.log("ğŸ  Athlete Bekuta home tapped"),window.location.assign("https://bekuta.netlify.app/")},onNavigateToPrivacy:()=>E("privacy"),onNavigateToTerms:()=>E("terms"),onNavigateToCommercial:()=>E("commercial"),onNavigateToHelp:()=>E("help")}):Kn(c)?R.jsx(zl,{user:t,alerts:b,onNavigateToPrivacy:()=>E("privacy"),onNavigateToTerms:()=>E("terms"),onNavigateToCommercial:()=>E("commercial"),onNavigateToHelp:()=>E("help")}):R.jsxs(R.Fragment,{children:[g()&&R.jsx("div",{className:"bg-white dark:bg-gray-800 border-b dark:border-gray-700 transition-colors sticky top-0 z-30",children:R.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2",children:R.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1 max-w-md",children:[R.jsxs("button",{type:"button",onClick:()=>A("staff"),className:"flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 "+("staff"===T?"bg-white dark:bg-gray-600 text-green-600 dark:text-green-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:[R.jsx(rr,{className:"w-4 h-4"}),R.jsx("span",{children:"ã‚³ãƒ¼ãƒ"})]}),R.jsxs("button",{type:"button",onClick:()=>A("org-admin"),className:"flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 "+("org-admin"===T?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"),children:[R.jsx(De,{className:"w-4 h-4"}),R.jsx("span",{children:"çµ„ç¹”ç®¡ç†"})]})]})})}),"staff"===T?R.jsx(Vn,{user:t,alerts:b,onNavigateToPrivacy:()=>E("privacy"),onNavigateToTerms:()=>E("terms"),onNavigateToCommercial:()=>E("commercial"),onNavigateToHelp:()=>E("help")}):h().length>0&&R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center min-h-screen",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:R.jsx(ei,{user:t,alerts:b,organizationId:h()[0].organizationId,organizationName:h()[0].organizationName,onNavigateToPrivacy:()=>E("privacy"),onNavigateToTerms:()=>E("terms"),onNavigateToCommercial:()=>E("commercial"),onNavigateToHelp:()=>E("help")})})]})]}),_&&!p&&R.jsx(r.Suspense,{fallback:R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:R.jsx(ti,{alerts:b,onMarkAsRead:f,onDismiss:j,onMarkAllAsRead:v,onClose:()=>C(!1),userRole:c})}),t&&R.jsx(Xl,{userId:t.id}),R.jsx(Zl,{toasts:N,onClose:k}),R.jsx(Gl,{onNavigateToPrivacy:()=>E("privacy"),onNavigateToTerms:()=>E("terms"),onNavigateToCommercial:()=>E("commercial")})]})})})()}):R.jsx(lr,{onLogin:n})}console.log("ğŸš€ main.tsx is executing"),console.log("ğŸ“ Current URL:",window.location.href),console.log("ğŸ” Checking for root element...");const ai=document.getElementById("root");if(!ai)throw console.error("âŒ Root element not found!"),document.body.innerHTML='<div style="padding: 40px; font-family: sans-serif;"><h1>Error: Root element not found</h1><p>The #root div is missing from index.html</p></div>',new Error("Root element not found");console.log("âœ… Root element found, creating React root...");try{const e=E(ai);console.log("âœ… React root created, rendering App..."),e.render(R.jsx(r.StrictMode,{children:R.jsx(oe,{children:R.jsx(ri,{})})})),console.log("âœ… App render initiated successfully")}catch(si){console.error("âŒ Error during React initialization:",si),document.body.innerHTML=`<div style="padding: 40px; font-family: sans-serif;">\n    <h1>React Initialization Error</h1>\n    <pre>${si}</pre>\n  </div>`}export{Ct as $,fe as A,ke as B,Ue as C,He as D,Me as E,et as F,Oe as G,st as H,Ge as I,ce as J,ye as K,ct as L,we as M,Vt as N,ol as O,Kt as P,Pt as Q,It as R,zt as S,wl as T,rr as U,xt as V,at as W,sr as X,qt as Y,nr as Z,cr as _,De as a,tt as a0,ql as a1,Il as a2,bt as a3,Rt as a4,er as a5,Tt as a6,Zr as a7,H as a8,na as a9,Et as aa,kt as ab,Ht as ac,Qe as ad,dr as ae,us as af,ie as ag,U as ah,Y as ai,Z as aj,Xe as ak,Je as al,_t as am,Te as an,gt as ao,O as ap,xn as aq,Ze as ar,$e as as,fn as at,Qt as b,Gt as c,Ft as d,tr as e,Jn as f,Yn as g,Xn as h,Cl as i,R as j,bl as k,ul as l,kl as m,Ir as n,aa as o,Ut as p,Mt as q,Qa as r,q as s,Xa as t,ge as u,Ee as v,Re as w,dt as x,je as y,be as z};
//# sourceMappingURL=index-DC548egD.js.map

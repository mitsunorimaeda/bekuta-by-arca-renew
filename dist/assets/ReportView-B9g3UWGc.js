import{z as fe,ah as $e,ai as Ne,s as _,ag as Fe,aj as We,j as e,ad as K,E as te,ak as Pe,D as le,al as Ge,am as Oe,a as ze,U as Re,a5 as He,$ as Ce,p as ye,G as ce,an as Be,ab as pe,ao as Ue,ap as Ve,aq as Je,B as he,ar as ke,N as _e,A as Qe}from"./index-C7IL5YWP.js";import{r as x}from"./chart-vendor-B8I3tXXj.js";import"./supabase-vendor-CRHRt2Ih.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=fe("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=fe("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=fe("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function G(l){if(l==null||l==="")return null;const c=typeof l=="number"?l:Number(l);return Number.isFinite(c)?c:null}function Ze(l){if(!l)return null;if(typeof l=="string"){const c=l.match(/^(\d{4}-\d{2}-\d{2})/);return c?c[1]:null}try{const c=new Date(l);return Number.isNaN(c.getTime())?null:c.toISOString().slice(0,10)}catch{return null}}function be(l){const c=G(l==null?void 0:l.load);if(c!=null)return c;const w=G(l==null?void 0:l.rpe),C=G(l==null?void 0:l.duration_min);return w!=null&&C!=null?w*C:0}function E(l){return Math.round(l*100)/100}async function Ke(l,c){const{data:w,error:C}=await _.from("users").select("*").eq("id",l).single();if(C)throw C;if(!w)throw new Error("Athlete not found");const{data:i,error:R}=await _.from("training_records").select("*").eq("user_id",l).gte("date",c.start).lte("date",c.end).order("date",{ascending:!0});if(R)throw R;const b=(i==null?void 0:i.length)||0,j=(i==null?void 0:i.reduce((s,y)=>s+be(y),0))||0,k=(i==null?void 0:i.reduce((s,y)=>s+(G(y.duration_min)??0),0))||0,T=b>0?j/b:0,o=(i==null?void 0:i.reduce((s,y)=>Math.max(s,be(y)),0))||0,g=b>0?(i||[]).reduce((s,y)=>s+(G(y.rpe)??0),0)/b:0,u=(i||[]).map(s=>{const y=Ze(s==null?void 0:s.date);return y?{date:y,load:be(s)}:null}).filter(Boolean),f=(u.length>0?Fe(u):[]).map(s=>s.acwr).filter(s=>typeof s=="number"&&Number.isFinite(s)),a=f.length>0?f[f.length-1]:0,h=f.length>0?f.reduce((s,y)=>s+y,0)/f.length:0,n=f.length>0?Math.max(...f):0,m=f.length>0?Math.min(...f):0,D=f.filter(s=>s<.8||s>1.3).length,v=a>=1.5?"high":a>=1.3?"medium":a>=.8?"low":"medium",d=f.length>=3?f[f.length-1]>f[Math.floor(f.length/2)]?"improving":"declining":"stable",{data:p,error:Q}=await _.from("weight_records").select("*").eq("user_id",l).gte("date",c.start).lte("date",c.end).order("date",{ascending:!0});if(Q)throw Q;const $=(p||[]).map(s=>G(s.weight_kg)).filter(s=>typeof s=="number"&&Number.isFinite(s)),O=$.length>0?$[$.length-1]:null,M=$.length>0?$[0]:null,Y=$.length>0?$.reduce((s,y)=>s+y,0)/$.length:null,z=O!=null&&M!=null?O-M:null,U=O!=null&&M!=null&&M>0?(O-M)/M*100:null,X=z==null?"no_data":Math.abs(z)<.5?"stable":z>0?"increasing":"decreasing",{data:W,error:I}=await _.from("sleep_records").select("*").eq("user_id",l).gte("date",c.start).lte("date",c.end);if(I)throw I;const r=(W||[]).map(s=>G(s.sleep_hours)).filter(s=>typeof s=="number"&&Number.isFinite(s)),A=(W||[]).map(s=>G(s.sleep_quality)).filter(s=>typeof s=="number"&&Number.isFinite(s)),H=r.length>0?r.reduce((s,y)=>s+y,0)/r.length:null,V=A.length>0?A.reduce((s,y)=>s+y,0)/A.length:null,Z=A.length<3?"no_data":A[A.length-1]>A[Math.floor(A.length/2)]?"improving":A[A.length-1]<A[Math.floor(A.length/2)]?"declining":"stable",{data:J,error:ne}=await _.from("motivation_records").select("*").eq("user_id",l).gte("date",c.start).lte("date",c.end);if(ne)throw ne;const L=(J||[]).map(s=>G(s.motivation_level)).filter(s=>typeof s=="number"&&Number.isFinite(s)),se=(J||[]).map(s=>G(s.energy_level)).filter(s=>typeof s=="number"&&Number.isFinite(s)),re=(J||[]).map(s=>G(s.stress_level)).filter(s=>typeof s=="number"&&Number.isFinite(s)),ie=L.length>0?L.reduce((s,y)=>s+y,0)/L.length:null,t=se.length>0?se.reduce((s,y)=>s+y,0)/se.length:null,N=re.length>0?re.reduce((s,y)=>s+y,0)/re.length:null,P=L.length<3?"no_data":L[L.length-1]>L[Math.floor(L.length/2)]?"improving":L[L.length-1]<L[Math.floor(L.length/2)]?"declining":"stable",{data:F,error:q}=await _.from("performance_records").select("*, performance_test_types(*)").eq("user_id",l).gte("date",c.start).lte("date",c.end);if(q)throw q;const B=(F==null?void 0:F.length)||0;let de=0,je=0,ve=0;if(F&&F.length>0){const s=new Map;F.forEach(y=>{const ee=y.test_type_id;s.has(ee)||s.set(ee,[]),s.get(ee).push(y)}),s.forEach(y=>{var ee,we;if(y.length>=2){const oe=[...y].sort((Te,qe)=>new Date(Te.date).getTime()-new Date(qe.date).getTime()),me=oe[0],xe=oe[oe.length-1],ge=(ee=me==null?void 0:me.values)==null?void 0:ee.result,ue=(we=xe==null?void 0:xe.values)==null?void 0:we.result;ge!=null&&ue!=null&&(ue>ge?je++:ue<ge&&ve++)}})}const{data:Ae}=await _.from("alerts").select("*").eq("user_id",l).gte("created_at",c.start).lte("created_at",c.end),ae=Ae||[],Se=ae.length,Ee=ae.filter(s=>s.priority==="high").length,De=ae.filter(s=>{var y;return((y=s.metadata)==null?void 0:y.priority)==="medium"}).length,Me=ae.filter(s=>s.priority==="low").length,Le=ae.filter(s=>s.is_resolved).length;return{athleteId:w.id,athleteName:w.name,athleteEmail:w.email,trainingRecords:{totalSessions:b,totalLoad:E(j),averageLoad:E(T),maxLoad:E(o),averageRPE:E(g),totalDuration:Math.round(k)},acwrData:{current:E(a),average:E(h),max:E(n),min:E(m),riskLevel:v,daysInDangerZone:D,trend:d},weightData:{current:O,average:Y!=null?E(Y):null,change:z!=null?E(z):null,changePercent:U!=null?E(U):null,trend:X},sleepData:{averageHours:H!=null?E(H):null,averageQuality:V!=null?E(V):null,totalRecords:(W==null?void 0:W.length)||0,qualityTrend:Z},motivationData:{averageMotivation:ie!=null?E(ie):null,averageEnergy:t!=null?E(t):null,averageStress:N!=null?E(N):null,totalRecords:(J==null?void 0:J.length)||0,motivationTrend:P},performanceData:{totalTests:B,personalBests:de,improvements:je,declines:ve},alerts:{total:Se,high:Ee,medium:De,low:Me,resolved:Le}}}async function et(l,c){const{data:w,error:C}=await _.from("teams").select("*").eq("id",l).single();if(C)throw C;if(!w)throw new Error("Team not found");const{data:i,error:R}=await _.from("users").select("*").eq("team_id",l).eq("role","athlete");if(R)throw R;const b=(i==null?void 0:i.length)||0,j=[];if(i)for(const d of i)try{const p=await Ke(d.id,c);j.push(p)}catch(p){console.error(`Error generating report for athlete ${d.id}:`,p)}const k=j.filter(d=>d.trainingRecords.totalSessions>0).length,T=k>0?j.reduce((d,p)=>d+p.trainingRecords.averageLoad,0)/k:0,o=j.filter(d=>d.acwrData.current>0),g=o.length>0?o.reduce((d,p)=>d+p.acwrData.current,0)/o.length:0,u=j.filter(d=>d.acwrData.riskLevel==="high").length,S=j.filter(d=>d.acwrData.riskLevel==="medium").length,f=j.filter(d=>d.acwrData.riskLevel==="low").length,a=j.reduce((d,p)=>d+p.alerts.total,0),h=j.reduce((d,p)=>d+p.alerts.high,0),n=[],m=[];g>1.3?(n.push(`チーム平均ACWR（${g.toFixed(2)}）が推奨範囲を超えています。全体的にトレーニング負荷が高い状態です。`),m.push("チーム全体のトレーニング強度を見直し、適切な休息日を設けることを推奨します。")):g<.8&&g>0?(n.push(`チーム平均ACWR（${g.toFixed(2)}）が推奨範囲を下回っています。トレーニング負荷が不足している可能性があります。`),m.push("選手のコンディションを確認しながら、段階的にトレーニング負荷を増やすことを検討してください。")):n.push(`チーム平均ACWR（${g.toFixed(2)}）は適切な範囲内です。`),u>0&&(n.push(`${u}名の選手が高リスク状態です。個別対応が必要です。`),m.push(`高リスク選手: ${j.filter(d=>d.acwrData.riskLevel==="high").map(d=>d.athleteName).join(", ")} の負荷調整を優先してください。`)),h>0&&(n.push(`${h}件の重要アラートが発生しています。`),m.push("高優先度のアラートに対して迅速に対応してください。"));const D=j.filter(d=>d.sleepData.averageHours!==null&&d.sleepData.averageHours<7);D.length>0&&(n.push(`${D.length}名の選手の平均睡眠時間が7時間未満です。`),m.push(`睡眠不足の選手（${D.map(d=>d.athleteName).join("、")}）に対して、睡眠習慣の改善を指導してください。`));const v=j.filter(d=>d.motivationData.averageMotivation!==null&&d.motivationData.averageMotivation<3);return v.length>0&&(n.push(`${v.length}名の選手のモチベーションが低下しています。`),m.push(`モチベーション低下が見られる選手（${v.map(d=>d.athleteName).join("、")}）と個別面談を行うことを推奨します。`)),{teamId:w.id,teamName:w.name,period:c,generatedAt:new Date().toISOString(),totalAthletes:b,activeAthletes:k,teamAverageLoad:E(T),teamAverageACWR:E(g),highRiskCount:u,mediumRiskCount:S,lowRiskCount:f,totalAlerts:a,newAlerts:a,criticalAlerts:h,athletes:j,insights:n,recommendations:m}}function tt(l,c,w){const C=$e(),i=new Date(C.getTime());let R=new Date(i.getTime());switch(l){case"weekly":R.setDate(i.getDate()-7);break;case"monthly":R.setMonth(i.getMonth()-1);break;case"quarterly":R.setMonth(i.getMonth()-3);break;case"semi_annual":R.setMonth(i.getMonth()-6);break;case"annual":R.setFullYear(i.getFullYear()-1);break;case"custom":if(c&&w)return{start:c,end:w,type:"custom"};break}return{start:Ne(R),end:Ne(i),type:l}}function st(l){const[c,w]=x.useState([]),[C,i]=x.useState(!0),[R,b]=x.useState(null);x.useEffect(()=>{l?j():(w([]),i(!1))},[l]);const j=async()=>{if(l)try{i(!0),b(null);const{data:g,error:u}=await _.from("generated_reports").select("*").eq("team_id",l).order("created_at",{ascending:!1}).limit(50);if(u)throw u;w(g||[])}catch(g){console.error("Error fetching reports:",g),b(g.message)}finally{i(!1)}};return{reports:c,loading:C,error:R,generateReport:async(g,u,S,f)=>{try{const a=tt(u,S,f),h=await et(g,a),{data:n}=await _.from("teams").select("name").eq("id",g).single(),m=`${(n==null?void 0:n.name)||"チーム"}レポート - ${a.start} 〜 ${a.end}`,D={report_type:u,title:m,period_start:a.start,period_end:a.end,team_id:g,athlete_ids:h.athletes.map(p=>p.athleteId),summary_data:{totalAthletes:h.totalAthletes,activeAthletes:h.activeAthletes,teamAverageLoad:h.teamAverageLoad,teamAverageACWR:h.teamAverageACWR,highRiskCount:h.highRiskCount,mediumRiskCount:h.mediumRiskCount,lowRiskCount:h.lowRiskCount,totalAlerts:h.totalAlerts,criticalAlerts:h.criticalAlerts},detailed_data:h,insights:h.insights,recommendations:h.recommendations,generation_status:"completed"},{data:v,error:d}=await _.from("generated_reports").insert(D).select().single();if(d)throw d;return await j(),{success:!0,reportId:v.id}}catch(a){return console.error("Error generating report:",a),{success:!1,error:a.message}}},markReportAsViewed:async g=>{try{const{error:u}=await _.from("generated_reports").update({viewed_at:We()}).eq("id",g);if(u)throw u;await j()}catch(u){console.error("Error marking report as viewed:",u)}},deleteReport:async g=>{try{const{error:u}=await _.from("generated_reports").delete().eq("id",g);if(u)throw u;return await j(),{success:!0}}catch(u){return console.error("Error deleting report:",u),{success:!1,error:u.message}}},refreshReports:j}}function rt({organizationId:l,userId:c}){const[w,C]=x.useState([]),[i,R]=x.useState(null),[b,j]=x.useState("team"),[k,T]=x.useState({start:"",end:""}),[o,g]=x.useState(""),[u,S]=x.useState(""),[f,a]=x.useState([]),[h,n]=x.useState([]),[m,D]=x.useState({acwr:!0,training_load:!0,performance:!0,injury_risk:!0,attendance:!0,trends:!0}),[v,d]=x.useState(!1),[p,Q]=x.useState(!1),[$,O]=x.useState(!1),[M,Y]=x.useState(null),[z,U]=x.useState([]),[X,W]=x.useState(!1);x.useEffect(()=>{l&&(I(),r(),H())},[l]),x.useEffect(()=>{R(t=>t&&t.report_type===b?t:null),b==="organization"?(g(""),S(""),n([])):b==="team"&&S("")},[b]),x.useEffect(()=>{if(!o){n([]),S("");return}A(o)},[o]);const I=async()=>{try{const{data:t,error:N}=await _.from("report_templates").select("*").eq("organization_id",l).order("name");if(N)throw N;C(t||[])}catch(t){console.error("[AdvancedReportGenerator] fetchTemplates failed:",t),C([])}},r=async()=>{try{d(!0);const{data:t,error:N}=await _.from("teams").select("id, name").eq("organization_id",l).order("name");if(N)throw N;a(t||[])}catch(t){console.error("[AdvancedReportGenerator] fetchTeams failed:",t),a([])}finally{d(!1)}},A=async t=>{try{Q(!0),n([]),S("");const{data:N,error:P}=await _.from("team_member_assignments").select("user_id, users!inner(id, name)").eq("team_id",t);if(P)throw P;const F=(N==null?void 0:N.map(q=>{var B;return{id:q.user_id,name:((B=q.users)==null?void 0:B.name)||"unknown"}}))||[];F.sort((q,B)=>q.name.localeCompare(B.name,"ja")),n(F)}catch(N){console.error("[AdvancedReportGenerator] fetchAthletes failed:",N),n([])}finally{Q(!1)}},H=async()=>{try{W(!0);const{data:t,error:N}=await _.from("report_history").select("id, report_type, status, created_at, started_at, completed_at, file_path, report_url, error_message, parameters").eq("organization_id",l).order("created_at",{ascending:!1}).limit(20);if(N)throw N;U(t||[])}catch(t){console.error("[AdvancedReportGenerator] fetchHistory failed:",t),U([])}finally{W(!1)}},V=x.useMemo(()=>!k.start||!k.end?null:k.start>k.end?"開始日が終了日より後になっています":null,[k.start,k.end]),Z=x.useMemo(()=>{if(!k.start||!k.end)return"期間（開始日・終了日）を入力してください";if(V)return V;if(b==="team"&&!o)return"チームを選択してください";if(b==="individual"){if(!o)return"チームを選択してください";if(!u)return"アスリートを選択してください"}return Object.values(m).some(Boolean)?null:"含める指標を1つ以上選択してください"},[k.start,k.end,V,b,o,u,m]),J=!$&&!Z,ne=async()=>{if(Z){window.alert(Z);return}O(!0),Y(null);try{const t={report_type:b,date_range:k,team_id:b==="organization"?null:o,athlete_id:b==="individual"?u:null,metrics:m},{data:N,error:P}=await _.from("report_history").insert({organization_id:l,template_id:(i==null?void 0:i.id)||null,report_type:b,generated_by:c,parameters:t,status:"pending"}).select("id").single();if(P)throw P;const F=N==null?void 0:N.id;if(!F)throw new Error("Failed to create report_history");const{data:q,error:B}=await _.functions.invoke("generate_report",{body:{report_history_id:F}});if(B)throw console.error("[AdvancedReportGenerator] invoke error:",B),B;const de={report_history_id:F,report_url:(q==null?void 0:q.report_url)??null,file_path:(q==null?void 0:q.file_path)??null};Y(de),await H(),de.report_url?window.alert("レポート生成が完了しました。ダウンロードできます。"):window.alert("生成は完了しましたが、URLがまだありません（Storage設定を確認してください）")}catch(t){console.error("[AdvancedReportGenerator] generateReport failed:",t),window.alert(`レポート生成に失敗しました：${(t==null?void 0:t.message)??t}`),await H()}finally{O(!1)}},L=t=>{window.open(t,"_blank","noopener,noreferrer")},se=t=>{switch(t){case"individual":return e.jsx(He,{className:"w-5 h-5"});case"team":return e.jsx(Re,{className:"w-5 h-5"});case"organization":return e.jsx(ze,{className:"w-5 h-5"});default:return e.jsx(K,{className:"w-5 h-5"})}},re={acwr:"ACWR",training_load:"トレーニング負荷",performance:"パフォーマンス",injury_risk:"傷害リスク",attendance:"出欠/稼働",trends:"トレンド"},ie=t=>{const N="px-2 py-1 text-xs rounded-full";return t==="completed"?`${N} bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300`:t==="failed"?`${N} bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300`:`${N} bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200`};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"高度なレポート生成"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"レポートタイプ"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["individual","team","organization"].map(t=>e.jsxs("button",{type:"button",onClick:()=>j(t),className:`p-4 border-2 rounded-lg flex flex-col items-center gap-2 transition-colors ${b===t?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-700"}`,children:[se(t),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t==="individual"?"個人":t==="team"?"チーム":"組織"})]},t))})]}),w.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"テンプレート（任意）"}),e.jsxs("select",{value:(i==null?void 0:i.id)||"",onChange:t=>{const N=w.find(P=>P.id===t.target.value);R(N||null),N&&j(N.report_type)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"カスタムレポート"}),w.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(te,{className:"inline w-4 h-4 mr-1"}),"期間"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"開始日"}),e.jsx("input",{type:"date",value:k.start,onChange:t=>T({...k,start:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"終了日"}),e.jsx("input",{type:"date",value:k.end,onChange:t=>T({...k,end:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),V&&e.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:V})]}),(b==="team"||b==="individual")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"チーム"}),e.jsxs("select",{value:o,onChange:t=>g(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",disabled:v,children:[e.jsx("option",{value:"",children:v?"読み込み中…":"チームを選択"}),f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),b==="individual"&&o&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"アスリート"}),e.jsxs("select",{value:u,onChange:t=>S(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",disabled:p,children:[e.jsx("option",{value:"",children:p?"読み込み中…":"アスリートを選択"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Pe,{className:"inline w-4 h-4 mr-1"}),"含める指標"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(m).map(([t,N])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:P=>D({...m,[t]:P.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:re[t]??t.replace(/_/g," ")})]},t))})]}),e.jsxs("button",{type:"button",onClick:ne,disabled:!J,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),$?"生成中...":"レポートを生成"]}),Z&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["※ ",Z]}),M&&e.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-200",children:[e.jsx("div",{className:"font-semibold mb-1",children:"最新の生成結果"}),e.jsxs("div",{className:"break-all",children:["report_history_id: ",M.report_history_id]}),M.file_path&&e.jsxs("div",{className:"break-all",children:["file_path: ",M.file_path]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:M.report_url?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>L(M.report_url),className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"レポートを開く"]}),e.jsxs("a",{href:M.report_url,className:"px-3 py-2 rounded bg-gray-900 hover:bg-black text-white text-sm flex items-center gap-2",target:"_blank",rel:"noreferrer",children:[e.jsx(le,{className:"w-4 h-4"}),"ダウンロード"]})]}):e.jsx("div",{className:"text-sm text-orange-700 dark:text-orange-300",children:"report_url がまだありません（Storage/署名URL生成を確認）"})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"レポート履歴（最新20件）"}),e.jsxs("button",{type:"button",onClick:H,disabled:X,className:"px-3 py-2 rounded bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-sm flex items-center gap-2 disabled:opacity-50",children:[e.jsx(Oe,{className:"w-4 h-4"}),"更新"]})]}),X?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"読み込み中…"}):z.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"履歴がありません。"}):e.jsx("div",{className:"space-y-3",children:z.map(t=>e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 dark:bg-gray-700/40 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:ie(t.status),children:t.status}),e.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-100",children:t.report_type.toUpperCase()})]}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1 break-all",children:["id: ",t.id]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.report_url?e.jsxs("button",{type:"button",onClick:()=>L(t.report_url),className:"px-3 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"開く"]}):e.jsxs("button",{type:"button",disabled:!0,className:"px-3 py-2 rounded bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 text-sm flex items-center gap-2 opacity-60 cursor-not-allowed",children:[e.jsx(le,{className:"w-4 h-4"}),"なし"]})})]}),t.error_message&&e.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-300",children:t.error_message}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:["created: ",t.created_at]}),e.jsxs("div",{children:["completed: ",t.completed_at??"-"]}),e.jsxs("div",{className:"break-all",children:["file_path: ",t.file_path??"-"]})]})]},t.id))})]})]})}function at({organizationId:l,userId:c}){const[w,C]=x.useState([]),[i,R]=x.useState(!0),[b,j]=x.useState("all");x.useEffect(()=>{k()},[l,b]);const k=async()=>{try{R(!0);let a=_.from("report_history").select(`
          *,
          users!report_history_generated_by_fkey(name)
        `).eq("organization_id",l).order("created_at",{ascending:!1}).limit(50);b!=="all"&&(a=a.eq("status",b));const{data:h,error:n}=await a;if(n)throw n;C(h||[])}catch(a){console.error("Error fetching reports:",a)}finally{R(!1)}},T=async a=>{if(confirm("このレポートを削除しますか？"))try{const{error:h}=await _.from("report_history").delete().eq("id",a);if(h)throw h;C(w.filter(n=>n.id!==a))}catch(h){console.error("Error deleting report:",h),alert("レポートの削除に失敗しました")}},o=a=>{switch(a){case"completed":return e.jsx(Be,{className:"w-5 h-5 text-green-600 dark:text-green-400"});case"failed":return e.jsx(Ie,{className:"w-5 h-5 text-red-600 dark:text-red-400"});default:return e.jsx(ce,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}},g=a=>{switch(a){case"completed":return"bg-green-50 dark:bg-green-900/20";case"failed":return"bg-red-50 dark:bg-red-900/20";default:return"bg-yellow-50 dark:bg-yellow-900/20"}},u=a=>{switch(a){case"completed":return"完了";case"failed":return"失敗";default:return"処理中"}},S=a=>new Date(a).toLocaleString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=a=>{switch(a){case"individual":return"個人レポート";case"team":return"チームレポート";case"organization":return"組織レポート";default:return"レポート"}};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"レポート履歴"})]}),e.jsx("button",{onClick:k,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"更新",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:["all","completed","pending","failed"].map(a=>e.jsx("button",{onClick:()=>j(a),className:`px-4 py-2 text-sm rounded-lg transition-colors ${b===a?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:a==="all"?"すべて":u(a)},a))}),w.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"レポート履歴がありません"})]}):e.jsx("div",{className:"space-y-3",children:w.map(a=>{var h;return e.jsx("div",{className:`p-4 rounded-lg border-2 ${g(a.status)} border-gray-200 dark:border-gray-700`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o(a.status),e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:f(a.report_type)}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:S(a.created_at)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"生成者: "}),((h=a.users)==null?void 0:h.name)||"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ステータス: "}),u(a.status)]})]}),a.parameters&&Object.keys(a.parameters).length>0&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"パラメータ: "}),a.parameters.date_range&&e.jsxs("span",{children:[a.parameters.date_range.start," ~ ",a.parameters.date_range.end]})]}),a.error_message&&e.jsxs("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 rounded text-sm text-red-800 dark:text-red-200",children:["エラー: ",a.error_message]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[a.status==="completed"&&e.jsx("button",{onClick:()=>alert("ダウンロード機能は実装予定です"),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"ダウンロード",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>T(a.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"削除",children:e.jsx(ye,{className:"w-5 h-5"})})]})]})},a.id)})})]})}function lt({organizationId:l,userId:c}){const[w,C]=x.useState([]),[i,R]=x.useState(!1),[b,j]=x.useState(null),[k,T]=x.useState(!0),[o,g]=x.useState({name:"",schedule_type:"weekly",day_of_week:"1",day_of_month:"1",time:"09:00",recipients:""});x.useEffect(()=>{u()},[l]);const u=async()=>{try{T(!0);const{data:n,error:m}=await _.from("scheduled_reports").select("*").eq("organization_id",l).order("name");if(m)throw m;C(n||[])}catch(n){console.error("Error fetching scheduled reports:",n)}finally{T(!1)}},S=async n=>{n.preventDefault();try{const m={time:o.time};o.schedule_type==="weekly"?m.day_of_week=parseInt(o.day_of_week):o.schedule_type==="monthly"&&(m.day_of_month=parseInt(o.day_of_month));const D=o.recipients.split(",").map(p=>p.trim()).filter(p=>p),{data:v}=await _.rpc("calculate_next_run",{p_schedule_type:o.schedule_type,p_schedule_config:m}),d={organization_id:l,template_id:l,name:o.name,schedule_type:o.schedule_type,schedule_config:m,recipients:D,next_run:v,created_by:c};if(b){const{error:p}=await _.from("scheduled_reports").update(d).eq("id",b.id);if(p)throw p}else{const{error:p}=await _.from("scheduled_reports").insert(d);if(p)throw p}R(!1),j(null),g({name:"",schedule_type:"weekly",day_of_week:"1",day_of_month:"1",time:"09:00",recipients:""}),u()}catch(m){console.error("Error saving scheduled report:",m),alert("スケジュールの保存に失敗しました")}},f=async n=>{try{const{error:m}=await _.from("scheduled_reports").update({is_active:!n.is_active}).eq("id",n.id);if(m)throw m;u()}catch(m){console.error("Error toggling report:",m)}},a=async n=>{if(confirm("このスケジュールを削除しますか？"))try{const{error:m}=await _.from("scheduled_reports").delete().eq("id",n);if(m)throw m;u()}catch(m){console.error("Error deleting report:",m),alert("削除に失敗しました")}},h=n=>{const m=n.schedule_config,D=m.time||"09:00";switch(n.schedule_type){case"daily":return`毎日 ${D}`;case"weekly":const v=["日","月","火","水","木","金","土"],d=m.day_of_week||1;return`毎週${v[d]}曜日 ${D}`;case"monthly":return`毎月${m.day_of_month||1}日 ${D}`;default:return"不明"}};return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-6 h-6 text-green-600 dark:text-green-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"スケジュールレポート"})]}),e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(pe,{className:"w-5 h-5"}),"新規作成"]})]}),i&&e.jsxs("form",{onSubmit:S,className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:b?"スケジュール編集":"新規スケジュール"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"スケジュール名"}),e.jsx("input",{type:"text",required:!0,value:o.name,onChange:n=>g({...o,name:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"頻度"}),e.jsxs("select",{value:o.schedule_type,onChange:n=>g({...o,schedule_type:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"daily",children:"毎日"}),e.jsx("option",{value:"weekly",children:"毎週"}),e.jsx("option",{value:"monthly",children:"毎月"})]})]}),o.schedule_type==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"曜日"}),e.jsxs("select",{value:o.day_of_week,onChange:n=>g({...o,day_of_week:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"0",children:"日曜日"}),e.jsx("option",{value:"1",children:"月曜日"}),e.jsx("option",{value:"2",children:"火曜日"}),e.jsx("option",{value:"3",children:"水曜日"}),e.jsx("option",{value:"4",children:"木曜日"}),e.jsx("option",{value:"5",children:"金曜日"}),e.jsx("option",{value:"6",children:"土曜日"})]})]}),o.schedule_type==="monthly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"日付"}),e.jsx("input",{type:"number",min:"1",max:"31",value:o.day_of_month,onChange:n=>g({...o,day_of_month:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"時刻"}),e.jsx("input",{type:"time",value:o.time,onChange:n=>g({...o,time:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"送信先メールアドレス（カンマ区切り）"}),e.jsx("input",{type:"text",required:!0,value:o.recipients,onChange:n=>g({...o,recipients:n.target.value}),placeholder:"user1@example.com, user2@example.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:"保存"}),e.jsx("button",{type:"button",onClick:()=>{R(!1),j(null)},className:"flex-1 py-2 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-700 dark:text-white rounded-lg transition-colors",children:"キャンセル"})]})]})]}),w.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"スケジュールされたレポートがありません"})]}):e.jsx("div",{className:"space-y-3",children:w.map(n=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:n.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),h(n)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ue,{className:"w-4 h-4"}),n.recipients.length," 人"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>f(n),className:`p-2 rounded-lg transition-colors ${n.is_active?"text-green-600 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/20":"text-gray-400 dark:text-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600"}`,title:n.is_active?"無効化":"有効化",children:n.is_active?e.jsx(Xe,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>a(n.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"削除",children:e.jsx(ye,{className:"w-5 h-5"})})]})]},n.id))})]})}function ct({team:l}){var U,X,W,I;const{user:c}=Ve(),{organizations:w}=Je((c==null?void 0:c.id)||""),C=l.organization_id||(w.length>0?w[0].id:""),{reports:i,loading:R,generateReport:b,markReportAsViewed:j,deleteReport:k,refreshReports:T}=st(l.id),[o,g]=x.useState(!1),[u,S]=x.useState(!1),[f,a]=x.useState("weekly"),[h,n]=x.useState(""),[m,D]=x.useState(""),[v,d]=x.useState(null),[p,Q]=x.useState("basic"),$=async()=>{g(!0);try{const r=await b(l.id,f,f==="custom"?h:void 0,f==="custom"?m:void 0);r.success?(alert("レポートを生成しました！"),S(!1)):alert(`エラー: ${r.error}`)}catch(r){console.error("Report generation error:",r),alert("レポート生成に失敗しました")}finally{g(!1)}},O=r=>{d(r),j(r.id)},M=async r=>{if(!confirm("このレポートを削除してもよろしいですか？"))return;const A=await k(r);A.success?alert("レポートを削除しました"):alert(`エラー: ${A.error}`)},Y=r=>{switch(r){case"high":return"text-red-600 bg-red-50";case"medium":return"text-yellow-600 bg-yellow-50";case"low":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},z=r=>{switch(r){case"high":return"高リスク";case"medium":return"中リスク";case"low":return"低リスク";default:return"不明"}};return R?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-2",children:e.jsx("div",{className:"flex gap-2",children:[{id:"basic",label:"基本レポート",icon:K},{id:"advanced",label:"高度なレポート",icon:he},{id:"scheduled",label:"スケジュール",icon:te},{id:"history",label:"履歴",icon:ce}].map(r=>e.jsxs("button",{onClick:()=>Q(r.id),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors ${p===r.id?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(r.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:r.label})]},r.id))})}),p==="advanced"&&c&&e.jsx(rt,{organizationId:C,userId:c.id}),p==="scheduled"&&c&&e.jsx(lt,{organizationId:C,userId:c.id}),p==="history"&&c&&e.jsx(at,{organizationId:C,userId:c.id}),p==="basic"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(K,{className:"w-7 h-7 mr-3 text-blue-600"}),"チームレポート"]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[l.name,"の選手コンディションレポート"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:T,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"更新"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:"レポート生成"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.length}),e.jsx("div",{className:"text-sm text-blue-700",children:"生成済みレポート"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.filter(r=>r.viewed_at).length}),e.jsx("div",{className:"text-sm text-green-700",children:"閲覧済み"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:i.filter(r=>!r.viewed_at).length}),e.jsx("div",{className:"text-sm text-yellow-700",children:"未閲覧"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:((X=(U=i[0])==null?void 0:U.summary_data)==null?void 0:X.totalAthletes)||0}),e.jsx("div",{className:"text-sm text-purple-700",children:"対象選手数"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"生成済みレポート"}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"レポートがありません"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"「レポート生成」ボタンから新しいレポートを作成してください。"}),e.jsxs("button",{onClick:()=>S(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors inline-flex items-center space-x-2",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:"レポート生成"})]})]}):e.jsx("div",{className:"space-y-4",children:i.map(r=>e.jsx("div",{className:`border rounded-lg p-4 hover:shadow-md transition-shadow ${r.viewed_at?"border-gray-200":"border-blue-300 bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:r.title}),!r.viewed_at&&e.jsx("span",{className:"bg-blue-600 text-white text-xs px-2 py-1 rounded-full",children:"新規"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mb-3",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),r.period_start," 〜 ",r.period_end]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),new Date(r.generated_at).toLocaleString("ja-JP")]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ke,{className:"w-4 h-4 mr-1"}),r.view_count,"回閲覧"]})]}),r.summary_data&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"選手数"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:r.summary_data.activeAthletes||0})]}),e.jsxs("div",{className:"bg-blue-50 rounded p-2",children:[e.jsx("div",{className:"text-xs text-blue-600",children:"平均ACWR"}),e.jsx("div",{className:"text-lg font-bold text-blue-900",children:(r.summary_data.teamAverageACWR||0).toFixed(2)})]}),e.jsxs("div",{className:"bg-red-50 rounded p-2",children:[e.jsx("div",{className:"text-xs text-red-600",children:"高リスク"}),e.jsxs("div",{className:"text-lg font-bold text-red-900",children:[r.summary_data.highRiskCount||0,"名"]})]}),e.jsxs("div",{className:"bg-yellow-50 rounded p-2",children:[e.jsx("div",{className:"text-xs text-yellow-600",children:"中リスク"}),e.jsxs("div",{className:"text-lg font-bold text-yellow-900",children:[r.summary_data.mediumRiskCount||0,"名"]})]}),e.jsxs("div",{className:"bg-orange-50 rounded p-2",children:[e.jsx("div",{className:"text-xs text-orange-600",children:"アラート"}),e.jsxs("div",{className:"text-lg font-bold text-orange-900",children:[r.summary_data.criticalAlerts||0,"件"]})]})]}),r.insights&&r.insights.length>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(_e,{className:"w-4 h-4 text-yellow-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-yellow-800",children:r.insights[0]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>O(r),className:"bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg transition-colors",title:"詳細表示",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(r.id),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors",title:"削除",children:e.jsx(ye,{className:"w-4 h-4"})})]})]})},r.id))})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(he,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"レポート生成"}),e.jsx("p",{className:"text-blue-100",children:l.name})]})]}),e.jsx("button",{onClick:()=>S(!1),className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:e.jsx("span",{className:"text-2xl",children:"×"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(te,{className:"w-5 h-5 mr-2 text-blue-600"}),"レポート期間の選択"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 mb-4",children:[{value:"weekly",label:"1週間"},{value:"monthly",label:"1ヶ月"},{value:"quarterly",label:"3ヶ月"},{value:"semi_annual",label:"6ヶ月"},{value:"annual",label:"1年"},{value:"custom",label:"カスタム"}].map(r=>e.jsx("button",{onClick:()=>a(r.value),className:`p-3 rounded-lg text-sm font-medium transition-colors ${f===r.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:r.label},r.value))}),f==="custom"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"開始日"}),e.jsx("input",{type:"date",value:h,onChange:r=>n(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"終了日"}),e.jsx("input",{type:"date",value:m,onChange:r=>D(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"レポートに含まれるデータ"}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("p",{children:"✓ トレーニング負荷とACWR分析"}),e.jsx("p",{children:"✓ 体重変化の推移"}),e.jsx("p",{children:"✓ 睡眠とモチベーションデータ"}),e.jsx("p",{children:"✓ パフォーマンステスト結果"}),e.jsx("p",{children:"✓ 怪我リスクアラート"}),e.jsx("p",{children:"✓ チーム平均との比較"}),e.jsx("p",{children:"✓ インサイトと推奨事項"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:o,children:"キャンセル"}),e.jsx("button",{onClick:$,disabled:o||f==="custom"&&(!h||!m),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors disabled:opacity-50 flex items-center space-x-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"生成中..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"レポート生成"})]})})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:v.title}),e.jsxs("p",{className:"text-blue-100",children:[v.period_start," 〜 ",v.period_end]})]}),e.jsx("button",{onClick:()=>d(null),className:"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors",children:e.jsx("span",{className:"text-2xl",children:"×"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[v.summary_data&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"チーム概要"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:v.summary_data.activeAthletes}),e.jsx("div",{className:"text-sm text-gray-600",children:"活動選手数"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((W=v.summary_data.teamAverageACWR)==null?void 0:W.toFixed(2))||"0.00"}),e.jsx("div",{className:"text-sm text-gray-600",children:"平均ACWR"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:v.summary_data.highRiskCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"高リスク選手"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:v.summary_data.criticalAlerts}),e.jsx("div",{className:"text-sm text-gray-600",children:"重要アラート"})]})]})]}),v.insights&&v.insights.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(_e,{className:"w-5 h-5 mr-2 text-yellow-600"}),"インサイト"]}),e.jsx("div",{className:"space-y-2",children:v.insights.map((r,A)=>e.jsxs("p",{className:"text-sm text-gray-700",children:["• ",r]},A))})]}),v.recommendations&&v.recommendations.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Qe,{className:"w-5 h-5 mr-2 text-blue-600"}),"推奨事項"]}),e.jsx("div",{className:"space-y-2",children:v.recommendations.map((r,A)=>e.jsxs("p",{className:"text-sm text-gray-700",children:["• ",r]},A))})]}),((I=v.detailed_data)==null?void 0:I.athletes)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Re,{className:"w-5 h-5 mr-2 text-gray-600"}),"選手別データ"]}),e.jsx("div",{className:"space-y-4",children:v.detailed_data.athletes.map(r=>{var A,H;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:r.athleteName}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${Y(r.acwrData.riskLevel)}`,children:z(r.acwrData.riskLevel)})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"トレーニング"}),e.jsxs("div",{className:"font-semibold text-gray-900",children:[r.trainingRecords.totalSessions,"回"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"ACWR"}),e.jsx("div",{className:"font-semibold text-gray-900",children:r.acwrData.current.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"睡眠"}),e.jsxs("div",{className:"font-semibold text-gray-900",children:[((A=r.sleepData.averageHours)==null?void 0:A.toFixed(1))||"-","h"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"モチベ"}),e.jsx("div",{className:"font-semibold text-gray-900",children:((H=r.motivationData.averageMotivation)==null?void 0:H.toFixed(1))||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"アラート"}),e.jsxs("div",{className:"font-semibold text-red-600",children:[r.alerts.high,"件"]})]})]})]},r.athleteId)})})]})]})]})})]})]})}export{ct as ReportView};

import{j as e,X as t,L as a,p as r,q as l,s,r as n,t as i,F as d,v as o,w as c,x as u,y as x}from"./index-DC548egD.js";import{r as m}from"./chart-vendor-DEPfNMx8.js";import"./supabase-vendor-BgrwFlS9.js";function g(e,t=0){const a=Number(e);return Number.isFinite(a)?a:t}function y({open:n,log:i,onClose:d,onSaved:o,onDeleted:c}){const[u,x]=m.useState(!1),[y,p]=m.useState(!1),[h,b]=m.useState(null),[f,v]=m.useState("0"),[N,k]=m.useState("0"),[j,w]=m.useState("0"),[_,M]=m.useState("0"),[S,F]=m.useState(""),[C,$]=m.useState(""),A=m.useMemo(()=>{return i?`${e=String(i.meal_type),t=i.meal_slot,"補食"===e?`補食${Number(t??1)}`:e} の編集`:"";var e,t},[i]);if(m.useEffect(()=>{if(!n)return;const e=document.body.style.overflow,t=document.body.style.paddingRight,a=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",a>0&&(document.body.style.paddingRight=`${a}px`),()=>{document.body.style.overflow=e,document.body.style.paddingRight=t}},[n]),m.useEffect(()=>{if(!n)return;const e=e=>{"Escape"===e.key&&d()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[n,d]),m.useEffect(()=>{if(!n||!i)return;b(null),v(String(g(i.total_calories,0))),k(String(g(i.p,0))),w(String(g(i.f,0))),M(String(g(i.c,0)));const e=(Array.isArray(i.menu_items)?i.menu_items:[]).map(e=>"string"==typeof e?e:(null==e?void 0:e.name)??(null==e?void 0:e.label)??"").filter(Boolean);F(e.join("\n")),$(String(i.advice_markdown??""))},[n,i]),!n||!i)return null;return e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/50",onClick:d,"aria-label":"閉じる",disabled:u||y}),e.jsxs("div",{className:"\n          relative w-full max-w-2xl\n          bg-white dark:bg-gray-900\n          rounded-2xl shadow-2xl\n          flex flex-col\n          max-h-[calc(100vh-2rem)]\n        ",role:"dialog","aria-modal":"true","aria-label":A,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex-none",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate",children:A}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i.record_date," / status: ",i.analysis_status??"-",i.is_edited?"（編集済）":""]})]}),e.jsx("button",{type:"button",onClick:d,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 flex-none","aria-label":"close",disabled:u||y,children:e.jsx(t,{className:"w-5 h-5 text-gray-700 dark:text-gray-200"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 overflow-y-auto",children:[h&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:h})}),i.image_url&&e.jsx("div",{className:"rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800",children:e.jsx("img",{src:i.image_url,alt:"meal",className:"w-full max-h-[320px] object-cover",loading:"eager",decoding:"async"})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"kcal"}),e.jsx("input",{value:f,onChange:e=>v(e.target.value),inputMode:"numeric",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:u||y})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"P (g)"}),e.jsx("input",{value:N,onChange:e=>k(e.target.value),inputMode:"decimal",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:u||y})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"F (g)"}),e.jsx("input",{value:j,onChange:e=>w(e.target.value),inputMode:"decimal",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:u||y})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"C (g)"}),e.jsx("input",{value:_,onChange:e=>M(e.target.value),inputMode:"decimal",className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:u||y})]})]}),e.jsxs("label",{className:"space-y-1 block",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"推定メニュー（1行=1品）"}),e.jsx("textarea",{value:S,onChange:e=>F(e.target.value),rows:4,className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:u||y})]}),e.jsxs("label",{className:"space-y-1 block",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"メモ / AIコメント（編集OK）"}),e.jsx("textarea",{value:C,onChange:e=>$(e.target.value),rows:4,className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",disabled:u||y})]}),"failed"===i.analysis_status&&i.analysis_error&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-200 whitespace-pre-wrap",children:["解析失敗: ",String(i.analysis_error)]})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 px-4 sm:px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex-none",children:[e.jsxs("button",{type:"button",onClick:async()=>{if(window.confirm("この栄養記録を削除します。よろしいですか？")){p(!0),b(null);try{const{error:e}=await s.from("nutrition_logs").delete().eq("id",i.id);if(e)throw e;c(i.id),d()}catch(e){console.error("[NutritionEditModal] delete error:",e),b(String((null==e?void 0:e.message)??e))}finally{p(!1)}}},disabled:u||y,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-red-200 dark:border-red-800 text-red-600 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 disabled:opacity-60",children:[y?e.jsx(a,{className:"w-4 h-4 animate-spin"}):e.jsx(r,{className:"w-4 h-4"}),"削除"]}),e.jsxs("button",{type:"button",onClick:async()=>{x(!0),b(null);try{const e={total_calories:Math.max(0,Math.round(g(f,0))),p:Math.max(0,Number(g(N,0).toFixed(1))),f:Math.max(0,Number(g(j,0).toFixed(1))),c:Math.max(0,Number(g(_,0).toFixed(1))),menu_items:(S||"").split("\n").map(e=>e.trim()).filter(Boolean),advice_markdown:(null==C?void 0:C.trim())?C.trim():null,is_edited:!0,edit_meta:{updated_at:(new Date).toISOString(),source:"nutrition_edit_modal"}},{data:t,error:a}=await s.from("nutrition_logs").update(e).eq("id",i.id).select("*").single();if(a)throw a;o(t),d()}catch(e){console.error("[NutritionEditModal] save error:",e),b(String((null==e?void 0:e.message)??e))}finally{x(!1)}},disabled:u||y,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:[u?e.jsx(a,{className:"w-4 h-4 animate-spin"}):e.jsx(l,{className:"w-4 h-4"}),"保存"]})]})]})]})}function p(e,t=0){const a=Number(e);return Number.isFinite(a)?a:t}function h(e,t,a){return Math.min(a,Math.max(t,e))}function b(e){return Math.round(10*e)/10}const f={p:{short:"P",long:"たんぱく質"},f:{short:"F",long:"脂質"},c:{short:"C",long:"炭水化物"}};function v({totals:t,targets:a,title:r="PFCバランス"}){const[l,s]=m.useState(null),n=m.useMemo(()=>{const e=p(null==t?void 0:t.p,0),a=p(null==t?void 0:t.f,0),r=p(null==t?void 0:t.c,0),l=function(e,t,a){const r=4*e,l=9*t,s=4*a;return{pK:r,fK:l,cK:s,total:r+l+s}}(e,a,r),s=l.total;if(!Number.isFinite(s)||s<=0)return{pG:e,fG:a,cG:r,now:l,totalK:0,pctInt:{p:0,f:0,c:0},pctFloat:{p:0,f:0,c:0}};const n=l.pK/s*100,i=l.fK/s*100,d=l.cK/s*100,o=function(e,t,a){const r=[{key:"p",v:h(e,0,100)},{key:"f",v:h(t,0,100)},{key:"c",v:h(a,0,100)}],l=r.map(e=>({...e,floor:Math.floor(e.v),frac:e.v-Math.floor(e.v)}));let s=100-l.reduce((e,t)=>e+t.floor,0);l.sort((e,t)=>t.frac-e.frac);const n={p:0,f:0,c:0};for(let o=0;o<l.length&&s>0;o++)n[l[o].key]+=1,s-=1;const i={p:0,f:0,c:0};for(const o of r){const e=l.find(e=>e.key===o.key);i[o.key]=e.floor+n[o.key]}const d=i.p+i.f+i.c;if(100!==d){const e=["p","f","c"].reduce((e,t)=>i[t]>i[e]?t:e,"p");i[e]+=100-d}return i}(n,i,d);return{pG:e,fG:a,cG:r,now:l,totalK:Math.round(s),pctInt:o,pctFloat:{p:n,f:i,c:d}}},[t]),i=n.totalK,d=m.useMemo(()=>{if(!l)return null;return{g:"p"===l?n.pG:"f"===l?n.fG:n.cG,k:"p"===l?n.now.pK:"f"===l?n.now.fK:n.now.cK,pct:n.pctInt[l]??0,key:l}},[l,n]),o=e=>{s(t=>t===e?null:e)},c=e=>l?l===e?"opacity-100":"opacity-35":"opacity-100",u=i<=0;return e.jsxs("div",{className:"rounded-2xl bg-white dark:bg-gray-900 shadow-sm ring-1 ring-gray-200 dark:ring-gray-800 p-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:r}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["合計: ",e.jsx("span",{className:"font-bold tabular-nums",children:i})," kcal（P/F/C換算）"]})]}),u?e.jsx("div",{className:"mt-4 rounded-xl bg-gray-50 dark:bg-gray-800/60 p-4 text-sm text-gray-600 dark:text-gray-300",children:"まだ記録がありません（写真で食事を追加するとPFCバランスが表示されます）"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:block mt-3",children:[e.jsxs("div",{className:"h-10 rounded-xl bg-gray-200 dark:bg-gray-700 overflow-hidden flex",children:[e.jsx("button",{type:"button",onClick:()=>o("p"),className:`h-full bg-emerald-600 flex items-center justify-center px-2 ${c("p")}`,style:{width:`${n.pctInt.p}%`},title:`P（たんぱく質） ${n.pctInt.p}%`,children:e.jsxs("span",{className:"text-white font-semibold text-xs whitespace-nowrap drop-shadow",children:["P（たんぱく質） ",n.pctInt.p,"%"]})}),e.jsx("button",{type:"button",onClick:()=>o("f"),className:`h-full bg-orange-500 flex items-center justify-center px-2 ${c("f")}`,style:{width:`${n.pctInt.f}%`},title:`F（脂質） ${n.pctInt.f}%`,children:e.jsxs("span",{className:"text-white font-semibold text-xs whitespace-nowrap drop-shadow",children:["F（脂質） ",n.pctInt.f,"%"]})}),e.jsx("button",{type:"button",onClick:()=>o("c"),className:`h-full bg-blue-600 flex items-center justify-center px-2 ${c("c")}`,style:{width:`${n.pctInt.c}%`},title:`C（炭水化物） ${n.pctInt.c}%`,children:e.jsxs("span",{className:"text-white font-semibold text-xs whitespace-nowrap drop-shadow",children:["C（炭水化物） ",n.pctInt.c,"%"]})})]}),d&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300 tabular-nums",children:[f[d.key].short,"（",f[d.key].long,"）：",b(d.g),"g / ",Math.round(d.k),"kcal（",d.pct,"%）"]})]}),e.jsx("div",{className:"sm:hidden mt-3",children:e.jsxs("div",{className:"relative rounded-2xl bg-gray-50 dark:bg-gray-800/60 p-3",children:[e.jsxs("div",{className:"relative mx-auto w-[260px] max-w-full",children:[e.jsxs("svg",{viewBox:"0 0 200 200",className:"block mx-auto w-[220px] h-[220px]",children:[e.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:"rgba(156,163,175,0.25)",strokeWidth:"28"}),(()=>{const t=2*Math.PI*70,a=[{key:"p",pct:n.pctInt.p,className:"stroke-emerald-600"},{key:"f",pct:n.pctInt.f,className:"stroke-orange-500"},{key:"c",pct:n.pctInt.c,className:"stroke-blue-600"}];let r=0;return a.map(a=>{const l=a.pct/100*t,s=`${l} ${t-l}`,n=r/100*t;return r+=a.pct,e.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",strokeWidth:"28",strokeLinecap:"butt",className:`${a.className} ${c(a.key)}`,strokeDasharray:s,strokeDashoffset:-n,transform:"rotate(-90 100 100)"},a.key)})})(),e.jsxs("text",{x:"100",y:"96",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",style:{fontSize:22,fontWeight:800},children:[i," kcal"]}),e.jsx("text",{x:"100",y:"118",textAnchor:"middle",className:"fill-gray-500 dark:fill-gray-300",style:{fontSize:12,fontWeight:700},children:"（P/F/C換算）"})]}),e.jsxs("button",{type:"button",onClick:()=>o("c"),className:"absolute left-0 top-2 rounded-2xl bg-white/90 dark:bg-gray-900/80 ring-1 ring-gray-200 dark:ring-gray-700 px-3 py-2 text-left shadow-sm "+("c"===l?"ring-2 ring-blue-500":""),children:[e.jsx("div",{className:"text-xs font-extrabold text-gray-900 dark:text-white",children:"C（炭水化物）"}),e.jsxs("div",{className:"text-2xl leading-none font-extrabold text-gray-900 dark:text-white tabular-nums",children:[n.pctInt.c,"%"]})]}),e.jsxs("button",{type:"button",onClick:()=>o("p"),className:"absolute right-0 top-6 rounded-2xl bg-white/90 dark:bg-gray-900/80 ring-1 ring-gray-200 dark:ring-gray-700 px-3 py-2 text-left shadow-sm "+("p"===l?"ring-2 ring-emerald-500":""),children:[e.jsx("div",{className:"text-xs font-extrabold text-gray-900 dark:text-white",children:"P（たんぱく質）"}),e.jsxs("div",{className:"text-2xl leading-none font-extrabold text-gray-900 dark:text-white tabular-nums",children:[n.pctInt.p,"%"]})]}),e.jsxs("button",{type:"button",onClick:()=>o("f"),className:"absolute left-0 bottom-4 rounded-2xl bg-white/90 dark:bg-gray-900/80 ring-1 ring-gray-200 dark:ring-gray-700 px-3 py-2 text-left shadow-sm "+("f"===l?"ring-2 ring-orange-400":""),children:[e.jsx("div",{className:"text-xs font-extrabold text-gray-900 dark:text-white",children:"F（脂質）"}),e.jsxs("div",{className:"text-2xl leading-none font-extrabold text-gray-900 dark:text-white tabular-nums",children:[n.pctInt.f,"%"]})]})]}),d&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-300 tabular-nums text-center",children:[f[d.key].short,"（",f[d.key].long,"）：",b(d.g),"g / ",Math.round(d.k),"kcal（",d.pct,"%）"]})]})})]})]})}function N(e,t=0){const a=Number(e);return Number.isFinite(a)?a:t}function k(e,t){return!Number.isFinite(t)||t<=0?0:(a=e/t*100,r=0,l=100,Math.min(l,Math.max(r,a)));var a,r,l}function j(e){return Math.round(10*e)/10}function w(e,t){return!Number.isFinite(t)||t<=0?null:Math.max(0,t-e)}function _({now:t,goal:a}){const r=k(t,a);return e.jsx("div",{className:"mt-2 h-2.5 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gray-400 dark:bg-gray-300",style:{width:`${r}%`}})})}function M({label:t,unit:a,now:r,goal:l}){const s=w(r,l);return e.jsxs("div",{className:"rounded-xl bg-gray-50 dark:bg-gray-800/60 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t}),e.jsx("div",{className:"text-xs font-semibold text-emerald-600 dark:text-emerald-400",children:null!=s?`あと${j(s)}${a}`:""})]}),e.jsxs("div",{className:"mt-1.5 flex items-baseline gap-2",children:[e.jsx("div",{className:"text-2xl font-extrabold tabular-nums text-gray-900 dark:text-white",children:j(r)}),e.jsxs("div",{className:"text-sm font-bold text-gray-600 dark:text-gray-300 tabular-nums",children:["/ ",j(l),a]})]}),e.jsx(_,{now:r,goal:l})]})}function S({dateLabel:t,totals:a,targets:r,loading:l=!1,bmrKcal:s=null,tdeeKcal:n=null,onPrimaryAction:i,primaryLabel:d="食事を記録"}){const o=m.useMemo(()=>({cal:N(null==a?void 0:a.cal,0),p:N(null==a?void 0:a.p,0),f:N(null==a?void 0:a.f,0),c:N(null==a?void 0:a.c,0)}),[a]),c=m.useMemo(()=>r?{cal:N(null==r?void 0:r.cal,0),p:N(null==r?void 0:r.p,0),f:N(null==r?void 0:r.f,0),c:N(null==r?void 0:r.c,0)}:null,[r]),u=c?w(o.cal,c.cal):null;return e.jsxs("div",{className:"rounded-2xl bg-white dark:bg-gray-900 shadow-sm ring-1 ring-gray-200 dark:ring-gray-800",children:[e.jsx("div",{className:"px-4 sm:px-5 pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"栄養サマリー"}),t&&e.jsx("div",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:t})]}),e.jsxs("div",{className:"text-right text-[11px] leading-snug text-gray-500 dark:text-gray-400",children:[null!=s&&e.jsxs("div",{children:["推定BMR: ",Math.round(s),"kcal"]}),null!=n&&e.jsxs("div",{children:["今日必要: ",Math.round(n),"kcal"]})]})]})}),e.jsx("div",{className:"px-4 sm:px-5 pb-4 sm:pb-5",children:l?e.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"読み込み中…"}):c?e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"rounded-2xl bg-gray-50 dark:bg-gray-800/60 px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"カロリー"}),e.jsx("div",{className:"text-xs font-semibold text-emerald-600 dark:text-emerald-400",children:null!=u?`あと${Math.round(u)}kcal`:""})]}),e.jsxs("div",{className:"mt-2 flex items-baseline justify-center gap-2",children:[e.jsx("div",{className:"text-5xl font-extrabold tabular-nums text-gray-900 dark:text-white",children:Math.round(o.cal)}),e.jsxs("div",{className:"text-xl font-bold text-gray-600 dark:text-gray-300 tabular-nums",children:["/ ",Math.round(c.cal),"kcal"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(_,{now:o.cal,goal:c.cal})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(M,{label:"たんぱく質",unit:"g",now:o.p,goal:c.p}),e.jsx(M,{label:"脂質",unit:"g",now:o.f,goal:c.f}),e.jsx(M,{label:"炭水化物",unit:"g",now:o.c,goal:c.c})]}),e.jsx("div",{className:"gap-3 mt-4",children:e.jsx(v,{totals:{p:o.p,f:o.f,c:o.c},targets:c?{p:c.p,f:c.f,c:c.c}:null})}),i&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center justify-center px-5 py-2.5 rounded-full bg-emerald-600 text-white font-bold text-sm hover:bg-emerald-500 transition",children:d})})]}):e.jsx("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"目標値の表示には体重データが必要です"})})]})}function F(e,t=0){const a=Number(e);return Number.isFinite(a)?a:t}function C(e,t){return"補食"===e?`補食${Number(t??1)}`:e}function $(e,t){return"補食"===e?(a=F(t,1),r=1,l=2,Math.min(l,Math.max(r,a))):1;var a,r,l}function A(e){if(!e)return null;if("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=new Date(e);if(Number.isNaN(t.getTime()))return null;const a=t.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}).split("/");return`${a[0]}-${String(a[1]).padStart(2,"0")}-${String(a[2]).padStart(2,"0")}`}function K(e,t){return`すでに「${"補食"===e?`補食${t}`:e}」は記録済みです。新規追加はできません。\n「今日の記録」から開いて編集してください。`}function I({user:t,latestInbody:r,latestWeightKg:l,date:x,trainingRecords:g,badgeText:p="栄養(β)",nutritionLogs:h=[],nutritionTotals:b={cal:0,p:0,f:0,c:0},nutritionLoading:f=!1,nutritionError:v=null,onSaved:N}){const k=m.useRef(null),[j,w]=m.useState(!1),[_,M]=m.useState(null),[I,P]=m.useState(null),[E,D]=m.useState("朝食"),[L,T]=m.useState(1),R=A(x)??A(new Date)??(new Date).toISOString().slice(0,10),[G,O]=m.useState(Array.isArray(h)?h:[]);m.useEffect(()=>{O(Array.isArray(h)?h:[])},[h]);const W=m.useMemo(()=>{const e=(Array.isArray(G)?G:[]).reduce((e,t)=>(e.cal+=F(null==t?void 0:t.total_calories,0),e.p+=F(null==t?void 0:t.p,0),e.f+=F(null==t?void 0:t.f,0),e.c+=F(null==t?void 0:t.c,0),e),{cal:0,p:0,f:0,c:0});return f&&(!Array.isArray(G)||0===G.length)&&b?{cal:F(b.cal,0),p:F(b.p,0),f:F(b.f,0),c:F(b.c,0)}:e},[G,f,b]),[q,z]=m.useState(!1),[B,U]=m.useState(null);const J=m.useMemo(()=>{const e=F(null==t?void 0:t.weight_kg,NaN),a=F((null==r?void 0:r.weight)??(null==r?void 0:r.weight_kg),NaN),s=F(l,NaN),i=Number.isFinite(a)?a:Number.isFinite(s)?s:Number.isFinite(e)?e:NaN,d=F(null==t?void 0:t.height_cm,NaN),o=function(e){if(!e)return null;const t=new Date(e);if(Number.isNaN(t.getTime()))return null;const a=new Date;let r=a.getFullYear()-t.getFullYear();const l=a.getMonth()-t.getMonth();return(l<0||0===l&&a.getDate()<t.getDate())&&(r-=1),r>=0?r:null}(null==t?void 0:t.date_of_birth),c=(u=null==t?void 0:t.gender)?"male"===u?"male":"female"===u?"female":null:null;var u;const x=F((null==r?void 0:r.body_fat_percent)??(null==r?void 0:r.body_fat_perc)??(null==r?void 0:r.body_fat_percent),NaN);if(!Number.isFinite(i)||i<=0)return{weightKg:null,targets:null,refs:null};const m=n({weightKg:i,bodyFatPercent:Number.isFinite(x)?x:null,heightCm:Number.isFinite(d)?d:null,age:Number.isFinite(Number(o))?Number(o):null,sex:c??null,activityLevel:"moderate",goalType:"maintain"});return{weightKg:i,targets:(null==m?void 0:m.target)??null,refs:{ffmKg:(null==m?void 0:m.ffmKg)??null,bmrKcal:(null==m?void 0:m.bmrKcal)??null,tdeeKcal:(null==m?void 0:m.tdeeKcal)??null}}},[t,r,l]),Y=J.targets,H=J.refs,Z=m.useMemo(()=>function(e,t){if(!t)return null;const a=F(null==e?void 0:e.cal,0),r=F(null==e?void 0:e.p,0),l=F(null==e?void 0:e.f,0),s=F(null==e?void 0:e.c,0);return[{key:"cal",label:"エネルギー",unit:"kcal",now:Math.round(a),goal:Math.round(F(null==t?void 0:t.cal,0)),remain:Math.round(F(null==t?void 0:t.cal,0))-Math.round(a)},{key:"p",label:"たんぱく質",unit:"g",now:Math.round(10*r)/10,goal:Math.round(10*F(null==t?void 0:t.p,0))/10,remain:Math.round(10*(F(null==t?void 0:t.p,0)-r))/10},{key:"f",label:"脂質",unit:"g",now:Math.round(10*l)/10,goal:Math.round(10*F(null==t?void 0:t.f,0))/10,remain:Math.round(10*(F(null==t?void 0:t.f,0)-l))/10},{key:"c",label:"炭水化物",unit:"g",now:Math.round(10*s)/10,goal:Math.round(10*F(null==t?void 0:t.c,0))/10,remain:Math.round(10*(F(null==t?void 0:t.c,0)-s))/10}]}(W,Y),[W,Y]),Q=m.useMemo(()=>{if(!Z)return null;const e=Z.filter(e=>e.remain>0&&Number.isFinite(e.remain));return e.sort((e,t)=>t.remain-e.remain),e},[Z]),V=m.useMemo(()=>function(e){var t,a,r,l;if(!e)return[];const s=Object.fromEntries(e.map(e=>[e.key,e])),n=Math.max(0,F(null==(t=s.p)?void 0:t.remain,0)),i=Math.max(0,F(null==(a=s.c)?void 0:a.remain,0)),d=Math.max(0,F(null==(r=s.f)?void 0:r.remain,0)),o=Math.max(0,F(null==(l=s.cal)?void 0:l.remain,0)),c=n>=15?"p":i>=40?"c":d>=10?"f":o>=300?"cal":n>0||i>0||d>0||o>0?"mix":"ok";return"ok"===c?["今日はだいたいOK。水分・野菜・睡眠を整える","補食を入れるなら：ヨーグルト or 果物","明日に備えて：夕食で主食・主菜を欠かさない"]:n>=15&&i>=40?["ご飯（中）＋鶏むね/ささみ（目安）","おにぎり2個＋ツナ/サバ缶（半分〜1缶）","うどん＋卵/納豆（タンパク質を足す）"]:"p"===c?["鶏むね・ささみ（目安）／脂質を抑えてPを足す","卵＋納豆（手軽にPを積む）","プロテイン1杯＋ヨーグルト（補食で埋める）"]:"c"===c?["おにぎり2個（まず主食で埋める）","ご飯＋汁物（消化しやすく）","バナナ＋ヨーグルト（補食でCを足す）"]:"f"===c?["ナッツひと握り（20g目安）","オリーブオイルを料理に小さじ1〜2追加","サバ缶（脂質もPも足せる）"]:["主食＋主菜＋果物（まず“セット”で増やす）","補食：おにぎり＋乳製品（簡単に底上げ）","夕食：丼もの/定食スタイルで“量”を確保"]}(Z),[Z]),X=m.useMemo(()=>Y?i({today:{cal:F(null==W?void 0:W.cal,0),p:F(null==W?void 0:W.p,0),f:F(null==W?void 0:W.f,0),c:F(null==W?void 0:W.c,0)},target:Y}):null,[W,Y]),ee=async e=>{if(!e)return;const a=$(E,L);if((Array.isArray(G)?G:[]).some(e=>String(null==e?void 0:e.record_date)===String(R)&&(null==e?void 0:e.meal_type)===E&&Number(null==e?void 0:e.meal_slot)===Number(a)))return M(K(E,a)),void(k.current&&(k.current.value=""));w(!0),M(null),P(null);let r=null;try{const l=null==t?void 0:t.id;if(!l)throw new Error("user.id が取れません");const n=(e.name.split(".").pop()||"jpg").toLowerCase(),i=crypto.randomUUID(),d=`nutrition/${l}/${R}/${i}.${n}`,{error:o}=await s.storage.from("nutrition-images").upload(d,e,{upsert:!1,contentType:e.type||"image/jpeg"});if(o)throw o;const{data:c}=s.storage.from("nutrition-images").getPublicUrl(d),u=(null==c?void 0:c.publicUrl)??null,{data:x,error:m}=await s.from("nutrition_logs").insert({user_id:l,record_date:R,meal_type:E,meal_slot:a,image_path:d,image_url:u,image_meta:{original_name:e.name,size:e.size,type:e.type},analysis_status:"pending",analysis_error:null}).select("*").single();if(m){if(function(e){var t;const a=(null==e?void 0:e.code)??(null==(t=null==e?void 0:e.details)?void 0:t.code),r=String((null==e?void 0:e.message)??""),l=String((null==e?void 0:e.details)??""),s=String((null==e?void 0:e.hint)??"");return"23505"===a||r.includes("nutrition_logs_user_date_meal_slot_unique")||l.includes("nutrition_logs_user_date_meal_slot_unique")||s.includes("nutrition_logs_user_date_meal_slot_unique")}(m))throw new Error(K(E,a));throw m}r=(null==x?void 0:x.id)??null;const g=await async function(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e.split(",")[1]??"")},r.onerror=a,r.readAsDataURL(e)})}(e),y=`meal_type=${E}${"補食"===E?` slot=${a}`:""}`,p=await async function(e){const{data:t,error:a}=await s.functions.invoke("nutrition-gemini",{body:e});if(a){const e=(null==a?void 0:a.message)??JSON.stringify(a);throw new Error(e||"nutrition-gemini invoke error")}return t}({type:"analyze_meal",imageBase64:g,context:y}),h=function(e){const t=(null==e?void 0:e.result)??(null==e?void 0:e.data)??e??{},a=(null==t?void 0:t.calories)??(null==t?void 0:t.total_calories)??(null==t?void 0:t.kcal),r=(null==t?void 0:t.protein)??(null==t?void 0:t.p),l=(null==t?void 0:t.fat)??(null==t?void 0:t.f),s=(null==t?void 0:t.carbs)??(null==t?void 0:t.c),n=Number(a),i=Number(r),d=Number(l),o=Number(s);if(!(Number.isFinite(n)&&n>=0&&Number.isFinite(i)&&i>=0&&Number.isFinite(d)&&d>=0&&Number.isFinite(o)&&o>=0)){const e=(null==t?void 0:t.error)??(null==t?void 0:t.message)??"Gemini返却に必須値（calories/protein/fat/carbs）が見つかりません",n=JSON.stringify({calories:a,protein:r,fat:l,carbs:s,keys:Object.keys(t??{})},null,2);throw new Error(`${e}\n${n}`)}const c=(null==t?void 0:t.menu_items)??(null==t?void 0:t.menuItems)??[],u=(null==t?void 0:t.comment)??(null==t?void 0:t.advice_markdown)??(null==t?void 0:t.advice)??null;return{total_calories:Math.round(n),p:F(i,0),f:F(d,0),c:F(o,0),menu_items:Array.isArray(c)?c:[],advice_markdown:null!=u?String(u):null,raw:e}}(p),b=(null==p?void 0:p.meta)??null,{data:f,error:v}=await s.from("nutrition_logs").update({total_calories:h.total_calories,p:h.p,f:h.f,c:h.c,menu_items:h.menu_items,advice_markdown:h.advice_markdown,analysis_status:"success",analysis_error:null,analysis_meta:b??{},analysis_model:(null==b?void 0:b.used_model)??null,analysis_reason:(null==b?void 0:b.reason)??null}).eq("id",x.id).select("*").single();if(v)throw v;O(e=>[...Array.isArray(e)?e:[],f].sort((e,t)=>new Date((null==e?void 0:e.created_at)??0).getTime()-new Date((null==t?void 0:t.created_at)??0).getTime())),P("記録完了"),"function"==typeof N&&N(f)}catch(l){console.error("[NutritionCard] photo/analyze error:",l);const e=String((null==l?void 0:l.message)??l);if(M(e),null!=r)try{await s.from("nutrition_logs").update({analysis_status:"failed",analysis_error:e.slice(0,2e3)}).eq("id",r)}catch(n){console.error("[NutritionCard] failed status update error:",n)}}finally{w(!1),k.current&&(k.current.value="")}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300 text-xs font-medium",children:[e.jsx(d,{className:"w-3.5 h-3.5"}),p]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:R})]}),e.jsx("h3",{className:"mt-2 text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"栄養"}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400 space-x-3",children:[null!=(null==H?void 0:H.bmrKcal)&&e.jsxs("span",{children:["推定基礎代謝量: ",H.bmrKcal," kcal"]}),null!=(null==H?void 0:H.tdeeKcal)&&e.jsxs("span",{children:["今日必要なカロリー(推定TDEE): ",H.tdeeKcal," kcal"]})]}),Y&&e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:["目標: ",Y.cal," kcal / P ",Y.p," g / F ",Y.f," g / C ",Y.c," g"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:E,onChange:e=>{const t=e.target.value;D(t),"補食"!==t&&T(1)},className:"px-2 py-1.5 text-xs border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200",disabled:j,children:[e.jsx("option",{value:"朝食",children:"朝食"}),e.jsx("option",{value:"昼食",children:"昼食"}),e.jsx("option",{value:"夕食",children:"夕食"}),e.jsx("option",{value:"補食",children:"補食"})]}),"補食"===E&&e.jsxs("select",{value:L,onChange:e=>T(Number(e.target.value)),className:"px-2 py-1.5 text-xs border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200",disabled:j,children:[e.jsx("option",{value:1,children:"補食1"}),e.jsx("option",{value:2,children:"補食2"})]}),e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=k.current)?void 0:e.click()},disabled:j,className:"inline-flex items-center gap-1 px-3 py-2 text-sm rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",title:"写真を選択",children:[j?e.jsx(a,{className:"w-4 h-4 animate-spin"}):e.jsx(o,{className:"w-4 h-4"}),"写真"]}),e.jsx("input",{ref:k,type:"file",accept:"image/*",className:"absolute -left-[9999px] top-0 w-px h-px opacity-0",onChange:e=>{var t;return ee((null==(t=e.target.files)?void 0:t[0])??null)}})]})]}),I&&e.jsxs("div",{className:"mt-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg p-3 flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-emerald-600 dark:text-emerald-300"}),e.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:I})]}),_&&e.jsx("div",{className:"mt-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 whitespace-pre-wrap",children:["写真/解析に失敗しました：",_]})}),v&&e.jsx("div",{className:"mt-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300",children:["栄養ログの取得に失敗しました：",v]})}),e.jsxs("div",{className:"mt-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-slate-50 dark:bg-slate-900/20 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-slate-700 dark:text-slate-200"}),e.jsx("p",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:"今日の結論"})]}),e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"※ 目安です"})]}),Y?f?e.jsx("div",{className:"mt-2 text-sm text-slate-600 dark:text-slate-300",children:"集計中…"}):e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:"不足（優先度）"}),Q&&Q.length>0?e.jsx("div",{className:"mt-1 space-y-1",children:Q.slice(0,2).map(t=>e.jsxs("div",{className:"text-sm text-slate-800 dark:text-slate-100",children:[e.jsx("span",{className:"font-semibold",children:t.label}),e.jsxs("span",{className:"ml-2 text-slate-600 dark:text-slate-300",children:["あと ",e.jsx("b",{children:t.remain})," ",t.unit]})]},t.key))}):e.jsx("div",{className:"mt-1 text-sm text-slate-700 dark:text-slate-200",children:"目標はだいたい到達（超過が気になる場合は脂質/間食を見直し）"}),X&&e.jsxs("div",{className:"mt-2 text-[11px] text-slate-600 dark:text-slate-300",children:["残り目安：P ",F(X.p,0).toFixed(1)," g / F ",F(X.f,0).toFixed(1)," g / C"," ",F(X.c,0).toFixed(1)," g / kcal ",Math.round(F(X.cal,0))]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:"次の一手（候補）"}),e.jsx("ul",{className:"mt-1 list-disc pl-5 space-y-1 text-sm text-slate-800 dark:text-slate-100",children:V.slice(0,3).map((t,a)=>e.jsx("li",{children:t},a))})]})]}):e.jsx("div",{className:"mt-2 text-sm text-slate-600 dark:text-slate-300",children:"体重データがあると、推定目標（BMR/TDEE/PFC）が出せます。"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(S,{dateLabel:R,totals:W,targets:Y,loading:f,bmrKcal:(null==H?void 0:H.bmrKcal)??null,tdeeKcal:(null==H?void 0:H.tdeeKcal)??null,onPrimaryAction:()=>{var e;return null==(e=k.current)?void 0:e.click()},primaryLabel:"食事を記録"})}),e.jsxs("div",{className:"mt-5",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"今日の記録"}),f?e.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"読み込み中..."}):Array.isArray(G)&&0!==G.length?e.jsx("div",{className:"mt-2 space-y-2",children:G.map(t=>{const a=function(e){if(!e)return[];if(Array.isArray(e))return e;if("string"==typeof e)try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}if("object"==typeof e){const t=Object.values(e);return Array.isArray(t)?t:[]}return[]}(null==t?void 0:t.menu_items).map(e=>function(e){return e?"string"==typeof e?e:`${(null==e?void 0:e.name)??""}${(null==e?void 0:e.note)?`(${e.note})`:""}${(null==e?void 0:e.estimated_amount)?` ${e.estimated_amount}`:""}`.trim()||"":""}(e)).filter(Boolean).join(" / ");return e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 min-w-0",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:"meal",className:"w-14 h-14 rounded-lg object-cover border border-gray-200 dark:border-gray-700 flex-none",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-14 h-14 rounded-lg bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 flex-none"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[C(t.meal_type,t.meal_slot),e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:[F(t.total_calories,0)," kcal"]}),t.analysis_status&&e.jsx("span",{className:"ml-2 text-[10px] px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:String(t.analysis_status)})]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["P ",F(t.p,0).toFixed(1)," / F ",F(t.f,0).toFixed(1)," / C ",F(t.c,0).toFixed(1),t.is_edited?"（編集済）":""]}),a&&e.jsxs("p",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400 break-words",children:["推定メニュー: ",a]}),t.advice_markdown&&e.jsx("p",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400 whitespace-pre-wrap",children:String(t.advice_markdown)}),"failed"===t.analysis_status&&t.analysis_error&&e.jsxs("p",{className:"mt-1 text-[11px] text-red-600 dark:text-red-400 whitespace-pre-wrap",children:["解析失敗: ",String(t.analysis_error)]})]})]}),e.jsx("button",{type:"button",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",onClick:()=>{U(t),z(!0)},children:"詳細"})]})},t.id)})}):e.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"まだ栄養記録がありません（朝/昼/夕/補食を追加していこう）"})]}),q&&B&&e.jsx(y,{open:q,log:B,onClose:()=>{z(!1),U(null)},onSaved:e=>{O(t=>Array.isArray(t)?t.map(t=>t.id===e.id?e:t):[]),z(!1),U(null),"function"==typeof N&&N(e)},onDeleted:e=>{O(t=>Array.isArray(t)?t.filter(t=>(null==t?void 0:t.id)!==e):[]),z(!1),U(null),"function"==typeof N&&N(null)}})]})}function P({user:t,date:a,nutritionLogs:r,nutritionTotals:l,nutritionLoading:s,nutritionError:n,onBackHome:i,latestInbody:o=null,trainingRecords:c=[],latestWeightKg:u=null,onRefreshNutrition:g}){const y=m.useMemo(()=>{const e=(null==r?void 0:r.filter(e=>"confirmed"===(null==e?void 0:e.status)||!0===(null==e?void 0:e.is_confirmed)||"success"===(null==e?void 0:e.analysis_status)).length)??0;return e>0?e:(null==r?void 0:r.length)??0},[r]),p=m.useMemo(()=>{const e=Math.min(y,3);return 0===e?"まだ記録がありません":1===e?"1つ進んだ":2===e?"2つ進んだ":"今日の基本3食がそろった"},[y]),h=m.useMemo(()=>{const e=l??{};return{cal:Number((null==e?void 0:e.cal)??(null==e?void 0:e.kcal)??(null==e?void 0:e.calories)??(null==e?void 0:e.total_calories)??0)||0,p:Number((null==e?void 0:e.p)??(null==e?void 0:e.protein_g)??(null==e?void 0:e.p_g)??(null==e?void 0:e.protein)??0)||0,f:Number((null==e?void 0:e.f)??(null==e?void 0:e.fat_g)??(null==e?void 0:e.f_g)??(null==e?void 0:e.fat)??0)||0,c:Number((null==e?void 0:e.c)??(null==e?void 0:e.carbs_g)??(null==e?void 0:e.c_g)??(null==e?void 0:e.carbs)??0)||0}},[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5 text-orange-500"}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"栄養（詳細）"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"AIは下書き。最後に決めるのはあなた。"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[(null==t?void 0:t.name)??"ユーザー","さん · ",a]}),e.jsx("div",{className:"mt-3",children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-200",children:["今日の進捗：",e.jsxs("b",{children:[Math.min(y,3),"/3"]}),e.jsx("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:p})]})})]}),e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"ホームへ"})]})]})}),e.jsx(I,{user:t,latestInbody:o,date:a,trainingRecords:c,nutritionLogs:r,nutritionTotals:h,nutritionLoading:s,nutritionError:n,latestWeightKg:u,onSaved:()=>{"function"==typeof g&&g()}})]})}export{P as default};
//# sourceMappingURL=AthleteNutritionDashboardView-B0c06uVF.js.map

{"version":3,"file":"CoachRankingsView-De1OIxUp.js","sources":["../../src/components/CoachRankingsView.tsx"],"sourcesContent":["// src/components/CoachRankingsView.tsx\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\nimport type { Team } from '../lib/supabase';\nimport { Trophy, RefreshCw, ChevronDown } from 'lucide-react';\n\ntype MetricKey = 'primary_value' | 'relative_1rm';\n\ntype TestType = {\n  id: string;\n  name: string;\n  display_name: string;\n  unit: string;\n  higher_is_better: boolean | null;\n  category_id: string;\n\n  sort_order?: number | null;\n  is_active?: boolean | null;\n  user_can_input?: boolean | null;\n\n  category_label?: string;\n  category_sort?: number | null;\n  is_strength?: boolean | null;\n};\n\ntype RankingRow = {\n  user_id: string;\n  name: string | null;\n  date: string | null; // YYYY-MM-DD\n  value: number | null;\n  rank: number | null;\n  top_percent: number | null;\n  team_n: number | null;\n};\n\ntype Props = {\n  team: Team;\n  onOpenAthlete?: (userId: string, testTypeId: string, metric: MetricKey, athleteName: string) => void;\n};\nexport type CoachRankingsViewProps = Props;\n\nconst strengthTestNames = new Set([\n  'bench_press',\n  'back_squat',\n  'deadlift',\n  'bulgarian_squat_r',\n  'bulgarian_squat_l',\n]);\n\n// ✅ 表示桁を「単位」で決める\nconst digitsForByUnit = (unit?: string) => {\n  const u = (unit || '').trim();\n\n  // 整数にしたい単位\n  const intUnits = new Set(['回', '点', 'm']); // 必要なら '本' '枚' など追加\n  if (intUnits.has(u)) return 0;\n\n  // それ以外は基本2桁\n  return 2;\n};\n\n// カテゴリ順（表示の好み）\nconst CATEGORY_ORDER = ['筋力', 'スプリント', 'ジャンプ', '敏捷', '持久', 'その他'];\n\n/**\n * ✅ ランキング方向\n * - DBの higher_is_better が false なら「小さいほど良い」\n * - それ以外でも「スプリント」「敏捷」は小さいほど良い（要望）\n *\n * ※ 今回はDB側で team_rank を返している前提なので、\n *    lowerIsBetter は「説明文表示」用途のみ（並び替えはしない）\n */\nconst isLowerBetterByRule = (t: TestType | null) => {\n  if (!t) return false;\n\n  if (t.higher_is_better === false) return true;\n  if (t.higher_is_better === true) return false;\n\n  const cat = t.category_label || '';\n  if (cat === 'スプリント' || cat === '敏捷') return true;\n\n  const name = (t.name || '').toLowerCase();\n  const timeLike =\n    name.startsWith('sprint_') ||\n    name === '050_r' ||\n    name === '050_l' ||\n    name === '050-l' ||\n    name.startsWith('pro_agility') ||\n    name.startsWith('arrowhead');\n\n  return timeLike;\n};\n\n// ✅ 「ランキングがどこ参照か」をラベル化（DBが返す benchmark_scope を想定）\nconst scopeLabel = (scope: string | null) => {\n  if (scope === 'team') return 'チーム内';\n  if (scope === 'org_sport') return '同校×同競技';\n  if (scope === 'sport') return '競技全体';\n  return '不明';\n};\n\nexport function CoachRankingsView({ team, onOpenAthlete }: Props) {\n  const [testTypes, setTestTypes] = useState<TestType[]>([]);\n  const [loadingTestTypes, setLoadingTestTypes] = useState(false);\n  const [testTypesError, setTestTypesError] = useState<string | null>(null);\n\n  const [selectedTestTypeId, setSelectedTestTypeId] = useState<string>('');\n  const selectedTestType = useMemo(\n    () => testTypes.find((t) => t.id === selectedTestTypeId) ?? null,\n    [testTypes, selectedTestTypeId]\n  );\n\n  const [metric, setMetric] = useState<MetricKey>('primary_value');\n  const isStrength = !!selectedTestType?.is_strength;\n\n  const unitLabel = useMemo(() => {\n    if (!selectedTestType) return '';\n    if (isStrength && metric === 'relative_1rm') return '×BW';\n    return selectedTestType.unit || '';\n  }, [selectedTestType, isStrength, metric]);\n\n  const lowerIsBetter = useMemo(() => isLowerBetterByRule(selectedTestType), [selectedTestType]);\n\n  const [ranking, setRanking] = useState<RankingRow[]>([]);\n  const [loadingRanking, setLoadingRanking] = useState(false);\n  const [rankingError, setRankingError] = useState<string | null>(null);\n\n  // ✅ 参照スコープ表示用（DBが返す meta を拾う）\n  const [benchmarkScope, setBenchmarkScope] = useState<string | null>(null);\n  const [benchmarkN, setBenchmarkN] = useState<number | null>(null);\n  const [minN, setMinN] = useState<number | null>(null);\n\n  // RPC死んでても画面が出るようにダミー\n  const dummyRanking: RankingRow[] = useMemo(\n    () => [\n      { user_id: 'dummy1', name: '田中', date: '2026-01-10', value: 73.3, rank: 1, top_percent: 0, team_n: 12 },\n      { user_id: 'dummy2', name: '佐藤', date: '2026-01-08', value: 71.2, rank: 2, top_percent: 8.3, team_n: 12 },\n      { user_id: 'dummy3', name: '鈴木', date: '2026-01-05', value: 69.0, rank: 3, top_percent: 16.7, team_n: 12 },\n    ],\n    []\n  );\n\n  // ----------------------------\n  // 種目一覧：カテゴリでoptgroup化\n  // ----------------------------\n  const grouped = useMemo(() => {\n    const map = new Map<string, TestType[]>();\n\n    for (const t of testTypes) {\n      const key = t.category_label || 'その他';\n      if (!map.has(key)) map.set(key, []);\n      map.get(key)!.push(t);\n    }\n\n    for (const [k, arr] of map.entries()) {\n      arr.sort((a, b) => {\n        const sa = a.sort_order ?? 9999;\n        const sb = b.sort_order ?? 9999;\n        if (sa !== sb) return sa - sb;\n        return (a.display_name || '').localeCompare(b.display_name || '', 'ja');\n      });\n      map.set(k, arr);\n    }\n\n    return Array.from(map.entries()).sort((a, b) => {\n      const ai = CATEGORY_ORDER.indexOf(a[0]);\n      const bi = CATEGORY_ORDER.indexOf(b[0]);\n      const aRank = ai === -1 ? 999 : ai;\n      const bRank = bi === -1 ? 999 : bi;\n      if (aRank !== bRank) return aRank - bRank;\n      return a[0].localeCompare(b[0], 'ja');\n    });\n  }, [testTypes]);\n\n  // ----------------------------\n  // 1) テスト種目一覧 取得\n  // ----------------------------\n  useEffect(() => {\n    let cancelled = false;\n\n    (async () => {\n      try {\n        setLoadingTestTypes(true);\n        setTestTypesError(null);\n\n        const { data, error } = await supabase\n          .from('performance_test_types')\n          .select(\n            `\n              id,\n              name,\n              display_name,\n              unit,\n              higher_is_better,\n              is_strength,\n              category_id,\n              sort_order,\n              is_active,\n              user_can_input,\n              performance_categories (\n                id,\n                name,\n                display_name,\n                sort_order\n              )\n            `\n          )\n          .eq('is_active', true)\n          .order('sort_order', { ascending: true });\n\n        if (error) throw error;\n\n        const rows = (data ?? []) as any[];\n        const types: TestType[] = rows.map((r) => ({\n          id: r.id,\n          name: r.name,\n          display_name: r.display_name,\n          unit: r.unit,\n          higher_is_better: r.higher_is_better,\n          category_id: r.category_id,\n          sort_order: r.sort_order ?? null,\n          is_active: r.is_active,\n          user_can_input: r.user_can_input,\n          category_label:\n            r.performance_categories?.display_name || r.performance_categories?.name || 'その他',\n          category_sort: r.performance_categories?.sort_order ?? 999,\n          is_strength: r.is_strength ?? null,\n        }));\n\n        if (cancelled) return;\n\n        setTestTypes(types);\n\n        // 初期選択\n        if (!selectedTestTypeId && types.length > 0) {\n          setSelectedTestTypeId(types[0].id);\n        }\n      } catch (e: any) {\n        console.warn('[CoachRankingsView] testTypes error', e);\n        if (!cancelled) setTestTypesError(e?.message ?? '種目の取得に失敗しました');\n      } finally {\n        if (!cancelled) setLoadingTestTypes(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [team?.id]);\n\n  // 種目が変わったら、筋力以外は metric を primary に戻す\n  useEffect(() => {\n    if (!selectedTestType) return;\n    if (!selectedTestType.is_strength) setMetric('primary_value');\n  }, [selectedTestType?.id]);\n\n  // ----------------------------\n  // 2) ランキング取得（RPC：get_team_test_ranking）\n  // ----------------------------\n  const fetchRanking = async () => {\n    if (!team?.id || !selectedTestTypeId) return;\n\n    try {\n      setLoadingRanking(true);\n      setRankingError(null);\n\n      const { data, error } = await supabase.rpc('get_team_test_ranking', {\n        p_days: 365,\n        p_limit: 50,\n        p_metric: metric,\n        p_team_id: team.id,\n        p_test_type_id: selectedTestTypeId,\n        p_min_n: 5,\n      });\n\n      if (error) throw error;\n\n      const rows = (data ?? []) as any[];\n\n      // ✅ 参照スコープを表示するためのメタ情報（DBが返す想定）\n      const meta = rows?.[0] ?? null;\n      setBenchmarkScope(meta?.benchmark_scope ?? null);\n      setBenchmarkN(meta?.benchmark_n != null ? Number(meta.benchmark_n) : null);\n      setMinN(meta?.min_n != null ? Number(meta.min_n) : null);\n\n      const mapped: RankingRow[] = rows.map((r) => ({\n        user_id: r.user_id,\n        name: r.name ?? null,\n        date: r.latest_date ?? null,\n        value: r.latest_value != null ? Number(r.latest_value) : null,\n        rank: r.team_rank != null ? Number(r.team_rank) : null,\n        top_percent: r.top_percent != null ? Number(r.top_percent) : null,\n        team_n: r.team_n != null ? Number(r.team_n) : null,\n      }));\n\n      setRanking(mapped);\n    } catch (e: any) {\n      console.warn('[CoachRankingsView] ranking error', e);\n      setRankingError(e?.message ?? 'ランキング取得に失敗しました');\n      setRanking(dummyRanking);\n\n      // ✅ フォールバック時は参照スコープ表示は出さない\n      setBenchmarkScope(null);\n      setBenchmarkN(null);\n      setMinN(null);\n    } finally {\n      setLoadingRanking(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchRanking();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [team?.id, selectedTestTypeId, metric]);\n\n  const displayName = (r: RankingRow) => r.name || '名前未設定';\n\n  const fmtValue = (v: number | null) => {\n    if (v == null) return '-';\n\n    const d = digitsForByUnit(unitLabel); // ← unitLabel を使うのがポイント\n    const n = Number(v);\n\n    // d=0 のときは 73.0 みたいなブレをなくす\n    if (d === 0) return String(Math.round(n));\n\n    return n.toFixed(d);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n        <div className=\"flex items-start justify-between gap-3\">\n          <div className=\"min-w-0\">\n            <div className=\"flex items-center gap-2\">\n              <Trophy className=\"w-5 h-5 text-amber-500\" />\n              <div className=\"text-base sm:text-lg font-semibold text-gray-900\">ランキング</div>\n            </div>\n            <div className=\"text-xs text-gray-500 mt-1\">\n              種目ごとに「最新測定」の値で順位付け（チーム内）／\n              {lowerIsBetter ? '小さいほど上位' : '大きいほど上位'}\n            </div>\n          </div>\n\n          <button\n            onClick={fetchRanking}\n            className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg border bg-white hover:bg-gray-50 text-sm\"\n            title=\"再取得\"\n          >\n            <RefreshCw className={`w-4 h-4 ${loadingRanking ? 'animate-spin' : ''}`} />\n            更新\n          </button>\n        </div>\n\n        {/* 種目セレクタ */}\n        <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3\">\n          <div className=\"relative\">\n            <select\n              value={selectedTestTypeId}\n              onChange={(e) => setSelectedTestTypeId(e.target.value)}\n              className=\"w-full appearance-none px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm bg-white\"\n              disabled={loadingTestTypes}\n            >\n              {grouped.map(([label, items]) => (\n                <optgroup key={label} label={label}>\n                  {items.map((t) => (\n                    <option key={t.id} value={t.id}>\n                      {t.display_name}\n                    </option>\n                  ))}\n                </optgroup>\n              ))}\n            </select>\n            <ChevronDown className=\"w-4 h-4 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\" />\n          </div>\n\n          {/* 筋力のみ metric 切替 */}\n          <div className=\"flex items-center justify-between\">\n            {isStrength ? (\n              <div className=\"inline-flex rounded-lg bg-gray-100 p-1 text-[12px]\">\n                <button\n                  type=\"button\"\n                  onClick={() => setMetric('primary_value')}\n                  className={`px-3 py-1.5 rounded-md ${\n                    metric === 'primary_value' ? 'bg-white shadow text-gray-900' : 'text-gray-600'\n                  }`}\n                >\n                  推定1RM\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => setMetric('relative_1rm')}\n                  className={`px-3 py-1.5 rounded-md ${\n                    metric === 'relative_1rm' ? 'bg-white shadow text-gray-900' : 'text-gray-600'\n                  }`}\n                >\n                  相対1RM\n                </button>\n              </div>\n            ) : (\n              <div className=\"text-sm text-gray-500\">（筋力以外は自動）</div>\n            )}\n\n            <div className=\"text-sm text-gray-700\">\n              単位：<span className=\"font-semibold\">{unitLabel || '-'}</span>\n            </div>\n          </div>\n        </div>\n\n        {testTypesError && <div className=\"mt-3 text-sm text-red-600\">{testTypesError}</div>}\n      </div>\n\n      {/* ランキング表 */}\n      <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n        <div className=\"px-4 sm:px-5 py-3 border-b border-gray-100 flex items-center justify-between\">\n          <div className=\"text-sm font-semibold text-gray-900\">\n            {selectedTestType?.display_name ?? '種目'} の順位\n          </div>\n\n          {/* ✅ 参照スコープ表示（DBが返す時だけ表示） */}\n          <div className=\"text-xs text-gray-500\">\n            {benchmarkScope ? (\n              <>\n                比較：{scopeLabel(benchmarkScope)}\n                {typeof benchmarkN === 'number' ? `（n=${benchmarkN}）` : ''}\n                {typeof minN === 'number' ? ` / 閾値=${minN}` : ''}\n              </>\n            ) : ranking?.[0]?.team_n ? (\n              `n=${ranking[0].team_n}`\n            ) : (\n              ''\n            )}\n          </div>\n        </div>\n\n        {/* ✅ 自動拡張をしている場合の注意（任意だけど親切） */}\n        {benchmarkScope && benchmarkScope !== 'team' && (\n          <div className=\"px-4 sm:px-5 py-2 text-[11px] text-amber-700 bg-amber-50 border-b border-amber-100\">\n            ※チーム内の母集団が少ないため、比較母集団を自動で拡張しています\n          </div>\n        )}\n\n        {rankingError && (\n          <div className=\"px-4 sm:px-5 py-3 text-sm text-amber-700 bg-amber-50 border-b border-amber-100\">\n            {rankingError}\n            <span className=\"ml-2 text-xs text-amber-600\">（RPC未整備ならダミー表示になります）</span>\n          </div>\n        )}\n\n        {loadingRanking ? (\n          <div className=\"flex items-center justify-center py-16\">\n            <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n          </div>\n        ) : ranking.length === 0 ? (\n          <div className=\"py-12 text-center text-sm text-gray-500\">\n            データがありません（この種目の測定がまだ無い可能性）\n          </div>\n        ) : (\n          <div className=\"divide-y\">\n            {ranking.map((r) => (\n              <button\n                key={`${r.user_id}-${r.rank ?? 'x'}`}\n                className=\"w-full text-left px-4 sm:px-5 py-3 hover:bg-gray-50\"\n                onClick={() => {\n                  if (onOpenAthlete) onOpenAthlete(r.user_id, selectedTestTypeId, metric, displayName(r));\n                }}\n              >\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div className=\"min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"text-base font-bold text-gray-900 w-10\">{r.rank ?? '-'}位</div>\n                      <div className=\"font-semibold text-gray-900 truncate\">{displayName(r)}</div>\n                      {typeof r.top_percent === 'number' && (\n                        <span className=\"text-[11px] px-2 py-1 rounded-full border bg-amber-50 text-amber-800 border-amber-200\">\n                          上位 {Number(r.top_percent).toFixed(1)}%\n                        </span>\n                      )}\n                    </div>\n\n                    <div className=\"mt-1 text-xs text-gray-600\">最終測定日：{r.date ?? '-'}</div>\n                    {benchmarkScope && (\n                      <div className=\"mt-0.5 text-[11px] text-gray-500\">\n                        基準：{scopeLabel(benchmarkScope)}\n                        {typeof benchmarkN === 'number' ? `（n=${benchmarkN}）` : ''}\n                        {typeof minN === 'number' ? ` / 閾値=${minN}` : ''}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"text-right\">\n                    <div className=\"text-xl font-bold text-blue-600\">\n                      {fmtValue(r.value)}\n                      <span className=\"text-sm font-semibold text-gray-600 ml-1\">{unitLabel}</span>\n                    </div>\n                  </div>\n                </div>\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div className=\"text-xs text-gray-500\">※ 仕様：各選手の「最新記録」で順位付け（同値は rank() で同順位）</div>\n    </div>\n  );\n}\n\nexport default CoachRankingsView;"],"names":["CATEGORY_ORDER","scopeLabel","scope","CoachRankingsView","team","onOpenAthlete","testTypes","setTestTypes","useState","loadingTestTypes","setLoadingTestTypes","testTypesError","setTestTypesError","selectedTestTypeId","setSelectedTestTypeId","selectedTestType","useMemo","find","t","id","metric","setMetric","isStrength","is_strength","unitLabel","unit","lowerIsBetter","higher_is_better","cat","category_label","name","toLowerCase","startsWith","isLowerBetterByRule","ranking","setRanking","loadingRanking","setLoadingRanking","rankingError","setRankingError","benchmarkScope","setBenchmarkScope","benchmarkN","setBenchmarkN","minN","setMinN","dummyRanking","user_id","date","value","rank","top_percent","team_n","grouped","map","Map","key","has","set","get","push","k","arr","entries","sort","a","b","sa","sort_order","sb","display_name","localeCompare","Array","from","ai","indexOf","bi","aRank","bRank","useEffect","cancelled","data","error","supabase","select","eq","order","ascending","types","r","category_id","is_active","user_can_input","_a","performance_categories","_b","category_sort","_c","length","e","console","warn","message","fetchRanking","async","rpc","p_days","p_limit","p_metric","p_team_id","p_test_type_id","p_min_n","rows","meta","benchmark_scope","benchmark_n","Number","min_n","mapped","latest_date","latest_value","team_rank","displayName","fmtValue","v","d","u","trim","Set","digitsForByUnit","n","String","Math","round","toFixed","jsxs","className","children","jsx","Trophy","onClick","title","RefreshCw","onChange","target","disabled","label","items","ChevronDown","type","Fragment"],"mappings":"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"}
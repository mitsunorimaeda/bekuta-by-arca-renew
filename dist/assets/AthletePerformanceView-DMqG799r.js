import{a7 as ge,a8 as K,j as e,a9 as he,N as U,E as Q,V as pe,aa as be,K as de,ab as ye,P as O,Y as fe,ac as _e,ad as je,s as ae,ae as ce,Z as G,af as ke,y as ve}from"./index-C7IL5YWP.js";import{r as x}from"./chart-vendor-B8I3tXXj.js";import{P as we}from"./PerformanceChart-B8Th93D_.js";import"./supabase-vendor-CRHRt2Ih.js";const H={cooperTest:s=>s<=0?0:Math.max(0,(s-504.9)/44.73),run1500m:(s,t)=>s*60+t,yoyoIR1:s=>s<=0?0:s*.0084+36.4,yoyoIR2:s=>s<=0?0:s*.0136+45.3,shuttleRun20m:s=>{if(s<=0)return 0;const t={8:27.8,9:28,10:28.3,11:28.5,12:28.7,13:28.9,14:29.2,15:29.4,16:29.6,17:29.8,18:30.1,19:30.3,20:30.5,21:30.7,22:31,23:31.2,24:31.4,25:31.6,26:31.9,27:32.1,28:32.3,29:32.5,30:32.8,31:33,32:33.2,33:33.4,34:33.7,35:33.9,36:34.1,37:34.3,38:34.6,39:34.8,40:35,41:35.2,42:35.5,43:35.7,44:35.9,45:36.1,46:36.4,47:36.6,48:36.8,49:37,50:37.3,51:37.5,52:37.7,53:37.9,54:38.2,55:38.4,56:38.6,57:38.8,58:39.1,59:39.3,60:39.5,61:39.7,62:40,63:40.2,64:40.4,65:40.6,66:40.9,67:41.1,68:41.3,69:41.5,70:41.8,71:42,72:42.2,73:42.4,74:42.7,75:42.9,76:43.1,77:43.3,78:43.6,79:43.8,80:44,81:44.2,82:44.5,83:44.7,84:44.9,85:45.1,86:45.4,87:45.6,88:45.8,89:46,90:46.3,91:46.5,92:46.7,93:46.9,94:47.2,95:47.4,96:47.6,97:47.8,98:48.1,99:48.3,100:48.5,101:48.7,102:49,103:49.2,104:49.4,105:49.6,106:49.9,107:50.1,108:50.3,109:50.5,110:50.8,111:51,112:51.2,113:51.4,114:51.7,115:51.9,116:52.1,117:52.3,118:52.6,119:52.8,120:53,121:53.2,122:53.5,123:53.7,124:53.9,125:54.1,126:54.4,127:54.6,128:54.8,129:55,130:55.3,131:55.5,132:55.7,133:55.9,134:56.2,135:56.4,136:56.6,137:56.8,138:57.1,139:57.3,140:57.5,141:57.7,142:58,143:58.2,144:58.4,145:58.6,146:58.9,147:59.1,148:59.5,149:59.8,150:60,151:60.2,152:60.4,153:60.7,154:60.9,155:61.1,156:61.1,157:61.3};if(t[s])return t[s];if(s<8)return 27.8;if(s>157)return 61.3+.2*(s-157);const p=Math.floor(s),d=Math.ceil(s);return t[p]+(t[d]-t[p])*(s-p)}},me={epley:(s,t)=>s<=0||t<=0?0:t===1?s:Math.round(s*(1+t/30)*10)/10,brzycki:(s,t)=>s<=0||t<=0||t>=37?0:t===1?s:Math.round(s*(36/(37-t))*10)/10};function Ne(s,t){try{switch(s){case"cmj":case"cmj_as":return parseFloat(t.height)||null;case"standing_long_jump":case"standing_five_jump":return parseFloat(t.distance)||null;case"dj_rsi":return t.height&&t.contact_time?parseFloat(t.height)/100/(parseFloat(t.contact_time)/1e3):null;case"rj_rsi":return t.avg_height&&t.avg_contact_time?parseFloat(t.avg_height)/100/(parseFloat(t.avg_contact_time)/1e3):null;case"cooper_test":return H.cooperTest(parseFloat(t.distance));case"1500m_run":return H.run1500m(parseFloat(t.time_minutes),parseFloat(t.time_seconds));case"yoyo_ir1":return H.yoyoIR1(parseFloat(t.distance));case"yoyo_ir2":return H.yoyoIR2(parseFloat(t.distance));case"shuttle_run_20m":return H.shuttleRun20m(parseFloat(t.count));case"bench_press":case"back_squat":case"deadlift":return me.epley(parseFloat(t.weight),parseFloat(t.reps));case"bulgarian_squat_r":case"bulgarian_squat_l":return me.epley(parseFloat(t.weight),parseFloat(t.reps));case"sqj":return parseFloat(t.height)||null;case"1000m_run":return parseFloat(t.time_minutes)*60+parseFloat(t.time_seconds);case"pull_up":return parseFloat(t.count)||null;case"side_step_test":return parseFloat(t.count)||null;case"050_r":case"050-l":case"pro_agility_r":case"pro_agility_l":case"arrowhead_r":case"arrowhead_l":return parseFloat(t.time)||null;case"sprint_5m":case"sprint_10m":case"sprint_15m":case"sprint_20m":case"sprint_30m":case"sprint_50m":return parseFloat(t.time)||null;default:return null}}catch(p){return console.error("Error calculating primary value:",p),null}}function X(s){switch(s){case"cmj":case"cmj_as":case"standing_long_jump":case"standing_five_jump":return"cm";case"cooper_test":case"yoyo_ir1":case"yoyo_ir2":case"shuttle_run_20m":return"ml/kg/min";case"1000m_run":case"1500m_run":case"arrowhead_r":case"arrowhead_l":case"050_r":case"050-l":case"pro_agility_r":case"pro_agility_l":return"Áßí";case"bench_press":case"back_squat":case"deadlift":case"bulgarian_squat_r":case"bulgarian_squat_l":return"kg";case"dj_rsi":case"rj_rsi":return"RSI";case"sprint_5m":case"sprint_10m":case"sprint_15m":case"sprint_20m":case"sprint_30m":case"sprint_50m":return"Áßí";default:return""}}function Fe(s){switch(s){case"sqj":case"cmj":case"cmj_as":return"Ë∑≥Ë∫çÈ´ò";case"standing_long_jump":case"standing_five_jump":return"Ë∑ùÈõ¢";case"cooper_test":case"yoyo_ir1":case"yoyo_ir2":case"shuttle_run_20m":return"Êé®ÂÆöVO2max";case"1500m_run":case"1000m_run":case"arrowhead_r":case"arrowhead_l":case"050_r":case"050-l":case"pro_agility_r":case"pro_agility_l":return"„Çø„Ç§„É†";case"bench_press":case"back_squat":case"deadlift":case"bulgarian_squat_r":case"bulgarian_squat_l":return"Êé®ÂÆö1RM";case"dj_rsi":case"rj_rsi":return"RSI";default:return"Ë®àÁÆóÂÄ§"}}const Z=["bench_press","back_squat","deadlift","bulgarian_squat_r","bulgarian_squat_l"];function Se({userId:s,userRole:t,testTypes:p,onSubmit:d,onCheckExisting:j,onUpdate:c,loading:u,lastRecords:i,personalBests:y}){var ne;const{getLatestWeight:R}=ge(s),[_,k]=x.useState(""),[l,N]=x.useState(K()),[F,P]=x.useState({}),[V,D]=x.useState(""),[I,q]=x.useState(!1),[n,b]=x.useState(""),[m,w]=x.useState(!1),[h,E]=x.useState(null),[a,v]=x.useState(null),[f,C]=x.useState(!1),[B,g]=x.useState(null),[L,M]=x.useState(null),o=p.find(r=>r.id===_);x.useEffect(()=>{if(o){const r={};if(Array.isArray(o.fields)&&o.fields.forEach(S=>{r[S.name]=""}),P(r),o&&Z.includes(o.name)){const S=R();console.log("üèãÔ∏è Strength test selected, latest weight:",S),E(S)}else E(null),v(null)}},[o]);const J=r=>o?Ne(o.name,r):null,A=async r=>{if(r.preventDefault(),b(""),!o){b("Ê∏¨ÂÆöÁ®ÆÁõÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ");return}const $=Array.isArray(o.fields)?o.fields.filter(T=>T.required):[];for(const T of $)if(!F[T.name]||F[T.name]===""){b(`${T.label}„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`);return}const S=J(F);if(S===null){b("Ë®àÁÆó„Åß„Åç„Å™„ÅÑÂÄ§„ÅåÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô");return}const ie=o&&Z.includes(o.name),z={...F,primary_value:S,...ie&&h?{relative_1rm:a,weight_at_test:h}:{}},W=await j(_,l);if(W){g(W),M({test_type_id:_,date:l,values:z,notes:V||void 0,is_official:!0}),C(!0);return}q(!0);try{(await d({test_type_id:_,date:l,values:z,notes:V||void 0,is_official:!0})).isNewPersonalBest&&(w(!0),setTimeout(()=>w(!1),5e3)),P({}),D(""),k(""),N(K()),v(null),E(null)}catch(T){console.error("Error submitting performance record:",T),b("Ë®òÈå≤„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{q(!1)}},Y=async()=>{if(!(!B||!L)){q(!0),C(!1);try{await c(B.id,{values:L.values,notes:L.notes}),P({}),D(""),k(""),N(K()),g(null),M(null),v(null),E(null)}catch(r){console.error("Error updating record:",r),b("Ë®òÈå≤„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}finally{q(!1)}}},se=()=>{C(!1),g(null),M(null)},re=(r,$)=>{const S={...F,[r]:$};if(P(S),o&&Z.includes(o.name)&&(r==="weight"||r==="reps")&&h){const z=parseFloat(S.weight||"0"),W=parseFloat(S.reps||"0");if(console.log("üí™ Calculating relative 1RM from:",{weight:z,reps:W,latestWeight:h}),z>0&&W>0){const T=z*(1+W/30),oe=T/h;console.log("‚úÖ 1RM:",T.toFixed(1),"kg, Relative 1RM:",oe.toFixed(2)),v(Math.round(oe*100)/100)}else v(null)}},le=()=>{const r=J(F);return r===null?"-":r.toFixed(1)},xe=()=>o?X(o.name)||o.unit:"",ue=()=>o?Fe(o.name):"Ë®àÁÆóÂÄ§",ee=i==null?void 0:i.get(_),te=y==null?void 0:y.get(_);return e.jsxs(e.Fragment,{children:[e.jsx(he,{isOpen:f,onClose:se,onOverwrite:Y,onCancel:se,existingRecord:B,newValue:((ne=L==null?void 0:L.values)==null?void 0:ne.primary_value)||0}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[m&&e.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/30 border-2 border-yellow-400 dark:border-yellow-600 rounded-xl p-4 animate-bounce-subtle",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-yellow-900 dark:text-yellow-100",children:"üéâ „Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„ÉàÊõ¥Êñ∞ÔºÅ"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅËá™Â∑±ÊúÄÈ´òË®òÈå≤„ÇíÈÅîÊàê„Åó„Åæ„Åó„ÅüÔºÅ"})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Ê∏¨ÂÆöÊó•"]}),e.jsx("input",{type:"date",value:l,onChange:r=>N(r.target.value),max:K(),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white",style:{fontSize:"16px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ê∏¨ÂÆöÁ®ÆÁõÆ"}),e.jsxs("select",{value:_,onChange:r=>k(r.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white",style:{fontSize:"16px"},children:[e.jsx("option",{value:"",children:"Ê∏¨ÂÆöÁ®ÆÁõÆ„ÇíÈÅ∏Êäû"}),p.filter(r=>r.user_can_input!==!1).map(r=>e.jsx("option",{value:r.id,children:r.display_name},r.id)),p.filter(r=>r.user_can_input===!1).map(r=>e.jsxs("option",{value:r.id,disabled:!0,className:"text-gray-400",children:["üîí ",r.display_name,"ÔºàÂ∞ÇÈñÄÊ•≠ËÄÖÊ∏¨ÂÆöÔºâ"]},r.id))]}),o&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.description}),o.user_can_input===!1&&e.jsxs("div",{className:"mt-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3 flex items-start",children:[e.jsx(pe,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:[e.jsx("p",{className:"font-semibold",children:"Â∞ÇÈñÄÊ•≠ËÄÖ„Å´„Çà„ÇãÊ∏¨ÂÆö„ÅåÂøÖË¶Å„Åß„Åô"}),e.jsx("p",{className:"mt-1",children:"„Åì„ÅÆÊ∏¨ÂÆö„ÅØÂ∞ÇÁî®Ê©üÂô®„ÅåÂøÖË¶Å„Å™„Åü„ÇÅ„ÄÅÂÄã‰∫∫„Åß„ÅÆÂÖ•Âäõ„ÅØ„Åß„Åç„Åæ„Åõ„Çì„ÄÇÊ∏¨ÂÆö„Éá„Éº„Çø„ÅØÂ∞ÇÈñÄÊ•≠ËÄÖ„Å´„Çà„Å£„Å¶Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ"})]})]})]})]}),o&&Array.isArray(o.fields)&&e.jsxs(e.Fragment,{children:[ee&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"text-blue-600 dark:text-blue-400 mb-1",children:"ÂâçÂõû„ÅÆË®òÈå≤"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:[ee.values.primary_value," ",o.unit," (",new Date(ee.date).toLocaleDateString("ja-JP"),")"]})]}),te&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-3 text-sm",children:[e.jsxs("p",{className:"text-yellow-600 dark:text-yellow-400 mb-1 flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"]}),e.jsxs("p",{className:"text-yellow-700 dark:text-yellow-300 font-semibold",children:[te.value," ",o.unit," (",new Date(te.date).toLocaleDateString("ja-JP"),")"]})]}),e.jsx("div",{className:"space-y-4",children:o.fields.map(r=>{var $;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.label," ",r.required&&e.jsx("span",{className:"text-red-500",children:"*"}),r.unit&&e.jsxs("span",{className:"text-gray-500 text-xs ml-1",children:["(",r.unit,")"]})]}),r.type==="select"?e.jsxs("select",{value:F[r.name]||"",onChange:S=>re(r.name,S.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bgÁôΩ dark:bg-gray-700 dark:text-white",style:{fontSize:"16px"},children:[e.jsxs("option",{value:"",children:[r.label,"„ÇíÈÅ∏Êäû"]}),($=r.options)==null?void 0:$.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))]}):e.jsx("input",{type:r.type==="text"?"text":"number",inputMode:r.type==="text"?"text":"decimal",step:r.type==="text"?void 0:"0.01",min:r.type==="text"?void 0:0,value:F[r.name]||"",onChange:S=>re(r.name,S.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white",placeholder:r.label,style:{fontSize:"16px"}})]},r.name)})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:ue()}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[le()," ",xe()]})]})}),o&&Z.includes(o.name)&&e.jsxs("div",{className:"space-y-3",children:[h&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Ê∏¨ÂÆöÊôÇ„ÅÆ‰ΩìÈáç"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[h.toFixed(1)," kg"]})]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"ÊúÄÊñ∞„ÅÆ‰ΩìÈáçË®òÈå≤„Åã„ÇâËá™ÂãïÂèñÂæó"})]}),a&&h&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-4 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Áõ∏ÂØæ1RMÔºà‰ΩìÈáçÊØîÔºâ"}),e.jsx("span",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:a.toFixed(2)})]}),e.jsxs("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:["1RM ",le()," kg √∑ ‰ΩìÈáç ",h.toFixed(1)," kg = ",a.toFixed(2)]})]}),!h&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(de,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-200",children:"‰ΩìÈáçË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mt-1",children:"Áõ∏ÂØæ1RMÔºà‰ΩìÈáçÊØîÔºâ„ÇíË®àÁÆó„Åô„Çã„Å´„ÅØ„ÄÅ‰ΩìÈáçË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),e.jsx("textarea",{value:V,onChange:r=>D(r.target.value),rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white resize-none",placeholder:"„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÇÑÊ∞ó„Å•„ÅÑ„Åü„Åì„Å®„ÇíË®òÈå≤...",style:{fontSize:"16px"}})]}),n&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:n})]})}),e.jsxs("button",{type:"submit",disabled:I||u||!_||(o==null?void 0:o.user_can_input)===!1,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:[I?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):e.jsx(ye,{className:"w-5 h-5 mr-2"}),I?"Ë®òÈå≤‰∏≠...":"Ê∏¨ÂÆöË®òÈå≤„ÇíËøΩÂä†"]})]})]})}function Me({records:s,personalBests:t,loading:p}){const d=u=>{const i=t.find(y=>y.test_type_id===u.test_type_id);return(i==null?void 0:i.date)===u.date&&(i==null?void 0:i.value)===u.values.primary_value},j=(u,i)=>{if(!u.test_type)return null;const y=s.filter(N=>N.test_type_id===u.test_type_id).filter(N=>new Date(N.date)<new Date(u.date)).sort((N,F)=>new Date(F.date).getTime()-new Date(N.date).getTime())[0];if(!y)return null;const R=u.values.primary_value,_=y.values.primary_value,k=typeof R=="string"?parseFloat(R):R,l=typeof _=="string"?parseFloat(_):_;return!l||l===0||isNaN(k)||isNaN(l)?null:(k-l)/Math.abs(l)*100};if(p)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(s.length===0)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(O,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"„Åæ„Å†Ê∏¨ÂÆöË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:"ÊúÄÂàù„ÅÆË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„ÄÅÊàêÈï∑„ÇíËøΩË∑°„Åó„Åæ„Åó„Çá„ÅÜÔºÅ"})]});const c=s.reduce((u,i)=>{if(!i.test_type)return u;const y=i.test_type.display_name;return u[y]||(u[y]=[]),u[y].push(i),u},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ê∏¨ÂÆöË®òÈå≤Â±•Ê≠¥"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ÂÖ® ",s.length," ‰ª∂"]})]}),Object.entries(c).map(([u,i])=>{var y,R,_,k;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden transition-colors",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:u}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:[X(((y=i[0].test_type)==null?void 0:y.name)||"")||((R=i[0].test_type)==null?void 0:R.unit)," - ",(_=i[0].test_type)!=null&&_.higher_is_better?"È´ò„ÅÑÊñπ„ÅåËâØ„ÅÑ":"‰Ωé„ÅÑÊñπ„ÅåËâØ„ÅÑ"]})]}),((k=i[0].test_type)==null?void 0:k.user_can_input)===!1&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Â∞ÇÈñÄÊ•≠ËÄÖÊ∏¨ÂÆö"]})]})}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.map((l,N)=>{var V,D,I,q,n,b;const F=d(l),P=j(l);return e.jsx("div",{className:`p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors ${F?"bg-yellow-50 dark:bg-yellow-900/10 border-l-4 border-yellow-400":""}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(l.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}),F&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"PB"]})]}),e.jsxs("div",{className:"flex items-baseline space-x-2 mb-2",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{var h;const m=l.values.primary_value;return(typeof m=="string"?parseFloat(m):m).toFixed((h=l.test_type)!=null&&h.name.includes("rsi")?2:1)})()}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:X(((V=l.test_type)==null?void 0:V.name)||"")||((D=l.test_type)==null?void 0:D.unit)}),P!==null&&e.jsxs("span",{className:`text-sm font-medium flex items-center ${P>0&&((I=l.test_type)!=null&&I.higher_is_better)||P<0&&!((q=l.test_type)!=null&&q.higher_is_better)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[P>0&&((n=l.test_type)!=null&&n.higher_is_better)||P<0&&!((b=l.test_type)!=null&&b.higher_is_better)?e.jsx(U,{className:"w-4 h-4 mr-1"}):e.jsx(_e,{className:"w-4 h-4 mr-1"}),Math.abs(P).toFixed(1),"%"]})]}),l.test_type&&["bench_press","back_squat","deadlift","bulgarian_squat_r","bulgarian_squat_l"].includes(l.test_type.name)&&l.values.relative_1rm&&e.jsxs("div",{className:"mb-2 inline-flex items-center px-3 py-1.5 rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20",children:[e.jsx("span",{className:"text-xs font-medium text-purple-700 dark:text-purple-300 mr-2",children:"Áõ∏ÂØæ1RM:"}),e.jsx("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:typeof l.values.relative_1rm=="string"?parseFloat(l.values.relative_1rm).toFixed(2):l.values.relative_1rm.toFixed(2)}),l.values.weight_at_test&&e.jsxs("span",{className:"text-xs text-purple-600 dark:text-purple-400 ml-2",children:["(‰ΩìÈáç ",typeof l.values.weight_at_test=="string"?parseFloat(l.values.weight_at_test).toFixed(1):l.values.weight_at_test.toFixed(1)," kg)"]})]}),l.test_type&&Array.isArray(l.test_type.fields)&&e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-400",children:l.test_type.fields.map(m=>{const w=l.values[m.name];return w==null||w===""?null:e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[m.label,":"]})," ",w," ",m.unit]},m.name)})}),l.notes&&e.jsxs("div",{className:"mt-2 flex items-start space-x-2",children:[e.jsx(je,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l.notes})]})]})})},l.id)})})]},u)})]})}function Re(s,t,p){var j;let d=null;for(const c of s){const u=(j=c==null?void 0:c.values)==null?void 0:j[t],i=typeof u=="string"?parseFloat(u):u;if(i==null||Number.isNaN(i))continue;if(!d){d={value:i,date:c.date};continue}(p?i>d.value:i<d.value)&&(d={value:i,date:c.date})}return d?{value:d.value,date:d.date}:void 0}function Ce(s){return(s??[]).map(t=>{const p=(t==null?void 0:t.month_start)??(t==null?void 0:t.month)??(t==null?void 0:t.month_start_date)??(t==null?void 0:t.month_start_at)??(t==null?void 0:t.month_begin)??null,d=(t==null?void 0:t.team_avg)??(t==null?void 0:t.avg)??(t==null?void 0:t.mean)??(t==null?void 0:t.team_mean)??null,j=(t==null?void 0:t.team_n)??(t==null?void 0:t.n)??(t==null?void 0:t.count)??null;return p?{month_start:String(p),team_avg:d==null?null:Number(d),team_n:j==null?null:Number(j)}:null}).filter(Boolean)}function Pe({testTypes:s,records:t,personalBests:p,getRecordsByTestType:d,getPersonalBest:j}){const[c,u]=x.useState(null),[i,y]=x.useState({}),[R,_]=x.useState({}),[k,l]=x.useState({}),[N,F]=x.useState({}),[P,V]=x.useState(!1),D=["bench_press","back_squat","deadlift","bulgarian_squat_r","bulgarian_squat_l"],[I,q]=x.useState({}),n=x.useMemo(()=>c?s.find(a=>a.id===c):null,[c,s]),b=x.useMemo(()=>c?d(c):[],[c,d]),m=x.useMemo(()=>!c||!n||!D.includes(n.name)?"primary_value":I[c]??"primary_value",[c,n,I]),w=x.useMemo(()=>{if(!n||b.length===0)return;const a=n.higher_is_better??!0;return Re(b,m,a)},[n,b,m]);if(x.useEffect(()=>{if(!t||t.length===0)return;let a=!1;return(async()=>{try{V(!0);const[{data:v,error:f},{data:C,error:B}]=await Promise.all([ae.rpc("get_my_team_benchmarks",{p_days:90,p_metric:"primary_value"}),ae.rpc("get_my_team_benchmarks",{p_days:90,p_metric:"relative_1rm"})]);if(f)throw f;if(B)throw B;const g={};(v??[]).forEach(M=>{M!=null&&M.test_type_id&&(g[M.test_type_id]=M)});const L={};(C??[]).forEach(M=>{M!=null&&M.test_type_id&&(L[M.test_type_id]=M)}),a||(l(g),F(L))}catch(v){console.warn("[get_my_team_benchmarks error]",v),a||(l({}),F({}))}finally{a||V(!1)}})(),()=>{a=!0}},[t==null?void 0:t.length]),x.useEffect(()=>{if(!c)return;let a=!1;return(async()=>{try{const{data:v,error:f}=await ae.rpc("get_my_team_monthly_averages",{p_test_type_id:c,p_metric:m,p_months:6});if(f)throw f;if(a)return;const C=Ce(v??[]);m==="relative_1rm"?_(B=>({...B,[c]:C})):y(B=>({...B,[c]:C}))}catch(v){if(console.warn("[get_my_team_monthly_averages error]",v),a)return;m==="relative_1rm"?_(f=>({...f,[c]:[]})):y(f=>({...f,[c]:[]}))}})(),()=>{a=!0}},[c,m]),t.length===0)return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-8 text-center transition-colors",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-full mb-4",children:e.jsx(O,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Ê∏¨ÂÆö„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"ÊúÄÂàù„ÅÆÊ∏¨ÂÆö„ÇíË®òÈå≤„Åó„Å¶„ÄÅÊàêÈï∑„ÇíËøΩË∑°„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"})]});const h=a=>X(a.name||"")||a.unit,E=(a,v)=>{const f=typeof a=="string"?parseFloat(a):a;return f==null||Number.isNaN(f)?"-":f.toFixed(v.includes("rsi")?2:1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(a=>{const v=j(a.id),f=d(a.id),C=f[0],B=D.includes(a.name)?I[a.id]??"primary_value":"primary_value",g=B==="relative_1rm"?N[a.id]:k[a.id],L=!!g&&!!g.team_n&&g.team_n>=2,M=B==="relative_1rm"?"√óBW":h(a),o=a.name.includes("rsi")?2:1,J=A=>A==null?"-":Number(A).toFixed(o);return e.jsxs("button",{onClick:()=>u(a.id),className:`bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 text-left transition-all hover:shadow-md ${c===a.id?"ring-2 ring-blue-500 dark:ring-blue-400":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:a.display_name}),v&&e.jsx(O,{className:"w-5 h-5 text-yellow-500 flex-shrink-0"})]}),v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[v.value.toFixed(a.name.includes("rsi")?2:1),e.jsx("span",{className:"text-sm ml-1 text-gray-600 dark:text-gray-400",children:h(a)})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(v.date).toLocaleDateString("ja-JP")})]}),C&&C.date!==v.date&&e.jsxs("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"ÊúÄÊñ∞Ë®òÈå≤"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400",children:[E(C.values.primary_value,a.name),e.jsx("span",{className:"text-xs ml-1 text-gray-600 dark:text-gray-400",children:h(a)})]})]})]}):f.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"ÊúÄÊñ∞Ë®òÈå≤"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[E(C.values.primary_value,a.name),e.jsx("span",{className:"text-sm ml-1 text-gray-600 dark:text-gray-400",children:h(a)})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(C.date).toLocaleDateString("ja-JP")})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Êú™Ê∏¨ÂÆö"})}),f.length>0&&e.jsxs("div",{className:"mt-3",children:[D.includes(a.name)&&e.jsxs("div",{className:"mb-2 inline-flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1 text-[11px]",children:[e.jsx("button",{type:"button",onClick:A=>{A.preventDefault(),A.stopPropagation(),q(Y=>({...Y,[a.id]:"primary_value"}))},className:`px-2 py-1 rounded-md ${(I[a.id]??"primary_value")==="primary_value"?"bg-white dark:bg-gray-800 shadow text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-300"}`,children:"Êé®ÂÆö1RM"}),e.jsx("button",{type:"button",onClick:A=>{A.preventDefault(),A.stopPropagation(),q(Y=>({...Y,[a.id]:"relative_1rm"}))},className:`px-2 py-1 rounded-md ${(I[a.id]??"primary_value")==="relative_1rm"?"bg-white dark:bg-gray-800 shadow text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-300"}`,children:"Áõ∏ÂØæ1RM"})]}),L?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[g.team_avg!==null&&g.team_avg!==void 0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200",children:["„ÉÅ„Éº„É†Âπ≥Âùá ",J(g.team_avg),M]}),g.diff_vs_team_avg!==null&&g.diff_vs_team_avg!==void 0&&e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium ${g.diff_vs_team_avg>=0?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-200":"bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-200"}`,children:["Âπ≥ÂùáÂ∑Æ ",g.diff_vs_team_avg>=0?"+":"",J(g.diff_vs_team_avg),M]}),g.team_rank!==null&&g.team_rank!==void 0&&g.team_n&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-200",children:[g.team_n,"‰∫∫‰∏≠ ",g.team_rank,"‰Ωç"]}),g.team_top_percent!==null&&g.team_top_percent!==void 0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200",children:["‰∏ä‰Ωç ",Number(g.team_top_percent).toFixed(1),"%"]}),g.team_n&&g.team_n<10&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:"ÂèÇËÄÉÔºànÂ∞ëÔºâ"})]}):e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:P?"„ÉÅ„Éº„É†ÊØîËºÉ„ÇíË®àÁÆó‰∏≠‚Ä¶":"„ÉÅ„Éº„É†ÊØîËºÉ„ÅØ„Éá„Éº„Çø‰∏çË∂≥Ôºàn<2Ôºâ"})]}),f.length>0&&e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),f.length,"ÂõûÊ∏¨ÂÆö"]}),f.length>1&&e.jsxs("span",{className:"flex items-center text-blue-600 dark:text-blue-400",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"„Ç∞„É©„Éï„ÇíË¶ã„Çã"]})]})]},a.id)})}),n&&b.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[n.display_name," „ÅÆÊàêÈï∑„Ç∞„É©„Éï"]}),(()=>{const a=m==="relative_1rm"?N[n.id]:k[n.id];if(!(!!a&&!!a.team_n&&a.team_n>=2))return null;const f=m==="relative_1rm"?"√óBW":h(n),C=n.name.includes("rsi")?2:1,B=g=>g==null?"-":Number(g).toFixed(C);return e.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:["„ÉÅ„Éº„É†Âπ≥Âùá: ",B(a.team_avg),f," / ",a.team_n,"‰∫∫‰∏≠ ",a.team_rank??"-","‰ΩçÔºà‰∏ä‰Ωç"," ",a.team_top_percent!==null&&a.team_top_percent!==void 0?Number(a.team_top_percent).toFixed(1):"-","%Ôºâ"]})})()]}),e.jsx("button",{onClick:()=>u(null),className:"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Èñâ„Åò„Çã"})]}),e.jsx(we,{records:b,personalBest:w,testTypeName:n.display_name,metricKey:m,unitLabel:m==="relative_1rm"?"√óBW":h(n),teamMonthly:m==="relative_1rm"?R[n.id]??[]:i[n.id]??[]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-1",children:"Á∑èÊ∏¨ÂÆöÂõûÊï∞"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-100",children:t.length})]}),e.jsx(Q,{className:"w-10 h-10 text-blue-600 dark:text-blue-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-1",children:"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-900 dark:text-yellow-100",children:p.length})]}),e.jsx(O,{className:"w-10 h-10 text-yellow-600 dark:text-yellow-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-1",children:"Ê∏¨ÂÆöÁ®ÆÁõÆ"}),e.jsx("p",{className:"text-3xl font-bold text-green-900 dark:text-green-100",children:s.filter(a=>d(a.id).length>0).length}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["/ ",s.length]})]}),e.jsx(U,{className:"w-10 h-10 text-green-600 dark:text-green-400 opacity-50"})]})})]})]})}function Be({testName:s,value:t,unit:p,previousBest:d,onClose:j}){x.useEffect(()=>{const i=Date.now()+3e3,y={startVelocity:30,spread:360,ticks:60,zIndex:9999};function R(k,l){return Math.random()*(l-k)+k}const _=setInterval(function(){const k=i-Date.now();if(k<=0)return clearInterval(_);const l=50*(k/3e3);ce({...y,particleCount:l,origin:{x:R(.1,.3),y:Math.random()-.2}}),ce({...y,particleCount:l,origin:{x:R(.7,.9),y:Math.random()-.2}})},250);return()=>clearInterval(_)},[]);const c=d?(t-d)/d*100:null;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 via-yellow-100 to-orange-100 dark:from-yellow-900/40 dark:via-yellow-800/40 dark:to-orange-900/40 rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform animate-scale-up border-4 border-yellow-400 dark:border-yellow-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mb-6 animate-bounce-slow shadow-lg",children:e.jsx(O,{className:"w-12 h-12 text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2 animate-fade-in",children:"üéâ „Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„ÉàÊõ¥Êñ∞ÔºÅ"}),e.jsx("p",{className:"text-lg text-gray-700 dark:text-gray-200 mb-6",children:s}),e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 rounded-xl p-6 mb-6 shadow-inner",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[e.jsx(G,{className:"w-8 h-8 text-yellow-500 animate-pulse"}),e.jsx("div",{className:"text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-orange-600 dark:from-yellow-400 dark:to-orange-400",children:t.toFixed(s.includes("RSI")?2:1)}),e.jsx("span",{className:"text-2xl text-gray-600 dark:text-gray-300",children:p})]}),c!==null&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-600 dark:text-green-400",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-lg font-semibold",children:["ÂâçÂõûÊØî +",c.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 font-medium",children:"Á¥†Êô¥„Çâ„Åó„ÅÑÊàêÊûú„Åß„ÅôÔºÅ"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Êó•„ÄÖ„ÅÆÂä™Âäõ„ÅåÂÆü„ÇíÁµê„Å≥„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ"})]}),e.jsx("button",{onClick:j,className:"w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:"Á∂ö„Åë„Çã"})]})}),e.jsx("style",{children:`
        @keyframes scale-up {
          from {
            transform: scale(0.8);
            opacity: 0;
          }
          to {
            transform: scale(1);
            opacity: 1;
          }
        }

        @keyframes bounce-slow {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }

        @keyframes fade-in {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .animate-scale-up {
          animation: scale-up 0.4s ease-out;
        }

        .animate-bounce-slow {
          animation: bounce-slow 2s infinite;
        }

        .animate-fade-in {
          animation: fade-in 0.6s ease-out;
        }
      `})]})}function Ee({user:s,onBackHome:t}){const[p,d]=x.useState("jump"),{testTypes:j,records:c,personalBests:u,loading:i,addRecord:y,updateRecord:R,checkExistingRecord:_,getRecordsByTestType:k,getPersonalBest:l}=ke(s.id,p),[N,F]=x.useState(null),P=x.useCallback(n=>{switch(n){case"jump":return"„Ç∏„É£„É≥„ÉóÊ∏¨ÂÆö";case"endurance":return"ÂÖ®Ë∫´ÊåÅ‰πÖÂäõÊ∏¨ÂÆö";case"strength":return"Á≠ãÂäõÊ∏¨ÂÆö";case"sprint":return"„Çπ„Éó„É™„É≥„ÉàÊ∏¨ÂÆö";case"agility":return"„Ç¢„Ç∏„É™„ÉÜ„Ç£Ê∏¨ÂÆö";default:return"„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ∏¨ÂÆö"}},[]),V=x.useCallback(async(n,b)=>{await R(n,b)},[R]),D=x.useCallback(async n=>{var m;const b=await y(n);if(b!=null&&b.isNewPersonalBest){const w=j.find(E=>E.id===n.test_type_id),h=l(n.test_type_id);w&&F({testName:w.display_name,value:Number(((m=n==null?void 0:n.values)==null?void 0:m.primary_value)??0),unit:w.unit,previousBest:h==null?void 0:h.value})}return b},[y,j,l]),{lastPerformanceRecords:I,personalBestsMap:q}=x.useMemo(()=>{const n=new Map,b=new Map;for(const m of j){const w=k(m.id);w&&w.length>0&&n.set(m.id,w[0]);const h=l(m.id);h&&b.set(m.id,h)}return{lastPerformanceRecords:n,personalBestsMap:b}},[j,k,l]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{type:"button",onClick:t,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:opacity-90 active:opacity-80 transition",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"„Éõ„Éº„É†„Å∏Êàª„Çã"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[u.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl shadow-sm p-4 border-2 border-yellow-300 dark:border-yellow-700",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(G,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2"}),"„Éë„Éº„ÇΩ„Éä„É´„Éô„Çπ„Éà"]}),e.jsx("div",{className:"space-y-2",children:u.slice(0,3).map(n=>{var h;const b=(h=j.find(E=>E.id===n.test_type_id))==null?void 0:h.unit,m=Number(n.value??0),w=String(n.test_name??"").toLowerCase().includes("rsi");return e.jsxs("div",{className:"bg-white/60 dark:bg-gray-800/60 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.test_display_name}),e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[Number.isFinite(m)?m.toFixed(w?2:1):"-"," ",b]})]},n.test_type_id)})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden transition-colors",children:e.jsxs("div",{className:"grid grid-cols-5 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>d("jump"),className:`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${p==="jump"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"„Ç∏„É£„É≥„Éó"}),e.jsx("button",{type:"button",onClick:()=>d("sprint"),className:`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${p==="sprint"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"„Çπ„Éó„É™„É≥„Éà"}),e.jsx("button",{type:"button",onClick:()=>d("agility"),className:`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${p==="agility"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"„Ç¢„Ç∏„É™„ÉÜ„Ç£"}),e.jsx("button",{type:"button",onClick:()=>d("endurance"),className:`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${p==="endurance"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"ÊåÅ‰πÖÂäõ"}),e.jsx("button",{type:"button",onClick:()=>d("strength"),className:`py-3 px-2 text-xs sm:text-sm font-medium transition-colors ${p==="strength"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Á≠ãÂäõ"})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:P(p)}),e.jsx(G,{className:"w-5 h-5 sm:w-6 sm:h-6 text-yellow-500"})]}),e.jsx(Se,{userId:s.id,userRole:s.role,testTypes:j,onSubmit:D,onCheckExisting:_,onUpdate:V,loading:i,lastRecords:I,personalBests:q})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:e.jsx(Pe,{testTypes:j,records:c,personalBests:u,getRecordsByTestType:k,getPersonalBest:l})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors",children:e.jsx(Me,{records:c,personalBests:u,loading:i})})]})]}),N&&e.jsx(Be,{testName:N.testName,value:N.value,unit:N.unit,previousBest:N.previousBest,onClose:()=>F(null)})]})}export{Ee as default};

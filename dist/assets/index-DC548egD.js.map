{"version":3,"mappings":"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","names":["f","require$$0","k","Symbol","for","l","m","Object","prototype","hasOwnProperty","n","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","p","key","ref","__self","__source","q","c","a","g","b","d","e","h","call","defaultProps","$$typeof","type","props","_owner","current","reactJsxRuntime_production_min","jsx","jsxs","jsxRuntimeModule","exports","createRoot","hydrateRoot","globalThis","supabase","__bekuta_supabase","createClient","auth","persistSession","autoRefreshToken","detectSessionInUrl","storage","window","localStorage","realtime","params","eventsPerSecond","async","recoverFromInvalidRefreshToken","err","msg","String","message","includes","signOut","_","keys","startsWith","endsWith","removeItem","location","reload","sleep","ms","Promise","r","setTimeout","softTimeout","timer","race","resolve","clearTimeout","useAuth","user","setUser","useState","userProfile","setUserProfile","loadingState","setLoadingState","loading","requiresPasswordChange","setRequiresPasswordChange","mountedRef","useRef","fetchSeqRef","fetchUserProfile","useCallback","uid","seq","retryDelays","i","length","res","from","select","eq","maybeSingle","data","error","console","applySession","session","u","authUser","requiresChange","_a","user_metadata","requires_password_change","checkPasswordChangeRequired","id","refreshUserProfile","getUser","useEffect","sub","onAuthStateChange","_event","getSession","subscription","unsubscribe","signIn","email","password","signInWithPassword","trim","_b","changePassword","newPassword","updateUser","acceptTerms","Error","now","Date","toISOString","update","terms_accepted","terms_accepted_at","prev","toJST","date","getTime","formatDateToJST","jst","getUTCFullYear","getUTCMonth","padStart","getUTCDate","getTodayJST","getTodayJSTString","getYearsAgoString","years","base","setUTCFullYear","getYearsAgoJST","getDaysAgoJSTString","days","setUTCDate","getJSTDateMinusDays","toJSTDateString","formatDateJST","getNowJSTISOString","replace","DEFAULT_ALERT_RULES","condition","threshold","enabled","description","generateAlerts","userId","userName","acwrData","trainingRecords","rules","alerts","today","latestACWR","lastTraining","todayTraining","find","hasEnoughDaysForACWR","Array","Set","map","getSRPE","rpe","Number","duration","duration_min","Math","round","srpeByDate","Map","set","get","todaySRPE","last7Values","sort","filter","slice","v","last7Avg","reduce","spikeRatio","toFixed","forEach","rule","shouldAlert","alertData","user_id","user_name","is_read","is_dismissed","created_at","acwr","priority","title","acwr_value","threshold_exceeded","expires_at","daysSinceLastTraining","floor","last_training_date","days_since_last_training","getHours","srpe_value","srpe_avg_7d","srpe_spike_ratio","push","getAlertStyle","alert","bgColor","borderColor","textColor","iconColor","icon","getAlertTypeLabel","filterActiveAlerts","isAlertExpired","parseISODateOnlyUTC","iso","y","split","UTC","toISOUTC","addDaysUTC","x","getRiskLabel","riskLevel","getRiskColor","isFinite","calculateACWR","records","dailyMap","load","dates","start","end","series","out","acuteLoad","chronicLoad","acuteSum","s","chronic","acwrVal","RealtimeHubContext","createContext","RealtimeHubProvider","children","isVisible","setIsVisible","document","hidden","isOnline","setIsOnline","navigator","onLine","jobsRef","isVisibleRef","isOnlineRef","onVis","onOnline","onOffline","addEventListener","removeEventListener","unregisterJob","delete","runJobOnce","job","run","failCount","nextAt","intervalMs","backoff","min","pow","setInterval","visible","online","values","requireVisible","requireOnline","clearInterval","registerPollJob","args","immediate","state","useMemo","can","canRun","canRealtime","value","Provider","useRealtimeHub","ctx","useContext","useAlerts","userRole","setAlerts","alertRules","setAlertRules","setLoading","unreadCount","setUnreadCount","instanceIdRef","crypto","randomUUID","random","toString","unregisterPollRef","loadUsersToCheck","usersToCheck","userData","single","teamData","rawUsers","flatMap","link","teams","users","deduped","has","name","allAthletes","checkAndGenerateAlerts","effectiveRules","fetchPromises","order","ascending","results","allSettled","newAlerts","status","reason","userAlerts","existingAlertKeys","uniqueNewAlerts","priorityOrder","high","medium","low","priorityDiff","sortAlertsByPriority","loadAlertRules","index","cancelled","init","unregister","unread","markAsRead","alertId","dismissAlert","markAllAsRead","clearDismissedAlerts","getActiveAlerts","getUnreadAlerts","getAlertsByPriority","getAlertsByUser","targetUserId","refreshAlerts","TutorialContext","TutorialProvider","role","tutorial","progress","setProgress","setError","loadProgress","fetchError","limit","completed_steps","current_step","is_completed","skipped","saveProgress","updatedProgress","progressToSave","upsertError","upsert","onConflict","fallback","completeStep","stepId","completedSteps","setCurrentStep","completeTutorial","skipTutorial","resetTutorial","shouldShowTutorial","refreshProgress","useTutorial","isActive","setIsActive","currentStepIndex","setCurrentStepIndex","startTutorial","stopTutorial","handleCompleteTutorial","handleSkipTutorial","useTutorialContext","context","defaultAttributes","xmlns","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","createLucideIcon","iconName","iconNode","Component","forwardRef","color","size","absoluteStrokeWidth","className","rest","createElement","string","toLowerCase","join","tag","attrs","isArray","displayName","Activity","AlertCircle","cx","cy","x1","x2","y1","y2","AlertTriangle","ArrowLeft","ArrowRight","Award","BarChart2","BarChart3","Battery","rx","ry","Bell","Brain","Building2","Calendar","Camera","CheckCircle2","CheckCircle","Check","ChevronDown","ChevronLeft","ChevronRight","ChevronUp","ChevronsLeft","ChevronsRight","Circle","Clock","points","Cloud","Copy","CreditCard","Download","Droplets","Dumbbell","ExternalLink","EyeOff","Eye","FileSpreadsheet","FileText","Filter","Flame","Globe","Hand","Heart","HelpCircle","History","Info","LayoutDashboard","Lightbulb","Link","Loader2","Lock","LogIn","LogOut","Mail","Menu","MessageSquare","Moon","Palette","PanelsTopLeft","Pen","Pencil","Percent","Phone","Plus","RefreshCcw","RefreshCw","RotateCcw","Ruler","Save","Scale","Search","Send","Settings","ShieldAlert","ShieldCheck","Shield","Sliders","Sparkles","SquarePen","Star","Target","Thermometer","Timer","Trash2","TrendingDown","TrendingUp","Trophy","Unlock","Upload","UserCheck","UserCog","UserPlus","UserX","User","UsersRound","Users","Wind","X","Zap","LoginForm","onLogin","setEmail","setPassword","showPassword","setShowPassword","showForgotPassword","setShowForgotPassword","resetEmail","setResetEmail","resetSent","setResetSent","resetError","setResetError","style","fontFamily","letterSpacing","onSubmit","preventDefault","log","_c","_d","_e","htmlFor","onChange","target","placeholder","required","disabled","autoComplete","fontSize","WebkitAppearance","WebkitBorderRadius","onClick","WebkitTapHighlightColor","touchAction","trimmedEmail","supabaseAnonKey","response","fetch","method","headers","apikey","Authorization","body","JSON","stringify","redirectUrl","origin","result","json","catch","ok","module","main","global","isWorker","workerSize","canUseWorker","Worker","Blob","OffscreenCanvas","OffscreenCanvasRenderingContext2D","HTMLCanvasElement","transferControlToOffscreen","URL","createObjectURL","canUsePaths","Path2D","DOMMatrix","noop","promise","func","ModulePromise","Prom","frame","cancel","TIME","frames","lastFrameTime","defaultFire","bitmapMapper","skipTransform","transform","bitmap","canvas","getContext","drawImage","clear","fillRect","transferToImageBitmap","createPattern","raf","requestAnimationFrame","cancelAnimationFrame","cb","onFrame","time","getWorker","worker","prom","resolves","code","warn","execute","options","callback","postMessage","offscreen","fire","done","workerDone","bind","reset","decorate","defaults","particleCount","angle","spread","startVelocity","decay","gravity","drift","ticks","shapes","zIndex","colors","disableForReducedMotion","scalar","prop","val","convert","onlyPositiveInt","number","randomInt","max","toDecimal","str","parseInt","colorsToRgb","hexToRgb","substring","setCanvasWindowSize","documentElement","clientWidth","clientHeight","setCanvasRectSize","rect","getBoundingClientRect","randomPhysics","opts","radAngle","PI","radSpread","wobble","wobbleSpeed","velocity","angle2D","tiltAngle","shape","tick","totalTicks","tiltSin","tiltCos","wobbleX","wobbleY","ovalScalar","flat","updateFetti","fetti","cos","sin","fillStyle","beginPath","path","matrix","pathString","pathMatrix","scaleX","scaleY","rotation","path2d","t1","addPath","t2","transformPath2D","abs","multiplySelf","pattern","setTransform","globalAlpha","ellipse","radiusX","radiusY","startAngle","endAngle","antiClockwise","save","translate","rotate","scale","arc","restore","rot","innerRadius","outerRadius","spikes","step","lineTo","moveTo","closePath","confettiCannon","globalOpts","animationObj","isLibCanvas","allowResize","hasResizeEventRegistered","globalDisableForReducedMotion","Boolean","resizer","initialized","__confetti_initialized","preferLessMotion","matchMedia","matches","fireLocal","getOrigin","temp","fettis","startX","startY","addFettis","animationFrame","destroy","animatingFettis","onDone","clearRect","concat","animate","position","top","left","pointerEvents","getCanvas","appendChild","onResize","obj","resize","contains","removeChild","getDefaultFire","useWorker","apply","this","arguments","create","shapeFromPath","pathData","tempCtx","maxSize","minX","minY","maxX","maxY","isPointInPath","shapeFromText","textData","text","font","measureText","ceil","actualBoundingBoxRight","actualBoundingBoxLeft","actualBoundingBoxAscent","actualBoundingBoxDescent","padding","fillText","self","confetti$1","PasswordChangeForm","onPasswordChange","setNewPassword","confirmPassword","setConfirmPassword","showConfirmPassword","setShowConfirmPassword","animationStep","setAnimationStep","progressPercent","setProgressPercent","requirements","passwordValidation","minLength","hasUpperCase","hasLowerCase","hasNumbers","hasSpecialChar","newPercent","test","isValid","validatePassword","passwordsMatch","confetti","error_description","WelcomePage","onContinue","invitationData","setInvitationData","token","href","searchParams","Prefer","errorText","invitation","teamName","organizationName","team_id","teamResponse","organization_id","orgResponse","orgData","team_name","organization_name","fetchInvitationData","backgroundImage","backgroundSize","getRoleDisplay","expiresAt","diffMs","diffHrs","diffMins","getTimeRemaining","GenericDuplicateModal","isOpen","onClose","onOverwrite","onCancel","existingValues","newValues","prevOverflow","overflow","prevTouchAction","stopPropagation","toLocaleDateString","item","label","clamp","VectorArrowPicker","hint","boxRef","draggingRef","isDragging","setIsDragging","level","levelLabel","geom","x0","head","setFromPointer","clientX","el","usable","next","onUp","onPointerDown","currentTarget","setPointerCapture","pointerId","onPointerMove","opacity","xTip","headLen","headHalfH","xShaftEnd","Fragment","SignalPicker","bars","cont","lit","transition","Toast","open","durationMs","t","isSuccess","isError","TrainingForm","onCheckExisting","onUpdate","lastRecord","weeklyAverage","daysWithData","consecutiveDays","getFullYear","getMonth","getDate","getTodayLocalDateString","setRpe","setDuration","selectedDate","setSelectedDate","arrowScore","setArrowScore","signalScore","setSignalScore","submitting","setSubmitting","warning","setWarning","successFeedback","setSuccessFeedback","showDuplicateModal","setShowDuplicateModal","existingRecord","setExistingRecord","pendingData","setPendingData","toastOpen","setToastOpen","toastType","setToastType","toastMsg","setToastMsg","showToast","resetForm","applySuccessEffects","feedback","totalDaysWithData","showConfetti","getDataEntryFeedback","handleCancelOverwrite","checkForWarnings","currentRpe","currentDuration","currentLoad","loadValue","arrow_score","signal_score","existing","newRpe","newDuration","ACWRProgressIndicator","isDarkMode","isMinimumReached","isRecommendedReached","config","progressColor","week","getStatusConfig","StatusIcon","getMilestones","day","reached","milestone","ACWRChart","teamAverageData","showTeamAverage","selectedPeriod","setSelectedPeriod","isTeamAverageVisible","setIsTeamAverageVisible","isDataSufficient","filteredData","startDate","setDate","itemDate","filteredTeamData","formatDateWithDay","dateStr","getDay","CustomTooltip","active","payload","personalEntry","dataKey","teamEntry","personal","personalACWR","isWeekend","teamRow","td","teamACWR","diff","CustomDot","period","ResponsiveContainer","LineChart","margin","right","bottom","CartesianGrid","strokeDasharray","XAxis","tickFormatter","interval","YAxis","domain","Tooltip","content","ReferenceLine","Line","dot","activeDot","EditTrainingRecordModal","record","onDelete","allowDateEdit","allowDelete","formData","setFormData","showDeleteConfirm","setShowDeleteConfirm","updateData","background","TrainingRecordsList","React","memo","allowEdit","showLimited","limitCount","selectedRecord","setSelectedRecord","showEditModal","setShowEditModal","showAll","setShowAll","displayRecords","sortedRecords","handleEditClick","handleModalClose","rpeColor","Edit","AlertSummary","onViewAll","isDismissed","setIsDismissed","dismissed","getItem","dismissedTime","oneHour","activeAlerts","highPriorityAlerts","unreadAlerts","setItem","WeightForm","weight","setWeight","notes","setNotes","weight_kg","weightNum","parseFloat","isNaN","rows","maxLength","WeightChart","chartData","displayDate","month","weights","minWeight","maxWeight","range","yAxisMin","yAxisMax","contentStyle","backgroundColor","border","borderRadius","labelStyle","fontWeight","formatter","labelFormatter","year","Legend","wrapperStyle","paddingTop","iconType","WeightRecordsList","editingId","setEditingId","editWeight","setEditWeight","editNotes","setEditNotes","handleCancel","handleSave","handleEdit","Edit2","confirm","handleDelete","WeightACWRChart","weightData","combinedData","matchingWeight","w","fullDate","entry","yAxisId","orientation","connectNulls","InsightCard","insights","sortedWeights","recentWeights","firstWeight","weightChange","changePercent","highRiskDays","last30Days","goodDays","recent","avgWeight","sum","allWeights","firstHalf","secondHalf","avgFirst","avgSecond","firstHalfACWR","secondHalfACWR","avgACWRFirst","avgACWRSecond","generateInsights","insight","bg","desc","getColorClasses","getIdealWeightRange","heightCm","heightM","BMIDisplay","weightKg","dateOfBirth","gender","age","birth","monthDiff","calculateAge","analysis","bmi","calculateBMI","category","healthRisk","getBMICategory","idealWeightRange","genderForCalc","ageCorrected","minBMI","maxBMI","getAgeCorrectedIdealWeight","athleteRange","getAthleteIdealWeightRange","categoryLabel","getBMIAnalysis","isWithinIdealRange","getCategoryColor","normalizePhoneNumber","input","digits","fromCharCode","charCodeAt","ProfileEditForm","setName","setGender","setHeightCm","height_cm","setDateOfBirth","date_of_birth","phoneNumber","setPhoneNumber","phone_number","success","setSuccess","normalizedPreview","UserIcon","trimmedName","parsedHeight","birthDate","ageGuess","normalizedPhone","phoneDigits","updateError","inputMode","TutorialOverlay","targetElement","highlightRect","setHighlightRect","overlayRef","maskId","useId","updateRect","mask","TutorialTooltip","currentStep","totalSteps","onNext","onPrev","onSkip","showPrev","nextLabel","tooltipRef","tooltipStyle","setTooltipStyle","updatePosition","targetRect","tooltipRect","innerHeight","innerWidth","TutorialProgress","stepTitles","isCompleted","isCurrent","stepTitle","TutorialController","steps","onComplete","externalStepIndex","onStepChange","showProgress","internalStepIndex","setInternalStepIndex","setTargetElement","isExecutingAction","setIsExecutingAction","updateTargetElement","targetSelector","element","querySelector","scrollIntoView","behavior","block","beforeStep","executeBeforeStep","then","observer","MutationObserver","observe","childList","subtree","disconnect","handleNext","afterStep","action","handlePrev","handleSkip","handleKeyDown","toNumber","toYMD","match","toDbDateValue","ymd","toACWRDateKey","dbDate","sortByDateAsc","ad","bd","localeCompare","upsertLocalTrainingRecord","row","idx","findIndex","useTrainingData","setTrainingRecords","weightRecords","setWeightRecords","setACWRData","inFlightRef","lastFetchKeyRef","safeLogEvent","eventType","insert","event_type","logEvent","fetchAll","fetchKey","trainingRes","weightRes","all","normalized","loadRaw","checkExistingRecord","addTrainingRecord","recordData","overwrite","updateTrainingRecord","recordId","updatePayload","eventYmd","deleteTrainingRecord","removeLocalTrainingRecord","parseYMDLocal","mo","toDateKey","sortByDateDesc","ka","kb","da","useWeightData","setRecords","normalizeAndSet","sorted","fetchRecords","addWeightRecord","authData","insertData","newRecord","insertError","updateWeightRecord","updatedRecord","deleteWeightRecord","deleteError","getLatestWeight","latest","best","getWeightChange","cutoff","first","last","refresh","useMenstrualCycleData","cycles","setCycles","fetchCycles","getCyclePhase","cycle","targetDate","cycle_start_date","daysSinceStart","period_duration_days","cycle_length_days","follicularEnd","addCycle","organizationId","team","updateCycle","updates","deleteCycle","getCurrentCyclePhase","phase","refetch","athleteTutorialSteps","staffTutorialSteps","globalAdminTutorialSteps","parentTutorialSteps","gamificationTutorialSteps","getTutorialSteps","SleepForm","sleepHours","setSleepHours","sleepQuality","setSleepQuality","saving","setSaving","sleep_hours","sleep_quality","isBusy","hours","validate","star","DuplicateRecordModal","newValue","motivation_level","energy_level","stress_level","MotivationForm","motivationLevel","setMotivationLevel","energyLevel","setEnergyLevel","stressLevel","setStressLevel","initializedFromLast","setInitializedFromLast","renderSlider","lowLabel","highLabel","colorTextClass","previousValue","accentHex","pct","inactive","SleepChart","formatDate","MotivationChart","motivation","energy","stress","ConditioningSummaryCard","overallCondition","score","factors","avgScore","getOverallCondition","ConditionIcon","recommendation","isHighACWR","isLowSleep","getRecommendation","SYMPTOM_OPTIONS","CycleSection","periodStart","setPeriodStart","flowIntensity","setFlowIntensity","symptoms","setSymptoms","cycleNotes","setCycleNotes","periodDuration","setPeriodDuration","cycleLength","setCycleLength","periodEndDate","setPeriodEndDate","computedPeriodDays","checked","Icon","toggleSymptom","UnifiedDailyCheckIn","userGender","enableCycle","onTrainingSubmit","onTrainingCheckExisting","onTrainingUpdate","onWeightSubmit","onWeightCheckExisting","onWeightUpdate","onSleepSubmit","onSleepCheckExisting","onSleepUpdate","onMotivationSubmit","onMotivationCheckExisting","onMotivationUpdate","onCycleSubmit","onCycleUpdate","lastTrainingRecord","lastWeightRecord","lastSleepRecord","lastMotivationRecord","cycleEnabled","activeSection","setActiveSection","weightNotes","setWeightNotes","sleepNotes","setSleepNotes","conditioningNotes","setConditioningNotes","completedSections","setCompletedSections","isSliding","setIsSliding","duplicateType","setDuplicateType","TinyScale","highlight","modalValues","pending","ex","getModalValues","add","pd","getModalTitle","section","getSectionIcon","onPointerUp","onPointerCancel","existingSleep","existingMotivation","flow_intensity","errorMessage","handleSectionComplete","ConsolidatedOverviewDashboard","sleepRecords","motivationRecords","menstrualCycles","onOpenDetailView","onQuickAdd","withDate","latestWeight","latestSleep","latestMotivation","latestTraining","getWeightTrend","isUp","healthScore","quality","avgMood","trend","getHealthScore","weightTrend","sleepAvg","recentWeek","getSleepAverage","getPhaseColor","getPhaseBg","currentPhase","setHours","endDate","cycle_end_date","predictedNextPeriod","latestCycle","lastStart","predictedDate","getPredictedNextPeriod","showCycleCard","sortedWeightsDesc","diff30","latestDate","past30","getRiskBg","getPhaseDisplayName","getPhaseAdvice","MultiMetricTimeline","visibleMetrics","setVisibleMetrics","timeRange","setTimeRange","filterByTimeRange","dateString","jstTime","getDaysAgo","dataMap","mergeDataByDate","toggleMetric","metric","FloatingActionButton","onCameraClick","addDays","normalizeActionItems","items","next_action_items","next_action","done_at","CAUSE_TAG_OPTIONS","DailyReflectionCard","yesterday","getYesterdayJSTString","weekOffset","setWeekOffset","selectedWeekStart","diffToMonday","getStartOfWeekJSTString","selectedWeekEnd","todayRow","setTodayRow","yesterdayRow","setYesterdayRow","weekRows","setWeekRows","weekLoading","setWeekLoading","todayTodo","setTodayTodo","tomorrowActions","setTomorrowActions","did","setDid","didnt","setDidnt","causeTags","setCauseTags","freeNote","setFreeNote","savingTodo","setSavingTodo","savingReflection","setSavingReflection","in","reflection_date","todo","cause_tags","free_note","loadDaily","weekEndExclusive","gte","lt","loadWeek","weeklySummary","didCount","didntCount","tagCount","topTags","entries","goals","goalStats","total","completionRate","topGoals","rate","count","nowIso","toggled","updated_at","toggleTodoDone","toLocaleString","toggleCauseTag","updateTomorrowActionText","removeTomorrowAction","cleanedActions","metadata","source","minimal","ShareStatusButton","setOpen","note","setNote","setChecked","sending","setSending","setDone","canSend","isValidYMD","safeTime","pickLatestByDate","bestT","Infinity","DerivedStatsBar","isISODate","toISODateOrNull","toNumberOrNull","toIntOrNull","toMotivationLastRecordInfo","normalizeMotivationRecord","useLastRecords","normalizedLastTrainingRecord","duration_time","normalizeTrainingRecord","form","normalizedLastTrainingRecordForCheckIn","normalizedLastWeightRecord","normalizeWeightRecord","normalizedLastSleepRecord","normalizeSleepRecord","normalizedLastMotivationRecord","toDateValue","measured_at","useInbodyData","acc","pbf","body_fat_percent","fatMass","calcFatMass","ffm","calcFFM","fat_mass","fat_free_mass","jpDate","dt","InBodyLatestCard","toHeightM","round2","round1","BANDS","general","male","female","athlete","InBodyCharts","showBands","setShowBands","bandKey","setBandKey","bandsEnabled","bands","heightFallbackCm","trendData","ffmi","ffmKg","hm","calcFFMI","dateLabel","matrixData","calcBMI","hasAnyTrend","some","ScatterChart","unit","ReferenceArea","fillOpacity","ifOverflow","cursor","Scatter","getTodayEnergySummary","intake","intakeCalories","bmr","bmrSource","snapBmr","snapshot","lean","leanMassKg","weightKg7dAvg","_f","W","H","A","estimateBmrMifflin","tdee","tdeeSource","snapTdee","_g","af","_h","activity_factor","_i","todayLoad","_j","srpe","extra","estimateExtraFromLoad","balance","statusLabel","meta","toNum","barClass","st","labelClass","NutritionOverview","totals","targets","subtitle","onOpen","calNow","cal","pNow","fNow","cNow","goal","tabIndex","onKeyDown","percent","raw","round0","safeNum","buildDailyTargets","bodyFatPercent","sex","activityLevel","goalType","targetCaloriesOverride","proteinPerKg","proteinPerFFM","fatPerKg","minFatG","minCarbG","deficitKcal","surplusKcal","minCaloriesByBMRRatio","maxCalories","NaN","missing","calcFFMFromBodyFatPercent","bmrFromFFM","calcBMR_KatchMcArdle","bmrFromMifflin","every","calcBMR_Mifflin","bmrMethod","bmrKcal","activityFactorFromLevel","calcTDEE","tdeeMethod","targetCalRaw","rough","roughCaloriesFromWeight","targetCal","defaultProteinKg","pG","defaultFatKg","fG","kcalFromPF","remaining","cG","minC","targetCalAdjusted","adjustedReason","confidence","hasFFM","hasMifflinInputs","tdeeKcal","calcGaps","DURATION_MS","mean","nums","conditionBadgeClass","FTTCheck","onBackHome","screen","setScreen","isActiveRef","remainingMs","setRemainingMs","tapCount","setTapCount","resultCount","setResultCount","resultSD","setResultSD","resultIntervals","setResultIntervals","setCondition","setMessage","didSave","setDidSave","saveBusy","setSaveBusy","saveStatus","setSaveStatus","startTimeRef","tapsRef","timerRef","tapAreaRef","eventIdRef","baselineCacheRef","clearTimer","resetLocal","headerSubtitle","TimeIcon","performance","elapsed","taps","intervals","sd","sqrt","stddev","evaluated","todayCount","todaySD","minSamples","windowDays","speedDropRatio","sdWorseRatio","sampleCount","todayYMD","cacheKey","cached","baselineSpeed","baselineSD","startYMD","daysAgo","jstNow","getPastYMDJST","fetchedAt","valid","total_count","interval_sd_ms","getBaselineOncePerDay","isSlow","isUnstable","evaluateWithBaseline","did_save","writeFTTEventDidNotSave","finish","cancelable","circle","clientY","remove","ripple","WebkitUserSelect","WebkitTouchCallout","conditionLabel","jitter","recErr","duration_sec","raw_intervals_ms","condition_result","ua","userAgent","tz","Intl","DateTimeFormat","resolvedOptions","timeZone","eventId","evErr","GamificationView","lazy","import","__VITE_PRELOAD__","default","AthleteGamificationView","Suspense","userTeamId","MenstrualCycleForm","onSuccess","isSubmitting","setIsSubmitting","period_end_date","calcPeriodDurationDays","periodEnd","cycleData","symptom","useBasalBodyTemperature","temperatures","setTemperatures","fetchTemperatures","addTemperature","temperature","updateTemperature","deleteTemperature","getTemperatureTrend","recentTemps","measurement_date","firstAvg","temperature_celsius","getAverageTemperature","BasalBodyTemperatureForm","currentTime","toTimeString","measurement_time","temperatureData","MenstrualCycleChart","cyclePhase","cycleStart","cycleEnd","getDataForChart","MenstrualCycleCalendar","currentMonth","setCurrentMonth","currentDayInCycle","calendarDays","firstDay","lastDay","getCalendarDays","prediction","sortedCycles","lastCycle","avgCycleLength","lastEnd","predictedStart","predictedEnd","predictNextCycle","getPhaseLabel","phaseInfo","dayInCycle","isHighPerformance","isInjuryRisk","getCyclePhaseForDate","isPredicted","isToday","isCurrentMonth","usePerformanceData","categoryName","updateGoalFromLatestTest","categories","setCategories","testTypes","setTestTypes","personalBests","setPersonalBests","fetchCategories","fetchTestTypes","query","cat","testList","mapped","test_type","performance_test_types","calculatePersonalBests","allRecords","bestByTest","primary_value","test_type_id","higher_is_better","test_name","test_display_name","display_name","checkIfPersonalBest","testTypeId","higherIsBetter","pb","getRecordsByTestType","addRecord","tt","isNewPersonalBest","updateRecord","deleteRecord","getPersonalBest","getImprovementPercentage","currentValue","rec","CyclePerformanceCorrelation","performanceRecords","correlationData","phaseData","menstrual","totalLoad","totalRPE","performances","totalScore","follicular","ovulatory","luteal","recordDate","test_date","avgLoad","avgRPE","avgPerformance","sessionCount","analyzeCorrelation","hasData","sortedByLoad","sortedByPerformance","getInsights","BarChart","Bar","AthleteCycleView","cycleViewMode","setCycleViewMode","safeGet","safeSet","useEntryPopup","keyPrefix","thresholdDays","enableDailyTip","lastOpenAt","lastDailyShown","dismissedToday","setState","mode","daysAway","prevOpen","prevDaily","daysBetween","dismiss","EntryPopup","primaryLabel","defaultTitle","defaultPrimary","DEFAULT_OPTS","preferNote","appendTagHintsWhenNote","maxNoteChars","maxTagHints","BASE","off","pre","peak","unknown","TAG_HINTS","phaseType","focusTags","tagHint","maxHints","tags","hit","buildTagHint","hasNote","clipped","normalizeOneLine","clampText","normalizePhaseWording","oneWord","training","nutrition","urlBase64ToUint8Array","base64String","base64","repeat","atob","output","Uint8Array","registerServiceWorker","serviceWorker","register","enablePushForCurrentUser","publicVapidKey","reg","ready","pushManager","getSubscription","Notification","requestPermission","subscribe","userVisibleOnly","applicationServerKey","subscribePush","toJSON","endpoint","p256dh","user_agent","PUBLIC_VAPID_KEY","EmailNotificationSettings","userEmail","preferences","setPreferences","password_reset","weekly_summary","pushReady","setPushReady","pushEnabled","setPushEnabled","pushBusy","setPushBusy","loadPreferences","initPush","incoming","email_notifications","handleToggle","disablePushForCurrentUser","AthleteSettingsView","onOpenProfileEdit","AthleteNutritionDashboardView","ExportPanel","__vitePreload","MessagingPanel","AthletePerformanceView","AthleteView","onLogout","onHome","onNavigateToPrivacy","onNavigateToTerms","onNavigateToCommercial","onNavigateToHelp","onUserUpdated","todayPhase","setTodayPhase","nextPhases","setNextPhases","phaseLoading","setPhaseLoading","phaseError","setPhaseError","teamId","d1","e1","rpc","p_team_id","p_date","addDaysToDateString","d2","e2","p_start","p_end","row1","filtered","phase_type","start_date","end_date","phaseLabel","toShortRange","sm","em","ed","snapshotToday","setSnapshotToday","showExportPanel","setShowExportPanel","showUnifiedCheckIn","setShowUnifiedCheckIn","showProfileEdit","setShowProfileEdit","menuOpen","setMenuOpen","activeTab","setActiveTab","canUseFTT","ftt_enabled","canUseNutrition","nutrition_enabled","conn","connection","saveData","effectiveType","prefetch","requestIdleCallback","timeout","cancelIdleCallback","safeSetActiveTab","tab","celebrationData","setCelebrationData","hasStartedTutorial","setHasStartedTutorial","normalizedGenderBinary","normalizedGenderFull","checkExistingTrainingRecord","weightLoading","checkExistingWeightRecord","sleepLoading","checkExistingSleepRecord","addSleepRecord","updateSleepRecord","getAverageSleepHours","getAverageSleepQuality","getLatestSleep","cutoffDate","recentRecords","bedtime","waketime","deleteSleepRecord","getSleepDeficit","avgHours","useSleepData","latestSleepForHint","poorSleepFlag","isPoor","motivationLoading","checkExistingMotivationRecord","addMotivationRecord","updateMotivationRecord","getAverageMotivation","getAverageEnergy","getAverageStress","getLatestMotivation","mood","deleteMotivationRecord","getMotivationTrend","midPoint","useMotivationData","inbodyRecords","latestInbody","inbodyLoading","inbodyError","addMenstrualCycle","updateMenstrualCycle","setIsDarkMode","classList","mediaQuery","handleChange","useDarkMode","logs","nutritionLogsToday","nutritionTotalsToday","nutritionLoading","nutritionError","refetchNutritionToday","setLogs","setStatus","reloadKey","setReloadKey","lastTotalsRef","fetchLogs","hasUnparsed","total_calories","hasAnyLog","useTodayNutritionTotals","normalizedNutritionTotalsToday","kcal","calories","protein_g","protein","fat_g","fat","carbs_g","carbs","derived","daysWithTrainingData","consecutiveTrainingDays","dateSet","todayStr","consecutive","cur","oneWeekAgo","oneWeekAgoT","totalRpe","totalDuration","useAthleteDerivedValues","normalizedSleepRecords","timelineSleepRecords","todayWeight","phaseHints","assist","poorSleep","risk","focus_tags","hasHighAlert","hasHighPriorityAlert","isHighRisk","badge","poor","trainingHint","sleepHint","nutritionHint","hitTag","pack","buildDailyAssistTexts","entryPop","shouldShowEntryPop","entryPopMessage","bodyFatPercentRaw","body_fat_perc","heightCmRaw","todayTrainingRecord","handleTrainingSubmit","durationMin","metaErr","activityFactor","upsertDailyEnergySnapshot","handleTrainingUpdate","handleTrainingUpdateForList","handleTrainingSubmitForCheckIn","handleTrainingUpdateForCheckIn","galleryInputRef","handlePickPhoto","file","nutritionLogs","nutritionTotals","latestWeightKg","onRefreshNutrition","_k","_l","_m","click","accept","files","AthleteList","athletes","onAthleteSelect","athleteACWRMap","weekCardMap","search","setSearch","filterRisk","setFilterRisk","filterSharing","setFilterSharing","nickname","filteredAthletes","acwrInfo","daysOfData","training_days_28d","currentACWR","riskMatch","card","sharingMatch","is_sharing_active","searchMatch","renderRiskBadge","mm","dd","fmt1","fmt0","renderSharingBadge","hasACWR","acwrValue","remainingDays","shareOn","training_sessions_28d","action_total","action_done","sleep_hours_avg","sleep_quality_avg","motivation_avg","energy_avg","stress_avg","pickTop2","reasons","riskPriority","caution","calcRiskForAthlete","weekCard","noData","sharingOn","daysNoInput","daysSinceLast","isHigh","isCaution","getNextActions","hasNoInput","hasLoad","hasSleep","formatMD","delta","arrow","tone","AthleteDetailModal","prevACWR","latestACWRValue","prevACWRValue","acwrDelta","acwrTrend","weightChartData","body_weight","rawDate","prevWeight","latestWeightValue","prevWeightValue","weightDelta","recent7Days","prev7Days","sumLoad","recs","session_rpe","dur","duration_minutes","load7","loadPrev7","loadDelta","loadTrend","rpeLoadAcwrChartData","acwrMap","ACWR","rpeValue","durValue","loadWeightMergedData","arr","latestACWRDateLabel","ComposedChart","pickAvgRPE","averageRPE","avg_rpe","rpe_avg","pickAvgLoad","averageLoad","avg_load","load_avg","MetricTogglePills","showRPE","showLoad","onToggle","TeamACWRChart","showAvgRPE","showAvgLoad","showRPEUI","setShowRPEUI","showLoadUI","setShowLoadUI","safeData","averageACWR","hasRPE","showRPELine","showLoadLine","showAuxAxis","dayOfWeek","athleteCount","rosterCount","dataMax","hide","priorityRank","isPriority","comparePriority","AlertPanel","onMarkAsRead","onDismiss","onMarkAllAsRead","selectedUserId","userNameMap","setFilter","showDismissed","setShowDismissed","expandedUserIds","setExpandedUserIds","formatTimeAgo","alertTime","diffInMinutes","diffInHours","getTargetUserId","target_user_id","athlete_id","visibleAlerts","scopedAlerts","highPriorityCount","grouped","byUser","topPriority","topAlerts","included","totalCount","aNewest","filteredGrouped","isSingleUserMode","representative","expanded","toggleExpanded","ChartErrorBoundary","constructor","super","__publicField","hasError","getDerivedStateFromError","componentDidCatch","render","getJSTDateKey","organizationQueries","getUserOrganizations","user_uuid","getOrganizationHierarchy","org_id","getOrganizations","details","getOrganizationById","createOrganization","organization","updateOrganization","deleteOrganization","getOrganizationTeams","getTeamById","createTeam","cleanedTeam","department_id","updateTeam","deleteTeam","getOrganizationMembers","addOrganizationMember","member","updateOrganizationMemberRole","removeOrganizationMember","getOrganizationStats","checkOrphanedRecords","assignTeamToOrganization","useOrganizations","organizations","setOrganizations","loadOrganizations","supabase$1","hasSession","stack","newOrg","updated","org","useOrganizationTeams","setTeams","loadTeams","newTeam","avg","useWeeklyGrowthCycle","baseDate","athleteIds","teamDaily","setTeamDaily","weekRange","dateKey","diffToMon","mon","sun","toKey","format","getWeekRangeFromDateKey","athleteIdsKey","ids","idChunk","chunk","lte","xRaw","intent_signal","yRaw","growth_vector","sumX","sumY","sumRpe","teamDailyPoints","loadToRadius","maxLoad","WeeklyGrowthCycleView","weekLabel","matrixPoints","timeline","growth","understanding","useDailyGrowthMatrix","setPoints","athletesKey","display","idsKey","nameMap","reqSeqRef","reqSeq","sumDur","pts","teamAvg","roundTo","formatVal","inferDirection","testDisplayName","dir","buildPerfInsight","athleteName","latestValue","bestValue","unitLabel","direction","p10","p90","prevValue","digitsForTest","bullets","nextActions","sign","eps","gradeVsTeam","formatJP","CoachAthletePerformanceModal","athleteUserId","metricKey","setErr","testType","setTestType","setSeries","benchmark","setBenchmark","metricLabel","is_strength","fmtValue","digitsForByUnit","ts","tsErr","p_user_id","p_test_type_id","p_metric","p_days","bErr","bm","avg_value","minTickGap","reverse","PHASE_LABEL","PHASE_BADGE","todayISO","normalizeTags","TeamSeasonPhaseSettings","phases","setPhases","modalOpen","setModalOpen","setMode","setStartDate","setEndDate","setPhaseType","tagsText","setTagsText","sortedPhases","inRange","next3Weeks","closeModal","fetchPhases","resetFormForCreate","isSameAsToday","openEdit","errs","validatePhase","TeamExportPanel","ReportView","CoachRankingsViewLazy","GrowthUnderstandingQuadrantSummaryLazy","GrowthUnderstandingQuadrantSummary","GrowthUnderstandingMatrixLazy","GrowthUnderstandingMatrix","toISODate","calcRisk","getSummaryMessage","roster","toneStyles","danger","box","StaffView","selectedTeam","setSelectedTeam","setAthletes","athletesLoading","setAthletesLoading","athletesError","setAthletesError","setAthleteACWRMap","acwrLoading","setAcwrLoading","setWeekRange","getThisWeekRange","weekCards","setWeekCards","teamCauseTags","setTeamCauseTags","cycleBaseDate","setCycleBaseDate","selectedAthlete","setSelectedAthlete","perfModal","setPerfModal","showAlertPanel","setShowAlertPanel","setShowAvgRPE","setShowAvgLoad","selectedTeamIdRef","acwrRequestSeqRef","athletesIdsKeyRef","todayKey","noDataDismissedToday","setNoDataDismissedToday","orgHook","safeOrganizations","teamACWRHook","teamACWRData","setTeamACWRData","mySeq","fromKey","acwrRows","acwrErr","average_acwr","cnt","athlete_count","merged","dailyRows","dailyErr","mapDaily","average_rpe","average_load","useTeamACWR","teamACWRLoading","safeTeamACWRData","safeAthletes","safeAlerts","safeWeekCards","teamAlerts","tid","al","highPriorityTeamAlerts","teamAthleteIds","matrixAthletes","matrixTeamAvg","matrixLoading","matrixError","weeklyQuadrantData","setWeeklyQuadrantData","weeklyQuadrantLoading","setWeeklyQuadrantLoading","weeklyQuadrantError","setWeeklyQuadrantError","weeklyReqSeqRef","teamAthleteIdsKey","signal","cycleWeekRange","cycleLoading","cycleError","fetchStaffTeams","fetchTeamAthletesWithActivity","fetchWeekSummary","staffTeamLinks","teamsData","currentTeamId","fetchAthleteACWRFromDaily","weekRes","tagsRes","p_start_date","p_end_date","reqIdsKey","idChunks","allRows","newMap","latestTeamACWR","noDataAthletes","latestTeamAvg","latestValid","summaryTone","minValid","getSummaryTone","focusItems","athlete_user_id","athlete_name","action_done_rate","checkin","praise","it","noDataMap","athleteRiskMap","sortedAthletes","riskMap","aSharing","bSharing","aRisk","bRisk","aScore","bScore","aRaw","bRaw","aAcwr","bAcwr","aReasons","bReasons","sortAthletesByRisk","withRisk","sharing","handleOpenAthleteDetailFromFocus","onOpenAthlete","isGlobalAdmin","UserInvitation","_teams","onUserInvited","restrictToOrganizationId","allowAdminInvite","organizationTeams","setOrganizationTeams","loadingOrgs","setLoadingOrgs","invitedUsers","setInvitedUsers","copiedIndex","setCopiedIndex","mappedOrgs","loadTeamsForOrganization","getRoleLabel","csvContent","temporaryPassword","inviteUrl","invitedAt","emailSent","blob","url","setAttribute","visibility","currentUser","o","supabaseUrl","userResponse","access_token","userResult","passwordSetupLink","inviteExpiredUrl","emailHTML","roleDisplay","staff","admin","inviterName","expiresInHours","generateInvitationEmailHTML","emailText","generateInvitationEmailText","emailError","emailResponse","to","subject","html","emailResult","emailErr","newInvitedUser","newRole","clipboard","writeText","copyPassword","copyInviteUrl","LinkIcon","BulkUserInvitation","onUsersInvited","csvFile","setCsvFile","processedUsers","setProcessedUsers","showResults","setShowResults","successCount","errorCount","sampleData","lines","line","header","findCol","nameIdx","emailIdx","roleIdx","orgIdx","teamIdx","cols","roleRaw","parseCSV","orgQuery","orgs","orgErr","emailErrorMsg","processBulkInvites","PaginatedTable","itemsPerPage","renderItem","renderHeader","emptyMessage","currentPage","setCurrentPage","totalPages","startIndex","endIndex","currentData","goToPage","page","rangeWithDots","pageNumber","UserEditModal","staffTeams","setStaffTeams","isMultiTeamStaff","setIsMultiTeamStaff","userTeams","UserDeleteModal","onUserDeleted","confirmText","setConfirmText","UserManagement","setUsers","filteredUsers","setFilteredUsers","selectedUser","setSelectedUser","showDeleteModal","setShowDeleteModal","searchTerm","setSearchTerm","roleFilter","setRoleFilter","fetchUsers","orgMembers","orgError","userIds","neq","handleDeleteClick","getTeamName","getRoleBadgeStyle","NutritionDev","setActivityLevel","setResult","avg7d","setAvg7d","loadingAvg","setLoadingAvg","avgErr","setAvgErr","fetchMetabolism","sessionData","accessToken","activity_level","fetchMetabolism7dAvg","diffKcal","avg_tdee","diffMessage","lean_mass","NutritionPhotoUploader","mealType","setMealType","mealSlot","setMealSlot","setRecordDate","parts","formatTokyoDate","setFile","uploading","setUploading","setMsg","bucket","previewUrl","src","ext","pop","uuid","uploadErr","upload","contentType","pub","getPublicUrl","insErr","record_date","meal_type","meal_slot","image_path","image_url","publicUrl","reject","reader","FileReader","onload","onerror","readAsDataURL","fileToBase64","image_base64","mime_type","nutrients","menu_items","advice_markdown","OrganizationManagement","selectedOrgId","setSelectedOrgId","showCreateOrgModal","setShowCreateOrgModal","showCreateTeamModal","setShowCreateTeamModal","editingOrg","setEditingOrg","fillRule","clipRule","OrganizationCard","isSelected","onSelect","onEdit","TeamPanel","onCreateClick","CreateOrganizationModal","onCreate","notification","innerHTML","EditOrganizationModal","CreateTeamModal","teamsCount","TeamCard","member_count","staff_count","setDescription","autoFocus","OrganizationOverview","expandedTeams","setExpandedTeams","showAddMemberModal","setShowAddMemberModal","organizationMembers","setOrganizationMembers","searchQuery","setSearchQuery","loadTeamsAndMembers","loadOrganizationMembers","teamsError","teamsWithMembers","staffLinks","staffError","coaches","memberLinks","memberLinksError","usersError","handleRemoveMember","memberRole","new_team_id","totalAthletes","athletesWithoutTeam","totalCoaches","isExpanded","toggleTeam","handleOpenAddMember","coach","AddMemberToTeamModal","allTeams","currentTeamMembers","onSearchChange","onAssign","staff_user_id","currentTeamMemberIds","availableMembers","nameMatch","emailMatch","handleAssign","currentTeam","staffMember","db","subscriptionQueries","getSubscriptionPlans","getSubscriptionPlanById","createSubscriptionPlan","plan","getOrganizationSubscription","createOrganizationSubscription","updateOrganizationSubscription","getUserSubscription","getCurrentUsage","calculateCurrentUsage","thirtyDaysAgo","activeAthletes","allUsers","trainingError","active_athletes","total_users","storage_used_mb","api_calls","data_exports","createUsageRecord","usage","getBillingHistory","createBillingRecord","billing","updateBillingRecord","getPermissionDefinitions","getRolePermissions","getAllRolePermissions","checkPlanLimits","withinLimits","limits","withinAthleteLimit","athlete_limit","withinStorageLimit","storage_gb","exceeded","hasFeature","featureKey","features","upgradePlan","newPlanId","billingCycle","setMonth","setFullYear","plan_id","billing_cycle","current_period_start","current_period_end","cancelSubscription","cancel_at_period_end","reactivateSubscription","SubscriptionManagement","plans","billingHistory","setSubscription","setPlans","setUsage","setBillingHistory","setLimits","loadSubscriptionData","subData","plansData","usageData","billingData","limitsData","refreshUsage","useSubscription","selectedPlan","setSelectedPlan","setBillingCycle","showUpgradeModal","setShowUpgradeModal","showCancelModal","setShowCancelModal","processing","setProcessing","currentPlan","isTrialing","isCancelled","willCancelAtPeriodEnd","formatCurrency","amount","NumberFormat","currency","price_yearly","price_monthly","trial_end","bill","billing_date","payment_method","UpgradeModal","onSelectPlan","onSelectCycle","onConfirm","CancelModal","getFeatureValue","isCurrentPlan","price","OrganizationSettings","tabs","GeneralSettings","NotificationSettings","SecuritySettings","AppearanceSettings","settings","timezone","setTimezone","language","setLanguage","notifications","emailAlerts","setEmailAlerts","highPriorityOnly","setHighPriorityOnly","weeklyReport","setWeeklyReport","usageLimitWarnings","setUsageLimitWarnings","security","dataRetentionDays","setDataRetentionDays","requireMFA","setRequireMFA","allowExport","setAllowExport","appearance","primaryColor","setPrimaryColor","acwrThresholdLow","setAcwrThresholdLow","acwrThresholdHigh","setAcwrThresholdHigh","teamAccessQueries","getMyRequests","getPendingRequestsForMyTeams","userError","myTeams","teamIds","getRequestsForOrganization","getAvailableTeamsToRequest","myTeamsError","myTeamIds","pendingRequests","pendingError","pendingTeamIds","excludedTeamIds","createRequest","requesterId","requester_id","request_message","approveRequest","requestId","reviewerId","request_id","reviewer_user_id","rejectRequest","cancelRequest","getRequestById","TeamAccessRequestManagement","isAdmin","myRequests","organizationRequests","availableTeams","setMyRequests","setPendingRequests","setOrganizationRequests","setAvailableTeams","loadMyRequests","loadPendingRequests","loadOrganizationRequests","loadAvailableTeams","loadAll","labels","useTeamAccessRequests","showCreateModal","setShowCreateModal","selectedTeamId","setSelectedTeamId","requestMessage","setRequestMessage","reviewNotes","setReviewNotes","selectedRequest","setSelectedRequest","availableTeamsCount","getStatusBadge","request","review_notes","requester","reviewer","handleReject","handleApprove","athleteTransferQueries","getMyTransferRequests","or","getAthletesInMyTeams","getAvailableDestinationTeams","createTransferRequest","athleteId","fromTeamId","toTeamId","requestedBy","from_team_id","to_team_id","requested_by","request_reason","approveTransfer","rejectTransfer","cancelTransferRequest","getTransferHistory","getTeamTransferHistory","AthleteTransferManagement","myAthletes","setMyAthletes","loadMyAthletes","useAthleteTransfers","destinationTeamId","setDestinationTeamId","transferReason","setTransferReason","viewingHistory","setViewingHistory","historyData","setHistoryData","handleSelectAthlete","history","handleViewHistory","from_team","to_team","transfer_reason","transfer_date","transferred_by_user","normalizeEmail","OrganizationMembersManagement","members","setMembers","availableUsers","setAvailableUsers","showAddModal","setShowAddModal","showAssignTeamModal","setShowAssignTeamModal","selectedMemberForTeam","setSelectedMemberForTeam","sendStateByEmail","setSendStateByEmail","sendMsgByEmail","setSendMsgByEmail","loadMembers","loadAvailableUsers","loadOrganizationTeams","handleUpdateRole","memberId","handleResendPasswordLink","rawEmail","functions","invoke","getRoleIcon","getRoleBadgeColor","filteredMembers","searchLower","MemberCard","onUpdateRole","onRemove","onAssignTeam","onResendPasswordLink","AddMemberModal","existingMembers","onAdd","AssignTeamModal","p_organization_id","p_assignment_type","emailKey","sendState","sendMsg","isSending","toUpperCase","setSelectedUserId","selectedRole","setSelectedRole","existingMemberUserIds","MAX_ROWS","normalizeHeader","parseNumberOrNull","findFieldKey","candidates","found","norm","AdminInbodyCsvImport","fileName","setFileName","csvText","setCsvText","parsing","setParsing","importing","setImporting","parsed","setParsed","errors","setErrors","info","setInfo","validCount","canImport","handleFile","table","field","inQuotes","buildObjectsFromCSV","keyPhone","keyTest","keyHeight","keyWeight","keyPbf","ng","rowIndex","phone","measured","parseToISODateOnly","csv","inserted","inserted_or_updated","rejected","AdminView","systemSubTab","setSystemSubTab","usersSubTab","setUsersSubTab","setTargetUserId","organizationSubTab","setOrganizationSubTab","inbodyUsers","setInbodyUsers","inbodyUsersLoading","setInbodyUsersLoading","inviteSubTab","setInviteSubTab","selectedOrganizationId","setSelectedOrganizationId","criticalAlertDismissed","setCriticalAlertDismissed","showMobileMenu","setShowMobileMenu","orgsLoading","savedOrgId","selectedOrganization","systemAlerts","thirtyMinutes","fetchTeams","not","unique","usersData","usersErr","fetchInbodyUsers","handleOrganizationSelect","orgId","Layout","useBadges","pollMs","pauseWhenHidden","allBadges","setAllBadges","userBadges","setUserBadges","instanceId","channelRef","badgesLoadedRef","inflightRef","cleanupRealtime","ch","removeChannel","cleanupPoll","fetchBadges","fetchUserBadges","getNewBadges","ub","is_new","viewedAt","viewed_at","isViewed","is_viewed","viewed","getBadgeProgress","earned","percentage","markBadgeAsViewed","userBadgeId","r3","confettiImport","BadgeEarnedModal","handleClose","BadgeModalController","activeUserBadgeId","setActiveUserBadgeId","shownRef","newBadges","list","tierOrder","aTime","earned_at","bTime","aName","bName","aTier","bTier","AuthCallbackPage","normalizeNext","verify","verifyUrl","decodeURIComponent","safeDecode","hash","hashParams","URLSearchParams","hashType","refresh_token","exchangeCodeForSession","replaceState","pathname","setSession","InviteExpired","canSubmit","AlertBadge","hasHighPriority","GlobalHeader","effectiveRole","alertsLoading","hasHighPriorityAlerts","onOpenAlertPanel","closeMenu","charAt","BekutaSplash","ProfileGate","onRetry","timeoutMs","timedOut","setTimedOut","MaintenancePage","etaText","showRetry","nowLabel","pad","getMinutes","getJSTNowLabel","ConsentModal","onAccept","onDecline","agreedToTerms","setAgreedToTerms","agreedToPrivacy","setAgreedToPrivacy","isMinor","setIsMinor","isLoggingOut","setIsLoggingOut","canAccept","rel","getBackgroundColor","getIcon","ToastContainer","toasts","toast","Footer","currentYear","TeamAchievementNotification","setNotifications","showNotification","setShowNotification","currentNotification","setCurrentNotification","realtimeFailed","setRealtimeFailed","removeChannelSafe","loadUnreadNotifications","safe","achievement","triggerConfetti","timeLeft","p_notification_id","getAchievementIcon","achievement_type","OrganizationAdminView","AlertPanel$2","App","authLoading","authRequiresPasswordChange","mounted","event","isOrganizationAdmin","getOrganizationAdminRoles","organizationRoles","setOrganizationRoles","loadOrganizationRoles","queryError","roles","useOrganizationRole","removeToast","setToasts","newToast","useToast","showConsentModal","setShowConsentModal","dashboardMode","setDashboardMode","termsAcceptedLocally","setTermsAcceptedLocally","MAINTENANCE_MODE","isAuthCallback","assign","rootElement","getElementById","root","StrictMode"],"ignoreList":[0,1,2,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,112],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/lib/supabase.ts","../../src/hooks/useAuth.ts","../../src/lib/date.ts","../../src/lib/alerts.ts","../../src/lib/acwr.ts","../../src/hooks/useRealtimeHub.tsx","../../src/hooks/useAlerts.ts","../../src/contexts/TutorialContext.tsx","../../src/hooks/useTutorial.ts","../../node_modules/lucide-react/dist/esm/defaultAttributes.js","../../node_modules/lucide-react/dist/esm/createLucideIcon.js","../../node_modules/lucide-react/dist/esm/icons/activity.js","../../node_modules/lucide-react/dist/esm/icons/alert-circle.js","../../node_modules/lucide-react/dist/esm/icons/alert-triangle.js","../../node_modules/lucide-react/dist/esm/icons/arrow-left.js","../../node_modules/lucide-react/dist/esm/icons/arrow-right.js","../../node_modules/lucide-react/dist/esm/icons/award.js","../../node_modules/lucide-react/dist/esm/icons/bar-chart-2.js","../../node_modules/lucide-react/dist/esm/icons/bar-chart-3.js","../../node_modules/lucide-react/dist/esm/icons/battery.js","../../node_modules/lucide-react/dist/esm/icons/bell.js","../../node_modules/lucide-react/dist/esm/icons/brain.js","../../node_modules/lucide-react/dist/esm/icons/building-2.js","../../node_modules/lucide-react/dist/esm/icons/calendar.js","../../node_modules/lucide-react/dist/esm/icons/camera.js","../../node_modules/lucide-react/dist/esm/icons/check-circle-2.js","../../node_modules/lucide-react/dist/esm/icons/check-circle.js","../../node_modules/lucide-react/dist/esm/icons/check.js","../../node_modules/lucide-react/dist/esm/icons/chevron-down.js","../../node_modules/lucide-react/dist/esm/icons/chevron-left.js","../../node_modules/lucide-react/dist/esm/icons/chevron-right.js","../../node_modules/lucide-react/dist/esm/icons/chevron-up.js","../../node_modules/lucide-react/dist/esm/icons/chevrons-left.js","../../node_modules/lucide-react/dist/esm/icons/chevrons-right.js","../../node_modules/lucide-react/dist/esm/icons/circle.js","../../node_modules/lucide-react/dist/esm/icons/clock.js","../../node_modules/lucide-react/dist/esm/icons/cloud.js","../../node_modules/lucide-react/dist/esm/icons/copy.js","../../node_modules/lucide-react/dist/esm/icons/credit-card.js","../../node_modules/lucide-react/dist/esm/icons/download.js","../../node_modules/lucide-react/dist/esm/icons/droplets.js","../../node_modules/lucide-react/dist/esm/icons/dumbbell.js","../../node_modules/lucide-react/dist/esm/icons/external-link.js","../../node_modules/lucide-react/dist/esm/icons/eye-off.js","../../node_modules/lucide-react/dist/esm/icons/eye.js","../../node_modules/lucide-react/dist/esm/icons/file-spreadsheet.js","../../node_modules/lucide-react/dist/esm/icons/file-text.js","../../node_modules/lucide-react/dist/esm/icons/filter.js","../../node_modules/lucide-react/dist/esm/icons/flame.js","../../node_modules/lucide-react/dist/esm/icons/globe.js","../../node_modules/lucide-react/dist/esm/icons/hand.js","../../node_modules/lucide-react/dist/esm/icons/heart.js","../../node_modules/lucide-react/dist/esm/icons/help-circle.js","../../node_modules/lucide-react/dist/esm/icons/history.js","../../node_modules/lucide-react/dist/esm/icons/info.js","../../node_modules/lucide-react/dist/esm/icons/layout-dashboard.js","../../node_modules/lucide-react/dist/esm/icons/lightbulb.js","../../node_modules/lucide-react/dist/esm/icons/link.js","../../node_modules/lucide-react/dist/esm/icons/loader-2.js","../../node_modules/lucide-react/dist/esm/icons/lock.js","../../node_modules/lucide-react/dist/esm/icons/log-in.js","../../node_modules/lucide-react/dist/esm/icons/log-out.js","../../node_modules/lucide-react/dist/esm/icons/mail.js","../../node_modules/lucide-react/dist/esm/icons/menu.js","../../node_modules/lucide-react/dist/esm/icons/message-square.js","../../node_modules/lucide-react/dist/esm/icons/moon.js","../../node_modules/lucide-react/dist/esm/icons/palette.js","../../node_modules/lucide-react/dist/esm/icons/panels-top-left.js","../../node_modules/lucide-react/dist/esm/icons/pen.js","../../node_modules/lucide-react/dist/esm/icons/pencil.js","../../node_modules/lucide-react/dist/esm/icons/percent.js","../../node_modules/lucide-react/dist/esm/icons/phone.js","../../node_modules/lucide-react/dist/esm/icons/plus.js","../../node_modules/lucide-react/dist/esm/icons/refresh-ccw.js","../../node_modules/lucide-react/dist/esm/icons/refresh-cw.js","../../node_modules/lucide-react/dist/esm/icons/rotate-ccw.js","../../node_modules/lucide-react/dist/esm/icons/ruler.js","../../node_modules/lucide-react/dist/esm/icons/save.js","../../node_modules/lucide-react/dist/esm/icons/scale.js","../../node_modules/lucide-react/dist/esm/icons/search.js","../../node_modules/lucide-react/dist/esm/icons/send.js","../../node_modules/lucide-react/dist/esm/icons/settings.js","../../node_modules/lucide-react/dist/esm/icons/shield-alert.js","../../node_modules/lucide-react/dist/esm/icons/shield-check.js","../../node_modules/lucide-react/dist/esm/icons/shield.js","../../node_modules/lucide-react/dist/esm/icons/sliders.js","../../node_modules/lucide-react/dist/esm/icons/sparkles.js","../../node_modules/lucide-react/dist/esm/icons/square-pen.js","../../node_modules/lucide-react/dist/esm/icons/star.js","../../node_modules/lucide-react/dist/esm/icons/target.js","../../node_modules/lucide-react/dist/esm/icons/thermometer.js","../../node_modules/lucide-react/dist/esm/icons/timer.js","../../node_modules/lucide-react/dist/esm/icons/trash-2.js","../../node_modules/lucide-react/dist/esm/icons/trending-down.js","../../node_modules/lucide-react/dist/esm/icons/trending-up.js","../../node_modules/lucide-react/dist/esm/icons/trophy.js","../../node_modules/lucide-react/dist/esm/icons/unlock.js","../../node_modules/lucide-react/dist/esm/icons/upload.js","../../node_modules/lucide-react/dist/esm/icons/user-check.js","../../node_modules/lucide-react/dist/esm/icons/user-cog.js","../../node_modules/lucide-react/dist/esm/icons/user-plus.js","../../node_modules/lucide-react/dist/esm/icons/user-x.js","../../node_modules/lucide-react/dist/esm/icons/user.js","../../node_modules/lucide-react/dist/esm/icons/users-round.js","../../node_modules/lucide-react/dist/esm/icons/users.js","../../node_modules/lucide-react/dist/esm/icons/wind.js","../../node_modules/lucide-react/dist/esm/icons/x.js","../../node_modules/lucide-react/dist/esm/icons/zap.js","../../src/components/LoginForm.tsx","../../node_modules/canvas-confetti/dist/confetti.module.mjs","../../src/components/PasswordChangeForm.tsx","../../src/components/WelcomePage.tsx","../../src/components/GenericDuplicateModal.tsx","../../src/components/VectorArrowPicker.tsx","../../src/components/SignalPicker.tsx","../../src/components/ui/Toast.tsx","../../src/components/TrainingForm.tsx","../../src/lib/acwrProgressFeedback.ts","../../src/components/ACWRProgressIndicator.tsx","../../src/components/ACWRChart.tsx","../../src/components/EditTrainingRecordModal.tsx","../../src/components/TrainingRecordsList.tsx","../../src/components/AlertSummary.tsx","../../src/components/WeightForm.tsx","../../src/components/WeightChart.tsx","../../src/components/WeightRecordsList.tsx","../../src/components/WeightACWRChart.tsx","../../src/components/InsightCard.tsx","../../src/lib/bmiCalculations.ts","../../src/components/BMIDisplay.tsx","../../src/components/ProfileEditForm.tsx","../../src/components/TutorialOverlay.tsx","../../src/components/TutorialTooltip.tsx","../../src/components/TutorialProgress.tsx","../../src/components/TutorialController.tsx","../../src/hooks/useTrainingData.ts","../../src/lib/logEvent.ts","../../src/hooks/useWeightData.ts","../../src/hooks/useMenstrualCycleData.ts","../../src/lib/tutorialContent.ts","../../src/components/SleepForm.tsx","../../src/components/DuplicateRecordModal.tsx","../../src/components/MotivationForm.tsx","../../src/components/SleepChart.tsx","../../src/components/MotivationChart.tsx","../../src/components/ConditioningSummaryCard.tsx","../../src/components/checkin/CycleSection.tsx","../../src/components/UnifiedDailyCheckIn.tsx","../../src/components/ConsolidatedOverviewDashboard.tsx","../../src/components/MultiMetricTimeline.tsx","../../src/components/FloatingActionButton.tsx","../../src/components/DailyReflectionCard.tsx","../../src/components/ShareStatusButton.tsx","../../src/hooks/useAthleteDerivedValues.ts","../../src/components/DerivedStatsBar.tsx","../../src/lib/normalizeRecords.ts","../../src/hooks/useLastRecords.ts","../../src/hooks/useInbodyData.ts","../../src/components/InBodyLatestCard.tsx","../../src/components/InBodyCharts.tsx","../../src/lib/getTodayEnergySummary.ts","../../src/components/NutritionOverview.tsx","../../src/lib/nutritionCalc.js","../../src/components/FTTCheck.tsx","../../src/components/views/AthleteGamificationView.tsx","../../src/components/MenstrualCycleForm.tsx","../../src/hooks/useBasalBodyTemperature.ts","../../src/components/BasalBodyTemperatureForm.tsx","../../src/components/MenstrualCycleChart.tsx","../../src/components/MenstrualCycleCalendar.tsx","../../src/hooks/usePerformanceData.ts","../../src/components/CyclePerformanceCorrelation.tsx","../../src/components/views/AthleteCycleView.tsx","../../src/hooks/useEntryPopup.ts","../../src/components/EntryPopup.tsx","../../src/lib/phaseAdvice.ts","../../src/lib/dailyOneWord.ts","../../src/lib/pushClient.ts","../../src/components/EmailNotificationSettings.tsx","../../src/components/views/AthleteSettingsView.tsx","../../src/components/AthleteView.tsx","../../src/hooks/useSleepData.ts","../../src/hooks/useMotivationData.ts","../../src/hooks/useDarkMode.ts","../../src/hooks/useTodayNutritionTotals.js","../../src/lib/upsertDailyEnergySnapshot.ts","../../src/components/AthleteList.tsx","../../src/lib/riskUtils.ts","../../src/components/AthleteDetailModal.tsx","../../src/components/TeamACWRChart.tsx","../../src/components/AlertPanel.tsx","../../src/components/ChartErrorBoundary.tsx","../../src/hooks/useTeamACWR.ts","../../src/lib/organizationQueries.ts","../../src/hooks/useOrganizations.ts","../../src/hooks/useWeeklyGrowthCycle.ts","../../src/components/WeeklyGrowthCycleView.tsx","../../src/hooks/useDailyGrowthMatrix.ts","../../src/lib/perfInsight.ts","../../src/components/CoachAthletePerformanceModal.tsx","../../src/components/TeamSeasonPhaseSettings.tsx","../../src/components/StaffView.tsx","../../src/lib/permissions.ts","../../src/components/UserInvitation.tsx","../../src/lib/emailTemplates.ts","../../src/components/BulkUserInvitation.tsx","../../src/components/PaginatedTable.tsx","../../src/components/UserEditModal.tsx","../../src/components/UserDeleteModal.tsx","../../src/components/UserManagement.tsx","../../src/components/NutritionDev.tsx","../../src/components/NutritionPhotoUploader.tsx","../../src/components/OrganizationManagement.tsx","../../src/components/OrganizationOverview.tsx","../../src/lib/subscriptionQueries.ts","../../src/components/SubscriptionManagement.tsx","../../src/hooks/useSubscription.ts","../../src/components/OrganizationSettings.tsx","../../src/lib/teamAccessQueries.ts","../../src/components/TeamAccessRequestManagement.tsx","../../src/hooks/useTeamAccessRequests.ts","../../src/lib/athleteTransferQueries.ts","../../src/components/AthleteTransferManagement.tsx","../../src/hooks/useAthleteTransfers.ts","../../src/components/OrganizationMembersManagement.tsx","../../src/components/AdminInbodyCsvImport.tsx","../../src/components/AdminView.tsx","../../src/hooks/useBadges.ts","../../src/components/BadgeEarnedModal.tsx","../../src/components/BadgeModalController.tsx","../../src/pages/AuthCallbackPage.tsx","../../src/pages/InviteExpired.tsx","../../src/components/AlertBadge.tsx","../../src/components/GlobalHeader.tsx","../../src/components/BekutaSplash.tsx","../../src/components/ProfileGate.tsx","../../src/pages/MaintenancePage.tsx","../../src/components/ConsentModal.tsx","../../src/components/Toast.tsx","../../src/components/ToastContainer.tsx","../../src/components/Footer.tsx","../../src/components/TeamAchievementNotification.tsx","../../src/App.tsx","../../src/hooks/useOrganizationRole.ts","../../src/hooks/useToast.ts","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// src/lib/supabase.ts\nimport { createClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"./database.types\";\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n//  Realtime ON/OFF\nconst ENABLE_REALTIME = import.meta.env.VITE_ENABLE_REALTIME === \"true\";\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error(\"[supabase] URL or ANON KEY is missing\");\n}\n\nconst g = globalThis as any;\n\nexport const supabase =\n  g.__bekuta_supabase ??\n  // biome-ignore lint/suspicious/noAssignInExpressions: <explanation>\n  (g.__bekuta_supabase = createClient<Database>(supabaseUrl!, supabaseAnonKey!, {\n    auth: {\n      persistSession: true,\n      autoRefreshToken: true,\n      detectSessionInUrl: true,\n      storage: typeof window !== \"undefined\" ? window.localStorage : undefined,\n    },\n\n    //   Realtime \n    realtime: ENABLE_REALTIME\n      ? {}\n      : {\n          params: {\n            eventsPerSecond: 0,\n          },\n        },\n  }));\n\n/**\n *  PWA/refresh_token\n * - Invalid Refresh Token  signOut + localStorage \n */\nexport async function recoverFromInvalidRefreshToken(err: unknown) {\n  const msg =\n    err && typeof err === \"object\" && \"message\" in err\n      ? String((err as any).message)\n      : String(err ?? \"\");\n\n  if (\n    msg.includes(\"Invalid Refresh Token\") ||\n    msg.includes(\"Refresh Token Not Found\") ||\n    msg.includes(\"refresh_token\")\n  ) {\n    try {\n      await supabase.auth.signOut();\n    } catch (_) {}\n\n    try {\n      const keys = Object.keys(window.localStorage);\n      for (const k of keys) {\n        if (k.startsWith(\"sb-\") && k.endsWith(\"-auth-token\")) {\n          window.localStorage.removeItem(k);\n        }\n      }\n    } catch (_) {}\n\n    window.location.reload();\n  }\n}\n\nexport type { Database } from \"./database.types\";","// src/hooks/useAuth.ts\nimport { useEffect, useRef, useState, useCallback } from \"react\";\nimport type { User as AuthUser, Session } from \"@supabase/supabase-js\";\nimport { supabase, User } from \"../lib/supabase\";\n\ntype AuthLoadingState = \"booting\" | \"ready\";\n\nfunction sleep(ms: number) {\n  return new Promise((r) => setTimeout(r, ms));\n}\n\n//  soft timeout\nasync function softTimeout<T>(p: Promise<T>, ms: number): Promise<T | null> {\n  let timer: any;\n  try {\n    const result = await Promise.race([\n      p,\n      new Promise<null>((resolve) => {\n        timer = setTimeout(() => resolve(null), ms);\n      }),\n    ]);\n    return result as T | null;\n  } finally {\n    clearTimeout(timer);\n  }\n}\n\nexport function useAuth() {\n  const [user, setUser] = useState<AuthUser | null>(null);\n  const [userProfile, setUserProfile] = useState<User | null>(null);\n\n  //  loading authprofile\n  const [loadingState, setLoadingState] = useState<AuthLoadingState>(\"booting\");\n  const loading = loadingState !== \"ready\";\n\n  const [requiresPasswordChange, setRequiresPasswordChange] = useState(false);\n\n  const mountedRef = useRef(true);\n  const fetchSeqRef = useRef(0);\n\n  const checkPasswordChangeRequired = (authUser: AuthUser) => {\n    const requiresChange = authUser.user_metadata?.requires_password_change === true;\n    setRequiresPasswordChange(requiresChange);\n  };\n\n  // --- users  ---\n  const fetchUserProfile = useCallback(async (uid: string) => {\n    const seq = ++fetchSeqRef.current;\n\n    // 0.3s  0.8s  1.5s 3\n    const retryDelays = [0, 300, 800, 1500];\n\n    for (let i = 0; i < retryDelays.length; i++) {\n      if (!mountedRef.current) return;\n      if (seq !== fetchSeqRef.current) return; // \n\n      if (retryDelays[i] > 0) await sleep(retryDelays[i]);\n\n      //   UI\n      const res = await softTimeout(\n        supabase.from(\"users\").select(\"*\").eq(\"id\", uid).maybeSingle(),\n        8000\n      );\n\n      if (!mountedRef.current) return;\n      if (seq !== fetchSeqRef.current) return;\n\n      if (res === null) {\n        // timeout/ \n        continue;\n      }\n\n      const { data, error } = res;\n\n      if (error) {\n        console.error(\"[useAuth] fetchUserProfile error:\", error);\n        // RLS/\n        setUserProfile(null);\n        return;\n      }\n\n      if (data) {\n        setUserProfile(data as User);\n        return;\n      }\n\n      // datanull \n    }\n\n    // auth profile=null \n    setUserProfile(null);\n  }, []);\n\n  const applySession = useCallback(\n    async (session: Session | null) => {\n      const u = session?.user ?? null;\n\n      setUser(u);\n\n      if (u) {\n        checkPasswordChangeRequired(u);\n        //  profileloading\n        fetchUserProfile(u.id);\n      } else {\n        setUserProfile(null);\n        setRequiresPasswordChange(false);\n      }\n    },\n    [fetchUserProfile]\n  );\n\n  //  \n  const refreshUserProfile = useCallback(async () => {\n    try {\n      const { data, error } = await supabase.auth.getUser();\n      if (error) {\n        console.error(\"[useAuth] refreshUserProfile getUser error:\", error);\n        return;\n      }\n      const uid = data.user?.id;\n      if (!uid) return;\n      await fetchUserProfile(uid);\n    } catch (e) {\n      console.error(\"[useAuth] refreshUserProfile failed:\", e);\n    }\n  }, [fetchUserProfile]);\n\n  useEffect(() => {\n    mountedRef.current = true;\n\n    // 1) \n    const { data: sub } = supabase.auth.onAuthStateChange(async (_event, session) => {\n      if (!mountedRef.current) return;\n      await applySession(session);\n      if (mountedRef.current) setLoadingState(\"ready\");\n    });\n\n    // 2)  timeout  \n    (async () => {\n      try {\n        //  onAuthStateChange OK\n        const res = await softTimeout(supabase.auth.getSession(), 8000);\n        if (!mountedRef.current) return;\n\n        if (res?.data?.session) {\n          await applySession(res.data.session);\n        }\n      } catch (e) {\n        console.error(\"[useAuth] init getSession failed:\", e);\n      } finally {\n        if (mountedRef.current) setLoadingState(\"ready\");\n      }\n    })();\n\n    return () => {\n      mountedRef.current = false;\n      sub?.subscription?.unsubscribe();\n    };\n  }, [applySession]);\n\n  // ---  ---\n  const signIn = async (email: string, password: string) => {\n    const { data, error } = await supabase.auth.signInWithPassword({\n      email: email.trim(),\n      password,\n    });\n    if (error) throw error;\n\n    if (data.user?.user_metadata?.requires_password_change) {\n      setRequiresPasswordChange(true);\n    }\n    return data;\n  };\n\n  // ---  ---\n  const changePassword = async (newPassword: string) => {\n    const { error } = await supabase.auth.updateUser({\n      password: newPassword,\n      data: { requires_password_change: false },\n    });\n    if (error) throw error;\n    setRequiresPasswordChange(false);\n    // profile refreshUserProfile OK\n  };\n\n  // ---   ---\n  const acceptTerms = async () => {\n    if (!user) throw new Error(\"User not logged in\");\n\n    const now = new Date().toISOString();\n    const { error } = await supabase\n      .from(\"users\")\n      .update({ terms_accepted: true, terms_accepted_at: now })\n      .eq(\"id\", user.id);\n\n    if (error) {\n      console.error(\"[useAuth] acceptTerms failed:\", error);\n      throw error;\n    }\n\n    setUserProfile((prev) =>\n      prev ? { ...prev, terms_accepted: true, terms_accepted_at: now } : prev\n    );\n  };\n\n  // ---  ---\n  const signOut = async () => {\n    try {\n      await supabase.auth.signOut();\n    } catch (e) {\n      console.error(\"[useAuth] signOut error:\", e);\n    } finally {\n      setUser(null);\n      setUserProfile(null);\n      setRequiresPasswordChange(false);\n      setLoadingState(\"ready\");\n    }\n  };\n\n  return {\n    user,\n    userProfile,\n    loading,\n    requiresPasswordChange,\n    signIn,\n    signOut,\n    changePassword,\n    acceptTerms,\n    refreshUserProfile,\n  };\n}","// lib/date.ts\n\n// JSTUTC+9\nconst JST_OFFSET_MS = 9 * 60 * 60 * 1000;\n\n/**\n *  Date JST  Date \n *  UTC  9 Date\n */\nexport function toJST(date: Date): Date {\n  return new Date(date.getTime() + JST_OFFSET_MS);\n}\n\n/**\n *  Date JST  YYYY-MM-DD\n */\nexport function formatDateToJST(date: Date): string {\n  const jst = toJST(date);\n  const year = jst.getUTCFullYear();\n  const month = String(jst.getUTCMonth() + 1).padStart(2, \"0\");\n  const day = String(jst.getUTCDate()).padStart(2, \"0\");\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * JST Date \n */\nexport function getTodayJST(): Date {\n  return toJST(new Date());\n}\n\n/**\n * JST YYYY-MM-DD \n */\nexport function getTodayJSTString(): string {\n  return formatDateToJST(new Date());\n}\n\n/**\n * JST  N  YYYY-MM-DD \n */\nexport function getJSTDateMinusDays(days: number): string {\n  const base = getTodayJST();\n  base.setUTCDate(base.getUTCDate() - days);\n  return formatDateToJST(base);\n}\n\n/**\n *  daysDiff  JST  YYYY-MM-DD \n * : getJSTDateFrom(date, -27)  27\n */\nexport function getJSTDateFrom(date: Date, daysDiff: number): string {\n  const base = toJST(date);\n  base.setUTCDate(base.getUTCDate() + daysDiff);\n  return formatDateToJST(base);\n}\n\n/**\n * JST YYYY-MM-DD \n */\nexport function getYearsAgoJST(years: number): string {\n  const base = getTodayJST();\n  base.setUTCFullYear(base.getUTCFullYear() - years);\n  return formatDateToJST(base);\n}\n\n/**\n * \n *  getYearsAgoJST \n */\nexport function getYearsAgoString(years: number): string {\n  return getYearsAgoJST(years);\n}\n\n/**\n *  YYYY-MM-DD\n * UI\n */\nexport function toLocalDateString(date: Date): string {\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * : getDaysAgoJSTString\n * JST N  YYYY-MM-DD\n */\nexport function getDaysAgoJSTString(days: number): string {\n  return getJSTDateMinusDays(days);\n}\n\n/**\n * : getJSTDAYSAGOString\n * JST  N  YYYY-MM-DD\n */\nexport function getJSTDAYSAGOString(days: number): string {\n  return getJSTDateMinusDays(days);\n}\n\n/**\n *  n  Date\n * Date \n */\nexport function getDateNDaysAgo(date: Date, days: number): Date {\n  const d = new Date(date);\n  d.setDate(d.getDate() - days);\n  return d;\n}\n\n/**\n * : toJSTDateString\n *  Date  JST  YYYY-MM-DD \n */\nexport function toJSTDateString(date: Date): string {\n  return formatDateToJST(date);\n}\n\n/**\n * : formatDateJST \n *   formatDateToJST  alias \n */\nexport function formatDateJST(date: Date): string {\n  return formatDateToJST(date);\n}\n\nexport function getNowJSTISOString(): string {\n  const jst = new Date(Date.now() + 9 * 60 * 60 * 1000);\n  return jst.toISOString().replace('Z', '+09:00'); \n}","// src/lib/alerts.ts\nimport { formatDateJST } from '../lib/date';\n\nexport interface Alert {\n  id: string;\n  user_id: string;\n\n  // UI \n  user_name?: string;\n\n  //  sRPE\n  type:\n    | 'high_risk'\n    | 'caution'\n    | 'low_load'\n    | 'no_data'\n    | 'reminder'\n    | 'srpe_high'\n    | 'srpe_spike';\n\n  priority: 'high' | 'medium' | 'low';\n  title: string;\n  message: string;\n\n  acwr_value?: number;\n  threshold_exceeded?: string;\n\n  // \n  last_training_date?: string;\n  days_since_last_training?: number;\n\n  // sRPE\n  srpe_value?: number;\n  srpe_avg_7d?: number;\n  srpe_spike_ratio?: number;\n\n  is_read: boolean;\n  is_dismissed: boolean;\n  created_at: string;\n  expires_at?: string;\n}\n\n//  \nexport type AlertCondition =\n  | 'acwr_above'\n  | 'acwr_below'\n  | 'no_training_days'\n  | 'no_training_today'\n  | 'srpe_above'\n  | 'srpe_spike_ratio';\n\nexport interface AlertRule {\n  id: string;\n  type: Alert['type'];\n  condition: AlertCondition;\n  threshold: number;\n  enabled: boolean;\n  description: string;\n}\n\n//  ACWR \nconst MIN_DAYS_FOR_ACWR = 21;\n\n// \nexport const DEFAULT_ALERT_RULES: Omit<AlertRule, 'id'>[] = [\n  {\n    type: 'high_risk',\n    condition: 'acwr_above',\n    threshold: 1.5,\n    enabled: true,\n    description: 'ACWR  1.5 ',\n  },\n  {\n    type: 'caution',\n    condition: 'acwr_above',\n    threshold: 1.3,\n    enabled: true,\n    description: 'ACWR  1.3 ',\n  },\n  {\n    type: 'low_load',\n    condition: 'acwr_below',\n    threshold: 0.8,\n    enabled: true,\n    description: 'ACWR  0.8 ',\n  },\n  {\n    type: 'no_data',\n    condition: 'no_training_days',\n    threshold: 5,\n    enabled: true,\n    description: '5',\n  },\n  {\n    type: 'reminder',\n    condition: 'no_training_today',\n    threshold: 1,\n    enabled: false,\n    description: '22',\n  },\n\n  //  sRPE\n  {\n    type: 'srpe_high',\n    condition: 'srpe_above',\n    threshold: 600,\n    enabled: true,\n    description: 'sRPERPE600',\n  },\n  {\n    type: 'srpe_spike',\n    condition: 'srpe_spike_ratio',\n    threshold: 1.6,\n    enabled: true,\n    description: 'sRPE1.6',\n  },\n];\n\n// \nexport function generateAlerts(\n  userId: string,\n  userName: string,\n  acwrData: any[],\n  trainingRecords: any[],\n  rules: AlertRule[]\n): Alert[] {\n  const alerts: Alert[] = [];\n  const now = new Date();\n  const today = formatDateJST(now); // JST \n\n  // ACWR\n  const latestACWR = acwrData.length > 0 ? acwrData[acwrData.length - 1] : null;\n\n  // \n  const lastTraining =\n    trainingRecords.length > 0 ? trainingRecords[trainingRecords.length - 1] : null;\n\n  // dateJST\n  const todayTraining = trainingRecords.find((r) => r.date === today);\n\n  //  ACWR \n  const uniqueDates = Array.from(new Set(trainingRecords.map((r) => r.date)));\n  const trainingDaysCount = uniqueDates.length;\n  const hasEnoughDaysForACWR = trainingDaysCount >= MIN_DAYS_FOR_ACWR;\n\n  // -------------------------\n  //  sRPE RPE\n  // -------------------------\n  const getSRPE = (r: any) => {\n    //  OK\n    const rpe = Number(r?.rpe ?? 0);\n    const duration = Number(r?.duration_min ?? 0);\n\n    if (!rpe || !duration) return 0;\n    return Math.round(rpe * duration);\n  };\n\n  // \n  const srpeByDate = new Map<string, number>();\n  for (const r of trainingRecords) {\n    const d = r.date;\n    if (!d) continue;\n    srpeByDate.set(d, (srpeByDate.get(d) ?? 0) + getSRPE(r));\n  }\n\n  const todaySRPE = srpeByDate.get(today) ?? 0;\n\n  // 70\n  const last7Dates = Array.from(srpeByDate.keys())\n    .sort()\n    .filter((d) => d < today)\n    .slice(-7);\n\n  const last7Values = last7Dates\n    .map((d) => srpeByDate.get(d) ?? 0)\n    .filter((v) => v > 0);\n\n  const last7Avg = last7Values.length\n    ? Math.round(last7Values.reduce((a, b) => a + b, 0) / last7Values.length)\n    : 0;\n\n  const spikeRatio = last7Avg > 0 ? Number((todaySRPE / last7Avg).toFixed(2)) : 0;\n\n  // -------------------------\n  // \n  // -------------------------\n  rules.forEach((rule) => {\n    if (!rule.enabled) return;\n\n    let shouldAlert = false;\n\n    let alertData: Partial<Alert> = {\n      user_id: userId,\n      user_name: userName,\n      type: rule.type,\n      is_read: false,\n      is_dismissed: false,\n      created_at: now.toISOString(), // UTCOK\n    };\n\n    switch (rule.condition) {\n      case 'acwr_above':\n        //  21 ACWR \n        if (!hasEnoughDaysForACWR) break;\n\n        if (latestACWR && latestACWR.acwr > rule.threshold) {\n          shouldAlert = true;\n          alertData = {\n            ...alertData,\n            priority: rule.type === 'high_risk' ? 'high' : 'medium',\n            title: rule.type === 'high_risk' ? ' ' : ' ',\n            message: `${userName}ACWR${latestACWR.acwr}${rule.threshold}`,\n            acwr_value: latestACWR.acwr,\n            threshold_exceeded: `${rule.threshold}`,\n            expires_at: new Date(now.getTime() + 48 * 60 * 60 * 1000).toISOString(),\n          };\n        }\n        break;\n\n      case 'acwr_below':\n        //  21 ACWR \n        if (!hasEnoughDaysForACWR) break;\n\n        if (latestACWR && latestACWR.acwr < rule.threshold) {\n          shouldAlert = true;\n          alertData = {\n            ...alertData,\n            priority: 'low',\n            title: ' ',\n            message: `${userName}ACWR${latestACWR.acwr}${rule.threshold}`,\n            acwr_value: latestACWR.acwr,\n            threshold_exceeded: `${rule.threshold}`,\n            expires_at: new Date(now.getTime() + 72 * 60 * 60 * 1000).toISOString(),\n          };\n        }\n        break;\n\n      case 'no_training_days':\n        if (lastTraining) {\n          const daysSinceLastTraining = Math.floor(\n            (now.getTime() - new Date(lastTraining.date).getTime()) /\n              (1000 * 60 * 60 * 24)\n          );\n\n          if (daysSinceLastTraining >= rule.threshold) {\n            shouldAlert = true;\n            alertData = {\n              ...alertData,\n              priority: 'medium',\n              title: ' ',\n              message: `${userName}${daysSinceLastTraining}`,\n              last_training_date: lastTraining.date,\n              days_since_last_training: daysSinceLastTraining,\n              expires_at: new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString(),\n            };\n          }\n        }\n        break;\n\n      case 'no_training_today':\n        // 22\n        if (now.getHours() >= 22 && !todayTraining) {\n          shouldAlert = true;\n          alertData = {\n            ...alertData,\n            priority: 'low',\n            title: ' ',\n            message: `${userName}`,\n            expires_at: new Date(now.getTime() + 2 * 60 * 60 * 1000).toISOString(),\n          };\n        }\n        break;\n\n      //  sRPE: \n      case 'srpe_above':\n        if (todaySRPE > 0 && todaySRPE >= rule.threshold) {\n          shouldAlert = true;\n          alertData = {\n            ...alertData,\n            priority: 'medium',\n            title: ' sRPE',\n            message: `${userName}sRPE${todaySRPE}`,\n            srpe_value: todaySRPE,\n            expires_at: new Date(now.getTime() + 48 * 60 * 60 * 1000).toISOString(),\n          };\n        }\n        break;\n\n      //  sRPE: \n      case 'srpe_spike_ratio':\n        if (todaySRPE > 0 && last7Avg > 0 && spikeRatio >= rule.threshold) {\n          shouldAlert = true;\n          alertData = {\n            ...alertData,\n            priority: 'high',\n            title: ' sRPE',\n            message: `${userName}sRPE${todaySRPE} / ${last7Avg} = ${spikeRatio}`,\n            srpe_value: todaySRPE,\n            srpe_avg_7d: last7Avg,\n            srpe_spike_ratio: spikeRatio,\n            expires_at: new Date(now.getTime() + 72 * 60 * 60 * 1000).toISOString(),\n          };\n        }\n        break;\n    }\n\n    if (shouldAlert) {\n      alerts.push({\n        id: `${userId}-${rule.type}-${Date.now()}`,\n        ...alertData,\n      } as Alert);\n    }\n  });\n\n  return alerts;\n}\n\n// \nexport function getAlertStyle(alert: Alert) {\n  switch (alert.priority) {\n    case 'high':\n      return {\n        bgColor: 'bg-red-50',\n        borderColor: 'border-red-200',\n        textColor: 'text-red-800',\n        iconColor: 'text-red-600',\n        icon: '',\n      };\n    case 'medium':\n      return {\n        bgColor: 'bg-yellow-50',\n        borderColor: 'border-yellow-200',\n        textColor: 'text-yellow-800',\n        iconColor: 'text-yellow-600',\n        icon: '',\n      };\n    case 'low':\n      return {\n        bgColor: 'bg-blue-50',\n        borderColor: 'border-blue-200',\n        textColor: 'text-blue-800',\n        iconColor: 'text-blue-600',\n        icon: '',\n      };\n    default:\n      return {\n        bgColor: 'bg-gray-50',\n        borderColor: 'border-gray-200',\n        textColor: 'text-gray-800',\n        iconColor: 'text-gray-600',\n        icon: '',\n      };\n  }\n}\n\n// \nexport function getAlertTypeLabel(type: Alert['type']): string {\n  switch (type) {\n    case 'high_risk':\n      return '';\n    case 'caution':\n      return '';\n    case 'low_load':\n      return '';\n    case 'no_data':\n      return '';\n    case 'reminder':\n      return '';\n\n    //  sRPE\n    case 'srpe_high':\n      return 'sRPE';\n    case 'srpe_spike':\n      return 'sRPE';\n\n    default:\n      return '';\n  }\n}\n\n// \nexport function isAlertExpired(alert: Alert): boolean {\n  if (!alert.expires_at) return false;\n  return new Date() > new Date(alert.expires_at);\n}\n\n// \nexport function filterActiveAlerts(alerts: Alert[]): Alert[] {\n  return alerts.filter((alert) => !alert.is_dismissed && !isAlertExpired(alert));\n}\n\n// \nexport function sortAlertsByPriority(alerts: Alert[]): Alert[] {\n  const priorityOrder = { high: 3, medium: 2, low: 1 };\n  return alerts.sort((a, b) => {\n    const priorityDiff = priorityOrder[b.priority] - priorityOrder[a.priority];\n    if (priorityDiff !== 0) return priorityDiff;\n\n    // \n    return new Date(b.created_at).getTime() - new Date(a.created_at).getTime();\n  });\n}","// src/lib/acwr.ts\n\nexport type RecordLike = {\n  date: string;        // YYYY-MM-DD\n  load: number | null; // 1sRPE\n};\n\nexport type RiskLevel =\n  | 'high'\n  | 'caution'\n  | 'good'\n  | 'low'\n  | 'unknown';\n\nexport type ACWRData = {\n  date: string;                 // YYYY-MM-DD\n  acwr: number | null;\n  acuteLoad: number | null;\n  chronicLoad: number | null;\n  riskLevel?: RiskLevel;\n};\n\n// -------------------------\n// Date helpers (UTCYYYY-MM-DD)\n// -------------------------\nfunction parseISODateOnlyUTC(iso: string): Date {\n  // iso: YYYY-MM-DD\n  const [y, m, d] = iso.split('-').map((v) => Number(v));\n  // UTC00:00:00\n  return new Date(Date.UTC(y, (m || 1) - 1, d || 1));\n}\n\nfunction toISOUTC(d: Date) {\n  return d.toISOString().slice(0, 10);\n}\n\nfunction addDaysUTC(d: Date, n: number) {\n  const x = new Date(d);\n  x.setUTCDate(x.getUTCDate() + n);\n  return x;\n}\n\n// -------------------------\n// Risk helpers\n// -------------------------\nexport function getRiskLabel(riskLevel: RiskLevel | string | undefined): string {\n  switch (riskLevel) {\n    case 'high': return '';\n    case 'caution': return '';\n    case 'good': return '';\n    case 'low': return '';\n    default: return '';\n  }\n}\n\n//  Chart/acwrriskLevelOK\nexport function getRiskColor(v: number | null | undefined | RiskLevel): string {\n  // riskLevel \n  if (typeof v === 'string') {\n    switch (v) {\n      case 'high': return '#ef4444';    // red\n      case 'caution': return '#f59e0b'; // amber\n      case 'good': return '#22c55e';    // green\n      case 'low': return '#3b82f6';     // blue\n      default: return '#94a3b8';        // gray\n    }\n  }\n\n  // acwr \n  const acwr = v;\n  if (acwr == null || !Number.isFinite(acwr)) return '#94a3b8'; // gray\n  if (acwr > 1.5) return '#ef4444'; // red\n  if (acwr >= 1.3) return '#f59e0b'; // amber\n  if (acwr >= 0.8) return '#22c55e'; // green\n  return '#3b82f6'; // blue\n}\n\n// -------------------------\n// ACWR calc\n// -------------------------\nexport function calculateACWR(records: RecordLike[]): ACWRData[] {\n  // 1) \n  const dailyMap = new Map<string, number>();\n  for (const r of records) {\n    if (!r?.date) continue;\n    const load = typeof r.load === 'number' && Number.isFinite(r.load) ? r.load : 0;\n    dailyMap.set(r.date, (dailyMap.get(r.date) ?? 0) + load);\n  }\n\n  const dates = Array.from(dailyMap.keys()).sort();\n  if (dates.length === 0) return [];\n\n  // 2) 0UTC\n  const start = parseISODateOnlyUTC(dates[0]);\n  const end = parseISODateOnlyUTC(dates[dates.length - 1]);\n\n  const series: { date: string; load: number }[] = [];\n  for (let d = start; d <= end; d = addDaysUTC(d, 1)) {\n    const key = toISOUTC(d);\n    series.push({ date: key, load: dailyMap.get(key) ?? 0 });\n  }\n\n  // 3) rolling=7, =28/4\n  const out: ACWRData[] = [];\n\n  for (let i = 0; i < series.length; i++) {\n    const date = series[i].date;\n\n    // 28027\n    if (i < 27) {\n      out.push({ date, acwr: null, acuteLoad: null, chronicLoad: null, riskLevel: 'unknown' });\n      continue;\n    }\n\n    const acuteSum = series.slice(i - 6, i + 1).reduce((s, x) => s + x.load, 0);\n    const chronicSum = series.slice(i - 27, i + 1).reduce((s, x) => s + x.load, 0);\n    const chronic = chronicSum / 4; // 4\n\n    const acwr = chronic > 0 ? acuteSum / chronic : null;\n    const acwrVal = acwr != null ? Number(acwr.toFixed(2)) : null;\n\n    const riskLevel: RiskLevel =\n      acwrVal == null ? 'unknown' :\n      acwrVal > 1.5 ? 'high' :\n      acwrVal >= 1.3 ? 'caution' :\n      acwrVal >= 0.8 ? 'good' : 'low';\n\n    out.push({\n      date,\n      acuteLoad: Number(acuteSum.toFixed(1)),\n      chronicLoad: chronic > 0 ? Number(chronic.toFixed(1)) : null,\n      acwr: acwrVal,\n      riskLevel,\n    });\n  }\n\n  return out;\n}","// src/hooks/useRealtimeHub.tsx\nimport React, { createContext, useCallback, useContext, useEffect, useMemo, useRef, useState } from \"react\";\n\n\ntype PollJob = {\n  key: string;\n  intervalMs: number;\n  run: () => Promise<void> | void;\n\n  enabled: boolean;\n  requireVisible: boolean; // true\n  requireOnline: boolean;  // trueoffline\n\n  // \n  nextAt: number;\n  failCount: number;\n};\n\ntype HubState = {\n  isVisible: boolean;\n  isOnline: boolean;\n  canRun: boolean;        // visible & online\n  canRealtime: boolean;   // Realtimevisible & online\n};\n\ntype RegisterPollArgs = {\n  key: string;\n  intervalMs: number;\n  run: () => Promise<void> | void;\n  enabled?: boolean;\n  requireVisible?: boolean;\n  requireOnline?: boolean;\n  immediate?: boolean; // truetick\n};\n\ntype RealtimeHubContextValue = {\n  state: HubState;\n  registerPollJob: (args: RegisterPollArgs) => () => void; // unregister \n  unregisterJob: (key: string) => void;\n};\n\n\nconst RealtimeHubContext = createContext<RealtimeHubContextValue | null>(null);\n\nexport function RealtimeHubProvider({ children }: { children: React.ReactNode }) {\n  const [isVisible, setIsVisible] = useState<boolean>(() => {\n    if (typeof document === \"undefined\") return true;\n    return !document.hidden;\n  });\n  const [isOnline, setIsOnline] = useState<boolean>(() => {\n    if (typeof navigator === \"undefined\") return true;\n    return navigator.onLine;\n  });\n\n  const jobsRef = useRef<Map<string, PollJob>>(new Map());\n\n  // statereftick\n  const isVisibleRef = useRef(isVisible);\n  const isOnlineRef = useRef(isOnline);\n  useEffect(() => { isVisibleRef.current = isVisible; }, [isVisible]);\n  useEffect(() => { isOnlineRef.current = isOnline; }, [isOnline]);\n\n  useEffect(() => {\n    const onVis = () => setIsVisible(!document.hidden);\n    const onOnline = () => setIsOnline(true);\n    const onOffline = () => setIsOnline(false);\n\n    document.addEventListener(\"visibilitychange\", onVis);\n    window.addEventListener(\"online\", onOnline);\n    window.addEventListener(\"offline\", onOffline);\n\n    return () => {\n      document.removeEventListener(\"visibilitychange\", onVis);\n      window.removeEventListener(\"online\", onOnline);\n      window.removeEventListener(\"offline\", onOffline);\n    };\n  }, []);\n\n  const unregisterJob = useCallback((key: string) => {\n    jobsRef.current.delete(key);\n  }, []);\n\n  const runJobOnce = useCallback(async (job: PollJob) => {\n    try {\n      await job.run();\n      job.failCount = 0;\n      job.nextAt = Date.now() + job.intervalMs;\n    } catch (e) {\n      job.failCount += 1;\n\n      // 5\n      const base = 2000; // 2s\n      const backoff = Math.min(300000, base * Math.pow(2, Math.min(8, job.failCount)));\n      job.nextAt = Date.now() + backoff;\n\n      if (import.meta.env.DEV) {\n        console.warn(\"[RealtimeHub] job failed:\", job.key, \"failCount=\", job.failCount, e);\n      }\n    }\n  }, []);\n\n  //   interval \n  useEffect(() => {\n    const timer = window.setInterval(() => {\n      const now = Date.now();\n      const visible = isVisibleRef.current;\n      const online = isOnlineRef.current;\n\n      for (const job of jobsRef.current.values()) {\n        if (!job.enabled) continue;\n        if (job.requireVisible && !visible) continue;\n        if (job.requireOnline && !online) continue;\n        if (now < job.nextAt) continue;\n\n        // fire-and-forget runJobOnce \n        void runJobOnce(job);\n      }\n    }, 1000);\n\n    return () => window.clearInterval(timer);\n  }, [runJobOnce]);\n\n  const registerPollJob = useCallback((args: RegisterPollArgs) => {\n    const {\n      key,\n      intervalMs,\n      run,\n      enabled = true,\n      requireVisible = true,\n      requireOnline = true,\n      immediate = false,\n    } = args;\n\n    const existing = jobsRef.current.get(key);\n\n    const job: PollJob = existing ?? {\n      key,\n      intervalMs,\n      run,\n      enabled,\n      requireVisible,\n      requireOnline,\n      nextAt: Date.now(),\n      failCount: 0,\n    };\n\n    // update\n    job.intervalMs = intervalMs;\n    job.run = run;\n    job.enabled = enabled;\n    job.requireVisible = requireVisible;\n    job.requireOnline = requireOnline;\n\n    // enabled\n    if (enabled) {\n      job.nextAt = immediate ? Date.now() : Date.now() + intervalMs;\n    }\n\n    jobsRef.current.set(key, job);\n\n    if (immediate && enabled) {\n      void runJobOnce(job);\n    }\n\n    return () => {\n      jobsRef.current.delete(key);\n    };\n  }, [runJobOnce]);\n\n  const state: HubState = useMemo(() => {\n    const can = isVisible && isOnline;\n    return {\n      isVisible,\n      isOnline,\n      canRun: can,\n      canRealtime: can,\n    };\n  }, [isVisible, isOnline]);\n\n  const value: RealtimeHubContextValue = useMemo(\n    () => ({ state, registerPollJob, unregisterJob }),\n    [state, registerPollJob, unregisterJob]\n  );\n\n  return <RealtimeHubContext.Provider value={value}>{children}</RealtimeHubContext.Provider>;\n}\n\nexport function useRealtimeHub() {\n  const ctx = useContext(RealtimeHubContext);\n  if (!ctx) throw new Error(\"useRealtimeHub must be used within RealtimeHubProvider\");\n  return ctx;\n}","// src/hooks/useAlerts.ts\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport { supabase } from \"../lib/supabase\";\nimport type { AppRole } from \"../lib/roles\";\nimport {\n  Alert,\n  AlertRule,\n  DEFAULT_ALERT_RULES,\n  generateAlerts,\n  filterActiveAlerts,\n  sortAlertsByPriority,\n} from \"../lib/alerts\";\nimport { calculateACWR } from \"../lib/acwr\";\nimport { useRealtimeHub } from \"./useRealtimeHub\";\n\nconst ENABLE_REALTIME_ALERT_EMAILS = false;\ntype UserRole = AppRole;\n\nexport function useAlerts(userId: string, userRole: UserRole) {\n  const [alerts, setAlerts] = useState<Alert[]>([]);\n  const [alertRules, setAlertRules] = useState<AlertRule[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  const { registerPollJob } = useRealtimeHub();\n\n  //  hookjob key\n  const instanceIdRef = useRef(\n    globalThis.crypto?.randomUUID?.() ?? Math.random().toString(36).slice(2)\n  );\n\n  //  Poll unregister \n  const unregisterPollRef = useRef<null | (() => void)>(null);\n\n  const sendAlertEmailsForNewAlerts = async (newAlerts: Alert[]) => {\n    // \n    if (import.meta.env.DEV) {\n      console.info(\n        \"[useAlerts] sendAlertEmailsForNewAlerts is disabled. New alerts count:\",\n        newAlerts.length\n      );\n    }\n  };\n\n  // -----------------------------\n  //  Usersstaff/admin + dedupe\n  // -----------------------------\n  const loadUsersToCheck = useCallback(async () => {\n    if (!userId || !userRole) return [];\n\n    let usersToCheck: Array<{ id: string; name: string }> = [];\n\n    if (userRole === \"athlete\") {\n      const { data: userData } = await supabase\n        .from(\"users\")\n        .select(\"id, name\")\n        .eq(\"id\", userId)\n        .single();\n\n      if (userData) usersToCheck = [userData];\n    }\n\n    if (userRole === \"staff\") {\n      const { data: teamData, error } = await supabase\n        .from(\"staff_team_links\")\n        .select(\n          `\n          team_id,\n          teams!inner (\n            users!inner (\n              id,\n              name\n            )\n          )\n        `\n        )\n        .eq(\"staff_user_id\", userId);\n\n      if (error) console.error(\"[useAlerts] staff team fetch error:\", error);\n\n      const rawUsers =\n        teamData?.flatMap((link: any) => (link.teams as any)?.users || []) || [];\n\n      const deduped = new Map<string, { id: string; name: string }>();\n      for (const u of rawUsers) {\n        if (!u?.id) continue;\n        if (!deduped.has(u.id)) deduped.set(u.id, { id: u.id, name: u.name ?? \"\" });\n      }\n      usersToCheck = Array.from(deduped.values());\n    }\n\n    if (userRole === \"global_admin\") {\n      const { data: allAthletes, error } = await supabase\n        .from(\"users\")\n        .select(\"id, name\")\n        .eq(\"role\", \"athlete\");\n\n      if (error) console.error(\"[useAlerts] admin athletes fetch error:\", error);\n\n      const deduped = new Map<string, { id: string; name: string }>();\n      for (const u of allAthletes || []) {\n        if (!u?.id) continue;\n        if (!deduped.has(u.id)) deduped.set(u.id, { id: u.id, name: u.name ?? \"\" });\n      }\n      usersToCheck = Array.from(deduped.values());\n    }\n\n    return usersToCheck;\n  }, [userId, userRole]);\n\n  // -----------------------------\n  //  Alert\n  // -----------------------------\n  const checkAndGenerateAlerts = useCallback(async () => {\n    if (!userId || !userRole) return;\n\n    try {\n      const usersToCheck = await loadUsersToCheck();\n      if (!usersToCheck.length) return;\n\n      //  rolestaff/admin  no_data \n      const effectiveRules = (alertRules ?? []).filter((rule) => {\n        if (userRole !== \"athlete\" && rule.type === \"no_data\") return false;\n        return true;\n      });\n\n      const fetchPromises = usersToCheck.map(async (u) => {\n        const { data: trainingRecords, error } = await supabase\n          .from(\"training_records\")\n          .select(\"*\")\n          .eq(\"user_id\", u.id)\n          .order(\"date\", { ascending: true });\n\n        if (error) throw { user: u, error };\n\n        return { user: u, trainingRecords: trainingRecords || [] };\n      });\n\n      const results = await Promise.allSettled(fetchPromises);\n\n      const newAlerts: Alert[] = [];\n\n      for (const r of results) {\n        if (r.status === \"rejected\") {\n          console.error(\"[useAlerts] training_records fetch failed:\", r.reason);\n          continue;\n        }\n\n        const { user, trainingRecords } = r.value;\n        const acwrData = calculateACWR(trainingRecords);\n\n        const userAlerts = generateAlerts(\n          user.id,\n          user.name,\n          acwrData,\n          trainingRecords,\n          effectiveRules\n        );\n\n        newAlerts.push(...userAlerts);\n      }\n\n      setAlerts((prev) => {\n        const existingAlertKeys = new Set(\n          prev.map((a) => `${a.user_id}-${a.type}-${a.created_at.split(\"T\")[0]}`)\n        );\n\n        const uniqueNewAlerts = newAlerts.filter(\n          (a) => !existingAlertKeys.has(`${a.user_id}-${a.type}-${a.created_at.split(\"T\")[0]}`)\n        );\n\n        if (uniqueNewAlerts.length > 0) {\n          if (ENABLE_REALTIME_ALERT_EMAILS) {\n            sendAlertEmailsForNewAlerts(uniqueNewAlerts).catch((error) => {\n              console.error(\"Error sending alert emails:\", error);\n            });\n          }\n\n          const combined = [...prev, ...uniqueNewAlerts];\n          return sortAlertsByPriority(filterActiveAlerts(combined));\n        }\n\n        return filterActiveAlerts(prev);\n      });\n    } catch (error) {\n      console.error(\"Error checking and generating alerts:\", error);\n    }\n  }, [userId, userRole, alertRules, loadUsersToCheck]);\n\n  // -----------------------------\n  // Alert\n  // -----------------------------\n  const loadAlertRules = useCallback(async () => {\n    const rules = DEFAULT_ALERT_RULES.map((rule, index) => ({\n      id: `default-${index}`,\n      ...rule,\n    }));\n    setAlertRules(rules);\n  }, []);\n\n  // \n  useEffect(() => {\n    let cancelled = false;\n\n    const init = async () => {\n      if (!userId || !userRole) {\n        setLoading(false);\n        return;\n      }\n      setLoading(true);\n      try {\n        await loadAlertRules();\n      } catch (e) {\n        console.error(\"Error loading alert rules:\", e);\n        // fallbackOK\n        await loadAlertRules();\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    };\n\n    init();\n    return () => {\n      cancelled = true;\n    };\n  }, [userId, userRole, loadAlertRules]);\n\n  // 1\n  useEffect(() => {\n    if (alertRules.length > 0 && userId && userRole) {\n      checkAndGenerateAlerts();\n    }\n  }, [alertRules.length, userId, userRole, checkAndGenerateAlerts]);\n\n  //  Hub30\n  useEffect(() => {\n    // job\n    if (unregisterPollRef.current) {\n      unregisterPollRef.current();\n      unregisterPollRef.current = null;\n    }\n\n    if (!userId || !userRole) return;\n    if (alertRules.length === 0) return;\n\n    const key = `alerts:${userId}:${userRole}:${instanceIdRef.current}`;\n\n    const unregister = registerPollJob({\n      key,\n      intervalMs: 30 * 60 * 1000,\n      run: async () => {\n        await checkAndGenerateAlerts();\n      },\n      enabled: true,\n      requireVisible: true, //  \n      requireOnline: true,\n      immediate: false, //  1\n    });\n\n    unregisterPollRef.current = unregister;\n\n    return () => {\n      if (unregisterPollRef.current) {\n        unregisterPollRef.current();\n        unregisterPollRef.current = null;\n      }\n    };\n  }, [userId, userRole, alertRules.length, registerPollJob, checkAndGenerateAlerts]);\n\n  // \n  useEffect(() => {\n    const unread = alerts.filter((a) => !a.is_read && !a.is_dismissed).length;\n    setUnreadCount(unread);\n  }, [alerts]);\n\n  const markAsRead = useCallback(async (alertId: string) => {\n    setAlerts((prev) => prev.map((a) => (a.id === alertId ? { ...a, is_read: true } : a)));\n  }, []);\n\n  const dismissAlert = useCallback(async (alertId: string) => {\n    setAlerts((prev) =>\n      prev.map((a) => (a.id === alertId ? { ...a, is_dismissed: true } : a))\n    );\n  }, []);\n\n  const markAllAsRead = useCallback(async () => {\n    setAlerts((prev) => prev.map((a) => ({ ...a, is_read: true })));\n  }, []);\n\n  const clearDismissedAlerts = useCallback(() => {\n    setAlerts((prev) => prev.filter((a) => !a.is_dismissed));\n  }, []);\n\n  const getActiveAlerts = useCallback(() => {\n    return filterActiveAlerts(alerts);\n  }, [alerts]);\n\n  const getUnreadAlerts = useCallback(() => {\n    return alerts.filter((a) => !a.is_read && !a.is_dismissed);\n  }, [alerts]);\n\n  const getAlertsByPriority = useCallback(\n    (priority: Alert[\"priority\"]) => getActiveAlerts().filter((a) => a.priority === priority),\n    [getActiveAlerts]\n  );\n\n  const getAlertsByUser = useCallback(\n    (targetUserId: string) => getActiveAlerts().filter((a) => a.user_id === targetUserId),\n    [getActiveAlerts]\n  );\n\n  return {\n    alerts: getActiveAlerts(),\n    alertRules,\n    loading,\n    unreadCount,\n    markAsRead,\n    dismissAlert,\n    markAllAsRead,\n    clearDismissedAlerts,\n    getUnreadAlerts,\n    getAlertsByPriority,\n    getAlertsByUser,\n    refreshAlerts: checkAndGenerateAlerts,\n  };\n}","import React, { createContext, useContext, useState, useCallback } from 'react';\nimport { useTutorial, TutorialProgress } from '../hooks/useTutorial';\nimport type { AppRole } from '../lib/roles';\n\ninterface TutorialContextValue {\n  progress: TutorialProgress | null;\n  loading: boolean;\n  error: string | null;\n  isActive: boolean;\n  currentStepIndex: number;\n  startTutorial: () => void;\n  stopTutorial: () => void;\n  completeStep: (stepId: string) => Promise<void>;\n  setCurrentStep: (stepId: string | null) => Promise<void>;\n  completeTutorial: () => Promise<void>;\n  skipTutorial: () => Promise<void>;\n  resetTutorial: () => Promise<void>;\n  shouldShowTutorial: () => boolean;\n  setCurrentStepIndex: (index: number) => void;\n}\n\nconst TutorialContext = createContext<TutorialContextValue | undefined>(undefined);\n\ninterface TutorialProviderProps {\n  userId: string;\n  role: AppRole;\n  children: React.ReactNode;\n}\n\nexport function TutorialProvider({ userId, role, children }: TutorialProviderProps) {\n  const tutorial = useTutorial(userId, role);\n  const [isActive, setIsActive] = useState(false);\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n\n  const startTutorial = useCallback(() => {\n    setIsActive(true);\n    setCurrentStepIndex(0);\n  }, []);\n\n  const stopTutorial = useCallback(() => {\n    setIsActive(false);\n  }, []);\n\n  const handleCompleteTutorial = useCallback(async () => {\n    await tutorial.completeTutorial();\n    setIsActive(false);\n  }, [tutorial]);\n\n  const handleSkipTutorial = useCallback(async () => {\n    await tutorial.skipTutorial();\n    setIsActive(false);\n  }, [tutorial]);\n\n  const value: TutorialContextValue = {\n    ...tutorial,\n    isActive,\n    currentStepIndex,\n    startTutorial,\n    stopTutorial,\n    completeTutorial: handleCompleteTutorial,\n    skipTutorial: handleSkipTutorial,\n    setCurrentStepIndex,\n  };\n\n  return (\n    <TutorialContext.Provider value={value}>\n      {children}\n    </TutorialContext.Provider>\n  );\n}\n\nexport function useTutorialContext() {\n  const context = useContext(TutorialContext);\n  if (context === undefined) {\n    throw new Error('useTutorialContext must be used within a TutorialProvider');\n  }\n  return context;\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '../lib/supabase';\nimport type { AppRole } from '../lib/roles';\n\nexport interface TutorialProgress {\n  id?: string;\n  user_id: string;\n  role: AppRole;\n  completed_steps: string[];\n  current_step: string | null;\n  is_completed: boolean;\n  skipped: boolean;\n  last_updated?: string;\n  created_at?: string;\n}\n\nexport function useTutorial(userId: string, role: AppRole) {\n  const [progress, setProgress] = useState<TutorialProgress | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadProgress = useCallback(async () => {\n    if (!userId || !role) {\n      setLoading(false);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError(null);\n\n      const { data, error: fetchError } = await supabase\n        .from('tutorial_progress')\n        .select('*')\n        .eq('user_id', userId)\n        .eq('role', role)\n        .order('created_at', { ascending: false })\n        .limit(1)\n        .maybeSingle();\n\n      if (fetchError) throw fetchError;\n\n      if (data) {\n        setProgress(data as TutorialProgress);\n      } else {\n        setProgress({\n          user_id: userId,\n          role,\n          completed_steps: [],\n          current_step: null,\n          is_completed: false,\n          skipped: false,\n        });\n      }\n    } catch (err: any) {\n      console.error('Error loading tutorial progress:', err);\n      setError(err.message ?? String(err));\n    } finally {\n      setLoading(false);\n    }\n  }, [userId, role]);\n\n  useEffect(() => {\n    loadProgress();\n  }, [loadProgress]);\n\n  const saveProgress = useCallback(\n    async (updatedProgress: Partial<TutorialProgress>) => {\n      if (!userId || !role) return null;\n\n      try {\n        setError(null);\n\n        const progressToSave: TutorialProgress = {\n          ...(progress ?? {\n            user_id: userId,\n            role,\n            completed_steps: [],\n            current_step: null,\n            is_completed: false,\n            skipped: false,\n          }),\n          ...updatedProgress,\n          user_id: userId,\n          role,\n        };\n\n        const { data, error: upsertError } = await supabase\n          .from('tutorial_progress')\n          .upsert(progressToSave, { onConflict: 'user_id,role' })\n          .select()\n          .single();\n\n        if (upsertError) throw upsertError;\n\n        setProgress(data as TutorialProgress);\n        return data as TutorialProgress;\n      } catch (err: any) {\n        console.error('Error saving tutorial progress:', err);\n        setError(err.message ?? String(err));\n        //  throw UI\n        //   \n        const fallback: TutorialProgress = {\n          ...(progress ?? {\n            user_id: userId,\n            role,\n            completed_steps: [],\n            current_step: null,\n            is_completed: false,\n            skipped: false,\n          }),\n          ...updatedProgress,\n          user_id: userId,\n          role,\n        };\n        setProgress(fallback);\n        return fallback;\n      }\n    },\n    [userId, role, progress],\n  );\n\n  const completeStep = useCallback(\n    async (stepId: string) => {\n      if (!progress) return null;\n\n      const completedSteps = [...progress.completed_steps];\n      if (!completedSteps.includes(stepId)) completedSteps.push(stepId);\n\n      return await saveProgress({\n        completed_steps: completedSteps,\n        current_step: stepId,\n      });\n    },\n    [progress, saveProgress],\n  );\n\n  const setCurrentStep = useCallback(\n    async (stepId: string | null) => {\n      return await saveProgress({ current_step: stepId });\n    },\n    [saveProgress],\n  );\n\n  const completeTutorial = useCallback(async () => {\n    return await saveProgress({\n      is_completed: true,\n      current_step: null,\n    });\n  }, [saveProgress]);\n\n  const skipTutorial = useCallback(async () => {\n    return await saveProgress({\n      skipped: true,\n      current_step: null,\n    });\n  }, [saveProgress]);\n\n  const resetTutorial = useCallback(async () => {\n    return await saveProgress({\n      completed_steps: [],\n      current_step: null,\n      is_completed: false,\n      skipped: false,\n    });\n  }, [saveProgress]);\n\n  const shouldShowTutorial = useCallback(() => {\n    if (!progress) return false;\n    return !progress.is_completed && !progress.skipped;\n  }, [progress]);\n\n  return {\n    progress,\n    loading,\n    error,\n    completeStep,\n    setCurrentStep,\n    completeTutorial,\n    skipTutorial,\n    resetTutorial,\n    shouldShowTutorial,\n    refreshProgress: loadProgress,\n  };\n}","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeWidth: 2,\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.js';\n\nconst toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, \"$1-$2\").toLowerCase().trim();\nconst createLucideIcon = (iconName, iconNode) => {\n  const Component = forwardRef(\n    ({\n      color = \"currentColor\",\n      size = 24,\n      strokeWidth = 2,\n      absoluteStrokeWidth,\n      className = \"\",\n      children,\n      ...rest\n    }, ref) => {\n      return createElement(\n        \"svg\",\n        {\n          ref,\n          ...defaultAttributes,\n          width: size,\n          height: size,\n          stroke: color,\n          strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,\n          className: [\"lucide\", `lucide-${toKebabCase(iconName)}`, className].join(\" \"),\n          ...rest\n        },\n        [\n          ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n          ...Array.isArray(children) ? children : [children]\n        ]\n      );\n    }\n  );\n  Component.displayName = `${iconName}`;\n  return Component;\n};\n\nexport { createLucideIcon as default, toKebabCase };\n//# sourceMappingURL=createLucideIcon.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Activity = createLucideIcon(\"Activity\", [\n  [\"path\", { d: \"M22 12h-4l-3 9L9 3l-3 9H2\", key: \"d5dnw9\" }]\n]);\n\nexport { Activity as default };\n//# sourceMappingURL=activity.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst AlertCircle = createLucideIcon(\"AlertCircle\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"12\", key: \"1pkeuh\" }],\n  [\"line\", { x1: \"12\", x2: \"12.01\", y1: \"16\", y2: \"16\", key: \"4dfq90\" }]\n]);\n\nexport { AlertCircle as default };\n//# sourceMappingURL=alert-circle.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst AlertTriangle = createLucideIcon(\"AlertTriangle\", [\n  [\n    \"path\",\n    {\n      d: \"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\",\n      key: \"c3ski4\"\n    }\n  ],\n  [\"path\", { d: \"M12 9v4\", key: \"juzpu7\" }],\n  [\"path\", { d: \"M12 17h.01\", key: \"p32p05\" }]\n]);\n\nexport { AlertTriangle as default };\n//# sourceMappingURL=alert-triangle.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ArrowLeft = createLucideIcon(\"ArrowLeft\", [\n  [\"path\", { d: \"m12 19-7-7 7-7\", key: \"1l729n\" }],\n  [\"path\", { d: \"M19 12H5\", key: \"x3x0zl\" }]\n]);\n\nexport { ArrowLeft as default };\n//# sourceMappingURL=arrow-left.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ArrowRight = createLucideIcon(\"ArrowRight\", [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"m12 5 7 7-7 7\", key: \"xquz4c\" }]\n]);\n\nexport { ArrowRight as default };\n//# sourceMappingURL=arrow-right.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Award = createLucideIcon(\"Award\", [\n  [\"circle\", { cx: \"12\", cy: \"8\", r: \"6\", key: \"1vp47v\" }],\n  [\"path\", { d: \"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11\", key: \"em7aur\" }]\n]);\n\nexport { Award as default };\n//# sourceMappingURL=award.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst BarChart2 = createLucideIcon(\"BarChart2\", [\n  [\"line\", { x1: \"18\", x2: \"18\", y1: \"20\", y2: \"10\", key: \"1xfpm4\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"20\", y2: \"4\", key: \"be30l9\" }],\n  [\"line\", { x1: \"6\", x2: \"6\", y1: \"20\", y2: \"14\", key: \"1r4le6\" }]\n]);\n\nexport { BarChart2 as default };\n//# sourceMappingURL=bar-chart-2.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst BarChart3 = createLucideIcon(\"BarChart3\", [\n  [\"path\", { d: \"M3 3v18h18\", key: \"1s2lah\" }],\n  [\"path\", { d: \"M18 17V9\", key: \"2bz60n\" }],\n  [\"path\", { d: \"M13 17V5\", key: \"1frdt8\" }],\n  [\"path\", { d: \"M8 17v-3\", key: \"17ska0\" }]\n]);\n\nexport { BarChart3 as default };\n//# sourceMappingURL=bar-chart-3.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Battery = createLucideIcon(\"Battery\", [\n  [\"rect\", { width: \"16\", height: \"10\", x: \"2\", y: \"7\", rx: \"2\", ry: \"2\", key: \"1w10f2\" }],\n  [\"line\", { x1: \"22\", x2: \"22\", y1: \"11\", y2: \"13\", key: \"4dh1rd\" }]\n]);\n\nexport { Battery as default };\n//# sourceMappingURL=battery.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Bell = createLucideIcon(\"Bell\", [\n  [\"path\", { d: \"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9\", key: \"1qo2s2\" }],\n  [\"path\", { d: \"M10.3 21a1.94 1.94 0 0 0 3.4 0\", key: \"qgo35s\" }]\n]);\n\nexport { Bell as default };\n//# sourceMappingURL=bell.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Brain = createLucideIcon(\"Brain\", [\n  [\n    \"path\",\n    {\n      d: \"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z\",\n      key: \"l5xja\"\n    }\n  ],\n  [\n    \"path\",\n    {\n      d: \"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z\",\n      key: \"ep3f8r\"\n    }\n  ],\n  [\"path\", { d: \"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4\", key: \"1p4c4q\" }],\n  [\"path\", { d: \"M17.599 6.5a3 3 0 0 0 .399-1.375\", key: \"tmeiqw\" }],\n  [\"path\", { d: \"M6.003 5.125A3 3 0 0 0 6.401 6.5\", key: \"105sqy\" }],\n  [\"path\", { d: \"M3.477 10.896a4 4 0 0 1 .585-.396\", key: \"ql3yin\" }],\n  [\"path\", { d: \"M19.938 10.5a4 4 0 0 1 .585.396\", key: \"1qfode\" }],\n  [\"path\", { d: \"M6 18a4 4 0 0 1-1.967-.516\", key: \"2e4loj\" }],\n  [\"path\", { d: \"M19.967 17.484A4 4 0 0 1 18 18\", key: \"159ez6\" }]\n]);\n\nexport { Brain as default };\n//# sourceMappingURL=brain.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Building2 = createLucideIcon(\"Building2\", [\n  [\"path\", { d: \"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z\", key: \"1b4qmf\" }],\n  [\"path\", { d: \"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2\", key: \"i71pzd\" }],\n  [\"path\", { d: \"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2\", key: \"10jefs\" }],\n  [\"path\", { d: \"M10 6h4\", key: \"1itunk\" }],\n  [\"path\", { d: \"M10 10h4\", key: \"tcdvrf\" }],\n  [\"path\", { d: \"M10 14h4\", key: \"kelpxr\" }],\n  [\"path\", { d: \"M10 18h4\", key: \"1ulq68\" }]\n]);\n\nexport { Building2 as default };\n//# sourceMappingURL=building-2.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Calendar = createLucideIcon(\"Calendar\", [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }]\n]);\n\nexport { Calendar as default };\n//# sourceMappingURL=calendar.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Camera = createLucideIcon(\"Camera\", [\n  [\n    \"path\",\n    {\n      d: \"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z\",\n      key: \"1tc9qg\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"13\", r: \"3\", key: \"1vg3eu\" }]\n]);\n\nexport { Camera as default };\n//# sourceMappingURL=camera.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CheckCircle2 = createLucideIcon(\"CheckCircle2\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"m9 12 2 2 4-4\", key: \"dzmm74\" }]\n]);\n\nexport { CheckCircle2 as default };\n//# sourceMappingURL=check-circle-2.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CheckCircle = createLucideIcon(\"CheckCircle\", [\n  [\"path\", { d: \"M22 11.08V12a10 10 0 1 1-5.93-9.14\", key: \"g774vq\" }],\n  [\"path\", { d: \"m9 11 3 3L22 4\", key: \"1pflzl\" }]\n]);\n\nexport { CheckCircle as default };\n//# sourceMappingURL=check-circle.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Check = createLucideIcon(\"Check\", [[\"path\", { d: \"M20 6 9 17l-5-5\", key: \"1gmf2c\" }]]);\n\nexport { Check as default };\n//# sourceMappingURL=check.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronDown = createLucideIcon(\"ChevronDown\", [\n  [\"path\", { d: \"m6 9 6 6 6-6\", key: \"qrunsl\" }]\n]);\n\nexport { ChevronDown as default };\n//# sourceMappingURL=chevron-down.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronLeft = createLucideIcon(\"ChevronLeft\", [\n  [\"path\", { d: \"m15 18-6-6 6-6\", key: \"1wnfg3\" }]\n]);\n\nexport { ChevronLeft as default };\n//# sourceMappingURL=chevron-left.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronRight = createLucideIcon(\"ChevronRight\", [\n  [\"path\", { d: \"m9 18 6-6-6-6\", key: \"mthhwq\" }]\n]);\n\nexport { ChevronRight as default };\n//# sourceMappingURL=chevron-right.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronUp = createLucideIcon(\"ChevronUp\", [[\"path\", { d: \"m18 15-6-6-6 6\", key: \"153udz\" }]]);\n\nexport { ChevronUp as default };\n//# sourceMappingURL=chevron-up.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronsLeft = createLucideIcon(\"ChevronsLeft\", [\n  [\"path\", { d: \"m11 17-5-5 5-5\", key: \"13zhaf\" }],\n  [\"path\", { d: \"m18 17-5-5 5-5\", key: \"h8a8et\" }]\n]);\n\nexport { ChevronsLeft as default };\n//# sourceMappingURL=chevrons-left.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronsRight = createLucideIcon(\"ChevronsRight\", [\n  [\"path\", { d: \"m6 17 5-5-5-5\", key: \"xnjwq\" }],\n  [\"path\", { d: \"m13 17 5-5-5-5\", key: \"17xmmf\" }]\n]);\n\nexport { ChevronsRight as default };\n//# sourceMappingURL=chevrons-right.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Circle = createLucideIcon(\"Circle\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n]);\n\nexport { Circle as default };\n//# sourceMappingURL=circle.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Clock = createLucideIcon(\"Clock\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"polyline\", { points: \"12 6 12 12 16 14\", key: \"68esgv\" }]\n]);\n\nexport { Clock as default };\n//# sourceMappingURL=clock.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Cloud = createLucideIcon(\"Cloud\", [\n  [\"path\", { d: \"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z\", key: \"p7xjir\" }]\n]);\n\nexport { Cloud as default };\n//# sourceMappingURL=cloud.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Copy = createLucideIcon(\"Copy\", [\n  [\"rect\", { width: \"14\", height: \"14\", x: \"8\", y: \"8\", rx: \"2\", ry: \"2\", key: \"17jyea\" }],\n  [\"path\", { d: \"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\", key: \"zix9uf\" }]\n]);\n\nexport { Copy as default };\n//# sourceMappingURL=copy.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CreditCard = createLucideIcon(\"CreditCard\", [\n  [\"rect\", { width: \"20\", height: \"14\", x: \"2\", y: \"5\", rx: \"2\", key: \"ynyp8z\" }],\n  [\"line\", { x1: \"2\", x2: \"22\", y1: \"10\", y2: \"10\", key: \"1b3vmo\" }]\n]);\n\nexport { CreditCard as default };\n//# sourceMappingURL=credit-card.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Download = createLucideIcon(\"Download\", [\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }],\n  [\"polyline\", { points: \"7 10 12 15 17 10\", key: \"2ggqvy\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"15\", y2: \"3\", key: \"1vk2je\" }]\n]);\n\nexport { Download as default };\n//# sourceMappingURL=download.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Droplets = createLucideIcon(\"Droplets\", [\n  [\n    \"path\",\n    {\n      d: \"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z\",\n      key: \"1ptgy4\"\n    }\n  ],\n  [\n    \"path\",\n    {\n      d: \"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97\",\n      key: \"1sl1rz\"\n    }\n  ]\n]);\n\nexport { Droplets as default };\n//# sourceMappingURL=droplets.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Dumbbell = createLucideIcon(\"Dumbbell\", [\n  [\"path\", { d: \"m6.5 6.5 11 11\", key: \"f7oqzb\" }],\n  [\"path\", { d: \"m21 21-1-1\", key: \"cpc6if\" }],\n  [\"path\", { d: \"m3 3 1 1\", key: \"d3rpuf\" }],\n  [\"path\", { d: \"m18 22 4-4\", key: \"1e32o6\" }],\n  [\"path\", { d: \"m2 6 4-4\", key: \"189tqz\" }],\n  [\"path\", { d: \"m3 10 7-7\", key: \"1bxui2\" }],\n  [\"path\", { d: \"m14 21 7-7\", key: \"16x78n\" }]\n]);\n\nexport { Dumbbell as default };\n//# sourceMappingURL=dumbbell.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ExternalLink = createLucideIcon(\"ExternalLink\", [\n  [\"path\", { d: \"M15 3h6v6\", key: \"1q9fwt\" }],\n  [\"path\", { d: \"M10 14 21 3\", key: \"gplh6r\" }],\n  [\"path\", { d: \"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\", key: \"a6xqqp\" }]\n]);\n\nexport { ExternalLink as default };\n//# sourceMappingURL=external-link.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst EyeOff = createLucideIcon(\"EyeOff\", [\n  [\"path\", { d: \"M9.88 9.88a3 3 0 1 0 4.24 4.24\", key: \"1jxqfv\" }],\n  [\n    \"path\",\n    {\n      d: \"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68\",\n      key: \"9wicm4\"\n    }\n  ],\n  [\n    \"path\",\n    { d: \"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61\", key: \"1jreej\" }\n  ],\n  [\"line\", { x1: \"2\", x2: \"22\", y1: \"2\", y2: \"22\", key: \"a6p6uj\" }]\n]);\n\nexport { EyeOff as default };\n//# sourceMappingURL=eye-off.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Eye = createLucideIcon(\"Eye\", [\n  [\"path\", { d: \"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z\", key: \"rwhkz3\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n]);\n\nexport { Eye as default };\n//# sourceMappingURL=eye.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst FileSpreadsheet = createLucideIcon(\"FileSpreadsheet\", [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"M8 13h2\", key: \"yr2amv\" }],\n  [\"path\", { d: \"M14 13h2\", key: \"un5t4a\" }],\n  [\"path\", { d: \"M8 17h2\", key: \"2yhykz\" }],\n  [\"path\", { d: \"M14 17h2\", key: \"10kma7\" }]\n]);\n\nexport { FileSpreadsheet as default };\n//# sourceMappingURL=file-spreadsheet.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst FileText = createLucideIcon(\"FileText\", [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"M10 9H8\", key: \"b1mrlr\" }],\n  [\"path\", { d: \"M16 13H8\", key: \"t4e002\" }],\n  [\"path\", { d: \"M16 17H8\", key: \"z1uh3a\" }]\n]);\n\nexport { FileText as default };\n//# sourceMappingURL=file-text.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Filter = createLucideIcon(\"Filter\", [\n  [\"polygon\", { points: \"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3\", key: \"1yg77f\" }]\n]);\n\nexport { Filter as default };\n//# sourceMappingURL=filter.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Flame = createLucideIcon(\"Flame\", [\n  [\n    \"path\",\n    {\n      d: \"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z\",\n      key: \"96xj49\"\n    }\n  ]\n]);\n\nexport { Flame as default };\n//# sourceMappingURL=flame.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Globe = createLucideIcon(\"Globe\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20\", key: \"13o1zl\" }],\n  [\"path\", { d: \"M2 12h20\", key: \"9i4pu4\" }]\n]);\n\nexport { Globe as default };\n//# sourceMappingURL=globe.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Hand = createLucideIcon(\"Hand\", [\n  [\"path\", { d: \"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0\", key: \"aigmz7\" }],\n  [\"path\", { d: \"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2\", key: \"1n6bmn\" }],\n  [\"path\", { d: \"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8\", key: \"a9iiix\" }],\n  [\n    \"path\",\n    {\n      d: \"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15\",\n      key: \"1s1gnw\"\n    }\n  ]\n]);\n\nexport { Hand as default };\n//# sourceMappingURL=hand.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Heart = createLucideIcon(\"Heart\", [\n  [\n    \"path\",\n    {\n      d: \"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z\",\n      key: \"c3ymky\"\n    }\n  ]\n]);\n\nexport { Heart as default };\n//# sourceMappingURL=heart.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst HelpCircle = createLucideIcon(\"HelpCircle\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\", key: \"1u773s\" }],\n  [\"path\", { d: \"M12 17h.01\", key: \"p32p05\" }]\n]);\n\nexport { HelpCircle as default };\n//# sourceMappingURL=help-circle.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst History = createLucideIcon(\"History\", [\n  [\"path\", { d: \"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\", key: \"1357e3\" }],\n  [\"path\", { d: \"M3 3v5h5\", key: \"1xhq8a\" }],\n  [\"path\", { d: \"M12 7v5l4 2\", key: \"1fdv2h\" }]\n]);\n\nexport { History as default };\n//# sourceMappingURL=history.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Info = createLucideIcon(\"Info\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M12 16v-4\", key: \"1dtifu\" }],\n  [\"path\", { d: \"M12 8h.01\", key: \"e9boi3\" }]\n]);\n\nexport { Info as default };\n//# sourceMappingURL=info.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst LayoutDashboard = createLucideIcon(\"LayoutDashboard\", [\n  [\"rect\", { width: \"7\", height: \"9\", x: \"3\", y: \"3\", rx: \"1\", key: \"10lvy0\" }],\n  [\"rect\", { width: \"7\", height: \"5\", x: \"14\", y: \"3\", rx: \"1\", key: \"16une8\" }],\n  [\"rect\", { width: \"7\", height: \"9\", x: \"14\", y: \"12\", rx: \"1\", key: \"1hutg5\" }],\n  [\"rect\", { width: \"7\", height: \"5\", x: \"3\", y: \"16\", rx: \"1\", key: \"ldoo1y\" }]\n]);\n\nexport { LayoutDashboard as default };\n//# sourceMappingURL=layout-dashboard.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Lightbulb = createLucideIcon(\"Lightbulb\", [\n  [\n    \"path\",\n    {\n      d: \"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5\",\n      key: \"1gvzjb\"\n    }\n  ],\n  [\"path\", { d: \"M9 18h6\", key: \"x1upvd\" }],\n  [\"path\", { d: \"M10 22h4\", key: \"ceow96\" }]\n]);\n\nexport { Lightbulb as default };\n//# sourceMappingURL=lightbulb.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Link = createLucideIcon(\"Link\", [\n  [\"path\", { d: \"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\", key: \"1cjeqo\" }],\n  [\"path\", { d: \"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\", key: \"19qd67\" }]\n]);\n\nexport { Link as default };\n//# sourceMappingURL=link.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Loader2 = createLucideIcon(\"Loader2\", [\n  [\"path\", { d: \"M21 12a9 9 0 1 1-6.219-8.56\", key: \"13zald\" }]\n]);\n\nexport { Loader2 as default };\n//# sourceMappingURL=loader-2.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Lock = createLucideIcon(\"Lock\", [\n  [\"rect\", { width: \"18\", height: \"11\", x: \"3\", y: \"11\", rx: \"2\", ry: \"2\", key: \"1w4ew1\" }],\n  [\"path\", { d: \"M7 11V7a5 5 0 0 1 10 0v4\", key: \"fwvmzm\" }]\n]);\n\nexport { Lock as default };\n//# sourceMappingURL=lock.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst LogIn = createLucideIcon(\"LogIn\", [\n  [\"path\", { d: \"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4\", key: \"u53s6r\" }],\n  [\"polyline\", { points: \"10 17 15 12 10 7\", key: \"1ail0h\" }],\n  [\"line\", { x1: \"15\", x2: \"3\", y1: \"12\", y2: \"12\", key: \"v6grx8\" }]\n]);\n\nexport { LogIn as default };\n//# sourceMappingURL=log-in.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst LogOut = createLucideIcon(\"LogOut\", [\n  [\"path\", { d: \"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\", key: \"1uf3rs\" }],\n  [\"polyline\", { points: \"16 17 21 12 16 7\", key: \"1gabdz\" }],\n  [\"line\", { x1: \"21\", x2: \"9\", y1: \"12\", y2: \"12\", key: \"1uyos4\" }]\n]);\n\nexport { LogOut as default };\n//# sourceMappingURL=log-out.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Mail = createLucideIcon(\"Mail\", [\n  [\"rect\", { width: \"20\", height: \"16\", x: \"2\", y: \"4\", rx: \"2\", key: \"18n3k1\" }],\n  [\"path\", { d: \"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7\", key: \"1ocrg3\" }]\n]);\n\nexport { Mail as default };\n//# sourceMappingURL=mail.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Menu = createLucideIcon(\"Menu\", [\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"12\", y2: \"12\", key: \"1e0a9i\" }],\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"6\", y2: \"6\", key: \"1owob3\" }],\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"18\", y2: \"18\", key: \"yk5zj1\" }]\n]);\n\nexport { Menu as default };\n//# sourceMappingURL=menu.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst MessageSquare = createLucideIcon(\"MessageSquare\", [\n  [\"path\", { d: \"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\", key: \"1lielz\" }]\n]);\n\nexport { MessageSquare as default };\n//# sourceMappingURL=message-square.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Moon = createLucideIcon(\"Moon\", [\n  [\"path\", { d: \"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z\", key: \"a7tn18\" }]\n]);\n\nexport { Moon as default };\n//# sourceMappingURL=moon.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Palette = createLucideIcon(\"Palette\", [\n  [\"circle\", { cx: \"13.5\", cy: \"6.5\", r: \".5\", fill: \"currentColor\", key: \"1okk4w\" }],\n  [\"circle\", { cx: \"17.5\", cy: \"10.5\", r: \".5\", fill: \"currentColor\", key: \"f64h9f\" }],\n  [\"circle\", { cx: \"8.5\", cy: \"7.5\", r: \".5\", fill: \"currentColor\", key: \"fotxhn\" }],\n  [\"circle\", { cx: \"6.5\", cy: \"12.5\", r: \".5\", fill: \"currentColor\", key: \"qy21gx\" }],\n  [\n    \"path\",\n    {\n      d: \"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z\",\n      key: \"12rzf8\"\n    }\n  ]\n]);\n\nexport { Palette as default };\n//# sourceMappingURL=palette.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst PanelsTopLeft = createLucideIcon(\"PanelsTopLeft\", [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", key: \"afitv7\" }],\n  [\"path\", { d: \"M3 9h18\", key: \"1pudct\" }],\n  [\"path\", { d: \"M9 21V9\", key: \"1oto5p\" }]\n]);\n\nexport { PanelsTopLeft as default };\n//# sourceMappingURL=panels-top-left.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Pen = createLucideIcon(\"Pen\", [\n  [\"path\", { d: \"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\", key: \"5qss01\" }]\n]);\n\nexport { Pen as default };\n//# sourceMappingURL=pen.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Pencil = createLucideIcon(\"Pencil\", [\n  [\"path\", { d: \"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\", key: \"5qss01\" }],\n  [\"path\", { d: \"m15 5 4 4\", key: \"1mk7zo\" }]\n]);\n\nexport { Pencil as default };\n//# sourceMappingURL=pencil.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Percent = createLucideIcon(\"Percent\", [\n  [\"line\", { x1: \"19\", x2: \"5\", y1: \"5\", y2: \"19\", key: \"1x9vlm\" }],\n  [\"circle\", { cx: \"6.5\", cy: \"6.5\", r: \"2.5\", key: \"4mh3h7\" }],\n  [\"circle\", { cx: \"17.5\", cy: \"17.5\", r: \"2.5\", key: \"1mdrzq\" }]\n]);\n\nexport { Percent as default };\n//# sourceMappingURL=percent.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Phone = createLucideIcon(\"Phone\", [\n  [\n    \"path\",\n    {\n      d: \"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\",\n      key: \"foiqr5\"\n    }\n  ]\n]);\n\nexport { Phone as default };\n//# sourceMappingURL=phone.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Plus = createLucideIcon(\"Plus\", [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }]\n]);\n\nexport { Plus as default };\n//# sourceMappingURL=plus.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst RefreshCcw = createLucideIcon(\"RefreshCcw\", [\n  [\"path\", { d: \"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\", key: \"14sxne\" }],\n  [\"path\", { d: \"M3 3v5h5\", key: \"1xhq8a\" }],\n  [\"path\", { d: \"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16\", key: \"1hlbsb\" }],\n  [\"path\", { d: \"M16 16h5v5\", key: \"ccwih5\" }]\n]);\n\nexport { RefreshCcw as default };\n//# sourceMappingURL=refresh-ccw.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst RefreshCw = createLucideIcon(\"RefreshCw\", [\n  [\"path\", { d: \"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\", key: \"v9h5vc\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }],\n  [\"path\", { d: \"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\", key: \"3uifl3\" }],\n  [\"path\", { d: \"M8 16H3v5\", key: \"1cv678\" }]\n]);\n\nexport { RefreshCw as default };\n//# sourceMappingURL=refresh-cw.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst RotateCcw = createLucideIcon(\"RotateCcw\", [\n  [\"path\", { d: \"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\", key: \"1357e3\" }],\n  [\"path\", { d: \"M3 3v5h5\", key: \"1xhq8a\" }]\n]);\n\nexport { RotateCcw as default };\n//# sourceMappingURL=rotate-ccw.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Ruler = createLucideIcon(\"Ruler\", [\n  [\n    \"path\",\n    {\n      d: \"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z\",\n      key: \"icamh8\"\n    }\n  ],\n  [\"path\", { d: \"m14.5 12.5 2-2\", key: \"inckbg\" }],\n  [\"path\", { d: \"m11.5 9.5 2-2\", key: \"fmmyf7\" }],\n  [\"path\", { d: \"m8.5 6.5 2-2\", key: \"vc6u1g\" }],\n  [\"path\", { d: \"m17.5 15.5 2-2\", key: \"wo5hmg\" }]\n]);\n\nexport { Ruler as default };\n//# sourceMappingURL=ruler.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Save = createLucideIcon(\"Save\", [\n  [\"path\", { d: \"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z\", key: \"1owoqh\" }],\n  [\"polyline\", { points: \"17 21 17 13 7 13 7 21\", key: \"1md35c\" }],\n  [\"polyline\", { points: \"7 3 7 8 15 8\", key: \"8nz8an\" }]\n]);\n\nexport { Save as default };\n//# sourceMappingURL=save.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Scale = createLucideIcon(\"Scale\", [\n  [\"path\", { d: \"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z\", key: \"7g6ntu\" }],\n  [\"path\", { d: \"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z\", key: \"ijws7r\" }],\n  [\"path\", { d: \"M7 21h10\", key: \"1b0cd5\" }],\n  [\"path\", { d: \"M12 3v18\", key: \"108xh3\" }],\n  [\"path\", { d: \"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2\", key: \"3gwbw2\" }]\n]);\n\nexport { Scale as default };\n//# sourceMappingURL=scale.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Search = createLucideIcon(\"Search\", [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"path\", { d: \"m21 21-4.3-4.3\", key: \"1qie3q\" }]\n]);\n\nexport { Search as default };\n//# sourceMappingURL=search.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Send = createLucideIcon(\"Send\", [\n  [\"path\", { d: \"m22 2-7 20-4-9-9-4Z\", key: \"1q3vgg\" }],\n  [\"path\", { d: \"M22 2 11 13\", key: \"nzbqef\" }]\n]);\n\nexport { Send as default };\n//# sourceMappingURL=send.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Settings = createLucideIcon(\"Settings\", [\n  [\n    \"path\",\n    {\n      d: \"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\",\n      key: \"1qme2f\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n]);\n\nexport { Settings as default };\n//# sourceMappingURL=settings.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ShieldAlert = createLucideIcon(\"ShieldAlert\", [\n  [\n    \"path\",\n    {\n      d: \"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\",\n      key: \"oel41y\"\n    }\n  ],\n  [\"path\", { d: \"M12 8v4\", key: \"1got3b\" }],\n  [\"path\", { d: \"M12 16h.01\", key: \"1drbdi\" }]\n]);\n\nexport { ShieldAlert as default };\n//# sourceMappingURL=shield-alert.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ShieldCheck = createLucideIcon(\"ShieldCheck\", [\n  [\n    \"path\",\n    {\n      d: \"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\",\n      key: \"oel41y\"\n    }\n  ],\n  [\"path\", { d: \"m9 12 2 2 4-4\", key: \"dzmm74\" }]\n]);\n\nexport { ShieldCheck as default };\n//# sourceMappingURL=shield-check.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Shield = createLucideIcon(\"Shield\", [\n  [\n    \"path\",\n    {\n      d: \"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\",\n      key: \"oel41y\"\n    }\n  ]\n]);\n\nexport { Shield as default };\n//# sourceMappingURL=shield.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Sliders = createLucideIcon(\"Sliders\", [\n  [\"line\", { x1: \"4\", x2: \"4\", y1: \"21\", y2: \"14\", key: \"1p332r\" }],\n  [\"line\", { x1: \"4\", x2: \"4\", y1: \"10\", y2: \"3\", key: \"gb41h5\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"21\", y2: \"12\", key: \"hf2csr\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"3\", key: \"1kfi7u\" }],\n  [\"line\", { x1: \"20\", x2: \"20\", y1: \"21\", y2: \"16\", key: \"1lhrwl\" }],\n  [\"line\", { x1: \"20\", x2: \"20\", y1: \"12\", y2: \"3\", key: \"16vvfq\" }],\n  [\"line\", { x1: \"2\", x2: \"6\", y1: \"14\", y2: \"14\", key: \"1uebub\" }],\n  [\"line\", { x1: \"10\", x2: \"14\", y1: \"8\", y2: \"8\", key: \"1yglbp\" }],\n  [\"line\", { x1: \"18\", x2: \"22\", y1: \"16\", y2: \"16\", key: \"1jxqpz\" }]\n]);\n\nexport { Sliders as default };\n//# sourceMappingURL=sliders.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Sparkles = createLucideIcon(\"Sparkles\", [\n  [\n    \"path\",\n    {\n      d: \"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z\",\n      key: \"17u4zn\"\n    }\n  ],\n  [\"path\", { d: \"M5 3v4\", key: \"bklmnn\" }],\n  [\"path\", { d: \"M19 17v4\", key: \"iiml17\" }],\n  [\"path\", { d: \"M3 5h4\", key: \"nem4j1\" }],\n  [\"path\", { d: \"M17 19h4\", key: \"lbex7p\" }]\n]);\n\nexport { Sparkles as default };\n//# sourceMappingURL=sparkles.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst SquarePen = createLucideIcon(\"SquarePen\", [\n  [\"path\", { d: \"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\", key: \"1m0v6g\" }],\n  [\"path\", { d: \"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z\", key: \"1lpok0\" }]\n]);\n\nexport { SquarePen as default };\n//# sourceMappingURL=square-pen.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Star = createLucideIcon(\"Star\", [\n  [\n    \"polygon\",\n    {\n      points: \"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\",\n      key: \"8f66p6\"\n    }\n  ]\n]);\n\nexport { Star as default };\n//# sourceMappingURL=star.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Target = createLucideIcon(\"Target\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"6\", key: \"1vlfrh\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"2\", key: \"1c9p78\" }]\n]);\n\nexport { Target as default };\n//# sourceMappingURL=target.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Thermometer = createLucideIcon(\"Thermometer\", [\n  [\"path\", { d: \"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z\", key: \"17jzev\" }]\n]);\n\nexport { Thermometer as default };\n//# sourceMappingURL=thermometer.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Timer = createLucideIcon(\"Timer\", [\n  [\"line\", { x1: \"10\", x2: \"14\", y1: \"2\", y2: \"2\", key: \"14vaq8\" }],\n  [\"line\", { x1: \"12\", x2: \"15\", y1: \"14\", y2: \"11\", key: \"17fdiu\" }],\n  [\"circle\", { cx: \"12\", cy: \"14\", r: \"8\", key: \"1e1u0o\" }]\n]);\n\nexport { Timer as default };\n//# sourceMappingURL=timer.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Trash2 = createLucideIcon(\"Trash2\", [\n  [\"path\", { d: \"M3 6h18\", key: \"d0wm0j\" }],\n  [\"path\", { d: \"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\", key: \"4alrt4\" }],\n  [\"path\", { d: \"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\", key: \"v07s0e\" }],\n  [\"line\", { x1: \"10\", x2: \"10\", y1: \"11\", y2: \"17\", key: \"1uufr5\" }],\n  [\"line\", { x1: \"14\", x2: \"14\", y1: \"11\", y2: \"17\", key: \"xtxkd\" }]\n]);\n\nexport { Trash2 as default };\n//# sourceMappingURL=trash-2.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst TrendingDown = createLucideIcon(\"TrendingDown\", [\n  [\"polyline\", { points: \"22 17 13.5 8.5 8.5 13.5 2 7\", key: \"1r2t7k\" }],\n  [\"polyline\", { points: \"16 17 22 17 22 11\", key: \"11uiuu\" }]\n]);\n\nexport { TrendingDown as default };\n//# sourceMappingURL=trending-down.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst TrendingUp = createLucideIcon(\"TrendingUp\", [\n  [\"polyline\", { points: \"22 7 13.5 15.5 8.5 10.5 2 17\", key: \"126l90\" }],\n  [\"polyline\", { points: \"16 7 22 7 22 13\", key: \"kwv8wd\" }]\n]);\n\nexport { TrendingUp as default };\n//# sourceMappingURL=trending-up.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Trophy = createLucideIcon(\"Trophy\", [\n  [\"path\", { d: \"M6 9H4.5a2.5 2.5 0 0 1 0-5H6\", key: \"17hqa7\" }],\n  [\"path\", { d: \"M18 9h1.5a2.5 2.5 0 0 0 0-5H18\", key: \"lmptdp\" }],\n  [\"path\", { d: \"M4 22h16\", key: \"57wxv0\" }],\n  [\"path\", { d: \"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22\", key: \"1nw9bq\" }],\n  [\"path\", { d: \"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22\", key: \"1np0yb\" }],\n  [\"path\", { d: \"M18 2H6v7a6 6 0 0 0 12 0V2Z\", key: \"u46fv3\" }]\n]);\n\nexport { Trophy as default };\n//# sourceMappingURL=trophy.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Unlock = createLucideIcon(\"Unlock\", [\n  [\"rect\", { width: \"18\", height: \"11\", x: \"3\", y: \"11\", rx: \"2\", ry: \"2\", key: \"1w4ew1\" }],\n  [\"path\", { d: \"M7 11V7a5 5 0 0 1 9.9-1\", key: \"1mm8w8\" }]\n]);\n\nexport { Unlock as default };\n//# sourceMappingURL=unlock.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Upload = createLucideIcon(\"Upload\", [\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }],\n  [\"polyline\", { points: \"17 8 12 3 7 8\", key: \"t8dd8p\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"3\", y2: \"15\", key: \"widbto\" }]\n]);\n\nexport { Upload as default };\n//# sourceMappingURL=upload.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst UserCheck = createLucideIcon(\"UserCheck\", [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }],\n  [\"polyline\", { points: \"16 11 18 13 22 9\", key: \"1pwet4\" }]\n]);\n\nexport { UserCheck as default };\n//# sourceMappingURL=user-check.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst UserCog = createLucideIcon(\"UserCog\", [\n  [\"circle\", { cx: \"18\", cy: \"15\", r: \"3\", key: \"gjjjvw\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }],\n  [\"path\", { d: \"M10 15H6a4 4 0 0 0-4 4v2\", key: \"1nfge6\" }],\n  [\"path\", { d: \"m21.7 16.4-.9-.3\", key: \"12j9ji\" }],\n  [\"path\", { d: \"m15.2 13.9-.9-.3\", key: \"1fdjdi\" }],\n  [\"path\", { d: \"m16.6 18.7.3-.9\", key: \"heedtr\" }],\n  [\"path\", { d: \"m19.1 12.2.3-.9\", key: \"1af3ki\" }],\n  [\"path\", { d: \"m19.6 18.7-.4-1\", key: \"1x9vze\" }],\n  [\"path\", { d: \"m16.8 12.3-.4-1\", key: \"vqeiwj\" }],\n  [\"path\", { d: \"m14.3 16.6 1-.4\", key: \"1qlj63\" }],\n  [\"path\", { d: \"m20.7 13.8 1-.4\", key: \"1v5t8k\" }]\n]);\n\nexport { UserCog as default };\n//# sourceMappingURL=user-cog.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst UserPlus = createLucideIcon(\"UserPlus\", [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }],\n  [\"line\", { x1: \"19\", x2: \"19\", y1: \"8\", y2: \"14\", key: \"1bvyxn\" }],\n  [\"line\", { x1: \"22\", x2: \"16\", y1: \"11\", y2: \"11\", key: \"1shjgl\" }]\n]);\n\nexport { UserPlus as default };\n//# sourceMappingURL=user-plus.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst UserX = createLucideIcon(\"UserX\", [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }],\n  [\"line\", { x1: \"17\", x2: \"22\", y1: \"8\", y2: \"13\", key: \"3nzzx3\" }],\n  [\"line\", { x1: \"22\", x2: \"17\", y1: \"8\", y2: \"13\", key: \"1swrse\" }]\n]);\n\nexport { UserX as default };\n//# sourceMappingURL=user-x.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst User = createLucideIcon(\"User\", [\n  [\"path\", { d: \"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\", key: \"975kel\" }],\n  [\"circle\", { cx: \"12\", cy: \"7\", r: \"4\", key: \"17ys0d\" }]\n]);\n\nexport { User as default };\n//# sourceMappingURL=user.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst UsersRound = createLucideIcon(\"UsersRound\", [\n  [\"path\", { d: \"M18 21a8 8 0 0 0-16 0\", key: \"3ypg7q\" }],\n  [\"circle\", { cx: \"10\", cy: \"8\", r: \"5\", key: \"o932ke\" }],\n  [\"path\", { d: \"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3\", key: \"10s06x\" }]\n]);\n\nexport { UsersRound as default };\n//# sourceMappingURL=users-round.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Users = createLucideIcon(\"Users\", [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }],\n  [\"path\", { d: \"M22 21v-2a4 4 0 0 0-3-3.87\", key: \"kshegd\" }],\n  [\"path\", { d: \"M16 3.13a4 4 0 0 1 0 7.75\", key: \"1da9ce\" }]\n]);\n\nexport { Users as default };\n//# sourceMappingURL=users.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Wind = createLucideIcon(\"Wind\", [\n  [\"path\", { d: \"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2\", key: \"1k4u03\" }],\n  [\"path\", { d: \"M9.6 4.6A2 2 0 1 1 11 8H2\", key: \"b7d0fd\" }],\n  [\"path\", { d: \"M12.6 19.4A2 2 0 1 0 14 16H2\", key: \"1p5cb3\" }]\n]);\n\nexport { Wind as default };\n//# sourceMappingURL=wind.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst X = createLucideIcon(\"X\", [\n  [\"path\", { d: \"M18 6 6 18\", key: \"1bl5f8\" }],\n  [\"path\", { d: \"m6 6 12 12\", key: \"d8bk6v\" }]\n]);\n\nexport { X as default };\n//# sourceMappingURL=x.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Zap = createLucideIcon(\"Zap\", [\n  [\"polygon\", { points: \"13 2 3 14 12 14 11 22 21 10 12 10 13 2\", key: \"45s27k\" }]\n]);\n\nexport { Zap as default };\n//# sourceMappingURL=zap.js.map\n","import React, { useState } from 'react';\nimport { LogIn, AlertCircle, Info, Eye, EyeOff } from 'lucide-react';\n\ninterface LoginFormProps {\n  onLogin: (email: string, password: string) => Promise<void>;\n}\n\nexport function LoginForm({ onLogin }: LoginFormProps) {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n\n  const [showForgotPassword, setShowForgotPassword] = useState(false);\n  const [resetEmail, setResetEmail] = useState('');\n  const [resetSent, setResetSent] = useState(false);\n  const [resetError, setResetError] = useState('');\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!email.trim() || !password) {\n      setError('');\n      return;\n    }\n\n    if (!email.includes('@')) {\n      setError('');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    try {\n      console.log(' Login attempt for:', email.trim());\n      await onLogin(email.trim(), password);\n      console.log(' Login successful');\n    } catch (err: any) {\n      console.error(' Login error:', err);\n      console.error('Error message:', err.message);\n      console.error('Error details:', err);\n\n      if (\n        err.message?.includes('Invalid login credentials') ||\n        err.message?.includes('')\n      ) {\n        setError(\n          '\\n\\n\\n \\n \\n \\n\\n'\n        );\n      } else if (err.message?.includes('Email not confirmed')) {\n        setError('');\n      } else if (err.message?.includes('Too many requests')) {\n        setError('5');\n      } else if (err.message?.includes('Missing Supabase environment variables')) {\n        setError('');\n      } else {\n        setError(\n          err.message ||\n            ''\n        );\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const togglePasswordVisibility = (e: React.MouseEvent) => {\n    e.preventDefault();\n    setShowPassword((prev) => !prev);\n  };\n\n  /**\n   *  \n   *   Supabase  Edge Function `request-password-reset`\n   *    Resend \n   */\n  const handleForgotPassword = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setResetError('');\n    setResetSent(false);\n  \n    const trimmedEmail = resetEmail.trim();\n  \n    if (!trimmedEmail || !trimmedEmail.includes('@')) {\n      setResetError('');\n      return;\n    }\n  \n    const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n    const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n  \n    if (!supabaseUrl || !supabaseAnonKey) {\n      console.error(' VITE_SUPABASE_URL / VITE_SUPABASE_ANON_KEY is not set');\n      setResetError(\n        ''\n      );\n      return;\n    }\n  \n    setLoading(true);\n  \n    try {\n      console.log(' Requesting password reset for:', trimmedEmail);\n  \n      const response = await fetch(`${supabaseUrl}/functions/v1/request-password-reset`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          apikey: supabaseAnonKey,\n          Authorization: `Bearer ${supabaseAnonKey}`,\n        },\n        body: JSON.stringify({\n          email: trimmedEmail,\n          // Supabase  hosted   \n          redirectUrl: window.location.origin,\n        }),\n      });\n  \n      const result = await response.json().catch(() => ({}));\n  \n      if (!response.ok) {\n        console.error(' request-password-reset error:', response.status, result);\n  \n        if (response.status === 404) {\n          setResetError(\n            ''\n          );\n        } else {\n          setResetError(\n            result?.error ||\n              ''\n          );\n        }\n        return;\n      }\n  \n      console.log(' Password reset request accepted:', result);\n      setResetSent(true);\n    } catch (err: any) {\n      console.error(' Password reset request failed:', err);\n      setResetError(\n        ''\n      );\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4 transition-colors\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md transition-colors\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"bg-blue-100 dark:bg-blue-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-colors\">\n            <LogIn className=\"w-10 h-10 text-blue-600 dark:text-blue-400\" />\n          </div>\n          <h1 className=\"flex items-baseline justify-center space-x-2 mb-2 transition-colors\">\n            <span\n              className=\"text-2xl font-bold text-gray-900 dark:text-white\"\n              style={{\n                fontFamily:\n                  '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif',\n                letterSpacing: '-0.02em',\n              }}\n            >\n              Bekuta\n            </span>\n            <span\n              className=\"text-sm font-medium text-gray-500 dark:text-gray-400\"\n              style={{ letterSpacing: '0.05em' }}\n            >\n              by ARCA\n            </span>\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-300 transition-colors\">\n            \n          </p>\n        </div>\n\n        {/* Login Form */}\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Email */}\n          <div>\n            <label\n              htmlFor=\"email\"\n              className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors\"\n            >\n              \n            </label>\n            <input\n              type=\"email\"\n              id=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              className=\"\n                w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg \n                focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent \n                transition-colors text-base\n                bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                placeholder-gray-500 dark:placeholder-gray-400\n              \"\n              placeholder=\"your-email@example.com\"\n              required\n              disabled={loading}\n              autoComplete=\"email\"\n              style={{\n                fontSize: '16px',\n                WebkitAppearance: 'none',\n                WebkitBorderRadius: '0.5rem',\n              }}\n            />\n          </div>\n\n          {/* Password */}\n          <div>\n            <label\n              htmlFor=\"password\"\n              className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors\"\n            >\n              \n            </label>\n            <div className=\"relative\">\n              <input\n                type={showPassword ? 'text' : 'password'}\n                id=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                className=\"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent \n                  transition-colors text-base\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                \"\n                placeholder=\"\"\n                required\n                disabled={loading}\n                autoComplete=\"current-password\"\n                style={{\n                  fontSize: '16px',\n                  WebkitAppearance: 'none',\n                  WebkitBorderRadius: '0.5rem',\n                }}\n              />\n              <button\n                type=\"button\"\n                onClick={togglePasswordVisibility}\n                className=\"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors touch-target\n                \"\n                disabled={loading}\n                style={{\n                  WebkitTapHighlightColor: 'transparent',\n                  touchAction: 'manipulation',\n                }}\n              >\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n          </div>\n\n          {/* Login Error */}\n          {error && (\n            <div className=\"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors\">\n              <AlertCircle className=\"w-5 h-5 flex-shrink-0 mt-0.5\" />\n              <div className=\"text-sm\">\n                <p className=\"font-medium mb-1\"></p>\n                <p className=\"whitespace-pre-line\">{error}</p>\n              </div>\n            </div>\n          )}\n\n          {/* Login Button */}\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"\n              w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg\n              hover:bg-blue-700 dark:hover:bg-blue-600\n              focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800\n              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium touch-target\n            \"\n            style={{\n              WebkitTapHighlightColor: 'transparent',\n              touchAction: 'manipulation',\n            }}\n          >\n            {loading ? '...' : ''}\n          </button>\n\n          {/* Forgot password link */}\n          <div className=\"mt-4 text-center\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                setShowForgotPassword(true);\n                setResetEmail(email);\n                setResetError('');\n                setResetSent(false);\n              }}\n              className=\"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors\"\n            >\n              \n            </button>\n          </div>\n        </form>\n\n        {/* Info blocks */}\n        <div className=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 transition-colors\">\n          {/*  */}\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 transition-colors\">\n            <div className=\"flex items-start space-x-2\">\n              <Info className=\"w-4 h-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0\" />\n              <div>\n                <h3 className=\"font-medium text-blue-900 dark:text-blue-300 mb-2\"></h3>\n                <div className=\"text-blue-700 dark:text-blue-400 space-y-1 text-left text-xs\">\n                  <p>1. Bekuta </p>\n                  <p>2. </p>\n                  <p>3. </p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/*  */}\n          <div className=\"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg transition-colors\">\n            <div className=\"flex items-start space-x-2\">\n              <AlertCircle className=\"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0\" />\n              <div className=\"text-amber-700 dark:text-amber-400 text-xs text-left\">\n                <p className=\"font-medium mb-1\"></p>\n                <p></p>\n                <ul className=\"list-disc list-inside mt-1 space-y-1\">\n                  <li></li>\n                  <li></li>\n                  <li></li>\n                  <li></li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n          <p className=\"mt-4 text-xs\"></p>\n        </div>\n      </div>\n\n      {/* Forgot Password Modal */}\n      {showForgotPassword && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md\">\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-4\">\n              \n            </h2>\n\n            {resetSent ? (\n              <div className=\"space-y-4\">\n                <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4\">\n                  <p className=\"text-green-800 dark:text-green-300 text-sm\">\n                    \n                  </p>\n                  <p className=\"text-green-700 dark:text-green-400 text-sm mt-2\">\n                    \n                  </p>\n                </div>\n                <button\n                  onClick={() => {\n                    setShowForgotPassword(false);\n                    setResetSent(false);\n                    setResetEmail('');\n                  }}\n                  className=\"w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors\"\n                >\n                  \n                </button>\n              </div>\n            ) : (\n              <form onSubmit={handleForgotPassword} className=\"space-y-4\">\n                <p className=\"text-gray-600 dark:text-gray-300 text-sm\">\n                  \n                  <br />\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    \n                  </span>\n                </p>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    \n                  </label>\n                  <input\n                    type=\"email\"\n                    value={resetEmail}\n                    onChange={(e) => setResetEmail(e.target.value)}\n                    className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors\"\n                    placeholder=\"email@example.com\"\n                    disabled={loading}\n                  />\n                </div>\n\n                {resetError && (\n                  <div className=\"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400\">\n                    <AlertCircle className=\"w-5 h-5 flex-shrink-0 mt-0.5\" />\n                    <p className=\"text-sm whitespace-pre-line\">{resetError}</p>\n                  </div>\n                )}\n\n                <div className=\"flex space-x-3\">\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      setShowForgotPassword(false);\n                      setResetError('');\n                      setResetEmail('');\n                    }}\n                    className=\"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors\"\n                    disabled={loading}\n                  >\n                    \n                  </button>\n                  <button\n                    type=\"submit\"\n                    disabled={loading}\n                    className=\"flex-1 bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {loading ? '...' : ''}\n                  </button>\n                </div>\n              </form>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","// canvas-confetti v1.9.4 built on 2025-10-25T05:14:56.640Z\nvar module = {};\n\n// source content\n/* globals Map */\n\n(function main(global, module, isWorker, workerSize) {\n  var canUseWorker = !!(\n    global.Worker &&\n    global.Blob &&\n    global.Promise &&\n    global.OffscreenCanvas &&\n    global.OffscreenCanvasRenderingContext2D &&\n    global.HTMLCanvasElement &&\n    global.HTMLCanvasElement.prototype.transferControlToOffscreen &&\n    global.URL &&\n    global.URL.createObjectURL);\n\n  var canUsePaths = typeof Path2D === 'function' && typeof DOMMatrix === 'function';\n  var canDrawBitmap = (function () {\n    // this mostly supports ssr\n    if (!global.OffscreenCanvas) {\n      return false;\n    }\n\n    try {\n      var canvas = new OffscreenCanvas(1, 1);\n      var ctx = canvas.getContext('2d');\n      ctx.fillRect(0, 0, 1, 1);\n      var bitmap = canvas.transferToImageBitmap();\n      ctx.createPattern(bitmap, 'no-repeat');\n    } catch (e) {\n      return false;\n    }\n\n    return true;\n  })();\n\n  function noop() {}\n\n  // create a promise if it exists, otherwise, just\n  // call the function directly\n  function promise(func) {\n    var ModulePromise = module.exports.Promise;\n    var Prom = ModulePromise !== void 0 ? ModulePromise : global.Promise;\n\n    if (typeof Prom === 'function') {\n      return new Prom(func);\n    }\n\n    func(noop, noop);\n\n    return null;\n  }\n\n  var bitmapMapper = (function (skipTransform, map) {\n    // see https://github.com/catdad/canvas-confetti/issues/209\n    // creating canvases is actually pretty expensive, so we should create a\n    // 1:1 map for bitmap:canvas, so that we can animate the confetti in\n    // a performant manner, but also not store them forever so that we don't\n    // have a memory leak\n    return {\n      transform: function(bitmap) {\n        if (skipTransform) {\n          return bitmap;\n        }\n\n        if (map.has(bitmap)) {\n          return map.get(bitmap);\n        }\n\n        var canvas = new OffscreenCanvas(bitmap.width, bitmap.height);\n        var ctx = canvas.getContext('2d');\n        ctx.drawImage(bitmap, 0, 0);\n\n        map.set(bitmap, canvas);\n\n        return canvas;\n      },\n      clear: function () {\n        map.clear();\n      }\n    };\n  })(canDrawBitmap, new Map());\n\n  var raf = (function () {\n    var TIME = Math.floor(1000 / 60);\n    var frame, cancel;\n    var frames = {};\n    var lastFrameTime = 0;\n\n    if (typeof requestAnimationFrame === 'function' && typeof cancelAnimationFrame === 'function') {\n      frame = function (cb) {\n        var id = Math.random();\n\n        frames[id] = requestAnimationFrame(function onFrame(time) {\n          if (lastFrameTime === time || lastFrameTime + TIME - 1 < time) {\n            lastFrameTime = time;\n            delete frames[id];\n\n            cb();\n          } else {\n            frames[id] = requestAnimationFrame(onFrame);\n          }\n        });\n\n        return id;\n      };\n      cancel = function (id) {\n        if (frames[id]) {\n          cancelAnimationFrame(frames[id]);\n        }\n      };\n    } else {\n      frame = function (cb) {\n        return setTimeout(cb, TIME);\n      };\n      cancel = function (timer) {\n        return clearTimeout(timer);\n      };\n    }\n\n    return { frame: frame, cancel: cancel };\n  }());\n\n  var getWorker = (function () {\n    var worker;\n    var prom;\n    var resolves = {};\n\n    function decorate(worker) {\n      function execute(options, callback) {\n        worker.postMessage({ options: options || {}, callback: callback });\n      }\n      worker.init = function initWorker(canvas) {\n        var offscreen = canvas.transferControlToOffscreen();\n        worker.postMessage({ canvas: offscreen }, [offscreen]);\n      };\n\n      worker.fire = function fireWorker(options, size, done) {\n        if (prom) {\n          execute(options, null);\n          return prom;\n        }\n\n        var id = Math.random().toString(36).slice(2);\n\n        prom = promise(function (resolve) {\n          function workerDone(msg) {\n            if (msg.data.callback !== id) {\n              return;\n            }\n\n            delete resolves[id];\n            worker.removeEventListener('message', workerDone);\n\n            prom = null;\n\n            bitmapMapper.clear();\n\n            done();\n            resolve();\n          }\n\n          worker.addEventListener('message', workerDone);\n          execute(options, id);\n\n          resolves[id] = workerDone.bind(null, { data: { callback: id }});\n        });\n\n        return prom;\n      };\n\n      worker.reset = function resetWorker() {\n        worker.postMessage({ reset: true });\n\n        for (var id in resolves) {\n          resolves[id]();\n          delete resolves[id];\n        }\n      };\n    }\n\n    return function () {\n      if (worker) {\n        return worker;\n      }\n\n      if (!isWorker && canUseWorker) {\n        var code = [\n          'var CONFETTI, SIZE = {}, module = {};',\n          '(' + main.toString() + ')(this, module, true, SIZE);',\n          'onmessage = function(msg) {',\n          '  if (msg.data.options) {',\n          '    CONFETTI(msg.data.options).then(function () {',\n          '      if (msg.data.callback) {',\n          '        postMessage({ callback: msg.data.callback });',\n          '      }',\n          '    });',\n          '  } else if (msg.data.reset) {',\n          '    CONFETTI && CONFETTI.reset();',\n          '  } else if (msg.data.resize) {',\n          '    SIZE.width = msg.data.resize.width;',\n          '    SIZE.height = msg.data.resize.height;',\n          '  } else if (msg.data.canvas) {',\n          '    SIZE.width = msg.data.canvas.width;',\n          '    SIZE.height = msg.data.canvas.height;',\n          '    CONFETTI = module.exports.create(msg.data.canvas);',\n          '  }',\n          '}',\n        ].join('\\n');\n        try {\n          worker = new Worker(URL.createObjectURL(new Blob([code])));\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          typeof console !== 'undefined' && typeof console.warn === 'function' ? console.warn(' Could not load worker', e) : null;\n\n          return null;\n        }\n\n        decorate(worker);\n      }\n\n      return worker;\n    };\n  })();\n\n  var defaults = {\n    particleCount: 50,\n    angle: 90,\n    spread: 45,\n    startVelocity: 45,\n    decay: 0.9,\n    gravity: 1,\n    drift: 0,\n    ticks: 200,\n    x: 0.5,\n    y: 0.5,\n    shapes: ['square', 'circle'],\n    zIndex: 100,\n    colors: [\n      '#26ccff',\n      '#a25afd',\n      '#ff5e7e',\n      '#88ff5a',\n      '#fcff42',\n      '#ffa62d',\n      '#ff36ff'\n    ],\n    // probably should be true, but back-compat\n    disableForReducedMotion: false,\n    scalar: 1\n  };\n\n  function convert(val, transform) {\n    return transform ? transform(val) : val;\n  }\n\n  function isOk(val) {\n    return !(val === null || val === undefined);\n  }\n\n  function prop(options, name, transform) {\n    return convert(\n      options && isOk(options[name]) ? options[name] : defaults[name],\n      transform\n    );\n  }\n\n  function onlyPositiveInt(number){\n    return number < 0 ? 0 : Math.floor(number);\n  }\n\n  function randomInt(min, max) {\n    // [min, max)\n    return Math.floor(Math.random() * (max - min)) + min;\n  }\n\n  function toDecimal(str) {\n    return parseInt(str, 16);\n  }\n\n  function colorsToRgb(colors) {\n    return colors.map(hexToRgb);\n  }\n\n  function hexToRgb(str) {\n    var val = String(str).replace(/[^0-9a-f]/gi, '');\n\n    if (val.length < 6) {\n        val = val[0]+val[0]+val[1]+val[1]+val[2]+val[2];\n    }\n\n    return {\n      r: toDecimal(val.substring(0,2)),\n      g: toDecimal(val.substring(2,4)),\n      b: toDecimal(val.substring(4,6))\n    };\n  }\n\n  function getOrigin(options) {\n    var origin = prop(options, 'origin', Object);\n    origin.x = prop(origin, 'x', Number);\n    origin.y = prop(origin, 'y', Number);\n\n    return origin;\n  }\n\n  function setCanvasWindowSize(canvas) {\n    canvas.width = document.documentElement.clientWidth;\n    canvas.height = document.documentElement.clientHeight;\n  }\n\n  function setCanvasRectSize(canvas) {\n    var rect = canvas.getBoundingClientRect();\n    canvas.width = rect.width;\n    canvas.height = rect.height;\n  }\n\n  function getCanvas(zIndex) {\n    var canvas = document.createElement('canvas');\n\n    canvas.style.position = 'fixed';\n    canvas.style.top = '0px';\n    canvas.style.left = '0px';\n    canvas.style.pointerEvents = 'none';\n    canvas.style.zIndex = zIndex;\n\n    return canvas;\n  }\n\n  function ellipse(context, x, y, radiusX, radiusY, rotation, startAngle, endAngle, antiClockwise) {\n    context.save();\n    context.translate(x, y);\n    context.rotate(rotation);\n    context.scale(radiusX, radiusY);\n    context.arc(0, 0, 1, startAngle, endAngle, antiClockwise);\n    context.restore();\n  }\n\n  function randomPhysics(opts) {\n    var radAngle = opts.angle * (Math.PI / 180);\n    var radSpread = opts.spread * (Math.PI / 180);\n\n    return {\n      x: opts.x,\n      y: opts.y,\n      wobble: Math.random() * 10,\n      wobbleSpeed: Math.min(0.11, Math.random() * 0.1 + 0.05),\n      velocity: (opts.startVelocity * 0.5) + (Math.random() * opts.startVelocity),\n      angle2D: -radAngle + ((0.5 * radSpread) - (Math.random() * radSpread)),\n      tiltAngle: (Math.random() * (0.75 - 0.25) + 0.25) * Math.PI,\n      color: opts.color,\n      shape: opts.shape,\n      tick: 0,\n      totalTicks: opts.ticks,\n      decay: opts.decay,\n      drift: opts.drift,\n      random: Math.random() + 2,\n      tiltSin: 0,\n      tiltCos: 0,\n      wobbleX: 0,\n      wobbleY: 0,\n      gravity: opts.gravity * 3,\n      ovalScalar: 0.6,\n      scalar: opts.scalar,\n      flat: opts.flat\n    };\n  }\n\n  function updateFetti(context, fetti) {\n    fetti.x += Math.cos(fetti.angle2D) * fetti.velocity + fetti.drift;\n    fetti.y += Math.sin(fetti.angle2D) * fetti.velocity + fetti.gravity;\n    fetti.velocity *= fetti.decay;\n\n    if (fetti.flat) {\n      fetti.wobble = 0;\n      fetti.wobbleX = fetti.x + (10 * fetti.scalar);\n      fetti.wobbleY = fetti.y + (10 * fetti.scalar);\n\n      fetti.tiltSin = 0;\n      fetti.tiltCos = 0;\n      fetti.random = 1;\n    } else {\n      fetti.wobble += fetti.wobbleSpeed;\n      fetti.wobbleX = fetti.x + ((10 * fetti.scalar) * Math.cos(fetti.wobble));\n      fetti.wobbleY = fetti.y + ((10 * fetti.scalar) * Math.sin(fetti.wobble));\n\n      fetti.tiltAngle += 0.1;\n      fetti.tiltSin = Math.sin(fetti.tiltAngle);\n      fetti.tiltCos = Math.cos(fetti.tiltAngle);\n      fetti.random = Math.random() + 2;\n    }\n\n    var progress = (fetti.tick++) / fetti.totalTicks;\n\n    var x1 = fetti.x + (fetti.random * fetti.tiltCos);\n    var y1 = fetti.y + (fetti.random * fetti.tiltSin);\n    var x2 = fetti.wobbleX + (fetti.random * fetti.tiltCos);\n    var y2 = fetti.wobbleY + (fetti.random * fetti.tiltSin);\n\n    context.fillStyle = 'rgba(' + fetti.color.r + ', ' + fetti.color.g + ', ' + fetti.color.b + ', ' + (1 - progress) + ')';\n\n    context.beginPath();\n\n    if (canUsePaths && fetti.shape.type === 'path' && typeof fetti.shape.path === 'string' && Array.isArray(fetti.shape.matrix)) {\n      context.fill(transformPath2D(\n        fetti.shape.path,\n        fetti.shape.matrix,\n        fetti.x,\n        fetti.y,\n        Math.abs(x2 - x1) * 0.1,\n        Math.abs(y2 - y1) * 0.1,\n        Math.PI / 10 * fetti.wobble\n      ));\n    } else if (fetti.shape.type === 'bitmap') {\n      var rotation = Math.PI / 10 * fetti.wobble;\n      var scaleX = Math.abs(x2 - x1) * 0.1;\n      var scaleY = Math.abs(y2 - y1) * 0.1;\n      var width = fetti.shape.bitmap.width * fetti.scalar;\n      var height = fetti.shape.bitmap.height * fetti.scalar;\n\n      var matrix = new DOMMatrix([\n        Math.cos(rotation) * scaleX,\n        Math.sin(rotation) * scaleX,\n        -Math.sin(rotation) * scaleY,\n        Math.cos(rotation) * scaleY,\n        fetti.x,\n        fetti.y\n      ]);\n\n      // apply the transform matrix from the confetti shape\n      matrix.multiplySelf(new DOMMatrix(fetti.shape.matrix));\n\n      var pattern = context.createPattern(bitmapMapper.transform(fetti.shape.bitmap), 'no-repeat');\n      pattern.setTransform(matrix);\n\n      context.globalAlpha = (1 - progress);\n      context.fillStyle = pattern;\n      context.fillRect(\n        fetti.x - (width / 2),\n        fetti.y - (height / 2),\n        width,\n        height\n      );\n      context.globalAlpha = 1;\n    } else if (fetti.shape === 'circle') {\n      context.ellipse ?\n        context.ellipse(fetti.x, fetti.y, Math.abs(x2 - x1) * fetti.ovalScalar, Math.abs(y2 - y1) * fetti.ovalScalar, Math.PI / 10 * fetti.wobble, 0, 2 * Math.PI) :\n        ellipse(context, fetti.x, fetti.y, Math.abs(x2 - x1) * fetti.ovalScalar, Math.abs(y2 - y1) * fetti.ovalScalar, Math.PI / 10 * fetti.wobble, 0, 2 * Math.PI);\n    } else if (fetti.shape === 'star') {\n      var rot = Math.PI / 2 * 3;\n      var innerRadius = 4 * fetti.scalar;\n      var outerRadius = 8 * fetti.scalar;\n      var x = fetti.x;\n      var y = fetti.y;\n      var spikes = 5;\n      var step = Math.PI / spikes;\n\n      while (spikes--) {\n        x = fetti.x + Math.cos(rot) * outerRadius;\n        y = fetti.y + Math.sin(rot) * outerRadius;\n        context.lineTo(x, y);\n        rot += step;\n\n        x = fetti.x + Math.cos(rot) * innerRadius;\n        y = fetti.y + Math.sin(rot) * innerRadius;\n        context.lineTo(x, y);\n        rot += step;\n      }\n    } else {\n      context.moveTo(Math.floor(fetti.x), Math.floor(fetti.y));\n      context.lineTo(Math.floor(fetti.wobbleX), Math.floor(y1));\n      context.lineTo(Math.floor(x2), Math.floor(y2));\n      context.lineTo(Math.floor(x1), Math.floor(fetti.wobbleY));\n    }\n\n    context.closePath();\n    context.fill();\n\n    return fetti.tick < fetti.totalTicks;\n  }\n\n  function animate(canvas, fettis, resizer, size, done) {\n    var animatingFettis = fettis.slice();\n    var context = canvas.getContext('2d');\n    var animationFrame;\n    var destroy;\n\n    var prom = promise(function (resolve) {\n      function onDone() {\n        animationFrame = destroy = null;\n\n        context.clearRect(0, 0, size.width, size.height);\n        bitmapMapper.clear();\n\n        done();\n        resolve();\n      }\n\n      function update() {\n        if (isWorker && !(size.width === workerSize.width && size.height === workerSize.height)) {\n          size.width = canvas.width = workerSize.width;\n          size.height = canvas.height = workerSize.height;\n        }\n\n        if (!size.width && !size.height) {\n          resizer(canvas);\n          size.width = canvas.width;\n          size.height = canvas.height;\n        }\n\n        context.clearRect(0, 0, size.width, size.height);\n\n        animatingFettis = animatingFettis.filter(function (fetti) {\n          return updateFetti(context, fetti);\n        });\n\n        if (animatingFettis.length) {\n          animationFrame = raf.frame(update);\n        } else {\n          onDone();\n        }\n      }\n\n      animationFrame = raf.frame(update);\n      destroy = onDone;\n    });\n\n    return {\n      addFettis: function (fettis) {\n        animatingFettis = animatingFettis.concat(fettis);\n\n        return prom;\n      },\n      canvas: canvas,\n      promise: prom,\n      reset: function () {\n        if (animationFrame) {\n          raf.cancel(animationFrame);\n        }\n\n        if (destroy) {\n          destroy();\n        }\n      }\n    };\n  }\n\n  function confettiCannon(canvas, globalOpts) {\n    var isLibCanvas = !canvas;\n    var allowResize = !!prop(globalOpts || {}, 'resize');\n    var hasResizeEventRegistered = false;\n    var globalDisableForReducedMotion = prop(globalOpts, 'disableForReducedMotion', Boolean);\n    var shouldUseWorker = canUseWorker && !!prop(globalOpts || {}, 'useWorker');\n    var worker = shouldUseWorker ? getWorker() : null;\n    var resizer = isLibCanvas ? setCanvasWindowSize : setCanvasRectSize;\n    var initialized = (canvas && worker) ? !!canvas.__confetti_initialized : false;\n    var preferLessMotion = typeof matchMedia === 'function' && matchMedia('(prefers-reduced-motion)').matches;\n    var animationObj;\n\n    function fireLocal(options, size, done) {\n      var particleCount = prop(options, 'particleCount', onlyPositiveInt);\n      var angle = prop(options, 'angle', Number);\n      var spread = prop(options, 'spread', Number);\n      var startVelocity = prop(options, 'startVelocity', Number);\n      var decay = prop(options, 'decay', Number);\n      var gravity = prop(options, 'gravity', Number);\n      var drift = prop(options, 'drift', Number);\n      var colors = prop(options, 'colors', colorsToRgb);\n      var ticks = prop(options, 'ticks', Number);\n      var shapes = prop(options, 'shapes');\n      var scalar = prop(options, 'scalar');\n      var flat = !!prop(options, 'flat');\n      var origin = getOrigin(options);\n\n      var temp = particleCount;\n      var fettis = [];\n\n      var startX = canvas.width * origin.x;\n      var startY = canvas.height * origin.y;\n\n      while (temp--) {\n        fettis.push(\n          randomPhysics({\n            x: startX,\n            y: startY,\n            angle: angle,\n            spread: spread,\n            startVelocity: startVelocity,\n            color: colors[temp % colors.length],\n            shape: shapes[randomInt(0, shapes.length)],\n            ticks: ticks,\n            decay: decay,\n            gravity: gravity,\n            drift: drift,\n            scalar: scalar,\n            flat: flat\n          })\n        );\n      }\n\n      // if we have a previous canvas already animating,\n      // add to it\n      if (animationObj) {\n        return animationObj.addFettis(fettis);\n      }\n\n      animationObj = animate(canvas, fettis, resizer, size , done);\n\n      return animationObj.promise;\n    }\n\n    function fire(options) {\n      var disableForReducedMotion = globalDisableForReducedMotion || prop(options, 'disableForReducedMotion', Boolean);\n      var zIndex = prop(options, 'zIndex', Number);\n\n      if (disableForReducedMotion && preferLessMotion) {\n        return promise(function (resolve) {\n          resolve();\n        });\n      }\n\n      if (isLibCanvas && animationObj) {\n        // use existing canvas from in-progress animation\n        canvas = animationObj.canvas;\n      } else if (isLibCanvas && !canvas) {\n        // create and initialize a new canvas\n        canvas = getCanvas(zIndex);\n        document.body.appendChild(canvas);\n      }\n\n      if (allowResize && !initialized) {\n        // initialize the size of a user-supplied canvas\n        resizer(canvas);\n      }\n\n      var size = {\n        width: canvas.width,\n        height: canvas.height\n      };\n\n      if (worker && !initialized) {\n        worker.init(canvas);\n      }\n\n      initialized = true;\n\n      if (worker) {\n        canvas.__confetti_initialized = true;\n      }\n\n      function onResize() {\n        if (worker) {\n          // TODO this really shouldn't be immediate, because it is expensive\n          var obj = {\n            getBoundingClientRect: function () {\n              if (!isLibCanvas) {\n                return canvas.getBoundingClientRect();\n              }\n            }\n          };\n\n          resizer(obj);\n\n          worker.postMessage({\n            resize: {\n              width: obj.width,\n              height: obj.height\n            }\n          });\n          return;\n        }\n\n        // don't actually query the size here, since this\n        // can execute frequently and rapidly\n        size.width = size.height = null;\n      }\n\n      function done() {\n        animationObj = null;\n\n        if (allowResize) {\n          hasResizeEventRegistered = false;\n          global.removeEventListener('resize', onResize);\n        }\n\n        if (isLibCanvas && canvas) {\n          if (document.body.contains(canvas)) {\n            document.body.removeChild(canvas);\n          }\n          canvas = null;\n          initialized = false;\n        }\n      }\n\n      if (allowResize && !hasResizeEventRegistered) {\n        hasResizeEventRegistered = true;\n        global.addEventListener('resize', onResize, false);\n      }\n\n      if (worker) {\n        return worker.fire(options, size, done);\n      }\n\n      return fireLocal(options, size, done);\n    }\n\n    fire.reset = function () {\n      if (worker) {\n        worker.reset();\n      }\n\n      if (animationObj) {\n        animationObj.reset();\n      }\n    };\n\n    return fire;\n  }\n\n  // Make default export lazy to defer worker creation until called.\n  var defaultFire;\n  function getDefaultFire() {\n    if (!defaultFire) {\n      defaultFire = confettiCannon(null, { useWorker: true, resize: true });\n    }\n    return defaultFire;\n  }\n\n  function transformPath2D(pathString, pathMatrix, x, y, scaleX, scaleY, rotation) {\n    var path2d = new Path2D(pathString);\n\n    var t1 = new Path2D();\n    t1.addPath(path2d, new DOMMatrix(pathMatrix));\n\n    var t2 = new Path2D();\n    // see https://developer.mozilla.org/en-US/docs/Web/API/DOMMatrix/DOMMatrix\n    t2.addPath(t1, new DOMMatrix([\n      Math.cos(rotation) * scaleX,\n      Math.sin(rotation) * scaleX,\n      -Math.sin(rotation) * scaleY,\n      Math.cos(rotation) * scaleY,\n      x,\n      y\n    ]));\n\n    return t2;\n  }\n\n  function shapeFromPath(pathData) {\n    if (!canUsePaths) {\n      throw new Error('path confetti are not supported in this browser');\n    }\n\n    var path, matrix;\n\n    if (typeof pathData === 'string') {\n      path = pathData;\n    } else {\n      path = pathData.path;\n      matrix = pathData.matrix;\n    }\n\n    var path2d = new Path2D(path);\n    var tempCanvas = document.createElement('canvas');\n    var tempCtx = tempCanvas.getContext('2d');\n\n    if (!matrix) {\n      // attempt to figure out the width of the path, up to 1000x1000\n      var maxSize = 1000;\n      var minX = maxSize;\n      var minY = maxSize;\n      var maxX = 0;\n      var maxY = 0;\n      var width, height;\n\n      // do some line skipping... this is faster than checking\n      // every pixel and will be mostly still correct\n      for (var x = 0; x < maxSize; x += 2) {\n        for (var y = 0; y < maxSize; y += 2) {\n          if (tempCtx.isPointInPath(path2d, x, y, 'nonzero')) {\n            minX = Math.min(minX, x);\n            minY = Math.min(minY, y);\n            maxX = Math.max(maxX, x);\n            maxY = Math.max(maxY, y);\n          }\n        }\n      }\n\n      width = maxX - minX;\n      height = maxY - minY;\n\n      var maxDesiredSize = 10;\n      var scale = Math.min(maxDesiredSize/width, maxDesiredSize/height);\n\n      matrix = [\n        scale, 0, 0, scale,\n        -Math.round((width/2) + minX) * scale,\n        -Math.round((height/2) + minY) * scale\n      ];\n    }\n\n    return {\n      type: 'path',\n      path: path,\n      matrix: matrix\n    };\n  }\n\n  function shapeFromText(textData) {\n    var text,\n        scalar = 1,\n        color = '#000000',\n        // see https://nolanlawson.com/2022/04/08/the-struggle-of-using-native-emoji-on-the-web/\n        fontFamily = '\"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji\", \"EmojiOne Color\", \"Android Emoji\", \"Twemoji Mozilla\", \"system emoji\", sans-serif';\n\n    if (typeof textData === 'string') {\n      text = textData;\n    } else {\n      text = textData.text;\n      scalar = 'scalar' in textData ? textData.scalar : scalar;\n      fontFamily = 'fontFamily' in textData ? textData.fontFamily : fontFamily;\n      color = 'color' in textData ? textData.color : color;\n    }\n\n    // all other confetti are 10 pixels,\n    // so this pixel size is the de-facto 100% scale confetti\n    var fontSize = 10 * scalar;\n    var font = '' + fontSize + 'px ' + fontFamily;\n\n    var canvas = new OffscreenCanvas(fontSize, fontSize);\n    var ctx = canvas.getContext('2d');\n\n    ctx.font = font;\n    var size = ctx.measureText(text);\n    var width = Math.ceil(size.actualBoundingBoxRight + size.actualBoundingBoxLeft);\n    var height = Math.ceil(size.actualBoundingBoxAscent + size.actualBoundingBoxDescent);\n\n    var padding = 2;\n    var x = size.actualBoundingBoxLeft + padding;\n    var y = size.actualBoundingBoxAscent + padding;\n    width += padding + padding;\n    height += padding + padding;\n\n    canvas = new OffscreenCanvas(width, height);\n    ctx = canvas.getContext('2d');\n    ctx.font = font;\n    ctx.fillStyle = color;\n\n    ctx.fillText(text, x, y);\n\n    var scale = 1 / scalar;\n\n    return {\n      type: 'bitmap',\n      // TODO these probably need to be transfered for workers\n      bitmap: canvas.transferToImageBitmap(),\n      matrix: [scale, 0, 0, scale, -width * scale / 2, -height * scale / 2]\n    };\n  }\n\n  module.exports = function() {\n    return getDefaultFire().apply(this, arguments);\n  };\n  module.exports.reset = function() {\n    getDefaultFire().reset();\n  };\n  module.exports.create = confettiCannon;\n  module.exports.shapeFromPath = shapeFromPath;\n  module.exports.shapeFromText = shapeFromText;\n}((function () {\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n\n  return this || {};\n})(), module, false));\n\n// end source content\n\nexport default module.exports;\nexport var create = module.exports.create;\n","import React, { useState, useEffect } from 'react';\nimport { Key, Eye, EyeOff, AlertCircle, CheckCircle, Sparkles } from 'lucide-react';\nimport confetti from 'canvas-confetti';\n\ninterface PasswordChangeFormProps {\n  onPasswordChange: (newPassword: string) => Promise<void>;\n  userName: string;\n}\n\nexport function PasswordChangeForm({ onPasswordChange, userName }: PasswordChangeFormProps) {\n  const [newPassword, setNewPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [animationStep, setAnimationStep] = useState(0);\n  const [progressPercent, setProgressPercent] = useState(0);\n\n  useEffect(() => {\n    setTimeout(() => setAnimationStep(1), 100);\n    setTimeout(() => setAnimationStep(2), 400);\n  }, []);\n\n  useEffect(() => {\n    const requirements = [\n      passwordValidation.minLength,\n      passwordValidation.hasUpperCase,\n      passwordValidation.hasLowerCase,\n      passwordValidation.hasNumbers,\n      passwordValidation.hasSpecialChar\n    ];\n    const completed = requirements.filter(Boolean).length;\n    const newPercent = (completed / requirements.length) * 100;\n    setProgressPercent(newPercent);\n  }, [newPassword]);\n\n  const validatePassword = (password: string) => {\n    const minLength = password.length >= 8;\n    const hasUpperCase = /[A-Z]/.test(password);\n    const hasLowerCase = /[a-z]/.test(password);\n    const hasNumbers = /\\d/.test(password);\n    const hasSpecialChar = /[!@#$%^&*(),.?\":{}|<>]/.test(password);\n\n    return {\n      minLength,\n      hasUpperCase,\n      hasLowerCase,\n      hasNumbers,\n      hasSpecialChar,\n      isValid: minLength && hasUpperCase && hasLowerCase && hasNumbers && hasSpecialChar\n    };\n  };\n\n  const passwordValidation = validatePassword(newPassword);\n  const passwordsMatch = newPassword === confirmPassword && confirmPassword.length > 0;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!passwordValidation.isValid) {\n      setError('');\n      return;\n    }\n\n    if (!passwordsMatch) {\n      setError('');\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      confetti({\n        particleCount: 100,\n        spread: 70,\n        origin: { y: 0.6 }\n      });\n\n      setTimeout(() => {\n        confetti({\n          particleCount: 50,\n          angle: 60,\n          spread: 55,\n          origin: { x: 0 }\n        });\n        confetti({\n          particleCount: 50,\n          angle: 120,\n          spread: 55,\n          origin: { x: 1 }\n        });\n      }, 250);\n\n      await onPasswordChange(newPassword);\n    } catch (err: any) {\n      console.error('Password change error:', err);\n    \n      const message =\n        err?.message ||\n        err?.error_description ||\n        '';\n    \n      if (message.includes('different from the old password')) {\n        setError('');\n      } else if (message.includes('Password should be at least')) {\n        setError('');\n      } else if (message.includes('Auth session missing')) {\n        setError('');\n      } else {\n        setError('');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getProgressColor = () => {\n    if (progressPercent < 40) return 'bg-red-500';\n    if (progressPercent < 80) return 'bg-yellow-500';\n    return 'bg-green-500';\n  };\n\n  const getStrengthLabel = () => {\n    if (progressPercent === 0) return '';\n    if (progressPercent < 40) return '';\n    if (progressPercent < 80) return '';\n    return '';\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden\">\n      <div className={`bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md transition-all duration-700 ${\n        animationStep >= 1 ? 'opacity-100 scale-100' : 'opacity-0 scale-95'\n      }`}>\n        <div className=\"text-center mb-8\">\n          <div className={`bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 rounded-full p-3 w-16 h-16 mx-auto mb-4 transition-all duration-500 ${\n            animationStep >= 2 ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'\n          }`}>\n            <Sparkles className=\"w-10 h-10 text-blue-600 dark:text-blue-400\" />\n          </div>\n          <h1 className={`text-2xl font-bold text-gray-900 dark:text-white mb-2 transition-all duration-500 delay-100 ${\n            animationStep >= 2 ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'\n          }`}>\n            1\n          </h1>\n          <p className={`text-lg text-gray-600 dark:text-gray-300 mb-2 transition-all duration-500 delay-200 ${\n            animationStep >= 2 ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'\n          }`}>\n            {userName}\n          </p>\n          <div className={`bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-4 transition-all duration-500 delay-300 ${\n            animationStep >= 2 ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'\n          }`}>\n            <div className=\"flex items-center justify-center space-x-2 mb-2\">\n              <div className=\"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold\">1</div>\n              <div className=\"w-12 h-1 bg-blue-600 dark:bg-blue-500 rounded\"></div>\n              <div className=\"w-8 h-8 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold\">2</div>\n              <div className=\"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded\"></div>\n              <div className=\"w-8 h-8 bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 rounded-full flex items-center justify-center text-sm font-bold\">3</div>\n            </div>\n            <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n              \n            </p>\n          </div>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div>\n            <label htmlFor=\"newPassword\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors\">\n              \n            </label>\n            <div className=\"relative\">\n              <input\n                type={showPassword ? 'text' : 'password'}\n                id=\"newPassword\"\n                value={newPassword}\n                onChange={(e) => setNewPassword(e.target.value)}\n                className=\"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent \n                  transition-colors\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                \"\n                placeholder=\"\"\n                required\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPassword(!showPassword)}\n                className=\"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors\n                \"\n              >\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n          </div>\n\n          <div>\n            <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors\">\n              \n            </label>\n            <div className=\"relative\">\n              <input\n                type={showConfirmPassword ? 'text' : 'password'}\n                id=\"confirmPassword\"\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                className=\"\n                  w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg \n                  focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-transparent \n                  transition-colors\n                  bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                  placeholder-gray-500 dark:placeholder-gray-400\n                \"\n                placeholder=\"\"\n                required\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                className=\"\n                  absolute right-3 top-1/2 transform -translate-y-1/2 \n                  text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 \n                  transition-colors\n                \"\n              >\n                {showConfirmPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n          </div>\n\n          {newPassword && (\n            <div className=\"mb-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\"></span>\n                <span className={`text-sm font-bold ${\n                  progressPercent < 40 ? 'text-red-600 dark:text-red-400' :\n                  progressPercent < 80 ? 'text-yellow-600 dark:text-yellow-400' :\n                  'text-green-600 dark:text-green-400'\n                }`}>\n                  {getStrengthLabel()}\n                </span>\n              </div>\n              <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden\">\n                <div\n                  className={`h-full ${getProgressColor()} transition-all duration-500 rounded-full`}\n                  style={{ width: `${progressPercent}%` }}\n                ></div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-700 dark:to-blue-900/20 rounded-lg p-4 transition-colors\">\n            <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 transition-colors\">\n              \n            </h4>\n            <div className=\"space-y-2 text-sm\">\n              <div className={`flex items-center transition-colors ${\n                passwordValidation.minLength \n                  ? 'text-green-600 dark:text-green-400' \n                  : 'text-gray-400 dark:text-gray-500'\n              }`}>\n                <CheckCircle className=\"w-4 h-4 mr-2\" />\n                <span>8</span>\n              </div>\n              <div className={`flex items-center transition-colors ${\n                passwordValidation.hasUpperCase \n                  ? 'text-green-600 dark:text-green-400' \n                  : 'text-gray-400 dark:text-gray-500'\n              }`}>\n                <CheckCircle className=\"w-4 h-4 mr-2\" />\n                <span></span>\n              </div>\n              <div className={`flex items-center transition-colors ${\n                passwordValidation.hasLowerCase \n                  ? 'text-green-600 dark:text-green-400' \n                  : 'text-gray-400 dark:text-gray-500'\n              }`}>\n                <CheckCircle className=\"w-4 h-4 mr-2\" />\n                <span></span>\n              </div>\n              <div className={`flex items-center transition-colors ${\n                passwordValidation.hasNumbers \n                  ? 'text-green-600 dark:text-green-400' \n                  : 'text-gray-400 dark:text-gray-500'\n              }`}>\n                <CheckCircle className=\"w-4 h-4 mr-2\" />\n                <span></span>\n              </div>\n              <div className={`flex items-center transition-colors ${\n                passwordValidation.hasSpecialChar \n                  ? 'text-green-600 dark:text-green-400' \n                  : 'text-gray-400 dark:text-gray-500'\n              }`}>\n                <CheckCircle className=\"w-4 h-4 mr-2\" />\n                <span> (!@#$%^&*)</span>\n              </div>\n            </div>\n          </div>\n\n          {confirmPassword.length > 0 && (\n            <div className={`flex items-center text-sm transition-colors ${\n              passwordsMatch \n                ? 'text-green-600 dark:text-green-400' \n                : 'text-red-600 dark:text-red-400'\n            }`}>\n              <CheckCircle className=\"w-4 h-4 mr-2\" />\n              <span>{passwordsMatch ? '' : ''}</span>\n            </div>\n          )}\n\n          {error && (\n            <div className=\"flex items-center space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 transition-colors\">\n              <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\n              <span className=\"text-sm\">{error}</span>\n            </div>\n          )}\n\n          <button\n            type=\"submit\"\n            disabled={loading || !passwordValidation.isValid || !passwordsMatch}\n            className=\"\n              w-full bg-orange-600 dark:bg-orange-700 text-white py-3 px-4 rounded-lg \n              hover:bg-orange-700 dark:hover:bg-orange-600 \n              focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800 \n              transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium\n            \"\n          >\n            {loading ? '...' : ''}\n          </button>\n        </form>\n\n        <div className=\"mt-6 text-center\">\n          <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 mb-3\">\n            <p className=\"text-sm text-green-700 dark:text-green-300 font-medium\"></p>\n          </div>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\"></p>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useState, useEffect } from 'react';\nimport { Users, Sparkles, ArrowRight, Clock, CheckCircle2 } from 'lucide-react';\nimport confetti from 'canvas-confetti';\n\ninterface WelcomePageProps {\n  onContinue: () => void;\n}\n\n\n\n\ninterface InvitationData {\n  email: string;\n  name: string;\n  role: string;\n  team_name?: string;\n  organization_name?: string;\n  invited_by_name?: string;\n  expires_at: string;\n}\n\nexport function WelcomePage({ onContinue }: WelcomePageProps) {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [invitationData, setInvitationData] = useState<InvitationData | null>(null);\n  const [animationStep, setAnimationStep] = useState(0);\n\n  //  URL  token /welcome?token=xxx\n  const url = new URL(window.location.href);\n  const token = url.searchParams.get('token') ?? '';\n\n  useEffect(() => {\n    const fetchInvitationData = async () => {\n      try {\n        if (!token) {\n          setError('URL token ');\n          setLoading(false);\n          return;\n        }\n\n        console.log(' Fetching invitation with token:', token);\n        console.log(' Supabase URL:', import.meta.env.VITE_SUPABASE_URL);\n\n        const response = await fetch(\n          `${import.meta.env.VITE_SUPABASE_URL}/rest/v1/invitation_tokens?token=eq.${token}&select=email,name,role,team_id,organization_id,invited_by,expires_at`,\n          {\n            headers: {\n              apikey: import.meta.env.VITE_SUPABASE_ANON_KEY,\n              Authorization: `Bearer ${import.meta.env.VITE_SUPABASE_ANON_KEY}`,\n              'Content-Type': 'application/json',\n              Prefer: 'return=representation',\n            },\n          },\n        );\n\n        console.log(' Response status:', response.status);\n\n        if (!response.ok) {\n          const errorText = await response.text();\n          console.error(' API Error:', errorText);\n          setError(` (${response.status})`);\n          setLoading(false);\n          return;\n        }\n\n        const data = await response.json();\n        console.log(' Received data:', data);\n\n        if (!data || data.length === 0) {\n          console.warn(' No invitation found for token');\n          setError('');\n          setLoading(false);\n          return;\n        }\n\n        const invitation = data[0];\n        console.log(' Invitation found:', invitation);\n\n        let teamName: string | undefined = undefined;\n        if (invitation.team_id) {\n          console.log(' Fetching team info for:', invitation.team_id);\n          const teamResponse = await fetch(\n            `${import.meta.env.VITE_SUPABASE_URL}/rest/v1/teams?id=eq.${invitation.team_id}&select=name`,\n            {\n              headers: {\n                apikey: import.meta.env.VITE_SUPABASE_ANON_KEY,\n                Authorization: `Bearer ${import.meta.env.VITE_SUPABASE_ANON_KEY}`,\n                'Content-Type': 'application/json',\n              },\n            },\n          );\n\n          if (teamResponse.ok) {\n            const teamData = await teamResponse.json();\n            if (teamData && teamData.length > 0) {\n              teamName = teamData[0].name;\n              console.log(' Team found:', teamName);\n            }\n          }\n        }\n\n        let organizationName: string | undefined = undefined;\n        if (invitation.organization_id) {\n          console.log(' Fetching organization info for:', invitation.organization_id);\n          const orgResponse = await fetch(\n            `${import.meta.env.VITE_SUPABASE_URL}/rest/v1/organizations?id=eq.${invitation.organization_id}&select=name`,\n            {\n              headers: {\n                apikey: import.meta.env.VITE_SUPABASE_ANON_KEY,\n                Authorization: `Bearer ${import.meta.env.VITE_SUPABASE_ANON_KEY}`,\n                'Content-Type': 'application/json',\n              },\n            },\n          );\n\n          if (orgResponse.ok) {\n            const orgData = await orgResponse.json();\n            if (orgData && orgData.length > 0) {\n              organizationName = orgData[0].name;\n              console.log(' Organization found:', organizationName);\n            }\n          }\n        }\n\n        setInvitationData({\n          email: invitation.email,\n          name: invitation.name,\n          role: invitation.role,\n          team_name: teamName,\n          organization_name: organizationName,\n          expires_at: invitation.expires_at,\n        });\n\n        setLoading(false);\n\n        setTimeout(() => setAnimationStep(1), 100);\n        setTimeout(() => setAnimationStep(2), 400);\n        setTimeout(() => setAnimationStep(3), 800);\n\n        setTimeout(() => {\n          confetti({\n            particleCount: 100,\n            spread: 70,\n            origin: { y: 0.6 },\n          });\n        }, 1200);\n      } catch (err) {\n        console.error(' Error fetching invitation:', err);\n        setError('');\n        setLoading(false);\n      }\n    };\n\n    fetchInvitationData();\n  }, [token]);\n\n  const handleContinue = () => {\n    if (invitationData) {\n      confetti({\n        particleCount: 50,\n        angle: 60,\n        spread: 55,\n        origin: { x: 0 },\n      });\n      confetti({\n        particleCount: 50,\n        angle: 120,\n        spread: 55,\n        origin: { x: 1 },\n      });\n\n      setTimeout(() => {\n        //   onContinue() \n        // App.tsx  /auth/callback?next=... \n        onContinue();\n      }, 500);\n    }\n  };\n\n  const getRoleDisplay = (role: string) => {\n    switch (role) {\n      case 'athlete':\n        return '';\n      case 'staff':\n        return '';\n      case 'global_admin':\n        return '';\n      default:\n        return role;\n    }\n  };\n\n  const getTimeRemaining = (expiresAt: string) => {\n    const now = new Date();\n    const expiry = new Date(expiresAt);\n    const diffMs = expiry.getTime() - now.getTime();\n    const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffMins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n\n    if (diffHrs > 0) return `${diffHrs}`;\n    if (diffMins > 0) return `${diffMins}`;\n    return '';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 dark:border-blue-400 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600 dark:text-gray-300 text-lg\">...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !invitationData) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-900 dark:to-red-900 flex items-center justify-center p-4 transition-colors\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full text-center\">\n          <div className=\"bg-red-100 dark:bg-red-900 rounded-full p-4 w-16 h-16 mx-auto mb-4\">\n            <Clock className=\"w-8 h-8 text-red-600 dark:text-red-400\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\"></h1>\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\n            {error || ''}\n          </p>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            \n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-4 transition-colors overflow-hidden\">\n      <div className=\"max-w-2xl w-full\">\n        <div\n          className={`bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden transform transition-all duration-700 ${\n            animationStep >= 1 ? 'opacity-100 scale-100' : 'opacity-0 scale-95'\n          }`}\n        >\n          <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 px-8 py-12 text-center relative overflow-hidden\">\n            <div className=\"absolute inset-0 bg-white dark:bg-gray-900 opacity-10\">\n              <div\n                className=\"absolute top-0 left-0 w-full h-full\"\n                style={{\n                  backgroundImage: 'radial-gradient(circle, white 1px, transparent 1px)',\n                  backgroundSize: '30px 30px',\n                }}\n              />\n            </div>\n\n            <div\n              className={`transform transition-all duration-700 delay-200 ${\n                animationStep >= 2 ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'\n              }`}\n            >\n              <div className=\"bg-white dark:bg-gray-800 rounded-full p-4 w-20 h-20 mx-auto mb-6 shadow-lg\">\n                <Sparkles className=\"w-12 h-12 text-indigo-600 dark:text-indigo-400\" />\n              </div>\n\n              <h1 className=\"text-4xl font-bold text-white mb-3\">{invitationData.name}</h1>\n\n              {(invitationData.organization_name || invitationData.team_name) && (\n                <div className=\"space-y-2\">\n                  {invitationData.organization_name && (\n                    <div className=\"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg\">\n                      <Users className=\"w-5 h-5\" />\n                      <span className=\"font-semibold\">{invitationData.organization_name}</span>\n                      {invitationData.team_name && <span>-</span>}\n                      {invitationData.team_name && <span className=\"font-semibold\">{invitationData.team_name}</span>}\n                      <span></span>\n                    </div>\n                  )}\n                  {!invitationData.organization_name && invitationData.team_name && (\n                    <div className=\"flex items-center justify-center space-x-2 text-blue-100 dark:text-blue-200 text-lg\">\n                      <Users className=\"w-5 h-5\" />\n                      <span className=\"font-semibold\">{invitationData.team_name}</span>\n                      <span></span>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              <p className=\"text-blue-100 dark:text-blue-200 text-lg mt-2\">Bekuta </p>\n            </div>\n          </div>\n\n          <div className=\"px-8 py-10\">\n            <div\n              className={`transform transition-all duration-700 delay-400 ${\n                animationStep >= 3 ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'\n              }`}\n            >\n              <div className=\"space-y-6 mb-8\">\n                <div className=\"flex items-start space-x-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl\">\n                  <div className=\"flex-shrink-0 mt-1\">\n                    <CheckCircle2 className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900 dark:text-white mb-1\"></h3>\n                    <p className=\"text-gray-600 dark:text-gray-300\">{getRoleDisplay(invitationData.role)}</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start space-x-4 p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl\">\n                  <div className=\"flex-shrink-0 mt-1\">\n                    <CheckCircle2 className=\"w-6 h-6 text-indigo-600 dark:text-indigo-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900 dark:text-white mb-1\"></h3>\n                    <p className=\"text-gray-600 dark:text-gray-300\">{invitationData.email}</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start space-x-4 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl\">\n                  <div className=\"flex-shrink-0 mt-1\">\n                    <Clock className=\"w-6 h-6 text-amber-600 dark:text-amber-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900 dark:text-white mb-1\"></h3>\n                    <p className=\"text-gray-600 dark:text-gray-300\">{getTimeRemaining(invitationData.expires_at)}</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-8\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3 text-center\"></h3>\n                <ol className=\"space-y-2 text-gray-600 dark:text-gray-300 text-sm\">\n                  <li className=\"flex items-start space-x-2\">\n                    <span className=\"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold\">\n                      1\n                    </span>\n                    <span></span>\n                  </li>\n                  <li className=\"flex items-start space-x-2\">\n                    <span className=\"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold\">\n                      2\n                    </span>\n                    <span></span>\n                  </li>\n                  <li className=\"flex items-start space-x-2\">\n                    <span className=\"flex-shrink-0 w-6 h-6 bg-blue-600 dark:bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold\">\n                      3\n                    </span>\n                    <span></span>\n                  </li>\n                </ol>\n              </div>\n\n              <button\n                onClick={handleContinue}\n                className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 text-white py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 dark:hover:from-blue-600 dark:hover:to-indigo-600 transition-all duration-300 font-semibold text-lg flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105\"\n              >\n                <span></span>\n                <ArrowRight className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <p className=\"text-center text-sm text-gray-600 dark:text-gray-400 mt-6\">\n          \n        </p>\n      </div>\n    </div>\n  );\n}","import React, { useEffect } from 'react';\nimport { AlertTriangle, X } from 'lucide-react';\n\ninterface GenericDuplicateModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onOverwrite: () => void;\n  onCancel: () => void;\n  title: string;\n  date: string;\n  existingValues: { label: string; value: string }[];\n  newValues: { label: string; value: string }[];\n}\n\nexport function GenericDuplicateModal({\n  isOpen,\n  onClose,\n  onOverwrite,\n  onCancel,\n  title,\n  date,\n  existingValues,\n  newValues\n}: GenericDuplicateModalProps) {\n\n  //  iOS\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const prevOverflow = document.body.style.overflow;\n    const prevTouchAction = document.body.style.touchAction;\n\n    document.body.style.overflow = 'hidden';\n    document.body.style.touchAction = 'none';\n\n    return () => {\n      document.body.style.overflow = prevOverflow;\n      document.body.style.touchAction = prevTouchAction;\n    };\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 overscroll-contain\">\n      {/*   */}\n      <div\n        className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[85vh] overflow-y-auto\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"flex items-center justify-between p-6 border-b dark:border-gray-700\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"flex-shrink-0 w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center\">\n              <AlertTriangle className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\n            </div>\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              \n            </h3>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n            type=\"button\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        <div className=\"p-6\">\n          <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n            \n          </p>\n\n          <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 mb-4\">\n            <div className=\"space-y-3\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1\"></p>\n                <p className=\"text-base text-gray-900 dark:text-white\">{title}</p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1\"></p>\n                <p className=\"text-base text-gray-900 dark:text-white\">\n                  {new Date(date).toLocaleDateString('ja-JP')}\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 pt-3 border-t border-gray-200 dark:border-gray-700\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2\"></p>\n                  <div className=\"space-y-1\">\n                    {existingValues.map((item, index) => (\n                      <div key={index}>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">{item.label}</p>\n                        <p className=\"text-base font-semibold text-gray-900 dark:text-white\">\n                          {item.value}\n                        </p>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                <div>\n                  <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2\"></p>\n                  <div className=\"space-y-1\">\n                    {newValues.map((item, index) => (\n                      <div key={index}>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">{item.label}</p>\n                        <p className=\"text-base font-semibold text-blue-600 dark:text-blue-400\">\n                          {item.value}\n                        </p>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n\n          <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4\">\n            <p className=\"text-sm text-yellow-800 dark:text-yellow-200\">\n              \n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center justify-end space-x-3 p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-lg\">\n          <button\n            onClick={onCancel}\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n            type=\"button\"\n          >\n            \n          </button>\n          <button\n            onClick={onOverwrite}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors\"\n            type=\"button\"\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useEffect, useMemo, useRef, useState } from 'react';\n\ntype Props = {\n  value: number; // 0..100\n  onChange: (v: number) => void;\n  label?: string;\n  hint?: string;\n};\n\nconst clamp = (n: number, min: number, max: number) =>\n  Math.max(min, Math.min(max, n));\n\nexport function VectorArrowPicker({\n  value,\n  onChange,\n  label = '',\n  hint = '',\n}: Props) {\n  const boxRef = useRef<HTMLDivElement | null>(null);\n  const draggingRef = useRef(false);\n  const [isDragging, setIsDragging] = useState(false);\n\n  const v = clamp(Math.round(value), 0, 100);\n\n  // \n  const level = useMemo(() => {\n    if (v === 0) return 0;\n    if (v <= 20) return 1;\n    if (v <= 40) return 2;\n    if (v <= 60) return 3;\n    if (v <= 80) return 4;\n    return 5;\n  }, [v]);\n\n  const levelLabel = useMemo(() => {\n    switch (level) {\n      case 0: return '';\n      case 1: return '';\n      case 2: return '';\n      case 3: return '';\n      case 4: return '';\n      case 5: return '';\n      default: return '';\n    }\n  }, [level]);\n\n  const geom = useMemo(() => {\n    const minLen = 18;\n    const maxLen = 220;\n    const minW = 2.5;\n    const maxW = 14;\n\n    const len = minLen + (maxLen - minLen) * (v / 100);\n    const stroke = minW + (maxW - minW) * (v / 100);\n\n    const x0 = 24;\n    const y = 70;\n    const x1 = x0 + len;\n    const head = 10 + stroke * 1.2;\n\n    return { x0, y, x1, stroke, head };\n  }, [v]);\n\n  const setFromPointer = (clientX: number) => {\n    const el = boxRef.current;\n    if (!el) return;\n    const rect = el.getBoundingClientRect();\n    const leftPad = 24;\n    const rightPad = 24;\n\n    const x = clamp(clientX - rect.left, leftPad, rect.width - rightPad);\n    const usable = rect.width - leftPad - rightPad;\n\n    const next = Math.round(((x - leftPad) / usable) * 100);\n    onChange(clamp(next, 0, 100));\n  };\n\n  const onPointerDown = (e: React.PointerEvent) => {\n    draggingRef.current = true;\n    setIsDragging(true);\n    (e.currentTarget as any).setPointerCapture?.(e.pointerId);\n    setFromPointer(e.clientX);\n  };\n\n  const onPointerMove = (e: React.PointerEvent) => {\n    if (!draggingRef.current) return;\n    setFromPointer(e.clientX);\n  };\n\n  const stop = () => {\n    draggingRef.current = false;\n    setIsDragging(false);\n  };\n\n  useEffect(() => {\n    const onUp = () => stop();\n    window.addEventListener('pointerup', onUp);\n    window.addEventListener('pointercancel', onUp);\n    return () => {\n      window.removeEventListener('pointerup', onUp);\n      window.removeEventListener('pointercancel', onUp);\n    };\n  }, []);\n\n  return (\n    <div className=\"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4\">\n      {/*   +  +  */}\n      <div className=\"flex items-start justify-between gap-3\">\n        <div className=\"min-w-0\">\n          <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n            {label}\n          </div>\n          <div className=\"text-xs text-gray-500 dark:text-gray-300 mt-1\">\n            {hint}\n          </div>\n        </div>\n\n        <div className=\"text-right\">\n          <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n            {levelLabel}\n          </div>\n        </div>\n      </div>\n\n      <div\n        ref={boxRef}\n        className={`mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none ${\n          isDragging ? 'ring-2 ring-blue-500' : ''\n        }`}\n        onPointerDown={onPointerDown}\n        onPointerMove={onPointerMove}\n        style={{ touchAction: 'none', WebkitTapHighlightColor: 'transparent' }}\n      >\n      <svg viewBox=\"0 0 300 140\" className=\"w-full h-20\">\n        <line x1=\"24\" y1=\"70\" x2=\"276\" y2=\"70\" stroke=\"currentColor\" opacity=\"0.10\" strokeWidth=\"2\" />\n\n        {/*  */}\n        {(() => {\n          const xTip = geom.x1;\n          const y = geom.y;\n\n          // \n          const headLen = Math.max(14, geom.stroke * 2.2);\n          const headHalfH = Math.max(10, geom.stroke * 1.2);\n\n          // \n          const xShaftEnd = xTip - headLen;\n\n          return (\n            <>\n              {/*  */}\n              <line\n                x1={geom.x0}\n                y1={y}\n                x2={xShaftEnd}\n                y2={y}\n                stroke=\"currentColor\"\n                className=\"text-blue-600 dark:text-blue-400\"\n                strokeWidth={geom.stroke}\n                strokeLinecap=\"butt\"          //  \n              />\n\n              {/*  */}\n              <polygon\n                points={`\n                  ${xTip},${y}\n                  ${xShaftEnd},${y - headHalfH}\n                  ${xShaftEnd},${y + headHalfH}\n                `}\n                fill=\"currentColor\"\n                className=\"text-blue-600 dark:text-blue-400\"\n              />\n\n              {/*   */}\n              <circle\n                cx={xTip}\n                cy={y}\n                r={18}\n                fill=\"transparent\"\n                pointerEvents=\"all\"\n              />\n            </>\n          );\n        })()}\n      </svg>\n      </div>\n    </div>\n  );\n}","import React, { useEffect, useMemo, useRef, useState } from 'react';\n\ntype Props = {\n  value: number; // 0..100\n  onChange: (v: number) => void;\n  label?: string;\n  hint?: string;\n};\n\nconst clamp = (n: number, min: number, max: number) => Math.max(min, Math.min(max, n));\n\nexport function SignalPicker({\n  value,\n  onChange,\n  label = '',\n  hint = '(/)',\n}: Props) {\n  const boxRef = useRef<HTMLDivElement | null>(null);\n  const draggingRef = useRef(false);\n  const [isDragging, setIsDragging] = useState(false);\n\n  const v = clamp(Math.round(value), 0, 100);\n\n  const level = useMemo(() => {\n    if (v === 0) return 0;\n    if (v <= 20) return 1;\n    if (v <= 40) return 2;\n    if (v <= 60) return 3;\n    if (v <= 80) return 4;\n    return 5;\n  }, [v]);\n\n  const levelLabel = useMemo(() => {\n    switch (level) {\n      case 0: return '';\n      case 1: return '';\n      case 2: return '';\n      case 3: return '';\n      case 4: return '';\n      case 5: return '';\n      default: return '';\n    }\n  }, [level]);\n\n  const bars = useMemo(() => {\n    const baseHeights = [18, 30, 44, 60, 78];\n    const scale = 1 + (v / 100) * 0.18;\n    const cont = (v / 100) * 5;\n\n    return baseHeights.map((h, i) => {\n      const lit = clamp(cont - i, 0, 1);\n      return {\n        height: Math.round(h * scale),\n        lit,\n      };\n    });\n  }, [v]);\n\n  const setFromPointer = (clientX: number) => {\n    const el = boxRef.current;\n    if (!el) return;\n\n    const rect = el.getBoundingClientRect();\n    const leftPad = 16;\n    const rightPad = 16;\n\n    const x = clamp(clientX - rect.left, leftPad, rect.width - rightPad);\n    const usable = rect.width - leftPad - rightPad;\n\n    const next = Math.round(((x - leftPad) / usable) * 100);\n    onChange(clamp(next, 0, 100));\n  };\n\n  const onPointerDown = (e: React.PointerEvent) => {\n    draggingRef.current = true;\n    setIsDragging(true);\n    (e.currentTarget as any).setPointerCapture?.(e.pointerId);\n    setFromPointer(e.clientX);\n  };\n\n  const onPointerMove = (e: React.PointerEvent) => {\n    if (!draggingRef.current) return;\n    setFromPointer(e.clientX);\n  };\n\n  const stop = () => {\n    draggingRef.current = false;\n    setIsDragging(false);\n  };\n\n  useEffect(() => {\n    const onUp = () => stop();\n    window.addEventListener('pointerup', onUp);\n    window.addEventListener('pointercancel', onUp);\n    return () => {\n      window.removeEventListener('pointerup', onUp);\n      window.removeEventListener('pointercancel', onUp);\n    };\n  }, []);\n\n  return (\n    <div className=\"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4\">\n      {/*   +  +  */}\n      <div className=\"flex items-start justify-between gap-3\">\n        <div className=\"min-w-0\">\n          <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n            {label}\n          </div>\n          <div className=\"text-xs text-gray-500 dark:text-gray-300 mt-1\">\n            {hint}\n          </div>\n        </div>\n\n        <div className=\"text-right\">\n          <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n            {levelLabel}\n          </div>\n        </div>\n      </div>\n\n      <div\n        ref={boxRef}\n        className={`mt-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/40 p-3 select-none ${\n          isDragging ? 'ring-2 ring-blue-500' : ''\n        }`}\n        onPointerDown={onPointerDown}\n        onPointerMove={onPointerMove}\n        style={{ touchAction: 'none', WebkitTapHighlightColor: 'transparent' }}\n      >\n        <div className=\"flex items-end justify-center gap-3 h-24\">\n          {bars.map((b, i) => {\n            const opacity = 0.25 + b.lit * 0.75;\n            const width = 10 + b.lit * 8;\n            return (\n              <div key={i} className=\"flex flex-col items-center gap-2\">\n                <div\n                  className=\"rounded-full bg-blue-600 dark:bg-blue-400\"\n                  style={{\n                    height: b.height,\n                    width,\n                    opacity,\n                    transition: 'height 120ms ease, width 120ms ease, opacity 120ms ease',\n                  }}\n                />\n              </div>\n            );\n          })}\n        </div>\n\n       \n      </div>\n    </div>\n  );\n}","import React, { useEffect } from \"react\";\nimport { CheckCircle2, AlertTriangle, X } from \"lucide-react\";\n\ntype ToastType = \"success\" | \"error\" | \"info\";\n\nexport function Toast({\n  open,\n  message,\n  type = \"success\",\n  durationMs = 1800,\n  onClose,\n}: {\n  open: boolean;\n  message: string;\n  type?: ToastType;\n  durationMs?: number;\n  onClose: () => void;\n}) {\n  useEffect(() => {\n    if (!open) return;\n    const t = window.setTimeout(onClose, durationMs);\n    return () => window.clearTimeout(t);\n  }, [open, durationMs, onClose]);\n\n  if (!open) return null;\n\n  const isSuccess = type === \"success\";\n  const isError = type === \"error\";\n\n  return (\n    <div className=\"fixed bottom-5 left-1/2 -translate-x-1/2 z-[80] px-4\">\n      <div\n        className={[\n          \"flex items-center gap-3 rounded-xl shadow-xl border px-4 py-3 w-[min(92vw,420px)]\",\n          \"bg-white dark:bg-gray-900\",\n          isSuccess\n            ? \"border-green-200 dark:border-green-900/40\"\n            : isError\n            ? \"border-red-200 dark:border-red-900/40\"\n            : \"border-gray-200 dark:border-gray-700\",\n        ].join(\" \")}\n        role=\"status\"\n        aria-live=\"polite\"\n      >\n        {isSuccess ? (\n          <CheckCircle2 className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n        ) : isError ? (\n          <AlertTriangle className=\"w-5 h-5 text-red-600 dark:text-red-400\" />\n        ) : (\n          <CheckCircle2 className=\"w-5 h-5 text-gray-600 dark:text-gray-300\" />\n        )}\n\n        <div className=\"flex-1 text-sm text-gray-900 dark:text-gray-100\">{message}</div>\n\n        <button\n          type=\"button\"\n          onClick={onClose}\n          className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\"\n          aria-label=\"\"\n        >\n          <X className=\"w-4 h-4\" />\n        </button>\n      </div>\n    </div>\n  );\n}","import React, { useState, useEffect } from 'react';\nimport { Plus, Clock, Zap, Calendar, AlertCircle, CheckCircle, Sparkles } from 'lucide-react';\nimport confetti from 'canvas-confetti';\nimport { getDataEntryFeedback, ProgressFeedback } from '../lib/acwrProgressFeedback';\nimport { TrainingRecord } from '../lib/supabase';\nimport { GenericDuplicateModal } from './GenericDuplicateModal';\nimport { VectorArrowPicker } from '../components/VectorArrowPicker';\nimport { SignalPicker } from './SignalPicker';\nimport type { TrainingRecordForm } from '../lib/normalizeRecords';\nimport { Toast } from './ui/Toast'; //  \n\ninterface TrainingFormProps {\n  userId: string;\n\n  onSubmit: (data: {\n    rpe: number;\n    duration_min: number;\n    date: string;\n    arrow_score: number;\n    signal_score: number;\n  }) => Promise<void>;\n\n  onCheckExisting: (date: string) => Promise<TrainingRecord | null>;\n\n  onUpdate: (\n    recordId: string,\n    data: { rpe: number; duration_min: number; arrow_score: number; signal_score: number }\n  ) => Promise<void>;\n\n  loading: boolean;\n  lastRecord?: TrainingRecordForm | null;\n\n  weeklyAverage?: { rpe: number; duration: number; load: number } | null;\n  daysWithData?: number;\n  consecutiveDays?: number;\n}\n\n//  YYYY-MM-DD \nconst getTodayLocalDateString = () => {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0');\n  const day = String(now.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\nexport function TrainingForm({\n  userId,\n  onSubmit,\n  onCheckExisting,\n  onUpdate,\n  loading,\n  lastRecord,\n  weeklyAverage,\n  daysWithData = 0,\n  consecutiveDays = 0,\n}: TrainingFormProps) {\n  const today = getTodayLocalDateString();\n\n  const [rpe, setRpe] = useState<number>(0); // 0 = \n  const [duration, setDuration] = useState<number>(0);\n  const [selectedDate, setSelectedDate] = useState<string>(today);\n\n  const [arrowScore, setArrowScore] = useState<number>(50);\n  const [signalScore, setSignalScore] = useState<number>(50);\n\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string>('');\n  const [warning, setWarning] = useState<string>('');\n  const [successFeedback, setSuccessFeedback] = useState<ProgressFeedback | null>(null);\n\n  const [showDuplicateModal, setShowDuplicateModal] = useState(false);\n  const [existingRecord, setExistingRecord] = useState<TrainingRecord | null>(null);\n  const [pendingData, setPendingData] = useState<{\n    rpe: number;\n    duration_min: number;\n    date: string;\n    arrow_score: number;\n    signal_score: number;\n  } | null>(null);\n\n  //  Toast\n  const [toastOpen, setToastOpen] = useState(false);\n  const [toastType, setToastType] = useState<'success' | 'error'>('success');\n  const [toastMsg, setToastMsg] = useState('');\n\n  const showToast = (type: 'success' | 'error', msg: string) => {\n    setToastType(type);\n    setToastMsg(msg);\n    setToastOpen(true);\n  };\n\n  const resetForm = () => {\n    setRpe(0);\n    setDuration(0);\n    setArrowScore(50);\n    setSignalScore(50);\n    setSelectedDate(today);\n  };\n\n  const applySuccessEffects = () => {\n    // 1\n    const feedback = getDataEntryFeedback(daysWithData + 1, consecutiveDays + 1);\n    if (feedback) {\n      setSuccessFeedback(feedback);\n      if (feedback.showConfetti) {\n        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });\n      }\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (submitting || loading) return; //  \n    setError('');\n\n    // \n    if (rpe === 0 && duration > 0) {\n      setError('RPE 0 0 ');\n      showToast('error', '');\n      return;\n    }\n    if (rpe > 0 && duration === 0) {\n      setError('RPE  1  1 ');\n      showToast('error', ' 0 ');\n      return;\n    }\n\n    // \n    try {\n      const existing = await onCheckExisting(selectedDate);\n      if (existing) {\n        setExistingRecord(existing);\n        setPendingData({\n          rpe,\n          duration_min: duration,\n          date: selectedDate,\n          arrow_score: arrowScore,\n          signal_score: signalScore,\n        });\n        setShowDuplicateModal(true);\n        return;\n      }\n    } catch (err) {\n      console.error('Error checking existing training record:', err);\n      setError('');\n      showToast('error', '');\n      return;\n    }\n\n    setSubmitting(true);\n\n    try {\n      await onSubmit({\n        rpe,\n        duration_min: duration,\n        date: selectedDate,\n        arrow_score: arrowScore,\n        signal_score: signalScore,\n      });\n\n      applySuccessEffects();\n\n      //  Toast\n      showToast('success', ' ');\n\n      resetForm();\n    } catch (error) {\n      console.error('Error submitting training record:', error);\n      if (error instanceof Error) {\n        if (error.message.includes('duplicate key value violates unique constraint')) {\n          const msg = `${new Date(selectedDate).toLocaleDateString('ja-JP')}`;\n          setError(msg);\n          showToast('error', msg);\n        } else {\n          setError(error.message || '');\n          showToast('error', error.message || '');\n        }\n      } else {\n        setError('');\n        showToast('error', '');\n      }\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleOverwrite = async () => {\n    if (!existingRecord || !pendingData) return;\n    if (submitting || loading) return;\n\n    setSubmitting(true);\n    setShowDuplicateModal(false);\n    setError('');\n\n    try {\n      await onUpdate(existingRecord.id, {\n        rpe: pendingData.rpe,\n        duration_min: pendingData.duration_min,\n        arrow_score: pendingData.arrow_score,\n        signal_score: pendingData.signal_score,\n      });\n\n      applySuccessEffects();\n\n      //  Toast\n      showToast('success', ' ');\n\n      resetForm();\n\n      setExistingRecord(null);\n      setPendingData(null);\n    } catch (error) {\n      console.error('Error updating record:', error);\n      setError('');\n      showToast('error', '');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleCancelOverwrite = () => {\n    setShowDuplicateModal(false);\n    setExistingRecord(null);\n    setPendingData(null);\n  };\n\n  const checkForWarnings = (currentRpe: number, currentDuration: number) => {\n    if (currentRpe === 0 || currentDuration === 0) {\n      setWarning('');\n      return;\n    }\n    const currentLoad = currentRpe * currentDuration;\n    if (weeklyAverage && currentLoad > weeklyAverage.load * 2) {\n      setWarning('2');\n    } else if (weeklyAverage && currentLoad > weeklyAverage.load * 1.5) {\n      setWarning('');\n    } else if (currentLoad > 1000) {\n      setWarning('');\n    } else {\n      setWarning('');\n    }\n  };\n\n  const handleRpeChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newRpe = Number(e.target.value);\n    setRpe(newRpe);\n    checkForWarnings(newRpe, duration);\n  };\n\n  const handleDurationChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newDuration = Number(e.target.value);\n    setDuration(newDuration);\n    checkForWarnings(rpe, newDuration);\n  };\n\n  const rpeLabels = [\n    '0 - ',\n    '1 - ',\n    '2 - ',\n    '3 - ',\n    '4 - ',\n    '5 - ',\n    '6 - ',\n    '7 - ',\n    '8 - ',\n    '9 - ',\n    '10 -  ()',\n  ];\n\n  useEffect(() => {\n    if (!successFeedback) return;\n    const timer = setTimeout(() => setSuccessFeedback(null), 5000);\n    return () => clearTimeout(timer);\n  }, [successFeedback]);\n\n  const loadValue = rpe * duration;\n\n  return (\n    <>\n      {/*  Toast */}\n      <Toast open={toastOpen} type={toastType} message={toastMsg} onClose={() => setToastOpen(false)} />\n\n      <GenericDuplicateModal\n        isOpen={showDuplicateModal}\n        onClose={handleCancelOverwrite}\n        onOverwrite={handleOverwrite}\n        onCancel={handleCancelOverwrite}\n        title=\"\"\n        date={selectedDate}\n        existingValues={[\n          { label: 'RPE', value: existingRecord?.rpe?.toString() || '-' },\n          { label: '', value: `${existingRecord?.duration_min || 0}` },\n          { label: '', value: `${(existingRecord as any)?.arrow_score ?? '-'} / 100` },\n          { label: '', value: `${(existingRecord as any)?.signal_score ?? '-'} / 100` },\n        ]}\n        newValues={[\n          { label: 'RPE', value: pendingData?.rpe?.toString() || '-' },\n          { label: '', value: `${pendingData?.duration_min || 0}` },\n          { label: '', value: `${pendingData?.arrow_score ?? '-'} / 100` },\n          { label: '', value: `${pendingData?.signal_score ?? '-'} / 100` },\n        ]}\n      />\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {successFeedback && (\n          <div\n            className={`rounded-lg border-2 p-4 animate-in slide-in-from-top-2 duration-300 ${\n              successFeedback.type === 'milestone'\n                ? 'bg-green-50 dark:bg-green-900/20 border-green-500 dark:border-green-700'\n                : successFeedback.type === 'success'\n                ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-500 dark:border-blue-700'\n                : 'bg-purple-50 dark:bg-purple-900/20 border-purple-500 dark:border-purple-700'\n            }`}\n          >\n            <div className=\"flex items-start gap-3\">\n              {successFeedback.type === 'milestone' ? (\n                <CheckCircle className=\"w-6 h-6 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5\" />\n              ) : (\n                <Sparkles className=\"w-6 h-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\n              )}\n              <div className=\"flex-1 min-w-0\">\n                <h4\n                  className={`font-semibold text-base mb-1 ${\n                    successFeedback.type === 'milestone'\n                      ? 'text-green-700 dark:text-green-300'\n                      : successFeedback.type === 'success'\n                      ? 'text-blue-700 dark:text-blue-300'\n                      : 'text-purple-700 dark:text-purple-300'\n                  }`}\n                >\n                  {successFeedback.title}\n                </h4>\n                <p\n                  className={`text-sm ${\n                    successFeedback.type === 'milestone'\n                      ? 'text-green-600 dark:text-green-400'\n                      : successFeedback.type === 'success'\n                      ? 'text-blue-600 dark:text-blue-400'\n                      : 'text-purple-600 dark:text-purple-400'\n                  }`}\n                >\n                  {successFeedback.message}\n                </p>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {lastRecord && (\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-sm\">\n            <p className=\"text-blue-600 dark:text-blue-400 mb-1\"></p>\n            <p className=\"text-blue-700 dark:text-blue-300\">\n              RPE {lastRecord.rpe ?? '-'}  {lastRecord.duration_min ?? '-'} = {' '}\n              {(lastRecord.rpe ?? 0) * (lastRecord.duration_min ?? 0)}\n            </p>\n          </div>\n        )}\n\n        {/*  */}\n        <div>\n          <label className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            <Calendar className=\"w-4 h-4 mr-2\" />\n            \n          </label>\n          <input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            disabled={submitting || loading}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60\"\n          />\n        </div>\n\n        {/* RPE */}\n        <div>\n          <label className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            <Zap className=\"w-4 h-4 mr-2\" />\n            RPE\n          </label>\n\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"10\"\n            value={rpe}\n            onChange={handleRpeChange}\n            disabled={submitting || loading}\n            className=\"w-full\"\n          />\n\n          <div className=\"mt-2 text-sm text-gray-700 dark:text-gray-200\">{rpeLabels[rpe]}</div>\n        </div>\n\n        {/*  */}\n        <div>\n          <label className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            <Clock className=\"w-4 h-4 mr-2\" />\n            \n          </label>\n          <input\n            type=\"number\"\n            min=\"0\"\n            max=\"480\"\n            value={duration}\n            onChange={handleDurationChange}\n            disabled={submitting || loading}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 disabled:opacity-60\"\n            style={{ fontSize: '16px' }}\n          />\n          <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\"> RPE=0 / =0</p>\n        </div>\n\n        {/*  */}\n        <div className=\"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm text-gray-600 dark:text-gray-300\"></span>\n            <span className=\"text-lg font-semibold text-gray-900 dark:text-white\">{loadValue}</span>\n          </div>\n        </div>\n\n        {/*  /  */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4\">\n            <VectorArrowPicker value={arrowScore} onChange={setArrowScore} />\n            <div className=\"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center\">\n              : {arrowScore}/100\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 dark:bg-gray-800/60 rounded-lg p-4\">\n            <SignalPicker value={signalScore} onChange={setSignalScore} />\n            <div className=\"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center\">\n              : {signalScore}/100\n            </div>\n          </div>\n        </div>\n\n        {/* warning / error */}\n        {warning && (\n          <div className=\"flex items-center gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg text-yellow-700 dark:text-yellow-300\">\n            <AlertCircle className=\"w-4 h-4\" />\n            <span className=\"text-sm\">{warning}</span>\n          </div>\n        )}\n\n        {error && (\n          <div className=\"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300\">\n            <AlertCircle className=\"w-4 h-4\" />\n            <span className=\"text-sm\">{error}</span>\n          </div>\n        )}\n\n        {/*  */}\n        <button\n          type=\"submit\"\n          disabled={loading || submitting}\n          className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {submitting ? '...' : ''}\n        </button>\n      </form>\n    </>\n  );\n}","export interface ProgressFeedback {\n  title: string;\n  message: string;\n  type: 'success' | 'milestone' | 'encouragement';\n  showConfetti?: boolean;\n}\n\nexport function getDataEntryFeedback(\n  totalDaysWithData: number,\n  consecutiveDays: number\n): ProgressFeedback | null {\n  const MINIMUM_DAYS = 21;\n  const RECOMMENDED_DAYS = 28;\n\n  if (totalDaysWithData === MINIMUM_DAYS) {\n    return {\n      title: ' ACWR',\n      message: '3ACWR',\n      type: 'milestone',\n      showConfetti: true\n    };\n  }\n\n  if (totalDaysWithData === RECOMMENDED_DAYS) {\n    return {\n      title: ' ',\n      message: '4ACWR',\n      type: 'milestone',\n      showConfetti: true\n    };\n  }\n\n  if (totalDaysWithData === 7) {\n    return {\n      title: ' 1',\n      message: '2ACWR',\n      type: 'milestone'\n    };\n  }\n\n  if (totalDaysWithData === 14) {\n    return {\n      title: ' 2',\n      message: '1ACWR',\n      type: 'milestone'\n    };\n  }\n\n  if (consecutiveDays === 3) {\n    return {\n      title: ' 3',\n      message: '',\n      type: 'success'\n    };\n  }\n\n  if (consecutiveDays === 7) {\n    return {\n      title: ' 1',\n      message: '',\n      type: 'success'\n    };\n  }\n\n  if (consecutiveDays === 14) {\n    return {\n      title: ' 2',\n      message: 'ACWR',\n      type: 'success'\n    };\n  }\n\n  if (totalDaysWithData % 5 === 0 && totalDaysWithData < MINIMUM_DAYS) {\n    return {\n      title: '',\n      message: `${totalDaysWithData}ACWR${MINIMUM_DAYS - totalDaysWithData}`,\n      type: 'encouragement'\n    };\n  }\n\n  return null;\n}\n\nexport function getWeeklyProgress(daysWithData: number): {\n  week: number;\n  description: string;\n  tip: string;\n} {\n  const week = Math.floor(daysWithData / 7) + 1;\n\n  const weeklyInfo = {\n    1: {\n      description: '',\n      tip: ''\n    },\n    2: {\n      description: '',\n      tip: '2'\n    },\n    3: {\n      description: 'ACWR',\n      tip: 'ACWR'\n    },\n    4: {\n      description: 'ACWR',\n      tip: '4'\n    }\n  };\n\n  const info = weeklyInfo[week as keyof typeof weeklyInfo] || weeklyInfo[4];\n\n  return {\n    week,\n    description: info.description,\n    tip: info.tip\n  };\n}\n\nexport function getDaysUntilACWR(daysWithData: number): {\n  daysRemaining: number;\n  isMinimumReached: boolean;\n  isRecommendedReached: boolean;\n  message: string;\n} {\n  const MINIMUM_DAYS = 21;\n  const RECOMMENDED_DAYS = 28;\n\n  const isMinimumReached = daysWithData >= MINIMUM_DAYS;\n  const isRecommendedReached = daysWithData >= RECOMMENDED_DAYS;\n\n  let daysRemaining = 0;\n  let message = '';\n\n  if (isRecommendedReached) {\n    message = 'ACWR';\n  } else if (isMinimumReached) {\n    daysRemaining = RECOMMENDED_DAYS - daysWithData;\n    message = `${daysRemaining}`;\n  } else {\n    daysRemaining = MINIMUM_DAYS - daysWithData;\n    message = `ACWR${daysRemaining}`;\n  }\n\n  return {\n    daysRemaining,\n    isMinimumReached,\n    isRecommendedReached,\n    message\n  };\n}\n","import React from 'react';\nimport { TrendingUp, Calendar, CheckCircle, AlertCircle } from 'lucide-react';\n\ninterface ACWRProgressIndicatorProps {\n  daysWithData: number;\n  isDarkMode: boolean;\n}\n\nexport default function ACWRProgressIndicator({ daysWithData, isDarkMode }: ACWRProgressIndicatorProps) {\n  const MINIMUM_DAYS = 21;\n  const RECOMMENDED_DAYS = 28;\n\n  const progress = Math.min((daysWithData / RECOMMENDED_DAYS) * 100, 100);\n  const isMinimumReached = daysWithData >= MINIMUM_DAYS;\n  const isRecommendedReached = daysWithData >= RECOMMENDED_DAYS;\n\n  const getStatusConfig = () => {\n    if (isRecommendedReached) {\n      return {\n        icon: CheckCircle,\n        color: 'text-green-600 dark:text-green-400',\n        bgColor: 'bg-green-50 dark:bg-green-900/20',\n        borderColor: 'border-green-200 dark:border-green-800',\n        progressColor: 'bg-green-500',\n        title: 'ACWR',\n        message: 'ACWR'\n      };\n    } else if (isMinimumReached) {\n      return {\n        icon: AlertCircle,\n        color: 'text-yellow-600 dark:text-yellow-400',\n        bgColor: 'bg-yellow-50 dark:bg-yellow-900/20',\n        borderColor: 'border-yellow-200 dark:border-yellow-800',\n        progressColor: 'bg-yellow-500',\n        title: 'ACWR',\n        message: `${RECOMMENDED_DAYS - daysWithData}`\n      };\n    } else {\n      const week = Math.floor(daysWithData / 7) + 1;\n      return {\n        icon: Calendar,\n        color: 'text-blue-600 dark:text-blue-400',\n        bgColor: 'bg-blue-50 dark:bg-blue-900/20',\n        borderColor: 'border-blue-200 dark:border-blue-800',\n        progressColor: 'bg-blue-500',\n        title: `${week}`,\n        message: `ACWR${MINIMUM_DAYS - daysWithData}`\n      };\n    }\n  };\n\n  const config = getStatusConfig();\n  const StatusIcon = config.icon;\n\n  const getMilestones = () => [\n    { day: 7, label: '1', reached: daysWithData >= 7 },\n    { day: 14, label: '2', reached: daysWithData >= 14 },\n    { day: 21, label: '3\\n()', reached: daysWithData >= 21 },\n    { day: 28, label: '4\\n()', reached: daysWithData >= 28 }\n  ];\n\n  return (\n    <div className={`rounded-lg border ${config.borderColor} ${config.bgColor} p-4 sm:p-6`}>\n      <div className=\"flex items-start gap-3 mb-4\">\n        <StatusIcon className={`${config.color} flex-shrink-0 mt-0.5`} size={24} />\n        <div className=\"flex-1 min-w-0\">\n          <h3 className={`font-semibold ${config.color} text-base sm:text-lg mb-1`}>\n            {config.title}\n          </h3>\n          <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n            {config.message}\n          </p>\n        </div>\n      </div>\n\n      <div className=\"space-y-3\">\n        <div className=\"flex items-center justify-between text-sm\">\n          <span className=\"font-medium text-gray-700 dark:text-gray-300\">\n            : {daysWithData}\n          </span>\n          <span className=\"text-gray-500 dark:text-gray-400\">\n            {Math.round(progress)}%\n          </span>\n        </div>\n\n        <div className=\"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n          <div\n            className={`absolute inset-y-0 left-0 ${config.progressColor} rounded-full transition-all duration-500 ease-out`}\n            style={{ width: `${progress}%` }}\n          />\n\n          {getMilestones().map((milestone) => {\n            const position = (milestone.day / RECOMMENDED_DAYS) * 100;\n            return (\n              <div\n                key={milestone.day}\n                className=\"absolute top-0 bottom-0 w-0.5 bg-white dark:bg-gray-600\"\n                style={{ left: `${position}%` }}\n              />\n            );\n          })}\n        </div>\n\n        <div className=\"flex justify-between text-xs text-gray-500 dark:text-gray-400\">\n          {getMilestones().map((milestone) => (\n            <div\n              key={milestone.day}\n              className={`flex flex-col items-center ${\n                milestone.reached ? 'text-gray-700 dark:text-gray-300 font-medium' : ''\n              }`}\n            >\n              <span className=\"whitespace-pre-line text-center leading-tight\">\n                {milestone.label}\n              </span>\n              {milestone.reached && (\n                <CheckCircle size={12} className=\"text-green-500 mt-0.5\" />\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {!isRecommendedReached && (\n        <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-start gap-2\">\n            <TrendingUp size={16} className=\"text-gray-400 flex-shrink-0 mt-0.5\" />\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n              ACWR14\n              \n            </p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useState, useMemo } from 'react';\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  ReferenceLine\n} from 'recharts';\nimport { ACWRData, getRiskColor } from '../lib/acwr';\nimport { Calendar, Filter } from 'lucide-react';\nimport ACWRProgressIndicator from './ACWRProgressIndicator';\n\ninterface ACWRChartProps {\n  data: ACWRData[];\n  daysWithData?: number;\n  isDarkMode?: boolean;\n  teamAverageData?: ACWRData[];\n  showTeamAverage?: boolean;\n}\n\nexport function ACWRChart({\n  data,\n  daysWithData = 0,\n  isDarkMode = false,\n  teamAverageData = [],\n  showTeamAverage = false\n}: ACWRChartProps) {\n  const [selectedPeriod, setSelectedPeriod] = useState<'week' | 'month' | 'quarter' | 'all'>('month');\n  const [isTeamAverageVisible, setIsTeamAverageVisible] = useState(showTeamAverage);\n\n  const MINIMUM_DAYS = 21;\n  const isDataSufficient = daysWithData >= MINIMUM_DAYS;\n\n  // \n  const filteredData = useMemo(() => {\n    if (data.length === 0) return [];\n\n    const today = new Date();\n    let startDate: Date;\n\n    switch (selectedPeriod) {\n      case 'week':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 7);\n        break;\n      case 'month':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 30);\n        break;\n      case 'quarter':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 90);\n        break;\n      case 'all':\n      default:\n        return data;\n    }\n\n    return data.filter((item) => {\n      const itemDate = new Date(item.date);\n      return itemDate >= startDate && itemDate <= today;\n    });\n  }, [data, selectedPeriod]);\n\n  // \n  const filteredTeamData = useMemo(() => {\n    if (teamAverageData.length === 0) return [];\n\n    const today = new Date();\n    let startDate: Date;\n\n    switch (selectedPeriod) {\n      case 'week':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 7);\n        break;\n      case 'month':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 30);\n        break;\n      case 'quarter':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 90);\n        break;\n      case 'all':\n      default:\n        return teamAverageData;\n    }\n\n    return teamAverageData.filter((item) => {\n      const itemDate = new Date(item.date);\n      return itemDate >= startDate && itemDate <= today;\n    });\n  }, [teamAverageData, selectedPeriod]);\n\n  if (data.length === 0) {\n    return (\n      <div className=\"space-y-4\">\n        {daysWithData > 0 && (\n          <ACWRProgressIndicator daysWithData={daysWithData} isDarkMode={isDarkMode} />\n        )}\n        <div className=\"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400\">\n          <div className=\"text-center px-4\">\n            <p className=\"text-base sm:text-lg mb-2\"></p>\n            <p className=\"text-sm\">ACWR</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isDataSufficient) {\n    return (\n      <div className=\"space-y-4\">\n        <ACWRProgressIndicator daysWithData={daysWithData} isDarkMode={isDarkMode} />\n        <div className=\"flex items-center justify-center h-64 sm:h-96 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg\">\n          <div className=\"text-center px-4\">\n            <p className=\"text-base sm:text-lg mb-2\">ACWR</p>\n            <p className=\"text-sm\">{MINIMUM_DAYS - daysWithData}ACWR</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const formatDate = (dateStr: string) => {\n    const d = new Date(dateStr);\n    return `${d.getMonth() + 1}/${d.getDate()}`;\n  };\n\n  const formatDateWithDay = (dateStr: string) => {\n    const d = new Date(dateStr);\n    const dayNames = ['', '', '', '', '', '', ''];\n    return `${d.getMonth() + 1}/${d.getDate()}(${dayNames[d.getDay()]})`;\n  };\n\n  //  Tooltip: payload[0] name \n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (!active || !payload || payload.length === 0) return null;\n\n    // Rechartspayload\n    const personalEntry =\n      payload.find((p: any) => p?.name === ' ACWR') ||\n      payload.find((p: any) => p?.dataKey === 'acwr'); // \n\n    const teamEntry =\n      payload.find((p: any) => p?.name === '');\n\n    const personal = personalEntry?.payload; // filteredData1\n    const personalACWR =\n      typeof personalEntry?.value === 'number' && Number.isFinite(personalEntry.value)\n        ? personalEntry.value\n        : (typeof personal?.acwr === 'number' ? personal.acwr : null);\n\n    // labelX(date)\n    const date = new Date(label);\n    const isWeekend = date.getDay() === 0 || date.getDay() === 6;\n\n    //  filteredTeamData \n    const teamRow = isTeamAverageVisible\n      ? filteredTeamData.find((td) => td.date === label)\n      : null;\n\n    const teamACWR =\n      teamRow && typeof teamRow.acwr === 'number' && Number.isFinite(teamRow.acwr)\n        ? teamRow.acwr\n        : (typeof teamEntry?.value === 'number' && Number.isFinite(teamEntry.value) ? teamEntry.value : null);\n\n    if (!personal) return null;\n\n    const diff =\n      typeof personalACWR === 'number' && typeof teamACWR === 'number'\n        ? personalACWR - teamACWR\n        : null;\n\n    return (\n      <div className=\"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs\">\n        <div className=\"flex items-center space-x-2 mb-2\">\n          <p className=\"font-medium text-gray-900 text-sm sm:text-base\">{formatDateWithDay(label)}</p>\n          {isWeekend && (\n            <span className=\"bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium\">\n              \n            </span>\n          )}\n        </div>\n\n        <div className=\"space-y-1 text-xs sm:text-sm\">\n          <p className=\"flex justify-between\">\n            <span> ACWR:</span>\n            <span className=\"font-semibold\" style={{ color: getRiskColor(personal.riskLevel) }}>\n              {typeof personalACWR === 'number' ? personalACWR.toFixed(2) : '-'}\n            </span>\n          </p>\n\n          {isTeamAverageVisible && teamACWR != null && (\n            <p className=\"flex justify-between\">\n              <span>:</span>\n              <span className=\"font-semibold text-purple-600\">\n                {teamACWR.toFixed(2)}\n              </span>\n            </p>\n          )}\n\n          {isTeamAverageVisible && diff != null && (\n            <p className=\"flex justify-between text-xs\">\n              <span>:</span>\n              <span className={`font-semibold ${diff > 0.3 ? 'text-red-600' : 'text-gray-600'}`}>\n                {diff > 0 ? '+' : ''}{diff.toFixed(2)}\n              </span>\n            </p>\n          )}\n\n          <p className=\"flex justify-between\">\n            <span>:</span>\n            <span className=\"font-semibold\">{personal.acuteLoad ?? '-'}</span>\n          </p>\n          <p className=\"flex justify-between\">\n            <span>:</span>\n            <span className=\"font-semibold\">{personal.chronicLoad ?? '-'}</span>\n          </p>\n          <p className=\"flex justify-between\">\n            <span>:</span>\n            <span className=\"font-semibold\" style={{ color: getRiskColor(personal.riskLevel) }}>\n              {getRiskLabel(personal.riskLevel)}\n            </span>\n          </p>\n        </div>\n      </div>\n    );\n  };\n\n  const CustomDot = (props: any) => {\n    const { cx, cy, payload } = props;\n    if (cx && cy && payload) {\n      const d = new Date(payload.date);\n      const isWeekend = d.getDay() === 0 || d.getDay() === 6;\n\n      return (\n        <circle\n          cx={cx}\n          cy={cy}\n          r={isWeekend ? 5 : 4}\n          fill={getRiskColor(payload.riskLevel)}\n          strokeWidth={2}\n          stroke={isWeekend ? '#3B82F6' : 'white'}\n          opacity={isWeekend ? 0.9 : 1}\n        />\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"w-full space-y-4\">\n      {daysWithData < 28 && (\n        <ACWRProgressIndicator daysWithData={daysWithData} isDarkMode={isDarkMode} />\n      )}\n\n      {/*  */}\n      <div className=\"mb-4 space-y-3\">\n        <div className=\"flex items-center space-x-2\">\n          <Calendar className=\"w-5 h-5 text-gray-500\" />\n          <span className=\"text-sm font-medium text-gray-700\"></span>\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          <Filter className=\"w-4 h-4 text-gray-500\" />\n          <div className=\"flex space-x-1\">\n            {[\n              { value: 'week', label: '1' },\n              { value: 'month', label: '1' },\n              { value: 'quarter', label: '3' },\n              { value: 'all', label: '' }\n            ].map((period) => (\n              <button\n                key={period.value}\n                onClick={() => setSelectedPeriod(period.value as any)}\n                className={`px-3 py-1 rounded-lg text-xs font-medium transition-colors ${\n                  selectedPeriod === period.value\n                    ? 'bg-blue-600 text-white'\n                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                }`}\n              >\n                {period.label}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/*  */}\n        <div className=\"bg-blue-50 rounded-lg p-3\">\n          <div className=\"flex items-center justify-between text-sm text-blue-700\">\n            <div>\n              <span className=\"font-medium\">:</span> {filteredData.length}\n              {selectedPeriod !== 'all' && (\n                <span className=\"ml-2\">\n                  ({selectedPeriod === 'week'\n                    ? '7'\n                    : selectedPeriod === 'month'\n                      ? '30'\n                      : '90'})\n                </span>\n              )}\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-3 h-3 bg-blue-500 rounded-full border-2 border-blue-600\"></div>\n              <span className=\"text-xs\"></span>\n            </div>\n          </div>\n        </div>\n\n        {/*  */}\n        {teamAverageData.length > 0 && (\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setIsTeamAverageVisible(!isTeamAverageVisible)}\n              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n                isTeamAverageVisible\n                  ? 'bg-purple-600 text-white hover:bg-purple-700'\n                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600'\n              }`}\n            >\n              {isTeamAverageVisible ? '' : ''}\n            </button>\n            {isTeamAverageVisible && (\n              <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n                \n              </span>\n            )}\n          </div>\n        )}\n      </div>\n\n      <div className=\"h-64 sm:h-96\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <LineChart data={filteredData} margin={{ top: 20, right: 30, left: 20, bottom: 20 }}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n\n            <XAxis\n              dataKey=\"date\"\n              tickFormatter={formatDate}\n              stroke=\"#6b7280\"\n              fontSize={10}\n              interval=\"preserveStartEnd\"\n            />\n            <YAxis domain={[0, 'dataMax + 0.5']} stroke=\"#6b7280\" fontSize={10} width={40} />\n            <Tooltip content={<CustomTooltip />} />\n\n            {/* risk zones */}\n            <ReferenceLine y={1.5} stroke=\"#EF4444\" strokeDasharray=\"5 5\" />\n            <ReferenceLine y={1.3} stroke=\"#F59E0B\" strokeDasharray=\"5 5\" />\n            <ReferenceLine y={0.8} stroke=\"#10B981\" strokeDasharray=\"5 5\" />\n\n            <Line\n              type=\"monotone\"\n              dataKey=\"acwr\"\n              stroke=\"#6366f1\"\n              strokeWidth={2}\n              dot={<CustomDot />}\n              activeDot={{ r: 6, stroke: '#6366f1', strokeWidth: 2, fill: 'white' }}\n              name=\" ACWR\"\n            />\n\n            {isTeamAverageVisible && filteredTeamData.length > 0 && (\n              <Line\n                type=\"monotone\"\n                data={filteredTeamData}\n                dataKey=\"acwr\"\n                stroke=\"#9333ea\"\n                strokeWidth={2}\n                strokeDasharray=\"5 5\"\n                dot={{ r: 3, fill: '#9333ea', stroke: '#9333ea' }}\n                activeDot={{ r: 5, stroke: '#9333ea', strokeWidth: 2, fill: 'white' }}\n                name=\"\"\n              />\n            )}\n          </LineChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/* Legend */}\n      <div className=\"mt-4 flex justify-center\">\n        <div className=\"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs\">\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-red-500 rounded-full mr-2\"></div>\n            <span> (&gt;1.5)</span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-yellow-500 rounded-full mr-2\"></div>\n            <span> (1.3-1.5)</span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-green-500 rounded-full mr-2\"></div>\n            <span> (0.8-1.3)</span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-blue-500 rounded-full mr-2\"></div>\n            <span> (&lt;0.8)</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction getRiskLabel(riskLevel: string): string {\n  switch (riskLevel) {\n    case 'high':\n      return '';\n    case 'caution':\n      return '';\n    case 'good':\n      return '';\n    case 'low':\n      return '';\n    default:\n      return '';\n  }\n}","import React, { useState } from 'react';\nimport { TrainingRecord } from '../lib/supabase';\nimport { X, Save, Trash2, Calendar, Clock, Zap, AlertCircle } from 'lucide-react';\n\ninterface EditTrainingRecordModalProps {\n  record: TrainingRecord;\n  onClose: () => void;\n  onUpdate: (recordId: string, data: { rpe: number; duration_min: number; date?: string }) => Promise<void>;\n  onDelete?: (recordId: string) => Promise<void>;\n  allowDateEdit?: boolean;\n  allowDelete?: boolean;\n}\n\nexport function EditTrainingRecordModal({ \n  record, \n  onClose, \n  onUpdate, \n  onDelete,\n  allowDateEdit = false,\n  allowDelete = false\n}: EditTrainingRecordModalProps) {\n  const [formData, setFormData] = useState({\n    rpe: record.rpe,\n    duration_min: record.duration_min,\n    date: record.date\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      const updateData: { rpe: number; duration_min: number; date?: string } = {\n        rpe: formData.rpe,\n        duration_min: formData.duration_min,\n      };\n\n      if (allowDateEdit && formData.date !== record.date) {\n        updateData.date = formData.date;\n      }\n\n      await onUpdate(record.id, updateData);\n      onClose();\n    } catch (err: any) {\n      console.error('Error updating record:', err);\n      setError(err.message || '');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!onDelete) return;\n    \n    setLoading(true);\n    setError('');\n\n    try {\n      await onDelete(record.id);\n      onClose();\n    } catch (err: any) {\n      console.error('Error deleting record:', err);\n      setError(err.message || '');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const rpeLabels = [\n    '0 - ',\n    '1 - ',\n    '2 - ',\n    '3 - ',\n    '4 - ',\n    '5 - ',\n    '6 - ',\n    '7 - ',\n    '8 - ',\n    '9 - ',\n    '10 -  ()'\n  ];\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"bg-blue-600 text-white p-6 rounded-t-2xl\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"bg-blue-500 rounded-full p-2\">\n                <Calendar className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-bold\"></h2>\n                <p className=\"text-blue-100\">\n                  {new Date(record.date).toLocaleDateString('ja-JP')}\n                </p>\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        <div className=\"p-6\">\n          {/* Current Values Display */}\n          <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n            <h3 className=\"font-medium text-gray-900 mb-3\"></h3>\n            <div className=\"grid grid-cols-3 gap-4 text-center text-sm\">\n              <div>\n                <div className=\"text-gray-600\">RPE</div>\n                <div className=\"font-bold text-lg text-blue-600\">{record.rpe}</div>\n              </div>\n              <div>\n                <div className=\"text-gray-600\"></div>\n                <div className=\"font-bold text-lg text-green-600\">{record.duration_min}</div>\n              </div>\n              <div>\n                <div className=\"text-gray-600\"></div>\n                <div className=\"font-bold text-lg text-purple-600\">{record.load}</div>\n              </div>\n            </div>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Date Edit (if allowed) */}\n            {allowDateEdit && (\n              <div>\n                <label className=\"flex items-center text-sm font-medium text-gray-700 mb-3\">\n                  <Calendar className=\"w-4 h-4 mr-2\" />\n                  \n                </label>\n                <input\n                  type=\"date\"\n                  value={formData.date}\n                  onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors\"\n                />\n              </div>\n            )}\n\n            {/* RPE Edit */}\n            <div>\n              <label className=\"flex items-center text-sm font-medium text-gray-700 mb-3\">\n                <Zap className=\"w-4 h-4 mr-2\" />\n                RPE\n              </label>\n              <div className=\"space-y-3\">\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"10\"\n                  value={formData.rpe}\n                  onChange={(e) => setFormData(prev => ({ ...prev, rpe: Number(e.target.value) }))}\n                  className=\"w-full h-2 rounded-lg appearance-none cursor-pointer\"\n                  style={{\n                    WebkitAppearance: 'none',\n                    background: `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(formData.rpe / 10) * 100}%, #9ca3af ${(formData.rpe / 10) * 100}%, #9ca3af 100%)`\n                  }}\n                />\n                <div className=\"flex justify-between text-xs text-gray-500\">\n                  <span>0</span>\n                  <span>5</span>\n                  <span>10</span>\n                </div>\n                <div className=\"text-center p-3 bg-blue-50 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-blue-600 mb-1\">{formData.rpe}</div>\n                  <div className=\"text-sm text-blue-700\">{rpeLabels[formData.rpe]}</div>\n                </div>\n              </div>\n            </div>\n\n            {/* Duration Edit */}\n            <div>\n              <label className=\"flex items-center text-sm font-medium text-gray-700 mb-3\">\n                <Clock className=\"w-4 h-4 mr-2\" />\n                \n              </label>\n              <input\n                type=\"number\"\n                min=\"1\"\n                max=\"480\"\n                value={formData.duration_min}\n                onChange={(e) => setFormData(prev => ({ ...prev, duration_min: Number(e.target.value) }))}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base\"\n                style={{ fontSize: '16px' }} // Prevent zoom on iOS Safari\n              />\n            </div>\n\n            {/* New Load Calculation */}\n            <div className=\"bg-gray-50 rounded-lg p-4\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-sm text-gray-600\"></span>\n                <span className=\"text-lg font-semibold text-gray-900\">\n                  {formData.rpe * formData.duration_min}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center text-xs text-gray-500\">\n                <span>: {record.load}</span>\n                <span className={`font-medium ${\n                  (formData.rpe * formData.duration_min) > record.load \n                    ? 'text-red-600' \n                    : (formData.rpe * formData.duration_min) < record.load \n                      ? 'text-blue-600' \n                      : 'text-gray-600'\n                }`}>\n                  {(formData.rpe * formData.duration_min) > record.load ? '' : \n                   (formData.rpe * formData.duration_min) < record.load ? '' : ''}\n                </span>\n              </div>\n            </div>\n\n            {error && (\n              <div className=\"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600\">\n                <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\n                <span className=\"text-sm\">{error}</span>\n              </div>\n            )}\n\n            {/* Action Buttons */}\n            <div className=\"flex space-x-3\">\n              {allowDelete && onDelete && (\n                <button\n                  type=\"button\"\n                  onClick={() => setShowDeleteConfirm(true)}\n                  className=\"bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center space-x-2\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                  <span></span>\n                </button>\n              )}\n              \n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg transition-colors\"\n              >\n                \n              </button>\n              \n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\n              >\n                {loading ? (\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                ) : (\n                  <Save className=\"w-4 h-4 mr-2\" />\n                )}\n                {loading ? '...' : ''}\n              </button>\n            </div>\n          </form>\n        </div>\n\n        {/* Delete Confirmation Modal */}\n        {showDeleteConfirm && (\n          <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 rounded-2xl\">\n            <div className=\"bg-white rounded-xl p-6 max-w-sm w-full\">\n              <div className=\"text-center\">\n                <Trash2 className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-bold text-gray-900 mb-2\"></h3>\n                <p className=\"text-sm text-gray-600 mb-6\">\n                  {new Date(record.date).toLocaleDateString('ja-JP')}\n                  \n                </p>\n                <div className=\"flex space-x-3\">\n                  <button\n                    onClick={() => setShowDeleteConfirm(false)}\n                    className=\"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors\"\n                  >\n                    \n                  </button>\n                  <button\n                    onClick={handleDelete}\n                    disabled={loading}\n                    className=\"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50\"\n                  >\n                    \n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","import React, { useState, useMemo, useCallback } from 'react';\nimport { TrainingRecord } from '../lib/supabase';\nimport { EditTrainingRecordModal } from './EditTrainingRecordModal';\nimport { Calendar, Edit, Trash2, ChevronDown, ChevronUp } from 'lucide-react';\n\ninterface TrainingRecordsListProps {\n  records: TrainingRecord[];\n  onUpdate: (recordId: string, data: { rpe: number; duration_min: number; date?: string }) => Promise<void>;\n  onDelete: (recordId: string) => Promise<void>;\n  loading?: boolean;\n  allowEdit?: boolean;\n  allowDelete?: boolean;\n  allowDateEdit?: boolean;\n  showLimited?: boolean;\n  limitCount?: number;\n}\n\nexport const TrainingRecordsList = React.memo(function TrainingRecordsList({\n  records,\n  onUpdate,\n  onDelete,\n  loading = false,\n  allowEdit = true,\n  allowDelete = false,\n  allowDateEdit = false,\n  showLimited = false,\n  limitCount = 10\n}: TrainingRecordsListProps) {\n  const [selectedRecord, setSelectedRecord] = useState<TrainingRecord | null>(null);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showAll, setShowAll] = useState(false);\n\n  const displayRecords = useMemo(\n    () => (showLimited && !showAll ? records.slice(-limitCount) : records),\n    [records, showLimited, showAll, limitCount]\n  );\n\n  const sortedRecords = useMemo(\n    () => [...displayRecords].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()),\n    [displayRecords]\n  );\n\n  const handleEditClick = useCallback((record: TrainingRecord) => {\n    setSelectedRecord(record);\n    setShowEditModal(true);\n  }, []);\n\n  const handleModalClose = useCallback(() => {\n    setShowEditModal(false);\n    setSelectedRecord(null);\n  }, []);\n\n  const rpeColor = (rpe: number) =>\n    rpe >= 8\n      ? 'text-red-600 dark:text-red-400'\n      : rpe >= 6\n      ? 'text-yellow-600 dark:text-yellow-400'\n      : 'text-green-600 dark:text-green-400';\n\n  if (loading) {\n    return (\n      <div className=\"space-y-3\">\n        {[1, 2, 3].map((i) => (\n          <div key={i} className=\"animate-pulse\">\n            <div className=\"h-16 bg-gray-200 dark:bg-gray-700 rounded-lg\"></div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  if (records.length === 0) {\n    return (\n      <div className=\"text-center py-8\">\n        <Calendar className=\"w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-3\" />\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2\"></h3>\n        <p className=\"text-gray-600 dark:text-gray-400\"></p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100\"></h3>\n\n        {showLimited && records.length > limitCount && (\n          <button\n            onClick={() => setShowAll(!showAll)}\n            className=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 flex items-center space-x-1\"\n          >\n            <span>{showAll ? `${limitCount}` : `${records.length}`}</span>\n            {showAll ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n          </button>\n        )}\n      </div>\n\n      {/* Records List */}\n      <div className=\"space-y-3\">\n        {sortedRecords.map((record) => (\n          <div\n            key={record.id}\n            className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors\"\n          >\n            {/* Mobile Layout */}\n            <div className=\"block sm:hidden\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center space-x-2 mb-2\">\n                    <Calendar className=\"w-4 h-4 text-gray-400 dark:text-gray-500\" />\n                    <span className=\"font-medium text-gray-900 dark:text-gray-100\">\n                      {new Date(record.date).toLocaleDateString('ja-JP')}\n                    </span>\n                  </div>\n\n                  <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                    <div className=\"text-center\">\n                      <div className=\"text-gray-600 dark:text-gray-400 text-xs\">RPE</div>\n                      <div className={`font-bold ${rpeColor(record.rpe)}`}>{record.rpe}</div>\n                    </div>\n\n                    <div className=\"text-center\">\n                      <div className=\"text-gray-600 dark:text-gray-400 text-xs\"></div>\n                      <div className=\"font-bold text-blue-600 dark:text-blue-400\">\n                        {record.duration_min}\n                      </div>\n                    </div>\n\n                    <div className=\"text-center\">\n                      <div className=\"text-gray-600 dark:text-gray-400 text-xs\"></div>\n                      <div className=\"font-bold text-purple-600 dark:text-purple-400\">{record.load}</div>\n                    </div>\n                  </div>\n                </div>\n\n                {allowEdit && (\n                  <button\n                    onClick={() => handleEditClick(record)}\n                    className=\"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors ml-2\"\n                    title=\"\"\n                  >\n                    <Edit className=\"w-4 h-4\" />\n                  </button>\n                )}\n              </div>\n            </div>\n\n            {/* Desktop Layout */}\n            <div className=\"hidden sm:flex items-center justify-between\">\n              <div className=\"flex-1 grid grid-cols-4 gap-6\">\n                <div className=\"flex items-center\">\n                  <Calendar className=\"w-4 h-4 text-gray-400 dark:text-gray-500 mr-2\" />\n                  <span className=\"font-medium text-gray-900 dark:text-gray-100\">\n                    {new Date(record.date).toLocaleDateString('ja-JP')}\n                  </span>\n                </div>\n\n                <div className=\"text-center\">\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">RPE</div>\n                  <div className={`text-xl font-bold ${rpeColor(record.rpe)}`}>{record.rpe}</div>\n                </div>\n\n                <div className=\"text-center\">\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></div>\n                  <div className=\"text-xl font-bold text-blue-600 dark:text-blue-400\">\n                    {record.duration_min}\n                  </div>\n                </div>\n\n                <div className=\"text-center\">\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></div>\n                  <div className=\"text-xl font-bold text-purple-600 dark:text-purple-400\">{record.load}</div>\n                </div>\n              </div>\n\n              {allowEdit && (\n                <div className=\"flex space-x-2 ml-4\">\n                  <button\n                    onClick={() => handleEditClick(record)}\n                    className=\"bg-blue-50 hover:bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:text-blue-300 p-2 rounded-lg transition-colors\"\n                    title=\"\"\n                  >\n                    <Edit className=\"w-4 h-4\" />\n                  </button>\n\n                  {allowDelete && (\n                    <button\n                      onClick={() => handleEditClick(record)}\n                      className=\"bg-red-50 hover:bg-red-100 text-red-600 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-300 p-2 rounded-lg transition-colors\"\n                      title=\"\"\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </button>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Show More/Less Button for Limited View */}\n      {showLimited && records.length > limitCount && !showAll && (\n        <div className=\"text-center pt-4\">\n          <button className=\"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium\" onClick={() => setShowAll(true)}>\n            {records.length - limitCount}\n          </button>\n        </div>\n      )}\n\n      {/* Edit Modal */}\n      {showEditModal && selectedRecord && (\n        <EditTrainingRecordModal\n          record={selectedRecord}\n          onClose={handleModalClose}\n          onUpdate={onUpdate}\n          onDelete={allowDelete ? onDelete : undefined}\n          allowDateEdit={allowDateEdit}\n          allowDelete={allowDelete}\n        />\n      )}\n    </div>\n  );\n});","import React, { useState, useEffect } from 'react';\nimport { Alert, getAlertStyle } from '../lib/alerts';\nimport { TrendingUp, AlertTriangle, Info, Clock, X } from 'lucide-react';\n\ninterface AlertSummaryProps {\n  alerts: Alert[];\n  onViewAll: () => void;\n  className?: string;\n}\n\nexport function AlertSummary({ alerts, onViewAll, className = '' }: AlertSummaryProps) {\n  const [isDismissed, setIsDismissed] = useState(false);\n\n  useEffect(() => {\n    const dismissed = localStorage.getItem('alertSummaryDismissed');\n    const dismissedTime = dismissed ? parseInt(dismissed, 10) : 0;\n    const now = Date.now();\n    const oneHour = 60 * 60 * 1000;\n\n    if (dismissedTime && now - dismissedTime < oneHour) {\n      setIsDismissed(true);\n    } else if (dismissedTime && now - dismissedTime >= oneHour) {\n      localStorage.removeItem('alertSummaryDismissed');\n    }\n  }, []);\n\n  const handleDismiss = () => {\n    setIsDismissed(true);\n    localStorage.setItem('alertSummaryDismissed', Date.now().toString());\n  };\n\n  const activeAlerts = alerts.filter(alert => !alert.is_dismissed);\n  const highPriorityAlerts = activeAlerts.filter(alert => alert.priority === 'high');\n  const unreadAlerts = activeAlerts.filter(alert => !alert.is_read);\n\n  if (isDismissed) {\n    return null;\n  }\n\n  if (activeAlerts.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={`bg-white border border-gray-200 rounded-lg p-4 ${className}`}>\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"font-semibold text-gray-900 flex items-center\">\n          <AlertTriangle className=\"w-5 h-5 text-orange-500 mr-2\" />\n          \n        </h3>\n        <div className=\"flex items-center space-x-2\">\n          <button\n            onClick={onViewAll}\n            className=\"text-sm text-blue-600 hover:text-blue-700 font-medium\"\n          >\n            \n          </button>\n          <button\n            onClick={handleDismiss}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n            title=\"1\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Summary Stats */}\n      <div className=\"grid grid-cols-3 gap-4 mb-4\">\n        <div className=\"text-center\">\n          <div className=\"text-2xl font-bold text-red-600\">\n            {highPriorityAlerts.length}\n          </div>\n          <div className=\"text-xs text-gray-600\"></div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-2xl font-bold text-blue-600\">\n            {unreadAlerts.length}\n          </div>\n          <div className=\"text-xs text-gray-600\"></div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-2xl font-bold text-gray-600\">\n            {activeAlerts.length}\n          </div>\n          <div className=\"text-xs text-gray-600\"></div>\n        </div>\n      </div>\n\n      {/* Recent High Priority Alerts */}\n      {highPriorityAlerts.length > 0 && (\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-medium text-gray-700 flex items-center\">\n            <AlertTriangle className=\"w-4 h-4 text-red-500 mr-1\" />\n            \n          </h4>\n          {highPriorityAlerts.slice(0, 3).map((alert) => {\n            const style = getAlertStyle(alert);\n            return (\n              <div\n                key={alert.id}\n                className={`${style.bgColor} ${style.borderColor} border rounded p-3`}\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-2 mb-1\">\n                      <span className=\"text-sm\">{style.icon}</span>\n                      <h5 className={`font-medium text-sm ${style.textColor}`}>\n                        {alert.title}\n                      </h5>\n                      {!alert.is_read && (\n                        <span className=\"w-2 h-2 bg-red-500 rounded-full\"></span>\n                      )}\n                    </div>\n                    <p className={`text-xs ${style.textColor} line-clamp-2`}>\n                      {alert.message}\n                    </p>\n                    {alert.acwr_value && (\n                      <div className=\"mt-1\">\n                        <span className=\"text-xs text-gray-600\">ACWR: </span>\n                        <span className={`text-xs font-bold ${style.textColor}`}>\n                          {alert.acwr_value}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"ml-2\">\n                    <Clock className=\"w-3 h-3 text-gray-400\" />\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n          {highPriorityAlerts.length > 3 && (\n            <div className=\"text-center\">\n              <button\n                onClick={onViewAll}\n                className=\"text-xs text-red-600 hover:text-red-700 font-medium\"\n              >\n                 {highPriorityAlerts.length - 3}\n              </button>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* General Info */}\n      <div className=\"mt-4 pt-3 border-t border-gray-200\">\n        <div className=\"flex items-center text-xs text-gray-500\">\n          <Info className=\"w-3 h-3 mr-1\" />\n          <span>5</span>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useEffect, useMemo, useState } from 'react';\nimport { Scale, Calendar, AlertCircle, FileText } from 'lucide-react';\nimport { WeightRecord } from '../lib/supabase';\nimport { GenericDuplicateModal } from './GenericDuplicateModal';\nimport { getTodayJSTString } from '../lib/date';\nimport { Toast } from './ui/Toast'; //  \n\ninterface WeightFormProps {\n  onSubmit: (data: { weight_kg: number; date: string; notes?: string }) => Promise<void>;\n  onCheckExisting: (date: string) => Promise<WeightRecord | null>;\n  onUpdate: (id: string, data: { weight_kg: number; notes?: string }) => Promise<void>;\n  loading: boolean;\n  lastRecord?: WeightRecord | null;\n}\n\nexport function WeightForm({ onSubmit, onCheckExisting, onUpdate, loading, lastRecord }: WeightFormProps) {\n  const today = useMemo(() => getTodayJSTString(), []);\n\n  const [weight, setWeight] = useState<string>('');\n  const [selectedDate, setSelectedDate] = useState<string>(today);\n  const [notes, setNotes] = useState<string>('');\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string>('');\n\n  const [showDuplicateModal, setShowDuplicateModal] = useState(false);\n  const [existingRecord, setExistingRecord] = useState<WeightRecord | null>(null);\n  const [pendingData, setPendingData] = useState<{ weight_kg: number; date: string; notes?: string } | null>(null);\n\n  //  Toast\n  const [toastOpen, setToastOpen] = useState(false);\n  const [toastType, setToastType] = useState<'success' | 'error'>('success');\n  const [toastMsg, setToastMsg] = useState('');\n\n  const showToast = (type: 'success' | 'error', msg: string) => {\n    setToastType(type);\n    setToastMsg(msg);\n    setToastOpen(true);\n  };\n\n  const resetForm = () => {\n    setWeight('');\n    setNotes('');\n    setSelectedDate(today);\n  };\n\n  //  lastRecord\n  useEffect(() => {\n    if (!lastRecord) return;\n    if (weight.trim() !== '') return;\n    setWeight(String(lastRecord.weight_kg ?? ''));\n  }, [lastRecord, weight]);\n\n  //  \n  useEffect(() => {\n    const run = async () => {\n      setError('');\n      try {\n        const existing = await onCheckExisting(selectedDate);\n        setExistingRecord(existing);\n\n        if (existing) {\n          setWeight(String(existing.weight_kg ?? ''));\n          setNotes((existing as any).notes ?? '');\n          //  \n          showToast('success', '');\n        } else {\n          setNotes('');\n          // setWeight(''); //  \n        }\n      } catch (err) {\n        console.error('Error checking existing weight record:', err);\n        setExistingRecord(null);\n        setError('');\n        showToast('error', '');\n      }\n    };\n\n    run();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedDate]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (submitting || loading) return; //  \n    setError('');\n\n    const weightNum = parseFloat(weight);\n    if (isNaN(weightNum) || weightNum <= 0 || weightNum >= 500) {\n      setError('0500kg');\n      showToast('error', '');\n      return;\n    }\n\n    //  try/catch\n    let existing: WeightRecord | null = null;\n    try {\n      existing = await onCheckExisting(selectedDate);\n    } catch (err) {\n      console.error('Error checking existing weight record:', err);\n      setError('');\n      showToast('error', '');\n      return;\n    }\n\n    if (existing) {\n      setExistingRecord(existing);\n      setPendingData({\n        weight_kg: weightNum,\n        date: selectedDate,\n        notes: notes.trim() || undefined,\n      });\n      setShowDuplicateModal(true);\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      await onSubmit({\n        weight_kg: weightNum,\n        date: selectedDate,\n        notes: notes.trim() || undefined,\n      });\n\n      showToast('success', ' ');\n      resetForm();\n    } catch (err) {\n      console.error('Error submitting weight record:', err);\n      const msg = err instanceof Error ? err.message || '' : '';\n      setError(msg);\n      showToast('error', msg);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleOverwrite = async () => {\n    if (!existingRecord || !pendingData) return;\n    if (submitting || loading) return;\n\n    setSubmitting(true);\n    setShowDuplicateModal(false);\n    setError('');\n\n    try {\n      await onUpdate(existingRecord.id, {\n        weight_kg: pendingData.weight_kg,\n        notes: pendingData.notes,\n      });\n\n      showToast('success', ' ');\n      resetForm();\n\n      setExistingRecord(null);\n      setPendingData(null);\n    } catch (err) {\n      console.error('Error updating record:', err);\n      setError('');\n      showToast('error', '');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleCancelOverwrite = () => {\n    setShowDuplicateModal(false);\n    setExistingRecord(null);\n    setPendingData(null);\n  };\n\n  return (\n    <>\n      {/*  Toast */}\n      <Toast open={toastOpen} type={toastType} message={toastMsg} onClose={() => setToastOpen(false)} />\n\n      <GenericDuplicateModal\n        isOpen={showDuplicateModal}\n        onClose={handleCancelOverwrite}\n        onOverwrite={handleOverwrite}\n        onCancel={handleCancelOverwrite}\n        title=\"\"\n        date={selectedDate}\n        existingValues={[{ label: '', value: `${existingRecord?.weight_kg || 0} kg` }]}\n        newValues={[{ label: '', value: `${pendingData?.weight_kg || 0} kg` }]}\n      />\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        <div>\n          <label className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n            <Calendar className=\"w-4 h-4 mr-2\" />\n            \n          </label>\n          <input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            max={today}\n            disabled={submitting || loading}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60\"\n            style={{ fontSize: '16px' }}\n          />\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n            {selectedDate === today ? '' : ''}\n          </p>\n        </div>\n\n        <div>\n          <label className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n            <Scale className=\"w-4 h-4 mr-2\" />\n            kg\n          </label>\n          <input\n            type=\"number\"\n            step=\"0.1\"\n            min=\"1\"\n            max=\"499\"\n            value={weight}\n            onChange={(e) => setWeight(e.target.value)}\n            disabled={submitting || loading}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white disabled:opacity-60\"\n            placeholder=\"65.5\"\n            required\n            style={{ fontSize: '16px' }}\n          />\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">1: 65.5kg</p>\n\n          {lastRecord && (\n            <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">\n              : {Number(lastRecord.weight_kg).toFixed(1)} kg{new Date(lastRecord.date).toLocaleDateString('ja-JP')}\n            </p>\n          )}\n        </div>\n\n        <div>\n          <label className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n            <FileText className=\"w-4 h-4 mr-2\" />\n            \n          </label>\n          <textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            disabled={submitting || loading}\n            className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-base bg-white dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60\"\n            placeholder=\"...\"\n            rows={3}\n            maxLength={500}\n            style={{ fontSize: '16px' }}\n          />\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">{notes.length}/500</p>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n            <div className=\"flex items-center\">\n              <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400 mr-2\" />\n              <span className=\"text-sm text-red-700 dark:text-red-300\">{error}</span>\n            </div>\n          </div>\n        )}\n\n        <button\n          type=\"submit\"\n          disabled={submitting || loading || !weight}\n          className=\"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center touch-target\"\n          style={{ WebkitTapHighlightColor: 'transparent', touchAction: 'manipulation' }}\n        >\n          {submitting ? (\n            <>\n              <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n              ...\n            </>\n          ) : (\n            <>\n              <Scale className=\"w-5 h-5 mr-2\" />\n              \n            </>\n          )}\n        </button>\n      </form>\n    </>\n  );\n}","import React from 'react';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from 'recharts';\nimport { Database } from '../lib/database.types';\n\ntype WeightRecord = Database['public']['Tables']['weight_records']['Row'];\n\ninterface WeightChartProps {\n  data: WeightRecord[];\n}\n\ninterface ChartDataPoint {\n  date: string;\n  weight: number;\n  displayDate: string;\n}\n\nexport function WeightChart({ data }: WeightChartProps) {\n  const chartData: ChartDataPoint[] = data\n    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())\n    .map(record => ({\n      date: record.date,\n      weight: Number(record.weight_kg),\n      displayDate: new Date(record.date).toLocaleDateString('ja-JP', {\n        month: 'short',\n        day: 'numeric'\n      })\n    }));\n\n  if (chartData.length === 0) {\n    return (\n      <div className=\"h-64 sm:h-80 flex items-center justify-center text-gray-500 dark:text-gray-400\">\n        \n      </div>\n    );\n  }\n\n  const weights = chartData.map(d => d.weight);\n  const minWeight = Math.min(...weights);\n  const maxWeight = Math.max(...weights);\n  const range = maxWeight - minWeight;\n  const yAxisMin = Math.max(0, minWeight - range * 0.1);\n  const yAxisMax = maxWeight + range * 0.1;\n\n  return (\n    <div className=\"h-64 sm:h-80\">\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <LineChart\n          data={chartData}\n          margin={{ top: 5, right: 20, left: 0, bottom: 5 }}\n        >\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" className=\"dark:stroke-gray-700\" />\n          <XAxis\n            dataKey=\"displayDate\"\n            stroke=\"#6b7280\"\n            style={{ fontSize: '12px' }}\n            tick={{ fill: 'currentColor' }}\n            className=\"dark:text-gray-400\"\n          />\n          <YAxis\n            stroke=\"#6b7280\"\n            style={{ fontSize: '12px' }}\n            tick={{ fill: 'currentColor' }}\n            className=\"dark:text-gray-400\"\n            domain={[yAxisMin, yAxisMax]}\n            tickFormatter={(value) => `${value.toFixed(1)}`}\n            label={{ value: ' (kg)', angle: -90, position: 'insideLeft', fill: '#6b7280' }}\n          />\n          <Tooltip\n            contentStyle={{\n              backgroundColor: 'white',\n              border: '1px solid #e5e7eb',\n              borderRadius: '8px',\n              padding: '8px 12px'\n            }}\n            labelStyle={{ color: '#374151', fontWeight: 600 }}\n            formatter={(value: number) => [`${value.toFixed(1)} kg`, '']}\n            labelFormatter={(label) => {\n              const record = chartData.find(d => d.displayDate === label);\n              if (record) {\n                return new Date(record.date).toLocaleDateString('ja-JP', {\n                  year: 'numeric',\n                  month: 'long',\n                  day: 'numeric'\n                });\n              }\n              return label;\n            }}\n          />\n          <Legend\n            wrapperStyle={{ paddingTop: '20px' }}\n            iconType=\"line\"\n          />\n          <Line\n            type=\"monotone\"\n            dataKey=\"weight\"\n            stroke=\"#3b82f6\"\n            strokeWidth={3}\n            dot={{ fill: '#3b82f6', r: 4 }}\n            activeDot={{ r: 6 }}\n            name=\" (kg)\"\n          />\n        </LineChart>\n      </ResponsiveContainer>\n      {chartData.length > 1 && (\n        <div className=\"mt-4 flex items-center justify-center space-x-6 text-sm\">\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-green-500 rounded-full mr-2\"></div>\n            <span className=\"text-gray-600 dark:text-gray-400\">\n              : {minWeight.toFixed(1)} kg\n            </span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-red-500 rounded-full mr-2\"></div>\n            <span className=\"text-gray-600 dark:text-gray-400\">\n              : {maxWeight.toFixed(1)} kg\n            </span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-blue-500 rounded-full mr-2\"></div>\n            <span className=\"text-gray-600 dark:text-gray-400\">\n              : {(maxWeight - minWeight).toFixed(1)} kg\n            </span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { Scale, Calendar, CreditCard as Edit2, Trash2, FileText } from 'lucide-react';\nimport { Database } from '../lib/database.types';\n\ntype WeightRecord = Database['public']['Tables']['weight_records']['Row'];\n\ninterface WeightRecordsListProps {\n  records: WeightRecord[];\n  onUpdate: (id: string, data: { weight_kg: number; notes?: string }) => Promise<void>;\n  onDelete: (id: string) => Promise<void>;\n  loading: boolean;\n}\n\nexport function WeightRecordsList({ records, onUpdate, onDelete, loading }: WeightRecordsListProps) {\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editWeight, setEditWeight] = useState<string>('');\n  const [editNotes, setEditNotes] = useState<string>('');\n\n  const handleEdit = (record: WeightRecord) => {\n    setEditingId(record.id);\n    setEditWeight(record.weight_kg.toString());\n    setEditNotes(record.notes || '');\n  };\n\n  const handleSave = async (id: string) => {\n    const weightNum = parseFloat(editWeight);\n    if (isNaN(weightNum) || weightNum <= 0 || weightNum >= 500) {\n      alert('0500kg');\n      return;\n    }\n\n    try {\n      await onUpdate(id, {\n        weight_kg: weightNum,\n        notes: editNotes.trim() || undefined\n      });\n      setEditingId(null);\n      setEditWeight('');\n      setEditNotes('');\n    } catch (error) {\n      console.error('Error updating weight record:', error);\n      alert('');\n    }\n  };\n\n  const handleCancel = () => {\n    setEditingId(null);\n    setEditWeight('');\n    setEditNotes('');\n  };\n\n  const handleDelete = async (id: string, date: string) => {\n    if (confirm(`${new Date(date).toLocaleDateString('ja-JP')}`)) {\n      try {\n        await onDelete(id);\n      } catch (error) {\n        console.error('Error deleting weight record:', error);\n        alert('');\n      }\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (records.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <Scale className=\"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4\" />\n        <p className=\"text-gray-500 dark:text-gray-400\"></p>\n        <p className=\"text-sm text-gray-400 dark:text-gray-500 mt-2\"></p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h3>\n      <div className=\"space-y-3\">\n        {records.map((record) => (\n          <div\n            key={record.id}\n            className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors\"\n          >\n            {editingId === record.id ? (\n              <div className=\"space-y-3\">\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <label className=\"text-xs text-gray-600 dark:text-gray-400 mb-1 block\">\n                      \n                    </label>\n                    <div className=\"flex items-center text-sm text-gray-700 dark:text-gray-300\">\n                      <Calendar className=\"w-4 h-4 mr-2\" />\n                      {new Date(record.date).toLocaleDateString('ja-JP')}\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"text-xs text-gray-600 dark:text-gray-400 mb-1 block\">\n                      kg\n                    </label>\n                    <input\n                      type=\"number\"\n                      step=\"0.1\"\n                      min=\"1\"\n                      max=\"499\"\n                      value={editWeight}\n                      onChange={(e) => setEditWeight(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white\"\n                      style={{ fontSize: '16px' }}\n                    />\n                  </div>\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-600 dark:text-gray-400 mb-1 block\">\n                    \n                  </label>\n                  <textarea\n                    value={editNotes}\n                    onChange={(e) => setEditNotes(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white dark:bg-gray-800 dark:text-white resize-none\"\n                    rows={2}\n                    maxLength={500}\n                    style={{ fontSize: '16px' }}\n                  />\n                </div>\n                <div className=\"flex space-x-2\">\n                  <button\n                    onClick={() => handleSave(record.id)}\n                    className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\n                  >\n                    \n                  </button>\n                  <button\n                    onClick={handleCancel}\n                    className=\"flex-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors text-sm font-medium\"\n                  >\n                    \n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1 space-y-2\">\n                  <div className=\"flex items-center text-sm text-gray-600 dark:text-gray-400\">\n                    <Calendar className=\"w-4 h-4 mr-2\" />\n                    {new Date(record.date).toLocaleDateString('ja-JP', {\n                      year: 'numeric',\n                      month: 'long',\n                      day: 'numeric'\n                    })}\n                  </div>\n                  <div className=\"flex items-center\">\n                    <Scale className=\"w-5 h-5 mr-2 text-blue-600 dark:text-blue-400\" />\n                    <span className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                      {record.weight_kg}\n                    </span>\n                    <span className=\"text-lg text-gray-600 dark:text-gray-400 ml-1\">kg</span>\n                  </div>\n                  {record.notes && (\n                    <div className=\"flex items-start text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                      <FileText className=\"w-4 h-4 mr-2 mt-0.5 flex-shrink-0\" />\n                      <span className=\"whitespace-pre-wrap\">{record.notes}</span>\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex space-x-2 ml-4\">\n                  <button\n                    onClick={() => handleEdit(record)}\n                    className=\"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors\"\n                    title=\"\"\n                  >\n                    <Edit2 className=\"w-4 h-4\" />\n                  </button>\n                  <button\n                    onClick={() => handleDelete(record.id, record.date)}\n                    className=\"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors\"\n                    title=\"\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { ACWRData } from '../lib/acwr';\nimport { Database } from '../lib/database.types';\n\ntype WeightRecord = Database['public']['Tables']['weight_records']['Row'];\n\ninterface WeightACWRChartProps {\n  acwrData: ACWRData[];\n  weightData: WeightRecord[];\n}\n\nexport function WeightACWRChart({ acwrData, weightData }: WeightACWRChartProps) {\n  const combinedData = acwrData.map(acwr => {\n    const matchingWeight = weightData.find(w => w.date === acwr.date);\n\n    return {\n      date: new Date(acwr.date).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' }),\n      fullDate: acwr.date,\n      acwr: Number(acwr.acwr),\n      weight: matchingWeight ? Number(matchingWeight.weight_kg) : null,\n    };\n  });\n\n  if (combinedData.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400\">\n        \n      </div>\n    );\n  }\n\n  const CustomTooltip = ({ active, payload }: any) => {\n    if (active && payload && payload.length) {\n      const data = payload[0].payload;\n      return (\n        <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700\">\n          <p className=\"font-semibold text-gray-900 dark:text-white mb-2\">{data.fullDate}</p>\n          {payload.map((entry: any, index: number) => (\n            <p key={index} className=\"text-sm\" style={{ color: entry.color }}>\n              {entry.name}: {entry.value !== null ? Number(entry.value).toFixed(2) : '-'}\n            </p>\n          ))}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"w-full h-96\">\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <LineChart\n          data={combinedData}\n          margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\n        >\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" opacity={0.2} />\n          <XAxis\n            dataKey=\"date\"\n            stroke=\"#6B7280\"\n            tick={{ fill: '#6B7280' }}\n          />\n          <YAxis\n            yAxisId=\"left\"\n            stroke=\"#3B82F6\"\n            tick={{ fill: '#3B82F6' }}\n            label={{ value: 'ACWR', angle: -90, position: 'insideLeft', fill: '#3B82F6' }}\n          />\n          <YAxis\n            yAxisId=\"right\"\n            orientation=\"right\"\n            stroke=\"#10B981\"\n            tick={{ fill: '#10B981' }}\n            label={{ value: ' (kg)', angle: 90, position: 'insideRight', fill: '#10B981' }}\n          />\n          <Tooltip content={<CustomTooltip />} />\n          <Legend\n            wrapperStyle={{\n              paddingTop: '20px'\n            }}\n          />\n          <Line\n            yAxisId=\"left\"\n            type=\"monotone\"\n            dataKey=\"acwr\"\n            stroke=\"#3B82F6\"\n            strokeWidth={2}\n            dot={{ fill: '#3B82F6', r: 4 }}\n            name=\"ACWR\"\n            connectNulls\n          />\n          <Line\n            yAxisId=\"right\"\n            type=\"monotone\"\n            dataKey=\"weight\"\n            stroke=\"#10B981\"\n            strokeWidth={2}\n            dot={{ fill: '#10B981', r: 4 }}\n            name=\" (kg)\"\n            connectNulls\n          />\n        </LineChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n","import React from 'react';\nimport { TrendingUp, TrendingDown, AlertTriangle, Info, Lightbulb } from 'lucide-react';\nimport { ACWRData } from '../lib/acwr';\nimport { Database } from '../lib/database.types';\n\ntype WeightRecord = Database['public']['Tables']['weight_records']['Row'];\n\ninterface InsightCardProps {\n  acwrData: ACWRData[];\n  weightData: WeightRecord[];\n}\n\ninterface Insight {\n  type: 'info' | 'warning' | 'success' | 'discovery';\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n}\n\nexport function InsightCard({ acwrData, weightData }: InsightCardProps) {\n  const generateInsights = (): Insight[] => {\n    const insights: Insight[] = [];\n\n    if (weightData.length < 2 || acwrData.length < 2) {\n      return [{\n        type: 'info',\n        title: '',\n        description: 'ACWR',\n        icon: <Info className=\"w-5 h-5\" />\n      }];\n    }\n\n    const sortedWeights = [...weightData].sort((a, b) =>\n      new Date(a.date).getTime() - new Date(b.date).getTime()\n    );\n\n    const recentWeights = sortedWeights.slice(-7);\n    if (recentWeights.length >= 2) {\n      const firstWeight = Number(recentWeights[0].weight_kg);\n      const lastWeight = Number(recentWeights[recentWeights.length - 1].weight_kg);\n      const weightChange = lastWeight - firstWeight;\n      const changePercent = ((weightChange / firstWeight) * 100).toFixed(1);\n\n      if (Math.abs(weightChange) >= 2) {\n        const recentACWR = acwrData.slice(-7);\n        const highRiskDays = recentACWR.filter(d => d.riskLevel === 'high' || d.riskLevel === 'caution').length;\n\n        if (weightChange < 0 && highRiskDays >= 2) {\n          insights.push({\n            type: 'warning',\n            title: ': ',\n            description: `1${Math.abs(weightChange).toFixed(1)}kgACWR${highRiskDays}`,\n            icon: <AlertTriangle className=\"w-5 h-5\" />\n          });\n        } else if (Math.abs(weightChange) >= 2) {\n          insights.push({\n            type: 'info',\n            title: `${weightChange > 0 ? '' : ''}`,\n            description: `1${changePercent}%${weightChange > 0 ? '+' : ''}${weightChange.toFixed(1)}kg`,\n            icon: weightChange > 0 ? <TrendingUp className=\"w-5 h-5\" /> : <TrendingDown className=\"w-5 h-5\" />\n          });\n        }\n      }\n    }\n\n    const last30Days = acwrData.slice(-30);\n    const goodDays = last30Days.filter(d => d.riskLevel === 'good').length;\n    const highRiskDays = last30Days.filter(d => d.riskLevel === 'high').length;\n\n    if (goodDays >= 20 && weightData.length >= 10) {\n      const recent = sortedWeights.slice(-10);\n      const avgWeight = recent.reduce((sum, w) => sum + Number(w.weight_kg), 0) / recent.length;\n      const variance = recent.reduce((sum, w) => sum + Math.pow(Number(w.weight_kg) - avgWeight, 2), 0) / recent.length;\n\n      if (variance < 1) {\n        insights.push({\n          type: 'success',\n          title: '',\n          description: 'ACWR',\n          icon: <Lightbulb className=\"w-5 h-5\" />\n        });\n      }\n    }\n\n    if (highRiskDays >= 5) {\n      insights.push({\n        type: 'warning',\n        title: '',\n        description: `30${highRiskDays}`,\n        icon: <AlertTriangle className=\"w-5 h-5\" />\n      });\n    }\n\n    const allWeights = sortedWeights.map(w => Number(w.weight_kg));\n    if (allWeights.length >= 14) {\n      const firstHalf = allWeights.slice(0, 7);\n      const secondHalf = allWeights.slice(-7);\n\n      const avgFirst = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\n      const avgSecond = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\n\n      const firstHalfACWR = acwrData.slice(0, 7).map(d => Number(d.acwr));\n      const secondHalfACWR = acwrData.slice(-7).map(d => Number(d.acwr));\n\n      const avgACWRFirst = firstHalfACWR.reduce((a, b) => a + b, 0) / firstHalfACWR.length;\n      const avgACWRSecond = secondHalfACWR.reduce((a, b) => a + b, 0) / secondHalfACWR.length;\n\n      if ((avgSecond < avgFirst - 1) && (avgACWRSecond > avgACWRFirst + 0.2)) {\n        insights.push({\n          type: 'discovery',\n          title: ': ACWR',\n          description: 'ACWR',\n          icon: <Lightbulb className=\"w-5 h-5\" />\n        });\n      }\n    }\n\n    if (insights.length === 0) {\n      insights.push({\n        type: 'info',\n        title: '',\n        description: '',\n        icon: <Info className=\"w-5 h-5\" />\n      });\n    }\n\n    return insights;\n  };\n\n  const insights = generateInsights();\n\n  const getColorClasses = (type: string) => {\n    switch (type) {\n      case 'warning':\n        return {\n          bg: 'bg-yellow-50 dark:bg-yellow-900/20',\n          border: 'border-yellow-200 dark:border-yellow-800',\n          icon: 'text-yellow-600 dark:text-yellow-400',\n          title: 'text-yellow-900 dark:text-yellow-200',\n          desc: 'text-yellow-700 dark:text-yellow-300'\n        };\n      case 'success':\n        return {\n          bg: 'bg-green-50 dark:bg-green-900/20',\n          border: 'border-green-200 dark:border-green-800',\n          icon: 'text-green-600 dark:text-green-400',\n          title: 'text-green-900 dark:text-green-200',\n          desc: 'text-green-700 dark:text-green-300'\n        };\n      case 'discovery':\n        return {\n          bg: 'bg-purple-50 dark:bg-purple-900/20',\n          border: 'border-purple-200 dark:border-purple-800',\n          icon: 'text-purple-600 dark:text-purple-400',\n          title: 'text-purple-900 dark:text-purple-200',\n          desc: 'text-purple-700 dark:text-purple-300'\n        };\n      default:\n        return {\n          bg: 'bg-blue-50 dark:bg-blue-900/20',\n          border: 'border-blue-200 dark:border-blue-800',\n          icon: 'text-blue-600 dark:text-blue-400',\n          title: 'text-blue-900 dark:text-blue-200',\n          desc: 'text-blue-700 dark:text-blue-300'\n        };\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center\">\n        <Lightbulb className=\"w-5 h-5 mr-2 text-yellow-500\" />\n        \n      </h3>\n      {insights.map((insight, index) => {\n        const colors = getColorClasses(insight.type);\n        return (\n          <div\n            key={index}\n            className={`${colors.bg} ${colors.border} border rounded-lg p-4 transition-colors`}\n          >\n            <div className=\"flex items-start\">\n              <div className={`${colors.icon} mr-3 mt-0.5`}>\n                {insight.icon}\n              </div>\n              <div className=\"flex-1\">\n                <h4 className={`font-semibold ${colors.title} mb-1`}>\n                  {insight.title}\n                </h4>\n                <p className={`text-sm ${colors.desc}`}>\n                  {insight.description}\n                </p>\n              </div>\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","export interface BMIResult {\n  bmi: number;\n  category: 'underweight' | 'normal' | 'overweight' | 'obese';\n  categoryLabel: string;\n  healthRisk: 'low' | 'normal' | 'increased' | 'high';\n  idealWeightRange: { min: number; max: number };\n}\n\nexport function calculateBMI(weightKg: number, heightCm: number): number {\n  const heightM = heightCm / 100;\n  return weightKg / (heightM * heightM);\n}\n\nexport function getBMICategory(bmi: number): {\n  category: BMIResult['category'];\n  label: string;\n  healthRisk: BMIResult['healthRisk'];\n} {\n  if (bmi < 18.5) {\n    return {\n      category: 'underweight',\n      label: '',\n      healthRisk: 'increased'\n    };\n  } else if (bmi < 25) {\n    return {\n      category: 'normal',\n      label: '',\n      healthRisk: 'normal'\n    };\n  } else if (bmi < 30) {\n    return {\n      category: 'overweight',\n      label: '',\n      healthRisk: 'increased'\n    };\n  } else {\n    return {\n      category: 'obese',\n      label: '',\n      healthRisk: 'high'\n    };\n  }\n}\n\nexport function getIdealWeightRange(heightCm: number): { min: number; max: number } {\n  const heightM = heightCm / 100;\n  const minBMI = 18.5;\n  const maxBMI = 24.9;\n\n  return {\n    min: minBMI * heightM * heightM,\n    max: maxBMI * heightM * heightM\n  };\n}\n\nexport function getAthleteIdealWeightRange(\n  heightCm: number,\n  gender: 'male' | 'female' | null\n): { min: number; max: number } | null {\n  if (!gender) return null;\n\n  const heightM = heightCm / 100;\n\n  if (gender === 'male') {\n    const minBMI = 20;\n    const maxBMI = 25;\n    return {\n      min: minBMI * heightM * heightM,\n      max: maxBMI * heightM * heightM\n    };\n  } else {\n    const minBMI = 19;\n    const maxBMI = 24;\n    return {\n      min: minBMI * heightM * heightM,\n      max: maxBMI * heightM * heightM\n    };\n  }\n}\n\nexport function getAgeCorrectedIdealWeight(\n  heightCm: number,\n  age: number,\n  gender: 'male' | 'female' | null\n): { min: number; max: number } | null {\n  if (!gender) return null;\n\n  const heightM = heightCm / 100;\n  let minBMI: number;\n  let maxBMI: number;\n\n  if (age < 20) {\n    minBMI = gender === 'male' ? 19 : 18;\n    maxBMI = gender === 'male' ? 24 : 23;\n  } else if (age < 30) {\n    minBMI = gender === 'male' ? 20 : 19;\n    maxBMI = gender === 'male' ? 25 : 24;\n  } else if (age < 50) {\n    minBMI = gender === 'male' ? 21 : 20;\n    maxBMI = gender === 'male' ? 26 : 25;\n  } else {\n    minBMI = gender === 'male' ? 22 : 21;\n    maxBMI = gender === 'male' ? 27 : 26;\n  }\n\n  return {\n    min: minBMI * heightM * heightM,\n    max: maxBMI * heightM * heightM\n  };\n}\n\nexport function getBMIAnalysis(\n  weightKg: number,\n  heightCm: number,\n  age?: number,\n  gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say' | null\n): BMIResult {\n  const bmi = calculateBMI(weightKg, heightCm);\n  const { category, label, healthRisk } = getBMICategory(bmi);\n\n  let idealWeightRange: { min: number; max: number };\n\n  const genderForCalc = (gender === 'male' || gender === 'female') ? gender : null;\n\n  if (age && genderForCalc) {\n    const ageCorrected = getAgeCorrectedIdealWeight(heightCm, age, genderForCalc);\n    idealWeightRange = ageCorrected || getIdealWeightRange(heightCm);\n  } else if (genderForCalc) {\n    const athleteRange = getAthleteIdealWeightRange(heightCm, genderForCalc);\n    idealWeightRange = athleteRange || getIdealWeightRange(heightCm);\n  } else {\n    idealWeightRange = getIdealWeightRange(heightCm);\n  }\n\n  return {\n    bmi,\n    category,\n    categoryLabel: label,\n    healthRisk,\n    idealWeightRange\n  };\n}\n\nexport function getBMITrend(\n  weightRecords: Array<{ date: string; weight_kg: number }>,\n  heightCm: number\n): Array<{ date: string; bmi: number }> {\n  return weightRecords.map(record => ({\n    date: record.date,\n    bmi: calculateBMI(record.weight_kg, heightCm)\n  }));\n}\n\nexport function calculateAge(dateOfBirth: string): number {\n  const birth = new Date(dateOfBirth);\n  const today = new Date();\n  let age = today.getFullYear() - birth.getFullYear();\n  const monthDiff = today.getMonth() - birth.getMonth();\n  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n    age--;\n  }\n  return age;\n}\n","import React from 'react';\nimport { Activity, TrendingUp, TrendingDown, AlertCircle } from 'lucide-react';\nimport { getBMIAnalysis, calculateAge } from '../lib/bmiCalculations';\n\ninterface BMIDisplayProps {\n  weightKg: number;\n  heightCm: number;\n  dateOfBirth?: string | null;\n  gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say' | null;\n}\n\nexport function BMIDisplay({ weightKg, heightCm, dateOfBirth, gender }: BMIDisplayProps) {\n  const age = dateOfBirth ? calculateAge(dateOfBirth) : undefined;\n  const analysis = getBMIAnalysis(weightKg, heightCm, age, gender);\n\n  const getCategoryColor = (category: string) => {\n    switch (category) {\n      case 'underweight':\n        return 'text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20 dark:text-yellow-400';\n      case 'normal':\n        return 'text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400';\n      case 'overweight':\n        return 'text-orange-600 bg-orange-50 dark:bg-orange-900/20 dark:text-orange-400';\n      case 'obese':\n        return 'text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400';\n      default:\n        return 'text-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-gray-400';\n    }\n  };\n\n  const getRiskIcon = () => {\n    if (analysis.healthRisk === 'high') {\n      return <AlertCircle className=\"w-5 h-5 text-red-500\" />;\n    } else if (analysis.healthRisk === 'increased') {\n      return <AlertCircle className=\"w-5 h-5 text-yellow-500\" />;\n    }\n    return <Activity className=\"w-5 h-5 text-green-500\" />;\n  };\n\n  const isWithinIdealRange = weightKg >= analysis.idealWeightRange.min && weightKg <= analysis.idealWeightRange.max;\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">BMI</h3>\n        {getRiskIcon()}\n      </div>\n\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex-1\">\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">BMI</p>\n            <p className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n              {analysis.bmi.toFixed(1)}\n            </p>\n          </div>\n          <div className={`px-4 py-2 rounded-lg font-medium text-sm ${getCategoryColor(analysis.category)}`}>\n            {analysis.categoryLabel}\n          </div>\n        </div>\n\n        <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\n            {age && gender ? `${age}${gender === 'male' ? '' : gender === 'female' ? '' : ''}` : ''}\n          </p>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {analysis.idealWeightRange.min.toFixed(1)} kg\n              </p>\n            </div>\n            <div className=\"flex-1 mx-4\">\n              <div className=\"relative h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden\">\n                <div\n                  className=\"absolute h-full bg-green-500 rounded-full\"\n                  style={{\n                    left: '0%',\n                    width: '100%'\n                  }}\n                />\n                {!isWithinIdealRange && (\n                  <div\n                    className=\"absolute h-full w-1 bg-red-500\"\n                    style={{\n                      left: `${Math.min(100, Math.max(0, ((weightKg - analysis.idealWeightRange.min) / (analysis.idealWeightRange.max - analysis.idealWeightRange.min)) * 100))}%`\n                    }}\n                  />\n                )}\n              </div>\n            </div>\n            <div>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {analysis.idealWeightRange.max.toFixed(1)} kg\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3\">\n          {weightKg < analysis.idealWeightRange.min ? (\n            <>\n              <TrendingUp className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n              <p className=\"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3\">\n                 <strong>{(analysis.idealWeightRange.min - weightKg).toFixed(1)} kg</strong> \n              </p>\n            </>\n          ) : weightKg > analysis.idealWeightRange.max ? (\n            <>\n              <TrendingDown className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n              <p className=\"text-sm text-blue-700 dark:text-blue-300 flex-1 ml-3\">\n                 <strong>{(weightKg - analysis.idealWeightRange.max).toFixed(1)} kg</strong> \n              </p>\n            </>\n          ) : (\n            <>\n              <Activity className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n              <p className=\"text-sm text-green-700 dark:text-green-300 flex-1 ml-3\">\n                \n              </p>\n            </>\n          )}\n        </div>\n\n        {age && gender && (\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n             \n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n","// src/components/ProfileEditForm.tsx\nimport React, { useState } from 'react';\nimport { User as UserIcon, Calendar, Ruler, Users, Save, AlertCircle, Phone } from 'lucide-react';\nimport { supabase } from '../lib/supabase';\nimport { Database } from '../lib/database.types';\nimport { getYearsAgoString } from '../lib/date';\n\ntype UserProfile = Database['public']['Tables']['users']['Row'];\ntype UserUpdate = Database['public']['Tables']['users']['Update'];\n\ninterface ProfileEditFormProps {\n  user: UserProfile;\n  onUpdate: () => void;\n  onClose: () => void;\n}\n\n/**\n * \n * - \n * - //\n * - +81 / 81  0 : +8190... / 8190...  090...\n */\nfunction normalizePhoneNumber(input: string) {\n  if (!input) return '';\n  const half = input.replace(/[-]/g, (s) => String.fromCharCode(s.charCodeAt(0) - 0xfee0));\n  let digits = half.replace(/\\D/g, '');\n\n  // 81  0 \n  if (digits.startsWith('81')) {\n    digits = '0' + digits.slice(2);\n  }\n  return digits;\n}\n\n/**\n * 070 / 080 / 090\n * - OK\n * - 0[7-9]0 + 8 = 11\n */\nfunction isLikelyJpMobile(phoneDigits: string) {\n  if (!phoneDigits) return true;\n  return /^0[7-9]0\\d{8}$/.test(phoneDigits);\n}\n\nexport function ProfileEditForm({ user, onUpdate, onClose }: ProfileEditFormProps) {\n  const [name, setName] = useState(user.name ?? '');\n  const [gender, setGender] = useState<string>(user.gender || '');\n  const [heightCm, setHeightCm] = useState<string>(user.height_cm?.toString() || '');\n  const [dateOfBirth, setDateOfBirth] = useState<string>(user.date_of_birth || '');\n  const [phoneNumber, setPhoneNumber] = useState<string>(user.phone_number || '');\n\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string>('');\n  const [success, setSuccess] = useState(false);\n\n  const calculateAge = () => {\n    if (!dateOfBirth) return null;\n    const birth = new Date(dateOfBirth);\n    const today = new Date();\n    let age = today.getFullYear() - birth.getFullYear();\n    const monthDiff = today.getMonth() - birth.getMonth();\n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) age--;\n    return age;\n  };\n\n  const age = calculateAge();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setSuccess(false);\n    setLoading(true);\n\n    try {\n      const trimmedName = name.trim();\n      if (!trimmedName) throw new Error('');\n\n      const parsedHeight = heightCm ? Number(heightCm) : null;\n      if (parsedHeight !== null && (Number.isNaN(parsedHeight) || parsedHeight < 100 || parsedHeight > 250)) {\n        throw new Error('100250cm');\n      }\n\n      if (dateOfBirth) {\n        const birthDate = new Date(dateOfBirth);\n        const today = new Date();\n        const ageGuess = today.getFullYear() - birthDate.getFullYear();\n        if (Number.isNaN(birthDate.getTime()) || ageGuess < 10 || ageGuess > 150) {\n          throw new Error('10');\n        }\n      }\n\n      const normalizedPhone = normalizePhoneNumber(phoneNumber);\n\n      // \n      if (!isLikelyJpMobile(normalizedPhone)) {\n        throw new Error('070 / 080 / 090OK');\n      }\n\n      const updateData: UserUpdate = {\n        name: trimmedName,\n        gender: gender || null,\n        height_cm: parsedHeight,\n        date_of_birth: dateOfBirth || null,\n        phone_number: normalizedPhone || null, // \n      };\n\n      const { error: updateError } = await supabase.from('users').update(updateData).eq('id', user.id);\n      if (updateError) throw updateError;\n\n      setSuccess(true);\n      setTimeout(() => {\n        onUpdate();\n        onClose();\n      }, 1200);\n    } catch (err) {\n      console.error('Error updating profile:', err);\n      setError(err instanceof Error ? err.message : '');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const normalizedPreview = normalizePhoneNumber(phoneNumber);\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center\">\n              <UserIcon className=\"w-6 h-6 mr-2\" />\n              \n            </h2>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              type=\"button\"\n            >\n              <span className=\"text-2xl\">&times;</span>\n            </button>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/*  */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n              <input\n                type=\"text\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white\"\n                required\n              />\n            </div>\n\n            {/*  */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center\">\n                <Phone className=\"w-4 h-4 mr-2\" />\n                \n              </label>\n              <input\n                type=\"tel\"\n                inputMode=\"tel\"\n                value={phoneNumber}\n                onChange={(e) => setPhoneNumber(e.target.value)}\n                className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white\"\n                placeholder=\"090-1234-5678+81 OK\"\n              />\n              <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-1\">\n                <p>CSV InBody </p>\n                {!!phoneNumber && (\n                  <p>\n                    : <span className=\"font-mono\">{normalizedPreview}</span>\n                  </p>\n                )}\n              </div>\n            </div>\n\n            {/*  */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center\">\n                <Users className=\"w-4 h-4 mr-2\" />\n                \n              </label>\n              <select\n                value={gender}\n                onChange={(e) => setGender(e.target.value)}\n                className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white\"\n              >\n                <option value=\"\"></option>\n                <option value=\"male\"></option>\n                <option value=\"female\"></option>\n                <option value=\"other\"></option>\n                <option value=\"prefer_not_to_say\"></option>\n              </select>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                \n              </p>\n            </div>\n\n            {/*  */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center\">\n                <Ruler className=\"w-4 h-4 mr-2\" />\n                cm\n              </label>\n              <input\n                type=\"number\"\n                step=\"0.1\"\n                min=\"100\"\n                max=\"250\"\n                value={heightCm}\n                onChange={(e) => setHeightCm(e.target.value)}\n                className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white\"\n                placeholder=\"175.5\"\n              />\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                BMI100250cm\n              </p>\n            </div>\n\n            {/*  */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center\">\n                <Calendar className=\"w-4 h-4 mr-2\" />\n                \n              </label>\n              <input\n                type=\"date\"\n                value={dateOfBirth}\n                onChange={(e) => setDateOfBirth(e.target.value)}\n                max={getYearsAgoString(10)}\n                className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 dark:text-white\"\n              />\n              {age !== null && (\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">: {age}</p>\n              )}\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                \n              </p>\n            </div>\n\n            {/*  */}\n            {error && (\n              <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n                <div className=\"flex items-center\">\n                  <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400 mr-2\" />\n                  <span className=\"text-sm text-red-700 dark:text-red-300\">{error}</span>\n                </div>\n              </div>\n            )}\n\n            {/*  */}\n            {success && (\n              <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4\">\n                <div className=\"flex items-center\">\n                  <Save className=\"w-5 h-5 text-green-600 dark:text-green-400 mr-2\" />\n                  <span className=\"text-sm text-green-700 dark:text-green-300\"></span>\n                </div>\n              </div>\n            )}\n\n            {/*  */}\n            <div className=\"flex space-x-3 pt-4\">\n              <button\n                type=\"submit\"\n                disabled={loading || success}\n                className=\"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center\"\n              >\n                {loading ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                    ...\n                  </>\n                ) : (\n                  <>\n                    <Save className=\"w-5 h-5 mr-2\" />\n                    \n                  </>\n                )}\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={onClose}\n                disabled={loading}\n                className=\"flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium\"\n              >\n                \n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}","// src/components/TutorialOverlay.tsx\nimport React, { useEffect, useId, useRef, useState } from 'react';\n\ninterface TutorialOverlayProps {\n  targetElement?: HTMLElement | null;\n  padding?: number;\n  zIndex?: number; // Overlayz\n  onClick?: () => void;\n}\n\nexport function TutorialOverlay({\n  targetElement,\n  padding = 8,\n  zIndex = 10000,\n  onClick,\n}: TutorialOverlayProps) {\n  const [highlightRect, setHighlightRect] = useState<DOMRect | null>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  const maskId = useId(); //  \n\n  useEffect(() => {\n    if (!targetElement) {\n      setHighlightRect(null);\n      return;\n    }\n\n    const updateRect = () => {\n      const rect = targetElement.getBoundingClientRect();\n      setHighlightRect(rect);\n    };\n\n    updateRect();\n\n    window.addEventListener('resize', updateRect);\n    window.addEventListener('scroll', updateRect, true);\n\n    return () => {\n      window.removeEventListener('resize', updateRect);\n      window.removeEventListener('scroll', updateRect, true);\n    };\n  }, [targetElement]);\n\n  const handleOverlayClick = (e: React.MouseEvent) => {\n    //   \n    if (e.target === overlayRef.current) {\n      onClick?.();\n    }\n  };\n\n  return (\n    <div\n      ref={overlayRef}\n      className=\"fixed inset-0 transition-all duration-300\"\n      style={{ zIndex }}\n      onClick={handleOverlayClick}\n      aria-hidden=\"true\"\n    >\n      <svg\n        className=\"absolute inset-0 w-full h-full pointer-events-none\"\n        style={{ zIndex: zIndex + 1 }}\n      >\n        <defs>\n          <mask id={`tutorial-mask-${maskId}`}>\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"white\" />\n            {highlightRect && (\n              <rect\n                x={highlightRect.left - padding}\n                y={highlightRect.top - padding}\n                width={highlightRect.width + padding * 2}\n                height={highlightRect.height + padding * 2}\n                rx=\"8\"\n                fill=\"black\"\n              />\n            )}\n          </mask>\n        </defs>\n\n        <rect\n          x=\"0\"\n          y=\"0\"\n          width=\"100%\"\n          height=\"100%\"\n          fill=\"rgba(0, 0, 0, 0.7)\"\n          mask={`url(#tutorial-mask-${maskId})`}\n        />\n\n        {highlightRect && (\n          <rect\n            x={highlightRect.left - padding}\n            y={highlightRect.top - padding}\n            width={highlightRect.width + padding * 2}\n            height={highlightRect.height + padding * 2}\n            rx=\"8\"\n            fill=\"none\"\n            stroke=\"#3B82F6\"\n            strokeWidth=\"3\"\n            className=\"animate-pulse\"\n          />\n        )}\n      </svg>\n    </div>\n  );\n}","import React, { useEffect, useRef, useState } from 'react';\nimport { X } from 'lucide-react';\n\nexport type TooltipPosition = 'top' | 'bottom' | 'left' | 'right' | 'center';\n\ninterface TutorialTooltipProps {\n  targetElement?: HTMLElement | null;\n  position?: TooltipPosition;\n  title: string;\n  description: string;\n  currentStep: number;\n  totalSteps: number;\n  onNext?: () => void;\n  onPrev?: () => void;\n  onSkip?: () => void;\n  onClose?: () => void;\n  showPrev?: boolean;\n  nextLabel?: string;\n  zIndex?: number;\n}\n\nexport function TutorialTooltip({\n  targetElement,\n  position = 'bottom',\n  title,\n  description,\n  currentStep,\n  totalSteps,\n  onNext,\n  onPrev,\n  onSkip,\n  onClose,\n  showPrev = true,\n  nextLabel = '',\n  zIndex = 9999,\n}: TutorialTooltipProps) {\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const [tooltipStyle, setTooltipStyle] = useState<React.CSSProperties>({});\n\n  useEffect(() => {\n    if (targetElement && tooltipRef.current) {\n      const updatePosition = () => {\n        const targetRect = targetElement.getBoundingClientRect();\n        const tooltipRect = tooltipRef.current!.getBoundingClientRect();\n        const padding = 16;\n        let top = 0;\n        let left = 0;\n\n        if (position === 'center') {\n          top = window.innerHeight / 2 - tooltipRect.height / 2;\n          left = window.innerWidth / 2 - tooltipRect.width / 2;\n        } else {\n          switch (position) {\n            case 'top':\n              top = targetRect.top - tooltipRect.height - padding;\n              left = targetRect.left + (targetRect.width - tooltipRect.width) / 2;\n              break;\n            case 'bottom':\n              top = targetRect.bottom + padding;\n              left = targetRect.left + (targetRect.width - tooltipRect.width) / 2;\n              break;\n            case 'left':\n              top = targetRect.top + (targetRect.height - tooltipRect.height) / 2;\n              left = targetRect.left - tooltipRect.width - padding;\n              break;\n            case 'right':\n              top = targetRect.top + (targetRect.height - tooltipRect.height) / 2;\n              left = targetRect.right + padding;\n              break;\n          }\n\n          left = Math.max(padding, Math.min(left, window.innerWidth - tooltipRect.width - padding));\n          top = Math.max(padding, Math.min(top, window.innerHeight - tooltipRect.height - padding));\n        }\n\n        setTooltipStyle({\n          position: 'fixed',\n          top: `${top}px`,\n          left: `${left}px`,\n          zIndex,\n        });\n      };\n\n      updatePosition();\n      window.addEventListener('resize', updatePosition);\n      window.addEventListener('scroll', updatePosition, true);\n\n      return () => {\n        window.removeEventListener('resize', updatePosition);\n        window.removeEventListener('scroll', updatePosition, true);\n      };\n    } else if (!targetElement && position === 'center') {\n      setTooltipStyle({\n        position: 'fixed',\n        top: '50%',\n        left: '50%',\n        transform: 'translate(-50%, -50%)',\n        zIndex,\n      });\n    }\n  }, [targetElement, position, zIndex]);\n\n  return (\n    <div\n      ref={tooltipRef}\n      style={tooltipStyle}\n      className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl border-2 border-blue-500 dark:border-blue-400 w-[90vw] max-w-3xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-300\"\n      role=\"dialog\"\n      aria-labelledby=\"tutorial-title\"\n      aria-describedby=\"tutorial-description\"\n    >\n      <div className=\"p-5 sm:p-6 md:p-8\">\n        <div className=\"flex items-start justify-between mb-3\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-1.5\">\n              <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200\">\n                {currentStep} / {totalSteps}\n              </span>\n            </div>\n            <h3\n              id=\"tutorial-title\"\n              className=\"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900 dark:text-white pr-1\"\n            >\n              {title}\n            </h3>\n          </div>\n          {onClose && (\n            <button\n              onClick={onClose}\n              className=\"ml-1 flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n              aria-label=\"\"\n            >\n              <X className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            </button>\n          )}\n        </div>\n\n        <p\n          id=\"tutorial-description\"\n          className=\"text-sm sm:text-base md:text-lg text-gray-600 dark:text-gray-300 mb-5 sm:mb-6 leading-relaxed\"\n        >\n          {description}\n        </p>\n\n        <div className=\"flex items-center justify-between gap-2 flex-wrap sm:flex-nowrap\">\n          <div className=\"flex gap-1.5 sm:gap-2\">\n            {showPrev && onPrev && currentStep > 1 && (\n              <button\n                onClick={onPrev}\n                className=\"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\n              >\n                \n              </button>\n            )}\n            {onSkip && (\n              <button\n                onClick={onSkip}\n                className=\"px-4 py-2 sm:px-5 sm:py-2.5 text-sm sm:text-base font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors\"\n              >\n                \n              </button>\n            )}\n          </div>\n\n          {onNext && (\n            <button\n              onClick={onNext}\n              className=\"px-5 py-2 sm:px-7 sm:py-2.5 text-sm sm:text-base font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors shadow-sm\"\n            >\n              {currentStep === totalSteps ? '' : nextLabel}\n            </button>\n          )}\n        </div>\n      </div>\n\n      <div className=\"h-1 bg-gray-200 dark:bg-gray-700\">\n        <div\n          className=\"h-full bg-blue-600 dark:bg-blue-500 transition-all duration-300\"\n          style={{ width: `${(currentStep / totalSteps) * 100}%` }}\n        />\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport { CheckCircle, Circle } from 'lucide-react';\n\ninterface TutorialProgressProps {\n  currentStep: number;\n  totalSteps: number;\n  stepTitles?: string[];\n  className?: string;\n}\n\nexport function TutorialProgress({\n  currentStep,\n  totalSteps,\n  stepTitles,\n  className = '',\n}: TutorialProgressProps) {\n  return (\n    <div className={`flex items-center justify-center gap-2 ${className}`}>\n      {Array.from({ length: totalSteps }, (_, i) => i + 1).map((step) => {\n        const isCompleted = step < currentStep;\n        const isCurrent = step === currentStep;\n        const stepTitle = stepTitles?.[step - 1];\n\n        return (\n          <div\n            key={step}\n            className=\"flex items-center gap-2\"\n            title={stepTitle}\n          >\n            <div className=\"relative flex items-center justify-center\">\n              {isCompleted ? (\n                <CheckCircle className=\"w-6 h-6 text-green-500 dark:text-green-400\" />\n              ) : (\n                <Circle\n                  className={`w-6 h-6 ${\n                    isCurrent\n                      ? 'text-blue-600 dark:text-blue-400 fill-blue-100 dark:fill-blue-900'\n                      : 'text-gray-300 dark:text-gray-600'\n                  }`}\n                />\n              )}\n              {isCurrent && (\n                <div className=\"absolute inset-0 rounded-full border-2 border-blue-600 dark:border-blue-400 animate-ping\" />\n              )}\n            </div>\n            {step < totalSteps && (\n              <div\n                className={`w-8 h-0.5 ${\n                  isCompleted\n                    ? 'bg-green-500 dark:bg-green-400'\n                    : 'bg-gray-300 dark:bg-gray-600'\n                }`}\n              />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","// src/components/TutorialController.tsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { TutorialOverlay } from './TutorialOverlay';\nimport { TutorialTooltip, TooltipPosition } from './TutorialTooltip';\nimport { TutorialProgress } from './TutorialProgress';\n\nexport interface TutorialStep {\n  id: string;\n  title: string;\n  description: string;\n  targetSelector?: string;\n  position?: TooltipPosition;\n  action?: () => void | Promise<void>;\n  beforeStep?: () => void | Promise<void>;\n  afterStep?: () => void | Promise<void>;\n}\n\ninterface TutorialControllerProps {\n  steps: TutorialStep[];\n  isActive: boolean;\n  onComplete: () => void;\n  onSkip: () => void;\n  currentStepIndex?: number;\n  onStepChange?: (stepIndex: number) => void;\n  showProgress?: boolean;\n}\n\nexport function TutorialController({\n  steps,\n  isActive,\n  onComplete,\n  onSkip,\n  currentStepIndex: externalStepIndex,\n  onStepChange,\n  showProgress = true,\n}: TutorialControllerProps) {\n  const [internalStepIndex, setInternalStepIndex] = useState(0);\n  const [targetElement, setTargetElement] = useState<HTMLElement | null>(null);\n  const [isExecutingAction, setIsExecutingAction] = useState(false);\n\n  const currentStepIndex = externalStepIndex ?? internalStepIndex;\n  const setCurrentStepIndex = onStepChange ?? setInternalStepIndex;\n\n  const currentStep = steps[currentStepIndex];\n\n  useEffect(() => {\n    if (!isActive || !currentStep) {\n      setTargetElement(null);\n      return;\n    }\n\n    let cancelled = false;\n\n    const updateTargetElement = () => {\n      if (cancelled) return;\n\n      if (currentStep.targetSelector) {\n        const element = document.querySelector(currentStep.targetSelector) as HTMLElement | null;\n        if (element) {\n          setTargetElement(element);\n          //  'auto' OK\n          try {\n            element.scrollIntoView({ behavior: 'smooth', block: 'center' });\n          } catch {\n            // ignore\n          }\n        } else {\n          setTargetElement(null);\n        }\n      } else {\n        setTargetElement(null);\n      }\n    };\n\n    const executeBeforeStep = async () => {\n      try {\n        if (currentStep.beforeStep) {\n          await currentStep.beforeStep();\n        }\n      } catch (e) {\n        console.warn('[Tutorial] beforeStep error', e);\n      }\n    };\n\n    executeBeforeStep().then(updateTargetElement);\n\n    const observer = new MutationObserver(updateTargetElement);\n    observer.observe(document.body, { childList: true, subtree: true });\n\n    return () => {\n      cancelled = true;\n      observer.disconnect();\n    };\n  }, [isActive, currentStep, currentStepIndex]);\n\n  const handleNext = useCallback(async () => {\n    if (isExecutingAction) return;\n    if (!currentStep) return;\n\n    try {\n      setIsExecutingAction(true);\n\n      try {\n        if (currentStep.afterStep) await currentStep.afterStep();\n      } catch (e) {\n        console.warn('[Tutorial] afterStep error', e);\n      }\n\n      try {\n        if (currentStep.action) await currentStep.action();\n      } catch (e) {\n        console.warn('[Tutorial] action error', e);\n      }\n\n      if (currentStepIndex < steps.length - 1) {\n        setCurrentStepIndex(currentStepIndex + 1);\n      } else {\n        onComplete();\n      }\n    } finally {\n      setIsExecutingAction(false);\n    }\n  }, [currentStepIndex, steps.length, currentStep, onComplete, setCurrentStepIndex, isExecutingAction]);\n\n  const handlePrev = useCallback(() => {\n    if (currentStepIndex > 0 && !isExecutingAction) {\n      setCurrentStepIndex(currentStepIndex - 1);\n    }\n  }, [currentStepIndex, setCurrentStepIndex, isExecutingAction]);\n\n  const handleSkip = useCallback(() => {\n    if (!isExecutingAction) {\n      onSkip();\n    }\n  }, [onSkip, isExecutingAction]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isActive) return;\n\n      if (e.key === 'Escape') {\n        handleSkip();\n      } else if (e.key === 'Enter') {\n        handleNext();\n      } else if (e.key === 'ArrowLeft' && currentStepIndex > 0) {\n        handlePrev();\n      } else if (e.key === 'ArrowRight' && currentStepIndex < steps.length - 1) {\n        handleNext();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isActive, currentStepIndex, steps.length, handleNext, handlePrev, handleSkip]);\n\n  if (!isActive || !currentStep) {\n    return null;\n  }\n\n  return (\n    <>\n      {/*  Overlay(z:10000) */}\n      <TutorialOverlay targetElement={targetElement} onClick={handleSkip} />\n\n      {/*  Overlayz:10001 */}\n      <div className=\"fixed inset-0 z-[10001] pointer-events-none\">\n        <div\n          className=\"pointer-events-auto\"\n          onClick={(e) => {\n            // Tooltip Overlay \n            e.stopPropagation();\n          }}\n        >\n          <TutorialTooltip\n            targetElement={targetElement}\n            position={currentStep.position || 'bottom'}\n            title={currentStep.title}\n            description={currentStep.description}\n            currentStep={currentStepIndex + 1}\n            totalSteps={steps.length}\n            onNext={handleNext}\n            onPrev={currentStepIndex > 0 ? handlePrev : undefined}\n            onSkip={handleSkip}\n            showPrev={currentStepIndex > 0}\n          />\n        </div>\n      </div>\n\n      {showProgress && (\n        <div className=\"fixed top-4 left-1/2 transform -translate-x-1/2 z-[10002] pointer-events-none\">\n          <TutorialProgress\n            currentStep={currentStepIndex + 1}\n            totalSteps={steps.length}\n            stepTitles={steps.map((s) => s.title)}\n          />\n        </div>\n      )}\n    </>\n  );\n}","// src/hooks/useTrainingData.ts\nimport { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\nimport { supabase, TrainingRecord, WeightRecord } from \"../lib/supabase\";\nimport { calculateACWR, ACWRData, RecordLike } from \"../lib/acwr\";\nimport { logEvent } from \"../lib/logEvent\";\n\ntype TrainingUpsertPayload = {\n  rpe: number;\n  duration_min: number;\n  date: string; // \"YYYY-MM-DD\" or ISO string\n  arrow_score: number;\n  signal_score: number;\n};\n\n/**\n * DB training_records.date \n * - 'date'        : \"YYYY-MM-DD\"\n * - 'timestamptz' : ISO\n */\nconst DATE_MODE: \"date\" | \"timestamptz\" = \"date\";\n\nfunction toNumber(v: any): number | null {\n  if (v === null || v === undefined || v === \"\") return null;\n  const n = typeof v === \"number\" ? v : Number(v);\n  return Number.isFinite(n) ? n : null;\n}\n\nfunction toYMD(input: string) {\n  if (!input) return null;\n  const m = String(input).match(/^(\\d{4}-\\d{2}-\\d{2})/);\n  return m ? m[1] : null;\n}\n\nfunction jstDayRangeISO(ymd: string) {\n  const startJST = new Date(`${ymd}T00:00:00+09:00`);\n  const endJST = new Date(`${ymd}T23:59:59.999+09:00`);\n  return {\n    startISO: startJST.toISOString(),\n    endISO: endJST.toISOString(),\n  };\n}\n\nfunction toDbDateValue(input: string): string {\n  const ymd = toYMD(input);\n  if (!ymd) throw new Error(\"Invalid date\");\n\n  if (DATE_MODE === \"date\") return ymd;\n\n  return jstDayRangeISO(ymd).startISO;\n}\n\nfunction toACWRDateKey(dbDate: any): string | null {\n  if (!dbDate) return null;\n\n  if (typeof dbDate === \"string\" && /^\\d{4}-\\d{2}-\\d{2}$/.test(dbDate)) return dbDate;\n\n  const ymd = toYMD(String(dbDate));\n  return ymd ?? null;\n}\n\nfunction sortByDateAsc(a: any, b: any) {\n  const ad = String(a?.date ?? \"\");\n  const bd = String(b?.date ?? \"\");\n  return ad.localeCompare(bd);\n}\n\nfunction upsertLocalTrainingRecord(prev: TrainingRecord[], row: TrainingRecord) {\n  const next = [...(prev || [])];\n  const idx = next.findIndex((r) => r.id === row.id);\n  if (idx >= 0) next[idx] = row;\n  else next.push(row);\n  next.sort(sortByDateAsc);\n  return next;\n}\n\nfunction removeLocalTrainingRecord(prev: TrainingRecord[], recordId: string) {\n  const next = (prev || []).filter((r) => r.id !== recordId);\n  next.sort(sortByDateAsc);\n  return next;\n}\n\nexport function useTrainingData(userId: string) {\n  const [trainingRecords, setTrainingRecords] = useState<TrainingRecord[]>([]);\n  const [weightRecords, setWeightRecords] = useState<WeightRecord[]>([]);\n  const [acwrData, setACWRData] = useState<ACWRData[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  //  DEV\n  const DEBUG_FETCH = import.meta.env.DEV;\n\n  //  fetch/fetch\n  const inFlightRef = useRef(false);\n  const lastFetchKeyRef = useRef<string | null>(null);\n\n  //  logEvent \n  const safeLogEvent = useCallback(\n    async (eventType: string, payload: Record<string, any>) => {\n      await logEvent({ userId, eventType, payload });\n    },\n    [userId]\n  );\n\n  const fetchAll = useCallback(async () => {\n    if (!userId) return;\n\n    //  userId \n    const fetchKey = `user:${userId}`;\n    if (inFlightRef.current) return;\n    if (lastFetchKeyRef.current === fetchKey && trainingRecords.length > 0) {\n      // Refresh\n      return;\n    }\n\n    inFlightRef.current = true;\n    lastFetchKeyRef.current = fetchKey;\n\n    if (DEBUG_FETCH) {\n      console.log(\"[useTrainingData] fetchAll\", { userId, at: new Date().toISOString() });\n    }\n\n    setLoading(true);\n    try {\n      const [trainingRes, weightRes] = await Promise.all([\n        supabase\n          .from(\"training_records\")\n          // OK: \"id,user_id,date,rpe,duration_min,load,arrow_score,signal_score,created_at\"\n          .select(\"*\")\n          .eq(\"user_id\", userId)\n          .order(\"date\", { ascending: true }),\n\n        supabase\n          .from(\"weight_records\")\n          .select(\"*\")\n          .eq(\"user_id\", userId)\n          .order(\"date\", { ascending: true }),\n      ]);\n\n      if (trainingRes.error) throw trainingRes.error;\n      if (weightRes.error) throw weightRes.error;\n\n      setTrainingRecords((trainingRes.data || []) as TrainingRecord[]);\n      setWeightRecords((weightRes.data || []) as WeightRecord[]);\n    } catch (error) {\n      console.error(\"[useTrainingData] Error fetching data:\", error);\n      setTrainingRecords([]);\n      setWeightRecords([]);\n      setACWRData([]);\n      //  fetchAll \n      lastFetchKeyRef.current = null;\n    } finally {\n      inFlightRef.current = false;\n      setLoading(false);\n    }\n  }, [userId, DEBUG_FETCH, trainingRecords.length]);\n\n  // userId1\n  useEffect(() => {\n    if (!userId) return;\n    fetchAll();\n  }, [userId, fetchAll]);\n\n  // ACWR\n  useEffect(() => {\n    const normalized: RecordLike[] =\n      (trainingRecords || [])\n        .map((r: any) => {\n          const date = toACWRDateKey(r?.date);\n          if (!date) return null;\n\n          const loadRaw = toNumber(r?.load);\n          const rpe = toNumber(r?.rpe);\n          const duration = toNumber(r?.duration_min);\n\n          const load =\n            loadRaw != null\n              ? loadRaw\n              : rpe != null && duration != null\n              ? rpe * duration\n              : null;\n\n          return { date, load };\n        })\n        .filter(Boolean) as RecordLike[];\n\n    setACWRData(calculateACWR(normalized));\n  }, [trainingRecords]);\n\n  const checkExistingRecord = useCallback(\n    async (date: string): Promise<TrainingRecord | null> => {\n      const ymd = toYMD(date);\n      if (!ymd) return null;\n\n      if (DATE_MODE === \"date\") {\n        const { data, error } = await supabase\n          .from(\"training_records\")\n          .select(\"*\")\n          .eq(\"user_id\", userId)\n          .eq(\"date\", ymd)\n          .maybeSingle();\n\n        if (error) throw error;\n        return data as TrainingRecord | null;\n      }\n\n      const { startISO, endISO } = jstDayRangeISO(ymd);\n\n      const { data, error } = await supabase\n        .from(\"training_records\")\n        .select(\"*\")\n        .eq(\"user_id\", userId)\n        .gte(\"date\", startISO)\n        .lte(\"date\", endISO)\n        .order(\"date\", { ascending: false })\n        .limit(1)\n        .maybeSingle();\n\n      if (error) throw error;\n      return data as TrainingRecord | null;\n    },\n    [userId]\n  );\n\n  const addTrainingRecord = useCallback(\n    async (recordData: TrainingUpsertPayload) => {\n      const ymd = toYMD(recordData.date);\n      if (!ymd) throw new Error(\"Invalid date\");\n\n      const dbDate = toDbDateValue(recordData.date);\n\n      const { data, error } = await supabase\n        .from(\"training_records\")\n        .insert([\n          {\n            user_id: userId,\n            date: dbDate,\n            rpe: recordData.rpe,\n            duration_min: recordData.duration_min,\n            arrow_score: recordData.arrow_score,\n            signal_score: recordData.signal_score,\n          },\n        ])\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      setTrainingRecords((prev) => upsertLocalTrainingRecord(prev, data as TrainingRecord));\n\n      await safeLogEvent(\"training_completed\", {\n        date: ymd,\n        rpe: recordData.rpe,\n        duration_min: recordData.duration_min,\n        arrow_score: recordData.arrow_score,\n        signal_score: recordData.signal_score,\n        overwrite: false,\n      });\n\n      return data as TrainingRecord;\n    },\n    [userId, safeLogEvent]\n  );\n\n  const updateTrainingRecord = useCallback(\n    async (\n      recordId: string,\n      recordData: Partial<Omit<TrainingUpsertPayload, \"date\">> & { date?: string }\n    ) => {\n      const ymd = recordData.date ? toYMD(recordData.date) : null;\n      const dbDate = recordData.date ? toDbDateValue(recordData.date) : null;\n\n      const updatePayload: Record<string, any> = {\n        ...(recordData.rpe !== undefined ? { rpe: recordData.rpe } : {}),\n        ...(recordData.duration_min !== undefined ? { duration_min: recordData.duration_min } : {}),\n        ...(recordData.arrow_score !== undefined ? { arrow_score: recordData.arrow_score } : {}),\n        ...(recordData.signal_score !== undefined ? { signal_score: recordData.signal_score } : {}),\n        ...(dbDate ? { date: dbDate } : {}),\n      };\n\n      const { data, error } = await supabase\n        .from(\"training_records\")\n        .update(updatePayload)\n        .eq(\"id\", recordId)\n        .eq(\"user_id\", userId)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      setTrainingRecords((prev) => upsertLocalTrainingRecord(prev, data as TrainingRecord));\n\n      const eventYmd = ymd ?? toACWRDateKey((data as any)?.date) ?? undefined;\n\n      await safeLogEvent(\"training_completed\", {\n        date: eventYmd,\n        rpe: recordData.rpe ?? (data as any)?.rpe,\n        duration_min: recordData.duration_min ?? (data as any)?.duration_min,\n        arrow_score: recordData.arrow_score ?? (data as any)?.arrow_score,\n        signal_score: recordData.signal_score ?? (data as any)?.signal_score,\n        overwrite: true,\n      });\n\n      return data as TrainingRecord;\n    },\n    [userId, safeLogEvent]\n  );\n\n  const deleteTrainingRecord = useCallback(\n    async (recordId: string) => {\n      const { error } = await supabase\n        .from(\"training_records\")\n        .delete()\n        .eq(\"id\", recordId)\n        .eq(\"user_id\", userId);\n\n      if (error) throw error;\n\n      setTrainingRecords((prev) => removeLocalTrainingRecord(prev, recordId));\n    },\n    [userId]\n  );\n\n  return {\n    records: trainingRecords,\n    weightRecords,\n    acwrData,\n    loading,\n\n    fetchAll,\n    checkExistingRecord,\n    addTrainingRecord,\n    updateTrainingRecord,\n    deleteTrainingRecord,\n  };\n}","// logEvent.ts\nimport { supabase } from './supabase';\n\ntype LogEventArgs = {\n  userId?: string | null; //  optional \n  eventType: string;\n  payload?: Record<string, any>;\n};\n\nexport async function logEvent({\n  userId,\n  eventType,\n  payload = {},\n}: LogEventArgs) {\n  //  userId \n  if (!userId) {\n    console.warn('[logEvent] skipped: missing userId', {\n      eventType,\n      payload,\n    });\n    return;\n  }\n\n  try {\n    const { error } = await supabase.from('events').insert({\n      user_id: userId,\n      event_type: eventType,\n      payload,\n    });\n\n    if (error) throw error;\n  } catch (e) {\n    //  UX \n    console.warn('[logEvent] failed:', e);\n  }\n}","// src/hooks/useWeightData.ts\nimport { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { Database } from '../lib/database.types';\n\ntype WeightRecord = Database['public']['Tables']['weight_records']['Row'];\ntype WeightInsert = Database['public']['Tables']['weight_records']['Insert'];\ntype WeightUpdate = Database['public']['Tables']['weight_records']['Update'];\n\n/**\n * YYYY-MM-DD / YYYY/MM/DD / YYYY-MM-DDTHH:mm:ss...  Date()\n * : '2025-01-04' -> new Date(2025,0,4)\n */\nfunction parseYMDLocal(dateStr: string | null | undefined): Date | null {\n  if (!dateStr) return null;\n\n  // 10YYYY-MM-DD\n  const head = String(dateStr).slice(0, 10).replace(/\\//g, '-'); // YYYY/MM/DD -> YYYY-MM-DD\n  const m = head.match(/^(\\d{4})-(\\d{1,2})-(\\d{1,2})$/);\n  if (m) {\n    const y = Number(m[1]);\n    const mo = Number(m[2]);\n    const d = Number(m[3]);\n    if (Number.isFinite(y) && Number.isFinite(mo) && Number.isFinite(d)) {\n      return new Date(y, mo - 1, d); // \n    }\n  }\n\n  // ISO\n  const t = new Date(String(dateStr)).getTime();\n  if (Number.isFinite(t)) return new Date(t);\n\n  return null;\n}\n\nfunction toDateKey(dateStr: string | null | undefined): string {\n  if (!dateStr) return '';\n  // 'YYYY-MM-DD...'  'YYYY-MM-DD' \n  return String(dateStr).slice(0, 10).replace(/\\//g, '-');\n}\n\nfunction sortByDateDesc(a: WeightRecord, b: WeightRecord): number {\n  const ka = toDateKey(a.date);\n  const kb = toDateKey(b.date);\n\n  // YYYY-MM-DD\n  if (ka && kb) return kb.localeCompare(ka);\n\n  // \n  const da = parseYMDLocal(a.date)?.getTime() ?? 0;\n  const db = parseYMDLocal(b.date)?.getTime() ?? 0;\n  return db - da;\n}\n\nfunction sortByDateAsc(a: WeightRecord, b: WeightRecord): number {\n  return -sortByDateDesc(a, b);\n}\n\nexport function useWeightData(userId: string) {\n  const [records, setRecords] = useState<WeightRecord[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const normalizeAndSet = useCallback((rows: WeightRecord[]) => {\n    // \n    const sorted = [...rows].sort(sortByDateDesc);\n    setRecords(sorted);\n  }, []);\n\n  const fetchRecords = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // DBJS\n      const { data, error: fetchError } = await supabase\n        .from('weight_records')\n        .select('*')\n        .eq('user_id', userId)\n        .order('date', { ascending: false });\n\n      if (fetchError) throw fetchError;\n\n      normalizeAndSet((data || []) as WeightRecord[]);\n    } catch (err) {\n      console.error('Error fetching weight records:', err);\n      setError(err instanceof Error ? err.message : '');\n      normalizeAndSet([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [userId, normalizeAndSet]);\n\n  useEffect(() => {\n    if (userId) fetchRecords();\n  }, [userId, fetchRecords]);\n\n  const checkExistingRecord = useCallback(\n    async (date: string): Promise<WeightRecord | null> => {\n      try {\n        const key = toDateKey(date);\n\n        const { data, error } = await supabase\n          .from('weight_records')\n          .select('*')\n          .eq('user_id', userId)\n          // date timestamp/iso \n          // YMDOK\n          .eq('date', key)\n          .maybeSingle();\n\n        if (error) throw error;\n        return (data as WeightRecord) ?? null;\n      } catch (e) {\n        console.error('Error checking existing record:', e);\n        return null;\n      }\n    },\n    [userId]\n  );\n\n  const addWeightRecord = useCallback(\n    async (data: { weight_kg: number; date: string; notes?: string }) => {\n      try {\n        const { data: authData } = await supabase.auth.getUser();\n        if (!authData.user) throw new Error('');\n\n        const insertData: WeightInsert = {\n          user_id: authData.user.id,\n          weight_kg: data.weight_kg,\n          date: toDateKey(data.date),\n          notes: data.notes || null,\n        };\n\n        const { data: newRecord, error: insertError } = await supabase\n          .from('weight_records')\n          .insert(insertData)\n          .select()\n          .single();\n\n        if (insertError) throw insertError;\n\n        setRecords((prev) => {\n          const merged = [newRecord as WeightRecord, ...prev];\n          return merged.sort(sortByDateDesc);\n        });\n      } catch (err) {\n        console.error('Error adding weight record:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  const updateWeightRecord = useCallback(\n    async (id: string, data: { weight_kg: number; notes?: string }) => {\n      try {\n        const updateData: WeightUpdate = {\n          weight_kg: data.weight_kg,\n          notes: data.notes || null,\n        };\n\n        const { data: updatedRecord, error: updateError } = await supabase\n          .from('weight_records')\n          .update(updateData)\n          .eq('id', id)\n          .select()\n          .single();\n\n        if (updateError) throw updateError;\n\n        setRecords((prev) => {\n          const next = prev.map((r) => (r.id === id ? (updatedRecord as WeightRecord) : r));\n          return next.sort(sortByDateDesc);\n        });\n      } catch (err) {\n        console.error('Error updating weight record:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  const deleteWeightRecord = useCallback(async (id: string) => {\n    try {\n      const { error: deleteError } = await supabase.from('weight_records').delete().eq('id', id);\n      if (deleteError) throw deleteError;\n\n      setRecords((prev) => prev.filter((r) => r.id !== id));\n    } catch (err) {\n      console.error('Error deleting weight record:', err);\n      throw err;\n    }\n  }, []);\n\n  /**\n   *  records[0]  date \n   * records  max date \n   */\n  const getLatestWeight = useCallback((): number | null => {\n    if (!records || records.length === 0) return null;\n\n    const latest = records.reduce((best, r) => {\n      if (!best) return r;\n      const kb = toDateKey(best.date);\n      const kr = toDateKey(r.date);\n      return kr > kb ? r : best;\n    }, null as WeightRecord | null);\n\n    const v = Number(latest?.weight_kg);\n    return Number.isFinite(v) ? v : null;\n  }, [records]);\n\n  /**\n   *  NYMD\n   */\n  const getWeightChange = useCallback(\n    (days: number = 30): number | null => {\n      if (!records || records.length < 2) return null;\n\n      const now = new Date();\n      const cutoff = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n      cutoff.setDate(cutoff.getDate() - days);\n\n      // \n      const asc = [...records].sort(sortByDateAsc);\n\n      const recent = asc.filter((r) => {\n        const d = parseYMDLocal(r.date);\n        return d ? d.getTime() >= cutoff.getTime() : false;\n      });\n\n      if (recent.length < 2) return null;\n\n      const first = Number(recent[0].weight_kg);\n      const last = Number(recent[recent.length - 1].weight_kg);\n\n      if (!Number.isFinite(first) || !Number.isFinite(last)) return null;\n      return last - first;\n    },\n    [records]\n  );\n\n  return {\n    records, //  \n    loading,\n    error,\n    checkExistingRecord,\n    addWeightRecord,\n    updateWeightRecord,\n    deleteWeightRecord,\n    getLatestWeight,\n    getWeightChange,\n    refresh: fetchRecords,\n  };\n}","import { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport type { Database } from '../lib/database.types';\n\ntype MenstrualCycle = Database['public']['Tables']['menstrual_cycles']['Row'];\ntype MenstrualCycleInsert = Database['public']['Tables']['menstrual_cycles']['Insert'];\ntype MenstrualCycleUpdate = Database['public']['Tables']['menstrual_cycles']['Update'];\n\nexport function useMenstrualCycleData(userId: string) {\n  const [cycles, setCycles] = useState<MenstrualCycle[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchCycles();\n  }, [userId]);\n\n  const fetchCycles = async () => {\n    try {\n      setLoading(true);\n      const { data, error: fetchError } = await supabase\n        .from('menstrual_cycles')\n        .select('*')\n        .eq('user_id', userId)\n        .order('cycle_start_date', { ascending: false });\n\n      if (fetchError) throw fetchError;\n      setCycles(data || []);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch menstrual cycles');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const addCycle = async (cycle: Omit<MenstrualCycleInsert, 'user_id'>) => {\n    try {\n      const { data: userData } = await supabase.auth.getUser();\n      if (!userData.user) throw new Error('User not authenticated');\n\n      const { data: userProfile } = await supabase\n        .from('users')\n        .select('team_id')\n        .eq('user_id', userData.user.id)\n        .maybeSingle();\n\n      let organizationId = null;\n      if (userProfile?.team_id) {\n        const { data: team } = await supabase\n          .from('teams')\n          .select('organization_id')\n          .eq('id', userProfile.team_id)\n          .maybeSingle();\n\n        organizationId = team?.organization_id || null;\n      }\n\n      const { data, error: insertError } = await supabase\n        .from('menstrual_cycles')\n        .insert({\n          ...cycle,\n          user_id: userId,\n          organization_id: organizationId,\n        })\n        .select()\n        .single();\n\n      if (insertError) throw insertError;\n      if (data) {\n        setCycles((prev) => [data, ...prev]);\n      }\n      return data;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to add menstrual cycle');\n      throw err;\n    }\n  };\n\n  const updateCycle = async (id: string, updates: MenstrualCycleUpdate) => {\n    try {\n      const { data, error: updateError } = await supabase\n        .from('menstrual_cycles')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (updateError) throw updateError;\n      if (data) {\n        setCycles((prev) =>\n          prev.map((cycle) => (cycle.id === id ? data : cycle))\n        );\n      }\n      return data;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update menstrual cycle');\n      throw err;\n    }\n  };\n\n  const deleteCycle = async (id: string) => {\n    try {\n      const { error: deleteError } = await supabase\n        .from('menstrual_cycles')\n        .delete()\n        .eq('id', id);\n\n      if (deleteError) throw deleteError;\n      setCycles((prev) => prev.filter((cycle) => cycle.id !== id));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete menstrual cycle');\n      throw err;\n    }\n  };\n\n  const getCyclePhase = (cycle: MenstrualCycle, targetDate: Date): string | null => {\n    const startDate = new Date(cycle.cycle_start_date);\n    const daysSinceStart = Math.floor((targetDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));\n\n    if (daysSinceStart < 0) return null;\n\n    if (cycle.period_duration_days && daysSinceStart < cycle.period_duration_days) {\n      return 'menstrual';\n    }\n\n    if (cycle.cycle_length_days) {\n      const follicularEnd = Math.floor(cycle.cycle_length_days / 2);\n      if (daysSinceStart < follicularEnd) {\n        return 'follicular';\n      }\n      const lutealStart = follicularEnd + 2;\n      if (daysSinceStart < lutealStart) {\n        return 'ovulatory';\n      }\n      if (daysSinceStart < cycle.cycle_length_days) {\n        return 'luteal';\n      }\n    }\n\n    return null;\n  };\n\n  const getCurrentCyclePhase = (): { cycle: MenstrualCycle; phase: string } | null => {\n    const today = new Date();\n    for (const cycle of cycles) {\n      const phase = getCyclePhase(cycle, today);\n      if (phase) {\n        return { cycle, phase };\n      }\n    }\n    return null;\n  };\n\n  return {\n    cycles,\n    loading,\n    error,\n    addCycle,\n    updateCycle,\n    deleteCycle,\n    getCyclePhase,\n    getCurrentCyclePhase,\n    refetch: fetchCycles,\n  };\n}\n","import type { AppRole } from './roles';\nimport { TutorialStep } from '../components/TutorialController';\n\nexport const athleteTutorialSteps: TutorialStep[] = [\n  { id: 'athlete-welcome', title: 'Bekuta ', description: 'Bekuta', position: 'center' },\n  { id: 'athlete-unified-checkin', title: '', description: '1', targetSelector: '[data-tutorial=\"daily-checkin\"]', position: 'bottom' },\n  { id: 'athlete-performance', title: '', description: '', targetSelector: '[data-tutorial=\"performance-tab\"]', position: 'bottom' },\n  { id: 'athlete-acwr-chart', title: '', description: 'ACWR0.81.3', targetSelector: '[data-tutorial=\"acwr-chart\"]', position: 'top' },\n  { id: 'athlete-multi-metric', title: '', description: '', targetSelector: '[data-tutorial=\"multi-metric-timeline\"]', position: 'top' },\n  { id: 'athlete-alerts', title: '', description: '', targetSelector: '[data-tutorial=\"alert-badge\"]', position: 'bottom' },\n  { id: 'athlete-gamification', title: '', description: '', targetSelector: '[data-tutorial=\"gamification-tab\"]', position: 'bottom' },\n  { id: 'athlete-complete', title: '', description: 'Bekuta', position: 'center' },\n];\n\nexport const staffTutorialSteps: TutorialStep[] = [\n  { id: 'staff-welcome', title: 'Bekuta ', description: '', position: 'center' },\n  { id: 'staff-team-selector', title: '', description: '', targetSelector: '[data-tutorial=\"team-selector\"]', position: 'bottom' },\n  { id: 'staff-alert-summary', title: '', description: 'AI', targetSelector: '[data-tutorial=\"alert-summary\"]', position: 'bottom' },\n  { id: 'staff-athletes-tab', title: '', description: '', targetSelector: '[data-tutorial=\"athletes-tab\"]', position: 'bottom' },\n  { id: 'staff-athlete-list', title: '', description: 'ACWR', targetSelector: '[data-tutorial=\"athlete-list\"]', position: 'right' },\n  { id: 'staff-team-average', title: '', description: 'ACWR', targetSelector: '[data-tutorial=\"team-average-tab\"]', position: 'bottom' },\n  { id: 'staff-trends', title: '', description: '', targetSelector: '[data-tutorial=\"trends-tab\"]', position: 'bottom' },\n  { id: 'staff-export', title: '', description: 'CSV', targetSelector: '[data-tutorial=\"export-button\"]', position: 'bottom' },\n  { id: 'staff-complete', title: '', description: 'Bekuta', position: 'center' },\n];\n\nexport const globalAdminTutorialSteps: TutorialStep[] = [\n  { id: 'admin-welcome', title: 'Bekuta ', description: '', position: 'center' },\n  { id: 'admin-alert-summary', title: '', description: '', targetSelector: '[data-tutorial=\"admin-alert-summary\"]', position: 'bottom' },\n  { id: 'admin-overview-tab', title: '', description: '', targetSelector: '[data-tutorial=\"overview-tab\"]', position: 'bottom' },\n  { id: 'admin-invite-tab', title: '', description: 'BekutaCSV2', targetSelector: '[data-tutorial=\"invite-tab\"]', position: 'bottom' },\n  { id: 'admin-single-invite', title: '', description: '1', targetSelector: '[data-tutorial=\"single-invite\"]', position: 'right' },\n  { id: 'admin-bulk-invite', title: '', description: 'CSV', targetSelector: '[data-tutorial=\"bulk-invite\"]', position: 'right' },\n  { id: 'admin-manage-tab', title: '', description: '', targetSelector: '[data-tutorial=\"manage-tab\"]', position: 'bottom' },\n  { id: 'admin-user-list', title: '', description: '', targetSelector: '[data-tutorial=\"user-list\"]', position: 'top' },\n  { id: 'admin-complete', title: '', description: 'Bekuta', position: 'center' },\n];\n\nexport const parentTutorialSteps: TutorialStep[] = [\n  {\n    id: 'parent-welcome',\n    title: '',\n    description: '',\n    position: 'center',\n  },\n  {\n    id: 'parent-complete',\n    title: '',\n    description: '',\n    position: 'center',\n  },\n];\n\nexport const gamificationTutorialSteps: TutorialStep[] = [\n  { id: 'gamification-welcome', title: '', description: '', position: 'center' },\n  { id: 'gamification-streaks', title: ' - ', description: '4', targetSelector: '[data-tutorial=\"streaks-section\"]', position: 'right' },\n  { id: 'gamification-level', title: ' & ', description: '7', targetSelector: '[data-tutorial=\"level-section\"]', position: 'right' },\n  { id: 'gamification-badges', title: '', description: '74Common, Rare, Epic, Legendary', targetSelector: '[data-tutorial=\"badges-card\"]', position: 'bottom' },\n  { id: 'gamification-goals', title: '', description: '', targetSelector: '[data-tutorial=\"goals-section\"]', position: 'left' },\n  { id: 'gamification-rankings', title: '', description: '2', targetSelector: '[data-tutorial=\"rankings-section\"]', position: 'left' },\n  { id: 'gamification-complete', title: '', description: '', position: 'center' },\n];\n\nexport function getTutorialSteps(role: AppRole | 'gamification'): TutorialStep[] {\n  switch (role) {\n    case 'athlete':\n      return athleteTutorialSteps;\n    case 'staff':\n      return staffTutorialSteps;\n    case 'parent':\n      return parentTutorialSteps;\n    case 'global_admin':\n      return globalAdminTutorialSteps;\n    case 'gamification':\n      return gamificationTutorialSteps;\n    default:\n      return [];\n  }\n}","import React, { useState, useEffect } from 'react';\nimport { Moon, Star, Loader2 } from 'lucide-react';\nimport { SleepRecord } from '../lib/supabase';\nimport { GenericDuplicateModal } from './GenericDuplicateModal';\nimport { getTodayJSTString } from '../lib/date';\nimport type { SleepRecordForm } from '../lib/normalizeRecords';\nimport { Toast } from './ui/Toast'; //  : ../components/ui/Toast\n\ninterface SleepFormProps {\n  onSubmit: (data: {\n    sleep_hours: number;\n    date: string;\n    sleep_quality?: number;\n    notes?: string;\n  }) => Promise<void>;\n\n  onCheckExisting: (date: string) => Promise<SleepRecord | null>;\n\n  onUpdate: (\n    id: string,\n    data: {\n      sleep_hours: number;\n      date: string;\n      sleep_quality?: number;\n      notes?: string;\n    }\n  ) => Promise<void>;\n\n  loading?: boolean;\n\n  /**   */\n  lastRecord?: SleepRecordForm | null;\n}\n\nexport function SleepForm({\n  onSubmit,\n  onCheckExisting,\n  onUpdate,\n  loading = false,\n  lastRecord,\n}: SleepFormProps) {\n  const [sleepHours, setSleepHours] = useState('');\n  const [date, setDate] = useState(getTodayJSTString());\n  const [sleepQuality, setSleepQuality] = useState<number>(3);\n  const [notes, setNotes] = useState('');\n  const [error, setError] = useState('');\n  const [showDuplicateModal, setShowDuplicateModal] = useState(false);\n  const [existingRecord, setExistingRecord] = useState<SleepRecord | null>(null);\n\n  const [pendingData, setPendingData] = useState<{\n    sleep_hours: number;\n    date: string;\n    sleep_quality?: number;\n    notes?: string;\n  } | null>(null);\n\n  //   saving  loading \n  const [saving, setSaving] = useState(false);\n\n  //  Toast\n  const [toastOpen, setToastOpen] = useState(false);\n  const [toastType, setToastType] = useState<'success' | 'error'>('success');\n  const [toastMsg, setToastMsg] = useState('');\n\n  const showToast = (type: 'success' | 'error', msg: string) => {\n    setToastType(type);\n    setToastMsg(msg);\n    setToastOpen(true);\n  };\n\n  const resetForm = () => {\n    setSleepHours('');\n    setDate(getTodayJSTString());\n    setSleepQuality(3);\n    setNotes('');\n  };\n\n  //  \n  useEffect(() => {\n    if (!lastRecord) return;\n\n    if (lastRecord.sleep_hours != null) {\n      setSleepHours(String(lastRecord.sleep_hours));\n    }\n    if (lastRecord.sleep_quality != null) {\n      setSleepQuality(lastRecord.sleep_quality);\n    }\n  }, [lastRecord]);\n\n  const validate = () => {\n    const hours = parseFloat(sleepHours);\n    if (isNaN(hours) || hours < 0 || hours > 24) {\n      setError('024');\n      return null;\n    }\n    return hours;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (saving || loading) return; //  \n\n    const hours = validate();\n    if (hours == null) return;\n\n    const data = {\n      sleep_hours: hours,\n      date,\n      sleep_quality: sleepQuality,\n      notes: notes || undefined,\n    };\n\n    setSaving(true);\n    try {\n      // \n      const existing = await onCheckExisting(date);\n      if (existing) {\n        setExistingRecord(existing);\n        setPendingData(data);\n        setShowDuplicateModal(true);\n        return; //   saving  finally \n      }\n\n      await onSubmit(data);\n\n      resetForm();\n      showToast('success', ' ');\n    } catch (err: any) {\n      setError('');\n      console.error('Error submitting sleep record:', err);\n      showToast('error', `${err?.message ?? ''}`);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleOverwrite = async () => {\n    if (!existingRecord || !pendingData) return;\n    if (saving || loading) return;\n\n    setShowDuplicateModal(false);\n    setSaving(true);\n    setError('');\n\n    try {\n      await onUpdate(existingRecord.id, pendingData);\n\n      resetForm();\n      setExistingRecord(null);\n      setPendingData(null);\n\n      showToast('success', ' ');\n    } catch (err: any) {\n      setError('');\n      console.error('Error updating record:', err);\n      showToast('error', `${err?.message ?? ''}`);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleCancelOverwrite = () => {\n    setShowDuplicateModal(false);\n    setExistingRecord(null);\n    setPendingData(null);\n  };\n\n  const renderStars = () => {\n    return (\n      <div className=\"flex items-center justify-center space-x-2\">\n        {[1, 2, 3, 4, 5].map((star) => (\n          <button\n            key={star}\n            type=\"button\"\n            onClick={() => setSleepQuality(star)}\n            className={`transition-colors ${\n              star <= sleepQuality\n                ? 'text-yellow-400 hover:text-yellow-500'\n                : 'text-gray-300 dark:text-gray-600 hover:text-gray-400'\n            }`}\n          >\n            <Star className={`w-6 h-6 ${star <= sleepQuality ? 'fill-current' : ''}`} />\n          </button>\n        ))}\n      </div>\n    );\n  };\n\n  const isBusy = loading || saving;\n\n  return (\n    <>\n      {/*  Toast */}\n      <Toast\n        open={toastOpen}\n        type={toastType}\n        message={toastMsg}\n        onClose={() => setToastOpen(false)}\n      />\n\n      <GenericDuplicateModal\n        isOpen={showDuplicateModal}\n        onClose={handleCancelOverwrite}\n        onOverwrite={handleOverwrite}\n        onCancel={handleCancelOverwrite}\n        title=\"\"\n        date={date}\n        existingValues={[\n          { label: '', value: `${existingRecord?.sleep_hours || 0}` },\n          { label: '', value: `${existingRecord?.sleep_quality || 0}/5` },\n        ]}\n        newValues={[\n          { label: '', value: `${pendingData?.sleep_hours || 0}` },\n          { label: '', value: `${pendingData?.sleep_quality || 0}/5` },\n        ]}\n      />\n\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        {error && (\n          <div className=\"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm\">\n            {error}\n          </div>\n        )}\n\n        {/*  */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            \n          </label>\n          <input\n            type=\"date\"\n            value={date}\n            onChange={(e) => setDate(e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n            required\n            disabled={isBusy}\n          />\n        </div>\n\n        {/*  */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            \n          </label>\n          {lastRecord && (\n            <p className=\"text-xs text-gray-400 dark:text-gray-500 mb-1\">\n              {lastRecord.date}{lastRecord.sleep_hours}\n            </p>\n          )}\n          <input\n            type=\"number\"\n            step=\"0.5\"\n            min=\"0\"\n            max=\"24\"\n            value={sleepHours}\n            onChange={(e) => setSleepHours(e.target.value)}\n            placeholder=\": 7.5\"\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n            required\n            disabled={isBusy}\n          />\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">: 7-9</p>\n        </div>\n\n        {/*  */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            \n          </label>\n          {lastRecord && (\n            <p className=\"text-xs text-gray-400 dark:text-gray-500 mb-1\">\n              {lastRecord.sleep_quality ?? '-'} / 5\n            </p>\n          )}\n          {renderStars()}\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center\">\n            {sleepQuality === 5 && ''}\n            {sleepQuality === 4 && ''}\n            {sleepQuality === 3 && ''}\n            {sleepQuality === 2 && ''}\n            {sleepQuality === 1 && ''}\n          </p>\n        </div>\n\n        {/*  */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            \n          </label>\n          <textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            placeholder=\" ...\"\n            rows={3}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none\"\n            disabled={isBusy}\n          />\n        </div>\n\n        {/*  */}\n        <button\n          type=\"submit\"\n          disabled={isBusy}\n          className={`w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center ${\n            isBusy\n              ? 'bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed'\n              : 'bg-indigo-600 hover:bg-indigo-700 text-white'\n          }`}\n        >\n          {isBusy ? (\n            <span className=\"inline-flex items-center gap-2\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              \n            </span>\n          ) : (\n            <>\n              <Moon className=\"w-5 h-5 mr-2\" />\n              \n            </>\n          )}\n        </button>\n      </form>\n    </>\n  );\n}","import React from 'react';\nimport { AlertTriangle, X } from 'lucide-react';\n\nexport type ExistingMotivationRecord = {\n  id: string;\n  date: string;\n  motivation_level: number;\n  energy_level: number;\n  stress_level: number;\n  notes?: string | null;\n  mood?: string | null;\n};\n\ntype Props = {\n  isOpen: boolean;\n  onClose: () => void;\n  onOverwrite: () => void;\n  onCancel: () => void;\n  existingRecord: ExistingMotivationRecord;\n  newValue: {\n    motivation_level: number;\n    energy_level: number;\n    stress_level: number;\n    notes?: string;\n  };\n};\n\nexport function DuplicateRecordModal({\n  isOpen,\n  onClose,\n  onOverwrite,\n  onCancel,\n  existingRecord,\n  newValue,\n}: Props) {\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden\">\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"flex-shrink-0 w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center\">\n              <AlertTriangle className=\"w-5 h-5 text-yellow-600\" />\n            </div>\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              \n            </h3>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n            aria-label=\"\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-140px)]\">\n          <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n            \n          </p>\n\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 space-y-3\">\n            <div>\n              <p className=\"text-xs text-gray-500 dark:text-gray-300 mb-1\"></p>\n              <p className=\"text-base font-medium text-gray-900 dark:text-white\">\n                {new Date(existingRecord.date).toLocaleDateString('ja-JP')}\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-3 pt-3 border-t border-gray-200 dark:border-gray-600\">\n              <div>\n                <p className=\"text-xs text-gray-500 dark:text-gray-300 mb-1\"></p>\n                <p className=\"text-sm text-gray-900 dark:text-white\">\n                   {existingRecord.motivation_level} /10\n                </p>\n                <p className=\"text-sm text-gray-900 dark:text-white\">\n                   {existingRecord.energy_level} /10\n                </p>\n                <p className=\"text-sm text-gray-900 dark:text-white\">\n                   {existingRecord.stress_level} /10\n                </p>\n              </div>\n\n              <div>\n                <p className=\"text-xs text-gray-500 dark:text-gray-300 mb-1\"></p>\n                <p className=\"text-sm text-blue-600 dark:text-blue-400 font-semibold\">\n                   {newValue.motivation_level} /10\n                </p>\n                <p className=\"text-sm text-green-600 dark:text-green-400 font-semibold\">\n                   {newValue.energy_level} /10\n                </p>\n                <p className=\"text-sm text-red-600 dark:text-red-400 font-semibold\">\n                   {newValue.stress_level} /10\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3\">\n            <p className=\"text-sm text-yellow-800 dark:text-yellow-200\">\n              \n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30\">\n          <button\n            onClick={onCancel}\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors\"\n          >\n            \n          </button>\n          <button\n            onClick={onOverwrite}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useState, useEffect } from 'react';\nimport { Heart, Zap, AlertCircle, Loader2 } from 'lucide-react';\nimport { getTodayJSTString } from '../lib/date';\nimport { DuplicateRecordModal, ExistingMotivationRecord } from \"./DuplicateRecordModal\";\nimport { Toast } from './ui/Toast'; //  \n\ninterface LastRecordInfo {\n  date: string;\n  motivation_level: number;\n  energy_level: number;\n  stress_level: number;\n}\n\ninterface MotivationFormProps {\n  onSubmit: (data: {\n    motivation_level: number;\n    energy_level: number;\n    stress_level: number;\n    date: string;\n    notes?: string;\n  }) => Promise<void>;\n\n  //   + \n  onCheckExisting?: (date: string) => Promise<ExistingMotivationRecord | null>;\n  onUpdate?: (\n    id: string,\n    data: {\n      motivation_level: number;\n      energy_level: number;\n      stress_level: number;\n      notes?: string;\n    }\n  ) => Promise<void>;\n\n  loading?: boolean;\n  lastRecord?: LastRecordInfo | null;\n}\n\nexport function MotivationForm({\n  onSubmit,\n  onCheckExisting,\n  onUpdate,\n  loading = false,\n  lastRecord,\n}: MotivationFormProps) {\n  const [motivationLevel, setMotivationLevel] = useState(5);\n  const [energyLevel, setEnergyLevel] = useState(5);\n  const [stressLevel, setStressLevel] = useState(5);\n  const [date, setDate] = useState(getTodayJSTString());\n  const [notes, setNotes] = useState('');\n  const [error, setError] = useState('');\n  const [initializedFromLast, setInitializedFromLast] = useState(false);\n\n  //   savingloading\n  const [saving, setSaving] = useState(false);\n\n  //  Toast\n  const [toastOpen, setToastOpen] = useState(false);\n  const [toastType, setToastType] = useState<'success' | 'error'>('success');\n  const [toastMsg, setToastMsg] = useState('');\n\n  const showToast = (type: 'success' | 'error', msg: string) => {\n    setToastType(type);\n    setToastMsg(msg);\n    setToastOpen(true);\n  };\n\n  //  \n  const [showDuplicateModal, setShowDuplicateModal] = useState(false);\n  const [existingRecord, setExistingRecord] = useState<ExistingMotivationRecord | null>(null);\n  const [pendingData, setPendingData] = useState<{\n    motivation_level: number;\n    energy_level: number;\n    stress_level: number;\n    date: string;\n    notes?: string;\n  } | null>(null);\n\n  useEffect(() => {\n    if (lastRecord && !initializedFromLast) {\n      setMotivationLevel(lastRecord.motivation_level);\n      setEnergyLevel(lastRecord.energy_level);\n      setStressLevel(lastRecord.stress_level);\n      setInitializedFromLast(true);\n    }\n  }, [lastRecord, initializedFromLast]);\n\n  const resetForm = () => {\n    setMotivationLevel(5);\n    setEnergyLevel(5);\n    setStressLevel(5);\n    setDate(getTodayJSTString());\n    setNotes('');\n    setInitializedFromLast(false);\n  };\n\n  const isBusy = loading || saving;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (isBusy) return; //  \n\n    const payload = {\n      motivation_level: motivationLevel,\n      energy_level: energyLevel,\n      stress_level: stressLevel,\n      date,\n      notes: notes || undefined,\n    };\n\n    setSaving(true);\n    try {\n      //  \n      if (onCheckExisting) {\n        const existing = await onCheckExisting(date);\n        if (existing) {\n          setExistingRecord(existing);\n          setPendingData(payload);\n          setShowDuplicateModal(true);\n          return; //  finally saving\n        }\n      }\n\n      await onSubmit(payload);\n      resetForm();\n      showToast('success', ' ');\n    } catch (err: any) {\n      setError('');\n      console.error('Error submitting motivation record:', err);\n      showToast('error', `${err?.message ?? ''}`);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleOverwrite = async () => {\n    if (!existingRecord || !pendingData) return;\n    if (isBusy) return;\n\n    setError('');\n    setShowDuplicateModal(false);\n    setSaving(true);\n\n    try {\n      //  update  update id\n      if (onUpdate) {\n        await onUpdate(existingRecord.id, {\n          motivation_level: pendingData.motivation_level,\n          energy_level: pendingData.energy_level,\n          stress_level: pendingData.stress_level,\n          notes: pendingData.notes,\n        });\n      } else {\n        // fallback\n        await onSubmit(pendingData);\n      }\n\n      setExistingRecord(null);\n      setPendingData(null);\n      resetForm();\n      showToast('success', ' ');\n    } catch (err: any) {\n      setError('');\n      console.error('Error overwriting motivation record:', err);\n      showToast('error', `${err?.message ?? ''}`);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const renderSlider = (\n    value: number,\n    onChange: (value: number) => void,\n    label: string,\n    icon: React.ReactNode,\n    lowLabel: string,\n    highLabel: string,\n    colorTextClass: string,\n    previousValue?: number,\n    accentHex?: string\n  ) => {\n    //  \n    const pct = (value - 1) * 11.11; // 110  0100 \n    const active = accentHex ?? '#3b82f6';\n    const inactive = '#9ca3af';\n\n    return (\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n          {icon}\n          {label}\n        </label>\n\n        {previousValue !== undefined && (\n          <p className=\"text-xs text-gray-400 dark:text-gray-500 mb-1\">\n            : <span className=\"font-semibold\">{previousValue}</span> / 10\n            {lastRecord?.date && <span className=\"ml-1\">{lastRecord.date}</span>}\n          </p>\n        )}\n\n        <div className=\"flex items-center space-x-3\">\n          <span className=\"text-xs text-gray-500 dark:text-gray-400 w-12\">{lowLabel}</span>\n          <input\n            type=\"range\"\n            min=\"1\"\n            max=\"10\"\n            value={value}\n            onChange={(e) => onChange(parseInt(e.target.value))}\n            disabled={isBusy}\n            className=\"flex-1 h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-60 disabled:cursor-not-allowed\"\n            style={{\n              background: `linear-gradient(to right, ${active} 0%, ${active} ${pct}%, ${inactive} ${pct}%, ${inactive} 100%)`,\n            }}\n          />\n          <span className=\"text-xs text-gray-500 dark:text-gray-400 w-12 text-right\">{highLabel}</span>\n        </div>\n\n        <div className=\"text-center mt-2\">\n          <span className={`text-2xl font-bold ${colorTextClass}`}>{value}</span>\n          <span className=\"text-sm text-gray-500 dark:text-gray-400\"> / 10</span>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <>\n      {/*  Toast */}\n      <Toast\n        open={toastOpen}\n        type={toastType}\n        message={toastMsg}\n        onClose={() => setToastOpen(false)}\n      />\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {error && (\n          <div className=\"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm\">\n            {error}\n          </div>\n        )}\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n          <input\n            type=\"date\"\n            value={date}\n            onChange={(e) => setDate(e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n            required\n            disabled={isBusy}\n          />\n        </div>\n\n        {renderSlider(\n          motivationLevel,\n          setMotivationLevel,\n          '',\n          <Heart className=\"w-4 h-4 inline mr-2 text-blue-500\" />,\n          '',\n          '',\n          'text-blue-500',\n          lastRecord?.motivation_level,\n          '#3b82f6'\n        )}\n\n        {renderSlider(\n          energyLevel,\n          setEnergyLevel,\n          '',\n          <Zap className=\"w-4 h-4 inline mr-2 text-green-500\" />,\n          '',\n          '',\n          'text-green-500',\n          lastRecord?.energy_level,\n          '#10b981'\n        )}\n\n        {renderSlider(\n          stressLevel,\n          setStressLevel,\n          '',\n          <AlertCircle className=\"w-4 h-4 inline mr-2 text-red-500\" />,\n          '',\n          '',\n          'text-red-500',\n          lastRecord?.stress_level,\n          '#ef4444'\n        )}\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n          <textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            placeholder=\"...\"\n            rows={3}\n            disabled={isBusy}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none disabled:opacity-60\"\n          />\n        </div>\n\n        <button\n          type=\"submit\"\n          disabled={isBusy}\n          className={`w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center ${\n            isBusy\n              ? 'bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed'\n              : 'bg-blue-600 hover:bg-blue-700 text-white'\n          }`}\n        >\n          {isBusy ? (\n            <span className=\"inline-flex items-center gap-2\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              \n            </span>\n          ) : (\n            <>\n              <Heart className=\"w-5 h-5 mr-2\" />\n              \n            </>\n          )}\n        </button>\n      </form>\n\n      {/*   */}\n      {existingRecord && pendingData && (\n        <DuplicateRecordModal\n          isOpen={showDuplicateModal}\n          onClose={() => {\n            setShowDuplicateModal(false);\n            //  \n            setExistingRecord(null);\n            setPendingData(null);\n          }}\n          onCancel={() => {\n            setShowDuplicateModal(false);\n            setExistingRecord(null);\n            setPendingData(null);\n          }}\n          onOverwrite={handleOverwrite}\n          existingRecord={existingRecord}\n          newValue={{\n            motivation_level: pendingData.motivation_level,\n            energy_level: pendingData.energy_level,\n            stress_level: pendingData.stress_level,\n            notes: pendingData.notes,\n          }}\n        />\n      )}\n    </>\n  );\n}","import React, { useMemo } from 'react';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine, Legend } from 'recharts';\nimport { Database } from '../lib/database.types';\n\ntype SleepRecord = Database['public']['Tables']['sleep_records']['Row'];\n\ninterface SleepChartProps {\n  data: SleepRecord[];\n}\n\nexport function SleepChart({ data }: SleepChartProps) {\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return `${date.getMonth() + 1}/${date.getDate()}`;\n  };\n\n  const chartData = useMemo(() => {\n    return data\n      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())\n      .slice(-30)\n      .map(record => ({\n        date: record.date,\n        sleepHours: Number(record.sleep_hours),\n        sleepQuality: record.sleep_quality,\n        displayDate: formatDate(record.date)\n      }));\n  }, [data]);\n\n  if (data.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64 sm:h-96 text-gray-500\">\n        <div className=\"text-center px-4\">\n          <p className=\"text-base sm:text-lg mb-2\"></p>\n          <p className=\"text-sm\"></p>\n        </div>\n      </div>\n    );\n  }\n\n  const CustomTooltip = ({ active, payload }: any) => {\n    if (active && payload && payload.length) {\n      const data = payload[0].payload;\n      return (\n        <div className=\"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg\">\n          <p className=\"font-medium text-gray-900 dark:text-white mb-2\">\n            {data.displayDate}\n          </p>\n          <div className=\"space-y-1 text-sm\">\n            <p className=\"flex items-center\">\n              <span className=\"w-3 h-3 bg-indigo-500 rounded-full mr-2\"></span>\n              : <span className=\"font-semibold ml-1\">{data.sleepHours}</span>\n            </p>\n            {data.sleepQuality && (\n              <p className=\"flex items-center\">\n                <span className=\"w-3 h-3 bg-yellow-500 rounded-full mr-2\"></span>\n                : <span className=\"font-semibold ml-1\">{data.sleepQuality}/5</span>\n              </p>\n            )}\n          </div>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"w-full h-64 sm:h-96\">\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <LineChart data={chartData} margin={{ top: 5, right: 20, left: 0, bottom: 5 }}>\n          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-gray-300 dark:stroke-gray-700\" />\n          <XAxis\n            dataKey=\"displayDate\"\n            tick={{ fill: 'currentColor' }}\n            className=\"text-gray-600 dark:text-gray-400\"\n          />\n          <YAxis\n            label={{ value: '', angle: -90, position: 'insideLeft' }}\n            tick={{ fill: 'currentColor' }}\n            className=\"text-gray-600 dark:text-gray-400\"\n            domain={[0, 12]}\n          />\n          <Tooltip content={<CustomTooltip />} />\n          <Legend />\n          <ReferenceLine\n            y={7}\n            stroke=\"#10b981\"\n            strokeDasharray=\"3 3\"\n            label={{ value: '', position: 'right', fill: '#10b981' }}\n          />\n          <ReferenceLine\n            y={9}\n            stroke=\"#3b82f6\"\n            strokeDasharray=\"3 3\"\n            label={{ value: '', position: 'right', fill: '#3b82f6' }}\n          />\n          <Line\n            type=\"monotone\"\n            dataKey=\"sleepHours\"\n            stroke=\"#6366f1\"\n            strokeWidth={2}\n            dot={{ fill: '#6366f1', r: 4 }}\n            activeDot={{ r: 6 }}\n            name=\"\"\n          />\n        </LineChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n","import React, { useMemo } from 'react';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend, ReferenceLine } from 'recharts';\nimport { Database } from '../lib/database.types';\n\ntype MotivationRecord = Database['public']['Tables']['motivation_records']['Row'];\n\ninterface MotivationChartProps {\n  data: MotivationRecord[];\n}\n\nexport function MotivationChart({ data }: MotivationChartProps) {\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return `${date.getMonth() + 1}/${date.getDate()}`;\n  };\n\n  const chartData = useMemo(() => {\n    return data\n      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())\n      .slice(-30)\n      .map(record => ({\n        date: record.date,\n        motivation: record.motivation_level,\n        energy: record.energy_level,\n        stress: record.stress_level,\n        displayDate: formatDate(record.date)\n      }));\n  }, [data]);\n\n  if (data.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64 sm:h-96 text-gray-500\">\n        <div className=\"text-center px-4\">\n          <p className=\"text-base sm:text-lg mb-2\"></p>\n          <p className=\"text-sm\"></p>\n        </div>\n      </div>\n    );\n  }\n\n  const CustomTooltip = ({ active, payload }: any) => {\n    if (active && payload && payload.length) {\n      const data = payload[0].payload;\n      return (\n        <div className=\"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg\">\n          <p className=\"font-medium text-gray-900 dark:text-white mb-2\">\n            {data.displayDate}\n          </p>\n          <div className=\"space-y-1 text-sm\">\n            <p className=\"flex items-center\">\n              <span className=\"w-3 h-3 bg-blue-500 rounded-full mr-2\"></span>\n              : <span className=\"font-semibold ml-1\">{data.motivation}/10</span>\n            </p>\n            <p className=\"flex items-center\">\n              <span className=\"w-3 h-3 bg-green-500 rounded-full mr-2\"></span>\n              : <span className=\"font-semibold ml-1\">{data.energy}/10</span>\n            </p>\n            <p className=\"flex items-center\">\n              <span className=\"w-3 h-3 bg-red-500 rounded-full mr-2\"></span>\n              : <span className=\"font-semibold ml-1\">{data.stress}/10</span>\n            </p>\n          </div>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"w-full h-64 sm:h-96\">\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <LineChart data={chartData} margin={{ top: 5, right: 20, left: 0, bottom: 5 }}>\n          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-gray-300 dark:stroke-gray-700\" />\n          <XAxis\n            dataKey=\"displayDate\"\n            tick={{ fill: 'currentColor' }}\n            className=\"text-gray-600 dark:text-gray-400\"\n          />\n          <YAxis\n            domain={[0, 10]}\n            tick={{ fill: 'currentColor' }}\n            className=\"text-gray-600 dark:text-gray-400\"\n          />\n          <Tooltip content={<CustomTooltip />} />\n          <Legend />\n          <ReferenceLine\n            y={5}\n            stroke=\"#94a3b8\"\n            strokeDasharray=\"3 3\"\n            label={{ value: '', position: 'right', fill: '#94a3b8' }}\n          />\n          <Line\n            type=\"monotone\"\n            dataKey=\"motivation\"\n            stroke=\"#3b82f6\"\n            strokeWidth={2}\n            dot={{ fill: '#3b82f6', r: 3 }}\n            name=\"\"\n          />\n          <Line\n            type=\"monotone\"\n            dataKey=\"energy\"\n            stroke=\"#10b981\"\n            strokeWidth={2}\n            dot={{ fill: '#10b981', r: 3 }}\n            name=\"\"\n          />\n          <Line\n            type=\"monotone\"\n            dataKey=\"stress\"\n            stroke=\"#ef4444\"\n            strokeWidth={2}\n            dot={{ fill: '#ef4444', r: 3 }}\n            name=\"\"\n          />\n        </LineChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n","import React from 'react';\nimport { Moon, Heart, Activity, AlertTriangle, CheckCircle, TrendingUp, TrendingDown } from 'lucide-react';\nimport { ACWRData } from '../lib/acwr';\n\ninterface ConditioningSummaryCardProps {\n  latestACWR: ACWRData | null;\n  sleepHours: number | null;\n  sleepQuality: number | null;\n  motivationLevel: number | null;\n  energyLevel: number | null;\n  stressLevel: number | null;\n}\n\nexport function ConditioningSummaryCard({\n  latestACWR,\n  sleepHours,\n  sleepQuality,\n  motivationLevel,\n  energyLevel,\n  stressLevel\n}: ConditioningSummaryCardProps) {\n  const getOverallCondition = () => {\n    let score = 0;\n    let factors = 0;\n\n    if (latestACWR) {\n      factors++;\n      if (latestACWR.riskLevel === 'good') score += 3;\n      else if (latestACWR.riskLevel === 'caution') score += 2;\n      else if (latestACWR.riskLevel === 'low') score += 2.5;\n      else score += 1;\n    }\n\n    if (sleepHours !== null) {\n      factors++;\n      if (sleepHours >= 7 && sleepHours <= 9) score += 3;\n      else if (sleepHours >= 6 && sleepHours < 7) score += 2;\n      else score += 1;\n    }\n\n    if (motivationLevel !== null) {\n      factors++;\n      if (motivationLevel >= 7) score += 3;\n      else if (motivationLevel >= 5) score += 2;\n      else score += 1;\n    }\n\n    if (energyLevel !== null) {\n      factors++;\n      if (energyLevel >= 7) score += 3;\n      else if (energyLevel >= 5) score += 2;\n      else score += 1;\n    }\n\n    if (stressLevel !== null) {\n      factors++;\n      if (stressLevel <= 4) score += 3;\n      else if (stressLevel <= 6) score += 2;\n      else score += 1;\n    }\n\n    if (factors === 0) return { level: 'unknown', color: 'gray', label: '' };\n\n    const avgScore = score / factors;\n\n    if (avgScore >= 2.5) return { level: 'excellent', color: 'green', label: '', icon: CheckCircle };\n    if (avgScore >= 2) return { level: 'good', color: 'blue', label: '', icon: TrendingUp };\n    if (avgScore >= 1.5) return { level: 'fair', color: 'yellow', label: '', icon: AlertTriangle };\n    return { level: 'poor', color: 'red', label: '', icon: TrendingDown };\n  };\n\n  const overallCondition = getOverallCondition();\n  const ConditionIcon = overallCondition.icon || AlertTriangle;\n\n  const getRecommendation = () => {\n    const isHighACWR = latestACWR && (latestACWR.riskLevel === 'high' || latestACWR.riskLevel === 'caution');\n    const isLowSleep = sleepHours !== null && sleepHours < 7;\n    const isLowMotivation = motivationLevel !== null && motivationLevel < 5;\n    const isHighStress = stressLevel !== null && stressLevel > 7;\n\n    if (isHighACWR && isLowSleep) {\n      return {\n        text: '',\n        color: 'text-red-700 dark:text-red-400',\n        bg: 'bg-red-50 dark:bg-red-900/20'\n      };\n    }\n\n    if (isLowMotivation && isHighStress) {\n      return {\n        text: '',\n        color: 'text-orange-700 dark:text-orange-400',\n        bg: 'bg-orange-50 dark:bg-orange-900/20'\n      };\n    }\n\n    if (isLowSleep) {\n      return {\n        text: '',\n        color: 'text-yellow-700 dark:text-yellow-400',\n        bg: 'bg-yellow-50 dark:bg-yellow-900/20'\n      };\n    }\n\n    if (isHighACWR) {\n      return {\n        text: '',\n        color: 'text-blue-700 dark:text-blue-400',\n        bg: 'bg-blue-50 dark:bg-blue-900/20'\n      };\n    }\n\n    return {\n      text: '',\n      color: 'text-green-700 dark:text-green-400',\n      bg: 'bg-green-50 dark:bg-green-900/20'\n    };\n  };\n\n  const recommendation = getRecommendation();\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          \n        </h3>\n        <div className={`flex items-center space-x-2 px-4 py-2 bg-${overallCondition.color}-100 dark:bg-${overallCondition.color}-900/20 rounded-full`}>\n          <ConditionIcon className={`w-5 h-5 text-${overallCondition.color}-600 dark:text-${overallCondition.color}-400`} />\n          <span className={`font-semibold text-${overallCondition.color}-700 dark:text-${overallCondition.color}-400`}>\n            {overallCondition.label}\n          </span>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6\">\n        {latestACWR && (\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors\">\n            <div className=\"flex items-center mb-2\">\n              <Activity className=\"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2\" />\n              <span className=\"text-xs text-gray-600 dark:text-gray-400\">ACWR</span>\n            </div>\n            <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{latestACWR.acwr}</p>\n          </div>\n        )}\n\n        {sleepHours !== null && (\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors\">\n            <div className=\"flex items-center mb-2\">\n              <Moon className=\"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2\" />\n              <span className=\"text-xs text-gray-600 dark:text-gray-400\"></span>\n            </div>\n            <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{sleepHours.toFixed(1)}h</p>\n          </div>\n        )}\n\n        {motivationLevel !== null && (\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-colors\">\n            <div className=\"flex items-center mb-2\">\n              <Heart className=\"w-4 h-4 text-gray-500 dark:text-gray-400 mr-2\" />\n              <span className=\"text-xs text-gray-600 dark:text-gray-400\"></span>\n            </div>\n            <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{motivationLevel}/10</p>\n          </div>\n        )}\n      </div>\n\n      <div className={`${recommendation.bg} border border-${overallCondition.color}-200 dark:border-${overallCondition.color}-800 rounded-lg p-4`}>\n        <p className={`text-sm ${recommendation.color}`}>\n          {recommendation.text}\n        </p>\n      </div>\n    </div>\n  );\n}\n","import React, { useMemo, useState } from 'react';\nimport { Calendar, Droplets, AlertCircle, Zap, Cloud, Battery, Brain, Wind, Heart, Sparkles, Target } from 'lucide-react';\n\ntype Flow = 'light' | 'moderate' | 'heavy';\n\nconst SYMPTOM_OPTIONS = [\n  { value: 'cramps', label: '', icon: Zap },\n  { value: 'mood_changes', label: '', icon: Cloud },\n  { value: 'fatigue', label: '', icon: Battery },\n  { value: 'headache', label: '', icon: Brain },\n  { value: 'bloating', label: '', icon: Wind },\n  { value: 'breast_tenderness', label: '', icon: Heart },\n  { value: 'acne', label: '', icon: Sparkles },\n  { value: 'back_pain', label: '', icon: Target },\n];\n\ntype Props = {\n  selectedDate: string;\n\n  // Unified state \n  periodStart: boolean;\n  setPeriodStart: (v: boolean) => void;\n\n  flowIntensity: Flow;\n  setFlowIntensity: (v: Flow) => void;\n\n  symptoms: string[];\n  setSymptoms: (v: string[]) => void;\n\n  cycleNotes: string;\n  setCycleNotes: (v: string) => void;\n\n  periodDuration: number;\n  setPeriodDuration: (v: number) => void;\n\n  cycleLength: number;\n  setCycleLength: (v: number) => void;\n\n  error?: string | null;\n};\n\nexport function CycleSection({\n  selectedDate,\n  periodStart,\n  setPeriodStart,\n  flowIntensity,\n  setFlowIntensity,\n  symptoms,\n  setSymptoms,\n  cycleNotes,\n  setCycleNotes,\n  periodDuration,\n  setPeriodDuration,\n  cycleLength,\n  setCycleLength,\n  error,\n}: Props) {\n  //  duration \n  const [periodEndDate, setPeriodEndDate] = useState<string>('');\n\n  const computedPeriodDays = useMemo(() => {\n    if (!selectedDate || !periodEndDate) return null;\n    const start = new Date(selectedDate);\n    const end = new Date(periodEndDate);\n    const days = Math.floor((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n    return Number.isFinite(days) && days > 0 ? days : null;\n  }, [selectedDate, periodEndDate]);\n\n  const toggleSymptom = (s: string) => {\n    setSymptoms(symptoms.includes(s) ? symptoms.filter((x) => x !== s) : [...symptoms, s]);\n  };\n\n  return (\n    <div className=\"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow\">\n      <div className=\"flex items-center gap-2 mb-2\">\n        <Droplets className=\"w-6 h-6 text-pink-600 dark:text-pink-400\" />\n        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\"></h3>\n      </div>\n\n      {error && (\n        <div className=\"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg\">\n          <AlertCircle className=\"w-5 h-5\" />\n          <span>{error}</span>\n        </div>\n      )}\n\n      {/*  */}\n      <div className=\"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-4\">\n        <label className=\"flex items-center justify-between cursor-pointer\">\n          <span className=\"text-sm font-medium text-gray-800 dark:text-gray-200\">\n            1\n          </span>\n          <input\n            type=\"checkbox\"\n            checked={periodStart}\n            onChange={(e) => setPeriodStart(e.target.checked)}\n            className=\"h-5 w-5 accent-pink-600\"\n          />\n        </label>\n        <p className=\"mt-2 text-xs text-gray-500 dark:text-gray-400\">\n          \n        </p>\n      </div>\n\n      {/* Unified selectedDate  */}\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          <Calendar className=\"inline w-4 h-4 mr-1\" />\n          \n        </label>\n        <div className=\"w-full px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-100\">\n          {selectedDate}\n        </div>\n      </div>\n\n      {/*  */}\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          <Calendar className=\"inline w-4 h-4 mr-1\" />\n          \n        </label>\n        <input\n          type=\"date\"\n          value={periodEndDate}\n          min={selectedDate}\n          onChange={(e) => {\n            const v = e.target.value;\n            setPeriodEndDate(v);\n            //  duration \n            if (v) {\n              const start = new Date(selectedDate);\n              const end = new Date(v);\n              const days = Math.floor((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n              if (Number.isFinite(days) && days > 0) setPeriodDuration(days);\n            }\n          }}\n          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white\"\n        />\n        {computedPeriodDays != null && (\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">: {computedPeriodDays}</p>\n        )}\n      </div>\n\n      {/*  */}\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n        <select\n          value={flowIntensity}\n          onChange={(e) => setFlowIntensity(e.target.value as Flow)}\n          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white\"\n        >\n          <option value=\"light\"></option>\n          <option value=\"moderate\"></option>\n          <option value=\"heavy\"></option>\n        </select>\n      </div>\n\n      {/*  */}\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n          {SYMPTOM_OPTIONS.map((s) => {\n            const Icon = s.icon;\n            const active = symptoms.includes(s.value);\n            return (\n              <button\n                key={s.value}\n                type=\"button\"\n                onClick={() => toggleSymptom(s.value)}\n                className={`px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 ${\n                  active\n                    ? 'border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-105'\n                    : 'border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300 hover:scale-105'\n                }`}\n              >\n                <Icon className=\"w-4 h-4\" />\n                <span>{s.label}</span>\n              </button>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* / */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n          <input\n            type=\"number\"\n            min={1}\n            max={14}\n            value={periodDuration}\n            onChange={(e) => setPeriodDuration(Number(e.target.value))}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n          <input\n            type=\"number\"\n            min={20}\n            max={45}\n            value={cycleLength}\n            onChange={(e) => setCycleLength(Number(e.target.value))}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white\"\n          />\n        </div>\n      </div>\n\n      {/*  */}\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n        <textarea\n          value={cycleNotes}\n          onChange={(e) => setCycleNotes(e.target.value)}\n          rows={3}\n          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white\"\n          placeholder=\"...\"\n        />\n      </div>\n\n      <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n         /\n      </div>\n    </div>\n  );\n}","// UnifiedDailyCheckIn.tsx\nimport React, { useState } from 'react';\nimport { X, CheckCircle, Activity, Scale, Moon, Heart, Zap, Calendar } from 'lucide-react';\nimport { TrainingRecord, WeightRecord, SleepRecord, MotivationRecord } from '../lib/supabase';\nimport { GenericDuplicateModal } from './GenericDuplicateModal';\nimport { getTodayJSTString } from '../lib/date';\nimport { useMenstrualCycleData } from '../hooks/useMenstrualCycleData';\nimport { CycleSection } from './checkin/CycleSection';\n\n//  / UI\nimport { VectorArrowPicker } from './VectorArrowPicker';\nimport { SignalPicker } from './SignalPicker';\n\n//  lastRecord  normalizeRecords \nimport type {\n  TrainingRecordCheckIn,\n  SleepRecordForm,\n  MotivationRecordForm,\n  // WeightRecordForm  normalizeRecords \n} from '../lib/normalizeRecords';\n\n// Weight  normalizeRecords  normalizeRecords \ntype WeightRecordForm = { weight_kg: number; date: string; notes?: string | null };\n\ninterface UnifiedDailyCheckInProps {\n  userId: string;\n  userGender?: 'male' | 'female' | null;\n  enableCycle?: boolean | null;\n\n  // trainingarrow/signal \n  onTrainingSubmit: (data: {\n    rpe: number;\n    duration_min: number;\n    date: string;\n    arrow_score?: number;\n    signal_score?: number;\n  }) => Promise<void>;\n  onTrainingCheckExisting: (date: string) => Promise<TrainingRecord | null>;\n  onTrainingUpdate: (\n    id: string,\n    data: { rpe: number; duration_min: number; arrow_score: number; signal_score: number }\n  ) => Promise<void>;\n\n  // weight\n  onWeightSubmit: (data: { weight_kg: number; date: string; notes?: string }) => Promise<void>;\n  onWeightCheckExisting: (date: string) => Promise<WeightRecord | null>;\n  onWeightUpdate: (id: string, data: { weight_kg: number; notes?: string }) => Promise<void>;\n\n  // sleep\n  onSleepSubmit: (data: {\n    sleep_hours: number;\n    sleep_quality: number;\n    date: string;\n    notes?: string;\n  }) => Promise<void>;\n  onSleepCheckExisting: (date: string) => Promise<SleepRecord | null>;\n  onSleepUpdate: (id: string, data: any) => Promise<void>;\n\n  // motivation\n  onMotivationSubmit: (data: {\n    motivation_level: number;\n    energy_level: number;\n    stress_level: number;\n    date: string;\n    notes?: string;\n  }) => Promise<void>;\n  onMotivationCheckExisting: (date: string) => Promise<MotivationRecord | null>;\n  onMotivationUpdate: (id: string, data: any) => Promise<void>;\n\n\n  //  cycle\n  onCycleSubmit?: (data: {\n    cycle_start_date: string;\n    period_duration_days?: number;\n    cycle_length_days?: number;\n    symptoms?: string[];\n    flow_intensity?: string;\n    notes?: string;\n  }) => Promise<any>;\n\n  onCycleUpdate?: (\n    id: string,\n    data: {\n      period_duration_days?: number;\n      cycle_length_days?: number;\n      symptoms?: string[];\n      flow_intensity?: string;\n      notes?: string;\n    }\n  ) => Promise<any>\n\n  onClose: () => void;\n\n  //   /  null  \n  lastTrainingRecord: TrainingRecordCheckIn | null;\n  lastWeightRecord: WeightRecordForm | null;\n  lastSleepRecord: SleepRecordForm | null;\n  lastMotivationRecord: MotivationRecordForm | null;\n}\n\nexport function UnifiedDailyCheckIn({\n  userId,\n  userGender,\n  enableCycle,\n  onTrainingSubmit,\n  onTrainingCheckExisting,\n  onTrainingUpdate,\n  onWeightSubmit,\n  onWeightCheckExisting,\n  onWeightUpdate,\n  onSleepSubmit,\n  onSleepCheckExisting,\n  onSleepUpdate,\n  onMotivationSubmit,\n  onMotivationCheckExisting,\n  onMotivationUpdate,\n  onCycleSubmit,\n  onCycleUpdate,\n  onClose,\n  lastTrainingRecord,\n  lastWeightRecord,\n  lastSleepRecord,\n  lastMotivationRecord,\n}: UnifiedDailyCheckInProps) {\n  const today = getTodayJSTString();\n\n  //  cycle props  /  hook \n  const cycleEnabled = (enableCycle ?? (userGender === 'female')) === true;\n\n\n  const updateCycle =\n    onCycleUpdate ??\n    (async (\n      id: string,\n      data: {\n        period_duration_days?: number;\n        cycle_length_days?: number;\n        symptoms?: string[];\n        flow_intensity?: string;\n        notes?: string;\n      }\n    ) => {\n      return await cycleHook.updateCycle(id, data);\n    });\n\n  const [selectedDate, setSelectedDate] = useState<string>(today);\n  const [activeSection, setActiveSection] = useState<'training' | 'weight' | 'conditioning' | 'cycle'>(\n    'training'\n  );\n\n \n\n  //  0 ||??\n  const [rpe, setRpe] = useState<number>(lastTrainingRecord?.rpe ?? 5);\n  const [duration, setDuration] = useState<number>(lastTrainingRecord?.duration_min ?? 60);\n\n  //  /\n  const [arrowScore, setArrowScore] = useState<number>((lastTrainingRecord as any)?.arrow_score ?? 50);\n  const [signalScore, setSignalScore] = useState<number>((lastTrainingRecord as any)?.signal_score ?? 50);\n\n  const [weight, setWeight] = useState<string>(\n    lastWeightRecord?.weight_kg != null ? String(lastWeightRecord.weight_kg) : ''\n  );\n  const [weightNotes, setWeightNotes] = useState<string>('');\n\n  const [sleepHours, setSleepHours] = useState<number>(lastSleepRecord?.sleep_hours ?? 7);\n  const [sleepQuality, setSleepQuality] = useState<number>((lastSleepRecord as any)?.sleep_quality ?? 3);\n  const [sleepNotes, setSleepNotes] = useState<string>('');\n\n  const [motivationLevel, setMotivationLevel] = useState<number>(lastMotivationRecord?.motivation_level ?? 7);\n  const [energyLevel, setEnergyLevel] = useState<number>(lastMotivationRecord?.energy_level ?? 7);\n  const [stressLevel, setStressLevel] = useState<number>(lastMotivationRecord?.stress_level ?? 5);\n  const [conditioningNotes, setConditioningNotes] = useState<string>('');\n\n  // Menstrual cycle tracking (for female users)\n  const [periodStart, setPeriodStart] = useState<boolean>(false);\n  const [periodDuration, setPeriodDuration] = useState<number>(5);\n  const [cycleLength, setCycleLength] = useState<number>(28);\n  const [flowIntensity, setFlowIntensity] = useState<'light' | 'moderate' | 'heavy'>('moderate');\n  const [symptoms, setSymptoms] = useState<string[]>([]);\n  const [cycleNotes, setCycleNotes] = useState<string>('');\n\n  const [completedSections, setCompletedSections] = useState<Set<string>>(new Set());\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string>('');\n  const [isSliding, setIsSliding] = useState(false);\n\n  // Duplicate detection states\n  const [showDuplicateModal, setShowDuplicateModal] = useState(false);\n  const [duplicateType, setDuplicateType] = useState<\n    'training' | 'weight' |'conditioning' | 'cycle' | null\n  >(null);\n  const [existingRecord, setExistingRecord] = useState<any>(null);\n  const [pendingData, setPendingData] = useState<any>(null);\n  //  \n  const getNextLabel = () => {\n    const isLast = cycleEnabled ? activeSection === \"cycle\" : activeSection === \"conditioning\";\n    return isLast ? \"\" : \"\";\n  };\n\n  const handleSectionComplete = async (section: 'training' | 'weight' | 'conditioning' | 'cycle') => {\n    setSubmitting(true);\n    setError('');\n\n    try {\n      if (section === 'training') {\n        const existing = await onTrainingCheckExisting(selectedDate);\n    \n        if (existing) {\n          setDuplicateType('training');\n          setExistingRecord(existing);\n          setPendingData({\n            rpe,\n            duration_min: duration,\n            date: selectedDate,\n            arrow_score: arrowScore,\n            signal_score: signalScore,\n          });\n          setShowDuplicateModal(true);\n          setSubmitting(false);\n          return;\n        }\n    \n        await onTrainingSubmit({\n          rpe,\n          duration_min: duration,\n          date: selectedDate,\n          arrow_score: arrowScore ?? 50,\n          signal_score: signalScore ?? 50,\n        });\n    \n        setCompletedSections((prev) => new Set(prev).add('training'));\n        setActiveSection('weight');\n        return;\n      }\n    \n      if (section === 'weight') {\n        if (weight) {\n          const existing = await onWeightCheckExisting(selectedDate);\n    \n          if (existing) {\n            setDuplicateType('weight');\n            setExistingRecord(existing);\n            setPendingData({\n              weight_kg: Number(weight),\n              date: selectedDate,\n              notes: weightNotes || undefined,\n            });\n            setShowDuplicateModal(true);\n            setSubmitting(false);\n            return;\n          }\n    \n          await onWeightSubmit({\n            weight_kg: Number(weight),\n            date: selectedDate,\n            notes: weightNotes || undefined,\n          });\n    \n          setCompletedSections((prev) => new Set(prev).add('weight'));\n        }\n    \n        setActiveSection('conditioning');\n        return;\n      }\n    \n      if (section === 'conditioning') {\n        const [existingSleep, existingMotivation] = await Promise.all([\n          onSleepCheckExisting(selectedDate),\n          onMotivationCheckExisting(selectedDate),\n        ]);\n    \n        //  1\n        if (existingSleep || existingMotivation) {\n          setDuplicateType('conditioning');\n          setExistingRecord({ sleep: existingSleep, motivation: existingMotivation });\n          setPendingData({\n            sleep: {\n              sleep_hours: sleepHours,\n              sleep_quality: sleepQuality,\n              date: selectedDate,\n              notes: sleepNotes || undefined,\n            },\n            motivation: {\n              motivation_level: motivationLevel,\n              energy_level: energyLevel,\n              stress_level: stressLevel,\n              date: selectedDate,\n              notes: conditioningNotes || undefined,\n            },\n          });\n          setShowDuplicateModal(true);\n          setSubmitting(false);\n          return;\n        }\n    \n        //    \n        await onSleepSubmit({\n          sleep_hours: sleepHours,\n          sleep_quality: sleepQuality,\n          date: selectedDate,\n          notes: sleepNotes || undefined,\n        });\n    \n        await onMotivationSubmit({\n          motivation_level: motivationLevel,\n          energy_level: energyLevel,\n          stress_level: stressLevel,\n          date: selectedDate,\n          notes: conditioningNotes || undefined,\n        });\n    \n        setCompletedSections((prev) => new Set(prev).add('conditioning'));\n    \n        //  cycle\n        if (cycleEnabled) {\n          setActiveSection('cycle');\n        } else {\n          setTimeout(() => onClose(), 500);\n        }\n        return;\n      }\n    \n      if (section === 'cycle') {\n        if (periodStart) {\n          if (!onCycleSubmit) throw new Error('onCycleSubmit ');\n    \n          await onCycleSubmit({\n            cycle_start_date: selectedDate,\n            period_duration_days: periodDuration,\n            cycle_length_days: cycleLength,\n            flow_intensity: flowIntensity,\n            symptoms: symptoms.length > 0 ? symptoms : undefined,\n            notes: cycleNotes || undefined,\n          });\n        }\n    \n        setCompletedSections((prev) => new Set(prev).add('cycle'));\n        setTimeout(() => onClose(), 500);\n        return;\n      }    \n\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : '';\n      setError(\n        `${\n          section === 'training'\n            ? ''\n            : section === 'weight'\n            ? ''\n            : section === 'cycle'\n            ? ''\n            : ''\n        }: ${errorMessage}`\n      );\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleOverwrite = async () => {\n    if (!existingRecord || !pendingData || !duplicateType) return;\n\n    setShowDuplicateModal(false);\n    setSubmitting(true);\n\n    try {\n      if (duplicateType === 'training') {\n        await onTrainingUpdate(existingRecord.id, {\n          rpe: pendingData.rpe,\n          duration_min: pendingData.duration_min,\n          arrow_score: pendingData.arrow_score,\n          signal_score: pendingData.signal_score,\n        });\n        setCompletedSections((prev) => new Set(prev).add('training'));\n        setActiveSection('weight');\n      } else if (duplicateType === 'weight') {\n        await onWeightUpdate(existingRecord.id, {\n          weight_kg: pendingData.weight_kg,\n          notes: pendingData.notes,\n        });\n        setCompletedSections((prev) => new Set(prev).add('weight'));\n        setActiveSection('conditioning');\n      } else if (duplicateType === 'conditioning') {\n        const ex = existingRecord as { sleep: any | null; motivation: any | null };\n        const pd = pendingData as { sleep: any; motivation: any };\n    \n        // sleep\n        if (ex.sleep) await onSleepUpdate(ex.sleep.id, pd.sleep);\n        else await onSleepSubmit(pd.sleep);\n    \n        // motivation\n        if (ex.motivation) await onMotivationUpdate(ex.motivation.id, pd.motivation);\n        else await onMotivationSubmit(pd.motivation);\n    \n        setCompletedSections((prev) => new Set(prev).add('conditioning'));\n    \n        //  cycle\n        if (cycleEnabled) setActiveSection('cycle');\n        else setTimeout(() => onClose(), 500);\n      }\n    \n      setExistingRecord(null);\n      setPendingData(null);\n      setDuplicateType(null);\n    } catch (err) {\n      setError('');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleCancelOverwrite = () => {\n    setShowDuplicateModal(false);\n    setExistingRecord(null);\n    setPendingData(null);\n    setDuplicateType(null);\n  };\n\n  const getSectionIcon = (section: string) => {\n    switch (section) {\n      case 'training':\n        return Activity;\n      case 'weight':\n        return Scale;\n      case 'conditioning':\n        return Heart;\n      case 'cycle':\n        return Calendar;\n      default:\n        return Activity;\n    }\n  };\n\n  const rpeLabels = [\n    '0 - ',\n    '1 - ',\n    '2 - ',\n    '3 - ',\n    '4 - ',\n    '5 - ',\n    '6 - ',\n    '7 - ',\n    '8 - ',\n    '9 - ',\n    '10 - ',\n  ];\n\n  const getModalTitle = () => {\n    switch (duplicateType) {\n      case 'training':\n        return '';\n      case 'weight':\n        return '';\n      case 'conditioning':\n        return '';\n      default:\n        return '';\n    }\n  };\n\n  //  DuplicateModal/\n  const getModalValues = () => {\n    if (!existingRecord || !pendingData) return { existing: [], pending: [] };\n\n    switch (duplicateType) {\n      case 'training':\n        return {\n          existing: [\n            { label: 'RPE', value: existingRecord.rpe?.toString() || '-' },\n            { label: '', value: `${existingRecord.duration_min || 0}` },\n            { label: '', value: existingRecord.arrow_score != null ? '' : '' },\n            { label: '', value: existingRecord.signal_score != null ? '' : '' },\n          ],\n          pending: [\n            { label: 'RPE', value: pendingData.rpe?.toString() || '-' },\n            { label: '', value: `${pendingData.duration_min || 0}` },\n            { label: '', value: '' },\n            { label: '', value: '' },\n          ],\n        };\n      case 'weight':\n        return {\n          existing: [{ label: '', value: `${existingRecord.weight_kg || 0} kg` }],\n          pending: [{ label: '', value: `${pendingData.weight_kg || 0} kg` }],\n        };\n        case 'conditioning': {\n          const ex = existingRecord as { sleep: any | null; motivation: any | null };\n          return {\n            existing: [\n              { label: '', value: ex.sleep ? `${ex.sleep.sleep_hours ?? 0}` : '' },\n              { label: '', value: ex.sleep ? `${ex.sleep.sleep_quality ?? 0}/5` : '' },\n              { label: '', value: ex.motivation ? `${ex.motivation.motivation_level ?? 0}/10` : '' },\n              { label: '', value: ex.motivation ? `${ex.motivation.energy_level ?? 0}/10` : '' },\n              { label: '', value: ex.motivation ? `${ex.motivation.stress_level ?? 0}/10` : '' },\n            ],\n            pending: [\n              { label: '', value: `${pendingData.sleep.sleep_hours ?? 0}` },\n              { label: '', value: `${pendingData.sleep.sleep_quality ?? 0}/5` },\n              { label: '', value: `${pendingData.motivation.motivation_level ?? 0}/10` },\n              { label: '', value: `${pendingData.motivation.energy_level ?? 0}/10` },\n              { label: '', value: `${pendingData.motivation.stress_level ?? 0}/10` },\n            ],\n          };\n        }\n        \n      default:\n        return { existing: [], pending: [] };\n    }\n  };\n\n  // \n  const TinyScale = ({ values, highlight }: { values: number[]; highlight?: number }) => {\n    return (\n      <div className=\"mt-1 flex justify-between text-[10px] leading-none text-gray-500 dark:text-gray-400 select-none\">\n        {values.map((v) => (\n          <span key={v} className={v === highlight ? 'font-semibold text-gray-700 dark:text-gray-200' : ''}>\n            {v}\n          </span>\n        ))}\n      </div>\n    );\n  };\n\n  const modalValues = getModalValues();\n\n  return (\n    <>\n      <GenericDuplicateModal\n        isOpen={showDuplicateModal}\n        onClose={handleCancelOverwrite}\n        onOverwrite={handleOverwrite}\n        onCancel={handleCancelOverwrite}\n        title={getModalTitle()}\n        date={selectedDate}\n        existingValues={modalValues.existing}\n        newValues={modalValues.pending}\n      />\n\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n        <div\n          className={`bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] ${\n            isSliding ? 'overflow-hidden' : 'overflow-y-auto'\n          }`}\n        >\n          <div className=\"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 z-10\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\"></h2>\n              <button\n                onClick={onClose}\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors\"\n                type=\"button\"\n              >\n                <X className=\"w-6 h-6\" />\n              </button>\n            </div>\n\n            <div className=\"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400 mb-4\">\n              <Calendar className=\"w-4 h-4\" />\n              <input\n                type=\"date\"\n                value={selectedDate}\n                onChange={(e) => setSelectedDate(e.target.value)}\n                className=\"bg-transparent border-none text-gray-900 dark:text-white font-medium focus:outline-none\"\n              />\n            </div>\n\n            <div className=\"flex space-x-2\">\n              {(cycleEnabled\n                  ? (['training', 'weight', 'conditioning', 'cycle'] as const)\n                  : (['training', 'weight', 'conditioning'] as const)\n                ).map((section) => {\n                const Icon = getSectionIcon(section);\n                const isActive = activeSection === section;\n                const isCompleted = completedSections.has(section);\n\n                return (\n                  <button\n                    key={section}\n                    onClick={() => setActiveSection(section)}\n                    className={`flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all flex items-center justify-center space-x-2 ${\n                      isActive\n                        ? 'bg-blue-600 text-white shadow-lg'\n                        : isCompleted\n                        ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\n                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600'\n                    }`}\n                    type=\"button\"\n                  >\n                    {isCompleted ? <CheckCircle className=\"w-4 h-4\" /> : <Icon className=\"w-4 h-4\" />}\n                    <span className=\"hidden sm:inline\">\n                      {section === 'training'\n                        ? ''\n                        : section === 'weight'\n                        ? ''\n                        : section === 'cycle'\n                        ? ''\n                        : ''}\n                    </span>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          <div className=\"p-6\">\n            {activeSection === 'training' && (\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center space-x-3 mb-4\">\n                  <div className=\"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-lg\">\n                    <Activity className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h3>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">RPE</p>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    RPE ()\n                  </label>\n                  <input\n                    type=\"range\"\n                    min=\"0\"\n                    max=\"10\"\n                    value={rpe}\n                    onChange={(e) => setRpe(Number(e.target.value))}\n                    onPointerDown={() => setIsSliding(true)}\n                    onPointerUp={() => setIsSliding(false)}\n                    onPointerCancel={() => setIsSliding(false)}\n                    className=\"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600\"\n                  />\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-2\">{rpeLabels[rpe]}</p>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    {duration}\n                    <span className=\"ml-2 text-xs text-gray-500\">\n                      {Math.floor(duration / 60)}{duration % 60}\n                    </span>\n                  </label>\n\n                  <div className=\"py-3 -my-3\">\n                    <input\n                      type=\"range\"\n                      min=\"0\"\n                      max=\"480\"\n                      step=\"5\"\n                      value={duration}\n                      onChange={(e) => setDuration(Number(e.target.value))}\n                      onPointerDown={() => setIsSliding(true)}\n                      onPointerUp={() => setIsSliding(false)}\n                      onPointerCancel={() => setIsSliding(false)}\n                      className=\"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600\"\n                    />\n                  </div>\n\n                  <div className=\"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                    <span>0</span>\n                    <span>4</span>\n                    <span>8</span>\n                  </div>\n                </div>\n\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\n                  <p className=\"text-sm text-blue-900 dark:text-blue-200\">\n                    <strong>:</strong> {rpe * duration}\n                  </p>\n                </div>\n\n                {/*  / */}\n                <VectorArrowPicker value={arrowScore} onChange={setArrowScore} />\n                <SignalPicker value={signalScore} onChange={setSignalScore} />\n              </div>\n            )}\n\n            {activeSection === 'weight' && (\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center space-x-3 mb-4\">\n                  <div className=\"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg\">\n                    <Scale className=\"w-6 h-6 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h3>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\"></p>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                     (kg)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={weight}\n                    onChange={(e) => setWeight(e.target.value)}\n                    placeholder=\": 65.5\"\n                    className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white text-lg\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                     ()\n                  </label>\n                  <textarea\n                    value={weightNotes}\n                    onChange={(e) => setWeightNotes(e.target.value)}\n                    placeholder=\"\"\n                    rows={2}\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white\"\n                  />\n                </div>\n\n                {lastWeightRecord && (\n                  <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4\">\n                    <p className=\"text-sm text-green-900 dark:text-green-200\">\n                      <strong>:</strong> {Number(lastWeightRecord.weight_kg).toFixed(1)} kg\n                    </p>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {activeSection === 'conditioning' && (\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center space-x-3 mb-4\">\n                  <div className=\"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg\">\n                    <Heart className=\"w-6 h-6 text-purple-600 dark:text-purple-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h3>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\"></p>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    <Moon className=\"w-4 h-4 inline mr-1\" />\n                    <span className=\"font-semibold\">{sleepHours}</span>\n                    <span className=\"ml-2 text-xs text-gray-500\">\n                      {Math.floor(sleepHours)}{Math.round((sleepHours % 1) * 60)}\n                    </span>\n                  </label>\n\n                  {lastSleepRecord && (\n                    <p className=\"text-xs text-gray-400 dark:text-gray-500 mb-2\">\n                      {lastSleepRecord.date}{lastSleepRecord.sleep_hours}\n                      {(lastSleepRecord as any)?.sleep_quality != null\n                        ? ` /  ${(lastSleepRecord as any).sleep_quality}/5`\n                        : ''}\n                    </p>\n                  )}\n\n                  <div className=\"py-3 -my-3\">\n                    <input\n                      type=\"range\"\n                      min=\"0\"\n                      max=\"12\"\n                      step=\"0.25\"\n                      value={sleepHours}\n                      onChange={(e) => setSleepHours(Number(e.target.value))}\n                      onPointerDown={() => setIsSliding(true)}\n                      onPointerUp={() => setIsSliding(false)}\n                      onPointerCancel={() => setIsSliding(false)}\n                      className=\"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600\"\n                    />\n                  </div>\n\n                  <div className=\"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                    <span>0h</span>\n                    <span>6h</span>\n                    <span>12h</span>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    <span className=\"font-semibold\">{sleepQuality}</span>/5\n                  </label>\n\n                  {lastSleepRecord && (\n                    <p className=\"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2\">\n                      {lastSleepRecord.date}{(lastSleepRecord as any)?.sleep_quality ?? ''}/5\n                    </p>\n                  )}\n\n                  <div className=\"py-3 -my-3\">\n                    <input\n                      type=\"range\"\n                      min=\"1\"\n                      max=\"5\"\n                      step=\"1\"\n                      value={sleepQuality}\n                      onChange={(e) => setSleepQuality(Number(e.target.value))}\n                      onPointerDown={() => setIsSliding(true)}\n                      onPointerUp={() => setIsSliding(false)}\n                      onPointerCancel={() => setIsSliding(false)}\n                      className=\"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600\"\n                    />\n                  </div>\n\n                  <TinyScale values={[1, 2, 3, 4, 5]} highlight={sleepQuality} />\n\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                    {sleepQuality === 5 && ''}\n                    {sleepQuality === 4 && ''}\n                    {sleepQuality === 3 && ''}\n                    {sleepQuality === 2 && ''}\n                    {sleepQuality === 1 && ''}\n                  </p>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    <Zap className=\"w-4 h-4 inline mr-1\" />\n                    <span className=\"font-semibold\">{motivationLevel}</span>/10\n                  </label>\n\n                  {lastMotivationRecord && (\n                    <p className=\"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2\">\n                      {lastMotivationRecord.date}{lastMotivationRecord.motivation_level}/10\n                    </p>\n                  )}\n\n                  <div className=\"py-3 -my-3\">\n                    <input\n                      type=\"range\"\n                      min=\"1\"\n                      max=\"10\"\n                      step=\"1\"\n                      value={motivationLevel}\n                      onChange={(e) => setMotivationLevel(Number(e.target.value))}\n                      onPointerDown={() => setIsSliding(true)}\n                      onPointerUp={() => setIsSliding(false)}\n                      onPointerCancel={() => setIsSliding(false)}\n                      className=\"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600\"\n                    />\n                  </div>\n\n                  <TinyScale values={[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]} highlight={motivationLevel} />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    <span className=\"font-semibold\">{energyLevel}</span>/10\n                  </label>\n\n                  {lastMotivationRecord && (\n                    <p className=\"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2\">\n                      {lastMotivationRecord.date}{lastMotivationRecord.energy_level}/10\n                    </p>\n                  )}\n\n                  <div className=\"py-3 -my-3\">\n                    <input\n                      type=\"range\"\n                      min=\"1\"\n                      max=\"10\"\n                      step=\"1\"\n                      value={energyLevel}\n                      onChange={(e) => setEnergyLevel(Number(e.target.value))}\n                      onPointerDown={() => setIsSliding(true)}\n                      onPointerUp={() => setIsSliding(false)}\n                      onPointerCancel={() => setIsSliding(false)}\n                      className=\"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600\"\n                    />\n                  </div>\n\n                  <TinyScale values={[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]} highlight={energyLevel} />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    <span className=\"font-semibold\">{stressLevel}</span>/10\n                  </label>\n\n                  {lastMotivationRecord && (\n                    <p className=\"text-[11px] text-gray-400 dark:text-gray-500 -mt-1 mb-2\">\n                      {lastMotivationRecord.date}{lastMotivationRecord.stress_level}/10\n                    </p>\n                  )}\n\n                  <div className=\"py-3 -my-3\">\n                    <input\n                      type=\"range\"\n                      min=\"1\"\n                      max=\"10\"\n                      step=\"1\"\n                      value={stressLevel}\n                      onChange={(e) => setStressLevel(Number(e.target.value))}\n                      onPointerDown={() => setIsSliding(true)}\n                      onPointerUp={() => setIsSliding(false)}\n                      onPointerCancel={() => setIsSliding(false)}\n                      className=\"w-full h-2 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600\"\n                    />\n                  </div>\n\n                  <TinyScale values={[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]} highlight={stressLevel} />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                     ()\n                  </label>\n                  <textarea\n                    value={conditioningNotes}\n                    onChange={(e) => setConditioningNotes(e.target.value)}\n                    placeholder=\"\"\n                    rows={2}\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                  />\n                </div>\n              </div>\n            )}\n            \n            {error && activeSection !== 'cycle' && (\n              <div className=\"mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n                <p className=\"text-sm text-red-700 dark:text-red-400\">{error}</p>\n              </div>\n            )}\n\n\n\n            {activeSection === 'cycle' && cycleEnabled && (\n              <CycleSection\n                selectedDate={selectedDate}\n                periodStart={periodStart}\n                setPeriodStart={setPeriodStart}\n                flowIntensity={flowIntensity}\n                setFlowIntensity={setFlowIntensity}\n                symptoms={symptoms}\n                setSymptoms={setSymptoms}\n                cycleNotes={cycleNotes}\n                setCycleNotes={setCycleNotes}\n                periodDuration={periodDuration}\n                setPeriodDuration={setPeriodDuration}\n                cycleLength={cycleLength}\n                setCycleLength={setCycleLength}\n                error={error || null}\n              />\n            )} \n            {/*   */}\n            <div className=\"mt-6\">\n              <button\n                type=\"button\"\n                onClick={() => void handleSectionComplete(activeSection)}\n                disabled={submitting}\n                className={`w-full py-3 rounded-xl font-semibold transition-colors ${\n                  submitting\n                    ? \"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 cursor-not-allowed\"\n                    : \"bg-blue-600 hover:bg-blue-700 text-white\"\n                }`}\n              >\n                {submitting ? \"...\" : getNextLabel()}\n              </button>\n            </div>\n\n            <div className=\"mt-4 flex justify-center\">\n              <button\n                onClick={onClose}\n                className=\"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200\"\n                type=\"button\"\n              >\n                \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}","import React, { useMemo } from 'react';\nimport { Activity, Scale, Heart, TrendingUp, TrendingDown, AlertTriangle, Calendar, ChevronRight, Plus, Droplets } from 'lucide-react';\nimport { ACWRData } from '../lib/acwr';\nimport type { Database } from '../lib/database.types';\n\ntype MenstrualCycle = Database['public']['Tables']['menstrual_cycles']['Row'];\n\ninterface WeightRecord {\n  weight_kg: number;\n  date: string;\n}\n\ninterface SleepRecord {\n  sleep_hours: number;\n  sleep_quality: number;\n  date: string;\n}\n\ninterface MotivationRecord {\n  motivation_level: number;\n  energy_level: number;\n  stress_level: number;\n  date: string;\n}\n\ninterface TrainingRecord {\n  rpe: number;\n  duration_min: number;\n  date: string;\n  training_load?: number;\n}\n\ninterface ConsolidatedOverviewDashboardProps {\n  acwrData: ACWRData[];\n  weightRecords: WeightRecord[];\n  sleepRecords: SleepRecord[];\n  motivationRecords: MotivationRecord[];\n  trainingRecords: TrainingRecord[];\n  menstrualCycles?: MenstrualCycle[];\n  userGender?: string | null;\n  onOpenDetailView: (section: 'training' | 'weight' | 'conditioning' | 'cycle') => void;\n  onQuickAdd: () => void;\n}\n\nexport function ConsolidatedOverviewDashboard({\n  acwrData,\n  weightRecords,\n  sleepRecords,\n  motivationRecords,\n  trainingRecords,\n  menstrualCycles = [],\n  userGender,\n  onOpenDetailView,\n  onQuickAdd\n}: ConsolidatedOverviewDashboardProps) {\n\n  //  ACWR:   date\n  const latestACWR = useMemo(() => {\n    if (!acwrData || acwrData.length === 0) return null;\n\n    // ACWRData  date OK\n    const withDate = acwrData.filter((x: any) => x?.date);\n    if (withDate.length === 0) return acwrData[acwrData.length - 1] ?? null;\n\n    return withDate.reduce((a: any, b: any) =>\n      new Date(a.date).getTime() >= new Date(b.date).getTime() ? a : b\n    );\n  }, [acwrData]);\n\n  //  \n  const latestWeight = useMemo(() => {\n    if (!weightRecords || weightRecords.length === 0) return null;\n    return weightRecords.reduce((a, b) =>\n      new Date(a.date).getTime() >= new Date(b.date).getTime() ? a : b\n    );\n  }, [weightRecords]);\n\n  //  sleep_quality  null OK\n  const latestSleep = useMemo(() => {\n    if (!sleepRecords || sleepRecords.length === 0) return null;\n    return sleepRecords.reduce((a, b) =>\n      new Date(a.date).getTime() >= new Date(b.date).getTime() ? a : b\n    );\n  }, [sleepRecords]);\n\n  //  \n  const latestMotivation = useMemo(() => {\n    if (!motivationRecords || motivationRecords.length === 0) return null;\n    return motivationRecords.reduce((a, b) =>\n      new Date(a.date).getTime() >= new Date(b.date).getTime() ? a : b\n    );\n  }, [motivationRecords]);\n\n  //  \n  const latestTraining = useMemo(() => {\n    if (!trainingRecords || trainingRecords.length === 0) return null;\n    return trainingRecords.reduce((a, b) =>\n      new Date(a.date).getTime() >= new Date(b.date).getTime() ? a : b\n    );\n  }, [trainingRecords]);\n\n\n  const getWeightTrend = () => {\n    if (weightRecords.length < 2) return null;\n    const recent = Number(weightRecords[0].weight_kg);\n    const previous = Number(weightRecords[1].weight_kg);\n    const diff = recent - previous;\n    return { value: diff, isUp: diff > 0 };\n  };\n\n  const getSleepAverage = () => {\n    if (sleepRecords.length === 0) return null;\n    const recentWeek = sleepRecords.slice(0, 7);\n    const avg = recentWeek.reduce((sum, r) => sum + Number(r.sleep_hours), 0) / recentWeek.length;\n    return avg;\n  };\n\n  const getRiskColor = (riskLevel: string) => {\n    switch (riskLevel) {\n      case 'good':\n        return 'text-green-600 dark:text-green-400';\n      case 'caution':\n        return 'text-yellow-600 dark:text-yellow-400';\n      case 'high':\n        return 'text-red-600 dark:text-red-400';\n      default:\n        return 'text-blue-600 dark:text-blue-400';\n    }\n  };\n\n  const getRiskBg = (riskLevel: string) => {\n    switch (riskLevel) {\n      case 'good':\n        return 'bg-green-50 dark:bg-green-900/20';\n      case 'caution':\n        return 'bg-yellow-50 dark:bg-yellow-900/20';\n      case 'high':\n        return 'bg-red-50 dark:bg-red-900/20';\n      default:\n        return 'bg-blue-50 dark:bg-blue-900/20';\n    }\n  };\n\n  const getHealthScore = () => {\n    let score = 0;\n    let factors = 0;\n\n    if (latestACWR) {\n      factors++;\n      if (latestACWR.riskLevel === 'good') score += 25;\n      else if (latestACWR.riskLevel === 'caution') score += 15;\n      else if (latestACWR.riskLevel === 'low') score += 20;\n      else score += 10;\n    }\n\n    if (latestSleep) {\n      factors++;\n      const hours = Number(latestSleep.sleep_hours);\n      const quality = latestSleep.sleep_quality;\n      if (hours >= 7 && hours <= 9 && quality >= 7) score += 25;\n      else if (hours >= 6 && quality >= 5) score += 15;\n      else score += 5;\n    }\n\n    if (latestMotivation) {\n      factors++;\n      const avgMood = (latestMotivation.motivation_level + latestMotivation.energy_level + (10 - latestMotivation.stress_level)) / 3;\n      if (avgMood >= 7) score += 25;\n      else if (avgMood >= 5) score += 15;\n      else score += 5;\n    }\n\n    if (latestWeight && weightRecords.length >= 2) {\n      factors++;\n      const trend = getWeightTrend();\n      if (trend && Math.abs(trend.value) < 0.5) score += 25;\n      else if (trend && Math.abs(trend.value) < 1) score += 15;\n      else score += 10;\n    }\n\n    if (factors === 0) return 0;\n    return Math.round(score / factors * 4);\n  };\n\n  const healthScore = getHealthScore();\n  const weightTrend = getWeightTrend();\n  const sleepAvg = getSleepAverage();\n\n  const getCurrentCyclePhase = () => {\n    if (!menstrualCycles || menstrualCycles.length === 0) return null;\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    for (const cycle of menstrualCycles) {\n      const startDate = new Date(cycle.cycle_start_date);\n      startDate.setHours(0, 0, 0, 0);\n\n      const endDate = cycle.cycle_end_date ? new Date(cycle.cycle_end_date) : null;\n      if (endDate) {\n        endDate.setHours(0, 0, 0, 0);\n      }\n\n      if (today >= startDate && (!endDate || today <= endDate)) {\n        const daysSinceStart = Math.floor((today.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));\n\n        if (cycle.period_duration_days && daysSinceStart < cycle.period_duration_days) {\n          return { phase: 'menstrual', cycle, daysSinceStart };\n        }\n\n        if (cycle.cycle_length_days) {\n          const follicularEnd = Math.floor(cycle.cycle_length_days / 2);\n          if (daysSinceStart < follicularEnd) {\n            return { phase: 'follicular', cycle, daysSinceStart };\n          }\n          const lutealStart = follicularEnd + 2;\n          if (daysSinceStart < lutealStart) {\n            return { phase: 'ovulatory', cycle, daysSinceStart };\n          }\n          if (daysSinceStart < cycle.cycle_length_days) {\n            return { phase: 'luteal', cycle, daysSinceStart };\n          }\n        }\n      }\n    }\n    return null;\n  };\n\n  const getPredictedNextPeriod = () => {\n    if (!menstrualCycles || menstrualCycles.length === 0) return null;\n\n    const sortedCycles = [...menstrualCycles].sort((a, b) =>\n      new Date(b.cycle_start_date).getTime() - new Date(a.cycle_start_date).getTime()\n    );\n\n    const latestCycle = sortedCycles[0];\n    if (!latestCycle.cycle_length_days) return null;\n\n    const lastStart = new Date(latestCycle.cycle_start_date);\n    const predictedDate = new Date(lastStart);\n    predictedDate.setDate(predictedDate.getDate() + latestCycle.cycle_length_days);\n\n    return predictedDate;\n  };\n\n  const getPhaseDisplayName = (phase: string) => {\n    switch (phase) {\n      case 'menstrual': return '';\n      case 'follicular': return '';\n      case 'ovulatory': return '';\n      case 'luteal': return '';\n      default: return '';\n    }\n  };\n\n  const getPhaseColor = (phase: string) => {\n    switch (phase) {\n      case 'menstrual': return 'text-red-600 dark:text-red-400';\n      case 'follicular': return 'text-green-600 dark:text-green-400';\n      case 'ovulatory': return 'text-yellow-600 dark:text-yellow-400';\n      case 'luteal': return 'text-blue-600 dark:text-blue-400';\n      default: return 'text-gray-600 dark:text-gray-400';\n    }\n  };\n\n  const getPhaseBg = (phase: string) => {\n    switch (phase) {\n      case 'menstrual': return 'bg-red-100 dark:bg-red-900/30';\n      case 'follicular': return 'bg-green-100 dark:bg-green-900/30';\n      case 'ovulatory': return 'bg-yellow-100 dark:bg-yellow-900/30';\n      case 'luteal': return 'bg-blue-100 dark:bg-blue-900/30';\n      default: return 'bg-gray-100 dark:bg-gray-700';\n    }\n  };\n\n  const getPhaseAdvice = (phase: string) => {\n    switch (phase) {\n      case 'menstrual': return '';\n      case 'follicular': return '';\n      case 'ovulatory': return '';\n      case 'luteal': return '';\n      default: return '';\n    }\n  };\n\n  const currentPhase = getCurrentCyclePhase();\n  const predictedNextPeriod = getPredictedNextPeriod();\n  const showCycleCard = userGender === 'female';\n\n\n//  [0] \nconst sortedWeightsDesc = useMemo(() => {\n  return [...(weightRecords ?? [])].sort(\n    (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n}, [weightRecords]);\n\n// 3030\nconst diff30 = useMemo(() => {\n  const latest = sortedWeightsDesc[0];\n  if (!latest?.date || latest.weight_kg == null) return null;\n\n  const latestDate = new Date(latest.date);\n  const targetDate = new Date(latestDate);\n  targetDate.setDate(targetDate.getDate() - 30);\n\n  const past30 = sortedWeightsDesc.find(\n    (r) => r?.date && new Date(r.date) <= targetDate && r.weight_kg != null\n  );\n\n  if (!past30) return null;\n\n  return Number(latest.weight_kg) - Number(past30.weight_kg);\n}, [sortedWeightsDesc]);\n\n  React.useEffect(() => {\n    if (!import.meta.env.DEV) return;\n    console.log(\"[ConsolidatedOverview]\", {\n      gender: userGender,\n      showCycleCard,\n      cyclesLen: menstrualCycles?.length ?? 0,\n    });\n  }, [userGender, showCycleCard, menstrualCycles?.length]);\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 rounded-2xl shadow-lg p-6 text-white\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h2 className=\"text-2xl font-bold mb-1\"></h2>\n            <p className=\"text-blue-100 text-sm\"></p>\n          </div>\n          <div className=\"bg-white/20 rounded-full px-6 py-3\">\n            <div className=\"text-4xl font-bold\">{healthScore}</div>\n            <div className=\"text-xs text-center text-blue-100\">/ 100</div>\n          </div>\n        </div>\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4\">\n          <div className=\"bg-white/10 rounded-lg p-3\">\n            <Activity className=\"w-5 h-5 mb-1\" />\n            <div className=\"text-xs text-blue-100\">ACWR</div>\n            <div className=\"text-lg font-bold\">\n              {typeof latestACWR?.acwr === 'number' ? latestACWR.acwr.toFixed(2) : '-'}\n            </div>\n          </div>\n          <div className=\"bg-white/10 rounded-lg p-3\">\n            <Scale className=\"w-5 h-5 mb-1\" />\n            <div className=\"text-xs text-blue-100\"></div>\n            <div className=\"text-lg font-bold\">{latestWeight ? `${Number(latestWeight.weight_kg).toFixed(1)}kg` : '-'}</div>\n          </div>\n          <div className=\"bg-white/10 rounded-lg p-3\">\n            <Heart className=\"w-5 h-5 mb-1\" />\n            <div className=\"text-xs text-blue-100\"></div>\n            <div className=\"text-lg font-bold\">{latestSleep ? `${Number(latestSleep.sleep_hours).toFixed(1)}h` : '-'}</div>\n          </div>\n          <div className=\"bg-white/10 rounded-lg p-3\">\n            <Heart className=\"w-5 h-5 mb-1\" />\n            <div className=\"text-xs text-blue-100\"></div>\n            <div className=\"text-lg font-bold\">{latestMotivation ? `${latestMotivation.motivation_level}/10` : '-'}</div>\n          </div>\n        </div>\n      </div>\n\n      <div className={`grid grid-cols-1 gap-6 ${showCycleCard ? 'md:grid-cols-2 lg:grid-cols-4' : 'md:grid-cols-3'}`}>\n        <div\n          onClick={() => onOpenDetailView('training')}\n          className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]\"\n        >\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className={`p-3 rounded-lg ${latestACWR ? getRiskBg(latestACWR.riskLevel) : 'bg-gray-100 dark:bg-gray-700'}`}>\n                <Activity className={`w-6 h-6 ${latestACWR ? getRiskColor(latestACWR.riskLevel) : 'text-gray-400'}`} />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 dark:text-white\"></h3>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Training Load</p>\n              </div>\n            </div>\n            <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n          </div>\n\n          {latestACWR ? (\n            <>\n              <div className=\"mb-4\">\n                <div className=\"flex items-baseline space-x-2\">\n                <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-300\">\n                  {typeof latestACWR?.acwr === 'number' ? latestACWR.acwr.toFixed(2) : ''}\n                </div>\n                  <span className=\"text-sm text-gray-500 dark:text-gray-400\">ACWR</span>\n                </div>\n                <div className=\"flex items-center space-x-2 mt-1\">\n                  {latestACWR.riskLevel === 'high' && <AlertTriangle className=\"w-4 h-4 text-red-600\" />}\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n                    {latestACWR.riskLevel === 'good' && ''}\n                    {latestACWR.riskLevel === 'caution' && ''}\n                    {latestACWR.riskLevel === 'high' && ''}\n                    {latestACWR.riskLevel === 'low' && ''}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\"></p>\n                  <p className=\"text-lg font-bold text-gray-900 dark:text-white\">{latestACWR.acuteLoad}</p>\n                </div>\n                <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\"></p>\n                  <p className=\"text-lg font-bold text-gray-900 dark:text-white\">{latestACWR.chronicLoad}</p>\n                </div>\n              </div>\n\n              {latestTraining && (\n                <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\n                  <div className=\"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400\">\n                    <span></span>\n                    <span>{new Date(latestTraining.date).toLocaleDateString('ja-JP')}</span>\n                  </div>\n                </div>\n              )}\n            </>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Activity className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2\" />\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\"></p>\n            </div>\n          )}\n        </div>\n\n        <div\n          onClick={() => onOpenDetailView('weight')}\n          className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]\"\n        >\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg\">\n                <Scale className=\"w-6 h-6 text-green-600 dark:text-green-400\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 dark:text-white\"></h3>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Weight Tracking</p>\n              </div>\n            </div>\n            <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n          </div>\n\n          {latestWeight ? (\n            <>\n              <div className=\"mb-4\">\n                <div className=\"flex items-baseline space-x-2\">\n                  <span className=\"text-3xl font-bold text-green-600 dark:text-green-400\">\n                    {Number(latestWeight.weight_kg).toFixed(1)}\n                  </span>\n                  <span className=\"text-sm text-gray-500 dark:text-gray-400\">kg</span>\n                </div>\n                {weightTrend && (\n                  <div className=\"flex items-center space-x-1 mt-1\">\n                    {weightTrend.isUp ? (\n                      <TrendingUp className=\"w-4 h-4 text-red-500\" />\n                    ) : (\n                      <TrendingDown className=\"w-4 h-4 text-blue-500\" />\n                    )}\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n                       {weightTrend.isUp ? '+' : ''}{weightTrend.value.toFixed(1)}kg\n                    </p>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 mb-3\">\n                <p className=\"text-xs text-green-700 dark:text-green-400 mb-1\">30</p>\n                <p className=\"text-lg font-bold text-green-800 dark:text-green-300\">\n                  {diff30 !== null ? `${diff30.toFixed(1)}kg` : '-'}\n                </p>\n              </div>\n\n              <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\n                <div className=\"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400\">\n                  <span></span>\n                  <span>{new Date(latestWeight.date).toLocaleDateString('ja-JP')}</span>\n                </div>\n              </div>\n            </>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Scale className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2\" />\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\"></p>\n            </div>\n          )}\n        </div>\n\n        <div\n          onClick={() => onOpenDetailView('conditioning')}\n          className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]\"\n        >\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg\">\n                <Heart className=\"w-6 h-6 text-purple-600 dark:text-purple-400\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 dark:text-white\"></h3>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Sleep & Wellness</p>\n              </div>\n            </div>\n            <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n          </div>\n\n          {latestSleep && latestMotivation ? (\n            <>\n              <div className=\"space-y-3 mb-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\"></span>\n                  <span className=\"text-lg font-bold text-purple-600 dark:text-purple-400\">\n                    {Number(latestSleep.sleep_hours).toFixed(1)}h\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\"></span>\n                  <span className=\"text-lg font-bold text-purple-600 dark:text-purple-400\">\n                    {latestSleep.sleep_quality}/10\n                  </span>\n                </div>\n              </div>\n\n              <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mb-3\">\n                <div className=\"grid grid-cols-3 gap-2 text-center\">\n                  <div>\n                    <p className=\"text-xs text-purple-700 dark:text-purple-400 mb-1\"></p>\n                    <p className=\"font-bold text-purple-900 dark:text-purple-300\">{latestMotivation.motivation_level}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs text-purple-700 dark:text-purple-400 mb-1\"></p>\n                    <p className=\"font-bold text-purple-900 dark:text-purple-300\">{latestMotivation.energy_level}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs text-purple-700 dark:text-purple-400 mb-1\"></p>\n                    <p className=\"font-bold text-purple-900 dark:text-purple-300\">{latestMotivation.stress_level}</p>\n                  </div>\n                </div>\n              </div>\n\n              {sleepAvg && (\n                <div className=\"text-xs text-gray-600 dark:text-gray-400\">\n                  : {sleepAvg.toFixed(1)}\n                </div>\n              )}\n\n              <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\n                <div className=\"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400\">\n                  <span></span>\n                  <span>{new Date(latestSleep.date).toLocaleDateString('ja-JP')}</span>\n                </div>\n              </div>\n            </>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Heart className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2\" />\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\"></p>\n            </div>\n          )}\n        </div>\n\n        {showCycleCard && (\n          <div\n            onClick={() => onOpenDetailView('cycle')}\n            className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 cursor-pointer hover:shadow-md transition-all hover:scale-[1.02]\"\n          >\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className={`${currentPhase ? getPhaseBg(currentPhase.phase) : 'bg-pink-100 dark:bg-pink-900/30'} p-3 rounded-lg`}>\n                  <Droplets className={`w-6 h-6 ${currentPhase ? getPhaseColor(currentPhase.phase) : 'text-pink-600 dark:text-pink-400'}`} />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900 dark:text-white\"></h3>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Menstrual Cycle</p>\n                </div>\n              </div>\n              <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n            </div>\n\n            {currentPhase ? (\n              <>\n                <div className=\"mb-4\">\n                  <div className=\"flex items-baseline space-x-2\">\n                    <span className={`text-2xl font-bold ${getPhaseColor(currentPhase.phase)}`}>\n                      {getPhaseDisplayName(currentPhase.phase)}\n                    </span>\n                  </div>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\n                    {currentPhase.daysSinceStart + 1}\n                  </p>\n                </div>\n\n                <div className={`${getPhaseBg(currentPhase.phase)} rounded-lg p-3 mb-3`}>\n                  <p className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                    \n                  </p>\n                  <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n                    {getPhaseAdvice(currentPhase.phase)}\n                  </p>\n                </div>\n\n                {predictedNextPeriod && (\n                  <div className=\"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3\">\n                    <p className=\"text-xs text-pink-700 dark:text-pink-400 mb-1\"></p>\n                    <p className=\"text-lg font-bold text-pink-800 dark:text-pink-300\">\n                      {predictedNextPeriod.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })}\n                    </p>\n                    <p className=\"text-xs text-pink-600 dark:text-pink-400 mt-1\">\n                      {Math.ceil((predictedNextPeriod.getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24))}\n                    </p>\n                  </div>\n                )}\n              </>\n            ) : (\n              <div className=\"text-center py-8\">\n                <Droplets className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2\" />\n                <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-2\"></p>\n                <p className=\"text-xs text-gray-400 dark:text-gray-500\"></p>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      <button\n        onClick={onQuickAdd}\n        className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl p-4 flex items-center justify-center space-x-2 font-medium transition-colors shadow-lg\"\n      >\n        <Plus className=\"w-5 h-5\" />\n        <span></span>\n      </button>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { Activity, Scale, Moon, Heart, Zap } from 'lucide-react';\nimport { ACWRData } from '../lib/acwr';\nimport { formatDateJST } from '../lib/date';\n\ninterface MultiMetricTimelineProps {\n  acwrData: ACWRData[];\n  weightRecords: Array<{ weight_kg: number; date: string }>;\n  sleepRecords: Array<{ sleep_hours: number; sleep_quality: number; date: string }>;\n  motivationRecords: Array<{ motivation_level: number; energy_level: number; stress_level: number; date: string }>;\n}\n\nexport function MultiMetricTimeline({\n  acwrData,\n  weightRecords,\n  sleepRecords,\n  motivationRecords\n}: MultiMetricTimelineProps) {\n  const [visibleMetrics, setVisibleMetrics] = useState({\n    acwr: true,\n    weight: true,\n    sleep: true,\n    motivation: true,\n    energy: false\n  });\n\n  const [timeRange, setTimeRange] = useState<'7d' | '30d' | '90d'>('30d');\n\n  const getDaysAgo = (days: number): string => {\n    const now = new Date();\n    \n    // JST \n    const jstTime = now.getTime() + 9 * 60 * 60 * 1000;\n    const jst = new Date(jstTime);\n  \n    // JST  days \n    jst.setUTCDate(jst.getUTCDate() - days);\n  \n    return formatDateJST(jst);\n  };\n\n  const filterByTimeRange = (dateString: string) => {\n    const days = timeRange === '7d' ? 7 : timeRange === '30d' ? 30 : 90;\n    return dateString >= getDaysAgo(days);\n  };\n\n  const mergeDataByDate = () => {\n    const dataMap = new Map<string, any>();\n\n    acwrData.filter(d => filterByTimeRange(d.date)).forEach(item => {\n      if (!dataMap.has(item.date)) {\n        dataMap.set(item.date, { date: item.date });\n      }\n      dataMap.get(item.date)!.acwr = item.acwr;\n      dataMap.get(item.date)!.acuteLoad = item.acuteLoad;\n    });\n\n    weightRecords.filter(d => filterByTimeRange(d.date)).forEach(item => {\n      if (!dataMap.has(item.date)) {\n        dataMap.set(item.date, { date: item.date });\n      }\n      dataMap.get(item.date)!.weight = Number(item.weight_kg);\n    });\n\n    sleepRecords.filter(d => filterByTimeRange(d.date)).forEach(item => {\n      if (!dataMap.has(item.date)) {\n        dataMap.set(item.date, { date: item.date });\n      }\n      dataMap.get(item.date)!.sleep = Number(item.sleep_hours);\n      dataMap.get(item.date)!.sleepQuality = item.sleep_quality;\n    });\n\n    motivationRecords.filter(d => filterByTimeRange(d.date)).forEach(item => {\n      if (!dataMap.has(item.date)) {\n        dataMap.set(item.date, { date: item.date });\n      }\n      dataMap.get(item.date)!.motivation = item.motivation_level;\n      dataMap.get(item.date)!.energy = item.energy_level;\n      dataMap.get(item.date)!.stress = item.stress_level;\n    });\n\n    return Array.from(dataMap.values()).sort((a, b) => a.date.localeCompare(b.date));\n  };\n\n  const chartData = mergeDataByDate();\n\n  const toggleMetric = (metric: keyof typeof visibleMetrics) => {\n    setVisibleMetrics(prev => ({ ...prev, [metric]: !prev[metric] }));\n  };\n\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (!active || !payload || !payload.length) return null;\n\n    return (\n      <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4\">\n        <p className=\"font-semibold text-gray-900 dark:text-white mb-2\">\n          {new Date(label).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })}\n        </p>\n        <div className=\"space-y-1\">\n          {payload.map((entry: any) => (\n            <div key={entry.dataKey} className=\"flex items-center justify-between space-x-4\">\n              <span className=\"text-sm\" style={{ color: entry.color }}>\n                {entry.name}:\n              </span>\n              <span className=\"font-semibold text-sm\" style={{ color: entry.color }}>\n                {entry.value !== undefined ? entry.value.toFixed(1) : '-'}\n                {entry.dataKey === 'weight' && 'kg'}\n                {(entry.dataKey === 'sleep' || entry.dataKey === 'sleepHours') && 'h'}\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 space-y-4 sm:space-y-0\">\n        <div>\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-1\">\n            \n          </h3>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            \n          </p>\n        </div>\n\n        <div className=\"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1\">\n          <button\n            onClick={() => setTimeRange('7d')}\n            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\n              timeRange === '7d'\n                ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm'\n                : 'text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white'\n            }`}\n          >\n            7\n          </button>\n          <button\n            onClick={() => setTimeRange('30d')}\n            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\n              timeRange === '30d'\n                ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm'\n                : 'text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white'\n            }`}\n          >\n            30\n          </button>\n          <button\n            onClick={() => setTimeRange('90d')}\n            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\n              timeRange === '90d'\n                ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm'\n                : 'text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white'\n            }`}\n          >\n            90\n          </button>\n        </div>\n      </div>\n\n      <div className=\"flex flex-wrap gap-3 mb-6\">\n        <button\n          onClick={() => toggleMetric('acwr')}\n          className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n            visibleMetrics.acwr\n              ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-2 border-blue-500'\n              : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent'\n          }`}\n        >\n          <Activity className=\"w-4 h-4\" />\n          <span>ACWR</span>\n        </button>\n\n        <button\n          onClick={() => toggleMetric('weight')}\n          className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n            visibleMetrics.weight\n              ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-2 border-green-500'\n              : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent'\n          }`}\n        >\n          <Scale className=\"w-4 h-4\" />\n          <span></span>\n        </button>\n\n        <button\n          onClick={() => toggleMetric('sleep')}\n          className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n            visibleMetrics.sleep\n              ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 border-2 border-purple-500'\n              : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent'\n          }`}\n        >\n          <Moon className=\"w-4 h-4\" />\n          <span></span>\n        </button>\n\n        <button\n          onClick={() => toggleMetric('motivation')}\n          className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n            visibleMetrics.motivation\n              ? 'bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-400 border-2 border-pink-500'\n              : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent'\n          }`}\n        >\n          <Heart className=\"w-4 h-4\" />\n          <span></span>\n        </button>\n\n        <button\n          onClick={() => toggleMetric('energy')}\n          className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n            visibleMetrics.energy\n              ? 'bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 border-2 border-orange-500'\n              : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 border-2 border-transparent'\n          }`}\n        >\n          <Zap className=\"w-4 h-4\" />\n          <span></span>\n        </button>\n      </div>\n\n      {chartData.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center py-16 text-gray-500 dark:text-gray-400\">\n          <Activity className=\"w-16 h-16 mb-4 opacity-20\" />\n          <p></p>\n        </div>\n      ) : (\n        <ResponsiveContainer width=\"100%\" height={400}>\n          <LineChart data={chartData}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" opacity={0.1} />\n            <XAxis\n              dataKey=\"date\"\n              tickFormatter={(date) => {\n                const d = new Date(date);\n                return `${d.getMonth() + 1}/${d.getDate()}`;\n              }}\n              stroke=\"#9CA3AF\"\n              style={{ fontSize: '12px' }}\n            />\n            <YAxis stroke=\"#9CA3AF\" style={{ fontSize: '12px' }} />\n            <Tooltip content={<CustomTooltip />} />\n            <Legend\n              wrapperStyle={{ fontSize: '12px' }}\n              iconType=\"line\"\n            />\n\n            {visibleMetrics.acwr && (\n              <Line\n                type=\"monotone\"\n                dataKey=\"acwr\"\n                name=\"ACWR\"\n                stroke=\"#3B82F6\"\n                strokeWidth={2}\n                dot={{ r: 4 }}\n                activeDot={{ r: 6 }}\n              />\n            )}\n\n            {visibleMetrics.weight && (\n              <Line\n                type=\"monotone\"\n                dataKey=\"weight\"\n                name=\" (kg)\"\n                stroke=\"#10B981\"\n                strokeWidth={2}\n                dot={{ r: 4 }}\n                activeDot={{ r: 6 }}\n              />\n            )}\n\n            {visibleMetrics.sleep && (\n              <Line\n                type=\"monotone\"\n                dataKey=\"sleep\"\n                name=\" (h)\"\n                stroke=\"#8B5CF6\"\n                strokeWidth={2}\n                dot={{ r: 4 }}\n                activeDot={{ r: 6 }}\n              />\n            )}\n\n            {visibleMetrics.motivation && (\n              <Line\n                type=\"monotone\"\n                dataKey=\"motivation\"\n                name=\"\"\n                stroke=\"#EC4899\"\n                strokeWidth={2}\n                dot={{ r: 4 }}\n                activeDot={{ r: 6 }}\n              />\n            )}\n\n            {visibleMetrics.energy && (\n              <Line\n                type=\"monotone\"\n                dataKey=\"energy\"\n                name=\"\"\n                stroke=\"#F59E0B\"\n                strokeWidth={2}\n                dot={{ r: 4 }}\n                activeDot={{ r: 6 }}\n              />\n            )}\n          </LineChart>\n        </ResponsiveContainer>\n      )}\n\n      <div className=\"mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4\">\n        <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3\">\n          <p className=\"text-xs text-blue-700 dark:text-blue-400 mb-1\"></p>\n          <p className=\"text-2xl font-bold text-blue-900 dark:text-blue-300\">{chartData.length}</p>\n          <p className=\"text-xs text-blue-600 dark:text-blue-400\"></p>\n        </div>\n\n        <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-3\">\n          <p className=\"text-xs text-green-700 dark:text-green-400 mb-1\">ACWR</p>\n          <p className=\"text-2xl font-bold text-green-900 dark:text-green-300\">\n            {chartData.filter(d => d.acwr).length > 0\n              ? (chartData.reduce((sum, d) => sum + (d.acwr || 0), 0) / chartData.filter(d => d.acwr).length).toFixed(2)\n              : '-'}\n          </p>\n        </div>\n\n        <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3\">\n          <p className=\"text-xs text-purple-700 dark:text-purple-400 mb-1\"></p>\n          <p className=\"text-2xl font-bold text-purple-900 dark:text-purple-300\">\n            {chartData.filter(d => d.sleep).length > 0\n              ? (chartData.reduce((sum, d) => sum + (d.sleep || 0), 0) / chartData.filter(d => d.sleep).length).toFixed(1)\n              : '-'}\n          </p>\n          <p className=\"text-xs text-purple-600 dark:text-purple-400\"></p>\n        </div>\n\n        <div className=\"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3\">\n          <p className=\"text-xs text-pink-700 dark:text-pink-400 mb-1\"></p>\n          <p className=\"text-2xl font-bold text-pink-900 dark:text-pink-300\">\n            {chartData.filter(d => d.motivation).length > 0\n              ? (chartData.reduce((sum, d) => sum + (d.motivation || 0), 0) / chartData.filter(d => d.motivation).length).toFixed(1)\n              : '-'}\n          </p>\n          <p className=\"text-xs text-pink-600 dark:text-pink-400\">/10</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { Plus, Camera } from \"lucide-react\";\nimport { stopAllMediaStreams } from \"../lib/stopCamera\";\n\ntype Props = {\n  onClick: () => void;          // \n  onCameraClick?: () => void;   // \n};\n\nexport function FloatingActionButton({ onClick, onCameraClick }: Props) {\n  return (\n    <div className=\"fixed bottom-6 right-6 z-50 flex items-center gap-3\">\n      {/* ON */}\n      {onCameraClick && (\n        <button\n          type=\"button\"\n          onClick={onCameraClick}\n          className=\"h-14 w-14 rounded-full shadow-lg\n                     bg-blue-600 text-white\n                     flex items-center justify-center\n                     active:scale-95 transition\"\n          aria-label=\"\"\n        >\n          <Camera className=\"w-6 h-6\" />\n        </button>\n      )}\n\n      {/*  */}\n      <button\n        type=\"button\"\n        onClick={onClick}\n        className=\"h-14 w-14 rounded-full shadow-lg\n                   bg-blue-600 text-white\n                   flex items-center justify-center\n                   active:scale-95 transition\"\n        aria-label=\"\"\n      >\n        <Plus className=\"w-7 h-7\" />\n      </button>\n    </div>\n  );\n}","import React, { useEffect, useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { CheckCircle, Plus, Trash2 } from 'lucide-react';\n\ntype ActionItem = {\n  text: string;\n  done: boolean;\n  done_at: string | null;\n};\n\ntype ReflectionRow = {\n  id: string;\n  user_id: string;\n  reflection_date: string; // 'YYYY-MM-DD'\n  did: string | null;\n  didnt: string | null;\n  cause_tags: string[] | null;\n  next_action: string | null;\n  next_action_items: ActionItem[] | null; // jsonb\n  free_note: string | null;\n  metadata: any;\n  created_at: string;\n  updated_at: string;\n};\n\ntype DailyReflectionCardProps = {\n  userId: string;\n};\n\nfunction getTodayJSTString() {\n  const now = new Date();\n  const jst = new Date(now.getTime() + 9 * 60 * 60 * 1000);\n  return jst.toISOString().slice(0, 10);\n}\n\nfunction getYesterdayJSTString() {\n  const now = new Date();\n  const jst = new Date(now.getTime() + 9 * 60 * 60 * 1000);\n  jst.setDate(jst.getDate() - 1);\n  return jst.toISOString().slice(0, 10);\n}\n\n/**\n * weekOffset:\n *  0 = \n * -1 = \n * -2 =  ...\n */\nfunction getStartOfWeekJSTString(weekOffset = 0) {\n  const now = new Date();\n  const jst = new Date(now.getTime() + 9 * 60 * 60 * 1000);\n  const day = jst.getDay(); // 0=Sun\n  const diffToMonday = (day + 6) % 7; // Mon=0\n  jst.setDate(jst.getDate() - diffToMonday + weekOffset * 7);\n  jst.setHours(0, 0, 0, 0);\n  return jst.toISOString().slice(0, 10);\n}\n\nfunction addDays(dateStr: string, days: number) {\n  const d = new Date(dateStr + 'T00:00:00.000Z');\n  d.setUTCDate(d.getUTCDate() + days);\n  return d.toISOString().slice(0, 10);\n}\n\nfunction normalizeActionItems(row?: ReflectionRow | null): ActionItem[] {\n  if (!row) return [];\n  const items = row.next_action_items ?? [];\n  if (Array.isArray(items) && items.length > 0) return items;\n\n  //  next_action 1\n  if (row.next_action && row.next_action.trim()) {\n    return [{ text: row.next_action.trim(), done: false, done_at: null }];\n  }\n  return [];\n}\n\nconst CAUSE_TAG_OPTIONS = [\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n];\n\nexport function DailyReflectionCard({ userId }: DailyReflectionCardProps) {\n  const today = useMemo(() => getTodayJSTString(), []);\n  const yesterday = useMemo(() => getYesterdayJSTString(), []);\n\n  //  \n  const [weekOffset, setWeekOffset] = useState(0);\n  const selectedWeekStart = useMemo(\n    () => getStartOfWeekJSTString(weekOffset),\n    [weekOffset]\n  );\n  const selectedWeekEnd = useMemo(\n    () => addDays(selectedWeekStart, 6),\n    [selectedWeekStart]\n  );\n\n  const [loading, setLoading] = useState(true);\n\n  //  reflection\n  const [todayRow, setTodayRow] = useState<ReflectionRow | null>(null);\n\n  //  reflection\n  const [yesterdayRow, setYesterdayRow] = useState<ReflectionRow | null>(null);\n\n  //  reflection\n  const [weekRows, setWeekRows] = useState<ReflectionRow[]>([]);\n  const [weekLoading, setWeekLoading] = useState(false);\n\n  // \n  const [todayTodo, setTodayTodo] = useState<ActionItem[]>([]);\n\n  // \n  const [tomorrowActions, setTomorrowActions] = useState<ActionItem[]>([\n    { text: '', done: false, done_at: null },\n  ]);\n\n  const [did, setDid] = useState('');\n  const [didnt, setDidnt] = useState('');\n  const [causeTags, setCauseTags] = useState<string[]>([]);\n  const [freeNote, setFreeNote] = useState('');\n\n  const [savingTodo, setSavingTodo] = useState(false);\n  const [savingReflection, setSavingReflection] = useState(false);\n\n  //  \n  useEffect(() => {\n    if (!userId) return;\n\n    const loadDaily = async () => {\n      setLoading(true);\n      try {\n        const { data, error } = await supabase\n          .from('reflections')\n          .select('*')\n          .eq('user_id', userId)\n          .in('reflection_date', [today, yesterday]);\n\n        if (error) throw error;\n\n        const t = (data || []).find((r: any) => r.reflection_date === today) ?? null;\n        const y = (data || []).find((r: any) => r.reflection_date === yesterday) ?? null;\n\n        setTodayRow(t as ReflectionRow | null);\n        setYesterdayRow(y as ReflectionRow | null);\n\n        //  next_action_items\n        const todo = normalizeActionItems(y as ReflectionRow | null);\n        setTodayTodo(todo);\n\n        // \n        if (t) {\n          setDid((t as any).did ?? '');\n          setDidnt((t as any).didnt ?? '');\n          setCauseTags((t as any).cause_tags ?? []);\n          setFreeNote((t as any).free_note ?? '');\n\n          const items = normalizeActionItems(t as ReflectionRow);\n          setTomorrowActions(items.length ? items : [{ text: '', done: false, done_at: null }]);\n        } else {\n          setTomorrowActions([{ text: '', done: false, done_at: null }]);\n        }\n      } catch (e) {\n        console.error('Failed to load reflections (daily):', e);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadDaily();\n  }, [userId, today, yesterday]);\n\n  //  \n  useEffect(() => {\n    if (!userId) return;\n\n    const loadWeek = async () => {\n      setWeekLoading(true);\n      try {\n        const weekEndExclusive = addDays(selectedWeekStart, 7);\n\n        const { data, error } = await supabase\n          .from('reflections')\n          .select('id, user_id, reflection_date, did, didnt, cause_tags, next_action_items')\n          .eq('user_id', userId)\n          .gte('reflection_date', selectedWeekStart)\n          .lt('reflection_date', weekEndExclusive)\n          .order('reflection_date', { ascending: true });\n\n        if (error) throw error;\n        setWeekRows((data || []) as any);\n      } catch (e) {\n        console.error('Failed to load reflections (week):', e);\n      } finally {\n        setWeekLoading(false);\n      }\n    };\n\n    loadWeek();\n  }, [userId, selectedWeekStart]);\n\n  //   + \n  const weeklySummary = useMemo(() => {\n    const didCount = weekRows.filter((r) => (r.did ?? '').trim().length > 0).length;\n    const didntCount = weekRows.filter((r) => (r.didnt ?? '').trim().length > 0).length;\n\n    const tagCount: Record<string, number> = {};\n    weekRows.forEach((r) => {\n      (r.cause_tags ?? []).forEach((t) => {\n        const key = (t ?? '').trim();\n        if (!key) return;\n        tagCount[key] = (tagCount[key] ?? 0) + 1;\n      });\n    });\n    const topTags = Object.entries(tagCount)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 3);\n\n    let goals = 0;\n    let done = 0;\n\n    const goalStats: Record<string, { total: number; done: number }> = {};\n\n    weekRows.forEach((r) => {\n      const items = r.next_action_items ?? [];\n      items.forEach((a) => {\n        const text = (a?.text ?? '').trim();\n        if (!text) return;\n\n        goals += 1;\n        if (a.done) done += 1;\n\n        goalStats[text] = goalStats[text] ?? { total: 0, done: 0 };\n        goalStats[text].total += 1;\n        if (a.done) goalStats[text].done += 1;\n      });\n    });\n\n    const completionRate = goals ? Math.round((done / goals) * 100) : 0;\n\n    const topGoals = Object.entries(goalStats)\n      .map(([text, s]) => ({\n        text,\n        total: s.total,\n        done: s.done,\n        rate: s.total ? Math.round((s.done / s.total) * 100) : 0,\n      }))\n      .sort((a, b) => b.total - a.total)\n      .slice(0, 3);\n\n    return {\n      didCount,\n      didntCount,\n      topTags,\n      goals,\n      done,\n      completionRate,\n      topGoals,\n      days: weekRows.length,\n    };\n  }, [weekRows]);\n\n  // \n  const toggleTodoDone = async (index: number) => {\n    if (!yesterdayRow) return;\n\n    const next = [...todayTodo];\n    const target = next[index];\n    if (!target) return;\n\n    const nowIso = new Date().toISOString();\n    const toggled: ActionItem = {\n      ...target,\n      done: !target.done,\n      done_at: !target.done ? nowIso : null,\n    };\n    next[index] = toggled;\n\n    setTodayTodo(next);\n\n    setSavingTodo(true);\n    try {\n      const { error } = await supabase\n        .from('reflections')\n        .update({\n          next_action_items: next,\n          next_action: next[0]?.text ?? null,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', yesterdayRow.id);\n\n      if (error) throw error;\n\n      setYesterdayRow((prev) =>\n        prev ? { ...prev, next_action_items: next, next_action: next[0]?.text ?? null } : prev\n      );\n\n      setWeekRows((prev) =>\n        prev.map((r) => (r.id === yesterdayRow.id ? ({ ...r, next_action_items: next } as any) : r))\n      );\n    } catch (e) {\n      console.error('Failed to save todo:', e);\n      setTodayTodo(normalizeActionItems(yesterdayRow));\n    } finally {\n      setSavingTodo(false);\n    }\n  };\n\n  const addTomorrowAction = () => {\n    setTomorrowActions((prev) => [...prev, { text: '', done: false, done_at: null }]);\n  };\n\n  const removeTomorrowAction = (i: number) => {\n    setTomorrowActions((prev) => {\n      const next = prev.filter((_, idx) => idx !== i);\n      return next.length ? next : [{ text: '', done: false, done_at: null }];\n    });\n  };\n\n  const updateTomorrowActionText = (i: number, text: string) => {\n    setTomorrowActions((prev) => {\n      const next = [...prev];\n      next[i] = { ...next[i], text };\n      return next;\n    });\n  };\n\n  const toggleCauseTag = (tag: string) => {\n    setCauseTags((prev) => (prev.includes(tag) ? prev.filter((t) => t !== tag) : [...prev, tag]));\n  };\n\n  // \n  const saveTodayReflection = async () => {\n    if (!userId) return;\n\n    setSavingReflection(true);\n    try {\n      const cleanedActions = tomorrowActions\n        .map((a) => ({ ...a, text: (a.text ?? '').trim() }))\n        .filter((a) => a.text.length > 0);\n\n      const payload = {\n        user_id: userId,\n        reflection_date: today,\n        did: did.trim(),\n        didnt: didnt.trim(),\n        cause_tags: causeTags,\n        free_note: freeNote.trim(),\n        next_action_items: cleanedActions,\n        next_action: cleanedActions[0]?.text ?? null,\n        metadata: { source: 'daily_reflection_card' },\n        updated_at: new Date().toISOString(),\n      };\n\n      if (todayRow?.id) {\n        const { error } = await supabase.from('reflections').update(payload).eq('id', todayRow.id);\n        if (error) throw error;\n\n        setTodayRow((prev) => (prev ? ({ ...prev, ...payload } as any) : prev));\n        setWeekRows((prev) =>\n          prev.map((r) => (r.id === todayRow.id ? ({ ...r, ...payload } as any) : r))\n        );\n      } else {\n        const { data, error } = await supabase\n          .from('reflections')\n          .insert(payload)\n          .select('*')\n          .single();\n\n        if (error) throw error;\n\n        setTodayRow(data as any);\n\n        if (today >= selectedWeekStart && today <= selectedWeekEnd) {\n          setWeekRows((prev) => {\n            const minimal: any = {\n              id: data.id,\n              user_id: data.user_id,\n              reflection_date: data.reflection_date,\n              did: data.did,\n              didnt: data.didnt,\n              cause_tags: data.cause_tags ?? payload.cause_tags,\n              next_action_items: data.next_action_items ?? payload.next_action_items,\n            };\n            const filtered = prev.filter((r) => r.id !== minimal.id);\n            return [...filtered, minimal].sort((a, b) =>\n              a.reflection_date.localeCompare(b.reflection_date)\n            );\n          });\n        }\n      }\n    } catch (e) {\n      console.error('Failed to save reflection:', e);\n    } finally {\n      setSavingReflection(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"rounded-xl p-6 shadow-sm bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100\">\n        ...\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"rounded-xl p-6 shadow-sm space-y-6 bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100\">\n      {/*   */}\n      <div\n        className=\"rounded-lg border p-4\n        border-amber-200 bg-amber-50 text-amber-950\n        dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-100\n      \"\n      >\n        <div className=\"flex items-start justify-between gap-3\">\n          <div>\n            <h3 className=\"font-semibold\"></h3>\n            <div className=\"text-xs mt-1 text-amber-800 dark:text-amber-200/80\">\n              {selectedWeekStart}  {selectedWeekEnd}{weeklySummary.days}\n              {weekLoading && <span className=\"ml-2\"></span>}\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <button\n              type=\"button\"\n              onClick={() => setWeekOffset((v) => v - 1)}\n              className=\"\n                text-xs px-3 py-1 rounded-lg border\n                border-amber-300 bg-white hover:bg-amber-100\n                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800\n              \"\n            >\n               \n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setWeekOffset(0)}\n              disabled={weekOffset === 0}\n              className=\"\n                text-xs px-3 py-1 rounded-lg border\n                border-amber-300 bg-white hover:bg-amber-100 disabled:opacity-50\n                dark:border-amber-900/60 dark:bg-gray-950 dark:hover:bg-gray-800\n              \"\n            >\n              \n            </button>\n          </div>\n        </div>\n\n        <div className=\"mt-3 text-sm\">\n          {weeklySummary.didCount}  {weeklySummary.didntCount}\n        </div>\n\n        <div className=\"mt-1 text-sm\">\n          {weeklySummary.goals}  {weeklySummary.done}{weeklySummary.completionRate}%\n        </div>\n\n        <div className=\"mt-3 space-y-2\">\n          <div className=\"text-xs font-semibold text-amber-800 dark:text-amber-200/80\">\n             TOP3\n          </div>\n          {weeklySummary.topTags.length === 0 ? (\n            <div className=\"text-sm text-amber-800 dark:text-amber-200/80\">\n              \n            </div>\n          ) : (\n            <div className=\"flex flex-wrap gap-2\">\n              {weeklySummary.topTags.map(([tag, count]) => (\n                <span\n                  key={tag}\n                  className=\"\n                    px-3 py-1 rounded-full text-xs border\n                    border-amber-200 bg-white text-amber-950\n                    dark:border-amber-900/60 dark:bg-gray-950 dark:text-amber-100\n                  \"\n                >\n                  {tag}{count}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {weeklySummary.topGoals.length > 0 && (\n          <div className=\"mt-4 space-y-2\">\n            <div className=\"text-xs font-semibold text-amber-800 dark:text-amber-200/80\">\n               TOP3\n            </div>\n            {weeklySummary.topGoals.map((g) => (\n              <div key={g.text} className=\"flex items-center justify-between gap-3\">\n                <div className=\"text-sm flex-1\">{g.text}</div>\n                <div className=\"text-xs text-amber-800 dark:text-amber-200/80 w-28 text-right\">\n                  {g.done}/{g.total}{g.rate}%\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/*   */}\n      <div\n        className=\"rounded-lg border p-4\n        border-blue-200 bg-blue-50 text-blue-950\n        dark:border-blue-900/40 dark:bg-blue-950/30 dark:text-blue-100\n      \"\n      >\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"font-semibold\"></h3>\n          <div className=\"text-xs text-blue-700 dark:text-blue-200/80\">{yesterday} </div>\n        </div>\n\n        {todayTodo.length === 0 ? (\n          <p className=\"text-sm text-blue-800 dark:text-blue-200/80 mt-2\">\n            \n          </p>\n        ) : (\n          <div className=\"mt-3 space-y-2\">\n            {todayTodo.map((item, idx) => (\n              <label\n                key={idx}\n                className=\"\n                  flex items-center gap-3 rounded-lg px-3 py-2 border\n                  bg-white border-blue-200\n                  dark:bg-gray-950 dark:border-blue-900/50\n                \"\n              >\n                <input\n                  type=\"checkbox\"\n                  checked={!!item.done}\n                  onChange={() => toggleTodoDone(idx)}\n                  disabled={savingTodo}\n                  className=\"h-4 w-4 accent-green-600\"\n                />\n                <div className=\"flex-1\">\n                  <div\n                    className={`text-sm ${\n                      item.done\n                        ? 'line-through text-gray-500 dark:text-gray-400'\n                        : 'text-gray-900 dark:text-gray-100'\n                    }`}\n                  >\n                    {item.text}\n                  </div>\n                  {item.done_at && (\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                      : {new Date(item.done_at).toLocaleString('ja-JP')}\n                    </div>\n                  )}\n                </div>\n                {item.done && <CheckCircle className=\"h-4 w-4 text-green-600\" />}\n              </label>\n            ))}\n\n            <div className=\"text-xs text-blue-700 dark:text-blue-200/80 mt-2\">\n              {savingTodo ? '' : ''}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* ---  --- */}\n      <div className=\"space-y-3\">\n        <h3 className=\"font-semibold\"></h3>\n\n        <div>\n          <label className=\"text-sm text-gray-700 dark:text-gray-300\"></label>\n          <input\n            value={did}\n            onChange={(e) => setDid(e.target.value)}\n            className=\"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            \"\n            placeholder=\"\"\n          />\n        </div>\n\n        <div>\n          <label className=\"text-sm text-gray-700 dark:text-gray-300\"></label>\n          <input\n            value={didnt}\n            onChange={(e) => setDidnt(e.target.value)}\n            className=\"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            \"\n            placeholder=\"\"\n          />\n        </div>\n\n        {/*   */}\n        <div>\n          <label className=\"text-sm text-gray-700 dark:text-gray-300\"></label>\n          <div className=\"mt-2 flex flex-wrap gap-2\">\n            {CAUSE_TAG_OPTIONS.map((tag) => {\n              const active = causeTags.includes(tag);\n              return (\n                <button\n                  key={tag}\n                  type=\"button\"\n                  onClick={() => toggleCauseTag(tag)}\n                  className={`\n                    px-3 py-1 rounded-full text-xs border transition\n                    ${active\n                      ? 'bg-gray-900 text-white border-gray-900'\n                      : 'bg-slate-100 text-slate-800 border-slate-200 hover:bg-slate-200'}\n                    dark:${active\n                      ? 'bg-green-600 text-white border-green-600'\n                      : 'bg-slate-700 text-slate-100 border-slate-600 hover:bg-slate-600'}\n                  `}\n                >\n                  {tag}\n                </button>\n              );\n            })}\n          </div>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n            OK\n          </p>\n        </div>\n\n        <div>\n          <label className=\"text-sm text-gray-700 dark:text-gray-300\"></label>\n          <textarea\n            value={freeNote}\n            onChange={(e) => setFreeNote(e.target.value)}\n            className=\"\n              w-full border rounded-lg px-3 py-2\n              bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n              focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n              dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n              dark:focus:ring-green-500 dark:focus:border-green-500\n            \"\n            rows={3}\n            placeholder=\"\"\n          />\n        </div>\n\n        {/*   */}\n        <div className=\"rounded-lg border p-4 border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900\">\n          <div className=\"flex items-center justify-between\">\n            <h4 className=\"font-semibold\"></h4>\n            <button\n              type=\"button\"\n              onClick={addTomorrowAction}\n              className=\"\n                text-sm px-3 py-1 rounded-lg flex items-center gap-2\n                bg-gray-900 text-white hover:bg-gray-800\n                dark:bg-green-600 dark:hover:bg-green-700\n              \"\n            >\n              <Plus className=\"h-4 w-4\" />\n              \n            </button>\n          </div>\n\n          <div className=\"mt-3 space-y-2\">\n            {tomorrowActions.map((a, i) => (\n              <div key={i} className=\"flex items-center gap-2\">\n                <input\n                  value={a.text}\n                  onChange={(e) => updateTomorrowActionText(i, e.target.value)}\n                  className=\"\n                    flex-1 border rounded-lg px-3 py-2\n                    bg-white text-gray-900 border-gray-300 placeholder:text-gray-400\n                    focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\n                    dark:bg-gray-950 dark:text-gray-100 dark:border-gray-700 dark:placeholder:text-gray-500\n                    dark:focus:ring-green-500 dark:focus:border-green-500\n                  \"\n                  placeholder=\"10\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => removeTomorrowAction(i)}\n                  className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\"\n                  title=\"\"\n                >\n                  <Trash2 className=\"h-4 w-4 text-gray-600 dark:text-gray-300\" />\n                </button>\n              </div>\n            ))}\n          </div>\n\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n            \n          </p>\n        </div>\n\n        <button\n          onClick={saveTodayReflection}\n          disabled={savingReflection}\n          className=\"\n            w-full rounded-lg px-4 py-3 font-medium\n            bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50\n            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\n            dark:focus:ring-offset-gray-900\n          \"\n        >\n          {savingReflection ? '' : ''}\n        </button>\n      </div>\n    </div>\n  );\n}","import React, { useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { Send, X, CheckCircle2, AlertTriangle } from 'lucide-react';\n\ntype Props = {\n  userId: string;\n  // \n  highlight?: boolean;\n};\n\nexport function ShareStatusButton({ userId, highlight }: Props) {\n  const [open, setOpen] = useState(false);\n  const [note, setNote] = useState('');\n  const [checked, setChecked] = useState(false);\n  const [sending, setSending] = useState(false);\n  const [done, setDone] = useState(false);\n\n  const canSend = useMemo(() => checked && !sending, [checked, sending]);\n\n  const resetAndClose = () => {\n    setOpen(false);\n    setDone(false);\n    setNote('');\n    setChecked(false);\n  };\n\n  const submit = async () => {\n    if (!canSend) return;\n\n    setSending(true);\n    try {\n      const { error } = await supabase.from('shared_reports').insert({\n        user_id: userId,\n        note: note.trim() ? note.trim() : null,\n      });\n\n      if (error) throw error;\n\n      setDone(true);\n      setTimeout(() => {\n        resetAndClose();\n      }, 900);\n    } catch (e) {\n      console.error('[ShareStatusButton] insert failed:', e);\n      alert('');\n    } finally {\n      setSending(false);\n    }\n  };\n\n  return (\n    <>\n      <button\n        type=\"button\"\n        onClick={() => setOpen(true)}\n        className={[\n          'w-full rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-colors',\n          'border',\n          highlight\n            ? 'bg-blue-600 text-white border-blue-600 hover:bg-blue-700 active:bg-blue-800'\n            : 'bg-white dark:bg-gray-900 text-gray-900 dark:text-white border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/60 active:bg-gray-100 dark:active:bg-gray-800',\n        ].join(' ')}\n      >\n        <Send className=\"w-4 h-4\" />\n        <span className=\"font-medium\"></span>\n      </button>\n\n      {open && (\n        <div className=\"fixed inset-0 z-50\">\n          {/* overlay */}\n          <div\n            className=\"absolute inset-0 bg-black/60\"\n            onClick={() => !sending && setOpen(false)}\n          />\n\n          {/* modal */}\n          <div className=\"absolute left-1/2 top-1/2 w-[92vw] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-2xl bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-2xl overflow-hidden\">\n            {/* header */}\n            <div className=\"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between\">\n              <div className=\"font-semibold text-gray-900 dark:text-white\"></div>\n              <button\n                type=\"button\"\n                onClick={() => !sending && setOpen(false)}\n                className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 active:bg-gray-200 dark:active:bg-white/15\"\n                aria-label=\"\"\n              >\n                <X className=\"w-5 h-5 text-gray-600 dark:text-gray-300\" />\n              </button>\n            </div>\n\n            <div className=\"p-4 space-y-4\">\n              {/* what will be shared */}\n              <div className=\"text-sm text-gray-700 dark:text-gray-200 space-y-1\">\n                <p></p>\n                <ul className=\"list-disc pl-5 space-y-1\">\n                  <li>sRPE / ACWR</li>\n                  <li></li>\n                  <li></li>\n                </ul>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  \n                </p>\n              </div>\n\n              {/* note */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-900 dark:text-white mb-2\">\n                  \n                </label>\n                <textarea\n                  value={note}\n                  onChange={(e) => setNote(e.target.value)}\n                  rows={3}\n                  className=\"w-full rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 text-gray-900 dark:text-white px-3 py-2 text-sm placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/60\"\n                  placeholder=\" \"\n                />\n              </div>\n\n              {/*  confirm row (tapable) */}\n              <button\n                type=\"button\"\n                onClick={() => setChecked((v) => !v)}\n                className={[\n                  'w-full text-left rounded-xl border px-3 py-3 transition',\n                  'flex items-start gap-3',\n                  checked\n                    ? 'border-blue-500/60 bg-blue-50 dark:bg-blue-500/10'\n                    : 'border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10',\n                ].join(' ')}\n                aria-pressed={checked}\n              >\n                <span\n                  className={[\n                    'mt-0.5 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 transition',\n                    checked\n                      ? 'bg-blue-600 border-blue-600'\n                      : 'bg-transparent border-gray-400/60 dark:border-gray-300/40',\n                  ].join(' ')}\n                >\n                  {checked && <CheckCircle2 className=\"w-4 h-4 text-white\" />}\n                </span>\n\n                <div className=\"min-w-0\">\n                  <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    {' '}\n                    <span className=\"text-xs text-amber-700 dark:text-amber-300\"></span>\n                  </div>\n                  {!checked && (\n                    <div className=\"text-xs text-gray-600 dark:text-gray-300 mt-1\">\n                      \n                    </div>\n                  )}\n                </div>\n              </button>\n\n              {/* disabled reason */}\n              {!checked && !done && (\n                <div className=\"flex items-start gap-2 text-xs text-amber-700 dark:text-amber-300\">\n                  <AlertTriangle className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n                  <div>ON</div>\n                </div>\n              )}\n\n              {/* submit */}\n              <button\n                type=\"button\"\n                onClick={submit}\n                disabled={!canSend}\n                className={[\n                  'w-full rounded-xl px-4 py-3 font-semibold transition-colors',\n                  canSend\n                    ? 'bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800'\n                    : 'bg-gray-200 text-gray-500 dark:bg-white/10 dark:text-white/40 cursor-not-allowed',\n                ].join(' ')}\n              >\n                {done ? '' : sending ? '...' : ''}\n              </button>\n\n              {done && (\n                <div className=\"text-center text-sm text-gray-700 dark:text-gray-200\">\n                  \n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}","// src/hooks/useAthleteDerivedValues.ts\nimport { useMemo } from 'react';\nimport { toJSTDateString } from '../lib/date';\n\n// ====== Types (: DB Row  shape ) ======\ntype TrainingRecord = {\n  date: string | null | undefined;\n  rpe: number | null | undefined;\n  duration_min: number | null | undefined;\n  load?: number | null | undefined;\n};\n\ntype WeightRecord = {\n  date: string | null | undefined;\n  weight_kg?: string | number | null | undefined;\n};\n\ntype SleepRecord = {\n  date: string | null | undefined;\n  sleep_hours?: string | number | null | undefined; // \"7.00\" \n  sleep_quality?: number | null | undefined;\n  bedtime?: string | null | undefined;\n  waketime?: string | null | undefined;\n  notes?: string | null | undefined;\n};\n\ntype MotivationRecord = {\n  date: string | null | undefined;\n  motivation?: number | null | undefined;\n  motivation_level?: number | null | undefined;\n  notes?: string | null | undefined;\n};\n\nfunction isValidYMD(dateStr: unknown): dateStr is string {\n  return typeof dateStr === 'string' && /^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr);\n}\n\nfunction safeTime(dateStr: string | null | undefined): number | null {\n  if (!isValidYMD(dateStr)) return null;\n  const t = new Date(dateStr).getTime();\n  return Number.isFinite(t) ? t : null;\n}\n\n//  \nfunction pickLatestByDate<T extends { date: string | null | undefined }>(items: T[]): T | null {\n  let best: T | null = null;\n  let bestT = -Infinity;\n\n  for (const r of items) {\n    const t = safeTime(r?.date);\n    if (t === null) continue;\n    if (!best || t > bestT) {\n      best = r;\n      bestT = t;\n    }\n  }\n  return best;\n}\n\nexport function useAthleteDerivedValues(params: {\n  trainingRecords?: TrainingRecord[];\n  weightRecords?: WeightRecord[];\n  sleepRecords?: SleepRecord[];\n  motivationRecords?: MotivationRecord[];\n}) {\n  const trainingRecords = params.trainingRecords ?? [];\n  const weightRecords = params.weightRecords ?? [];\n  const sleepRecords = params.sleepRecords ?? [];\n  const motivationRecords = params.motivationRecords ?? [];\n\n  const lastTrainingRecord = useMemo(() => pickLatestByDate(trainingRecords), [trainingRecords]);\n  const lastWeightRecord = useMemo(() => pickLatestByDate(weightRecords), [weightRecords]);\n  const lastSleepRecord = useMemo(() => pickLatestByDate(sleepRecords), [sleepRecords]);\n  const lastMotivationRecord = useMemo(() => pickLatestByDate(motivationRecords), [motivationRecords]);\n\n  const daysWithTrainingData = useMemo(() => {\n    const s = new Set<string>();\n    for (const r of trainingRecords) {\n      if (isValidYMD(r?.date)) s.add(r.date);\n    }\n    return s.size;\n  }, [trainingRecords]);\n\n  const consecutiveTrainingDays = useMemo(() => {\n    const dateSet = new Set<string>();\n    for (const r of trainingRecords) {\n      if (isValidYMD(r?.date)) dateSet.add(r.date);\n    }\n    if (dateSet.size === 0) return 0;\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    //  \n    const start = new Date(today);\n    const todayStr = toJSTDateString(start);\n    if (!dateSet.has(todayStr)) start.setDate(start.getDate() - 1);\n\n    let consecutive = 0;\n    const cur = new Date(start);\n\n    for (let i = 0; i < 365; i++) {\n      const dateStr = toJSTDateString(cur);\n      if (dateSet.has(dateStr)) {\n        consecutive++;\n        cur.setDate(cur.getDate() - 1);\n      } else {\n        break;\n      }\n    }\n    return consecutive;\n  }, [trainingRecords]);\n\n  const weeklyAverage = useMemo(() => {\n    if (!trainingRecords.length) return null;\n\n    const oneWeekAgo = new Date();\n    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n    const oneWeekAgoT = oneWeekAgo.getTime();\n\n    let n = 0;\n    let totalRpe = 0;\n    let totalDuration = 0;\n    let totalLoad = 0;\n\n    for (const r of trainingRecords) {\n      const t = safeTime(r?.date);\n      if (t === null) continue;\n      if (t < oneWeekAgoT) continue;\n\n      n++;\n      totalRpe += Number.isFinite(Number(r.rpe)) ? Number(r.rpe) : 0;\n      totalDuration += Number.isFinite(Number(r.duration_min)) ? Number(r.duration_min) : 0;\n      totalLoad += Number.isFinite(Number(r.load)) ? Number(r.load) : 0;\n    }\n\n    if (n === 0) return null;\n\n    return {\n      rpe: totalRpe / n,\n      duration: totalDuration / n,\n      load: totalLoad / n,\n    };\n  }, [trainingRecords]);\n\n  return {\n    lastTrainingRecord,\n    lastWeightRecord,\n    lastSleepRecord,\n    lastMotivationRecord,\n    daysWithTrainingData,\n    consecutiveTrainingDays,\n    weeklyAverage,\n  };\n}","import React from 'react';\n\ntype WeeklyAverage = {\n  rpe: number;\n  duration: number;\n  load: number;\n};\n\nexport function DerivedStatsBar(props: {\n  daysWithData: number;\n  consecutiveDays: number;\n  weeklyAverage: WeeklyAverage | null;\n}) {\n  const { daysWithData, consecutiveDays, weeklyAverage } = props;\n\n  return (\n    <div className=\"mb-3 rounded-lg bg-gray-50 dark:bg-gray-700/40 px-3 py-2 text-xs text-gray-600 dark:text-gray-300\">\n      : <span className=\"font-semibold\">{daysWithData}</span> \n      : <span className=\"font-semibold\">{consecutiveDays}</span>\n      {weeklyAverage && (\n        <>\n          {' '} 7RPE:{' '}\n          <span className=\"font-semibold\">{weeklyAverage.rpe.toFixed(1)}</span>\n          {' '}:{' '}\n          <span className=\"font-semibold\">{weeklyAverage.duration.toFixed(0)}</span>\n        </>\n      )}\n    </div>\n  );\n}","// src/lib/normalizeRecords.ts\n// \n// - DB Row / any / null \n// - Form  shape \n// - UnifiedDailyCheckIn  shape \n\nexport type ISODate = string; // \"YYYY-MM-DD\"\n\n// =====  =====\nfunction isISODate(v: any): v is ISODate {\n  return typeof v === 'string' && /^\\d{4}-\\d{2}-\\d{2}$/.test(v);\n}\n\nfunction toISODateOrNull(v: any): ISODate | null {\n  if (isISODate(v)) return v;\n  if (v instanceof Date && !isNaN(v.getTime())) return v.toISOString().slice(0, 10);\n  if (typeof v === 'string') {\n    // \"2025-12-21T...\" \n    const m = v.match(/^(\\d{4}-\\d{2}-\\d{2})/);\n    if (m?.[1] && isISODate(m[1])) return m[1];\n  }\n  return null;\n}\n\nfunction toNumberOrNull(v: any): number | null {\n  if (v === null || v === undefined || v === '') return null;\n  const n = typeof v === 'number' ? v : Number(v);\n  return Number.isFinite(n) ? n : null;\n}\n\nfunction toIntOrNull(v: any): number | null {\n  const n = toNumberOrNull(v);\n  if (n === null) return null;\n  return Math.round(n);\n}\n\n// ===== Training =====\n// DB: { id, user_id, date, rpe, duration_min, arrow_score?, signal_score?, load? }\nexport type TrainingRecordForm = {\n  id?: string;\n  date: ISODate;              // Form\n  rpe: number | null;         // null\n  duration_min: number | null;\n  arrow_score: number | null;\n  signal_score: number | null;\n};\n\nexport function normalizeTrainingRecord(input: any): TrainingRecordForm | null {\n  if (!input) return null;\n\n  const date = toISODateOrNull(input.date);\n  if (!date) return null;\n\n  return {\n    id: typeof input.id === 'string' ? input.id : undefined,\n    date,\n    rpe: toNumberOrNull(input.rpe),\n    duration_min: toIntOrNull(input.duration_min ?? input.duration_time ?? input.duration), // \n    arrow_score: toNumberOrNull(input.arrow_score),\n    signal_score: toNumberOrNull(input.signal_score),\n  };\n}\n\n// UnifiedDailyCheckIn / TrainingRecordForm OK\n// CheckIn\nexport type TrainingRecordCheckIn = TrainingRecordForm;\n\nexport function toCheckInTrainingRecord(form: TrainingRecordForm | null): TrainingRecordCheckIn | null {\n  if (!form) return null;\n  return { ...form };\n}\n\n// ===== Sleep =====\n// DB: { id, user_id, date, sleep_hours, sleep_quality }\nexport type SleepRecordForm = {\n  id?: string;\n  date: ISODate;\n  sleep_hours: number | null;     // : 6.5\n  sleep_quality: number | null;   // : 1-5\n};\n\nexport function normalizeSleepRecord(input: any): SleepRecordForm | null {\n  if (!input) return null;\n\n  const date = toISODateOrNull(input.date);\n  if (!date) return null;\n\n  return {\n    id: typeof input.id === 'string' ? input.id : undefined,\n    date,\n    sleep_hours: toNumberOrNull(input.sleep_hours),\n    sleep_quality: toNumberOrNull(input.sleep_quality),\n  };\n}\n\n// ===== Motivation =====\n// DB: { id, user_id, date, motivation_level, energy_level, stress_level }\nexport type MotivationRecordForm = {\n    id?: string;\n    date: ISODate;\n    motivation_level: number | null; // 1-10\n    energy_level: number | null;     // 1-10\n    stress_level: number | null;     // 1-10\n    notes?: string | null;           //  \n  };\n  \n  export function normalizeMotivationRecord(input: any): MotivationRecordForm | null {\n    if (!input) return null;\n  \n    const date = toISODateOrNull(input.date);\n    if (!date) return null;\n  \n    //  motivation \n    const motivation = toNumberOrNull(input.motivation_level ?? input.motivation);\n  \n    return {\n      id: typeof input.id === 'string' ? input.id : undefined,\n      date,\n      motivation_level: motivation,\n      energy_level: toNumberOrNull(input.energy_level),\n      stress_level: toNumberOrNull(input.stress_level),\n      notes: input.notes ?? null,\n    };\n  }\n  \n  /**  Form   null  */\n  export type MotivationLastRecordInfo = {\n    date: ISODate;\n    motivation_level: number;\n    energy_level: number;\n    stress_level: number;\n    notes?: string | null;\n  };\n  \n  const clamp = (n: number, min: number, max: number) => Math.min(max, Math.max(min, n));\n  \n  export function toMotivationLastRecordInfo(\n    input: any,\n    defaults: { motivation?: number; energy?: number; stress?: number } = {}\n  ): MotivationLastRecordInfo | null {\n    const normalized = normalizeMotivationRecord(input);\n    if (!normalized) return null;\n  \n    const motivation_level = clamp(\n      (normalized.motivation_level ?? defaults.motivation ?? 5),\n      1, 10\n    );\n    const energy_level = clamp(\n      (normalized.energy_level ?? defaults.energy ?? 5),\n      1, 10\n    );\n    const stress_level = clamp(\n      (normalized.stress_level ?? defaults.stress ?? 5),\n      1, 10\n    );\n  \n    return {\n      date: normalized.date,\n      motivation_level,\n      energy_level,\n      stress_level,\n      notes: normalized.notes ?? null,\n    };\n  }\n\n\n// ===== Weight =====\n// DB: { id, user_id, date, weight_kg }\nexport type WeightRecordForm = {\n    id?: string;\n    date: ISODate;\n    weight_kg: number | null;\n  };\n\n  export function normalizeWeightRecord(input: any): WeightRecordForm | null {\n    if (!input) return null;\n  \n    const date = toISODateOrNull(input.date);\n    if (!date) return null;\n  \n    return {\n      id: typeof input.id === 'string' ? input.id : undefined,\n      date,\n      weight_kg: toNumberOrNull(input.weight_kg),\n    };\n  }","import {\n    normalizeTrainingRecord,\n    toCheckInTrainingRecord,\n    normalizeSleepRecord,\n    normalizeMotivationRecord,\n    toMotivationLastRecordInfo,\n    normalizeWeightRecord,\n  } from '../lib/normalizeRecords';\n  \n  type UseLastRecordsInput = {\n    lastTrainingRecord: any | null;\n    lastWeightRecord: any | null;\n    lastSleepRecord: any | null;\n    lastMotivationRecord: any | null;\n  };\n  \n  export function useLastRecords({\n    lastTrainingRecord,\n    lastWeightRecord,\n    lastSleepRecord,\n    lastMotivationRecord,\n  }: UseLastRecordsInput) {\n    const normalizedLastTrainingRecord =\n      lastTrainingRecord ? normalizeTrainingRecord(lastTrainingRecord) : null;\n  \n    const normalizedLastTrainingRecordForCheckIn =\n      normalizedLastTrainingRecord\n        ? toCheckInTrainingRecord(normalizedLastTrainingRecord)\n        : null;\n  \n    const normalizedLastWeightRecord =\n      lastWeightRecord ? normalizeWeightRecord(lastWeightRecord) : null;\n  \n    const normalizedLastSleepRecord =\n      lastSleepRecord ? normalizeSleepRecord(lastSleepRecord) : null;\n\n    const normalizedLastMotivationRecord =\n      lastMotivationRecord ? toMotivationLastRecordInfo(lastMotivationRecord) : null;\n  \n    return {\n      normalizedLastTrainingRecord,\n      normalizedLastTrainingRecordForCheckIn,\n      normalizedLastWeightRecord,\n      normalizedLastSleepRecord,\n      normalizedLastMotivationRecord,\n    };\n  }","// src/hooks/useInbodyData.ts\nimport { useEffect, useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\nimport type { Database } from '../lib/database.types';\n\ntype InbodyRow = Database['public']['Tables']['inbody_records']['Row'];\n\nexport type InbodyRecordLite = {\n  id: string;\n  measured_at: string; // 'YYYY-MM-DD'  Date \n  height: number | null;\n  weight: number | null;\n  body_fat_percent: number | null;\n\n  //  \n  fat_mass: number | null;       // (kg)\n  fat_free_mass: number | null;  // (kg)\n};\n\nfunction toNumber(v: any): number | null {\n  if (v === null || v === undefined) return null;\n  const n = Number(v);\n  return Number.isFinite(n) ? n : null;\n}\n\nfunction toDateValue(measured_at: string): number {\n  // 'YYYY-MM-DD' or 'YYYY/MM/DD' \n  const s = String(measured_at || '').trim();\n  if (!s) return 0;\n\n  //  \"T00:00:00\" \n  const normalized = s.includes('T') ? s : s.replace(/\\//g, '-');\n  const dt = new Date(normalized + (normalized.includes('T') ? '' : 'T00:00:00'));\n  const t = dt.getTime();\n  return Number.isFinite(t) ? t : 0;\n}\n\nfunction calcFatMass(weight: number | null, pbf: number | null) {\n  if (weight == null || pbf == null) return null;\n  const v = weight * (pbf / 100);\n  return Number.isFinite(v) ? v : null;\n}\n\nfunction calcFFM(weight: number | null, fatMass: number | null) {\n  if (weight == null || fatMass == null) return null;\n  const v = weight - fatMass;\n  return Number.isFinite(v) ? v : null;\n}\n\nexport function useInbodyData(userId: string | null | undefined) {\n  const [records, setRecords] = useState<InbodyRecordLite[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  //   Date \n  const latest = useMemo(() => {\n    if (records.length === 0) return null;\n    return records.reduce<InbodyRecordLite | null>((acc, r) => {\n      if (!acc) return r;\n      return toDateValue(r.measured_at) > toDateValue(acc.measured_at) ? r : acc;\n    }, null);\n  }, [records]);\n\n  useEffect(() => {\n    if (!userId) return;\n\n    let cancelled = false;\n\n    (async () => {\n      setLoading(true);\n      setError(null);\n\n      try {\n        const { data, error } = await supabase\n          .from('inbody_records')\n          .select('id, measured_at, height, weight, body_fat_percent, user_id')\n          .eq('user_id', userId)\n          .order('measured_at', { ascending: true });\n\n        if (error) throw error;\n        if (cancelled) return;\n\n        const normalized: InbodyRecordLite[] = (data ?? []).map((r: InbodyRow) => {\n          const height = toNumber((r as any).height);\n          const weight = toNumber((r as any).weight);\n          const pbf = toNumber((r as any).body_fat_percent);\n\n          const fatMass = calcFatMass(weight, pbf);\n          const ffm = calcFFM(weight, fatMass);\n\n          return {\n            id: (r as any).id,\n            measured_at: String((r as any).measured_at),\n            height,\n            weight,\n            body_fat_percent: pbf,\n            fat_mass: fatMass,\n            fat_free_mass: ffm,\n          };\n        });\n\n        setRecords(normalized);\n      } catch (e: any) {\n        console.error('[useInbodyData]', e);\n        setError(e?.message ?? 'InBody');\n        setRecords([]);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [userId]);\n\n  return { records, latest, loading, error };\n}","// src/components/InBodyLatestCard.tsx\nimport React from 'react';\nimport { Scale, Percent, Calendar, Dumbbell, Droplets } from 'lucide-react';\nimport type { InbodyRecordLite } from '../hooks/useInbodyData';\n\nfunction jpDate(d: string) {\n  const dt = new Date(d + 'T00:00:00');\n  return Number.isNaN(dt.getTime()) ? d : dt.toLocaleDateString('ja-JP');\n}\n\nexport function InBodyLatestCard({\n  latest,\n  loading,\n  error,\n}: {\n  latest: InbodyRecordLite | null;\n  loading: boolean;\n  error: string | null;\n}) {\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n          InBody\n        </h3>\n        <div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400\">\n          <Calendar className=\"w-4 h-4 mr-1\" />\n          {latest?.measured_at ? jpDate(latest.measured_at) : ''}\n        </div>\n      </div>\n\n      {loading ? (\n        <div className=\"animate-pulse h-20 bg-gray-100 dark:bg-gray-700 rounded-lg\" />\n      ) : error ? (\n        <div className=\"text-sm text-red-600 dark:text-red-400\">{error}</div>\n      ) : !latest ? (\n        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n          InBodyCSV\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n            <div className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1\">\n              <Scale className=\"w-4 h-4 mr-1\" /> \n            </div>\n            <div className=\"text-lg font-bold text-gray-900 dark:text-white\">\n              {latest.weight != null ? `${latest.weight.toFixed(1)} kg` : ''}\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n            <div className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1\">\n              <Dumbbell className=\"w-4 h-4 mr-1\" /> \n            </div>\n            <div className=\"text-lg font-bold text-gray-900 dark:text-white\">\n              {latest.fat_free_mass != null ? `${latest.fat_free_mass.toFixed(1)} kg` : ''}\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n            <div className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1\">\n              <Droplets className=\"w-4 h-4 mr-1\" /> \n            </div>\n            <div className=\"text-lg font-bold text-gray-900 dark:text-white\">\n              {latest.fat_mass != null ? `${latest.fat_mass.toFixed(1)} kg` : ''}\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n            <div className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 mb-1\">\n              <Percent className=\"w-4 h-4 mr-1\" /> \n            </div>\n            <div className=\"text-lg font-bold text-gray-900 dark:text-white\">\n              {latest.body_fat_percent != null ? `${latest.body_fat_percent.toFixed(1)} %` : ''}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","// src/components/InBodyCharts.tsx\nimport React, { useMemo, useState } from 'react';\nimport {\n  ResponsiveContainer,\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ScatterChart,\n  Scatter,\n  ReferenceArea,\n  ReferenceLine\n} from 'recharts';\nimport type { InbodyRecordLite } from '../hooks/useInbodyData';\n\ntype Gender = 'male' | 'female' | null;\n\ntype Props = {\n  records: InbodyRecordLite[];\n  gender: Gender; // AthleteView  user.gender  null\n};\n\nfunction jpDate(d: string) {\n  const s = String(d || '').trim();\n  if (!s) return '';\n  const normalized = s.includes('T') ? s : s.replace(/\\//g, '-');\n  const dt = new Date(normalized + (normalized.includes('T') ? '' : 'T00:00:00'));\n  return Number.isNaN(dt.getTime()) ? s : dt.toLocaleDateString('ja-JP');\n}\n\nfunction toHeightM(heightCm: number | null | undefined) {\n  if (heightCm == null) return null;\n  const n = Number(heightCm);\n  if (!Number.isFinite(n) || n <= 0) return null;\n  return n / 100;\n}\n\nfunction calcBMI(weightKg: number | null, heightCm: number | null) {\n  const hm = toHeightM(heightCm);\n  if (weightKg == null || hm == null) return null;\n  const v = weightKg / (hm * hm);\n  return Number.isFinite(v) ? v : null;\n}\n\nfunction calcFFMI(ffmKg: number | null, heightCm: number | null) {\n  const hm = toHeightM(heightCm);\n  if (ffmKg == null || hm == null) return null;\n  const v = ffmKg / (hm * hm);\n  return Number.isFinite(v) ? v : null;\n}\n\nfunction round2(v: number | null) {\n  if (v == null) return null;\n  const n = Math.round(v * 100) / 100;\n  return Number.isFinite(n) ? n : null;\n}\nfunction round1(v: number | null) {\n  if (v == null) return null;\n  const n = Math.round(v * 10) / 10;\n  return Number.isFinite(n) ? n : null;\n}\n\ntype BandKey = 'general' | 'athlete';\ntype Bands = {\n  bmi: { low: number; high: number };\n  pbf: { low: number; high: number };\n};\n\n// \nconst BANDS: Record<BandKey, Record<'male' | 'female', Bands>> = {\n    general: {\n      male: {\n        bmi: { low: 18.5, high: 25.0 },\n        pbf: { low: 12, high: 20 },\n      },\n      female: {\n        bmi: { low: 18.5, high: 25.0 },\n        pbf: { low: 20, high: 30 },\n      },\n    },\n    athlete: {\n      male: {\n        bmi: { low: 20.0, high: 27.0 },\n        pbf: { low: 8, high: 15 },\n      },\n      female: {\n        bmi: { low: 18.0, high: 25.0 },\n        pbf: { low: 18, high: 25 },\n      },\n    },\n  };\n\nexport function InBodyCharts({ records, gender }: Props) {\n  const [showBands, setShowBands] = useState(true);\n  const [bandKey, setBandKey] = useState<BandKey>('general');\n\n  // OFF\n  const bandsEnabled = showBands && (gender === 'male' || gender === 'female');\n  const bands = useMemo(() => {\n    if (!bandsEnabled) return null;\n    return BANDS[bandKey][gender as 'male' | 'female'];\n  }, [bandsEnabled, bandKey, gender]);\n\n  const heightFallbackCm = useMemo(() => {\n    const sorted = [...(records ?? [])].sort((a, b) => (a.measured_at > b.measured_at ? 1 : -1));\n    for (let i = sorted.length - 1; i >= 0; i--) {\n      const h = sorted[i]?.height;\n      if (h != null && Number.isFinite(h)) return h;\n    }\n    return null;\n  }, [records]);\n\n  const trendData = useMemo(() => {\n    const sorted = [...(records ?? [])].sort((a, b) => (a.measured_at > b.measured_at ? 1 : -1));\n    return sorted.map((r) => {\n      const heightCm = (r.height ?? heightFallbackCm) as number | null;\n\n      const weight = r.weight ?? null;\n      const ffm = (r as any).fat_free_mass ?? null; // hook\n      const pbf = r.body_fat_percent ?? null;\n\n      const ffmi = round2(calcFFMI(ffm, heightCm));\n\n      return {\n        date: r.measured_at,\n        dateLabel: jpDate(r.measured_at),\n\n        // \n        weight: round1(weight),\n        fat_free_mass: round1(ffm),\n\n        // \n        body_fat_percent: round1(pbf),\n        ffmi,\n      };\n    });\n  }, [records, heightFallbackCm]);\n\n  const matrixData = useMemo(() => {\n    const sorted = [...(records ?? [])].sort((a, b) => (a.measured_at > b.measured_at ? 1 : -1));\n    return sorted\n      .map((r, idx) => {\n        const heightCm = (r.height ?? heightFallbackCm) as number | null;\n        const pbf = r.body_fat_percent ?? null;\n        const bmi = calcBMI(r.weight ?? null, heightCm);\n\n        return {\n          idx,\n          date: r.measured_at,\n          dateLabel: jpDate(r.measured_at),\n          pbf: round1(pbf),\n          bmi: round2(bmi),\n        };\n      })\n      .filter((p) => p.pbf != null && p.bmi != null);\n  }, [records, heightFallbackCm]);\n\n  const hasAnyTrend = trendData.some(\n    (d) => d.weight != null || d.fat_free_mass != null || d.body_fat_percent != null || d.ffmi != null\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/*  2 */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n        <div className=\"flex items-start justify-between mb-4 gap-3\">\n          <div>\n            <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n              InBody 2\n            </h3>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n               /  / FFMI0\n            </p>\n          </div>\n        </div>\n\n        {!hasAnyTrend ? (\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n            //\n          </div>\n        ) : (\n          <div className=\"h-72 sm:h-80\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <LineChart data={trendData}>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis dataKey=\"dateLabel\" tick={{ fontSize: 12 }} />\n                <YAxis yAxisId=\"left\" tick={{ fontSize: 12 }} width={52} domain={['auto', 'auto']} />\n                <YAxis\n                  yAxisId=\"right\"\n                  orientation=\"right\"\n                  tick={{ fontSize: 12 }}\n                  width={52}\n                  domain={[0, 'auto']}\n                />\n                <Tooltip\n                  formatter={(value: any, name: any) => {\n                    const n = typeof value === 'number' ? value : null;\n                    if (n == null) return ['', name];\n\n                    if (name === 'weight') return [`${n.toFixed(1)} kg`, ''];\n                    if (name === 'fat_free_mass') return [`${n.toFixed(1)} kg`, ''];\n                    if (name === 'body_fat_percent') return [`${n.toFixed(1)} %`, ''];\n                    if (name === 'ffmi') return [`${n.toFixed(2)}`, 'FFMI'];\n                    return [String(value), name];\n                  }}\n                  labelFormatter={(label) => `${label}`}\n                />\n                <Legend />\n\n                {/*  */}\n                <Line type=\"monotone\" dataKey=\"weight\" name=\"\" yAxisId=\"left\" dot={{ r: 2 }} connectNulls />\n                <Line\n                  type=\"monotone\"\n                  dataKey=\"fat_free_mass\"\n                  name=\"\"\n                  yAxisId=\"left\"\n                  dot={{ r: 2 }}\n                  connectNulls\n                />\n\n                {/*  */}\n                <Line\n                  type=\"monotone\"\n                  dataKey=\"body_fat_percent\"\n                  name=\"\"\n                  yAxisId=\"right\"\n                  dot={{ r: 2 }}\n                  connectNulls\n                />\n                <Line type=\"monotone\" dataKey=\"ffmi\" name=\"FFMI\" yAxisId=\"right\" dot={{ r: 2 }} connectNulls />\n              </LineChart>\n            </ResponsiveContainer>\n          </div>\n        )}\n      </div>\n\n      {/*   +  */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n        <div className=\"flex items-start justify-between mb-4 gap-3\">\n          <div>\n            <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n              BMI  \n            </h3>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n              %BMI\n            </p>\n          </div>\n\n          {/* UI */}\n          <div className=\"flex flex-col items-end gap-2\">\n            <label className=\"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300\">\n              <input\n                type=\"checkbox\"\n                className=\"rounded\"\n                checked={showBands}\n                onChange={(e) => setShowBands(e.target.checked)}\n              />\n              \n            </label>\n\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\"></span>\n              <select\n                className=\"text-xs px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100\"\n                value={bandKey}\n                onChange={(e) => setBandKey(e.target.value as BandKey)}\n                disabled={!bandsEnabled} // OFF\n              >\n                <option value=\"general\"></option>\n                <option value=\"athlete\"></option>\n              </select>\n            </div>\n\n            {/*  */}\n            {gender !== 'male' && gender !== 'female' ? (\n              <div className=\"text-[11px] text-gray-500 dark:text-gray-400\">\n                OFF\n              </div>\n            ) : (\n              <div className=\"text-[11px] text-gray-500 dark:text-gray-400\">\n                {gender === 'male' ? '' : ''}\n              </div>\n            )}\n          </div>\n        </div>\n\n        {matrixData.length === 0 ? (\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n            \n          </div>\n        ) : (\n          <div className=\"h-72 sm:h-80\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <ScatterChart>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n\n                <XAxis\n                  type=\"number\"\n                  dataKey=\"pbf\"\n                  name=\"\"\n                  unit=\"%\"\n                  tick={{ fontSize: 12 }}\n                  domain={['auto', 'auto']}\n                />\n                <YAxis type=\"number\" dataKey=\"bmi\" name=\"BMI\" tick={{ fontSize: 12 }} domain={['auto', 'auto']} />\n\n                {/* ReferenceArea */}\n                    {bandsEnabled && bands && (\n                    <ReferenceArea\n                        x1={bands.pbf.low}\n                        x2={bands.pbf.high}\n                        y1={bands.bmi.low}\n                        y2={bands.bmi.high}\n                        fill=\"rgba(59,130,246,0.18)\"\n                        fillOpacity={1}\n                        stroke=\"rgba(59,130,246,0.9)\"\n                        strokeWidth={1.5}\n                        ifOverflow=\"extendDomain\"\n                    />\n                    )}\n                    {/* ReferenceArea */}\n                    {bandsEnabled && bands && (\n                    <>\n                        {/*  */}\n                        <ReferenceArea\n                        x1={bands.pbf.low}\n                        x2={bands.pbf.high}\n                        y1={bands.bmi.low}\n                        y2={bands.bmi.high}\n                        fill=\"rgba(59,130,246,0.12)\"   //  \n                        stroke=\"rgba(59,130,246,0.55)\"\n                        strokeWidth={1}\n                        />\n\n                        {/* x */}\n                        <ReferenceLine\n                        x={bands.pbf.low}\n                        stroke=\"rgba(59,130,246,0.75)\"\n                        strokeDasharray=\"4 4\"\n                        label={{\n                            value: `PBF ${bands.pbf.low}%`,\n                            position: 'insideTopLeft',\n                            fontSize: 11,\n                        }}\n                        />\n                        <ReferenceLine\n                        x={bands.pbf.high}\n                        stroke=\"rgba(59,130,246,0.75)\"\n                        strokeDasharray=\"4 4\"\n                        label={{\n                            value: `PBF ${bands.pbf.high}%`,\n                            position: 'insideTopRight',\n                            fontSize: 11,\n                        }}\n                        />\n\n                        {/* yBMI */}\n                        <ReferenceLine\n                        y={bands.bmi.low}\n                        stroke=\"rgba(59,130,246,0.75)\"\n                        strokeDasharray=\"4 4\"\n                        label={{\n                            value: `BMI ${bands.bmi.low}`,\n                            position: 'insideLeft',\n                            fontSize: 11,\n                        }}\n                        />\n                        <ReferenceLine\n                        y={bands.bmi.high}\n                        stroke=\"rgba(59,130,246,0.75)\"\n                        strokeDasharray=\"4 4\"\n                        label={{\n                            value: `BMI ${bands.bmi.high}`,\n                            position: 'insideLeft',\n                            fontSize: 11,\n                        }}\n                        />\n                    </>\n                    )}\n\n                <Tooltip\n                  cursor={{ strokeDasharray: '3 3' }}\n                  formatter={(value: any, name: any) => {\n                    const n = typeof value === 'number' ? value : null;\n                    if (name === 'pbf') return [`${n?.toFixed(1)} %`, ''];\n                    if (name === 'bmi') return [`${n?.toFixed(2)}`, 'BMI'];\n                    return [String(value), name];\n                  }}\n                  labelFormatter={(_, payload) => {\n                    const p = payload?.[0]?.payload;\n                    return p?.dateLabel ? `${p.dateLabel}` : '';\n                  }}\n                />\n\n                <Scatter name=\"\" data={matrixData} />\n              </ScatterChart>\n            </ResponsiveContainer>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","// src/lib/getTodayEnergySummary.ts\n\nexport type EnergyStatus = 'low' | 'ok' | 'high' | 'unknown';\n\nexport type TodayEnergySummaryInput = {\n  date: string; // 'YYYY-MM-DD' (JST)\n\n  // daily_energy_snapshots \n  snapshot?: {\n    bmr?: number | null;           // kcal/day\n    tdee?: number | null;          // kcal/day\n    srpe?: number | null;          // load (RPE*min)\n    activity_factor?: number | null;\n  } | null;\n\n  // AI nutrition_logs \n  intakeCalories?: number | null;\n\n  // snapshot \n  fallback?: {\n    weightKg7dAvg?: number | null;     // 7\n    leanMassKg?: number | null;        // \n    heightCm?: number | null;\n    age?: number | null;\n    gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say' | null;\n    todayLoad?: number | null;         //  sRPERPE*\n  } | null;\n};\n\nexport type TodayEnergySummary = {\n  date: string;\n\n  bmr: number | null;\n  tdee: number | null;\n  intake: number | null;\n\n  balance: number | null; // intake - tdee+-\n\n  status: EnergyStatus;\n  statusLabel: string;\n\n  // UI\n  meta: {\n    bmrSource: 'snapshot' | 'leanMass' | 'mifflin' | 'none';\n    tdeeSource: 'snapshot' | 'estimated' | 'none';\n  };\n};\n\n// --- OK ---\n\n// Katch-McArdle\n// BMR = 370 + 21.6 * LBM(kg)\nfunction estimateBmrFromLeanMass(leanMassKg: number): number {\n  return Math.round(370 + 21.6 * leanMassKg);\n}\n\n// Mifflin-St Jeor///\n// : 10W + 6.25H - 5A + 5\n// : 10W + 6.25H - 5A - 161\nfunction estimateBmrMifflin(params: {\n  weightKg: number;\n  heightCm: number;\n  age: number;\n  gender: 'male' | 'female';\n}): number {\n  const { weightKg: W, heightCm: H, age: A, gender } = params;\n  const base = 10 * W + 6.25 * H - 5 * A;\n  return Math.round(gender === 'male' ? base + 5 : base - 161);\n}\n\n// loadsRPE  OK\nfunction estimateExtraFromLoad(load: number): number {\n  // AthleteView\n  if (load >= 600) return 700;\n  if (load >= 400) return 500;\n  if (load >= 150) return 300;\n  return 200;\n}\n\n// activity factor snapshot \nfunction defaultActivityFactor(): number {\n  return 1.55; // \n}\n\nexport function getTodayEnergySummary(input: TodayEnergySummaryInput): TodayEnergySummary {\n  const intake = typeof input.intakeCalories === 'number' ? input.intakeCalories : null;\n\n  // --- 1) BMR ---\n  let bmr: number | null = null;\n  let bmrSource: TodayEnergySummary['meta']['bmrSource'] = 'none';\n\n  const snapBmr = input.snapshot?.bmr ?? null;\n  if (typeof snapBmr === 'number' && Number.isFinite(snapBmr) && snapBmr > 0) {\n    bmr = snapBmr;\n    bmrSource = 'snapshot';\n  } else {\n    const lean = input.fallback?.leanMassKg ?? null;\n    if (typeof lean === 'number' && lean > 0) {\n      bmr = estimateBmrFromLeanMass(lean);\n      bmrSource = 'leanMass';\n    } else {\n      const w = input.fallback?.weightKg7dAvg ?? null;\n      const h = input.fallback?.heightCm ?? null;\n      const a = input.fallback?.age ?? null;\n      const g = input.fallback?.gender ?? null;\n\n      if (\n        typeof w === 'number' && w > 0 &&\n        typeof h === 'number' && h > 0 &&\n        typeof a === 'number' && a > 0 &&\n        (g === 'male' || g === 'female')\n      ) {\n        bmr = estimateBmrMifflin({ weightKg: w, heightCm: h, age: a, gender: g });\n        bmrSource = 'mifflin';\n      }\n    }\n  }\n\n  // --- 2) TDEE ---\n  let tdee: number | null = null;\n  let tdeeSource: TodayEnergySummary['meta']['tdeeSource'] = 'none';\n\n  const snapTdee = input.snapshot?.tdee ?? null;\n  if (typeof snapTdee === 'number' && Number.isFinite(snapTdee) && snapTdee > 0) {\n    tdee = snapTdee;\n    tdeeSource = 'snapshot';\n  } else if (bmr) {\n    const af = (input.snapshot?.activity_factor ?? null) ?? defaultActivityFactor();\n    const load = input.fallback?.todayLoad ?? input.snapshot?.srpe ?? 0;\n    const extra = estimateExtraFromLoad(Number(load ?? 0));\n    tdee = Math.round(bmr * af + extra);\n    tdeeSource = 'estimated';\n  }\n\n  // --- 3) balance & status ---\n  const balance = (intake != null && tdee != null) ? Math.round(intake - tdee) : null;\n\n  let status: EnergyStatus = 'unknown';\n  let statusLabel = '';\n\n  if (balance != null) {\n    // \n    if (balance <= -350) {\n      status = 'low';\n      statusLabel = '';\n    } else if (balance >= 350) {\n      status = 'high';\n      statusLabel = '';\n    } else {\n      status = 'ok';\n      statusLabel = '';\n    }\n  }\n\n  return {\n    date: input.date,\n    bmr,\n    tdee,\n    intake,\n    balance,\n    status,\n    statusLabel,\n    meta: {\n      bmrSource,\n      tdeeSource,\n    },\n  };\n}","// src/components/NutritionOverview.tsx\nimport React, { useMemo } from \"react\";\n\nexport type NutritionMacroTotals = {\n  cal: number;\n  p: number;\n  f: number;\n  c: number;\n};\n\nexport type NutritionMacroTargets = {\n  cal: number;\n  p: number;\n  f: number;\n  c: number;\n};\n\nexport type NutritionOverviewProps = {\n  /** useTodayNutritionTotals  */\n  totals: NutritionMacroTotals;\n\n  /** buildDailyTargets  target */\n  targets: NutritionMacroTargets | null;\n\n  /**  */\n  loading?: boolean;\n\n  /** YYYY-MM-DD */\n  subtitle?: string;\n\n  /**  */\n  onOpen?: () => void;\n};\n\nfunction toNum(v: any, fallback = 0) {\n  const n = Number(v);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction pct(now: number, goal: number) {\n  if (!Number.isFinite(goal) || goal <= 0) return 0;\n  const raw = (now / goal) * 100;\n  return Math.min(100, Math.max(0, raw));\n}\n\n/**  */\nfunction status(now: number, goal: number) {\n  if (!Number.isFinite(goal) || goal <= 0) return \"na\" as const;\n\n  const r = now / goal;\n\n  // OK\n  if (r < 0.7) return \"low\" as const;      // \n  if (r <= 1.1) return \"ok\" as const;      // \n  return \"high\" as const;                  // \n}\n\nfunction barClass(st: ReturnType<typeof status>) {\n  // \n  // low=ok=high= \n  switch (st) {\n    case \"low\":\n      return \"bg-blue-600\";\n    case \"ok\":\n      return \"bg-emerald-600\";\n    case \"high\":\n      return \"bg-orange-600\";\n    default:\n      return \"bg-gray-400\";\n  }\n}\n\nfunction labelClass(st: ReturnType<typeof status>) {\n  switch (st) {\n    case \"low\":\n      return \"text-blue-700 dark:text-blue-300\";\n    case \"ok\":\n      return \"text-emerald-700 dark:text-emerald-300\";\n    case \"high\":\n      return \"text-orange-700 dark:text-orange-300\";\n    default:\n      return \"text-gray-500 dark:text-gray-400\";\n  }\n}\n\nexport function NutritionOverview({\n  totals,\n  targets,\n  loading = false,\n  subtitle,\n  onOpen,\n}: NutritionOverviewProps) {\n  const rows = useMemo(() => {\n    if (!targets) return null;\n\n    const calNow = toNum(totals?.cal, 0);\n    const pNow = toNum(totals?.p, 0);\n    const fNow = toNum(totals?.f, 0);\n    const cNow = toNum(totals?.c, 0);\n\n    return [\n      {\n        key: \"cal\",\n        label: \"\",\n        unit: \"kcal\",\n        now: Math.round(calNow),\n        goal: Math.round(toNum(targets?.cal, 0)),\n      },\n      {\n        key: \"p\",\n        label: \"\",\n        unit: \"g\",\n        now: Math.round(pNow * 10) / 10,\n        goal: Math.round(toNum(targets?.p, 0) * 10) / 10,\n      },\n      {\n        key: \"f\",\n        label: \"\",\n        unit: \"g\",\n        now: Math.round(fNow * 10) / 10,\n        goal: Math.round(toNum(targets?.f, 0) * 10) / 10,\n      },\n      {\n        key: \"c\",\n        label: \"\",\n        unit: \"g\",\n        now: Math.round(cNow * 10) / 10,\n        goal: Math.round(toNum(targets?.c, 0) * 10) / 10,\n      },\n    ];\n  }, [totals, targets]);\n\n  return (\n    <div\n      className={[\n        \"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-5 transition-colors\",\n        onOpen ? \"cursor-pointer hover:shadow-md\" : \"\",\n      ].join(\" \")}\n      onClick={onOpen}\n      role={onOpen ? \"button\" : undefined}\n      tabIndex={onOpen ? 0 : -1}\n      onKeyDown={(e) => {\n        if (!onOpen) return;\n        if (e.key === \"Enter\" || e.key === \" \") onOpen();\n      }}\n    >\n      <div className=\"flex items-start justify-between gap-3\">\n        <div>\n          <h3 className=\"text-base font-semibold text-gray-900 dark:text-white\">\n            \n          </h3>\n          {subtitle && (\n            <p className=\"mt-0.5 text-xs text-gray-500 dark:text-gray-400\">\n              {subtitle}\n            </p>\n          )}\n        </div>\n\n        {/*  */}\n      </div>\n\n      {loading ? (\n        <div className=\"mt-4 text-sm text-gray-500 dark:text-gray-400\">\n          \n        </div>\n      ) : !rows ? (\n        <div className=\"mt-4 text-sm text-gray-500 dark:text-gray-400\">\n          \n        </div>\n      ) : (\n        <div className=\"mt-4 space-y-3\">\n          {rows.map((r) => {\n            const st = status(r.now, r.goal);\n            const percent = pct(r.now, r.goal);\n\n            return (\n              <div key={r.key}>\n                <div className=\"flex items-baseline justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-xs font-medium text-gray-700 dark:text-gray-200\">\n                      {r.label}\n                    </span>\n                    <span className={`text-[11px] ${labelClass(st)}`}>\n                      {Math.round(percent)}%\n                    </span>\n                  </div>\n\n                  <div className=\"text-[11px] text-gray-500 dark:text-gray-400\">\n                    {r.now}/{r.goal} {r.unit}\n                  </div>\n                </div>\n\n                <div className=\"mt-1.5 h-2.5 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden\">\n                  <div\n                    className={`h-full ${barClass(st)}`}\n                    style={{ width: `${percent}%` }}\n                  />\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {onOpen && (\n        <div className=\"mt-3 text-[11px] text-gray-500 dark:text-gray-400\">\n          \n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default NutritionOverview;","// src/lib/nutritionCalc.js\n// Bekuta Nutrition: AI\n// - FFM() / BMR / TDEE\n// - kcal/PFC\n// - \n// : / fallback \n//  \n// - payload null  0 safeNumOrNull\n// - targetCal BMR\n// - TDEE rough  activityLevel \n// - 0minCarbG\n// - bmr/tdee  confidence \n\n// -------------------------\n// helpers\n// -------------------------\nexport function clamp(n, min, max) {\n  if (typeof n !== \"number\" || !Number.isFinite(n)) return min;\n  return Math.min(Math.max(n, min), max);\n}\n\nexport function round1(n) {\n  return Math.round(n * 10) / 10;\n}\nexport function round0(n) {\n  return Math.round(n);\n}\n\nexport function safeNum(n, fallback = 0) {\n  return typeof n === \"number\" && Number.isFinite(n) ? n : fallback;\n}\n\n//  null/undefined/NaN 0payload\nexport function safeNumOrNull(n) {\n  return typeof n === \"number\" && Number.isFinite(n) ? n : null;\n}\n\n// -------------------------\n// FFM (Fat Free Mass)\n// -------------------------\n// weightKg * (1 - bodyFatPercent/100)\nexport function calcFFMFromBodyFatPercent(weightKg, bodyFatPercent) {\n  const w = safeNum(weightKg, 0);\n  const pbf = safeNum(bodyFatPercent, NaN);\n  if (!Number.isFinite(pbf)) return null; // \n  const ffm = w * (1 - pbf / 100);\n  return ffm > 0 ? round1(ffm) : null;\n}\n\n// -------------------------\n// BMR\n// -------------------------\n// Katch-McArdle: BMR = 370 + 21.6 * FFM\nexport function calcBMR_KatchMcArdle(ffmKg) {\n  const ffm = safeNum(ffmKg, NaN);\n  if (!Number.isFinite(ffm)) return null;\n  const bmr = 370 + 21.6 * ffm;\n  return bmr > 0 ? round0(bmr) : null;\n}\n\n// Mifflin-St Jeor:\n// male: 10w + 6.25h - 5a + 5\n// female: 10w + 6.25h - 5a - 161\nexport function calcBMR_Mifflin({ weightKg, heightCm, age, sex }) {\n  const w = safeNum(weightKg, NaN);\n  const h = safeNum(heightCm, NaN);\n  const a = safeNum(age, NaN);\n  if (![w, h, a].every(Number.isFinite)) return null;\n\n  const base = 10 * w + 6.25 * h - 5 * a;\n  const s = (sex || \"\").toLowerCase(); // \"male\" | \"female\"\n  const adj = s === \"male\" ? 5 : s === \"female\" ? -161 : -78; // \n  const bmr = base + adj;\n  return bmr > 0 ? round0(bmr) : null;\n}\n\n// -------------------------\n// TDEE\n// -------------------------\n// activityFactor ():\n// sedentary 1.2\n// light 1.375\n// moderate 1.55\n// high 1.725\n// athlete 1.9\nexport function activityFactorFromLevel(level) {\n  const l = (level || \"\").toLowerCase();\n  switch (l) {\n    case \"sedentary\":\n    case \"low\":\n      return 1.2;\n    case \"light\":\n      return 1.375;\n    case \"moderate\":\n      return 1.55;\n    case \"high\":\n      return 1.725;\n    case \"athlete\":\n    case \"very_high\":\n      return 1.9;\n    default:\n      return 1.55; // \n  }\n}\n\nexport function calcTDEE(bmrKcal, activityLevel) {\n  const bmr = safeNum(bmrKcal, NaN);\n  if (!Number.isFinite(bmr)) return null;\n  const af = activityFactorFromLevel(activityLevel);\n  const tdee = bmr * af;\n  return tdee > 0 ? round0(tdee) : null;\n}\n\n//  TDEE rough activity\nexport function roughCaloriesFromWeight(weightKg, activityLevel = \"moderate\") {\n  const w = safeNum(weightKg, NaN);\n  if (!Number.isFinite(w) || w <= 0) return null;\n\n  // \n  // low: 28, light: 30, moderate: 33, high: 36, athlete: 40\n  const l = (activityLevel || \"\").toLowerCase();\n  const factor =\n    l === \"sedentary\" || l === \"low\" ? 28 :\n    l === \"light\" ? 30 :\n    l === \"moderate\" ? 33 :\n    l === \"high\" ? 36 :\n    l === \"athlete\" || l === \"very_high\" ? 40 :\n    33;\n\n  return round0(w * factor);\n}\n\n// -------------------------\n// Daily Target (kcal / PFC)\n// -------------------------\n// \n// - :  or FFM \n// - : \n// - : C\n//\n// goalType : \"loss_maintain_muscle\" | \"maintain\" | \"gain\"\nexport function buildDailyTargets({\n  weightKg,\n  bodyFatPercent, // optional\n  ffmKg, // optional\n  heightCm, // optional\n  age, // optional\n  sex, // optional\n\n  activityLevel = \"moderate\",\n  goalType = \"maintain\",\n\n  // : \n  targetCaloriesOverride = null,\n\n  // \n  proteinPerKg = null,     // : 2.0 (kg)\n  proteinPerFFM = null,    // : 2.4 (FFM kg)\n\n  // \n  fatPerKg = null,         // : 0.8 (kg)\n  minFatG = 40,            // \n\n  //  \n  // : 2g  weightKg*2 \n  minCarbG = 0,\n\n  // /kcalTDEE\n  deficitKcal = 0,         //  200500\n  surplusKcal = 0,         //  100300\n\n  //  targetCal BMR\n  // BMR1.051.2\n  minCaloriesByBMRRatio = 1.05,\n\n  // \n  maxCalories = 6000\n}) {\n  const w = safeNum(weightKg, NaN);\n  if (!Number.isFinite(w) || w <= 0) {\n    throw new Error(\"weightKg is required\");\n  }\n\n  // confidence\n  const missing = [];\n  if (!Number.isFinite(bodyFatPercent)) missing.push(\"bodyFatPercent\");\n  if (!Number.isFinite(ffmKg)) missing.push(\"ffmKg\");\n  if (!Number.isFinite(heightCm)) missing.push(\"heightCm\");\n  if (!Number.isFinite(age)) missing.push(\"age\");\n  if (!sex) missing.push(\"sex\");\n\n  // FFM \n  const ffm =\n    Number.isFinite(ffmKg) ? round1(ffmKg) : calcFFMFromBodyFatPercent(w, bodyFatPercent);\n\n  // BMRFFMKatchMifflin null\n  const bmrFromFFM = ffm ? calcBMR_KatchMcArdle(ffm) : null;\n  const bmrFromMifflin = calcBMR_Mifflin({ weightKg: w, heightCm, age, sex });\n\n  const bmr = bmrFromFFM ?? bmrFromMifflin ?? null;\n  const bmrMethod = bmrFromFFM ? \"katch\" : bmrFromMifflin ? \"mifflin\" : \"none\";\n\n  const tdee = bmr ? calcTDEE(bmr, activityLevel) : null;\n  const tdeeMethod = tdee ? \"bmr_x_activity\" : \"none\";\n\n  // raw\n  let targetCalRaw = null;\n\n  if (Number.isFinite(targetCaloriesOverride)) {\n    targetCalRaw = round0(targetCaloriesOverride);\n  } else if (tdee) {\n    if (goalType === \"loss_maintain_muscle\") {\n      targetCalRaw = round0(tdee - (deficitKcal || 300));\n    } else if (goalType === \"gain\") {\n      targetCalRaw = round0(tdee + (surplusKcal || 200));\n    } else {\n      targetCalRaw = round0(tdee);\n    }\n  } else {\n    // tdee fallbackactivity\n    const rough = roughCaloriesFromWeight(w, activityLevel);\n    targetCalRaw = round0(rough ?? (w * 33));\n  }\n\n  //  BMR\n  // targetCalC0//\n  let targetCal = targetCalRaw;\n  if (bmr) {\n    const minByBmr = round0(bmr * safeNum(minCaloriesByBMRRatio, 1.05));\n    targetCal = clamp(targetCal, minByBmr, maxCalories);\n  } else {\n    targetCal = clamp(targetCal, 800, maxCalories); // BMR\n  }\n\n  // \n  const defaultProteinKg =\n    goalType === \"loss_maintain_muscle\" ? 2.0 :\n    goalType === \"gain\" ? 1.8 :\n    1.6;\n\n  const pG = (() => {\n    if (Number.isFinite(proteinPerFFM) && ffm) return round0(ffm * proteinPerFFM);\n    if (Number.isFinite(proteinPerKg)) return round0(w * proteinPerKg);\n    if (ffm && goalType === \"loss_maintain_muscle\") return round0(ffm * 2.4);\n    return round0(w * defaultProteinKg);\n  })();\n\n  // \n  const defaultFatKg =\n    goalType === \"loss_maintain_muscle\" ? 0.8 :\n    goalType === \"gain\" ? 1.0 :\n    0.9;\n\n  const fG = clamp(\n    round0(w * (Number.isFinite(fatPerKg) ? fatPerKg : defaultFatKg)),\n    minFatG,\n    200\n  );\n\n  // \n  // kcal -> g: P=4, C=4, F=9\n  const kcalFromPF = pG * 4 + fG * 9;\n  const remaining = targetCal - kcalFromPF;\n  let cG = Math.max(0, round0(remaining / 4));\n\n  //  \n  // C0 \"targetAdjusted\" \n  const minC = Math.max(0, round0(safeNum(minCarbG, 0)));\n  let targetCalAdjusted = targetCal;\n  let adjustedReason = null;\n\n  if (minC > 0 && cG < minC) {\n    cG = minC;\n    targetCalAdjusted = round0(kcalFromPF + cG * 4);\n    adjustedReason = \"minCarbG_applied\";\n  }\n\n  // confidence\n  // - high: FFM or (age+height+sex) \n  // - mid: +\n  // - low: \n  const confidence = (() => {\n    const hasFFM = !!ffm;\n    const hasMifflinInputs = [heightCm, age].every(Number.isFinite) && !!sex;\n    if (hasFFM || hasMifflinInputs) return \"high\";\n    if (activityLevel) return \"mid\";\n    return \"low\";\n  })();\n\n  return {\n    // \n    ffmKg: ffm,\n    bmrKcal: bmr,\n    tdeeKcal: tdee,\n    activityLevel,\n    goalType,\n\n    // \n    meta: {\n      bmrMethod,\n      tdeeMethod,\n      confidence,\n      missing,\n      targetCalRaw,\n      targetCalAdjusted,\n      adjustedReason\n    },\n\n    // UI/AI\n    //  adjustedReason  targetCalAdjusted \n    // OK\n    target: {\n      cal: targetCalAdjusted,\n      p: pG,\n      f: fG,\n      c: cG\n    }\n  };\n}\n\n// -------------------------\n// Gap (today vs target)\n// -------------------------\nexport function calcGaps({ today, target }) {\n  const t = today || { cal: 0, p: 0, f: 0, c: 0 };\n  const g = target || { cal: 0, p: 0, f: 0, c: 0 };\n\n  return {\n    cal: round0(safeNum(g.cal, 0) - safeNum(t.cal, 0)),\n    p: round1(safeNum(g.p, 0) - safeNum(t.p, 0)),\n    f: round1(safeNum(g.f, 0) - safeNum(t.f, 0)),\n    c: round1(safeNum(g.c, 0) - safeNum(t.c, 0)),\n  };\n}\n\n// -------------------------\n// Prompt payload builder (AIJSON)\n// -------------------------\nexport function buildAIPayload({\n  userName,\n  profile,       // { weightKg, bodyFatPercent, ffmKg, age, heightCm, sex, activityLevel, goalType }\n  targets,       // { cal,p,f,c }\n  todayTotals,   // { cal,p,f,c }\n  gaps,          // { cal,p,f,c }\n  mealType,      // \"\" etc\n  notes = \"\",\n  meta = null    // buildDailyTargets().meta \n}) {\n  return {\n    user_name: userName || \"\",\n    meal_type: mealType || null,\n\n    profile: {\n      weightKg: safeNumOrNull(profile?.weightKg),\n      bodyFatPercent: safeNumOrNull(profile?.bodyFatPercent),\n      ffmKg: safeNumOrNull(profile?.ffmKg),\n      age: safeNumOrNull(profile?.age),\n      heightCm: safeNumOrNull(profile?.heightCm),\n      sex: profile?.sex || null,\n      activityLevel: profile?.activityLevel || null,\n      goalType: profile?.goalType || null\n    },\n\n    daily_target: {\n      cal: safeNumOrNull(targets?.cal),\n      p: safeNumOrNull(targets?.p),\n      f: safeNumOrNull(targets?.f),\n      c: safeNumOrNull(targets?.c),\n    },\n\n    today_totals: {\n      cal: safeNumOrNull(todayTotals?.cal),\n      p: safeNumOrNull(todayTotals?.p),\n      f: safeNumOrNull(todayTotals?.f),\n      c: safeNumOrNull(todayTotals?.c),\n    },\n\n    gaps: {\n      cal: safeNumOrNull(gaps?.cal),\n      p: safeNumOrNull(gaps?.p),\n      f: safeNumOrNull(gaps?.f),\n      c: safeNumOrNull(gaps?.c),\n    },\n\n    // optional: AI\n    meta: meta || null,\n\n    notes\n  };\n}","// src/components/FTTCheck.tsx\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\nimport { Timer, Hand, Save, RotateCcw, ShieldAlert, Sparkles, ArrowLeft } from \"lucide-react\";\n\ntype Screen = \"standby\" | \"measure\" | \"result\";\ntype ConditionResult = \"good\" | \"fatigue\" | \"danger\" | \"stop\" | \"calibrating\";\n\ntype Props = {\n  userId: string;\n  onBackHome?: () => void;\n};\n\nconst DURATION_MS = 10_000;\nconst TIMER_TICK_MS = 50; //  \n\n// ===== utils =====\nfunction mean(nums: number[]) {\n  if (nums.length === 0) return 0;\n  return nums.reduce((a, b) => a + b, 0) / nums.length;\n}\nfunction stddev(nums: number[]) {\n  if (nums.length <= 1) return 0;\n  const m = mean(nums);\n  const v = nums.reduce((a, b) => a + (b - m) * (b - m), 0) / nums.length;\n  return Math.sqrt(v);\n}\nfunction getTodayJST() {\n  const now = new Date();\n  const jst = new Date(now.getTime() + 9 * 60 * 60 * 1000);\n  return jst.toISOString().slice(0, 10);\n}\nfunction getPastYMDJST(daysAgo: number) {\n  const now = new Date();\n  const jstNow = new Date(now.getTime() + 9 * 60 * 60 * 1000);\n  const d = new Date(jstNow);\n  d.setDate(d.getDate() - daysAgo);\n  return d.toISOString().slice(0, 10);\n}\nfunction sleep(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\nfunction clamp(n: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, n));\n}\nfunction conditionLabel(c: ConditionResult) {\n  switch (c) {\n    case \"good\":\n      return { title: \"GOOD\", sub: \"\", icon: Sparkles };\n    case \"fatigue\":\n      return { title: \"FATIGUE\", sub: \"\", icon: Timer };\n    case \"danger\":\n      return { title: \"DANGER\", sub: \"\", icon: ShieldAlert };\n    case \"stop\":\n      return { title: \"STOP\", sub: \"\", icon: ShieldAlert };\n    default:\n      return { title: \"CALIBRATING\", sub: \"\", icon: Timer };\n  }\n}\nfunction conditionBadgeClass(c: ConditionResult) {\n  switch (c) {\n    case \"good\":\n      return \"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200\";\n    case \"fatigue\":\n      return \"bg-amber-50 text-amber-700 ring-1 ring-amber-200\";\n    case \"danger\":\n    case \"stop\":\n      return \"bg-rose-50 text-rose-700 ring-1 ring-rose-200\";\n    default:\n      return \"bg-slate-50 text-slate-600 ring-1 ring-slate-200\";\n  }\n}\n\nexport function FTTCheck({ userId, onBackHome }: Props) {\n  const [screen, setScreen] = useState<Screen>(\"standby\");\n\n  const isActiveRef = useRef(false);\n  const [isActive, setIsActive] = useState(false);\n\n  const [remainingMs, setRemainingMs] = useState(DURATION_MS);\n  const [tapCount, setTapCount] = useState(0);\n\n  const [resultCount, setResultCount] = useState(0);\n  const [resultSD, setResultSD] = useState(0);\n  const [resultIntervals, setResultIntervals] = useState<number[]>([]);\n  const [condition, setCondition] = useState<ConditionResult>(\"calibrating\");\n  const [message, setMessage] = useState(\"\");\n\n  const [didSave, setDidSave] = useState(false);\n  const [saveBusy, setSaveBusy] = useState(false);\n  const [saveStatus, setSaveStatus] = useState<string>(\"\");\n\n  const startTimeRef = useRef<number>(0);\n  const tapsRef = useRef<number[]>([]);\n  const timerRef = useRef<number | null>(null);\n\n  const tapAreaRef = useRef<HTMLDivElement | null>(null);\n  const eventIdRef = useRef<string | null>(null);\n\n  const baselineCacheRef = useRef<{\n    key: string;\n    windowDays: number;\n    minSamples: number;\n    sampleCount: number;\n    baselineSpeed: number;\n    baselineSD: number;\n    fetchedAt: number;\n  } | null>(null);\n\n  const progress = useMemo(() => {\n    const p = 1 - remainingMs / DURATION_MS;\n    return clamp(p, 0, 1);\n  }, [remainingMs]);\n\n  function clearTimer() {\n    if (timerRef.current) {\n      window.clearInterval(timerRef.current);\n      timerRef.current = null;\n    }\n  }\n\n  function resetLocal() {\n    clearTimer();\n\n    setIsActive(false);\n    isActiveRef.current = false;\n\n    setRemainingMs(DURATION_MS);\n    setTapCount(0);\n    tapsRef.current = [];\n    startTimeRef.current = 0;\n\n    eventIdRef.current = null;\n\n    setDidSave(false);\n    setSaveBusy(false);\n    setSaveStatus(\"\");\n  }\n\n  function start() {\n    resetLocal();\n    setScreen(\"measure\");\n\n    setIsActive(true);\n    isActiveRef.current = true;\n\n    startTimeRef.current = performance.now();\n\n    //  interval\n    timerRef.current = window.setInterval(() => {\n      if (!isActiveRef.current) return;\n\n      const now = performance.now();\n      const elapsed = now - startTimeRef.current;\n      const remaining = Math.max(0, DURATION_MS - elapsed);\n\n      // 50ms\n      setRemainingMs(remaining);\n\n      if (remaining <= 0) {\n        clearTimer();\n        finish();\n      }\n    }, TIMER_TICK_MS);\n  }\n\n  function handleTap(e: React.PointerEvent<HTMLDivElement>) {\n    if (!isActiveRef.current) return;\n\n    if ((e as any).cancelable) e.preventDefault();\n\n    const now = performance.now();\n    tapsRef.current.push(now);\n    setTapCount(tapsRef.current.length);\n\n    ripple(e);\n  }\n\n  function ripple(e: React.PointerEvent<HTMLDivElement>) {\n    const el = tapAreaRef.current;\n    if (!el) return;\n\n    const rect = el.getBoundingClientRect();\n    const circle = document.createElement(\"div\");\n    circle.style.position = \"absolute\";\n    circle.style.borderRadius = \"999px\";\n    circle.style.pointerEvents = \"none\";\n    circle.style.width = \"54px\";\n    circle.style.height = \"54px\";\n    circle.style.left = `${e.clientX - rect.left - 27}px`;\n    circle.style.top = `${e.clientY - rect.top - 27}px`;\n    circle.style.background = \"rgba(59,130,246,.20)\";\n    circle.style.transform = \"scale(0)\";\n    circle.style.transition = \"transform 420ms ease, opacity 420ms ease\";\n    el.appendChild(circle);\n\n    requestAnimationFrame(() => {\n      circle.style.transform = \"scale(5)\";\n      circle.style.opacity = \"0\";\n    });\n    setTimeout(() => circle.remove(), 450);\n  }\n\n  async function writeFTTEventDidNotSave() {\n    if (!userId) return;\n    try {\n      const { data, error } = await supabase\n        .from(\"ftt_events\")\n        .insert({ user_id: userId, did_save: false })\n        .select(\"id\")\n        .single();\n\n      if (error) {\n        console.error(\"[FTT events insert error]\", error);\n        return;\n      }\n      eventIdRef.current = data?.id ?? null;\n    } catch (e) {\n      console.error(\"[FTT events insert exception]\", e);\n    }\n  }\n\n  async function finish() {\n    setScreen(\"result\");\n\n    setIsActive(false);\n    isActiveRef.current = false;\n    clearTimer();\n\n    const taps = tapsRef.current;\n    const count = taps.length;\n\n    const intervals: number[] = [];\n    for (let i = 1; i < taps.length; i++) intervals.push(taps[i] - taps[i - 1]);\n\n    const sd = stddev(intervals);\n\n    setResultCount(count);\n    setResultSD(sd);\n    setResultIntervals(intervals);\n\n    const evaluated = await evaluateWithBaseline(count, sd);\n    setCondition(evaluated.condition);\n    setMessage(evaluated.message);\n\n    await writeFTTEventDidNotSave();\n  }\n\n  async function getBaselineOncePerDay(params: { minSamples: number; windowDays: number }) {\n    const { minSamples, windowDays } = params;\n    if (!userId) return { ok: false as const, reason: \"no_user\", sampleCount: 0 };\n\n    const todayYMD = getTodayJST();\n    const cacheKey = `${userId}:${todayYMD}`;\n    const cached = baselineCacheRef.current;\n\n    if (\n      cached &&\n      cached.key === cacheKey &&\n      cached.windowDays === windowDays &&\n      cached.minSamples === minSamples\n    ) {\n      if (cached.sampleCount < minSamples) {\n        return { ok: false as const, reason: \"not_enough_samples\", sampleCount: cached.sampleCount };\n      }\n      return {\n        ok: true as const,\n        baselineSpeed: cached.baselineSpeed,\n        baselineSD: cached.baselineSD,\n        sampleCount: cached.sampleCount,\n      };\n    }\n\n    const startYMD = getPastYMDJST(windowDays);\n\n    const { data, error } = await supabase\n      .from(\"ftt_records\")\n      .select(\"date,total_count,interval_sd_ms,measured_at\")\n      .eq(\"user_id\", userId)\n      .gte(\"date\", startYMD)\n      .order(\"measured_at\", { ascending: false })\n      .limit(200);\n\n    if (error) {\n      baselineCacheRef.current = {\n        key: cacheKey,\n        windowDays,\n        minSamples,\n        sampleCount: 0,\n        baselineSpeed: 0,\n        baselineSD: 0,\n        fetchedAt: Date.now(),\n      };\n      return { ok: false as const, reason: \"fetch_error\", sampleCount: 0 };\n    }\n\n    const rows = (data ?? []) as any[];\n    const valid = rows.filter((r) => {\n      const c = Number(r?.total_count);\n      const s = Number(r?.interval_sd_ms);\n      return Number.isFinite(c) && c > 0 && Number.isFinite(s) && s >= 0;\n    });\n\n    const sampleCount = valid.length;\n\n    if (sampleCount < minSamples) {\n      baselineCacheRef.current = {\n        key: cacheKey,\n        windowDays,\n        minSamples,\n        sampleCount,\n        baselineSpeed: 0,\n        baselineSD: 0,\n        fetchedAt: Date.now(),\n      };\n      return { ok: false as const, reason: \"not_enough_samples\", sampleCount };\n    }\n\n    const baselineSpeed = mean(valid.map((r) => Number(r.total_count)));\n    const baselineSD = mean(valid.map((r) => Number(r.interval_sd_ms)));\n\n    baselineCacheRef.current = {\n      key: cacheKey,\n      windowDays,\n      minSamples,\n      sampleCount,\n      baselineSpeed,\n      baselineSD,\n      fetchedAt: Date.now(),\n    };\n\n    return { ok: true as const, baselineSpeed, baselineSD, sampleCount };\n  }\n\n  async function evaluateWithBaseline(todayCount: number, todaySD: number) {\n    const minSamples = 5;\n    const windowDays = 30;\n    const speedDropRatio = 0.9;\n    const sdWorseRatio = 0.25;\n\n    if (!userId) return { condition: \"calibrating\" as const, message: \"\" };\n\n    const base = await getBaselineOncePerDay({ minSamples, windowDays });\n    if (!base.ok) {\n      if (base.reason === \"not_enough_samples\") {\n        return { condition: \"calibrating\" as const, message: \"\" };\n      }\n      return { condition: \"calibrating\" as const, message: \"\" };\n    }\n\n    const baselineSpeed = base.baselineSpeed;\n    const baselineSD = base.baselineSD;\n\n    const isSlow = todayCount < baselineSpeed * speedDropRatio;\n    const isUnstable = baselineSD > 0 ? todaySD > baselineSD * (1 + sdWorseRatio) : false;\n\n    if (isSlow && isUnstable) {\n      return { condition: \"stop\" as const, message: \"\" };\n    }\n    if (isUnstable) {\n      return { condition: \"danger\" as const, message: \"\" };\n    }\n    if (isSlow) {\n      return { condition: \"fatigue\" as const, message: \"\" };\n    }\n    return { condition: \"good\" as const, message: \"\" };\n  }\n\n  async function handleSave() {\n    if (saveBusy || didSave) return;\n    if (!userId) {\n      setSaveStatus(\"\");\n      return;\n    }\n\n    setSaveBusy(true);\n    setSaveStatus(\"\");\n\n    const jitter = Math.floor(Math.random() * 5000);\n    await sleep(jitter);\n\n    try {\n      setSaveStatus(\"\");\n\n      const date = getTodayJST();\n\n      const { error: recErr } = await supabase\n        .from(\"ftt_records\")\n        .upsert(\n          {\n            user_id: userId,\n            date,\n            duration_sec: Math.round(DURATION_MS / 1000),\n            total_count: resultCount,\n            interval_sd_ms: resultSD,\n            raw_intervals_ms: resultIntervals,\n            condition_result: condition,\n            meta: {\n              ua: typeof navigator !== \"undefined\" ? navigator.userAgent : null,\n              tz: Intl.DateTimeFormat().resolvedOptions().timeZone,\n              source: \"ftt_check\",\n            },\n          },\n          { onConflict: \"user_id,date\" }\n        );\n\n      if (recErr) {\n        console.error(\"[FTT records upsert error]\", recErr);\n        setSaveStatus(`: ${recErr.message}`);\n        setSaveBusy(false);\n        return;\n      }\n\n      const eventId = eventIdRef.current;\n      if (eventId) {\n        const { error: evErr } = await supabase\n          .from(\"ftt_events\")\n          .update({ did_save: true })\n          .eq(\"id\", eventId)\n          .eq(\"user_id\", userId);\n\n        if (evErr) console.error(\"[FTT events update error]\", evErr);\n      }\n\n      setDidSave(true);\n      setSaveStatus(\" \");\n      setSaveBusy(false);\n    } catch (e: any) {\n      console.error(\"[FTT save exception]\", e);\n      setSaveStatus(`: ${e?.message ?? \"unknown error\"}`);\n      setSaveBusy(false);\n    }\n  }\n\n  useEffect(() => {\n    return () => {\n      isActiveRef.current = false;\n      clearTimer();\n    };\n  }, []);\n\n  const headerSubtitle =\n    screen === \"standby\"\n      ? \"10\"\n      : screen === \"measure\"\n      ? \"\"\n      : \"\";\n\n  const TimeIcon = Timer;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900\">\n      <div className=\"mx-auto max-w-md px-4 py-8\">\n        <div className=\"mb-6\">\n          <div className=\"flex items-center justify-between gap-3\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center\">\n                <TimeIcon className=\"h-5 w-5 text-slate-700\" />\n              </div>\n              <div>\n                <div className=\"text-xl font-extrabold tracking-tight\">FTT Check</div>\n                <div className=\"text-sm text-slate-500\">{headerSubtitle}</div>\n              </div>\n            </div>\n\n            {onBackHome && (\n              <button\n                onClick={onBackHome}\n                className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\n              >\n                <ArrowLeft className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n            )}\n          </div>\n        </div>\n\n        <div className=\"rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden\">\n          <div className=\"px-5 py-4 border-b border-slate-100 flex items-center justify-between\">\n            <div className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n              <Timer className=\"h-4 w-4\" />\n              {screen === \"standby\" ? \"Standby\" : screen === \"measure\" ? \"Measuring\" : \"Result\"}\n            </div>\n            <div className=\"text-xs text-slate-400\">Bekuta</div>\n          </div>\n\n          <div className=\"p-5\">\n            {screen === \"standby\" && (\n              <div className=\"space-y-4\">\n                <div className=\"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4\">\n                  <ul className=\"space-y-2 text-sm text-slate-700\">\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700\">\n                        1\n                      </span>\n                      <span></span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700\">\n                        2\n                      </span>\n                      <span> 1</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 text-xs font-bold text-slate-700\">\n                        3\n                      </span>\n                      <span>10</span>\n                    </li>\n                  </ul>\n                </div>\n\n                <button\n                  onClick={start}\n                  className=\"w-full rounded-2xl bg-slate-900 text-white py-3.5 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition\"\n                >\n                  START\n                </button>\n\n                <div className=\"text-xs text-slate-500 leading-relaxed\">\n                   11RETRY\n                </div>\n              </div>\n            )}\n\n            {screen === \"measure\" && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-end justify-between\">\n                  <div>\n                    <div className=\"text-xs text-slate-500 font-semibold uppercase tracking-wider\">Remaining</div>\n                    <div className=\"text-4xl font-extrabold tracking-tight tabular-nums\">\n                      {(remainingMs / 1000).toFixed(2)}\n                    </div>\n                  </div>\n                  <div className=\"text-sm text-slate-600 font-semibold flex items-center gap-2\">\n                    <Hand className=\"h-4 w-4\" />\n                    TAPS <span className=\"font-extrabold tabular-nums\">{tapCount}</span>\n                  </div>\n                </div>\n\n                <div className=\"h-2 w-full rounded-full bg-slate-100 overflow-hidden ring-1 ring-slate-200\">\n                  <div\n                    className=\"h-full rounded-full bg-blue-500\"\n                    style={{ width: `${progress * 100}%`, transition: \"width 50ms linear\" }}\n                  />\n                </div>\n\n                <div\n                  ref={tapAreaRef}\n                  onPointerDown={handleTap}\n                  className=\"relative h-72 rounded-3xl bg-gradient-to-b from-slate-50 to-white ring-1 ring-slate-200 shadow-sm overflow-hidden select-none\"\n                  style={{\n                    touchAction: \"manipulation\",\n                    WebkitUserSelect: \"none\",\n                    WebkitTouchCallout: \"none\",\n                  }}\n                >\n                  <div className=\"absolute inset-0 pointer-events-none\">\n                    <div className=\"absolute -top-12 -right-12 h-40 w-40 rounded-full bg-blue-100/50 blur-2xl\" />\n                    <div className=\"absolute -bottom-16 -left-16 h-44 w-44 rounded-full bg-emerald-100/40 blur-2xl\" />\n                  </div>\n\n                  <div className=\"h-full flex flex-col items-center justify-center gap-3 select-none\">\n                    <div className=\"relative h-24 w-24 flex items-center justify-center\">\n                      <span className=\"absolute h-full w-full rounded-full border border-slate-300/40 animate-ftt-ripple\" />\n                      <span className=\"absolute h-full w-full rounded-full border border-slate-300/30 animate-ftt-ripple delay-300\" />\n                      <span className=\"absolute h-full w-full rounded-full border border-slate-300/20 animate-ftt-ripple delay-600\" />\n                      <span className=\"relative z-10 h-3 w-3 rounded-full bg-slate-800 shadow-[0_0_0_6px_rgba(15,23,42,0.08)]\" />\n                    </div>\n\n                    <div className=\"text-sm font-extrabold tracking-widest text-slate-800\">TAP FAST</div>\n                    <div className=\"text-xs text-slate-500\">1</div>\n                  </div>\n                </div>\n\n                <button\n                  onClick={() => {\n                    resetLocal();\n                    setScreen(\"standby\");\n                  }}\n                  className=\"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2\"\n                >\n                  <RotateCcw className=\"h-4 w-4\" />\n                  CANCEL\n                </button>\n              </div>\n            )}\n\n            {screen === \"result\" && (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div className=\"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4\">\n                    <div className=\"text-xs text-slate-500 font-semibold uppercase tracking-wider\">Speed (Total)</div>\n                    <div className=\"mt-1 text-3xl font-extrabold tabular-nums\">{resultCount}</div>\n                  </div>\n\n                  <div className=\"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4\">\n                    <div className=\"text-xs text-slate-500 font-semibold uppercase tracking-wider\">Stability (SD)</div>\n                    <div className=\"mt-1 text-3xl font-extrabold tabular-nums\">\n                      {resultSD.toFixed(1)}\n                      <span className=\"text-sm font-bold text-slate-500 ml-1\">ms</span>\n                    </div>\n                  </div>\n                </div>\n\n                {(() => {\n                  const meta = conditionLabel(condition);\n                  const Icon = meta.icon;\n                  return (\n                    <div className={`rounded-2xl px-4 py-3 ${conditionBadgeClass(condition)} flex items-center gap-3`}>\n                      <div className=\"h-9 w-9 rounded-xl bg-white/70 flex items-center justify-center\">\n                        <Icon className=\"h-5 w-5\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <div className=\"text-sm font-extrabold tracking-wide\">{meta.title}</div>\n                        <div className=\"text-xs opacity-80\">{meta.sub}</div>\n                      </div>\n                      <div className=\"text-xs font-bold opacity-80 tabular-nums\">intervals: {resultIntervals.length}</div>\n                    </div>\n                  );\n                })()}\n\n                <div className=\"text-sm text-slate-700 leading-relaxed\">{message}</div>\n\n                <button\n                  disabled={saveBusy || didSave}\n                  onClick={handleSave}\n                  className={[\n                    \"w-full rounded-2xl py-3.5 font-extrabold tracking-wide flex items-center justify-center gap-2 transition active:scale-[0.99]\",\n                    didSave\n                      ? \"bg-emerald-600 text-white\"\n                      : saveBusy\n                      ? \"bg-slate-200 text-slate-600 cursor-not-allowed\"\n                      : \"bg-blue-600 text-white hover:bg-blue-500\",\n                  ].join(\" \")}\n                >\n                  <Save className=\"h-4 w-4\" />\n                  {didSave ? \"SAVED \" : saveBusy ? \"SAVING...\" : \"SAVE DATA\"}\n                </button>\n\n                <div\n                  className={[\n                    \"min-h-[18px] text-xs text-center\",\n                    didSave ? \"text-emerald-700\" : saveStatus.includes(\"\") ? \"text-rose-700\" : \"text-slate-500\",\n                  ].join(\" \")}\n                >\n                  {saveStatus}\n                </div>\n\n                <div className=\"text-xs text-slate-500 leading-relaxed\">\n                   ftt_events\n                  ftt_records\n                </div>\n\n                <button\n                  onClick={() => {\n                    resetLocal();\n                    setScreen(\"standby\");\n                  }}\n                  className=\"w-full rounded-2xl bg-white ring-1 ring-slate-200 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition flex items-center justify-center gap-2\"\n                >\n                  <RotateCcw className=\"h-4 w-4\" />\n                  RETRY\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"mt-6 text-center text-xs text-slate-400\">fast & steady </div>\n      </div>\n    </div>\n  );\n}","// src/components/views/AthleteGamificationView.tsx\nimport React, { Suspense, lazy } from \"react\";\nimport type { Database } from \"../../lib/database.types\";\n\nconst GamificationView = lazy(() =>\n  import(\"../../components/GamificationView\").then((m) => ({\n    default: m.GamificationView,\n  }))\n);\n\ntype UserProfile = Database[\"public\"][\"Tables\"][\"users\"][\"Row\"];\n\ntype Props = {\n  user: UserProfile;\n  onBackHome?: () => void;\n};\n\nexport function AthleteGamificationView({ user }: Props) {\n  return (\n    <Suspense\n      fallback={\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n        </div>\n      }\n    >\n      <GamificationView\n        userId={user.id}\n        userTeamId={user.team_id}\n      />\n    </Suspense>\n  );\n}","import React, { useState } from 'react';\nimport {\n  Calendar,\n  Droplets,\n  AlertCircle,\n  Zap,\n  Cloud,\n  Battery,\n  Brain,\n  Wind,\n  Heart,\n  Sparkles,\n  Target,\n} from 'lucide-react';\nimport { useMenstrualCycleData } from '../hooks/useMenstrualCycleData';\nimport { Toast } from './ui/Toast'; //  \n\ninterface MenstrualCycleFormProps {\n  userId: string;\n  onSuccess?: () => void;\n}\n\nconst SYMPTOM_OPTIONS = [\n  { value: 'cramps', label: '', icon: Zap },\n  { value: 'mood_changes', label: '', icon: Cloud },\n  { value: 'fatigue', label: '', icon: Battery },\n  { value: 'headache', label: '', icon: Brain },\n  { value: 'bloating', label: '', icon: Wind },\n  { value: 'breast_tenderness', label: '', icon: Heart },\n  { value: 'acne', label: '', icon: Sparkles },\n  { value: 'back_pain', label: '', icon: Target },\n];\n\nexport function MenstrualCycleForm({ userId, onSuccess }: MenstrualCycleFormProps) {\n  const { addCycle } = useMenstrualCycleData(userId);\n\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  //  Toast\n  const [toastOpen, setToastOpen] = useState(false);\n  const [toastType, setToastType] = useState<'success' | 'error'>('success');\n  const [toastMsg, setToastMsg] = useState('');\n\n  const showToast = (type: 'success' | 'error', msg: string) => {\n    setToastType(type);\n    setToastMsg(msg);\n    setToastOpen(true);\n  };\n\n  const [formData, setFormData] = useState({\n    cycle_start_date: '',\n    period_end_date: '',\n    flow_intensity: '' as 'light' | 'moderate' | 'heavy' | '',\n    symptoms: [] as string[],\n    notes: '',\n  });\n\n  const calcPeriodDurationDays = (start: string, end: string) => {\n    const periodStart = new Date(start);\n    const periodEnd = new Date(end);\n    const diffDays = Math.floor((periodEnd.getTime() - periodStart.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n    return diffDays;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (isSubmitting) return; //  \n\n    setIsSubmitting(true);\n    setError(null);\n\n    try {\n      //  HTML required \n      if (!formData.cycle_start_date) {\n        throw new Error('');\n      }\n\n      const cycleData: any = {\n        cycle_start_date: formData.cycle_start_date,\n        symptoms: formData.symptoms,\n      };\n\n      //  \n      if (formData.period_end_date) {\n        const days = calcPeriodDurationDays(formData.cycle_start_date, formData.period_end_date);\n        if (days <= 0) {\n          throw new Error('');\n        }\n        cycleData.period_duration_days = days;\n      }\n\n      if (formData.flow_intensity) {\n        cycleData.flow_intensity = formData.flow_intensity;\n      }\n\n      if (formData.notes) {\n        cycleData.notes = formData.notes;\n      }\n\n      await addCycle(cycleData);\n\n      //   + \n      setFormData({\n        cycle_start_date: '',\n        period_end_date: '',\n        flow_intensity: '',\n        symptoms: [],\n        notes: '',\n      });\n\n      showToast('success', ' ');\n\n      if (onSuccess) onSuccess();\n    } catch (err: any) {\n      const msg = err instanceof Error ? err.message : '';\n      setError(msg);\n      showToast('error', `${msg}`);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const toggleSymptom = (symptom: string) => {\n    setFormData((prev) => ({\n      ...prev,\n      symptoms: prev.symptoms.includes(symptom)\n        ? prev.symptoms.filter((s) => s !== symptom)\n        : [...prev.symptoms, symptom],\n    }));\n  };\n\n  const periodDuration =\n    formData.cycle_start_date && formData.period_end_date\n      ? calcPeriodDurationDays(formData.cycle_start_date, formData.period_end_date)\n      : null;\n\n  return (\n    <>\n      {/*  Toast */}\n      <Toast open={toastOpen} type={toastType} message={toastMsg} onClose={() => setToastOpen(false)} />\n\n      <form onSubmit={handleSubmit} className=\"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Droplets className=\"w-6 h-6 text-pink-600 dark:text-pink-400\" />\n          <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\"></h3>\n        </div>\n\n        {error && (\n          <div className=\"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg\">\n            <AlertCircle className=\"w-5 h-5\" />\n            <span>{error}</span>\n          </div>\n        )}\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              <Calendar className=\"inline w-4 h-4 mr-1\" />\n               *\n            </label>\n            <input\n              type=\"date\"\n              required\n              value={formData.cycle_start_date}\n              onChange={(e) => setFormData({ ...formData, cycle_start_date: e.target.value })}\n              disabled={isSubmitting}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              <Calendar className=\"inline w-4 h-4 mr-1\" />\n              \n            </label>\n            <input\n              type=\"date\"\n              value={formData.period_end_date}\n              min={formData.cycle_start_date || undefined}\n              onChange={(e) => setFormData({ ...formData, period_end_date: e.target.value })}\n              disabled={isSubmitting}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60\"\n            />\n            {periodDuration != null && (\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">: {periodDuration}</p>\n            )}\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n          <select\n            value={formData.flow_intensity}\n            onChange={(e) => setFormData({ ...formData, flow_intensity: e.target.value as any })}\n            disabled={isSubmitting}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60\"\n          >\n            <option value=\"\">...</option>\n            <option value=\"light\"></option>\n            <option value=\"moderate\"></option>\n            <option value=\"heavy\"></option>\n          </select>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n            {SYMPTOM_OPTIONS.map((symptom) => {\n              const Icon = symptom.icon;\n              const active = formData.symptoms.includes(symptom.value);\n\n              return (\n                <button\n                  key={symptom.value}\n                  type=\"button\"\n                  onClick={() => toggleSymptom(symptom.value)}\n                  disabled={isSubmitting}\n                  className={`px-3 py-2 text-sm rounded-lg border-2 transition-all flex items-center justify-center gap-1.5 disabled:opacity-60 disabled:cursor-not-allowed ${\n                    active\n                      ? 'border-pink-500 bg-pink-50 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300 scale-[1.02]'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-pink-300 dark:hover:border-pink-700 text-gray-700 dark:text-gray-300'\n                  }`}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  <span>{symptom.label}</span>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"></label>\n          <textarea\n            value={formData.notes}\n            onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n            rows={3}\n            disabled={isSubmitting}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:text-white disabled:opacity-60\"\n            placeholder=\"...\"\n          />\n        </div>\n\n        <button\n          type=\"submit\"\n          disabled={isSubmitting}\n          className=\"w-full py-3 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          {isSubmitting ? '...' : ''}\n        </button>\n      </form>\n    </>\n  );\n}","import { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport type { Database } from '../lib/database.types';\n\ntype BasalBodyTemperature = Database['public']['Tables']['basal_body_temperature']['Row'];\ntype BasalBodyTemperatureInsert = Database['public']['Tables']['basal_body_temperature']['Insert'];\ntype BasalBodyTemperatureUpdate = Database['public']['Tables']['basal_body_temperature']['Update'];\n\nexport function useBasalBodyTemperature(userId: string) {\n  const [temperatures, setTemperatures] = useState<BasalBodyTemperature[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchTemperatures();\n  }, [userId]);\n\n  const fetchTemperatures = async () => {\n    try {\n      setLoading(true);\n      const { data, error: fetchError } = await supabase\n        .from('basal_body_temperature')\n        .select('*')\n        .eq('user_id', userId)\n        .order('measurement_date', { ascending: false });\n\n      if (fetchError) throw fetchError;\n      setTemperatures(data || []);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch basal body temperature');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const addTemperature = async (temperature: Omit<BasalBodyTemperatureInsert, 'user_id'>) => {\n    try {\n      const { data: userData } = await supabase.auth.getUser();\n      if (!userData.user) throw new Error('User not authenticated');\n\n      const { data: userProfile } = await supabase\n        .from('users')\n        .select('team_id')\n        .eq('user_id', userData.user.id)\n        .maybeSingle();\n\n      let organizationId = null;\n      if (userProfile?.team_id) {\n        const { data: team } = await supabase\n          .from('teams')\n          .select('organization_id')\n          .eq('id', userProfile.team_id)\n          .maybeSingle();\n\n        organizationId = team?.organization_id || null;\n      }\n\n      const { data, error: insertError } = await supabase\n        .from('basal_body_temperature')\n        .insert({\n          ...temperature,\n          user_id: userId,\n          organization_id: organizationId,\n        })\n        .select()\n        .single();\n\n      if (insertError) throw insertError;\n      if (data) {\n        setTemperatures((prev) => [data, ...prev]);\n      }\n      return data;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to add basal body temperature');\n      throw err;\n    }\n  };\n\n  const updateTemperature = async (id: string, updates: BasalBodyTemperatureUpdate) => {\n    try {\n      const { data, error: updateError } = await supabase\n        .from('basal_body_temperature')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (updateError) throw updateError;\n      if (data) {\n        setTemperatures((prev) =>\n          prev.map((temp) => (temp.id === id ? data : temp))\n        );\n      }\n      return data;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update basal body temperature');\n      throw err;\n    }\n  };\n\n  const deleteTemperature = async (id: string) => {\n    try {\n      const { error: deleteError } = await supabase\n        .from('basal_body_temperature')\n        .delete()\n        .eq('id', id);\n\n      if (deleteError) throw deleteError;\n      setTemperatures((prev) => prev.filter((temp) => temp.id !== id));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete basal body temperature');\n      throw err;\n    }\n  };\n\n  const getTemperatureTrend = (days: number = 7): 'rising' | 'falling' | 'stable' => {\n    const recentTemps = temperatures\n      .slice(0, days)\n      .sort((a, b) => new Date(a.measurement_date).getTime() - new Date(b.measurement_date).getTime());\n\n    if (recentTemps.length < 3) return 'stable';\n\n    const firstHalf = recentTemps.slice(0, Math.floor(recentTemps.length / 2));\n    const secondHalf = recentTemps.slice(Math.floor(recentTemps.length / 2));\n\n    const firstAvg = firstHalf.reduce((sum, t) => sum + Number(t.temperature_celsius), 0) / firstHalf.length;\n    const secondAvg = secondHalf.reduce((sum, t) => sum + Number(t.temperature_celsius), 0) / secondHalf.length;\n\n    const diff = secondAvg - firstAvg;\n    if (diff > 0.1) return 'rising';\n    if (diff < -0.1) return 'falling';\n    return 'stable';\n  };\n\n  const getAverageTemperature = (days: number = 7): number | null => {\n    const recentTemps = temperatures.slice(0, days);\n    if (recentTemps.length === 0) return null;\n\n    const sum = recentTemps.reduce((acc, temp) => acc + Number(temp.temperature_celsius), 0);\n    return sum / recentTemps.length;\n  };\n\n  return {\n    temperatures,\n    loading,\n    error,\n    addTemperature,\n    updateTemperature,\n    deleteTemperature,\n    getTemperatureTrend,\n    getAverageTemperature,\n    refetch: fetchTemperatures,\n  };\n}\n","import React, { useState } from 'react';\nimport { Thermometer, Calendar, Clock, AlertCircle } from 'lucide-react';\nimport { useBasalBodyTemperature } from '../hooks/useBasalBodyTemperature';\nimport { getTodayJSTString } from '../lib/date';\n\ninterface BasalBodyTemperatureFormProps {\n  userId: string;\n  onSuccess?: () => void;\n}\n\nexport function BasalBodyTemperatureForm({ userId, onSuccess }: BasalBodyTemperatureFormProps) {\n  const { addTemperature } = useBasalBodyTemperature(userId);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const today = getTodayJSTString();\n  const currentTime = new Date().toTimeString().slice(0, 5);\n\n  const [formData, setFormData] = useState({\n    measurement_date: today,\n    temperature_celsius: '',\n    measurement_time: currentTime,\n    notes: '',\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    setError(null);\n\n    try {\n      const temperatureData: any = {\n        measurement_date: formData.measurement_date,\n        temperature_celsius: parseFloat(formData.temperature_celsius),\n      };\n\n      if (formData.measurement_time) {\n        temperatureData.measurement_time = formData.measurement_time;\n      }\n\n      if (formData.notes) {\n        temperatureData.notes = formData.notes;\n      }\n\n      await addTemperature(temperatureData);\n\n      setFormData({\n        measurement_date: today,\n        temperature_celsius: '',\n        measurement_time: currentTime,\n        notes: '',\n      });\n\n      if (onSuccess) onSuccess();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Thermometer className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\"></h3>\n      </div>\n\n      {error && (\n        <div className=\"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 rounded-lg\">\n          <AlertCircle className=\"w-5 h-5\" />\n          <span>{error}</span>\n        </div>\n      )}\n\n      <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg\">\n        <p className=\"text-sm text-blue-800 dark:text-blue-200\">\n          <strong>:</strong> \n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            <Calendar className=\"inline w-4 h-4 mr-1\" />\n             *\n          </label>\n          <input\n            type=\"date\"\n            required\n            value={formData.measurement_date}\n            max={today}\n            onChange={(e) => setFormData({ ...formData, measurement_date: e.target.value })}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            <Clock className=\"inline w-4 h-4 mr-1\" />\n            \n          </label>\n          <input\n            type=\"time\"\n            value={formData.measurement_time}\n            onChange={(e) => setFormData({ ...formData, measurement_time: e.target.value })}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n          />\n        </div>\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          <Thermometer className=\"inline w-4 h-4 mr-1\" />\n           *\n        </label>\n        <input\n          type=\"number\"\n          step=\"0.01\"\n          min=\"35.0\"\n          max=\"42.0\"\n          required\n          value={formData.temperature_celsius}\n          onChange={(e) => setFormData({ ...formData, temperature_celsius: e.target.value })}\n          placeholder=\": 36.5\"\n          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n        />\n        <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n          : 36.1 - 37.0\n        </p>\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          \n        </label>\n        <textarea\n          value={formData.notes}\n          onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n          rows={3}\n          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n          placeholder=\"...\"\n        />\n      </div>\n\n      <button\n        type=\"submit\"\n        disabled={isSubmitting}\n        className=\"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n      >\n        {isSubmitting ? '...' : ''}\n      </button>\n    </form>\n  );\n}\n","import React from 'react';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } from 'recharts';\nimport { Droplets } from 'lucide-react';\nimport { useMenstrualCycleData } from '../hooks/useMenstrualCycleData';\nimport { useBasalBodyTemperature } from '../hooks/useBasalBodyTemperature';\nimport { toJSTDateString } from '../lib/date';\nimport { formatDateJST } from '../lib/date'; // \n\ninterface MenstrualCycleChartProps {\n  userId: string;\n  days?: number;\n}\n\nexport function MenstrualCycleChart({ userId, days = 90 }: MenstrualCycleChartProps) {\n  const { cycles, getCurrentCyclePhase } = useMenstrualCycleData(userId);\n  const { temperatures } = useBasalBodyTemperature(userId);\n\n  const currentPhase = getCurrentCyclePhase();\n\n  const getDataForChart = () => {\n    const today = new Date();\n    const startDate = new Date(today);\n    startDate.setDate(startDate.getDate() - days);\n\n    const dataMap = new Map<string, any>();\n\n    for (let d = new Date(startDate); d <= today; d.setDate(d.getDate() + 1)) {\n      const dateStr = formatDateJST(d);\n    \n      dataMap.set(dateStr, {\n        date: dateStr,\n        displayDate: `${d.getMonth() + 1}/${d.getDate()}`,\n        temperature: null,\n        cyclePhase: null,\n      });\n    } \n\n    temperatures.forEach((temp) => {\n      const entry = dataMap.get(temp.measurement_date);\n      if (entry) {\n        entry.temperature = Number(temp.temperature_celsius);\n      }\n    });\n\n    cycles.forEach((cycle) => {\n      const start = new Date(cycle.cycle_start_date);\n      const end = cycle.cycle_end_date ? new Date(cycle.cycle_end_date) : today;\n\n      \n\n      for (let d = new Date(start); d <= end && d <= today; d.setDate(d.getDate() + 1)) {\n        const dateStr = formatDateJST(d);\n        const entry = dataMap.get(dateStr);\n\n        if (entry) {\n          const phase = cycles.find((c) => {\n            //  JST \n            const cycleStart = new Date(c.cycle_start_date + 'T00:00:00');\n            const cycleEnd = c.cycle_end_date\n              ? new Date(c.cycle_end_date + 'T00:00:00')\n              : today;\n\n            return d >= cycleStart && d <= cycleEnd;\n          });\n\n          if (phase) {\n            entry.cyclePhase = 1;\n          }\n        }\n      }\n    });\n\n    return Array.from(dataMap.values());\n  };\n\n  const chartData = getDataForChart();\n\n  const getPhaseColor = (phase: string) => {\n    switch (phase) {\n      case 'menstrual':\n        return 'text-red-600 dark:text-red-400';\n      case 'follicular':\n        return 'text-green-600 dark:text-green-400';\n      case 'ovulatory':\n        return 'text-yellow-600 dark:text-yellow-400';\n      case 'luteal':\n        return 'text-blue-600 dark:text-blue-400';\n      default:\n        return 'text-gray-600 dark:text-gray-400';\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center gap-2\">\n          <Droplets className=\"w-6 h-6 text-pink-600 dark:text-pink-400\" />\n          <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n            \n          </h3>\n        </div>\n        {currentPhase && (\n          <div className=\"text-sm\">\n            <span className=\"text-gray-600 dark:text-gray-400\">: </span>\n            <span className={`font-semibold capitalize ${getPhaseColor(currentPhase.phase)}`}>\n              {currentPhase.phase}\n            </span>\n          </div>\n        )}\n      </div>\n\n      <ResponsiveContainer width=\"100%\" height={400}>\n        <LineChart data={chartData}>\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" opacity={0.1} />\n          <XAxis\n            dataKey=\"displayDate\"\n            stroke=\"#6B7280\"\n            style={{ fontSize: '12px' }}\n          />\n          <YAxis\n            yAxisId=\"temp\"\n            domain={[35.5, 37.5]}\n            stroke=\"#3B82F6\"\n            style={{ fontSize: '12px' }}\n            label={{ value: '', angle: -90, position: 'insideLeft' }}\n          />\n          <YAxis\n            yAxisId=\"cycle\"\n            orientation=\"right\"\n            domain={[0, 1]}\n            ticks={[0, 1]}\n            stroke=\"#EC4899\"\n            style={{ fontSize: '12px' }}\n            label={{ value: '', angle: 90, position: 'insideRight' }}\n          />\n          <Tooltip\n            contentStyle={{\n              backgroundColor: '#1F2937',\n              border: 'none',\n              borderRadius: '8px',\n              color: '#F3F4F6',\n            }}\n            formatter={(value: any, name: string) => {\n              if (name === 'temperature') {\n                return [value ? `${value.toFixed(2)}` : '', ''];\n              }\n              if (name === 'cyclePhase') {\n                return [value ? '' : '', ''];\n              }\n              return [value, name];\n            }}\n          />\n          <Legend />\n          <ReferenceLine yAxisId=\"temp\" y={36.5} stroke=\"#6B7280\" strokeDasharray=\"3 3\" />\n          <Line\n            yAxisId=\"temp\"\n            type=\"monotone\"\n            dataKey=\"temperature\"\n            stroke=\"#3B82F6\"\n            strokeWidth={2}\n            dot={{ fill: '#3B82F6', r: 3 }}\n            connectNulls\n            name=\"\"\n          />\n          <Line\n            yAxisId=\"cycle\"\n            type=\"stepAfter\"\n            dataKey=\"cyclePhase\"\n            stroke=\"#EC4899\"\n            strokeWidth={2}\n            dot={false}\n            name=\"\"\n          />\n        </LineChart>\n      </ResponsiveContainer>\n\n      <div className=\"mt-4 grid grid-cols-2 md:grid-cols-4 gap-3 text-sm\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-3 h-3 rounded-full bg-red-500\"></div>\n          <span className=\"text-gray-700 dark:text-gray-300\"></span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-3 h-3 rounded-full bg-green-500\"></div>\n          <span className=\"text-gray-700 dark:text-gray-300\"></span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-3 h-3 rounded-full bg-yellow-500\"></div>\n          <span className=\"text-gray-700 dark:text-gray-300\"></span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-3 h-3 rounded-full bg-blue-500\"></div>\n          <span className=\"text-gray-700 dark:text-gray-300\"></span>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { Calendar, ChevronLeft, ChevronRight, TrendingUp, AlertTriangle, Info } from 'lucide-react';\nimport { useMenstrualCycleData } from '../hooks/useMenstrualCycleData';\n\ninterface MenstrualCycleCalendarProps {\n  userId: string;\n}\n\ninterface CyclePhaseInfo {\n  phase: 'menstrual' | 'follicular' | 'ovulatory' | 'luteal' | null;\n  day: number;\n  isHighPerformance: boolean;\n  isInjuryRisk: boolean;\n}\n\nexport function MenstrualCycleCalendar({ userId }: MenstrualCycleCalendarProps) {\n  const { cycles, getCurrentCyclePhase } = useMenstrualCycleData(userId);\n  const [currentMonth, setCurrentMonth] = useState(new Date());\n\n  const currentPhase = getCurrentCyclePhase();\n\n  // 0:00\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  let currentDayInCycle: number | null = null;\n  if (currentPhase) {\n    const cycleStart = new Date(currentPhase.cycle.cycle_start_date);\n    cycleStart.setHours(0, 0, 0, 0);\n    currentDayInCycle =\n      Math.floor((today.getTime() - cycleStart.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n  }\n\n  const getCyclePhaseForDate = (date: Date): CyclePhaseInfo => {\n    for (const cycle of cycles) {\n      const cycleStart = new Date(cycle.cycle_start_date);\n      const cycleEnd = cycle.cycle_end_date ? new Date(cycle.cycle_end_date) : new Date();\n\n      if (date >= cycleStart && date <= cycleEnd) {\n        const dayInCycle = Math.floor(\n          (date.getTime() - cycleStart.getTime()) / (1000 * 60 * 60 * 24)\n        ) + 1;\n\n        let phase: CyclePhaseInfo['phase'] = null;\n        let isHighPerformance = false;\n        let isInjuryRisk = false;\n\n        if (dayInCycle >= 1 && dayInCycle <= 5) {\n          phase = 'menstrual';\n          isInjuryRisk = true;\n        } else if (dayInCycle >= 6 && dayInCycle <= 13) {\n          phase = 'follicular';\n          isHighPerformance = true;\n        } else if (dayInCycle >= 14 && dayInCycle <= 16) {\n          phase = 'ovulatory';\n          isHighPerformance = true;\n        } else if (dayInCycle >= 17 && dayInCycle <= 28) {\n          phase = 'luteal';\n          isInjuryRisk = true;\n        }\n\n        return { phase, day: dayInCycle, isHighPerformance, isInjuryRisk };\n      }\n    }\n\n    return { phase: null, day: 0, isHighPerformance: false, isInjuryRisk: false };\n  };\n\n  const predictNextCycle = (): { start: Date; end: Date } | null => {\n    if (cycles.length === 0) return null;\n\n    const sortedCycles = [...cycles].sort(\n      (a, b) =>\n        new Date(b.cycle_start_date).getTime() - new Date(a.cycle_start_date).getTime()\n    );\n\n    const lastCycle = sortedCycles[0];\n    if (!lastCycle.cycle_end_date) return null;\n\n    const avgCycleLength =\n      sortedCycles.reduce((sum, cycle) => {\n        if (!cycle.cycle_end_date) return sum;\n        const start = new Date(cycle.cycle_start_date);\n        const end = new Date(cycle.cycle_end_date);\n        return (\n          sum +\n          Math.floor((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24))\n        );\n      }, 0) / sortedCycles.filter((c) => c.cycle_end_date).length;\n\n    const lastEnd = new Date(lastCycle.cycle_end_date);\n    const predictedStart = new Date(lastEnd);\n    predictedStart.setDate(predictedStart.getDate() + 1);\n\n    const predictedEnd = new Date(predictedStart);\n    predictedEnd.setDate(predictedEnd.getDate() + Math.round(avgCycleLength));\n\n    return { start: predictedStart, end: predictedEnd };\n  };\n\n  const getCalendarDays = () => {\n    const year = currentMonth.getFullYear();\n    const month = currentMonth.getMonth();\n\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n\n    const startDate = new Date(firstDay);\n    startDate.setDate(startDate.getDate() - firstDay.getDay());\n\n    const days: Date[] = [];\n    const current = new Date(startDate);\n\n    while (current <= lastDay || current.getDay() !== 0) {\n      days.push(new Date(current));\n      current.setDate(current.getDate() + 1);\n    }\n\n    return days;\n  };\n\n  const calendarDays = getCalendarDays();\n  const prediction = predictNextCycle();\n\n  const getPhaseColor = (phase: CyclePhaseInfo['phase']) => {\n    switch (phase) {\n      case 'menstrual':\n        return 'bg-red-100 dark:bg-red-900/30 border-red-400 dark:border-red-600';\n      case 'follicular':\n        return 'bg-green-100 dark:bg-green-900/30 border-green-400 dark:border-green-600';\n      case 'ovulatory':\n        return 'bg-yellow-100 dark:bg-yellow-900/30 border-yellow-400 dark:border-yellow-600';\n      case 'luteal':\n        return 'bg-blue-100 dark:bg-blue-900/30 border-blue-400 dark:border-blue-600';\n      default:\n        return 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700';\n    }\n  };\n\n  const getPhaseLabel = (phase: CyclePhaseInfo['phase']) => {\n    switch (phase) {\n      case 'menstrual':\n        return '';\n      case 'follicular':\n        return '';\n      case 'ovulatory':\n        return '';\n      case 'luteal':\n        return '';\n      default:\n        return '';\n    }\n  };\n\n  const isPredictedDate = (date: Date) => {\n    if (!prediction) return false;\n    return date >= prediction.start && date <= prediction.end;\n  };\n\n  const nextMonth = () => {\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1));\n  };\n\n  const prevMonth = () => {\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1));\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transition-colors\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center gap-3\">\n          <Calendar className=\"w-6 h-6 text-pink-600 dark:text-pink-400\" />\n          <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n            \n          </h3>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={prevMonth}\n            className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n          >\n            <ChevronLeft className=\"w-5 h-5 text-gray-600 dark:text-gray-400\" />\n          </button>\n          <span className=\"text-lg font-semibold text-gray-900 dark:text-white min-w-[120px] text-center\">\n            {currentMonth.getFullYear()} {currentMonth.getMonth() + 1}\n          </span>\n          <button\n            onClick={nextMonth}\n            className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n          >\n            <ChevronRight className=\"w-5 h-5 text-gray-600 dark:text-gray-400\" />\n          </button>\n        </div>\n      </div>\n\n      {currentPhase && (\n        <div className=\"mb-6 p-4 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-lg border border-pink-200 dark:border-pink-800\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {getPhaseLabel(currentPhase.phase as any)} - \n                {currentDayInCycle ?? '-'}\n              </p>\n            </div>\n            {currentPhase.phase === 'follicular' || currentPhase.phase === 'ovulatory' ? (\n              <div className=\"flex items-center gap-2 text-green-600 dark:text-green-400\">\n                <TrendingUp className=\"w-5 h-5\" />\n                <span className=\"text-sm font-medium\"></span>\n              </div>\n            ) : currentPhase.phase === 'luteal' || currentPhase.phase === 'menstrual' ? (\n              <div className=\"flex items-center gap-2 text-orange-600 dark:text-orange-400\">\n                <AlertTriangle className=\"w-5 h-5\" />\n                <span className=\"text-sm font-medium\"></span>\n              </div>\n            ) : null}\n          </div>\n        </div>\n      )}\n\n      {prediction && (\n        <div className=\"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n          <div className=\"flex items-start gap-2\">\n            <Info className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5\" />\n            <div>\n              <p className=\"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1\">\n                \n              </p>\n              <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                {prediction.start.getMonth() + 1}{prediction.start.getDate()} -{' '}\n                {prediction.end.getMonth() + 1}{prediction.end.getDate()}\n                \n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-7 gap-1 mb-2\">\n        {['', '', '', '', '', '', ''].map((day, idx) => (\n          <div\n            key={day}\n            className={`text-center text-sm font-semibold py-2 ${\n              idx === 0\n                ? 'text-red-600 dark:text-red-400'\n                : idx === 6\n                ? 'text-blue-600 dark:text-blue-400'\n                : 'text-gray-600 dark:text-gray-400'\n            }`}\n          >\n            {day}\n          </div>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-7 gap-1\">\n        {calendarDays.map((day, idx) => {\n          const phaseInfo = getCyclePhaseForDate(day);\n          const isPredicted = isPredictedDate(day);\n          const isToday = day.getTime() === today.getTime();\n          const isCurrentMonth = day.getMonth() === currentMonth.getMonth();\n\n          return (\n            <div\n              key={idx}\n              className={`\n                relative aspect-square p-1 border rounded-lg transition-all\n                ${getPhaseColor(phaseInfo.phase)}\n                ${isPredicted ? 'border-dashed border-2' : 'border'}\n                ${!isCurrentMonth ? 'opacity-40' : ''}\n                ${isToday ? 'ring-2 ring-purple-500 dark:ring-purple-400' : ''}\n              `}\n            >\n              <div className=\"flex flex-col items-center justify-center h-full\">\n                <span\n                  className={`text-sm font-medium ${\n                    isToday\n                      ? 'text-purple-700 dark:text-purple-300 font-bold'\n                      : phaseInfo.phase\n                      ? 'text-gray-900 dark:text-white'\n                      : 'text-gray-600 dark:text-gray-400'\n                  }`}\n                >\n                  {day.getDate()}\n                </span>\n\n                {phaseInfo.phase && (\n                  <div className=\"flex gap-0.5 mt-1\">\n                    {phaseInfo.isHighPerformance && (\n                      <TrendingUp className=\"w-3 h-3 text-green-600 dark:text-green-400\" />\n                    )}\n                    {phaseInfo.isInjuryRisk && (\n                      <AlertTriangle className=\"w-3 h-3 text-orange-600 dark:text-orange-400\" />\n                    )}\n                  </div>\n                )}\n\n                {isPredicted && !phaseInfo.phase && (\n                  <span className=\"text-xs text-blue-600 dark:text-blue-400 font-medium mt-1\">\n                    \n                  </span>\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-3\">\n            \n          </h4>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-600\"></div>\n            <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n              1-5\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded bg-green-100 dark:bg-green-900/30 border border-green-400 dark:border-green-600\"></div>\n            <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n              6-13\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600\"></div>\n            <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n              14-16\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded bg-blue-100 dark:bg-blue-900/30 border border-blue-400 dark:border-blue-600\"></div>\n            <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n              17-28\n            </span>\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-3\">\n            \n          </h4>\n          <div className=\"flex items-start gap-2 bg-green-50 dark:bg-green-900/20 p-2 rounded\">\n            <TrendingUp className=\"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5\" />\n            <div className=\"text-xs text-green-800 dark:text-green-200\">\n              <p className=\"font-medium mb-1\"></p>\n              <p></p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-2 bg-orange-50 dark:bg-orange-900/20 p-2 rounded\">\n            <AlertTriangle className=\"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5\" />\n            <div className=\"text-xs text-orange-800 dark:text-orange-200\">\n              <p className=\"font-medium mb-1\"></p>\n              <p></p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","import { useState, useEffect } from 'react';\nimport {\n  supabase,\n  PerformanceCategory,\n  PerformanceTestType,\n  PerformanceRecord\n} from '../lib/supabase';\n\nexport interface PerformanceRecordWithTest extends PerformanceRecord {\n  test_type?: PerformanceTestType;\n}\n\nexport interface PersonalBest {\n  test_type_id: string;\n  test_name: string;\n  test_display_name: string;\n  value: number;\n  date: string;\n  record: PerformanceRecord;\n}\n\n/**\n * usePerformanceData\n * @param userId string\n * @param categoryName string | undefined\n * @param updateGoalFromLatestTest optional callback (testTypeId: string) => Promise<void>\n */\nexport function usePerformanceData(\n  userId: string,\n  categoryName?: string,\n  updateGoalFromLatestTest?: (testTypeId: string) => Promise<void>\n) {\n  const [categories, setCategories] = useState<PerformanceCategory[]>([]);\n  const [testTypes, setTestTypes] = useState<PerformanceTestType[]>([]);\n  const [records, setRecords] = useState<PerformanceRecordWithTest[]>([]);\n  const [personalBests, setPersonalBests] = useState<PersonalBest[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  /* --------------------------\n   * Initial fetch\n   * -------------------------- */\n  useEffect(() => {\n    fetchCategories();\n  }, []);\n\n  useEffect(() => {\n    fetchTestTypes();\n  }, [categoryName]);\n\n  useEffect(() => {\n    if (userId) {\n      fetchRecords();\n    }\n  }, [userId, categoryName]);\n\n  /* --------------------------\n   * Fetch: Categories\n   * -------------------------- */\n  const fetchCategories = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('performance_categories')\n        .select('*')\n        .eq('is_active', true)\n        .order('sort_order');\n\n      if (error) throw error;\n      setCategories(data || []);\n    } catch (err) {\n      console.error('Error fetching categories:', err);\n      setError('');\n    }\n  };\n\n  /* --------------------------\n   * Fetch: Test Types\n   * -------------------------- */\n  const fetchTestTypes = async () => {\n    try {\n      let query = supabase\n        .from('performance_test_types')\n        .select(\n          `\n          *,\n          performance_categories:category_id (\n            id,\n            name,\n            display_name\n          )\n        `\n        )\n        .eq('is_active', true);\n\n      if (categoryName) {\n        const { data: cat } = await supabase\n          .from('performance_categories')\n          .select('id')\n          .eq('name', categoryName)\n          .single();\n\n        if (cat) query = query.eq('category_id', cat.id);\n      }\n\n      const { data, error } = await query.order('sort_order');\n      if (error) throw error;\n\n      setTestTypes(data || []);\n    } catch (err) {\n      console.error('Error fetching test types:', err);\n      setError('');\n    }\n  };\n\n  /* --------------------------\n   * Fetch: Records\n   * -------------------------- */\n  const fetchRecords = async () => {\n    try {\n      setLoading(true);\n\n      let query = supabase\n        .from('performance_records')\n        .select(\n          `\n          *,\n          performance_test_types:test_type_id (\n            id,\n            category_id,\n            name,\n            display_name,\n            description,\n            unit,\n            higher_is_better,\n            fields,\n            sort_order,\n            is_active,\n            created_at\n          )\n      `\n        )\n        .eq('user_id', userId)\n        .order('date', { ascending: false });\n\n      if (categoryName) {\n        const { data: cat } = await supabase\n          .from('performance_categories')\n          .select('id')\n          .eq('name', categoryName)\n          .maybeSingle();\n\n        if (cat) {\n          const { data: testList } = await supabase\n            .from('performance_test_types')\n            .select('id')\n            .eq('category_id', cat.id);\n\n          if (testList && testList.length > 0) {\n            query = query.in(\n              'test_type_id',\n              testList.map(t => t.id)\n            );\n          }\n        }\n      }\n\n      const { data, error } = await query;\n      if (error) throw error;\n\n      const mapped = (data || []).map(r => ({\n        ...r,\n        test_type: r.performance_test_types as PerformanceTestType\n      }));\n\n      setRecords(mapped);\n      calculatePersonalBests(mapped);\n    } catch (err) {\n      console.error('Error fetching records:', err);\n      setError('');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /* --------------------------\n   * Calculate PB\n   * -------------------------- */\n  const calculatePersonalBests = (allRecords: PerformanceRecordWithTest[]) => {\n    const bestByTest = new Map<string, PersonalBest>();\n\n    allRecords.forEach(record => {\n      if (!record.test_type) return;\n\n      const raw = record.values.primary_value;\n      const value = typeof raw === 'string' ? parseFloat(raw) : raw;\n      if (value === null || value === undefined || isNaN(value)) return;\n\n      const existing = bestByTest.get(record.test_type_id);\n      const better =\n        !existing ||\n        (record.test_type.higher_is_better\n          ? value > existing.value\n          : value < existing.value);\n\n      if (better) {\n        bestByTest.set(record.test_type_id, {\n          test_type_id: record.test_type_id,\n          test_name: record.test_type.name,\n          test_display_name: record.test_type.display_name,\n          value,\n          date: record.date,\n          record\n        });\n      }\n    });\n\n    setPersonalBests(Array.from(bestByTest.values()));\n  };\n\n  const checkExistingRecord = async (\n    testTypeId: string,\n    date: string\n  ): Promise<PerformanceRecordWithTest | null> => {\n    try {\n      const { data, error } = await supabase\n        .from('performance_records')\n        .select(\n          `\n          *,\n          performance_test_types:test_type_id (\n            id,\n            name,\n            display_name,\n            unit,\n            higher_is_better,\n            fields\n          )\n        `\n        )\n        .eq('user_id', userId)\n        .eq('test_type_id', testTypeId)\n        .eq('date', date)\n        .maybeSingle();\n  \n      if (error) throw error;\n  \n      if (data) {\n        return {\n          ...data,\n          test_type: data.performance_test_types as PerformanceTestType\n        };\n      }\n  \n      return null;\n    } catch (err) {\n      console.error('Error checking existing record:', err);\n      return null;\n    }\n  };\n\n  /* --------------------------\n   * Add Record\n   * -------------------------- */\n  const addRecord = async (recordData: {\n    test_type_id: string;\n    date: string;\n    values: Record<string, any>;\n    notes?: string;\n    is_official?: boolean;\n    weather_conditions?: string;\n  }) => {\n    try {\n      const { data, error } = await supabase\n        .from('performance_records')\n        .insert([\n          {\n            user_id: userId,\n            ...recordData\n          }\n        ])\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // 1) \n      await fetchRecords();\n\n      // 2) \n      if (updateGoalFromLatestTest) {\n        await updateGoalFromLatestTest(recordData.test_type_id);\n      }\n\n      // 3) PB \n      const tt = testTypes.find(t => t.id === recordData.test_type_id);\n      const newValue = recordData.values.primary_value;\n\n      const isNewPB =\n        tt && checkIfPersonalBest(recordData.test_type_id, newValue, tt.higher_is_better);\n\n      return { data, isNewPersonalBest: isNewPB ?? false };\n    } catch (err) {\n      console.error('Error adding record:', err);\n      throw err;\n    }\n  };\n\n  /* --------------------------\n   * Update Record\n   * -------------------------- */\n  const updateRecord = async (\n    recordId: string,\n    updates: {\n      date?: string;\n      values?: Record<string, any>;\n      notes?: string;\n      is_official?: boolean;\n      weather_conditions?: string;\n    }\n  ) => {\n    try {\n      const { data, error } = await supabase\n        .from('performance_records')\n        .update(updates)\n        .eq('id', recordId)\n        .eq('user_id', userId)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      await fetchRecords();\n      return data;\n    } catch (err) {\n      console.error('Error updating record:', err);\n      throw err;\n    }\n  };\n\n  /* --------------------------\n   * Delete Record\n   * -------------------------- */\n  const deleteRecord = async (recordId: string) => {\n    try {\n      const { error } = await supabase\n        .from('performance_records')\n        .delete()\n        .eq('id', recordId)\n        .eq('user_id', userId);\n\n      if (error) throw error;\n\n      await fetchRecords();\n    } catch (err) {\n      console.error('Error deleting record:', err);\n      throw err;\n    }\n  };\n\n  /* --------------------------\n   * Utils\n   * -------------------------- */\n  const checkIfPersonalBest = (\n    testTypeId: string,\n    newValue: number,\n    higherIsBetter: boolean\n  ): boolean => {\n    const pb = personalBests.find(p => p.test_type_id === testTypeId);\n    if (!pb) return true;\n    return higherIsBetter ? newValue > pb.value : newValue < pb.value;\n  };\n\n  const getRecordsByTestType = (testTypeId: string) => {\n    return records\n      .filter(r => r.test_type_id === testTypeId)\n      .sort(\n        (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n      );\n  };\n\n  const getPersonalBest = (testTypeId: string) =>\n    personalBests.find(pb => pb.test_type_id === testTypeId);\n\n  const getImprovementPercentage = (\n    testTypeId: string,\n    currentValue: number\n  ): number | null => {\n    const rec = getRecordsByTestType(testTypeId);\n    if (rec.length < 2) return null;\n\n    const first = rec[rec.length - 1];\n    const base = first.values.primary_value as number;\n\n    if (!base || base === 0) return null;\n\n    return ((currentValue - base) / Math.abs(base)) * 100;\n  };\n\n  /* --------------------------\n   * Return API\n   * -------------------------- */\n  return {\n    categories,\n    testTypes,\n    records,\n    personalBests,\n    loading,\n    error,\n\n    addRecord,\n    updateRecord,\n    deleteRecord,\n\n    checkIfPersonalBest,\n    checkExistingRecord,\n    getRecordsByTestType,\n    getPersonalBest,\n    getImprovementPercentage,\n\n    refresh: fetchRecords\n  };\n}","import React from 'react';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { TrendingUp, Activity } from 'lucide-react';\nimport { useMenstrualCycleData } from '../hooks/useMenstrualCycleData';\nimport { useTrainingData } from '../hooks/useTrainingData';\nimport { usePerformanceData } from '../hooks/usePerformanceData';\n\ninterface CyclePerformanceCorrelationProps {\n  userId: string;\n}\n\nexport function CyclePerformanceCorrelation({ userId }: CyclePerformanceCorrelationProps) {\n  const { cycles, getCyclePhase } = useMenstrualCycleData(userId);\n  const { records: trainingRecords } = useTrainingData(userId);\n  const { records: performanceRecords } = usePerformanceData(userId, 'jump');\n\n  const analyzeCorrelation = () => {\n    const phaseData = {\n      menstrual: { count: 0, totalLoad: 0, totalRPE: 0, performances: 0, totalScore: 0 },\n      follicular: { count: 0, totalLoad: 0, totalRPE: 0, performances: 0, totalScore: 0 },\n      ovulatory: { count: 0, totalLoad: 0, totalRPE: 0, performances: 0, totalScore: 0 },\n      luteal: { count: 0, totalLoad: 0, totalRPE: 0, performances: 0, totalScore: 0 },\n    };\n\n    trainingRecords.forEach((record) => {\n      const recordDate = new Date(record.date);\n      for (const cycle of cycles) {\n        const phase = getCyclePhase(cycle, recordDate);\n        if (phase && phase in phaseData) {\n          phaseData[phase as keyof typeof phaseData].count++;\n          phaseData[phase as keyof typeof phaseData].totalLoad += record.load;\n          phaseData[phase as keyof typeof phaseData].totalRPE += record.rpe;\n          break;\n        }\n      }\n    });\n\n    performanceRecords.forEach((record) => {\n      const recordDate = new Date(record.test_date);\n      for (const cycle of cycles) {\n        const phase = getCyclePhase(cycle, recordDate);\n        if (phase && phase in phaseData) {\n          phaseData[phase as keyof typeof phaseData].performances++;\n          phaseData[phase as keyof typeof phaseData].totalScore += record.score;\n          break;\n        }\n      }\n    });\n\n    return Object.entries(phaseData).map(([phase, data]) => ({\n      phase: phase === 'menstrual' ? '' : phase === 'follicular' ? '' : phase === 'ovulatory' ? '' : '',\n      avgLoad: data.count > 0 ? (data.totalLoad / data.count).toFixed(1) : 0,\n      avgRPE: data.count > 0 ? (data.totalRPE / data.count).toFixed(1) : 0,\n      avgPerformance: data.performances > 0 ? (data.totalScore / data.performances).toFixed(1) : 0,\n      sessionCount: data.count,\n    }));\n  };\n\n  const correlationData = analyzeCorrelation();\n  const hasData = correlationData.some((d) => d.sessionCount > 0);\n\n  const getInsights = () => {\n    if (!hasData) return [];\n\n    const insights: string[] = [];\n    const sortedByLoad = [...correlationData].sort((a, b) => Number(b.avgLoad) - Number(a.avgLoad));\n    const sortedByPerformance = [...correlationData].sort(\n      (a, b) => Number(b.avgPerformance) - Number(a.avgPerformance)\n    );\n\n    if (sortedByLoad[0]?.avgLoad > 0) {\n      insights.push(\n        `${sortedByLoad[0].phase}${sortedByLoad[0].avgLoad}`\n      );\n    }\n\n    if (sortedByPerformance[0]?.avgPerformance > 0) {\n      insights.push(\n        `${sortedByPerformance[0].phase}`\n      );\n    }\n\n    const follicular = correlationData.find((d) => d.phase === 'Follicular');\n    const luteal = correlationData.find((d) => d.phase === 'Luteal');\n\n    if (follicular && luteal && Number(follicular.avgRPE) < Number(luteal.avgRPE)) {\n      insights.push(\n        ' - '\n      );\n    }\n\n    return insights;\n  };\n\n  const insights = getInsights();\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow\">\n      <div className=\"flex items-center gap-2 mb-6\">\n        <TrendingUp className=\"w-6 h-6 text-purple-600 dark:text-purple-400\" />\n        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n          \n        </h3>\n      </div>\n\n      {!hasData ? (\n        <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <Activity className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n          <p></p>\n          <p className=\"text-sm mt-2\"></p>\n        </div>\n      ) : (\n        <>\n          <ResponsiveContainer width=\"100%\" height={300}>\n            <BarChart data={correlationData}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" opacity={0.1} />\n              <XAxis dataKey=\"phase\" stroke=\"#6B7280\" style={{ fontSize: '12px' }} />\n              <YAxis stroke=\"#6B7280\" style={{ fontSize: '12px' }} />\n              <Tooltip\n                contentStyle={{\n                  backgroundColor: '#1F2937',\n                  border: 'none',\n                  borderRadius: '8px',\n                  color: '#F3F4F6',\n                }}\n              />\n              <Legend />\n              <Bar dataKey=\"avgLoad\" fill=\"#3B82F6\" name=\"\" />\n              <Bar dataKey=\"avgRPE\" fill=\"#EF4444\" name=\"RPE\" />\n              <Bar dataKey=\"avgPerformance\" fill=\"#10B981\" name=\"\" />\n            </BarChart>\n          </ResponsiveContainer>\n\n          {insights.length > 0 && (\n            <div className=\"mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\n              <h4 className=\"font-semibold text-purple-900 dark:text-purple-100 mb-2\">\n                \n              </h4>\n              <ul className=\"space-y-2 text-sm text-purple-800 dark:text-purple-200\">\n                {insights.map((insight, index) => (\n                  <li key={index} className=\"flex items-start gap-2\">\n                    <span className=\"text-purple-500 mt-1\"></span>\n                    <span>{insight}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n\n          <div className=\"mt-4 text-xs text-gray-500 dark:text-gray-400\">\n            <p>{trainingRecords.length}{performanceRecords.length}</p>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","import React, { useState } from \"react\";\nimport { Droplets } from \"lucide-react\";\n\nimport { MenstrualCycleForm } from \"../MenstrualCycleForm\";\nimport { BasalBodyTemperatureForm } from \"../BasalBodyTemperatureForm\";\nimport { MenstrualCycleChart } from \"../MenstrualCycleChart\";\nimport { MenstrualCycleCalendar } from \"../MenstrualCycleCalendar\";\nimport { CyclePerformanceCorrelation } from \"../CyclePerformanceCorrelation\";\n\ntype Props = {\n  userId: string;\n  gender: \"female\" | \"male\" | null; // AthleteView normalizedGenderBinary \n};\n\nexport function AthleteCycleView({ userId, gender }: Props) {\n  const [cycleViewMode, setCycleViewMode] = useState<\"calendar\" | \"chart\">(\"calendar\");\n\n  // AthleteViewif\n  if (gender !== \"female\") {\n    return (\n      <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6 text-center\">\n        <Droplets className=\"w-12 h-12 text-yellow-600 dark:text-yellow-400 mx-auto mb-4\" />\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\n          \n        </h3>\n        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n          \n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <MenstrualCycleForm userId={userId} />\n        <BasalBodyTemperatureForm userId={userId} />\n      </div>\n\n      <div className=\"flex items-center justify-between bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border dark:border-gray-700\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h3>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => setCycleViewMode(\"calendar\")}\n            className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n              cycleViewMode === \"calendar\"\n                ? \"bg-pink-600 text-white\"\n                : \"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600\"\n            }`}\n          >\n            \n          </button>\n          <button\n            onClick={() => setCycleViewMode(\"chart\")}\n            className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n              cycleViewMode === \"chart\"\n                ? \"bg-pink-600 text-white\"\n                : \"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600\"\n            }`}\n          >\n            \n          </button>\n        </div>\n      </div>\n\n      {cycleViewMode === \"calendar\" ? (\n        <MenstrualCycleCalendar userId={userId} />\n      ) : (\n        <MenstrualCycleChart userId={userId} days={90} />\n      )}\n\n      <CyclePerformanceCorrelation userId={userId} />\n    </div>\n  );\n}","import { useEffect, useMemo, useState } from \"react\";\n\ntype Mode = \"none\" | \"welcome_back\" | \"daily_tip\";\n\ntype State = {\n  open: boolean;\n  mode: Mode;\n  daysAway: number;\n};\n\nfunction safeGet(key: string) {\n  try {\n    return localStorage.getItem(key);\n  } catch {\n    return null;\n  }\n}\n\nfunction safeSet(key: string, value: string) {\n  try {\n    localStorage.setItem(key, value);\n  } catch {\n    // ignore\n  }\n}\n\nfunction daysBetween(a: Date, b: Date) {\n  const ms = b.getTime() - a.getTime();\n  return Math.floor(ms / (1000 * 60 * 60 * 24));\n}\n\nfunction toYMD(d: Date) {\n  // OKJSTJST\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${y}-${m}-${dd}`;\n}\n\n/**\n * &POPHook\n * \n *  1) thresholdDays\n *  2) \n */\nexport function useEntryPopup(opts: {\n  userId: string;\n  keyPrefix?: string;          // athlete/staff\n  thresholdDays?: number;      // \n  enableDailyTip?: boolean;    // POP\n}) {\n  const {\n    userId,\n    keyPrefix = \"athlete\",\n    thresholdDays = 3,\n    enableDailyTip = true,\n  } = opts;\n\n  const keys = useMemo(() => {\n    return {\n      lastOpenAt: `bekuta:${keyPrefix}:last_open_at:${userId}`,\n      lastDailyShown: `bekuta:${keyPrefix}:last_daily_tip_shown:${userId}`,\n      dismissedToday: `bekuta:${keyPrefix}:dismissed_today:${userId}`,\n    };\n  }, [keyPrefix, userId]);\n\n  const [state, setState] = useState<State>({\n    open: false,\n    mode: \"none\",\n    daysAway: 0,\n  });\n\n  useEffect(() => {\n    const now = new Date();\n    const todayYMD = toYMD(now);\n\n    // \n    const dismissed = safeGet(keys.dismissedToday);\n    if (dismissed === todayYMD) {\n      // last_open_at\n      safeSet(keys.lastOpenAt, now.toISOString());\n      return;\n    }\n\n    const prevOpen = safeGet(keys.lastOpenAt);\n    const prevDaily = safeGet(keys.lastDailyShown);\n\n    let mode: Mode = \"none\";\n    let daysAway = 0;\n\n    //  \n    if (prevOpen) {\n      const prevDt = new Date(prevOpen);\n      daysAway = daysBetween(prevDt, now);\n      if (Number.isFinite(daysAway) && daysAway >= thresholdDays) {\n        mode = \"welcome_back\";\n      }\n    }\n\n    //  \n    if (mode === \"none\" && enableDailyTip) {\n      if (prevDaily !== todayYMD) {\n        mode = \"daily_tip\";\n      }\n    }\n\n    if (mode !== \"none\") {\n      setState({ open: true, mode, daysAway });\n      //   OK\n      if (mode === \"daily_tip\") {\n        safeSet(keys.lastDailyShown, todayYMD);\n      }\n    }\n\n    // \n    safeSet(keys.lastOpenAt, now.toISOString());\n  }, [keys, thresholdDays, enableDailyTip]);\n\n  const dismiss = () => {\n    const todayYMD = toYMD(new Date());\n    safeSet(keys.dismissedToday, todayYMD);\n    setState((s) => ({ ...s, open: false, mode: \"none\" }));\n  };\n\n  return { ...state, dismiss };\n}","import React from \"react\";\nimport { X, Sparkles } from \"lucide-react\";\n\ntype Mode = \"welcome_back\" | \"daily_tip\";\n\nexport function EntryPopup(props: {\n  open: boolean;\n  mode: Mode;\n  daysAway?: number;\n  title?: string;\n  message: string;\n  primaryLabel?: string;\n  onClose: () => void;\n}) {\n  const {\n    open,\n    mode,\n    daysAway = 0,\n    title,\n    message,\n    primaryLabel,\n    onClose,\n  } = props;\n\n  if (!open) return null;\n\n  const defaultTitle = mode === \"welcome_back\" ? \"\" : \"\";\n  const defaultPrimary = mode === \"welcome_back\" ? \"\" : \"OK\";\n\n  return (\n    <div className=\"fixed inset-0 z-[60] flex items-start justify-center px-4 pt-16\">\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} />\n\n      <div className=\"relative w-full max-w-sm rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 shadow-2xl p-4\">\n        <button\n          type=\"button\"\n          onClick={onClose}\n          className=\"absolute right-3 top-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700\"\n          aria-label=\"\"\n        >\n          <X className=\"w-5 h-5 text-gray-500\" />\n        </button>\n\n        <div className=\"flex items-center gap-2\">\n          <div className=\"p-2 rounded-xl bg-blue-50 dark:bg-blue-900/20\">\n            <Sparkles className=\"w-5 h-5 text-blue-600 dark:text-blue-300\" />\n          </div>\n          <div className=\"min-w-0\">\n            <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n              {title ?? defaultTitle}\n            </p>\n\n            {mode === \"welcome_back\" && (\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                 {daysAway}\n              </p>\n            )}\n          </div>\n        </div>\n\n        <p className=\"mt-3 text-sm text-gray-700 dark:text-gray-200 whitespace-pre-line\">\n          {message}\n        </p>\n\n        <div className=\"mt-4 flex gap-2\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"flex-1 rounded-xl bg-blue-600 text-white py-2.5 text-sm font-semibold active:opacity-90\"\n          >\n            {primaryLabel ?? defaultPrimary}\n          </button>\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2.5 text-sm text-gray-700 dark:text-gray-200\"\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","// src/lib/phaseAdvice.ts\n\nexport type PhaseType = 'off' | 'pre' | 'in' | 'peak' | 'transition' | 'unknown';\n\ntype AdviceOptions = {\n  /** DB note  */\n  preferNote?: boolean;\n  /** note  */\n  appendTagHintsWhenNote?: boolean;\n  /** note  */\n  maxNoteChars?: number;\n  /**  1  */\n  maxTagHints?: number;\n};\n\nconst DEFAULT_OPTS: Required<AdviceOptions> = {\n  preferNote: true,\n  appendTagHintsWhenNote: false,\n  maxNoteChars: 80,\n  maxTagHints: 1,\n};\n\n/**\n * \n * - \n */\nconst BASE: Record<PhaseType, string> = {\n  off: '',\n  pre: '',\n  in: '',\n  peak: '',\n  transition: '',\n  unknown: '',\n};\n\n/**\n *  -> \n * -  note \n * - maxTagHints=1   \n */\nconst TAG_HINTS: Array<{ match: (t: string) => boolean; text: string }> = [\n  // \n  { match: (t) => /||||||/i.test(t), text: '1' },\n  { match: (t) => /||||/i.test(t), text: '' },\n  { match: (t) => /||||/i.test(t), text: '' },\n  { match: (t) => /||/i.test(t), text: '1' },\n\n  // \n  { match: (t) => /||||strength|S&C/i.test(t), text: '' },\n  { match: (t) => /||||power/i.test(t), text: '1' },\n  { match: (t) => /||plyo|/i.test(t), text: 'UP' },\n\n  // \n  { match: (t) => /||speed||/i.test(t), text: '' },\n  { match: (t) => /|||decel/i.test(t), text: '' },\n  { match: (t) => /|||agility|/i.test(t), text: '' },\n  { match: (t) => /|||reaction/i.test(t), text: '' },\n  { match: (t) => /||/i.test(t), text: '' },\n\n  // \n  { match: (t) => /||aerobic|endurance|/i.test(t), text: '' },\n  { match: (t) => /|||anaerobic/i.test(t), text: '' },\n  { match: (t) => /||||/i.test(t), text: '' },\n\n  // \n  { match: (t) => /||/i.test(t), text: '' },\n  { match: (t) => /|||/i.test(t), text: '' },\n  { match: (t) => /||/i.test(t), text: '' },\n  { match: (t) => /||/i.test(t), text: '' },\n  { match: (t) => /||||T-spine|/i.test(t), text: '' },\n\n  // \n  { match: (t) => /RPE||/i.test(t), text: '' },\n  { match: (t) => /FTT||/i.test(t), text: '' },\n  { match: (t) => /||/i.test(t), text: '' },\n  { match: (t) => /||||/i.test(t), text: '' },\n\n  // \n  { match: (t) => /|||/i.test(t), text: '' },\n  { match: (t) => /|||/i.test(t), text: '' },\n  { match: (t) => /||/i.test(t), text: 'OK' },\n\n  // \n  { match: (t) => /||/i.test(t), text: '/' },\n  { match: (t) => /||/i.test(t), text: '' },\n];\n\nconst normalizeOneLine = (s: string) => {\n  return s\n    .replace(/\\s+/g, ' ')\n    .replace(/+/g, ' ')\n    .trim();\n};\n\nconst clampText = (s: string, max: number) => {\n  const t = normalizeOneLine(s);\n  if (t.length <= max) return t;\n  return t.slice(0, Math.max(0, max - 1)) + '';\n};\n\nconst buildTagHint = (focusTags?: string[] | null, maxHints: number = 1) => {\n  const tags = Array.isArray(focusTags) ? focusTags : [];\n  const extra: string[] = [];\n\n  for (const tag of tags) {\n    const hit = TAG_HINTS.find((r) => r.match(tag));\n    if (hit && !extra.includes(hit.text)) extra.push(hit.text);\n    if (extra.length >= Math.max(0, maxHints)) break;\n  }\n\n  return extra.length ? extra.join(' ') : '';\n};\n\n/**\n * note \n *\n * \n * - preferNote=true  note note&\n * - appendTagHintsWhenNote=true note \n * - note  BASE+\n */\nexport function getPhaseAdvice(\n  phaseType: PhaseType,\n  focusTags?: string[] | null,\n  note?: string | null,\n  options?: AdviceOptions\n): string {\n  const opts = { ...DEFAULT_OPTS, ...(options ?? {}) };\n\n  const base = BASE[phaseType] ?? BASE.unknown;\n  const tagHint = buildTagHint(focusTags, opts.maxTagHints);\n\n  const hasNote = typeof note === 'string' && note.trim().length > 0;\n\n  //  note \n  if (opts.preferNote && hasNote) {\n    const clipped = clampText(note as string, opts.maxNoteChars);\n    if (opts.appendTagHintsWhenNote && tagHint) {\n      return `${clipped} ${tagHint}`;\n    }\n    return clipped;\n  }\n\n  //  note  BASE+\n  if (tagHint) return `${base} ${tagHint}`;\n  return base;\n}\n\nexport default getPhaseAdvice;","// src/lib/dailyOneWord.ts\nimport { getPhaseAdvice } from \"./phaseAdvice\";\n\nexport type PhaseType = \"off\" | \"pre\" | \"in\" | \"peak\" | \"transition\" | \"unknown\";\n\nexport type TeamPhaseLike = {\n  phase_type: PhaseType;\n  focus_tags?: string[] | null;\n  note?: string | null;\n  start_date?: string | null; // YYYY-MM-DD\n  end_date?: string | null;   // YYYY-MM-DD\n};\n\nexport type PoorSleepFlag = {\n  isPoor: boolean;\n  hours: number | null;\n  quality: number | null;\n};\n\nexport type RiskLevel = \"high\" | \"caution\" | \"good\" | \"low\" | \"unknown\";\n\nexport type RiskContext = {\n  // ACWRunknown\n  riskLevel?: RiskLevel | null;\n  // \n  hasHighPriorityAlert?: boolean;\n};\n\nexport type DailyAssistReason = \"poor_sleep\" | \"high_risk\" | \"phase\" | \"default\";\n\nexport type DailyAssistTexts = {\n  oneWord: string;\n  trainingHint: string;\n  sleepHint: string;\n  nutritionHint: string;\n  reason: DailyAssistReason;\n};\n\n/**  */\nexport function phaseLabel(t: PhaseType): string {\n  switch (t) {\n    case \"off\": return \"\";\n    case \"pre\": return \"\";\n    case \"in\": return \"\";\n    case \"peak\": return \"\";\n    case \"transition\": return \"\";\n    default: return \"\";\n  }\n}\n\n/** / */\nfunction normalizePhaseWording(s: string): string {\n  if (!s) return s;\n  return s\n    .replace(//g, \"\")\n    .replace(//g, \"\")\n    .replace(//g, \"\")\n    .replace(//g, \"\")\n    .replace(//g, \"\")\n    .replace(//g, \"\");\n}\n\nfunction clampText(s: string, max: number): string {\n  if (!s) return s;\n  if (s.length <= max) return s;\n  return s.slice(0, Math.max(0, max - 1)) + \"\";\n}\n\nfunction getSleepBadge(poor: PoorSleepFlag): string {\n  if (poor.hours && poor.hours > 0) return `${poor.hours.toFixed(1)}h`;\n  if (poor.quality && poor.quality > 0) return `${poor.quality}/5`;\n  return \"\";\n}\n\n/**\n * 10\n * key = `${phase_type}:${tag}`\n */\nconst TAG_HINTS: Record<string, { oneWord: string; training?: string; sleep?: string; nutrition?: string }> = {\n  \"pre:\": {\n    oneWord: \" \",\n    training: \"\",\n  },\n  \"pre:\": {\n    oneWord: \" \",\n    training: \"\",\n  },\n  \"pre:\": {\n    oneWord: \" \",\n    training: \"\",\n  },\n  \"in:\": {\n    oneWord: \" \",\n    training: \"\",\n  },\n  \"in:\": {\n    oneWord: \" \",\n    training: \"/\",\n  },\n  \"peak:\": {\n    oneWord: \" \",\n    training: \"\",\n  },\n  \"peak:\": {\n    oneWord: \" \",\n    training: \"\",\n    sleep: \"\",\n    nutrition: \"\",\n  },\n  \"transition:\": {\n    oneWord: \" \",\n    training: \"OK\",\n  },\n  \"off:\": {\n    oneWord: \" \",\n    training: \"OK\",\n    sleep: \"\",\n    nutrition: \"\",\n  },\n  \"unknown:\": {\n    oneWord: \" \",\n  },\n};\n\n/**\n * \n * 1)   2)   3)   4) \n */\nexport function buildDailyAssistTexts(args: {\n  phase: TeamPhaseLike | null;\n  poorSleep: PoorSleepFlag | null;\n  risk?: RiskContext | null;\n}): DailyAssistTexts {\n  const phase = args.phase;\n  const poorSleep = args.poorSleep;\n  const risk = args.risk ?? null;\n\n  const phaseType: PhaseType = (phase?.phase_type ?? \"unknown\") as PhaseType;\n  const tags = (phase?.focus_tags ?? [])?.filter(Boolean) as string[];\n  const note = phase?.note ?? null;\n\n  const hasHighAlert = !!risk?.hasHighPriorityAlert;\n  const riskLevel = (risk?.riskLevel ?? \"unknown\") as RiskLevel;\n  const isHighRisk = hasHighAlert || riskLevel === \"high\";\n\n  // ---------- 1)  ----------\n  if (poorSleep?.isPoor) {\n    const badge = getSleepBadge(poorSleep);\n    return {\n      oneWord: ` ${badge} `,\n      trainingHint: ` ${badge} `,\n      sleepHint: ` ${badge} `,\n      nutritionHint: ` ${badge} `,\n      reason: \"poor_sleep\",\n    };\n  }\n\n  // ---------- 2)  ----------\n  if (isHighRisk) {\n    return {\n      oneWord: \" /\",\n      trainingHint: \" \",\n      sleepHint: \"/\",\n      nutritionHint: \"\",\n      reason: \"high_risk\",\n    };\n  }\n\n  // ---------- 3)   note  phaseAdvice   ----------\n  if (phase) {\n    // 3-1) \n    const hitTag = tags.find((t) => TAG_HINTS[`${phaseType}:${t}`]);\n    if (hitTag) {\n      const pack = TAG_HINTS[`${phaseType}:${hitTag}`];\n      return {\n        oneWord: clampText(pack.oneWord, 80),\n        trainingHint: clampText(pack.training ?? pack.oneWord, 80),\n        sleepHint: clampText(\n          pack.sleep ??\n            (phaseType === \"peak\"\n              ? \"\"\n              : phaseType === \"in\"\n              ? \"\"\n              : \"\"),\n          80\n        ),\n        nutritionHint: clampText(\n          pack.nutrition ??\n            (phaseType === \"pre\"\n              ? \"\"\n              : phaseType === \"in\"\n              ? \"\"\n              : phaseType === \"peak\"\n              ? \"\"\n              : \"\"),\n          80\n        ),\n        reason: \"phase\",\n      };\n    }\n\n    // 3-2) note /\n    if (note && note.trim().length > 0) {\n      const normalized = clampText(normalizePhaseWording(note.trim()), 80);\n      return {\n        oneWord: normalized,\n        trainingHint:\n          phaseType === \"pre\"\n            ? \"\"\n            : phaseType === \"in\"\n            ? \"\"\n            : phaseType === \"peak\"\n            ? \"\"\n            : phaseType === \"transition\"\n            ? \"OK\"\n            : \"OK\",\n        sleepHint:\n          phaseType === \"peak\"\n            ? \"\"\n            : phaseType === \"in\"\n            ? \"\"\n            : \"\",\n        nutritionHint:\n          phaseType === \"pre\"\n            ? \"\"\n            : phaseType === \"in\"\n            ? \"\"\n            : phaseType === \"peak\"\n            ? \"\"\n            : \"\",\n        reason: \"phase\",\n      };\n    }\n\n    // 3-3) getPhaseAdvice \n    const base = getPhaseAdvice(phaseType, tags, note, {\n      preferNote: true,\n      appendTagHintsWhenNote: false,\n      maxNoteChars: 80,\n    });\n\n    const baseNormalized = clampText(normalizePhaseWording(base), 80);\n\n    return {\n      oneWord: baseNormalized,\n      trainingHint:\n        phaseType === \"pre\"\n          ? \"\"\n          : phaseType === \"in\"\n          ? \"\"\n          : phaseType === \"peak\"\n          ? \"\"\n          : phaseType === \"transition\"\n          ? \"OK\"\n          : \"OK\",\n      sleepHint:\n        phaseType === \"peak\"\n          ? \"\"\n          : phaseType === \"in\"\n          ? \"\"\n          : \"\",\n      nutritionHint:\n        phaseType === \"pre\"\n          ? \"\"\n          : phaseType === \"in\"\n          ? \"\"\n          : phaseType === \"peak\"\n          ? \"\"\n          : \"\",\n      reason: \"phase\",\n    };\n  }\n\n  // ---------- 4)  ----------\n  return {\n    oneWord: \" 1\",\n    trainingHint: \"\",\n    sleepHint: \"\",\n    nutritionHint: \"\",\n    reason: \"default\",\n  };\n}","// src/lib/pushClient.ts\nimport { supabase } from \"./supabase\";\n\nfunction urlBase64ToUint8Array(base64String: string) {\n  const padding = \"=\".repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = (base64String + padding).replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const raw = atob(base64);\n  const output = new Uint8Array(raw.length);\n  for (let i = 0; i < raw.length; ++i) output[i] = raw.charCodeAt(i);\n  return output;\n}\n\nexport async function registerServiceWorker() {\n  if (!(\"serviceWorker\" in navigator)) return null;\n  const reg = await navigator.serviceWorker.register(\"/sw.js\");\n  return reg;\n}\n\n/**\n * Push\n */\nexport async function subscribePush(publicVapidKey: string) {\n  if (!(\"serviceWorker\" in navigator) || !(\"PushManager\" in window)) {\n    throw new Error(\"Push not supported\");\n  }\n\n  // ready  register \n  const reg = await navigator.serviceWorker.ready;\n\n  // \n  const existing = await reg.pushManager.getSubscription();\n  if (existing) return existing;\n\n  const permission = await Notification.requestPermission();\n  if (permission !== \"granted\") throw new Error(\"Notification permission denied\");\n\n  const sub = await reg.pushManager.subscribe({\n    userVisibleOnly: true,\n    applicationServerKey: urlBase64ToUint8Array(publicVapidKey),\n  });\n\n  return sub;\n}\n\n/**\n * UIDB= Push\n * - DBupsert\n */\nexport async function enablePushForCurrentUser(publicVapidKey: string) {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error(\"Not logged in\");\n\n  // SWready\n  await registerServiceWorker();\n\n  const sub = await subscribePush(publicVapidKey);\n  const json = sub.toJSON();\n\n  const payload = {\n    user_id: user.id,\n    endpoint: sub.endpoint,\n    p256dh: json.keys?.p256dh ?? \"\",\n    auth: json.keys?.auth ?? \"\",\n    user_agent: navigator.userAgent,\n  };\n\n  const { error } = await supabase\n    .from(\"push_subscriptions\")\n    .upsert(payload, { onConflict: \"user_id,endpoint\" });\n\n  if (error) throw error;\n\n  return sub;\n}\n\n/**\n * Push=  + DB\n * - subscription\n * - DB\n */\nexport async function disablePushForCurrentUser() {\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error(\"Not logged in\");\n\n  // \n  if (\"serviceWorker\" in navigator) {\n    const reg = await navigator.serviceWorker.ready;\n    const sub = await reg.pushManager.getSubscription();\n    if (sub) {\n      try {\n        await sub.unsubscribe();\n      } catch (e) {\n        // DB\n        console.warn(\"unsubscribe failed:\", e);\n      }\n    }\n  }\n\n  // DB\n  const { error } = await supabase\n    .from(\"push_subscriptions\")\n    .delete()\n    .eq(\"user_id\", user.id);\n\n  if (error) throw error;\n\n  return true;\n}\n\n/**\n * UIpush\n */\nexport async function getPushEnabledForUser(userId: string) {\n  const { data, error } = await supabase\n    .from(\"push_subscriptions\")\n    .select(\"id\")\n    .eq(\"user_id\", userId)\n    .limit(1)\n    .maybeSingle();\n\n  if (error) throw error;\n  return !!data;\n}   ","// src/components/EmailNotificationSettings.tsx\nimport React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\nimport { Mail, Bell, Shield, Calendar, CheckCircle, AlertCircle, Save } from \"lucide-react\";\nimport {\n  registerServiceWorker,\n  enablePushForCurrentUser,\n  disablePushForCurrentUser,\n} from \"../lib/pushClient\";\n\ninterface EmailNotificationSettingsProps {\n  userId: string;\n  userEmail: string;\n}\n\ninterface NotificationPreferences {\n  alerts: boolean;\n  password_reset: boolean;\n  weekly_summary: boolean;\n}\n\nconst PUBLIC_VAPID_KEY = import.meta.env.VITE_VAPID_PUBLIC_KEY as string;\n\nexport function EmailNotificationSettings({ userId, userEmail }: EmailNotificationSettingsProps) {\n  // Email preferences (users.email_notifications)\n  const [preferences, setPreferences] = useState<NotificationPreferences>({\n    alerts: true,\n    password_reset: true,\n    weekly_summary: false,\n  });\n\n  // Push preferences (push_subscriptions)\n  const [pushReady, setPushReady] = useState(false);\n  const [pushEnabled, setPushEnabled] = useState(false);\n  const [pushBusy, setPushBusy] = useState(false);\n\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [message, setMessage] = useState<{ type: \"success\" | \"error\"; text: string } | null>(null);\n\n  useEffect(() => {\n    (async () => {\n      setLoading(true);\n      await Promise.all([loadPreferences(), initPush()]);\n      setLoading(false);\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [userId]);\n\n  // --- Load / Save email notification preferences ---\n  const loadPreferences = async () => {\n    try {\n      const { data, error } = await supabase\n        .from(\"users\")\n        .select(\"email_notifications\")\n        .eq(\"id\", userId)\n        .single();\n\n      if (error) throw error;\n\n      // invitations \n      const incoming = (data?.email_notifications ?? {}) as Partial<NotificationPreferences>;\n      setPreferences((prev) => ({\n        ...prev,\n        ...incoming,\n      }));\n    } catch (error) {\n      console.error(\"Error loading email preferences:\", error);\n    }\n  };\n\n  const handleSave = async () => {\n    setSaving(true);\n    setMessage(null);\n\n    try {\n      const { error } = await supabase\n        .from(\"users\")\n        .update({ email_notifications: preferences })\n        .eq(\"id\", userId);\n\n      if (error) throw error;\n\n      setMessage({ type: \"success\", text: \"\" });\n    } catch (error: any) {\n      console.error(\"Error saving preferences:\", error);\n      setMessage({ type: \"error\", text: error.message || \"\" });\n    } finally {\n      setSaving(false);\n      setTimeout(() => setMessage(null), 3000);\n    }\n  };\n\n  const handleToggle = (key: keyof NotificationPreferences) => {\n    setPreferences((prev) => ({ ...prev, [key]: !prev[key] }));\n  };\n\n  // --- Push init / toggle ---\n  const initPush = async () => {\n    try {\n      // SW\n      const reg = await registerServiceWorker();\n      setPushReady(!!reg);\n\n      // DBPush ON\n      const { data, error } = await supabase\n        .from(\"push_subscriptions\")\n        .select(\"id\")\n        .eq(\"user_id\", userId)\n        .limit(1)\n        .maybeSingle();\n\n      if (error) throw error;\n      setPushEnabled(!!data);\n    } catch (e) {\n      console.error(\"Error init push:\", e);\n      // Push\n      setPushReady(false);\n    }\n  };\n\n  const handlePushToggle = async () => {\n    setPushBusy(true);\n    setMessage(null);\n\n    try {\n      if (!PUBLIC_VAPID_KEY) {\n        throw new Error(\"VITE_VAPID_PUBLIC_KEY \");\n      }\n\n      if (!pushEnabled) {\n        // ON\n        await registerServiceWorker();\n        await enablePushForCurrentUser(PUBLIC_VAPID_KEY);\n\n        // DBON\n        setPushEnabled(true);\n        setMessage({ type: \"success\", text: \"ON\" });\n      } else {\n        // OFFDB\n        await disablePushForCurrentUser();\n\n        setPushEnabled(false);\n        setMessage({ type: \"success\", text: \"OFF\" });\n      }\n    } catch (error: any) {\n      console.error(\"Push toggle error:\", error);\n      setMessage({ type: \"error\", text: error.message || \"\" });\n    } finally {\n      setPushBusy(false);\n      setTimeout(() => setMessage(null), 3000);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center py-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Title */}\n      <div className=\"flex items-center space-x-3\">\n        <Mail className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\"></h2>\n      </div>\n\n      {/* Email info */}\n      <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\n        <div className=\"flex items-start\">\n          <Mail className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 mt-0.5 flex-shrink-0\" />\n          <div>\n            <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n              <strong>:</strong> {userEmail}\n            </p>\n            <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n              \n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Main card */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 space-y-6 transition-colors\">\n        {/* Push notifications */}\n        <div className=\"flex items-start space-x-4\">\n          <Bell className=\"w-6 h-6 text-purple-600 dark:text-purple-400 mt-1 flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"font-medium text-gray-900 dark:text-white\"></h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                  \n                </p>\n              </div>\n\n              <button\n                onClick={handlePushToggle}\n                disabled={!pushReady || pushBusy}\n                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                  pushEnabled ? \"bg-blue-600 dark:bg-blue-500\" : \"bg-gray-200 dark:bg-gray-700\"\n                } ${(!pushReady || pushBusy) ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\n                title={!pushReady ? \"\" : \"\"}\n              >\n                <span\n                  className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                    pushEnabled ? \"translate-x-6\" : \"translate-x-1\"\n                  }`}\n                />\n              </button>\n            </div>\n\n            <p className=\"mt-2 text-xs text-gray-500 dark:text-gray-400\">\n               iPhoneBekutaON\n            </p>\n          </div>\n        </div>\n\n        <div className=\"border-t border-gray-200 dark:border-gray-700\"></div>\n\n        {/* Email: alerts */}\n        <div className=\"flex items-start space-x-4\">\n          <Bell className=\"w-6 h-6 text-red-600 dark:text-red-400 mt-1 flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"font-medium text-gray-900 dark:text-white\"></h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                  ACWR\n                </p>\n              </div>\n              <button\n                onClick={() => handleToggle(\"alerts\")}\n                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                  preferences.alerts ? \"bg-blue-600 dark:bg-blue-500\" : \"bg-gray-200 dark:bg-gray-700\"\n                }`}\n              >\n                <span\n                  className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                    preferences.alerts ? \"translate-x-6\" : \"translate-x-1\"\n                  }`}\n                />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-gray-200 dark:border-gray-700\"></div>\n\n        {/* Email: password reset */}\n        <div className=\"flex items-start space-x-4\">\n          <Shield className=\"w-6 h-6 text-yellow-600 dark:text-yellow-400 mt-1 flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"font-medium text-gray-900 dark:text-white\"></h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                  \n                </p>\n              </div>\n              <button\n                onClick={() => handleToggle(\"password_reset\")}\n                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                  preferences.password_reset ? \"bg-blue-600 dark:bg-blue-500\" : \"bg-gray-200 dark:bg-gray-700\"\n                }`}\n              >\n                <span\n                  className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                    preferences.password_reset ? \"translate-x-6\" : \"translate-x-1\"\n                  }`}\n                />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-gray-200 dark:border-gray-700\"></div>\n\n        {/* Email: weekly summary */}\n        <div className=\"flex items-start space-x-4\">\n          <Calendar className=\"w-6 h-6 text-green-600 dark:text-green-400 mt-1 flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"font-medium text-gray-900 dark:text-white\"></h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                  \n                </p>\n              </div>\n              <button\n                onClick={() => handleToggle(\"weekly_summary\")}\n                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                  preferences.weekly_summary ? \"bg-blue-600 dark:bg-blue-500\" : \"bg-gray-200 dark:bg-gray-700\"\n                }`}\n              >\n                <span\n                  className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                    preferences.weekly_summary ? \"translate-x-6\" : \"translate-x-1\"\n                  }`}\n                />\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* message */}\n      {message && (\n        <div\n          className={`flex items-center space-x-3 p-3 rounded-lg ${\n            message.type === \"success\"\n              ? \"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-600 dark:text-green-400\"\n              : \"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400\"\n          } transition-colors`}\n        >\n          {message.type === \"success\" ? (\n            <CheckCircle className=\"w-5 h-5 flex-shrink-0\" />\n          ) : (\n            <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\n          )}\n          <span className=\"text-sm\">{message.text}</span>\n        </div>\n      )}\n\n      {/* save button - email preferences only */}\n      <div className=\"flex justify-end\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white py-2 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center space-x-2\"\n        >\n          {saving ? (\n            <>\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n              <span>...</span>\n            </>\n          ) : (\n            <>\n              <Save className=\"w-4 h-4\" />\n              <span></span>\n            </>\n          )}\n        </button>\n      </div>\n\n      <div className=\"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4 transition-colors\">\n        <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n          <strong>:</strong> \n        </p>\n      </div>\n    </div>\n  );\n}","import React from 'react';\nimport { EmailNotificationSettings } from '../EmailNotificationSettings';\nimport type { Database } from '../../lib/database.types';\n\ntype UserProfile = Database['public']['Tables']['users']['Row'];\n\ntype Props = {\n  user: UserProfile;\n  onOpenProfileEdit: () => void;\n};\n\nexport function AthleteSettingsView({ user, onOpenProfileEdit }: Props) {\n  return (\n    <div className=\"max-w-4xl mx-auto space-y-6\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\"></h2>\n          <button\n            onClick={onOpenProfileEdit}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\n          >\n            \n          </button>\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">{user.name ?? '-'}</p>\n            </div>\n\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">{user.email ?? '-'}</p>\n            </div>\n\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {user.gender === 'male'\n                  ? ''\n                  : user.gender === 'female'\n                  ? ''\n                  : user.gender === 'other'\n                  ? ''\n                  : user.gender === 'prefer_not_to_say'\n                  ? ''\n                  : ''}\n              </p>\n            </div>\n\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {user.height_cm ? `${user.height_cm} cm` : ''}\n              </p>\n            </div>\n\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {user.date_of_birth ? new Date(user.date_of_birth).toLocaleDateString('ja-JP') : ''}\n              </p>\n            </div>\n\n            <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\"></p>\n              <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {user.phone_number ? user.phone_number : ''}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n        <EmailNotificationSettings userId={user.id} userEmail={user.email ?? ''} />\n      </div>\n    </div>\n  );\n}","// src/components/AthleteView.tsx\nimport React, { useState, useEffect, useMemo, useCallback, useRef, Suspense, lazy } from 'react';\nimport { getTodayJSTString } from '../lib/date';\nimport type { Database } from '../lib/database.types';\nimport { TrainingForm } from './TrainingForm';\nimport { ACWRChart } from './ACWRChart';\nimport { TrainingRecordsList } from './TrainingRecordsList';\nimport { AlertSummary } from './AlertSummary';\nimport { supabase } from '../lib/supabase';\nimport { WeightForm } from './WeightForm';\nimport { WeightChart } from './WeightChart';\nimport { WeightRecordsList } from './WeightRecordsList';\nimport { WeightACWRChart } from './WeightACWRChart';\nimport { InsightCard } from './InsightCard';\nimport { BMIDisplay } from './BMIDisplay';\nimport { ProfileEditForm } from './ProfileEditForm';\nimport { TutorialController } from './TutorialController';\nimport { useTrainingData } from '../hooks/useTrainingData';\nimport { useWeightData } from '../hooks/useWeightData';\nimport { useSleepData } from '../hooks/useSleepData';\nimport { useMotivationData } from '../hooks/useMotivationData';\nimport { useMenstrualCycleData } from '../hooks/useMenstrualCycleData';\nimport { useTutorialContext } from '../contexts/TutorialContext';\nimport { getTutorialSteps } from '../lib/tutorialContent';\nimport { SleepForm } from './SleepForm';\nimport { MotivationForm } from './MotivationForm';\nimport { SleepChart } from './SleepChart';\nimport { MotivationChart } from './MotivationChart';\nimport { ConditioningSummaryCard } from './ConditioningSummaryCard';\nimport { UnifiedDailyCheckIn } from './UnifiedDailyCheckIn';\nimport { ConsolidatedOverviewDashboard } from './ConsolidatedOverviewDashboard';\nimport { MultiMetricTimeline } from './MultiMetricTimeline';\nimport { FloatingActionButton } from './FloatingActionButton';\nimport { DailyReflectionCard } from './DailyReflectionCard';\nimport { ShareStatusButton } from './ShareStatusButton';\nimport { useAthleteDerivedValues } from '../hooks/useAthleteDerivedValues';\nimport { DerivedStatsBar } from './DerivedStatsBar';\nimport { getRiskLabel, getRiskColor } from '../lib/acwr';\nimport { useLastRecords } from '../hooks/useLastRecords';\nimport { useInbodyData } from '../hooks/useInbodyData';\nimport { InBodyLatestCard } from './InBodyLatestCard';\nimport { InBodyCharts } from './InBodyCharts';\nimport { getTodayEnergySummary } from '../lib/getTodayEnergySummary';\nimport { useTodayNutritionTotals } from '../hooks/useTodayNutritionTotals';\nimport NutritionOverview from \"./NutritionOverview\";\nimport { buildDailyTargets } from \"../lib/nutritionCalc\";\nimport { FTTCheck } from './FTTCheck';\nimport {AthleteGamificationView} from \"./views/AthleteGamificationView\";\nimport { AthleteCycleView } from \"./views/AthleteCycleView\";\nimport { getPhaseAdvice } from '../lib/phaseAdvice';\nimport { useEntryPopup } from \"../hooks/useEntryPopup\";\nimport { EntryPopup } from \"./EntryPopup\";\nimport { buildDailyAssistTexts } from \"../lib/dailyOneWord\";\n\n\n\n\n\nimport {\n  Activity,\n  TrendingUp,\n  Calendar,\n  AlertTriangle,\n  Scale,\n  Settings,\n  HelpCircle,\n  Zap,\n  Moon,\n  Heart,\n  LayoutDashboard,\n  Menu,\n  X,\n  LogOut,\n  Trophy,\n  Shield,\n  FileText,\n  Building2,\n  Droplets,\n  Flame,\n} from 'lucide-react';\n\nimport { useDarkMode } from '../hooks/useDarkMode';\nimport { AthleteSettingsView } from './views/AthleteSettingsView';\nimport { upsertDailyEnergySnapshot } from '../lib/upsertDailyEnergySnapshot';\n\n\n\n\n\nconst AthleteNutritionDashboardView = lazy(() =>\n  import(\"./views/AthleteNutritionDashboardView\").then((m) => ({\n    default: m.default,\n  }))\n);\n\n// Lazy load heavy components\nconst ExportPanel = lazy(() => import('./ExportPanel').then((m) => ({ default: m.ExportPanel })));\nconst GamificationView = lazy(() => import('./GamificationView').then((m) => ({ default: m.GamificationView })));\nconst MessagingPanel = lazy(() => import('./MessagingPanel').then((m) => ({ default: m.MessagingPanel })));\n\nconst AthletePerformanceView = lazy(() =>\n  import(\"./views/AthletePerformanceView\").then((m) => ({ default: m.default }))\n);\n\ntype UserProfile = Database['public']['Tables']['users']['Row'];\ntype DailyEnergySnapshotRow = Database['public']['Tables']['daily_energy_snapshots']['Row'];\n\ntype AthleteViewProps = {\n  user: UserProfile;\n  alerts: any[];\n  onLogout: () => void;\n  onHome: () => void;\n  onNavigateToPrivacy: () => void;\n  onNavigateToTerms: () => void;\n  onNavigateToCommercial: () => void;\n  onNavigateToHelp: () => void;\n  onUserUpdated?: () => Promise<void> | void;\n};\n\n// =========================\n//  Team Season Phase3\n// =========================\ntype TeamPhaseRow = {\n  phase_type: 'off' | 'pre' | 'in' | 'peak' | 'transition' | 'unknown';\n  focus_tags: string[];\n  note: string | null;\n  start_date: string; // YYYY-MM-DD\n  end_date: string;   // YYYY-MM-DD\n};\n\nexport function AthleteView({\n  user,\n  alerts,\n  onLogout,\n  onHome,\n  onNavigateToPrivacy,\n  onNavigateToTerms,\n  onNavigateToCommercial,\n  onNavigateToHelp,\n  onUserUpdated,\n}: AthleteViewProps) {\n  // =========================\n  //  DEV\n  // =========================\n  const loggedOnceRef = useRef(false);\n  useEffect(() => {\n    if (!import.meta.env.DEV) return;\n    if (loggedOnceRef.current) return;\n    loggedOnceRef.current = true;\n\n    console.log('[AthleteView] mounted', {\n      id: user.id,\n      role: user.role,\n      gender: user.gender,\n      team_id: user.team_id,\n    });\n  }, [user.id, user.role, user.gender, user.team_id]);\n\n  const renderLoggedRef = useRef(false);\n\n  \n\n  useEffect(() => {\n    if (!import.meta.env.DEV) return;\n    if (renderLoggedRef.current) return;\n\n    console.log('[AthleteView] first render');\n    renderLoggedRef.current = true;\n  }, []);\n\n  \n\n\n  const today = useMemo(() => getTodayJSTString(), []);\n\n\n\n  const [todayPhase, setTodayPhase] = useState<TeamPhaseRow | null>(null);\n  const [nextPhases, setNextPhases] = useState<TeamPhaseRow[]>([]);\n  const [phaseLoading, setPhaseLoading] = useState(false);\n  const [phaseError, setPhaseError] = useState<string | null>(null);\n\n  const addDaysToDateString = (dateStr: string, addDays: number) => {\n    // dateStr: 'YYYY-MM-DD'JST\n    const [y, m, d] = dateStr.split('-').map(Number);\n    const dt = new Date(y, (m ?? 1) - 1, d ?? 1);\n    dt.setDate(dt.getDate() + addDays);\n\n    const yy = dt.getFullYear();\n    const mm = String(dt.getMonth() + 1).padStart(2, '0');\n    const dd = String(dt.getDate()).padStart(2, '0');\n    return `${yy}-${mm}-${dd}`;\n  };\n\n  useEffect(() => {\n    const teamId = user.team_id;\n    if (!teamId) {\n      // team_id staff\n      setTodayPhase(null);\n      setNextPhases([]);\n      return;\n    }\n\n    let cancelled = false;\n\n    const run = async () => {\n      setPhaseLoading(true);\n      setPhaseError(null);\n\n      try {\n        // \n        const { data: d1, error: e1 } = await supabase.rpc('get_team_phase_on_date', {\n          p_team_id: teamId,\n          p_date: today,\n        });\n\n        if (e1) throw e1;\n\n        // 321\n        const end = addDaysToDateString(today, 21);\n        const { data: d2, error: e2 } = await supabase.rpc('get_team_phases_in_range', {\n          p_team_id: teamId,\n          p_start: today,\n          p_end: end,\n        });\n\n        if (e2) throw e2;\n\n        if (cancelled) return;\n\n        const row1 = (Array.isArray(d1) ? d1[0] : d1) as TeamPhaseRow | null;\n        setTodayPhase(row1 ?? null);\n        \n        const rows2 = (Array.isArray(d2) ? d2 : []) as TeamPhaseRow[];\n        \n        //    \n        const filtered = (rows2 ?? []).filter((p) => {\n          if (!row1) return true;\n          return !(\n            p.phase_type === row1.phase_type &&\n            p.start_date === row1.start_date &&\n            p.end_date === row1.end_date\n          );\n        });\n        \n        //  \n        filtered.sort((a, b) => (a.start_date > b.start_date ? 1 : a.start_date < b.start_date ? -1 : 0));\n        \n        setNextPhases(filtered);\n      } catch (err: any) {\n        if (cancelled) return;\n        console.error('[team phase fetch error]', err);\n        setPhaseError(err?.message ?? 'team phase fetch error');\n        setTodayPhase(null);\n        setNextPhases([]);\n      } finally {\n        if (!cancelled) setPhaseLoading(false);\n      }\n    };\n\n    run();\n    return () => {\n      cancelled = true;\n    };\n  }, [user.team_id, today]);  \n  \n  \n  const phaseLabel = (t: TeamPhaseRow['phase_type']) => {\n    switch (t) {\n      case 'off': return '';\n      case 'pre': return '';\n      case 'in': return '';\n      case 'peak': return '';\n      case 'transition': return '';\n      default: return '';\n    }\n  };\n\n  const toShortRange = (s: string, e: string) => {\n    // s,e: YYYY-MM-DD\n    const sm = Number(s.slice(5, 7));\n    const sd = Number(s.slice(8, 10));\n    const em = Number(e.slice(5, 7));\n    const ed = Number(e.slice(8, 10));\n    if (!sm || !sd || !em || !ed) return `${s}${e}`;\n    return `${sm}/${sd}${em}/${ed}`;\n  };\n\n\n\n  const [snapshotToday, setSnapshotToday] = useState<DailyEnergySnapshotRow | null>(null);\n  const [showExportPanel, setShowExportPanel] = useState(false);\n  const [showUnifiedCheckIn, setShowUnifiedCheckIn] = useState(false);\n \n  const [showProfileEdit, setShowProfileEdit] = useState(false);\n  const [menuOpen, setMenuOpen] = useState(false);\n\n    type ActiveTab =\n    | 'unified'\n    | 'overview'\n    | 'weight'\n    | 'insights'\n    | 'nutrition'\n    | 'ftt'\n    | 'performance'\n    | 'conditioning'\n    | 'cycle'\n    | 'gamification'\n    | 'settings'\n    | 'messages';\n\n  const [activeTab, setActiveTab] = useState<ActiveTab>('unified');\n  const canUseFTT = !!(user as any).ftt_enabled;\n  const canUseNutrition = !!(user as any).nutrition_enabled;\n\n\n  //  performance chunk prefetch& / \n  useEffect(() => {\n  const conn = (navigator as any).connection;\n  const saveData = !!conn?.saveData;\n  const effectiveType = conn?.effectiveType as string | undefined;\n  const isSlow =\n    effectiveType === \"slow-2g\" || effectiveType === \"2g\" || effectiveType === \"3g\";\n\n  if (saveData || isSlow) return;\n\n  let cancelled = false;\n\n  const prefetch = () => {\n    import(\"./views/AthletePerformanceView\");\n  };\n\n  if (\"requestIdleCallback\" in window) {\n    const id = (window as any).requestIdleCallback(\n      () => {\n        if (!cancelled) prefetch();\n      },\n      { timeout: 4000 }\n    );\n\n    return () => {\n      cancelled = true;\n      (window as any).cancelIdleCallback?.(id);\n    };\n  }\n\n  const t = setTimeout(() => {\n    if (!cancelled) prefetch();\n  }, 2500);\n\n  return () => {\n    cancelled = true;\n    clearTimeout(t);\n  };\n}, []);\n  \n\n  const safeSetActiveTab = useCallback(\n    (tab: ActiveTab) => {\n      if (tab === 'ftt' && !canUseFTT) return;\n      if (tab === 'nutrition' && !canUseNutrition) return;\n      setActiveTab(tab);\n    },\n    [canUseFTT, canUseNutrition]\n  );\n  \n  useEffect(() => {\n    if (!canUseFTT && activeTab === 'ftt') {\n      setActiveTab('unified');\n    }\n  }, [canUseFTT, activeTab]);\n\n\n  // nutrition_enabled \n \n  //   nutrition_enabled=false  nutrition \n  useEffect(() => {\n    if (!canUseNutrition && activeTab === 'nutrition') {\n      setActiveTab('unified');\n    }\n  }, [canUseNutrition, activeTab])\n\n\n  const [celebrationData, setCelebrationData] = useState<{\n    testName: string;\n    value: number;\n    unit: string;\n    previousBest?: number;\n  } | null>(null);\n\n  const [hasStartedTutorial, setHasStartedTutorial] = useState(false);\n\n  // =========================\n  //  gender useMemo\n  // =========================\n  const normalizedGenderBinary: 'female' | 'male' | null = useMemo(() => {\n    return user.gender === 'female' || user.gender === 'male' ? user.gender : null;\n  }, [user.gender]);\n\n  const normalizedGenderFull: 'female' | 'male' | 'other' | 'prefer_not_to_say' | null = useMemo(() => {\n    return user.gender === 'female' || user.gender === 'male' || user.gender === 'other' || user.gender === 'prefer_not_to_say'\n      ? user.gender\n      : null;\n  }, [user.gender]);\n\n  useEffect(() => {\n    if (!import.meta.env.DEV) return;\n    console.log('[gender check]', { raw: user.gender, binary: normalizedGenderBinary, full: normalizedGenderFull });\n  }, [user.gender, normalizedGenderBinary, normalizedGenderFull]);\n\n  //  cyclefemale\n  useEffect(() => {\n    if (activeTab === 'cycle' && normalizedGenderBinary !== 'female') {\n      setActiveTab('unified');\n    }\n  }, [activeTab, normalizedGenderBinary])\n\n  // =========================\n  //  Hooks\n  // =========================\n  const {\n    records,\n    loading,\n    checkExistingRecord: checkExistingTrainingRecord,\n    addTrainingRecord,\n    updateTrainingRecord,\n    deleteTrainingRecord,\n    acwrData,\n  } = useTrainingData(user.id);\n\n  // =========================\n  //  ACWRphaseHints\n  // =========================\n  const latestACWR = useMemo(\n    () => (acwrData && acwrData.length > 0 ? acwrData[acwrData.length - 1] : null),\n    [acwrData]\n  );\n \n\n\n\n\n  const {\n    records: weightRecords,\n    loading: weightLoading,\n    checkExistingRecord: checkExistingWeightRecord,\n    addWeightRecord,\n    updateWeightRecord,\n    deleteWeightRecord,\n    getLatestWeight,\n    getWeightChange,\n  } = useWeightData(user.id);\n\n  const latestWeight = useMemo(() => getLatestWeight(), [getLatestWeight]);\n\n  const lastWeightRecord = useMemo(() => {\n    if (weightRecords.length === 0) return null;\n    return weightRecords.reduce((latest, r) => (!latest || new Date(r.date) > new Date(latest.date) ? r : latest), null as any);\n  }, [weightRecords]);\n\n  const {\n    records: sleepRecords,\n    loading: sleepLoading,\n    checkExistingRecord: checkExistingSleepRecord,\n    addSleepRecord,\n    updateSleepRecord,\n    getAverageSleepHours,\n    getAverageSleepQuality,\n    getLatestSleep,\n  } = useSleepData(user.id);\n\n  // =========================\n  //  Sleep-based flag\n  // =========================\n  const latestSleepForHint = useMemo(() => {\n    // \n    return getLatestSleep?.() ?? null;\n  }, [getLatestSleep]);\n\n  const poorSleepFlag = useMemo(() => {\n    const h = Number(latestSleepForHint?.sleep_hours ?? 0);\n    const q = Number(latestSleepForHint?.sleep_quality ?? 0);\n\n    // 6h or 2\n    const poorByHours = h > 0 && h < 6;\n    const poorByQuality = q > 0 && q <= 2;\n\n    return {\n      isPoor: poorByHours || poorByQuality,\n      hours: h || null,\n      quality: q || null,\n    };\n  }, [latestSleepForHint]);\n  \n\n\n  const {\n    records: motivationRecords,\n    loading: motivationLoading,\n    checkExistingRecord: checkExistingMotivationRecord,\n    addMotivationRecord,\n    updateMotivationRecord,\n    getAverageMotivation,\n    getAverageEnergy,\n    getAverageStress,\n    getLatestMotivation,\n  } = useMotivationData(user.id);\n\n  const { records: inbodyRecords, latest: latestInbody, loading: inbodyLoading, error: inbodyError } = useInbodyData(user.id);\n  const { cycles: menstrualCycles, addCycle: addMenstrualCycle, updateCycle: updateMenstrualCycle } = useMenstrualCycleData(user.id);\n\n\n  const { isActive, shouldShowTutorial, startTutorial, completeTutorial, skipTutorial, currentStepIndex, setCurrentStepIndex } =\n    useTutorialContext();\n\n  const { isDarkMode } = useDarkMode();\n\n  // =========================\n  //  \n  // =========================\n  const {\n    logs: nutritionLogsToday,\n    totals: nutritionTotalsToday,\n    loading: nutritionLoading,\n    error: nutritionError,\n    refetch: refetchNutritionToday,\n  } = useTodayNutritionTotals(user.id, today);\n\n  //  \n  const normalizedNutritionTotalsToday = useMemo(() => {\n    const t = nutritionTotalsToday ?? {};\n    const cal =\n      Number((t as any)?.cal ?? (t as any)?.kcal ?? (t as any)?.calories ?? (t as any)?.total_calories ?? 0) || 0;\n    const p = Number((t as any)?.p ?? (t as any)?.protein_g ?? (t as any)?.protein ?? 0) || 0;\n    const f = Number((t as any)?.f ?? (t as any)?.fat_g ?? (t as any)?.fat ?? 0) || 0;\n    const c = Number((t as any)?.c ?? (t as any)?.carbs_g ?? (t as any)?.carbs ?? 0) || 0;\n    return { cal, p, f, c };\n  }, [nutritionTotalsToday]);\n\n  // =========================\n  //  DeriveduseMemo\n  // =========================\n  const derived = useAthleteDerivedValues({\n    trainingRecords: records,\n    weightRecords,\n    sleepRecords,\n    motivationRecords,\n  });\n\n  const daysWithData = derived.daysWithTrainingData;\n  const consecutiveDays = derived.consecutiveTrainingDays;\n  const weeklyAverage = derived.weeklyAverage;\n\n  //  lastRecord  \n  const {\n    normalizedLastTrainingRecord,\n    normalizedLastTrainingRecordForCheckIn,\n    normalizedLastWeightRecord,\n    normalizedLastSleepRecord,\n    normalizedLastMotivationRecord,\n  } = useLastRecords({\n    lastTrainingRecord: derived.lastTrainingRecord,\n    lastWeightRecord: derived.lastWeightRecord,\n    lastSleepRecord: derived.lastSleepRecord,\n    lastMotivationRecord: derived.lastMotivationRecord,\n  });\n\n  // =========================\n  //  sleepRecords useMemo\n  // =========================\n  const normalizedSleepRecords = useMemo(() => {\n    return sleepRecords.map((r) => ({\n      ...r,\n      sleep_quality: r.sleep_quality ?? 0,\n    }));\n  }, [sleepRecords]);\n\n  const timelineSleepRecords = useMemo(() => {\n    return normalizedSleepRecords.map((r) => ({\n      sleep_hours: r.sleep_hours,\n      sleep_quality: r.sleep_quality,\n      date: r.date,\n    }));\n  }, [normalizedSleepRecords]);\n\n  // =========================\n  //  useMemo\n  // =========================\n  const userAlerts = useMemo(() => alerts.filter((a) => a.user_id === user.id), [alerts, user.id]);\n  const highPriorityAlerts = useMemo(() => userAlerts.filter((a) => a.priority === 'high'), [userAlerts]);\n\n  const todayWeight = useMemo(() => weightRecords.find((r) => r.date === today), [weightRecords, today]);\n\n\n  // =========================\n  //  Phase/Risk/Sleep  + \n  // =========================\n  const phaseHints = useMemo(() => {\n    const assist = buildDailyAssistTexts({\n      phase: todayPhase,\n      //  buildDailyAssistTexts  boolean \n      poorSleep: poorSleepFlag.isPoor,\n      risk: {\n        riskLevel: (latestACWR?.riskLevel ?? \"unknown\") as any,\n        hasHighPriorityAlert: (highPriorityAlerts?.length ?? 0) > 0,\n      },\n    });\n\n    return {\n      base: assist.oneWord,\n      training: assist.trainingHint,\n      sleep: assist.sleepHint,\n      nutrition: assist.nutritionHint,\n    };\n  }, [todayPhase, poorSleepFlag?.isPoor, latestACWR?.riskLevel, highPriorityAlerts?.length]);\n\n  // =========================\n  //  Entry POP > \n  // =========================\n  const entryPop = useEntryPopup({\n    userId: user.id,\n    keyPrefix: \"athlete\",\n    thresholdDays: 3,\n    enableDailyTip: true,\n  });\n\n  //  unified\n  const shouldShowEntryPop = activeTab === \"unified\" && entryPop.open;\n\n  //  \n  const entryPopMessage = useMemo(() => {\n    if (entryPop.mode === \"welcome_back\") {\n      return `\\n`;\n    }\n    return `\\n${phaseHints.base}`;\n  }, [entryPop.mode, phaseHints.base]);\n\n  // =========================\n  //   fetchsetState\n  // =========================\n  const targets = useMemo(() => {\n    const weightKg =\n      Number(latestInbody?.weight ?? latestInbody?.weight_kg) ||\n      Number(user?.weight_kg) ||\n      0;\n  \n    if (!weightKg || weightKg <= 0) return null;\n  \n    const bodyFatPercentRaw = Number(latestInbody?.body_fat_percent ?? latestInbody?.body_fat_perc);\n    const bodyFatPercent = Number.isFinite(bodyFatPercentRaw) && bodyFatPercentRaw > 0 ? bodyFatPercentRaw : null;\n  \n    const heightCmRaw = Number(user?.height_cm);\n    const heightCm = Number.isFinite(heightCmRaw) && heightCmRaw > 0 ? heightCmRaw : null;\n  \n    const res = buildDailyTargets({\n      weightKg,\n      bodyFatPercent,\n      heightCm,\n      age: null,\n      sex: null,\n      activityLevel: \"moderate\",\n      goalType: \"maintain\",\n    });\n  \n    return res?.target ?? null;\n  }, [\n    user?.weight_kg,\n    user?.height_cm,\n    latestInbody?.weight,\n    latestInbody?.weight_kg,\n    latestInbody?.body_fat_percent,\n    latestInbody?.body_fat_perc,\n  ]);\n\n  // =========================\n  //  useMemo\n  // =========================\n  const todayTrainingRecord = useMemo(() => records.find((r) => r.date === today) ?? null, [records, today]);\n\n  const todayLoad = useMemo(() => {\n    return todayTrainingRecord ? (todayTrainingRecord.rpe ?? 0) * (todayTrainingRecord.duration_min ?? 0) : 0;\n  }, [todayTrainingRecord]);\n\n  // =========================\n  //  useMemo\n  // =========================\n  const intakeToday = 0;\n\n  const energySummary = useMemo(() => {\n    return getTodayEnergySummary({\n      date: today,\n      snapshot: snapshotToday\n        ? {\n            bmr: snapshotToday.bmr,\n            tdee: snapshotToday.tdee,\n            srpe: snapshotToday.srpe,\n            activity_factor: Number(snapshotToday.activity_factor),\n          }\n        : null,\n      intakeCalories: intakeToday,\n      fallback: { todayLoad },\n    });\n  }, [today, snapshotToday, intakeToday, todayLoad]);\n\n  // =========================\n  //  \n  // =========================\n  useEffect(() => {\n    if (hasStartedTutorial) return;\n    if (loading) return;\n\n    if (shouldShowTutorial()) {\n      startTutorial();\n      setHasStartedTutorial(true);\n    }\n  }, [loading, hasStartedTutorial, shouldShowTutorial, startTutorial]);\n\n\n  // =========================\n  //  handlersuseCallback\n  // =========================\n  const handleTrainingSubmit = useCallback(\n    async (data: { rpe: number; duration_min: number; date: string; arrow_score?: number; signal_score?: number }) => {\n      await addTrainingRecord({\n        rpe: data.rpe,\n        duration_min: data.duration_min,\n        date: data.date,\n        arrow_score: data.arrow_score ?? 50,\n        signal_score: data.signal_score ?? 50,\n      } as any);\n\n      await upsertDailyEnergySnapshot({\n        userId: user.id,\n        date: data.date,\n        rpe: data.rpe,\n        durationMin: data.duration_min,\n      });\n    },\n    [addTrainingRecord, user.id]\n  );\n\n  const handleTrainingUpdate = useCallback(\n    async (recordId: string, recordData: { rpe: number; duration_min: number; date?: string }) => {\n      await updateTrainingRecord(recordId, recordData);\n    },\n    [updateTrainingRecord]\n  );\n\n  const handleTrainingUpdateForList = useCallback(\n    async (recordId: string, recordData: { rpe: number; duration_min: number }) => {\n      await updateTrainingRecord(recordId, recordData);\n    },\n    [updateTrainingRecord]\n  );\n\n  const handleTrainingSubmitForCheckIn = useCallback(\n    async (data: { rpe: number; duration_min: number; date: string; arrow_score?: number; signal_score?: number }) => {\n      await addTrainingRecord({\n        rpe: data.rpe,\n        duration_min: data.duration_min,\n        date: data.date,\n        arrow_score: data.arrow_score ?? 50,\n        signal_score: data.signal_score ?? 50,\n      } as any);\n    },\n    [addTrainingRecord]\n  );\n\n  const handleTrainingUpdateForCheckIn = useCallback(\n    async (\n      recordId: string,\n      recordData: { rpe: number; duration_min: number; arrow_score?: number; signal_score?: number }\n    ) => {\n      await updateTrainingRecord(recordId, {\n        rpe: recordData.rpe,\n        duration_min: recordData.duration_min,\n        arrow_score: recordData.arrow_score ?? 50,\n        signal_score: recordData.signal_score ?? 50,\n      } as any);\n    },\n    [updateTrainingRecord]\n  );\n\n\n\n  const recordDate = today; //  subtitlerecordDate\n  const galleryInputRef = useRef<HTMLInputElement | null>(null);\n \n\n  //   / \n  const libraryInputRef = useRef<HTMLInputElement | null>(null);\n  //  iOShidden  file input \n  const fileInputClass =\n  \"absolute -left-[9999px] top-0 w-px h-px opacity-0\";\n  const handlePickPhoto = useCallback((file: File) => {\n    setActiveTab(\"nutrition\");\n  }, []);\n\n  const getCategoryDisplayName = useCallback((category: string) => {\n    switch (category) {\n      case 'jump':\n        return '';\n      case 'endurance':\n        return '';\n      case 'strength':\n        return '';\n      case 'sprint':\n        return '';\n      case 'agility':\n        return '';\n      default:\n        return '';\n    }\n  }, []);\n\n  // =========================\n  //  derived check DEV\n  // =========================\n  useEffect(() => {\n    if (!import.meta.env.DEV) return;\n    console.log('[derived check]', {\n      lastTraining: derived.lastTrainingRecord?.date,\n      lastSleep: derived.lastSleepRecord?.date,\n      lastMotivation: derived.lastMotivationRecord?.date,\n      days: derived.daysWithTrainingData,\n      consecutive: derived.consecutiveTrainingDays,\n    });\n  }, [\n    derived.lastTrainingRecord?.date,\n    derived.lastSleepRecord?.date,\n    derived.lastMotivationRecord?.date,\n    derived.daysWithTrainingData,\n    derived.consecutiveTrainingDays,\n  ]);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors\">\n      <header className=\"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 shadow-lg transition-colors\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n          <div className=\"flex items-center justify-between\">\n            {/*  */}\n            <button\n              type=\"button\"\n              onClick={onHome}\n              className=\"flex items-baseline gap-2 active:opacity-70 cursor-pointer\"\n              style={{ WebkitTapHighlightColor: 'transparent' }}\n            >\n              <span className=\"text-2xl sm:text-3xl font-bold text-white\">Bekuta</span>\n              <span className=\"text-xs font-medium text-blue-100 hidden sm:inline\">by ARCA</span>\n            </button>\n\n            {/* ?   */}\n            <div className=\"flex items-center gap-3\">\n              <button\n                type=\"button\"\n                onClick={startTutorial}\n                className=\"p-2 rounded-lg text-white/90 hover:bg-white/10 hover:text-white transition-colors\"\n                aria-label=\"\"\n                title=\"\"\n              >\n                <HelpCircle className=\"w-5 h-5\" />\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setMenuOpen((v) => !v)}\n                className=\"p-2 rounded-lg text-white hover:bg-white/10 transition-colors\"\n                aria-label=\"\"\n                title=\"\"\n              >\n                {menuOpen ? <X className=\"w-6 h-6\" /> : <Menu className=\"w-6 h-6\" />}\n              </button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* User Info Bar */}\n      <div className=\"bg-gray-50 dark:bg-gray-900 transition-colors\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-2\">\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            {user.name} {' '}\n            {activeTab === 'unified'\n              ? ''\n              : activeTab === 'overview'\n              ? ''\n              : activeTab === 'weight'\n              ? ''\n              : activeTab === 'insights'\n              ? ''\n              : activeTab === 'performance'\n              ? ''\n              : activeTab === 'conditioning'\n              ? ''\n              : activeTab === 'cycle'\n              ? ''\n               : activeTab === 'nutrition'\n              ? 'AI'\n              : activeTab === 'gamification'\n              ? ''\n              : ''}\n          </p>\n        </div>\n      </div>\n\n      {/* Hamburger Menu Dropdown */}\n      {menuOpen && (\n        <div className=\"fixed inset-0 z-50\" onClick={() => setMenuOpen(false)}>\n          <div className=\"absolute inset-0 bg-black bg-opacity-50\"></div>\n\n          <div\n            className=\"absolute top-20 right-4 bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-72 max-h-[calc(100vh-6rem)] overflow-y-auto\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"p-2\">\n              {/*   */}\n              <button type=\"button\"\n                onClick={() => {\n                  setActiveTab('unified');\n                  setMenuOpen(false);\n                }}\n                className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                  activeTab === 'unified'\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n              >\n                <LayoutDashboard className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n\n              {/*  */}\n              <button type=\"button\"\n                onClick={() => {\n                  setActiveTab('weight');\n                  setMenuOpen(false);\n                }}\n                className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                  activeTab === 'weight'\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n              >\n                <Scale className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n\n              {/*  */}\n              <button type=\"button\"\n                onClick={() => {\n                  setActiveTab('conditioning');\n                  setMenuOpen(false);\n                }}\n                className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                  activeTab === 'conditioning'\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n              >\n                <Heart className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n\n              {/*  */}\n              {normalizedGenderBinary === 'female' && (\n                <button type=\"button\"\n                  onClick={() => {\n                    setActiveTab('cycle');\n                    setMenuOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                    activeTab === 'cycle'\n                      ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                  }`}\n                >\n                  <Droplets className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\"></span>\n                </button>\n              )}\n\n              {/*  */}\n              <button type=\"button\"\n                onClick={() => {\n                  setActiveTab('overview');\n                  setMenuOpen(false);\n                }}\n                className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                  activeTab === 'overview'\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n              >\n                <Activity className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n\n              {/*FTT*/}\n              {canUseFTT && (\n                <button type=\"button\"\n                  onClick={() => {\n                    setActiveTab('ftt');\n                    setMenuOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                    activeTab === 'ftt'\n                      ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                  }`}\n                >\n                  <Activity className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\">10</span>\n                </button>\n              )}\n\n\n              {/**/}\n              {canUseNutrition && (\n                <button type=\"button\"\n                  onClick={() => {\n                    safeSetActiveTab('nutrition');\n                    setMenuOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                    activeTab === 'nutrition'\n                      ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                  }`}\n                >\n                  <Flame className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\"></span>\n                </button>\n              )}\n\n              {/*  */}\n              <button type=\"button\"\n                onClick={() => {\n                  setActiveTab('performance');\n                  setMenuOpen(false);\n                }}\n                className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                  activeTab === 'performance'\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n              >\n                <Zap className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n\n              {/*  */}\n              <button type=\"button\"\n                onClick={() => {\n                  setActiveTab('gamification');\n                  setMenuOpen(false);\n                }}\n                className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                  activeTab === 'gamification'\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n                data-tutorial=\"gamification-tab\"\n              >\n                <Trophy className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n\n              {/*  */}\n              <div className=\"border-t border-gray-200 dark:border-gray-700 my-2\"></div>\n\n              <button type=\"button\"\n                onClick={() => {\n                  setActiveTab('settings');\n                  setMenuOpen(false);\n                }}\n                className={`w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-colors ${\n                  activeTab === 'settings'\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n              >\n                <Settings className=\"w-4 h-4\" />\n                <span className=\"text-sm font-medium\"></span>\n              </button>\n\n              {/*  */}\n              <div className=\"border-t border-gray-200 dark:border-gray-700 my-1\"></div>\n\n              {onNavigateToHelp && (\n                <button type=\"button\"\n                  onClick={() => {\n                    setMenuOpen(false);\n                    onNavigateToHelp();\n                  }}\n                  className=\"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700\"\n                >\n                  <HelpCircle className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\"></span>\n                </button>\n              )}\n\n              {onNavigateToPrivacy && (\n                <button type=\"button\"\n                  onClick={() => {\n                    setMenuOpen(false);\n                    onNavigateToPrivacy();\n                  }}\n                  className=\"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700\"\n                >\n                  <Shield className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\"></span>\n                </button>\n              )}\n\n              {onNavigateToTerms && (\n                <button type=\"button\"\n                  onClick={() => {\n                    setMenuOpen(false);\n                    onNavigateToTerms();\n                  }}\n                  className=\"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700\"\n                >\n                  <FileText className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\"></span>\n                </button>\n              )}\n\n              {onNavigateToCommercial && (\n                <button type=\"button\"\n                  onClick={() => {\n                    setMenuOpen(false);\n                    onNavigateToCommercial();\n                  }}\n                  className=\"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700\"\n                >\n                  <Building2 className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\"></span>\n                </button>\n              )}\n\n              {onLogout && (\n                <>\n                  <div className=\"border-t border-gray-200 dark:border-gray-700 my-2\"></div>\n                  <button type=\"button\"\n                    onClick={async () => {\n                      setMenuOpen(false);\n                      await onLogout();\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20\"\n                  >\n                    <LogOut className=\"w-4 h-4\" />\n                    <span className=\"text-sm font-medium\"></span>\n                  </button>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-4 sm:pt-4 sm:pb-8\">\n        {activeTab === 'unified' ? (\n          <>\n      {/*   */}\n      <div className=\"mb-4\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-5 transition-colors\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">\n              \n            </span>\n\n            {/*  or  */}\n            {phaseLoading ? (\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\"></span>\n            ) : phaseError ? (\n              <span className=\"text-xs text-red-600 dark:text-red-400\"></span>\n            ) : todayPhase ? (\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                {toShortRange(todayPhase.start_date, todayPhase.end_date)}\n              </span>\n            ) : (\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\"></span>\n            )}\n          </div>\n\n          {/* Body */}\n          {phaseLoading ? (\n            <div className=\"mt-3\">\n              <div className=\"h-7 w-28 bg-gray-100 dark:bg-gray-700 rounded animate-pulse\" />\n              <div className=\"mt-3 flex gap-2\">\n                <div className=\"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse\" />\n                <div className=\"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse\" />\n                <div className=\"h-6 w-14 bg-gray-100 dark:bg-gray-700 rounded-full animate-pulse\" />\n              </div>\n              <div className=\"mt-3 h-4 w-4/5 bg-gray-100 dark:bg-gray-700 rounded animate-pulse\" />\n            </div>\n          ) : phaseError ? (\n            <div className=\"mt-3 text-sm text-red-700 dark:text-red-300\">\n              {phaseError}\n            </div>\n          ) : todayPhase ? (\n            <>\n              {/* pre */}\n              <h3 className=\"mt-2 text-2xl font-semibold text-gray-900 dark:text-white\">\n                {phaseLabel(todayPhase.phase_type)}\n              </h3>\n\n              {/* Tags */}\n              {Array.isArray(todayPhase.focus_tags) && todayPhase.focus_tags.length > 0 && (\n                <div className=\"mt-3 flex flex-wrap gap-2\">\n                  {todayPhase.focus_tags.slice(0, 6).map((tag, i) => (\n                    <span\n                      key={`${tag}-${i}`}\n                      className=\"text-xs px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/15 text-blue-700 dark:text-blue-200\"\n                    >\n                      {tag}\n                    </span>\n                  ))}\n                  {todayPhase.focus_tags.length > 6 && (\n                    <span className=\"text-xs px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200\">\n                      +{todayPhase.focus_tags.length - 6}\n                    </span>\n                  )}\n                </div>\n              )}\n\n              {/* Note */}\n              <p className=\"mt-3 text-sm text-gray-700 dark:text-gray-200 line-clamp-2\">\n                {phaseHints.base}\n              </p>\n            </>\n          ) : (\n            <div className=\"mt-3 text-sm text-gray-600 dark:text-gray-300\">\n              \n            </div>\n          )}\n \n\n            {/* Next/ */}\n            {!phaseLoading && !phaseError && Array.isArray(nextPhases) && nextPhases.length > 0 && (\n              <div className=\"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\"></p>\n                  <p className=\"text-[11px] text-gray-400 dark:text-gray-500\"></p>\n                </div>\n\n                <div className=\"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1\">\n                  {nextPhases.slice(0, 8).map((p, idx) => (\n                    <div\n                      key={`${p.start_date}-${p.end_date}-${idx}`}\n                      className=\"min-w-[140px] rounded-lg border border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2\"\n                    >\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"text-sm font-semibold text-gray-900 dark:text-white truncate\">\n                          {phaseLabel(p.phase_type)}\n                        </div>\n                        <div className=\"text-[11px] text-gray-500 dark:text-gray-400 whitespace-nowrap\">\n                          {toShortRange(p.start_date, p.end_date)}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n            <ConsolidatedOverviewDashboard\n              acwrData={acwrData}\n              weightRecords={weightRecords}\n              sleepRecords={normalizedSleepRecords}\n              motivationRecords={motivationRecords}\n              trainingRecords={records}\n              menstrualCycles={menstrualCycles}\n              userGender={normalizedGenderFull}\n              onOpenDetailView={(section) => {\n                if (section === 'training') setActiveTab('overview');\n                else if (section === 'weight') setActiveTab('weight');\n                else if (section === 'conditioning') setActiveTab('conditioning');\n                else if (section === 'cycle') {\n                  if (normalizedGenderBinary === 'female') setActiveTab('cycle');\n                }\n              }}\n              onQuickAdd={() => setShowUnifiedCheckIn(true)}\n            />\n\n\n\n          {/*  nutrition_enabled=true  */}\n          {canUseNutrition && (\n            <div className=\"mt-6\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveTab(\"nutrition\")}\n                className=\"w-full text-left\"\n                aria-label=\"\"\n              >\n                <div className=\"rounded-xl hover:opacity-95 active:opacity-90 transition\">\n                <NutritionOverview\n                  totals={nutritionTotalsToday}\n                  targets={targets}\n                  loading={nutritionLoading}\n                  subtitle={`${recordDate}  ${phaseHints.nutrition}`}\n                />\n                </div>\n              </button>\n            </div>\n          )}\n\n            <div className=\"mt-6\">\n              <DailyReflectionCard userId={user.id} />\n            </div>\n\n            {/*   */}\n            <div className=\"mt-4\">\n              <ShareStatusButton userId={user.id} highlight={highPriorityAlerts.length > 0} />\n            </div>\n\n            <div className=\"mt-6\">\n              <MultiMetricTimeline\n                acwrData={acwrData}\n                weightRecords={weightRecords}\n                sleepRecords={timelineSleepRecords}\n                motivationRecords={motivationRecords}\n              />\n            </div>\n\n            {highPriorityAlerts.length > 0 && (\n              <div className=\"mt-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6\">\n                <div className=\"flex items-center\">\n                  <AlertTriangle className=\"w-6 h-6 text-red-600 dark:text-red-400 mr-3\" />\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-red-900 dark:text-red-200\"></h3>\n                    <p className=\"text-sm text-red-700 dark:text-red-300\">\n                      \n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n\n  \n        ) : activeTab === \"nutrition\" ? (\n          canUseNutrition ? (\n            <Suspense\n              fallback={\n                <div className=\"flex items-center justify-center h-64\">\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n                </div>\n              }\n            >\n              <AthleteNutritionDashboardView\n                user={user}\n                date={today}\n                nutritionLogs={nutritionLogsToday}\n                nutritionTotals={normalizedNutritionTotalsToday}\n                nutritionLoading={nutritionLoading}\n                nutritionError={nutritionError}\n                onBackHome={() => setActiveTab(\"unified\")}\n                latestInbody={latestInbody ?? null}\n                trainingRecords={records ?? []}\n                latestWeightKg={latestWeight ?? null}\n                onRefreshNutrition={refetchNutritionToday}\n              />\n            </Suspense>\n          ) : null\n\n        ) : activeTab === 'ftt' ? (\n          canUseFTT ? (\n            <FTTCheck\n              userId={user.id}\n              onBackHome={() => setActiveTab('unified')}\n            />\n          ) : null\n\n\n\n\n        ) : activeTab === 'overview' ? (\n          <>\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8\">\n              {/* Left Column - Training Form and Alerts */}\n              <div className=\"lg:col-span-1 space-y-6\">\n                {/* Alert Summary */}\n                {userAlerts.length > 0 && (\n                  <AlertSummary\n                    alerts={userAlerts}\n                    onViewAll={() => {\n                      // noopOK\n                    }}\n                  />\n                )}\n\n                <div className=\"mt-3\">\n                  <ShareStatusButton userId={user.id} highlight={highPriorityAlerts.length > 0} />\n                </div>\n\n                {/* High Priority Alert Banner */}\n                {highPriorityAlerts.length > 0 && (\n                  <div className=\"bg-red-50 border border-red-200 rounded-xl p-4\">\n                    <div className=\"flex items-center\">\n                      <AlertTriangle className=\"w-6 h-6 text-red-600 mr-3\" />\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold text-red-900\"></h3>\n                        <p className=\"text-sm text-red-700\">\n                          \n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Cross-tab reference: Today's weight */}\n                {todayWeight && (\n                  <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4 transition-colors\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-xs text-green-600 dark:text-green-400 mb-1\"></p>\n                        <p className=\"text-2xl font-bold text-green-700 dark:text-green-300\">\n                          {Number(todayWeight.weight_kg).toFixed(1)} kg\n                        </p>\n                      </div>\n                      <button type=\"button\" onClick={() => setActiveTab('weight')} className=\"text-sm text-green-600 dark:text-green-400 hover:underline\">\n                         \n                      </button>\n                    </div>\n                  </div>\n                )}\n\n                {/* Training Form Section */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\" data-tutorial=\"training-form\">\n                  <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n                    <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white\"></h2>\n                    <Calendar className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-400\" />\n                  </div>\n\n                  <DerivedStatsBar daysWithData={daysWithData} consecutiveDays={consecutiveDays} weeklyAverage={weeklyAverage} />\n\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300 mb-3\">\n                    {phaseHints.training}\n                  </p>\n\n                  <TrainingForm\n                    userId={user.id}\n                    onSubmit={handleTrainingSubmit}\n                    onCheckExisting={checkExistingTrainingRecord}\n                    onUpdate={handleTrainingUpdate}\n                    loading={loading}\n                    lastRecord={normalizedLastTrainingRecord}\n                    weeklyAverage={weeklyAverage}\n                    daysWithData={daysWithData}\n                    consecutiveDays={consecutiveDays}\n                  />\n                </div>\n\n                {/* ACWR Status Card */}\n                {latestACWR && (\n                  <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">ACWR</h3>\n                      <TrendingUp className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 dark:text-gray-500\" />\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"text-2xl sm:text-3xl font-bold mb-2\" style={{ color: getRiskColor(latestACWR.riskLevel) }}>\n                        {latestACWR.acwr}\n                      </div>\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">{getRiskLabel(latestACWR.riskLevel ?? 'unknown')}</div>\n                      <div className=\"grid grid-cols-2 gap-3 sm:gap-4 text-sm\">\n                        <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n                          <p className=\"text-gray-600 dark:text-gray-400 text-xs sm:text-sm\"></p>\n                          <p className=\"font-semibold text-sm sm:text-base dark:text-white\">{latestACWR.acuteLoad}</p>\n                        </div>\n                        <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n                          <p className=\"text-gray-600 dark:text-gray-400 text-xs sm:text-sm\"></p>\n                          <p className=\"font-semibold text-sm sm:text-base dark:text-white\">{latestACWR.chronicLoad}</p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Right Column - Chart Section */}\n              <div className=\"lg:col-span-2\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\" data-tutorial=\"acwr-chart\">\n                  <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6\">ACWR</h2>\n                  {loading ? (\n                    <div className=\"flex items-center justify-center h-64 sm:h-96\">\n                      <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n                    </div>\n                  ) : (\n                    <ACWRChart data={acwrData} daysWithData={daysWithData} isDarkMode={isDarkMode} />\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {/* Training Records Section */}\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mt-6 transition-colors\">\n              <TrainingRecordsList\n                records={records}\n                onUpdate={handleTrainingUpdateForList}\n                onDelete={deleteTrainingRecord}\n                loading={loading}\n                allowEdit={true}\n                allowDelete={true}\n                allowDateEdit={false}\n                showLimited={true}\n                limitCount={10}\n              />\n            </div>\n          </>\n        ) : activeTab === 'weight' ? (\n          /* Weight Management Tab */\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8\">\n            {/* Left Column - Weight Form and Stats */}\n            <div className=\"lg:col-span-1 space-y-6\">\n              {/* Cross-tab reference: Latest ACWR */}\n              {latestACWR && (\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 transition-colors\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-xs text-blue-600 dark:text-blue-400 mb-1\">ACWR</p>\n                      <p className=\"text-2xl font-bold\" style={{ color: getRiskColor(latestACWR.riskLevel) }}>\n                        {latestACWR.acwr}\n                      </p>\n                      <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">{getRiskLabel(latestACWR.riskLevel ?? 'unknown')}</p>\n                    </div>\n                    <button type=\"button\" onClick={() => setActiveTab('overview')} className=\"text-sm text-blue-600 dark:text-blue-400 hover:underline\">\n                       \n                    </button>\n                  </div>\n                </div>\n              )}\n\n              {/* Weight Stats Card */}\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n                <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4\"></h3>\n                <div className=\"space-y-4\">\n                  <div className=\"bg-blue-50 rounded-lg p-4\">\n                    <p className=\"text-xs text-blue-600 mb-1\"></p>\n                    <p className=\"text-2xl font-bold text-blue-700\">\n                      {getLatestWeight() !== null ? `${getLatestWeight()!.toFixed(1)} kg` : ''}\n                    </p>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">30</p>\n                      <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                        {getWeightChange(30) !== null ? (\n                          <>\n                            {getWeightChange(30)! > 0 ? '+' : ''}\n                            {getWeightChange(30)!.toFixed(1)} kg\n                          </>\n                        ) : (\n                          '-'\n                        )}\n                      </p>\n                    </div>\n\n                    <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 transition-colors\">\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\"></p>\n                      <p className=\"text-lg font-bold text-gray-900 dark:text-white\">{weightRecords.length}</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* InBody Latest */}\n              {inbodyLoading ? (\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n                  <div className=\"flex items-center justify-center h-24\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n                  </div>\n                </div>\n              ) : inbodyError ? (\n                <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4\">\n                  <p className=\"text-sm text-red-700 dark:text-red-300\">InBody{inbodyError}</p>\n                </div>\n              ) : latestInbody ? (\n                <div className=\"space-y-6\">\n                  <InBodyLatestCard latest={latestInbody} loading={inbodyLoading} error={inbodyError} />\n                  <InBodyCharts records={inbodyRecords} gender={normalizedGenderBinary} />\n                </div>\n              ) : (\n                <div className=\"bg-gray-50 dark:bg-gray-800 rounded-xl p-6 text-center\">\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">InBody</p>\n                </div>\n              )}\n\n              {/* BMI Display - Show only if height is set */}\n              {user.height_cm && latestWeight && (\n                <BMIDisplay weightKg={latestWeight} heightCm={user.height_cm} dateOfBirth={user.date_of_birth} gender={normalizedGenderFull} />\n              )}\n\n              {!user.height_cm && (\n                <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 transition-colors\">\n                  <p className=\"text-sm text-yellow-700 dark:text-yellow-300\">\n                    BMI\n                  </p>\n                </div>\n              )}\n\n              {/* Weight Form */}\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n                <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n                  <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white\"></h2>\n                  <Scale className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-400\" />\n                </div>\n                <WeightForm\n                  onSubmit={addWeightRecord}\n                  onCheckExisting={checkExistingWeightRecord}\n                  onUpdate={updateWeightRecord}\n                  loading={weightLoading}\n                  lastRecord={lastWeightRecord}\n                />\n              </div>\n            </div>\n\n            {/* Right Column - Chart */}\n            <div className=\"lg:col-span-2\">\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 mb-6 transition-colors\">\n                <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6\"></h2>\n                {weightLoading ? (\n                  <div className=\"flex items-center justify-center h-64 sm:h-80\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n                  </div>\n                ) : (\n                  <WeightChart data={weightRecords} />\n                )}\n              </div>\n\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n                <WeightRecordsList records={weightRecords} onUpdate={updateWeightRecord} onDelete={deleteWeightRecord} loading={weightLoading} />\n              </div>\n            </div>\n          </div>\n        ) : activeTab === 'insights' ? (\n          /* Correlation Analysis Tab */\n          <div className=\"space-y-6\">\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n              <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6\">ACWR</h2>\n              {loading || weightLoading ? (\n                <div className=\"flex items-center justify-center h-96\">\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n                </div>\n              ) : (\n                <WeightACWRChart acwrData={acwrData} weightData={weightRecords} />\n              )}\n            </div>\n\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 sm:p-6 transition-colors\">\n              <InsightCard acwrData={acwrData} weightData={weightRecords} />\n            </div>\n          </div>\n       ) : activeTab === 'performance' ? (\n        <Suspense\n          fallback={\n            <div className=\"flex items-center justify-center h-64\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n            </div>\n          }\n        >\n          <AthletePerformanceView\n            user={user}\n            onBackHome={() => setActiveTab('unified')}\n          />\n        </Suspense>\n      ) : activeTab === 'conditioning' ? (\n          /* Conditioning Tab */\n          <div className=\"space-y-6\">\n            <ConditioningSummaryCard\n              latestACWR={latestACWR}\n              sleepHours={getLatestSleep()?.sleep_hours ? Number(getLatestSleep()!.sleep_hours) : null}\n              sleepQuality={getLatestSleep()?.sleep_quality ?? null}\n              motivationLevel={getLatestMotivation()?.motivation_level ?? null}\n              energyLevel={getLatestMotivation()?.energy_level ?? null}\n              stressLevel={getLatestMotivation()?.stress_level ?? null}\n            />\n\n            {/* Sleep Section */}\n            <div className=\"space-y-6\">\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n                <div className=\"flex items-center justify-between mb-6\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h2>\n                  <Moon className=\"w-6 h-6 text-indigo-500\" />\n                </div>\n\n                <p className=\"text-sm text-gray-600 dark:text-gray-300 mb-3\">\n                  {phaseHints.sleep}\n                </p>\n\n                <SleepForm\n                  onSubmit={addSleepRecord}\n                  onCheckExisting={checkExistingSleepRecord}\n                  onUpdate={updateSleepRecord}\n                  loading={sleepLoading}\n                  lastRecord={normalizedLastSleepRecord}\n                />\n              </div>\n\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\"></h3>\n                {sleepLoading ? (\n                  <div className=\"flex items-center justify-center h-96\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n                  </div>\n                ) : (\n                  <SleepChart data={sleepRecords} />\n                )}\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2\">7</p>\n                  <p className=\"text-2xl font-bold text-indigo-600 dark:text-indigo-400\">{getAverageSleepHours(7)?.toFixed(1) || '-'}h</p>\n                </div>\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2\">7</p>\n                  <p className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">\n                    {getAverageSleepQuality(7)?.toFixed(1) || '-'}/5\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Motivation Section */}\n            <div className=\"space-y-6\">\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n                <div className=\"flex items-center justify-between mb-6\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h2>\n                  <Heart className=\"w-6 h-6 text-blue-500\" />\n                </div>\n\n                <MotivationForm\n                  onSubmit={addMotivationRecord}\n                  onCheckExisting={checkExistingMotivationRecord}\n                  onUpdate={updateMotivationRecord}\n                  loading={motivationLoading}\n                  lastRecord={normalizedLastMotivationRecord ?? undefined}\n                />\n              </div>\n\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors\">\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\"></h3>\n                {motivationLoading ? (\n                  <div className=\"flex items-center justify-center h-96\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n                  </div>\n                ) : (\n                  <MotivationChart data={motivationRecords} />\n                )}\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2\"></p>\n                  <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{getAverageMotivation(7)?.toFixed(1) || '-'}/10</p>\n                </div>\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2\"></p>\n                  <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{getAverageEnergy(7)?.toFixed(1) || '-'}/10</p>\n                </div>\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 transition-colors\">\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2\"></p>\n                  <p className=\"text-2xl font-bold text-red-600 dark:text-red-400\">{getAverageStress(7)?.toFixed(1) || '-'}/10</p>\n                </div>\n              </div>\n            </div>\n          </div>\n       ) : activeTab === 'cycle' ? (\n        <AthleteCycleView userId={user.id} gender={normalizedGenderBinary} />\n\n        ) : activeTab === 'gamification' ? (\n            <AthleteGamificationView\n            user={user}\n          />\n          \n        ) : activeTab === 'messages' ? (\n          <Suspense\n            fallback={\n              <div className=\"flex items-center justify-center h-64\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n              </div>\n            }\n          >\n            <MessagingPanel userId={user.id} userName={user.name} onClose={() => setActiveTab('unified')} />\n          </Suspense>\n        ) : activeTab === 'settings' ? (\n          <AthleteSettingsView user={user} onOpenProfileEdit={() => setShowProfileEdit(true)} />\n        ) : null}\n      </main>\n\n      {/* Export Panel */}\n      {showExportPanel && (\n        <Suspense\n          fallback={\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-white\"></div>\n            </div>\n          }\n        >\n          <ExportPanel user={user} trainingRecords={records} acwrData={acwrData} onClose={() => setShowExportPanel(false)} />\n        </Suspense>\n      )}\n\n      {/* Profile Edit Modal */}\n      {showProfileEdit && (\n        <ProfileEditForm\n          user={user}\n          onUpdate={async () => {\n            await onUserUpdated?.();\n          }}\n          onClose={() => setShowProfileEdit(false)}\n        />\n      )}\n\n      <TutorialController\n        steps={getTutorialSteps('athlete')}\n        isActive={isActive}\n        onComplete={completeTutorial}\n        onSkip={skipTutorial}\n        currentStepIndex={currentStepIndex}\n        onStepChange={setCurrentStepIndex}\n      />\n\n      {showUnifiedCheckIn && (\n        <UnifiedDailyCheckIn\n          userId={user.id}\n          userGender={normalizedGenderBinary}\n          onTrainingSubmit={handleTrainingSubmitForCheckIn}\n          onTrainingCheckExisting={checkExistingTrainingRecord}\n          onTrainingUpdate={handleTrainingUpdateForCheckIn}\n          onWeightSubmit={addWeightRecord}\n          onWeightCheckExisting={checkExistingWeightRecord}\n          onWeightUpdate={updateWeightRecord}\n          onSleepSubmit={addSleepRecord}\n          onSleepCheckExisting={checkExistingSleepRecord}\n          onSleepUpdate={updateSleepRecord}\n          onMotivationSubmit={addMotivationRecord}\n          onMotivationCheckExisting={checkExistingMotivationRecord}\n          onMotivationUpdate={updateMotivationRecord}\n          onCycleSubmit={addMenstrualCycle}\n          onCycleUpdate={updateMenstrualCycle}\n          onClose={() => setShowUnifiedCheckIn(false)}\n          lastTrainingRecord={normalizedLastTrainingRecordForCheckIn ?? null}\n          lastWeightRecord={\n            normalizedLastWeightRecord ? { weight_kg: Number(normalizedLastWeightRecord.weight_kg), date: normalizedLastWeightRecord.date } : null\n          }\n          lastSleepRecord={normalizedLastSleepRecord ?? null}\n          lastMotivationRecord={normalizedLastMotivationRecord ?? null}\n        />\n      )}\n\n            {activeTab === 'unified' && (\n           <FloatingActionButton\n           onClick={() => setShowUnifiedCheckIn(true)}\n           onCameraClick={canUseNutrition ? () => galleryInputRef.current?.click() : undefined}\n         />\n            )}\n\n            {/* hidden input: photo picker */}\n            <input\n              ref={galleryInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              className={fileInputClass}\n              onChange={(e) => {\n                const file = e.target.files?.[0];\n                e.target.value = \"\";\n                if (file) handlePickPhoto(file);\n              }}\n            />\n            {/*  Entry Popup /  */}\n            {shouldShowEntryPop && entryPop.mode !== \"none\" && (\n              <EntryPopup\n                open={shouldShowEntryPop}\n                mode={entryPop.mode === \"welcome_back\" ? \"welcome_back\" : \"daily_tip\"}\n                daysAway={entryPop.daysAway}\n                message={entryPopMessage}\n                onClose={entryPop.dismiss}\n              />\n            )}\n    </div>\n  );\n}","import { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { Database } from '../lib/database.types';\n\ntype SleepRecord = Database['public']['Tables']['sleep_records']['Row'];\ntype SleepInsert = Database['public']['Tables']['sleep_records']['Insert'];\ntype SleepUpdate = Database['public']['Tables']['sleep_records']['Update'];\n\nexport function useSleepData(userId: string) {\n  const [records, setRecords] = useState<SleepRecord[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchRecords = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const { data, error: fetchError } = await supabase\n        .from('sleep_records')\n        .select('*')\n        .eq('user_id', userId)\n        .order('date', { ascending: false });\n\n      if (fetchError) throw fetchError;\n\n      setRecords(data || []);\n    } catch (err) {\n      console.error('Error fetching sleep records:', err);\n      setError(err instanceof Error ? err.message : '');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (userId) {\n      fetchRecords();\n    }\n  }, [userId]);\n\n  const checkExistingRecord = async (date: string): Promise<SleepRecord | null> => {\n    try {\n      const { data, error } = await supabase\n        .from('sleep_records')\n        .select('*')\n        .eq('user_id', userId)\n        .eq('date', date)\n        .maybeSingle();\n\n      if (error) throw error;\n      return data;\n    } catch (error) {\n      console.error('Error checking existing record:', error);\n      return null;\n    }\n  };\n\n  const addSleepRecord = async (data: {\n    sleep_hours: number;\n    date: string;\n    sleep_quality?: number;\n    bedtime?: string;\n    waketime?: string;\n    notes?: string;\n  }) => {\n    try {\n      const { data: authData } = await supabase.auth.getUser();\n      if (!authData.user) {\n        throw new Error('');\n      }\n\n      const insertData: SleepInsert = {\n        user_id: authData.user.id,\n        date: data.date,\n        sleep_hours: data.sleep_hours,\n        sleep_quality: data.sleep_quality || null,\n        bedtime: data.bedtime || null,\n        waketime: data.waketime || null,\n        notes: data.notes || null\n      };\n\n      const { data: newRecord, error: insertError } = await supabase\n        .from('sleep_records')\n        .insert(insertData)\n        .select()\n        .single();\n\n      if (insertError) throw insertError;\n\n      setRecords(prev => [newRecord, ...prev].sort((a, b) =>\n        new Date(b.date).getTime() - new Date(a.date).getTime()\n      ));\n    } catch (err) {\n      console.error('Error adding sleep record:', err);\n      throw err;\n    }\n  };\n\n  const updateSleepRecord = async (\n    id: string,\n    data: {\n      sleep_hours?: number;\n      sleep_quality?: number;\n      bedtime?: string;\n      waketime?: string;\n      notes?: string;\n    }\n  ) => {\n    try {\n      const updateData: SleepUpdate = {\n        sleep_hours: data.sleep_hours,\n        sleep_quality: data.sleep_quality !== undefined ? data.sleep_quality : null,\n        bedtime: data.bedtime !== undefined ? data.bedtime : null,\n        waketime: data.waketime !== undefined ? data.waketime : null,\n        notes: data.notes !== undefined ? data.notes : null\n      };\n\n      const { data: updatedRecord, error: updateError } = await supabase\n        .from('sleep_records')\n        .update(updateData)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (updateError) throw updateError;\n\n      setRecords(prev =>\n        prev.map(record => (record.id === id ? updatedRecord : record))\n      );\n    } catch (err) {\n      console.error('Error updating sleep record:', err);\n      throw err;\n    }\n  };\n\n  const deleteSleepRecord = async (id: string) => {\n    try {\n      const { error: deleteError } = await supabase\n        .from('sleep_records')\n        .delete()\n        .eq('id', id);\n\n      if (deleteError) throw deleteError;\n\n      setRecords(prev => prev.filter(record => record.id !== id));\n    } catch (err) {\n      console.error('Error deleting sleep record:', err);\n      throw err;\n    }\n  };\n\n  const getAverageSleepHours = (days: number = 7): number | null => {\n    if (records.length === 0) return null;\n\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n\n    const recentRecords = records.filter(\n      record => new Date(record.date) >= cutoffDate\n    );\n\n    if (recentRecords.length === 0) return null;\n\n    const totalHours = recentRecords.reduce(\n      (sum, record) => sum + Number(record.sleep_hours),\n      0\n    );\n\n    return totalHours / recentRecords.length;\n  };\n\n  const getAverageSleepQuality = (days: number = 7): number | null => {\n    if (records.length === 0) return null;\n\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n\n    const recentRecords = records.filter(\n      record => new Date(record.date) >= cutoffDate && record.sleep_quality !== null\n    );\n\n    if (recentRecords.length === 0) return null;\n\n    const totalQuality = recentRecords.reduce(\n      (sum, record) => sum + (record.sleep_quality || 0),\n      0\n    );\n\n    return totalQuality / recentRecords.length;\n  };\n\n  const getLatestSleep = (): SleepRecord | null => {\n    if (records.length === 0) return null;\n    return records[0];\n  };\n\n  const getSleepDeficit = (days: number = 7): number | null => {\n    const avgHours = getAverageSleepHours(days);\n    if (avgHours === null) return null;\n\n    const recommendedHours = 8;\n    return recommendedHours - avgHours;\n  };\n\n  return {\n    records,\n    loading,\n    error,\n    checkExistingRecord,\n    addSleepRecord,\n    updateSleepRecord,\n    deleteSleepRecord,\n    getAverageSleepHours,\n    getAverageSleepQuality,\n    getLatestSleep,\n    getSleepDeficit,\n    refresh: fetchRecords\n  };\n}\n","import { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { Database } from '../lib/database.types';\n\ntype MotivationRecord = Database['public']['Tables']['motivation_records']['Row'];\ntype MotivationInsert = Database['public']['Tables']['motivation_records']['Insert'];\ntype MotivationUpdate = Database['public']['Tables']['motivation_records']['Update'];\n\nexport function useMotivationData(userId: string) {\n  const [records, setRecords] = useState<MotivationRecord[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchRecords = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const { data, error: fetchError } = await supabase\n        .from('motivation_records')\n        .select('*')\n        .eq('user_id', userId)\n        .order('date', { ascending: false });\n\n      if (fetchError) throw fetchError;\n\n      setRecords(data || []);\n    } catch (err) {\n      console.error('Error fetching motivation records:', err);\n      setError(err instanceof Error ? err.message : '');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (userId) {\n      fetchRecords();\n    }\n  }, [userId]);\n\n  const checkExistingRecord = async (date: string): Promise<MotivationRecord | null> => {\n    try {\n      const { data, error } = await supabase\n        .from('motivation_records')\n        .select('*')\n        .eq('user_id', userId)\n        .eq('date', date)\n        .maybeSingle();\n\n      if (error) throw error;\n      return data;\n    } catch (error) {\n      console.error('Error checking existing record:', error);\n      return null;\n    }\n  };\n\n  const addMotivationRecord = async (data: {\n    motivation_level: number;\n    energy_level: number;\n    stress_level: number;\n    date: string;\n    mood?: string;\n    notes?: string;\n  }) => {\n    try {\n      if (!userId) {\n        throw new Error('ID');\n      }\n\n      const insertData: MotivationInsert = {\n        user_id: userId,\n        date: data.date,\n        motivation_level: data.motivation_level,\n        energy_level: data.energy_level,\n        stress_level: data.stress_level,\n        mood: data.mood || null,\n        notes: data.notes || null\n      };\n\n      //  INSERT  UPSERT \n      //   motivation_records_user_id_date_key\n      //  = user_id + date  onConflict \n      const { data: newRecord, error: upsertError } = await supabase\n        .from('motivation_records')\n        .upsert(insertData, {\n          onConflict: 'user_id,date'\n        })\n        .select()\n        .single();\n\n      if (upsertError) throw upsertError;\n\n      //  state  user_id + date \n      setRecords(prev => {\n        const filtered = prev.filter(\n          r => !(r.user_id === newRecord.user_id && r.date === newRecord.date)\n        );\n        return [newRecord, ...filtered].sort(\n          (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n        );\n      });\n    } catch (err) {\n      console.error('Error adding motivation record:', err);\n      throw err;\n    }\n  };\n\n  const updateMotivationRecord = async (\n    id: string,\n    data: {\n      motivation_level?: number;\n      energy_level?: number;\n      stress_level?: number;\n      mood?: string;\n      notes?: string;\n    }\n  ) => {\n    try {\n      const updateData: MotivationUpdate = {\n        motivation_level: data.motivation_level,\n        energy_level: data.energy_level,\n        stress_level: data.stress_level,\n        mood: data.mood !== undefined ? data.mood : null,\n        notes: data.notes !== undefined ? data.notes : null\n      };\n\n      const { data: updatedRecord, error: updateError } = await supabase\n        .from('motivation_records')\n        .update(updateData)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (updateError) throw updateError;\n\n      setRecords(prev =>\n        prev.map(record => (record.id === id ? updatedRecord : record))\n      );\n    } catch (err) {\n      console.error('Error updating motivation record:', err);\n      throw err;\n    }\n  };\n\n  const deleteMotivationRecord = async (id: string) => {\n    try {\n      const { error: deleteError } = await supabase\n        .from('motivation_records')\n        .delete()\n        .eq('id', id);\n\n      if (deleteError) throw deleteError;\n\n      setRecords(prev => prev.filter(record => record.id !== id));\n    } catch (err) {\n      console.error('Error deleting motivation record:', err);\n      throw err;\n    }\n  };\n\n  const getAverageMotivation = (days: number = 7): number | null => {\n    if (records.length === 0) return null;\n\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n\n    const recentRecords = records.filter(\n      record => new Date(record.date) >= cutoffDate\n    );\n\n    if (recentRecords.length === 0) return null;\n\n    const totalMotivation = recentRecords.reduce(\n      (sum, record) => sum + record.motivation_level,\n      0\n    );\n\n    return totalMotivation / recentRecords.length;\n  };\n\n  const getAverageEnergy = (days: number = 7): number | null => {\n    if (records.length === 0) return null;\n\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n\n    const recentRecords = records.filter(\n      record => new Date(record.date) >= cutoffDate\n    );\n\n    if (recentRecords.length === 0) return null;\n\n    const totalEnergy = recentRecords.reduce(\n      (sum, record) => sum + record.energy_level,\n      0\n    );\n\n    return totalEnergy / recentRecords.length;\n  };\n\n  const getAverageStress = (days: number = 7): number | null => {\n    if (records.length === 0) return null;\n\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n\n    const recentRecords = records.filter(\n      record => new Date(record.date) >= cutoffDate\n    );\n\n    if (recentRecords.length === 0) return null;\n\n    const totalStress = recentRecords.reduce(\n      (sum, record) => sum + record.stress_level,\n      0\n    );\n\n    return totalStress / recentRecords.length;\n  };\n\n  const getLatestMotivation = (): MotivationRecord | null => {\n    if (records.length === 0) return null;\n    return records[0];\n  };\n\n  const getMotivationTrend = (days: number = 7): 'improving' | 'declining' | 'stable' | null => {\n    if (records.length < 2) return null;\n\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n\n    const recentRecords = records\n      .filter(record => new Date(record.date) >= cutoffDate)\n      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n\n    if (recentRecords.length < 2) return null;\n\n    const midPoint = Math.floor(recentRecords.length / 2);\n    const firstHalf = recentRecords.slice(0, midPoint);\n    const secondHalf = recentRecords.slice(midPoint);\n\n    const firstAvg =\n      firstHalf.reduce((sum, r) => sum + r.motivation_level, 0) /\n      firstHalf.length;\n    const secondAvg =\n      secondHalf.reduce((sum, r) => sum + r.motivation_level, 0) /\n      secondHalf.length;\n\n    const diff = secondAvg - firstAvg;\n\n    if (diff > 0.5) return 'improving';\n    if (diff < -0.5) return 'declining';\n    return 'stable';\n  };\n\n  return {\n    records,\n    loading,\n    error,\n    checkExistingRecord,\n    addMotivationRecord,\n    updateMotivationRecord,\n    deleteMotivationRecord,\n    getAverageMotivation,\n    getAverageEnergy,\n    getAverageStress,\n    getLatestMotivation,\n    getMotivationTrend,\n    refresh: fetchRecords\n  };\n}","import { useState, useEffect } from 'react';\n\nexport function useDarkMode() {\n  const [isDarkMode, setIsDarkMode] = useState(() => {\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\n  });\n\n  useEffect(() => {\n    if (isDarkMode) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }, [isDarkMode]);\n\n  useEffect(() => {\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n    const handleChange = (e: MediaQueryListEvent) => {\n      setIsDarkMode(e.matches);\n    };\n\n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, []);\n\n  return { isDarkMode };\n}","// src/hooks/useTodayNutritionTotals.js\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\n\n/**\n *  nutrition_logs (kcal/P/F/C)\n * UX:\n * - loading totals  0 \n * - \n * - refetch \n */\nexport function useTodayNutritionTotals(userId, dateStr) {\n  const [logs, setLogs] = useState([]);\n  const [status, setStatus] = useState(\"idle\"); // idle | loading | ready | error\n  const [error, setError] = useState(null);\n  const [reloadKey, setReloadKey] = useState(0);\n\n  //  totals loading0\n  const lastTotalsRef = useRef({ cal: 0, p: 0, f: 0, c: 0 });\n\n  const refetch = useCallback(() => {\n    setReloadKey((k) => k + 1);\n  }, []);\n\n  useEffect(() => {\n    if (!userId || !dateStr) return;\n\n    let cancelled = false;\n\n    async function fetchLogs() {\n      setStatus(\"loading\");\n      setError(null);\n\n      try {\n        const { data, error } = await supabase\n          .from(\"nutrition_logs\")\n          .select(\n            \"id, record_date, meal_type, meal_slot, total_calories, p, f, c, is_edited, advice_markdown, image_url, image_path, analysis_status, analysis_error, created_at\"\n          )\n          .eq(\"user_id\", userId)\n          .eq(\"record_date\", dateStr)\n          .order(\"meal_type\", { ascending: true })\n          .order(\"meal_slot\", { ascending: true })\n          .order(\"created_at\", { ascending: true });\n\n        if (error) throw error;\n\n        if (!cancelled) {\n          setLogs(data ?? []);\n          setStatus(\"ready\");\n        }\n      } catch (e) {\n        console.error(\"[useTodayNutritionTotals] fetch error:\", e);\n        if (!cancelled) {\n          setLogs([]);\n          setStatus(\"error\");\n          setError(String(e?.message ?? e));\n        }\n      }\n    }\n\n    fetchLogs();\n    return () => {\n      cancelled = true;\n    };\n  }, [userId, dateStr, reloadKey]);\n\n  const totals = useMemo(() => {\n    if (status === \"loading\") {\n      // loadingUX\n      return lastTotalsRef.current;\n    }\n\n    const sum = { cal: 0, p: 0, f: 0, c: 0 };\n    let hasUnparsed = false;\n\n    for (const row of logs) {\n      if (\n        row.total_calories == null ||\n        row.p == null ||\n        row.f == null ||\n        row.c == null\n      ) {\n        hasUnparsed = true;\n      }\n\n      sum.cal += Number(row.total_calories ?? 0);\n      sum.p += Number(row.p ?? 0);\n      sum.f += Number(row.f ?? 0);\n      sum.c += Number(row.c ?? 0);\n    }\n\n    sum.p = Math.round(sum.p * 10) / 10;\n    sum.f = Math.round(sum.f * 10) / 10;\n    sum.c = Math.round(sum.c * 10) / 10;\n\n    const result = {\n      ...sum,\n      hasAnyLog: logs.length > 0,\n      hasUnparsed,\n    };\n\n    lastTotalsRef.current = result;\n    return result;\n  }, [logs, status]);\n\n  return {\n    logs,\n    totals,\n    loading: status === \"loading\",\n    status, // UI\n    error,\n    refetch,\n  };\n}","import { supabase } from \"./supabase\";\n\nexport async function upsertDailyEnergySnapshot(params: {\n  userId: string;\n  date: string; // yyyy-mm-dd\n  rpe: number;\n  durationMin: number;\n}) {\n  const { userId, date, rpe, durationMin } = params;\n  const srpe = (rpe ?? 0) * (durationMin ?? 0);\n\n  //  BMRDBnutrition_metabolism_snapshots\n  const { data: meta, error: metaErr } = await supabase\n    .from(\"nutrition_metabolism_snapshots\")\n    .select(\"bmr\")\n    .eq(\"user_id\", userId)\n    .order(\"calculated_at\", { ascending: false })\n    .limit(1)\n    .maybeSingle();\n\n  if (metaErr) throw metaErr;\n\n  // BMRUI\n  const bmr = meta?.bmr;\n  if (!bmr) return;\n\n  //  activity factor\n  const activityFactor =\n    srpe === 0 ? 1.2 :\n    srpe < 300 ? 1.4 :\n    srpe < 600 ? 1.6 :\n    srpe < 900 ? 1.8 : 2.0;\n\n  const tdee = Math.round(bmr * activityFactor);\n\n  //  11 upsertonConflict user_id,date\n  const { error } = await supabase\n    .from(\"daily_energy_snapshots\")\n    .upsert(\n      {\n        user_id: userId,\n        date,\n        bmr,\n        srpe,\n        activity_factor: activityFactor,\n        tdee,\n      },\n      { onConflict: \"user_id,date\" }\n    );\n\n  if (error) throw error;\n}","// src/components/AthleteList.tsx\nimport React, { useState, useMemo } from 'react';\nimport { User } from '../lib/supabase';\nimport {\n  Activity,\n  AlertTriangle,\n  ChevronRight,\n  Lock,\n  Unlock,\n  CheckCircle2,\n} from 'lucide-react';\n\n// ACWR \ntype RiskLevel = 'high' | 'caution' | 'good' | 'low' | 'unknown';\n\ninterface AthleteACWRInfo {\n  currentACWR: number | null;\n  riskLevel?: RiskLevel;\n  daysOfData?: number | null;\n}\n\n// StaffAthleteWithActivity \ntype AthleteWithActivity = User & {\n  training_days_28d?: number | null;\n  training_sessions_28d?: number | null;\n  last_training_date?: string | null;\n};\n\ntype CoachWeekAthleteCard = {\n  athlete_user_id: string;\n\n  week_duration_min: number;\n  week_rpe_avg: number | null;\n  week_load_sum: number;\n\n  sleep_hours_avg: number | null;\n  sleep_quality_avg: number | null;\n\n  motivation_avg: number | null;\n  energy_avg: number | null;\n  stress_avg: number | null;\n\n  // \n  is_sharing_active: boolean;\n  allow_condition: boolean;\n  allow_training: boolean;\n  allow_body: boolean;\n  allow_reflection: boolean;\n  allow_free_note: boolean;\n\n  // \n  action_total: number;\n  action_done: number;\n  action_done_rate: number; // 0-100\n};\n\ninterface AthleteListProps {\n  athletes: AthleteWithActivity[];\n  onAthleteSelect: (athlete: AthleteWithActivity) => void;\n  athleteACWRMap?: Record<string, AthleteACWRInfo>;\n\n  // : athlete_user_id -> card\n  weekCardMap?: Record<string, CoachWeekAthleteCard>;\n}\n\n// ACWR \nconst MIN_DAYS_FOR_ACWR = 21;\n\nexport function AthleteList({\n  athletes,\n  onAthleteSelect,\n  athleteACWRMap = {},\n  weekCardMap = {},\n}: AthleteListProps) {\n  const [search, setSearch] = useState('');\n  const [filterRisk, setFilterRisk] = useState<'all' | 'high'>('all');\n  const [filterSharing, setFilterSharing] = useState<'all' | 'on'>('all');\n  const displayName = (a: any) => a?.nickname || a?.name || '';\n\n  const filteredAthletes = useMemo(() => {\n    const s = search.trim().toLowerCase();\n\n    return athletes.filter((athlete) => {\n      const acwrInfo = athleteACWRMap[athlete.id];\n\n      // daysOfData  acwrInfo  training_days_28d \n      const daysOfData =\n        acwrInfo?.daysOfData ??\n        (typeof athlete.training_days_28d === 'number' ? athlete.training_days_28d : null);\n\n      const hasACWR =\n        daysOfData !== null &&\n        daysOfData >= MIN_DAYS_FOR_ACWR &&\n        typeof acwrInfo?.currentACWR === 'number' &&\n        Number.isFinite(acwrInfo.currentACWR) &&\n        acwrInfo.currentACWR > 0;\n\n      const riskLevel: RiskLevel = hasACWR ? (acwrInfo?.riskLevel ?? 'unknown') : 'unknown';\n\n      //   high caution \n      const riskMatch = filterRisk === 'all' ? true : riskLevel === 'high';\n\n      const card = weekCardMap[athlete.id];\n      const sharingMatch = filterSharing === 'all' ? true : !!card?.is_sharing_active;\n\n      const text = `${displayName(athlete)}`.toLowerCase()\n      const searchMatch = s === '' ? true : text.includes(s);\n\n      return riskMatch && sharingMatch && searchMatch;\n    });\n  }, [athletes, search, filterRisk, filterSharing, athleteACWRMap, weekCardMap]);\n\n  const renderRiskBadge = (riskLevel: RiskLevel) => {\n    switch (riskLevel) {\n      case 'high':\n        return (\n          <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700\">\n            \n          </span>\n        );\n      case 'caution':\n        return (\n          <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-700\">\n            \n          </span>\n        );\n      case 'good':\n        return (\n          <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700\">\n            \n          </span>\n        );\n      case 'low':\n        return (\n          <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-sky-100 text-sky-700\">\n            \n          </span>\n        );\n      default:\n        return (\n          <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-500\">\n            \n          </span>\n        );\n    }\n  };\n\n  //  YYYY-MM-DD  Date() \n  const formatDate = (dateStr: string | null | undefined) => {\n    if (!dateStr) return '';\n\n    const m = dateStr.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (m) {\n      const mm = Number(m[2]);\n      const dd = Number(m[3]);\n      if (Number.isFinite(mm) && Number.isFinite(dd)) return `${mm}/${dd}`;\n      return dateStr;\n    }\n\n    // timestamp\n    try {\n      const d = new Date(dateStr);\n      if (Number.isNaN(d.getTime())) return dateStr;\n      return `${d.getMonth() + 1}/${d.getDate()}`;\n    } catch {\n      return dateStr;\n    }\n  };\n\n  const fmt1 = (v: number | null | undefined) => {\n    if (v === null || v === undefined) return '-';\n    if (Number.isNaN(v)) return '-';\n    return v.toFixed(1);\n  };\n\n  const fmt0 = (v: number | null | undefined) => {\n    if (v === null || v === undefined) return '-';\n    if (Number.isNaN(v)) return '-';\n    return String(Math.round(v));\n  };\n\n  const renderSharingBadge = (card?: CoachWeekAthleteCard) => {\n    const on = !!card?.is_sharing_active;\n    return on ? (\n      <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200\">\n        <Unlock className=\"w-3 h-3\" />\n        ON\n      </span>\n    ) : (\n      <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-600 border border-gray-200\">\n        <Lock className=\"w-3 h-3\" />\n        OFF\n      </span>\n    );\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/*    */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n        <div className=\"relative flex-1\">\n          <input\n            type=\"text\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            placeholder=\"\"\n            className=\"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500\"\n          />\n          <Activity className=\"w-4 h-4 text-gray-400 absolute left-2.5 top-2.5\" />\n        </div>\n\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <button\n            type=\"button\"\n            onClick={() => setFilterRisk('all')}\n            className={`px-3 py-1.5 rounded-full text-xs font-medium border ${\n              filterRisk === 'all'\n                ? 'bg-green-50 text-green-700 border-green-200'\n                : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            \n          </button>\n\n          <button\n            type=\"button\"\n            onClick={() => setFilterRisk('high')}\n            className={`px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 ${\n              filterRisk === 'high'\n                ? 'bg-red-50 text-red-700 border-red-200'\n                : 'bg-white text-gray-600 border-gray-200 hover:bg-red-50 hover:text-red-700'\n            }`}\n          >\n            <AlertTriangle className=\"w-3 h-3\" />\n            \n          </button>\n\n          <button\n            type=\"button\"\n            onClick={() => setFilterSharing(filterSharing === 'on' ? 'all' : 'on')}\n            className={`px-3 py-1.5 rounded-full text-xs font-medium border inline-flex items-center gap-1 ${\n              filterSharing === 'on'\n                ? 'bg-emerald-50 text-emerald-700 border-emerald-200'\n                : 'bg-white text-gray-600 border-gray-200 hover:bg-emerald-50 hover:text-emerald-700'\n            }`}\n            title=\"ON\"\n          >\n            <Unlock className=\"w-3 h-3\" />\n            ON\n          </button>\n        </div>\n      </div>\n\n      {/*  */}\n      <div className=\"divide-y divide-gray-100 border border-gray-100 rounded-xl bg-white\">\n        {filteredAthletes.length === 0 ? (\n          <div className=\"p-6 text-center text-sm text-gray-500\"></div>\n        ) : (\n          filteredAthletes.map((athlete) => {\n            const acwrInfo = athleteACWRMap[athlete.id];\n\n            const daysOfData =\n              acwrInfo?.daysOfData ??\n              (typeof athlete.training_days_28d === 'number' ? athlete.training_days_28d : null);\n\n            const hasACWR =\n              daysOfData !== null &&\n              daysOfData >= MIN_DAYS_FOR_ACWR &&\n              typeof acwrInfo?.currentACWR === 'number' &&\n              Number.isFinite(acwrInfo.currentACWR) &&\n              acwrInfo.currentACWR > 0;\n\n            const riskLevel: RiskLevel = hasACWR ? (acwrInfo?.riskLevel ?? 'unknown') : 'unknown';\n\n            const acwrValue = hasACWR ? acwrInfo!.currentACWR!.toFixed(2) : '';\n\n            const remainingDays =\n              daysOfData !== null ? Math.max(MIN_DAYS_FOR_ACWR - daysOfData, 0) : null;\n\n            // \n            const card = weekCardMap[athlete.id];\n            const shareOn = !!card?.is_sharing_active;\n\n            // OFFUI\n            const disabled = !shareOn;\n\n            return (\n              <button\n                key={athlete.id}\n                type=\"button\"\n                onClick={() => {\n                  if (disabled) return;\n                  onAthleteSelect(athlete);\n                }}\n                disabled={disabled}\n                className={`w-full flex items-stretch justify-between px-4 sm:px-5 py-3 sm:py-4 text-left transition-colors ${\n                  disabled ? 'opacity-60 cursor-not-allowed bg-white' : 'hover:bg-gray-50'\n                }`}\n                title={disabled ? 'OFF' : ''}\n              >\n                {/*  */}\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <p className=\"text-sm font-semibold text-gray-900 truncate\">\n                      {displayName(athlete)}\n                    </p>\n                    {(athlete as any).nickname && athlete.name && (\n                      <p className=\"text-xs text-gray-400 truncate\">({athlete.name})</p>\n                    )}\n\n                    {/*  */}\n                    {renderSharingBadge(card)}\n                  </div>\n\n                  <div className=\"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-[11px] sm:text-xs text-gray-500\">\n                    <span>\n                      28 {athlete.training_days_28d ?? 0} / {athlete.training_sessions_28d ?? 0}\n                    </span>\n                    <span> {formatDate(athlete.last_training_date ?? null)}</span>\n                  </div>\n\n                  {/* ON */}\n                  {shareOn && card && (\n                    <div className=\"mt-2 flex flex-wrap items-center gap-2 text-[11px] sm:text-xs\">\n                      {/*  */}\n                      {card.action_total > 0 ? (\n                        <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200\">\n                          <CheckCircle2 className=\"w-3 h-3\" />\n                           {card.action_done}/{card.action_total}\n                        </span>\n                      ) : (\n                        <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-50 text-gray-600 border border-gray-200\">\n                           -\n                        </span>\n                      )}\n\n                      {/*  */}\n                      <span className=\"inline-flex items-center px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200\">\n                         {fmt1(card.sleep_hours_avg)}h /  {fmt1(card.sleep_quality_avg)}\n                      </span>\n\n                      {/*  */}\n                      <span className=\"inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200\">\n                         {fmt0(card.motivation_avg)} {fmt0(card.energy_avg)} {fmt0(card.stress_avg)}\n                      </span>\n                    </div>\n                  )}\n\n                  {/* OFF */}\n                  {!shareOn && (\n                    <div className=\"mt-2 text-[11px] sm:text-xs text-gray-500\">\n                       OFF\n                    </div>\n                  )}\n                </div>\n\n                {/* ACWR &  */}\n                <div className=\"flex flex-col items-end justify-center ml-4\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <span className=\"text-[11px] sm:text-xs text-gray-500\">ACWR</span>\n                    <span\n                      className={`text-sm sm:text-base font-semibold ${\n                        hasACWR ? 'text-gray-900' : 'text-gray-400'\n                      }`}\n                    >\n                      {acwrValue}\n                    </span>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    {renderRiskBadge(riskLevel)}\n                    <ChevronRight className=\"w-4 h-4 text-gray-300\" />\n                  </div>\n\n                  {/* 21/ */}\n                  {!hasACWR && (\n                    <p className=\"mt-1 text-[10px] sm:text-xs text-gray-400 text-right\">\n                      ACWR{daysOfData ?? 0}/{MIN_DAYS_FOR_ACWR}\n                      {remainingDays !== null && remainingDays > 0 ? `${remainingDays}` : ''}\n                    </p>\n                  )}\n                </div>\n              </button>\n            );\n          })\n        )}\n      </div>\n    </div>\n  );\n}","// src/lib/riskUtils.ts\n\n// ===============================\n// \n// ===============================\nexport type RiskLevel = 'high' | 'caution' | 'low';\n\nexport type AthleteRisk = {\n  id: string;\n  name: string;\n  riskLevel: RiskLevel;\n  reasons: string[]; // 2\n  acwr?: number | null; //  \n};\n\n// StaffView  weekCardMap \ntype WeekCard = {\n  is_sharing_active?: boolean;\n  sleep_hours_avg?: number | null;\n};\n\ntype AthleteACWRInfo = {\n  currentACWR: number | null;\n};\n\ntype NoDataInfo = {\n  daysSinceLast: number;\n};\n\ntype LoadInfo = {\n  load7d?: number | null;        // 7\n  load7dPrev?: number | null;    // 7\n};\n\n// ===============================\n// \n// ===============================\nconst pickTop2 = (reasons: string[]) =>\n  Array.from(new Set(reasons)).slice(0, 2);\n\n// \nexport const riskPriority: Record<RiskLevel, number> = {\n  high: 3,\n  caution: 2,\n  low: 1,\n};\n\n// ===============================\n//  \n// ===============================\nexport function calcRiskForAthlete(params: {\n  id: string;\n  name: string;\n  acwrInfo?: AthleteACWRInfo | null;\n  weekCard?: WeekCard | null;\n  noData?: NoDataInfo | null;\n}): AthleteRisk {\n  const { id, name, acwrInfo, weekCard, noData } = params;\n\n  const sharingOn = !!weekCard?.is_sharing_active;\n\n  const acwr = acwrInfo?.currentACWR ?? null;\n  const sleep = weekCard?.sleep_hours_avg ?? null;\n  const daysNoInput = noData?.daysSinceLast ?? null;\n\n  const reasons: string[] = [];\n\n  // -------------------------------\n  //  HIGH\n  // -------------------------------\n  let isHigh = false;\n\n  if (daysNoInput != null && daysNoInput >= 14) {\n    isHigh = true;\n    reasons.push('');\n  }\n\n  if (sharingOn && typeof acwr === 'number' && acwr >= 1.5) {\n    isHigh = true;\n    reasons.push('');\n  }\n\n  if (sharingOn && typeof sleep === 'number' && sleep <= 5.0) {\n    isHigh = true;\n    reasons.push('');\n  }\n\n  if (isHigh) {\n    return {\n      id,\n      name,\n      riskLevel: 'high',\n      reasons: pickTop2(reasons),\n      acwr, //  \n    };\n  }\n\n  // -------------------------------\n  //  CAUTION\n  // -------------------------------\n  let isCaution = false;\n\n  if (daysNoInput != null && daysNoInput >= 7) {\n    isCaution = true;\n    reasons.push('');\n  }\n\n  if (sharingOn && typeof acwr === 'number' && acwr >= 1.3) {\n    isCaution = true;\n    reasons.push('');\n  }\n\n  if (sharingOn && typeof sleep === 'number' && sleep <= 5.5) {\n    isCaution = true;\n    reasons.push('');\n  }\n\n  if (isCaution) {\n    return {\n      id,\n      name,\n      riskLevel: 'caution',\n      reasons: pickTop2(reasons),\n      acwr, //  \n    };\n  }\n\n  // -------------------------------\n  //  LOW\n  // -------------------------------\n  return {\n    id,\n    name,\n    riskLevel: 'low',\n    reasons: [],\n    acwr, //  \n  };\n}\n\n// ===============================\n//  UI\n// ===============================\nexport function getRiskColor(risk?: RiskLevel) {\n  switch (risk) {\n    case 'high':\n      return 'bg-red-50 text-red-700 border-red-200';\n    case 'caution':\n      return 'bg-amber-50 text-amber-700 border-amber-200';\n    case 'low':\n      return 'bg-emerald-50 text-emerald-700 border-emerald-200';\n    default:\n      return 'bg-gray-50 text-gray-500 border-gray-200';\n  }\n}\n\nexport function getRiskLabel(risk?: RiskLevel) {\n  switch (risk) {\n    case 'high':\n      return '';\n    case 'caution':\n      return '';\n    case 'low':\n      return '';\n    default:\n      return '';\n  }\n}\n\n\n\n// ===============================\n//  \n// ===============================\nexport function sortAthletesByRisk<T extends { id: string; name?: string }>(params: {\n  athletes: T[];\n  riskMap: Record<string, AthleteRisk | undefined>;\n  weekCardMap?: Record<string, { is_sharing_active?: boolean } | undefined>;\n}) {\n  const { athletes, riskMap, weekCardMap = {} } = params;\n\n  return [...athletes].sort((a, b) => {\n    const aSharing = weekCardMap[a.id]?.is_sharing_active ?? true;\n    const bSharing = weekCardMap[b.id]?.is_sharing_active ?? true;\n\n    //  OFF\n    if (!aSharing && bSharing) return 1;\n    if (aSharing && !bSharing) return -1;\n\n    //  \n    const aRisk = riskMap[a.id]?.riskLevel;\n    const bRisk = riskMap[b.id]?.riskLevel;\n\n    const aScore = aRisk ? riskPriority[aRisk] : 0;\n    const bScore = bRisk ? riskPriority[bRisk] : 0;\n\n    if (aScore !== bScore) return bScore - aScore;\n\n    const aRaw = riskMap[a.id]?.acwr;\n    const bRaw = riskMap[b.id]?.acwr;\n\n    //   ACWR null/undefined\n    const aAcwr = typeof aRaw === 'number' && Number.isFinite(aRaw) ? aRaw : -Infinity;\n    const bAcwr = typeof bRaw === 'number' && Number.isFinite(bRaw) ? bRaw : -Infinity;\n\n    if (aAcwr !== bAcwr) return bAcwr - aAcwr;\n\n    //  \n    const aReasons = riskMap[a.id]?.reasons.length ?? 0;\n    const bReasons = riskMap[b.id]?.reasons.length ?? 0;\n\n    if (aReasons !== bReasons) return bReasons - aReasons;\n\n    //  \n    return (a.name || '').localeCompare(b.name || '', 'ja');\n  });\n}","import React, { useMemo, useState } from 'react';\nimport { X, Activity, Scale, BarChart2 } from 'lucide-react';\nimport { User } from '../lib/supabase';\nimport { useTrainingData } from '../hooks/useTrainingData';\nimport { AthleteRisk, getRiskColor, getRiskLabel } from '../lib/riskUtils';\nimport {\n  ResponsiveContainer,\n  Line,\n  Bar,\n  XAxis,\n  YAxis,\n  Tooltip,\n  CartesianGrid,\n  Legend,\n  ReferenceLine,\n  ComposedChart,\n} from 'recharts';\n\ninterface AthleteDetailModalProps {\n  athlete: User;\n  onClose: () => void;\n  risk?: AthleteRisk;\n  weekCard?: { is_sharing_active?: boolean; sleep_hours_avg?: number | null } | undefined;\n}\n\n\ntype TabKey = 'overview' | 'weight' | 'rpe';\n\nfunction getNextActions(risk: { riskLevel: 'high' | 'caution' | 'low'; reasons: string[]; acwr?: number | null }) {\n  const reasons = risk.reasons || [];\n  const hasNoInput = reasons.includes('');\n  const hasLoad = reasons.includes('') || reasons.includes('');\n  const hasSleep = reasons.includes('');\n\n  if (risk.riskLevel === 'high') {\n    return [\n      hasNoInput ? '//' : '',\n      hasLoad ? 'RPEor' : '//',\n      hasSleep ? '/' : '48',\n    ];\n  }\n\n  if (risk.riskLevel === 'caution') {\n    return [\n      hasLoad ? '/' : '',\n      hasSleep ? '6h' : '//',\n      hasNoInput ? '/' : '',\n    ];\n  }\n\n  return [\n    '',\n    '',\n    '',\n  ];\n}\n\n\n\n//  YYYY-MM-DD JST Date \nfunction toYMD(v: any): string {\n  if (!v) return '';\n  if (typeof v === 'string') {\n    // \"2025-12-22\" or \"2025-12-22T...\" YMD\n    const s = v.includes('T') ? v.split('T')[0] : v;\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(s)) return s;\n  }\n  //  timestamp/object  Date \n  const d = new Date(v);\n  if (Number.isNaN(d.getTime())) return '';\n  return d.toISOString().slice(0, 10);\n}\n\nfunction formatMD(ymd: string): string {\n  const m = ymd.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n  if (!m) return ymd || '';\n  const mm = Number(m[2]);\n  const dd = Number(m[3]);\n  if (!Number.isFinite(mm) || !Number.isFinite(dd)) return ymd;\n  return `${mm}/${dd}`;\n}\n\nfunction trend(delta: number | null) {\n  if (delta == null || !Number.isFinite(delta)) {\n    return { arrow: '', tone: 'text-gray-500' };\n  }\n  if (delta > 0) {\n    return { arrow: '', tone: 'text-red-600' };     // \n  }\n  if (delta < 0) {\n    return { arrow: '', tone: 'text-emerald-600' }; // \n  }\n  return { arrow: '', tone: 'text-gray-600' };\n}\n\nexport function AthleteDetailModal({ athlete, onClose, risk, weekCard, }: AthleteDetailModalProps) {\n  const { records, weightRecords, acwrData, loading } = useTrainingData(athlete.id);\n  const [activeTab, setActiveTab] = useState<TabKey>('overview');\n\n  const latestACWR = acwrData.length > 0 ? acwrData[acwrData.length - 1] : null;\n  const recentRecords = records.slice(-7);\n  // ===== ACWR  =====\nconst prevACWR = acwrData.length >= 2 ? acwrData[acwrData.length - 2] : null;\n\nconst latestACWRValue =\n  latestACWR?.acwr != null && Number.isFinite(Number(latestACWR.acwr))\n    ? Number(latestACWR.acwr)\n    : null;\n\nconst prevACWRValue =\n  prevACWR?.acwr != null && Number.isFinite(Number(prevACWR.acwr))\n    ? Number(prevACWR.acwr)\n    : null;\n\nconst acwrDelta =\n  latestACWRValue != null && prevACWRValue != null\n    ? latestACWRValue - prevACWRValue\n    : null;\n\nconst acwrTrend = trend(acwrDelta);\n\n  // =====  =====\n  const weightChartData = useMemo(() => {\n    const source = Array.isArray(weightRecords) ? weightRecords : [];\n\n    return source\n      .map((r: any) => {\n        const w = r.weight_kg ?? r.weight ?? r.body_weight ?? null;\n        const ymd = toYMD(r.date);\n        if (!ymd) return null;\n\n        const n = w != null ? Number(w) : null;\n        if (n == null || !Number.isFinite(n)) return null;\n\n        return {\n          rawDate: ymd,         // YYYY-MM-DD\n          date: formatMD(ymd),  // MM/DD\n          weight: n,\n        };\n      })\n      .filter(Boolean) as { rawDate: string; date: string; weight: number }[];\n  }, [weightRecords]);\n\n    // =====   =====\n  const latestWeight = weightChartData.length > 0\n  ? weightChartData[weightChartData.length - 1]\n  : null;\n\n  const prevWeight = weightChartData.length >= 2\n  ? weightChartData[weightChartData.length - 2]\n  : null;\n\n  const latestWeightValue =\n  latestWeight?.weight != null && Number.isFinite(latestWeight.weight)\n    ? latestWeight.weight\n    : null;\n\n  const prevWeightValue =\n  prevWeight?.weight != null && Number.isFinite(prevWeight.weight)\n    ? prevWeight.weight\n    : null;\n\n  const weightDelta =\n  latestWeightValue != null && prevWeightValue != null\n    ? latestWeightValue - prevWeightValue\n    : null;\n\n  const weightTrend = trend(weightDelta);\n\n  // ===== LOADRPE =====\nconst recent7Days = records.slice(-7);\nconst prev7Days = records.slice(-14, -7);\n\nconst sumLoad = (recs: any[]) =>\n  recs.reduce((sum, r) => {\n    const rpe = Number(r.rpe ?? r.session_rpe);\n    const dur = Number(r.duration_min ?? r.duration_minutes ?? r.duration);\n    if (!Number.isFinite(rpe) || !Number.isFinite(dur)) return sum;\n    return sum + rpe * dur;\n  }, 0);\n\nconst load7 = recent7Days.length > 0 ? sumLoad(recent7Days) : null;\nconst loadPrev7 = prev7Days.length > 0 ? sumLoad(prev7Days) : null;\n\nconst loadDelta =\n  load7 != null && loadPrev7 != null ? load7 - loadPrev7 : null;\n\nconst loadTrend = trend(loadDelta);\n\n\n  // ===== RPE / Load / ACWRtraining_records + acwrData =====\n  const rpeLoadAcwrChartData = useMemo(() => {\n    if (!Array.isArray(records) || records.length === 0) return [];\n\n    //   ACWR YYYY-MM-DD\n    const acwrMap: Record<string, number> = {};\n    if (Array.isArray(acwrData)) {\n      acwrData.forEach((d: any) => {\n        const key = toYMD(d?.date);\n        if (!key) return;\n\n        const raw = d.acwr ?? d.ACWR ?? d.value ?? null;\n        const v = raw != null ? Number(raw) : null;\n        if (v != null && Number.isFinite(v)) acwrMap[key] = v;\n      });\n    }\n\n    const result = records\n      .map((r: any) => {\n        const ymd = toYMD(r.date);\n        if (!ymd) return null;\n\n        const rpeValue = r.rpe ?? r.session_rpe ?? null;\n        const durValue = r.duration_min ?? r.duration_minutes ?? r.duration ?? null;\n\n        const rpe = rpeValue != null ? Number(rpeValue) : null;\n        const duration = durValue != null ? Number(durValue) : null;\n\n        let load: number | null = null;\n        if (rpe != null && duration != null && Number.isFinite(rpe) && Number.isFinite(duration)) {\n          load = rpe * duration;\n        }\n\n        const acwr = acwrMap[ymd] != null ? acwrMap[ymd] : null;\n\n        // \n        if (load == null && acwr == null && rpe == null) return null;\n\n        return {\n          rawDate: ymd,\n          date: formatMD(ymd),\n          rpe: rpe != null && Number.isFinite(rpe) ? rpe : null,\n          load,\n          acwr,\n        };\n      })\n      .filter(Boolean) as {\n      rawDate: string;\n      date: string;\n      rpe: number | null;\n      load: number | null;\n      acwr: number | null;\n    }[];\n\n    // \n    result.sort((a, b) => (a.rawDate < b.rawDate ? -1 : a.rawDate > b.rawDate ? 1 : 0));\n\n    console.log('[AthleteDetailModal] rpeLoadAcwrChartData sample:', result.slice(0, 5));\n    return result;\n  }, [records, acwrData]);\n\n  // ===== weight +  =====\n  const loadWeightMergedData = useMemo(() => {\n    const map = new Map<string, any>();\n\n    //  training \n    for (const r of rpeLoadAcwrChartData) {\n      map.set(r.rawDate, { ...r });\n    }\n\n    // weight \n    for (const w of weightChartData) {\n      const prev = map.get(w.rawDate) ?? { rawDate: w.rawDate, date: w.date };\n      map.set(w.rawDate, { ...prev, weight: w.weight, date: prev.date ?? w.date });\n    }\n\n    const arr = Array.from(map.values());\n    arr.sort((a, b) => (a.rawDate < b.rawDate ? -1 : a.rawDate > b.rawDate ? 1 : 0));\n    return arr;\n  }, [rpeLoadAcwrChartData, weightChartData]);\n\n  if (loading) {\n    return (\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] flex items-center justify-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n        </div>\n      </div>\n    );\n  }\n\n  const latestACWRDateLabel = latestACWR ? formatMD(toYMD(latestACWR.date)) : '';\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        {/*  */}\n        <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-xl font-bold flex items-center gap-2\">\n              <Activity className=\"w-5 h-5\" />\n              {athlete.nickname || athlete.name || ''}\n            </h2>\n            <p className=\"text-sm text-blue-100 mt-1\">{athlete.email}</p>\n          </div>\n          <button onClick={onClose} className=\"p-2 rounded-full hover:bg-white/10 transition-colors\">\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n          {/*       */}\n          {risk && (\n            <div className=\"bg-white border border-gray-200 rounded-xl p-4 mb-4\">\n              {/*  */}\n              <div className=\"flex items-start justify-between gap-3\">\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`text-xs px-2 py-1 rounded-full border ${getRiskColor(risk.riskLevel)}`}>\n                      {getRiskLabel(risk.riskLevel)}\n                    </span>\n\n                    {typeof risk.acwr === 'number' && (\n                      <span className=\"text-xs text-gray-600\">\n                        ACWR <b>{risk.acwr.toFixed(2)}</b>\n                      </span>\n                    )}\n\n                    {weekCard?.is_sharing_active === false && (\n                      <span className=\"text-xs px-2 py-1 rounded-full border bg-gray-50 text-gray-600 border-gray-200\">\n                         OFF\n                      </span>\n                    )}\n                  </div>\n\n                  {/*  */}\n                  {risk.reasons?.length > 0 && (\n                    <div className=\"mt-2 flex flex-wrap gap-2\">\n                      {risk.reasons.slice(0, 2).map((r) => (\n                        <span key={r} className=\"text-[11px] px-2 py-1 rounded-full border bg-gray-50 text-gray-700 border-gray-200\">\n                          {r}\n                        </span>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/*  */}\n              <div className=\"mt-3 text-sm text-gray-800\">\n                <div className=\"font-semibold mb-1\"></div>\n                <ul className=\"list-disc pl-5 space-y-1\">\n                  {getNextActions(risk).map((t) => (\n                    <li key={t}>{t}</li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n          )}\n\n        {/*  */}\n        <div className=\"border-b border-gray-200 px-6 pt-3\">\n          <div className=\"flex gap-4 overflow-x-auto text-sm\">\n            <button\n              onClick={() => setActiveTab('overview')}\n              className={`pb-3 border-b-2 ${\n                activeTab === 'overview'\n                  ? 'border-blue-500 text-blue-600 font-semibold'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              \n            </button>\n            <button\n              onClick={() => setActiveTab('weight')}\n              className={`pb-3 border-b-2 flex items-center gap-1 ${\n                activeTab === 'weight'\n                  ? 'border-green-500 text-green-600 font-semibold'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <Scale className=\"w-4 h-4\" />\n              \n            </button>\n            <button\n              onClick={() => setActiveTab('rpe')}\n              className={`pb-3 border-b-2 flex items-center gap-1 ${\n                activeTab === 'rpe'\n                  ? 'border-purple-500 text-purple-600 font-semibold'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <BarChart2 className=\"w-4 h-4\" />\n              RPE /  / ACWR\n            </button>\n          </div>\n        </div>\n\n        {/*  */}\n        <div className=\"p-6 overflow-y-auto flex-1 space-y-6\">\n          {/* ---  --- */}\n          {activeTab === 'overview' && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 sm:grid-cols-5 gap-4\">\n                <div className=\"bg-blue-50 rounded-xl p-4\">\n                  <p className=\"text-xs text-blue-700 mb-1\"> ACWR</p>\n                  <p className=\"text-2xl font-bold text-blue-900\">\n                    {latestACWR?.acwr != null ? Number(latestACWR.acwr).toFixed(2) : '--'}\n                  </p>\n                  <div className=\"mt-1 text-xs flex items-center gap-2\">\n                    <span className={`${acwrTrend.tone} font-semibold`}>\n                      {acwrTrend.arrow}\n                    </span>\n                    <span className=\"text-gray-600\">\n                      \n                      <b className=\"ml-1\">\n                        {acwrDelta != null\n                          ? `${acwrDelta >= 0 ? '+' : ''}${acwrDelta.toFixed(2)}`\n                          : '--'}\n                      </b>\n                    </span>\n                  </div>\n                  {latestACWR && (\n                    <p className=\"text-xs text-blue-700 mt-1\">{latestACWRDateLabel}</p>\n                  )}\n                </div>\n\n                <div className=\"bg-green-50 rounded-xl p-4\">\n                  <p className=\"text-xs text-green-700 mb-1\">7</p>\n                  <p className=\"text-2xl font-bold text-green-900\">{recentRecords.length}</p>\n                </div>\n\n                <div className=\"bg-gray-50 rounded-xl p-4\">\n                  <p className=\"text-xs text-gray-700 mb-1\"></p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{records.length}</p>\n                </div>\n                  {/*   */}\n                <div className=\"bg-green-50 rounded-xl p-4\">\n                  <p className=\"text-xs text-green-700 mb-1\"> </p>\n                  <p className=\"text-2xl font-bold text-green-900\">\n                    {latestWeightValue != null ? latestWeightValue.toFixed(1) : '--'}\n                  </p>\n\n                  <div className=\"mt-1 text-xs flex items-center gap-2\">\n                    <span className={`${weightTrend.tone} font-semibold`}>\n                      {weightTrend.arrow}\n                    </span>\n                    <span className=\"text-gray-600\">\n                      \n                      <b className=\"ml-1\">\n                        {weightDelta != null\n                          ? `${weightDelta >= 0 ? '+' : ''}${weightDelta.toFixed(1)}kg`\n                          : '--'}\n                      </b>\n                    </span>\n                  </div>\n                </div>\n                {/* RPE LOAD */}\n                <div className=\"bg-purple-50 rounded-xl p-4\">\n                  <p className=\"text-xs text-purple-700 mb-1\">7 Load</p>\n\n                  <p className=\"text-2xl font-bold text-purple-900\">\n                    {load7 != null ? Math.round(load7) : '--'}\n                  </p>\n\n                  <div className=\"mt-1 text-xs flex items-center gap-2\">\n                    <span className={`${loadTrend.tone} font-semibold`}>\n                      {loadTrend.arrow}\n                    </span>\n                    <span className=\"text-gray-600\">\n                      \n                      <b className=\"ml-1\">\n                        {loadDelta != null\n                          ? `${loadDelta >= 0 ? '+' : ''}${Math.round(loadDelta)}`\n                          : '--'}\n                      </b>\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* ---  --- */}\n          {activeTab === 'weight' && (\n            <div className=\"space-y-4\">\n              <h3 className=\"text-base font-semibold text-gray-900 flex items-center gap-2\">\n                <Scale className=\"w-4 h-4 text-green-500\" />\n                  RPE\n              </h3>\n\n              <p className=\"text-xs text-gray-500\">\n                {weightChartData.length} / {rpeLoadAcwrChartData.length}\n              </p>\n\n              {loadWeightMergedData.length === 0 ? (\n                <p className=\"text-sm text-gray-500\"></p>\n              ) : (\n                <div className=\"h-72\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <ComposedChart data={loadWeightMergedData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"date\" />\n\n                      {/*  */}\n                      <YAxis\n                        yAxisId=\"left\"\n                        orientation=\"left\"\n                        tick={{ fontSize: 12 }}\n                        tickFormatter={(v: number) => `${Math.round(v)}`}\n                      />\n                      {/*  */}\n                      <YAxis\n                        yAxisId=\"right\"\n                        orientation=\"right\"\n                        tick={{ fontSize: 12 }}\n                        tickFormatter={(v: number) => `${v.toFixed(1)}`}\n                      />\n\n                      <Tooltip\n                        formatter={(value: any, name: any) => {\n                          if (typeof value !== 'number') return value;\n                          if (name === '') return [value.toFixed(1), name];\n                          return [Math.round(value), name]; // \n                        }}\n                      />\n                      <Legend />\n\n                      <Bar\n                        yAxisId=\"left\"\n                        dataKey=\"load\"\n                        name=\"RPE\"\n                        fill=\"#60a5fa\"\n                        opacity={0.85}\n                      />\n\n                      <Line\n                        yAxisId=\"right\"\n                        type=\"monotone\"\n                        dataKey=\"weight\"\n                        name=\"\"\n                        stroke=\"#22c55e\"\n                        strokeWidth={2}\n                        dot={{ r: 3 }}\n                        activeDot={{ r: 5 }}\n                        connectNulls\n                      />\n                    </ComposedChart>\n                  </ResponsiveContainer>\n                </div>\n              )}\n\n              <p className=\"text-xs text-gray-500 leading-relaxed\">\n                RPE or load\n                <br />\n                kg\n                <br />\n                 YYYY-MM-DDJST\n              </p>\n            </div>\n          )}\n\n          {/* --- RPE /  / ACWR  --- */}\n          {activeTab === 'rpe' && (\n            <div className=\"space-y-4\">\n              <h3 className=\"text-base font-semibold text-gray-900 flex items-center gap-2\">\n                <BarChart2 className=\"w-4 h-4 text-purple-500\" />\n                RPEACWR\n              </h3>\n\n              <p className=\"text-xs text-gray-500\">{rpeLoadAcwrChartData.length} </p>\n\n              {rpeLoadAcwrChartData.length === 0 ? (\n                <p className=\"text-sm text-gray-500\">\n                  RPE \n                </p>\n              ) : (\n                <div className=\"h-72\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <ComposedChart data={rpeLoadAcwrChartData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"date\" />\n\n                      {/*  */}\n                      <YAxis\n                        yAxisId=\"left\"\n                        orientation=\"left\"\n                        tick={{ fontSize: 12 }}\n                        tickFormatter={(v: number) => `${Math.round(v)}`}\n                      />\n                      {/* RPE/ACWR */}\n                      <YAxis\n                        yAxisId=\"right\"\n                        orientation=\"right\"\n                        tick={{ fontSize: 12 }}\n                        domain={[0, 10]}\n                        tickFormatter={(v: number) => v.toFixed(1)}\n                      />\n\n                      <Tooltip\n                        formatter={(value: any, name: any) => {\n                          if (typeof value !== 'number') return value;\n                          if (name === 'ACWR') return [value.toFixed(2), name];\n                          if (name === 'RPE') return [value.toFixed(1), name];\n                          return [Math.round(value), name];\n                        }}\n                      />\n                      <Legend />\n\n                      <Bar\n                        yAxisId=\"left\"\n                        dataKey=\"load\"\n                        name=\"RPE\"\n                        fill=\"#60a5fa\"\n                        opacity={0.85}\n                      />\n                      <Line\n                        yAxisId=\"right\"\n                        type=\"monotone\"\n                        dataKey=\"rpe\"\n                        name=\"RPE\"\n                        stroke=\"#f97316\"\n                        strokeWidth={2}\n                        dot={{ r: 3 }}\n                        activeDot={{ r: 5 }}\n                        connectNulls\n                      />\n                      <Line\n                        yAxisId=\"right\"\n                        type=\"monotone\"\n                        dataKey=\"acwr\"\n                        name=\"ACWR\"\n                        stroke=\"#a855f7\"\n                        strokeWidth={2}\n                        dot={{ r: 3 }}\n                        activeDot={{ r: 5 }}\n                        connectNulls\n                      />\n\n                      <ReferenceLine\n                        yAxisId=\"right\"\n                        y={0.8}\n                        stroke=\"#22c55e\"\n                        strokeDasharray=\"4 4\"\n                        ifOverflow=\"extendDomain\"\n                      />\n                      <ReferenceLine\n                        yAxisId=\"right\"\n                        y={1.3}\n                        stroke=\"#f97316\"\n                        strokeDasharray=\"4 4\"\n                        ifOverflow=\"extendDomain\"\n                      />\n                    </ComposedChart>\n                  </ResponsiveContainer>\n                </div>\n              )}\n\n              <p className=\"text-xs text-gray-500 leading-relaxed\">\n                RPE   or load\n                <br />\n                RPE\n                <br />\n                ACWR\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","// src/components/TeamACWRChart.tsx\nimport React, { useState, useMemo } from 'react';\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  ReferenceLine,\n  Legend,\n} from 'recharts';\nimport { getRiskColor } from '../lib/acwr';\nimport { Filter } from 'lucide-react';\n\ninterface TeamACWRData {\n  date: string;\n  averageACWR: number;\n  athleteCount: number;\n  riskLevel: string;\n\n  //  DBhook\n  // \n  averageRPE?: number | null;\n  avg_rpe?: number | null;\n  rpe_avg?: number | null;\n\n  averageLoad?: number | null;\n  avg_load?: number | null;\n  load_avg?: number | null;\n\n  // OK\n  rosterCount?: number | null;\n}\n\ninterface TeamACWRChartProps {\n  data: TeamACWRData[];\n  teamName: string;\n\n  //  StaffView \n  showAvgRPE?: boolean;\n  showAvgLoad?: boolean;\n}\n\nconst pickAvgRPE = (d: TeamACWRData) => d.averageRPE ?? d.avg_rpe ?? d.rpe_avg ?? null;\nconst pickAvgLoad = (d: TeamACWRData) => d.averageLoad ?? d.avg_load ?? d.load_avg ?? null;\n\n/**  ON/OFF */\nfunction MetricTogglePills({\n  showRPE,\n  showLoad,\n  onToggle,\n}: {\n  showRPE: boolean;\n  showLoad: boolean;\n  onToggle: (key: 'rpe' | 'load') => void;\n}) {\n  return (\n    <div className=\"flex items-center gap-2\">\n      <span className=\"hidden sm:inline text-xs text-gray-500 mr-1\"></span>\n\n      {/* RPE */}\n      <button\n        type=\"button\"\n        onClick={() => onToggle('rpe')}\n        className={[\n          'inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold',\n          'shadow-sm transition',\n          'focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500',\n          showRPE\n            ? 'bg-white border-blue-200 text-blue-700'\n            : 'bg-gray-50 border-gray-200 text-gray-500 hover:bg-white',\n        ].join(' ')}\n        aria-pressed={showRPE}\n      >\n        <span\n          className={[\n            'inline-flex h-5 w-9 items-center rounded-full p-0.5 transition',\n            showRPE ? 'bg-blue-600' : 'bg-gray-300',\n          ].join(' ')}\n        >\n          <span\n            className={[\n              'h-4 w-4 rounded-full bg-white shadow transition',\n              showRPE ? 'translate-x-4' : 'translate-x-0',\n            ].join(' ')}\n          />\n        </span>\n        RPE\n      </button>\n\n      {/* Load */}\n      <button\n        type=\"button\"\n        onClick={() => onToggle('load')}\n        className={[\n          'inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold',\n          'shadow-sm transition',\n          'focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500',\n          showLoad\n            ? 'bg-white border-emerald-200 text-emerald-700'\n            : 'bg-gray-50 border-gray-200 text-gray-500 hover:bg-white',\n        ].join(' ')}\n        aria-pressed={showLoad}\n      >\n        <span\n          className={[\n            'inline-flex h-5 w-9 items-center rounded-full p-0.5 transition',\n            showLoad ? 'bg-emerald-600' : 'bg-gray-300',\n          ].join(' ')}\n        >\n          <span\n            className={[\n              'h-4 w-4 rounded-full bg-white shadow transition',\n              showLoad ? 'translate-x-4' : 'translate-x-0',\n            ].join(' ')}\n          />\n        </span>\n        Load\n      </button>\n    </div>\n  );\n}\n\nexport function TeamACWRChart({\n  data,\n  teamName,\n  showAvgRPE = true,\n  showAvgLoad = false,\n}: TeamACWRChartProps) {\n  const [selectedPeriod, setSelectedPeriod] = useState<'week' | 'month' | 'quarter' | 'all'>('month');\n\n  //  StaffView + ON/OFF\n  const [showRPEUI, setShowRPEUI] = useState<boolean>(showAvgRPE);\n  const [showLoadUI, setShowLoadUI] = useState<boolean>(showAvgLoad);\n\n  //  useEffect \n  // React.useEffect(() => setShowRPEUI(showAvgRPE), [showAvgRPE]);\n  // React.useEffect(() => setShowLoadUI(showAvgLoad), [showAvgLoad]);\n\n  //  period filter\n  const filteredData = useMemo(() => {\n    if (!data || data.length === 0) return [];\n\n    const today = new Date();\n    let startDate: Date;\n\n    switch (selectedPeriod) {\n      case 'week':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 7);\n        break;\n      case 'month':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 30);\n        break;\n      case 'quarter':\n        startDate = new Date(today);\n        startDate.setDate(today.getDate() - 90);\n        break;\n      case 'all':\n      default:\n        return data;\n    }\n\n    return data.filter((item) => {\n      const itemDate = new Date(item.date);\n      return itemDate >= startDate && itemDate <= today;\n    });\n  }, [data, selectedPeriod]);\n\n  //  RPE/Loadrecharts dataKey\n  const chartData = useMemo(() => {\n    return (filteredData || []).map((d) => ({\n      ...d,\n      avgRPE: pickAvgRPE(d),\n      avgLoad: pickAvgLoad(d),\n    }));\n  }, [filteredData]);\n\n  //  data\n  const safeData = useMemo(() => {\n    return (chartData || [])\n      .filter((d: any) => {\n        if (!d || typeof d.date !== 'string') return false;\n\n        // ACWR\n        if (typeof d.averageACWR !== 'number' || !Number.isFinite(d.averageACWR)) return false;\n\n        // auxRPE/LoadOKnullmap\n        return true;\n      })\n      .map((d: any) => ({\n        ...d,\n        averageACWR: Math.max(0, d.averageACWR),\n        avgRPE: typeof d.avgRPE === 'number' && Number.isFinite(d.avgRPE) ? d.avgRPE : null,\n        avgLoad: typeof d.avgLoad === 'number' && Number.isFinite(d.avgLoad) ? d.avgLoad : null,\n      }));\n  }, [chartData]);\n\n  const hasRPE = useMemo(() => safeData.some((d: any) => typeof d.avgRPE === 'number'), [safeData]);\n  const hasLoad = useMemo(() => safeData.some((d: any) => typeof d.avgLoad === 'number'), [safeData]);\n\n  const showRPELine = !!showRPEUI && hasRPE;\n  const showLoadLine = !!showLoadUI && hasLoad;\n  const showAuxAxis = showRPELine || showLoadLine;\n\n  if (!data || data.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64 sm:h-96 text-gray-500\">\n        <div className=\"text-center px-4\">\n          <p className=\"text-base sm:text-lg mb-2\"></p>\n          <p className=\"text-sm\">ACWR</p>\n        </div>\n      </div>\n    );\n  }\n\n  //  filtered\n  if (safeData.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64 sm:h-96 text-gray-500\">\n        <div className=\"text-center px-4\">\n          <p className=\"text-base sm:text-lg mb-2\">ACWR</p>\n          <p className=\"text-sm\"></p>\n        </div>\n      </div>\n    );\n  }\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return `${date.getMonth() + 1}/${date.getDate()}`;\n  };\n\n  const formatDateWithDay = (dateStr: string) => {\n    const date = new Date(dateStr);\n    const dayNames = ['', '', '', '', '', '', ''];\n    const dayOfWeek = dayNames[date.getDay()];\n    return `${date.getMonth() + 1}/${date.getDate()}(${dayOfWeek})`;\n  };\n\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      const row = payload?.[0]?.payload;\n      const date = new Date(label);\n      const isWeekend = date.getDay() === 0 || date.getDay() === 6;\n\n      const acwr = row?.averageACWR;\n      const rpe = row?.avgRPE;\n      const load = row?.avgLoad;\n\n      return (\n        <div className=\"bg-white p-3 sm:p-4 border border-gray-200 rounded-lg shadow-lg max-w-xs\">\n          <div className=\"flex items-center space-x-2 mb-2\">\n            <p className=\"font-medium text-gray-900 text-sm sm:text-base\">{formatDateWithDay(label)}</p>\n            {isWeekend && (\n              <span className=\"bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-medium\">\n                \n              </span>\n            )}\n          </div>\n\n          <div className=\"space-y-1 text-xs sm:text-sm\">\n            <p className=\"flex justify-between\">\n              <span>ACWR:</span>\n              <span className=\"font-semibold\" style={{ color: getRiskColor(row?.riskLevel) }}>\n                {typeof acwr === 'number' ? acwr.toFixed(2) : '-'}\n              </span>\n            </p>\n\n            {showRPELine && (\n              <p className=\"flex justify-between\">\n                <span>RPE:</span>\n                <span className=\"font-semibold\">{typeof rpe === 'number' ? rpe.toFixed(2) : '-'}</span>\n              </p>\n            )}\n\n            {showLoadLine && (\n              <p className=\"flex justify-between\">\n                <span>Load:</span>\n                <span className=\"font-semibold\">{typeof load === 'number' ? Math.round(load) : '-'}</span>\n              </p>\n            )}\n\n            <p className=\"flex justify-between\">\n              <span>:</span>\n              <span className=\"font-semibold\">\n                {row?.athleteCount} / {row?.rosterCount ?? '-'}\n              </span>\n            </p>\n\n            <p className=\"flex justify-between\">\n              <span>:</span>\n              <span className=\"font-semibold\" style={{ color: getRiskColor(row?.riskLevel) }}>\n                {getRiskLabel(row?.riskLevel)}\n              </span>\n            </p>\n          </div>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  const CustomDot = (props: any) => {\n    const { cx, cy, payload } = props;\n    if (cx && cy && payload) {\n      const date = new Date(payload.date);\n      const isWeekend = date.getDay() === 0 || date.getDay() === 6;\n\n      return (\n        <circle\n          cx={cx}\n          cy={cy}\n          r={isWeekend ? 5 : 4}\n          fill={getRiskColor(payload.riskLevel)}\n          strokeWidth={2}\n          stroke={isWeekend ? '#8B5CF6' : 'white'}\n          opacity={isWeekend ? 0.9 : 1}\n        />\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"w-full\">\n      {/*  */}\n      <div className=\"mb-4 space-y-4\">\n        {/*   /  */}\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between\">\n          <div>\n            <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 truncate\">\n              <span className=\"hidden sm:inline\">{teamName} - </span>ACWR\n            </h3>\n            <p className=\"text-xs sm:text-sm text-gray-600\">\n              ACWR{showAuxAxis ? ' / RPELoad' : ''}\n            </p>\n          </div>\n\n          <MetricTogglePills\n            showRPE={showRPEUI}\n            showLoad={showLoadUI}\n            onToggle={(key) => {\n              if (key === 'rpe') setShowRPEUI((v) => !v);\n              if (key === 'load') setShowLoadUI((v) => !v);\n            }}\n          />\n        </div>\n\n        {/*  */}\n        <div className=\"flex items-center space-x-2\">\n          <Filter className=\"w-4 h-4 text-gray-500\" />\n          <div className=\"flex space-x-1\">\n            {[\n              { value: 'week', label: '1' },\n              { value: 'month', label: '1' },\n              { value: 'quarter', label: '3' },\n              { value: 'all', label: '' },\n            ].map((period) => (\n              <button\n                key={period.value}\n                onClick={() => setSelectedPeriod(period.value as any)}\n                className={`px-3 py-1 rounded-lg text-xs font-medium transition-colors ${\n                  selectedPeriod === period.value\n                    ? 'bg-purple-600 text-white'\n                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                }`}\n              >\n                {period.label}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/*  */}\n        <div className=\"bg-purple-50 rounded-lg p-3\">\n          <div className=\"flex items-center justify-between text-sm\">\n            <div className=\"flex items-center space-x-4\">\n              <div>\n                <span className=\"text-purple-600 font-medium\">:</span>\n                <span className=\"text-purple-800 ml-1\">\n                  {selectedPeriod === 'week'\n                    ? '7'\n                    : selectedPeriod === 'month'\n                    ? '30'\n                    : selectedPeriod === 'quarter'\n                    ? '90'\n                    : ''}\n                </span>\n              </div>\n              <div>\n                <span className=\"text-purple-600 font-medium\">:</span>\n                <span className=\"text-purple-800 ml-1\">{safeData.length}</span>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-3 h-3 bg-purple-500 rounded-full border-2 border-purple-600\"></div>\n              <span className=\"text-xs text-purple-600\"></span>\n            </div>\n          </div>\n        </div>\n\n        {/*   */}\n        {(showRPEUI && !hasRPE) || (showLoadUI && !hasLoad) ? (\n          <div className=\"text-xs bg-amber-50 border border-amber-200 text-amber-800 rounded-lg px-3 py-2\">\n            ONRPE/Load\n          </div>\n        ) : null}\n      </div>\n\n      <div className=\"h-64 sm:h-96\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          {/*  safeData  */}\n          <LineChart data={safeData} margin={{ top: 20, right: 36, left: 20, bottom: 20 }}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n\n            <XAxis\n              dataKey=\"date\"\n              tickFormatter={formatDate}\n              stroke=\"#6b7280\"\n              fontSize={10}\n              interval=\"preserveStartEnd\"\n            />\n\n            {/*  ACWR */}\n            <YAxis\n              yAxisId=\"acwr\"\n              domain={[0, (dataMax: number) => (Number.isFinite(dataMax) ? dataMax + 0.5 : 2)]}\n              stroke=\"#6b7280\"\n              fontSize={10}\n              width={40}\n            />\n\n            {/*  RPE/Load */}\n            <YAxis\n              yAxisId=\"aux\"\n              orientation=\"right\"\n              domain={[0, (dataMax: number) => (Number.isFinite(dataMax) ? dataMax : 10)]}\n              stroke=\"#6b7280\"\n              fontSize={10}\n              width={40}\n              hide={!showAuxAxis}\n            />\n\n            <Tooltip content={<CustomTooltip />} />\n            <Legend />\n\n            {/* Reference lines for risk zones */}\n            <ReferenceLine yAxisId=\"acwr\" y={1.5} stroke=\"#EF4444\" strokeDasharray=\"5 5\" />\n            <ReferenceLine yAxisId=\"acwr\" y={1.3} stroke=\"#F59E0B\" strokeDasharray=\"5 5\" />\n            <ReferenceLine yAxisId=\"acwr\" y={0.8} stroke=\"#10B981\" strokeDasharray=\"5 5\" />\n\n            {/* ACWR */}\n            <Line\n              type=\"monotone\"\n              dataKey=\"averageACWR\"\n              name=\"ACWR\"\n              yAxisId=\"acwr\"\n              stroke=\"#8B5CF6\"\n              strokeWidth={3}\n              dot={<CustomDot />}\n              activeDot={{ r: 6, stroke: '#8B5CF6', strokeWidth: 2, fill: 'white' }}\n              connectNulls\n            />\n\n            {/* RPEavgRPE */}\n            {showRPELine && (\n              <Line\n                type=\"monotone\"\n                dataKey=\"avgRPE\"\n                name=\"RPE\"\n                yAxisId=\"aux\"\n                stroke=\"#0EA5E9\"\n                strokeWidth={2}\n                dot={false}\n                connectNulls\n              />\n            )}\n\n            {/* LoadavgLoad */}\n            {showLoadLine && (\n              <Line\n                type=\"monotone\"\n                dataKey=\"avgLoad\"\n                name=\"Load\"\n                yAxisId=\"aux\"\n                stroke=\"#22C55E\"\n                strokeWidth={2}\n                dot={false}\n                connectNulls\n              />\n            )}\n          </LineChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/* Legend - Centered at bottom */}\n      <div className=\"mt-4 flex justify-center\">\n        <div className=\"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-4 text-xs\">\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-red-500 rounded-full mr-2\"></div>\n            <span> (&gt;1.5)</span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-yellow-500 rounded-full mr-2\"></div>\n            <span> (1.3-1.5)</span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-green-500 rounded-full mr-2\"></div>\n            <span> (0.8-1.3)</span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-blue-500 rounded-full mr-2\"></div>\n            <span> (&lt;0.8)</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction getRiskLabel(riskLevel: string): string {\n  switch (riskLevel) {\n    case 'high':\n      return '';\n    case 'caution':\n      return '';\n    case 'good':\n      return '';\n    case 'low':\n      return '';\n    default:\n      return '';\n  }\n}","import React, { useMemo, useState } from 'react';\nimport type { AppRole } from '../lib/roles';\nimport { Alert, getAlertStyle, getAlertTypeLabel } from '../lib/alerts';\nimport {\n  X, Check, Eye, EyeOff, Filter, Clock, User, TrendingUp,\n  ChevronDown, ChevronRight\n} from 'lucide-react';\n\ninterface AlertPanelProps {\n  alerts: Alert[];\n  onMarkAsRead: (alertId: string) => void;\n  onDismiss: (alertId: string) => void;\n  onMarkAllAsRead: () => void;\n  onClose: () => void;\n  userRole: AppRole;\n\n  //  \n  selectedUserId?: string;\n\n  //   \"\"\n  userNameMap?: Record<string, string>;\n}\n\ntype Priority = 'high' | 'medium' | 'low';\n\nconst priorityRank: Record<Priority, number> = { high: 3, medium: 2, low: 1 };\n\nfunction isPriority(v: any): v is Priority {\n  return v === 'high' || v === 'medium' || v === 'low';\n}\nfunction comparePriority(a: Priority, b: Priority) {\n  return priorityRank[b] - priorityRank[a];\n}\n\ntype GroupedAlerts = {\n  userId: string;\n  topPriority: Priority;\n  topAlerts: Alert[];\n  included: { medium: Alert[]; low: Alert[] };\n  totalCount: number;\n  unreadCount: number;\n};\n\nexport function AlertPanel({\n  alerts,\n  onMarkAsRead,\n  onDismiss,\n  onMarkAllAsRead,\n  onClose,\n  userRole,\n  selectedUserId,\n  userNameMap = {},\n}: AlertPanelProps) {\n  const [filter, setFilter] = useState<'all' | 'unread' | 'high' | 'medium' | 'low'>('all');\n  const [showDismissed, setShowDismissed] = useState(false);\n  const [expandedUserIds, setExpandedUserIds] = useState<Record<string, boolean>>({});\n\n  const formatTimeAgo = (dateString: string) => {\n    const now = new Date();\n    const alertTime = new Date(dateString);\n    const diffInMinutes = Math.floor((now.getTime() - alertTime.getTime()) / (1000 * 60));\n    if (diffInMinutes < 1) return '';\n    if (diffInMinutes < 60) return `${diffInMinutes}`;\n    const diffInHours = Math.floor(diffInMinutes / 60);\n    if (diffInHours < 24) return `${diffInHours}`;\n    const diffInDays = Math.floor(diffInHours / 24);\n    return `${diffInDays}`;\n  };\n\n  const toggleExpanded = (userId: string) => {\n    setExpandedUserIds(prev => ({ ...prev, [userId]: !prev[userId] }));\n  };\n\n  //  ID Alert \n  const getTargetUserId = (a: Alert) =>\n    (a as any).user_id ?? (a as any).target_user_id ?? (a as any).athlete_id;\n\n  // 1) dismiss\n  const visibleAlerts = useMemo(() => {\n    return alerts.filter(a => {\n      if (!showDismissed && a.is_dismissed) return false;\n      return true;\n    });\n  }, [alerts, showDismissed]);\n\n  //  2) selectedUserId \n  const scopedAlerts = useMemo(() => {\n    if (!selectedUserId) return visibleAlerts;\n    return visibleAlerts.filter(a => getTargetUserId(a) === selectedUserId);\n  }, [visibleAlerts, selectedUserId]);\n\n  // \n  const unreadCount = useMemo(\n    () => scopedAlerts.filter(a => !a.is_read && !a.is_dismissed).length,\n    [scopedAlerts]\n  );\n  const highPriorityCount = useMemo(\n    () => scopedAlerts.filter(a => a.priority === 'high' && !a.is_dismissed).length,\n    [scopedAlerts]\n  );\n\n  //  3) \n  const grouped = useMemo<GroupedAlerts[]>(() => {\n    const byUser = new Map<string, Alert[]>();\n\n    for (const a of scopedAlerts) {\n      const uid = getTargetUserId(a);\n      if (!uid) continue;\n      if (!byUser.has(uid)) byUser.set(uid, []);\n      byUser.get(uid)!.push(a);\n    }\n\n    const result: GroupedAlerts[] = [];\n\n    for (const [userId, userAlerts] of byUser.entries()) {\n      const priorities: Priority[] = userAlerts.map(a => (isPriority(a.priority) ? a.priority : 'low'));\n      const topPriority = priorities.sort(comparePriority)[0] ?? 'low';\n\n      const topAlerts = userAlerts\n        .filter(a => (isPriority(a.priority) ? a.priority : 'low') === topPriority)\n        .sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\n\n      const medium = userAlerts\n        .filter(a => (isPriority(a.priority) ? a.priority : 'low') === 'medium')\n        .sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\n\n      const low = userAlerts\n        .filter(a => (isPriority(a.priority) ? a.priority : 'low') === 'low')\n        .sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\n\n      result.push({\n        userId,\n        topPriority,\n        topAlerts,\n        included: {\n          //  tophigh medium+low topmedium low\n          medium: topPriority === 'high' ? medium : [],\n          low: topPriority !== 'low' ? low : [],\n        },\n        totalCount: userAlerts.length,\n        unreadCount: userAlerts.filter(a => !a.is_read).length,\n      });\n    }\n\n    return result.sort((a, b) => {\n      const p = comparePriority(a.topPriority, b.topPriority);\n      if (p !== 0) return p;\n      if (b.unreadCount !== a.unreadCount) return b.unreadCount - a.unreadCount;\n      const aNewest = new Date(a.topAlerts[0]?.created_at ?? 0).getTime();\n      const bNewest = new Date(b.topAlerts[0]?.created_at ?? 0).getTime();\n      return bNewest - aNewest;\n    });\n  }, [scopedAlerts]);\n\n  //  4) \n  const filteredGrouped = useMemo(() => {\n    return grouped.filter(g => {\n      if (filter === 'unread') return g.unreadCount > 0;\n      if (filter === 'high' || filter === 'medium' || filter === 'low') return g.topPriority === filter;\n      return true;\n    });\n  }, [grouped, filter]);\n\n  const isSingleUserMode = !!selectedUserId;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden\">\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"bg-blue-500 rounded-full p-3\">\n                <TrendingUp className=\"w-8 h-8\" />\n              </div>\n              <div>\n                <h2 className=\"text-2xl font-bold\">\n                  {isSingleUserMode ? '' : ''}\n                </h2>\n                <p className=\"text-blue-100\">\n                  {unreadCount > 0 ? `${unreadCount}` : ''}\n                  {highPriorityCount > 0 && (\n                    <span className=\"ml-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs\">\n                       {highPriorityCount}\n                    </span>\n                  )}\n                </p>\n              </div>\n            </div>\n            <button onClick={onClose} className=\"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors\">\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Controls */}\n        <div className=\"bg-gray-50 border-b border-gray-200 p-4\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-3 sm:space-y-0\">\n            <div className=\"flex flex-wrap items-center space-x-2\">\n              <Filter className=\"w-4 h-4 text-gray-500\" />\n              <select\n                value={filter}\n                onChange={(e) => setFilter(e.target.value as any)}\n                className=\"text-sm border border-gray-300 rounded px-2 py-1\"\n              >\n                <option value=\"all\">{isSingleUserMode ? '' : ''}</option>\n                <option value=\"unread\">{isSingleUserMode ? '' : ''}</option>\n                <option value=\"high\"></option>\n                <option value=\"medium\"></option>\n                <option value=\"low\"></option>\n              </select>\n\n              <label className=\"flex items-center space-x-1 text-sm text-gray-600\">\n                <input\n                  type=\"checkbox\"\n                  checked={showDismissed}\n                  onChange={(e) => setShowDismissed(e.target.checked)}\n                  className=\"rounded\"\n                />\n                <span></span>\n              </label>\n            </div>\n\n            <div className=\"flex space-x-2\">\n              {unreadCount > 0 && (\n                <button\n                  onClick={onMarkAllAsRead}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center space-x-1\"\n                >\n                  <Check className=\"w-4 h-4\" />\n                  <span></span>\n                </button>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Body */}\n        <div className=\"overflow-y-auto max-h-[60vh] p-6\">\n          {filteredGrouped.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <div className=\"text-gray-400 mb-4\">\n                <TrendingUp className=\"w-16 h-16 mx-auto\" />\n              </div>\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                {filter === 'unread' ? '' : ''}\n              </h3>\n              <p className=\"text-gray-600\">\n                {filter === 'unread' ? '' : ''}\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {filteredGrouped.map((g) => {\n                const representative = g.topAlerts[0];\n                const style = representative\n                  ? getAlertStyle(representative)\n                  : getAlertStyle({ priority: g.topPriority } as any);\n\n                const userName = userNameMap[g.userId] ?? '';\n                const expanded = !!expandedUserIds[g.userId];\n\n                return (\n                  <div key={g.userId} className={`${style.bgColor} ${style.borderColor} border rounded-lg p-4`}>\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <span className=\"text-lg\">{style.icon}</span>\n                          <h3 className={`font-semibold ${style.textColor}`}>\n                            {userRole !== 'athlete' ? userName : representative?.title}\n                          </h3>\n                          <span className={`px-2 py-1 rounded-full text-xs font-medium ${style.bgColor} ${style.textColor} border ${style.borderColor}`}>\n                            {g.topPriority === 'high' ? '' : g.topPriority === 'medium' ? '' : ''}\n                          </span>\n\n                          {g.unreadCount > 0 && (\n                            <span className=\"ml-1 inline-flex items-center text-xs\">\n                              <span className=\"w-2 h-2 bg-blue-600 rounded-full mr-2\" />\n                              <span className=\"text-gray-600\"> {g.unreadCount}</span>\n                            </span>\n                          )}\n\n                          {(g.included.medium.length + g.included.low.length) > 0 && (\n                            <span className=\"text-xs text-gray-500 ml-2\">\n                               {g.included.medium.length + g.included.low.length}\n                            </span>\n                          )}\n                        </div>\n\n                        {/* Top () */}\n                        <div className=\"space-y-2\">\n                          {g.topAlerts.slice(0, 2).map((a) => (\n                            <div key={a.id}>\n                              <div className=\"flex items-center space-x-2\">\n                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${style.bgColor} ${style.textColor} border ${style.borderColor}`}>\n                                  {getAlertTypeLabel(a.type)}\n                                </span>\n                                <span className={`font-semibold ${style.textColor}`}>{a.title}</span>\n                              </div>\n                              <p className={`${style.textColor} mt-1`}>{a.message}</p>\n\n                              {a.acwr_value && (\n                                <div className=\"bg-white bg-opacity-50 rounded p-2 mt-2\">\n                                  <div className=\"flex items-center space-x-4 text-sm\">\n                                    <div>\n                                      <span className=\"text-gray-600\">ACWR:</span>\n                                      <span className={`font-bold ml-1 ${style.textColor}`}>{a.acwr_value}</span>\n                                    </div>\n                                    {a.threshold_exceeded && (\n                                      <div>\n                                        <span className=\"text-gray-600\">:</span>\n                                        <span className=\"font-medium ml-1\">{a.threshold_exceeded}</span>\n                                      </div>\n                                    )}\n                                  </div>\n                                </div>\n                              )}\n\n                              <div className=\"flex items-center space-x-4 text-xs text-gray-500 mt-2\">\n                                <div className=\"flex items-center space-x-1\">\n                                  <Clock className=\"w-3 h-3\" />\n                                  <span>{formatTimeAgo(a.created_at)}</span>\n                                </div>\n                                {userRole !== 'athlete' && (\n                                  <div className=\"flex items-center space-x-1\">\n                                    <User className=\"w-3 h-3\" />\n                                    <span>{userName}</span>\n                                  </div>\n                                )}\n                              </div>\n\n                              <div className=\"flex items-center space-x-2 mt-2\">\n                                {!a.is_read && (\n                                  <button\n                                    onClick={() => onMarkAsRead(a.id)}\n                                    className={`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${style.iconColor}`}\n                                    title=\"\"\n                                  >\n                                    <Eye className=\"w-4 h-4\" />\n                                  </button>\n                                )}\n                                {!a.is_dismissed && (\n                                  <button\n                                    onClick={() => onDismiss(a.id)}\n                                    className={`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${style.iconColor}`}\n                                    title=\"\"\n                                  >\n                                    <EyeOff className=\"w-4 h-4\" />\n                                  </button>\n                                )}\n                              </div>\n                            </div>\n                          ))}\n\n                          {g.topAlerts.length > 2 && (\n                            <div className=\"text-xs text-gray-600\"> {g.topAlerts.length - 2} </div>\n                          )}\n                        </div>\n                      </div>\n\n                      {(g.included.medium.length + g.included.low.length) > 0 && (\n                        <button\n                          onClick={() => toggleExpanded(g.userId)}\n                          className=\"ml-4 text-gray-700 hover:text-gray-900 flex items-center space-x-1\"\n                          title=\"\"\n                        >\n                          {expanded ? <ChevronDown className=\"w-5 h-5\" /> : <ChevronRight className=\"w-5 h-5\" />}\n                        </button>\n                      )}\n                    </div>\n\n                    {/* Included */}\n                    {(g.included.medium.length + g.included.low.length) > 0 && expanded && (\n                      <div className=\"mt-4 bg-white bg-opacity-60 rounded-lg p-4\">\n                        <div className=\"text-sm font-semibold text-gray-800 mb-3\"></div>\n\n                        {g.included.medium.length > 0 && (\n                          <div className=\"mb-4\">\n                            <div className=\"text-xs font-semibold text-gray-700 mb-2\">{g.included.medium.length}</div>\n                            <div className=\"space-y-3\">\n                              {g.included.medium.map((a) => {\n                                const s = getAlertStyle(a);\n                                return (\n                                  <div key={a.id} className={`${s.bgColor} ${s.borderColor} border rounded p-3`}>\n                                    <div className=\"flex items-center justify-between\">\n                                      <div className=\"flex items-center space-x-2\">\n                                        <span className=\"text-base\">{s.icon}</span>\n                                        <span className={`text-sm font-semibold ${s.textColor}`}>{a.title}</span>\n                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${s.bgColor} ${s.textColor} border ${s.borderColor}`}>\n                                          {getAlertTypeLabel(a.type)}\n                                        </span>\n                                      </div>\n                                      <div className=\"flex items-center space-x-2\">\n                                        {!a.is_read && (\n                                          <button onClick={() => onMarkAsRead(a.id)} className={`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${s.iconColor}`} title=\"\">\n                                            <Eye className=\"w-4 h-4\" />\n                                          </button>\n                                        )}\n                                        {!a.is_dismissed && (\n                                          <button onClick={() => onDismiss(a.id)} className={`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${s.iconColor}`} title=\"\">\n                                            <EyeOff className=\"w-4 h-4\" />\n                                          </button>\n                                        )}\n                                      </div>\n                                    </div>\n                                    <p className={`${s.textColor} mt-2 text-sm`}>{a.message}</p>\n                                    <div className=\"flex items-center space-x-1 text-xs text-gray-500 mt-2\">\n                                      <Clock className=\"w-3 h-3\" />\n                                      <span>{formatTimeAgo(a.created_at)}</span>\n                                    </div>\n                                  </div>\n                                );\n                              })}\n                            </div>\n                          </div>\n                        )}\n\n                        {g.included.low.length > 0 && (\n                          <div>\n                            <div className=\"text-xs font-semibold text-gray-700 mb-2\">{g.included.low.length}</div>\n                            <div className=\"space-y-3\">\n                              {g.included.low.map((a) => {\n                                const s = getAlertStyle(a);\n                                return (\n                                  <div key={a.id} className={`${s.bgColor} ${s.borderColor} border rounded p-3`}>\n                                    <div className=\"flex items-center justify-between\">\n                                      <div className=\"flex items-center space-x-2\">\n                                        <span className=\"text-base\">{s.icon}</span>\n                                        <span className={`text-sm font-semibold ${s.textColor}`}>{a.title}</span>\n                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${s.bgColor} ${s.textColor} border ${s.borderColor}`}>\n                                          {getAlertTypeLabel(a.type)}\n                                        </span>\n                                      </div>\n                                      <div className=\"flex items-center space-x-2\">\n                                        {!a.is_read && (\n                                          <button onClick={() => onMarkAsRead(a.id)} className={`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${s.iconColor}`} title=\"\">\n                                            <Eye className=\"w-4 h-4\" />\n                                          </button>\n                                        )}\n                                        {!a.is_dismissed && (\n                                          <button onClick={() => onDismiss(a.id)} className={`p-1 rounded hover:bg-white hover:bg-opacity-50 transition-colors ${s.iconColor}`} title=\"\">\n                                            <EyeOff className=\"w-4 h-4\" />\n                                          </button>\n                                        )}\n                                      </div>\n                                    </div>\n                                    <p className={`${s.textColor} mt-2 text-sm`}>{a.message}</p>\n                                    <div className=\"flex items-center space-x-1 text-xs text-gray-500 mt-2\">\n                                      <Clock className=\"w-3 h-3\" />\n                                      <span>{formatTimeAgo(a.created_at)}</span>\n                                    </div>\n                                  </div>\n                                );\n                              })}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"bg-gray-50 border-t border-gray-200 p-4\">\n          <div className=\"flex items-center justify-between text-sm text-gray-600\">\n            <div>\n              : {filteredGrouped.length}{isSingleUserMode ? '' : ''} / : {grouped.length}{isSingleUserMode ? '' : ''}: {scopedAlerts.length}\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-3 h-3 bg-red-100 border border-red-200 rounded\"></div>\n                <span></span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-3 h-3 bg-yellow-100 border border-yellow-200 rounded\"></div>\n                <span></span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-3 h-3 bg-blue-100 border border-blue-200 rounded\"></div>\n                <span></span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  );\n}","import React from 'react';\n\nexport class ChartErrorBoundary extends React.Component<\n  { name: string; children: React.ReactNode },\n  { hasError: boolean; message?: string }\n> {\n  state = { hasError: false, message: '' };\n\n  static getDerivedStateFromError(err: any) {\n    return { hasError: true, message: String(err?.message || err) };\n  }\n\n  componentDidCatch(err: any) {\n    console.error(`[ChartErrorBoundary] ${this.props.name}`, err);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700\">\n          {this.props.name}\n          <div className=\"text-xs mt-1 opacity-80\">{this.state.message}</div>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}","// src/hooks/useTeamACWR.ts\nimport { useEffect, useRef, useState } from 'react';\nimport { supabase } from '../lib/supabase';\n\nexport type RiskLevel = 'high' | 'caution' | 'good' | 'low' | 'unknown';\n\nexport interface TeamACWRData {\n  date: string; // YYYY-MM-DD\n  averageACWR: number;\n  athleteCount: number;\n  riskLevel: RiskLevel;\n\n  // team_training_dailyview\n  averageRPE?: number | null;\n  averageLoad?: number | null;\n}\n\nexport interface AthleteACWRInfo {\n  currentACWR: number | null;\n  riskLevel: RiskLevel;\n  daysOfData?: number | null;\n}\nexport type AthleteACWRMap = Record<string, AthleteACWRInfo>;\n\nconst round2 = (n: number) => Math.round(n * 100) / 100;\n\nconst toNum = (v: any): number | null => {\n  if (v === null || v === undefined) return null;\n  const n = typeof v === 'number' ? v : Number(v);\n  return Number.isFinite(n) ? n : null;\n};\n\nconst evalRisk = (acwr: number | null): RiskLevel => {\n  if (acwr === null || acwr === undefined) return 'unknown';\n  if (!Number.isFinite(acwr) || acwr <= 0) return 'unknown';\n  if (acwr >= 1.5) return 'high';\n  if (acwr >= 1.3) return 'caution';\n  if (acwr >= 0.8) return 'good';\n  return 'low';\n};\n\n//  JSTYYYY-MM-DDDB\n// toISOStringUTC\n//  \"Asia/Tokyo\"   Date  ISO JST\nconst getJSTDateKey = (d: Date) => {\n  const jst = new Date(d.toLocaleString('en-US', { timeZone: 'Asia/Tokyo' }));\n  return jst.toISOString().slice(0, 10);\n};\n\ntype TeamACWRDailyRow = {\n  team_id: string;\n  date: string; // YYYY-MM-DD\n  average_acwr: number | string | null; // numericstring\n  athlete_count: number | string | null;\n};\n\ntype TeamTrainingDailyRow = {\n  team_id: string;\n  date: string;\n  average_rpe: number | string | null;\n  average_load: number | string | null;\n  athlete_count: number | string | null;\n};\n\nexport function useTeamACWR(teamId: string | null) {\n  const [teamACWRData, setTeamACWRData] = useState<TeamACWRData[]>([]);\n  const [athleteACWRMap, setAthleteACWRMap] = useState<AthleteACWRMap>({});\n  const [loading, setLoading] = useState(false);\n\n  //  fetch\n  const reqSeqRef = useRef(0);\n\n  useEffect(() => {\n    // teamId\n    if (!teamId) {\n      setTeamACWRData([]);\n      setAthleteACWRMap({});\n      setLoading(false);\n      return;\n    }\n\n    const mySeq = ++reqSeqRef.current;\n    setLoading(true);\n\n    // teamId\n    setTeamACWRData([]);\n    setAthleteACWRMap({});\n\n    (async () => {\n      try {\n        // 9030/180OK\n        const today = new Date();\n        const from = new Date(today);\n        from.setDate(from.getDate() - 90);\n\n        const fromKey = getJSTDateKey(from);\n        const toKey = getJSTDateKey(today);\n\n        // ----------------------------\n        // 1) ACWRview: team_acwr_daily\n        //      \n        // ----------------------------\n        const { data: acwrRows, error: acwrErr } = await supabase\n          .from('team_acwr_daily')\n          .select('team_id,date,average_acwr,athlete_count')\n          .eq('team_id', teamId)\n          .gte('date', fromKey)\n          .lte('date', toKey)\n          .order('date', { ascending: true });\n\n        if (acwrErr) throw acwrErr;\n\n        //  \n        if (reqSeqRef.current !== mySeq) return;\n\n        const base: TeamACWRData[] = (acwrRows || [])\n          .map((r: any) => {\n            const avg = toNum((r as TeamACWRDailyRow).average_acwr);\n            const cnt = toNum((r as TeamACWRDailyRow).athlete_count);\n            return {\n              date: r.date,\n              averageACWR: avg != null ? round2(avg) : NaN,\n              athleteCount: cnt != null ? Math.max(0, Math.round(cnt)) : 0,\n              riskLevel: evalRisk(avg),\n              averageRPE: null,\n              averageLoad: null,\n            };\n          })\n          //  NaN\n          .filter((x) => Number.isFinite(x.averageACWR));\n\n        // ----------------------------\n        // 2) RPE/Loadview: team_training_daily\n        // ----------------------------\n        let merged = base;\n\n        try {\n          const { data: dailyRows, error: dailyErr } = await supabase\n            .from('team_training_daily')\n            .select('team_id,date,average_rpe,average_load,athlete_count')\n            .eq('team_id', teamId)\n            .gte('date', fromKey)\n            .lte('date', toKey)\n            .order('date', { ascending: true });\n\n          if (dailyErr) throw dailyErr;\n\n          if (reqSeqRef.current !== mySeq) return;\n\n          const mapDaily = new Map<string, TeamTrainingDailyRow>();\n          (dailyRows || []).forEach((r: any) => mapDaily.set(r.date, r));\n\n          merged = base.map((row) => {\n            const add = mapDaily.get(row.date);\n            return {\n              ...row,\n              averageRPE: toNum(add?.average_rpe) ?? null,\n              averageLoad: toNum(add?.average_load) ?? null,\n            };\n          });\n        } catch {\n          // ACWR\n          merged = base;\n        }\n\n        if (reqSeqRef.current !== mySeq) return;\n        setTeamACWRData(merged);\n\n        // ----------------------------\n        // 3) ACWR\n        //    \n        // ----------------------------\n        // StaffViewACWR\n        // OK\n        setAthleteACWRMap({});\n      } catch (e) {\n        console.error('[useTeamACWR] fetch failed', e);\n        if (reqSeqRef.current === mySeq) {\n          setTeamACWRData([]);\n          setAthleteACWRMap({});\n        }\n      } finally {\n        if (reqSeqRef.current === mySeq) setLoading(false);\n      }\n    })();\n  }, [teamId]);\n\n  return { teamACWRData, athleteACWRMap, loading };\n}","import { supabase } from './supabase';\nimport type { Database } from './database.types';\n\ntype Organization = Database['public']['Tables']['organizations']['Row'];\ntype OrganizationInsert = Database['public']['Tables']['organizations']['Insert'];\ntype OrganizationUpdate = Database['public']['Tables']['organizations']['Update'];\ntype Team = Database['public']['Tables']['teams']['Row'];\ntype TeamInsert = Database['public']['Tables']['teams']['Insert'];\ntype TeamUpdate = Database['public']['Tables']['teams']['Update'];\ntype OrganizationMember = Database['public']['Tables']['organization_members']['Row'];\ntype OrganizationMemberInsert = Database['public']['Tables']['organization_members']['Insert'];\n\nexport const organizationQueries = {\n  async getUserOrganizations(userId: string) {\n    const { data, error } = await supabase.rpc('get_user_organizations', {\n      user_uuid: userId\n    });\n\n    if (error) throw error;\n    return data;\n  },\n\n  async getOrganizationHierarchy(organizationId: string) {\n    const { data, error } = await supabase.rpc('get_organization_hierarchy', {\n      org_id: organizationId\n    });\n\n    if (error) throw error;\n    return data;\n  },\n\n  async getOrganizations() {\n    const { data, error } = await supabase\n      .from('organizations')\n      .select('*')\n      .order('name');\n\n    if (error) {\n      console.error('Organizations query error:', {\n        message: error.message,\n        details: error.details,\n        hint: error.hint,\n        code: error.code\n      });\n      throw new Error(`Failed to load organizations: ${error.message} (${error.code})`);\n    }\n    return data as Organization[];\n  },\n\n  async getOrganizationById(id: string) {\n    const { data, error } = await supabase\n      .from('organizations')\n      .select('*')\n      .eq('id', id)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data as Organization | null;\n  },\n\n  async createOrganization(organization: OrganizationInsert) {\n    const { data, error } = await supabase\n      .from('organizations')\n      .insert(organization)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Organization;\n  },\n\n  async updateOrganization(id: string, updates: OrganizationUpdate) {\n    const { data, error } = await supabase\n      .from('organizations')\n      .update(updates)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Organization;\n  },\n\n  async deleteOrganization(id: string) {\n    const { error } = await supabase\n      .from('organizations')\n      .delete()\n      .eq('id', id);\n\n    if (error) throw error;\n  },\n\n  async getOrganizationTeams(organizationId: string) {\n    const { data, error } = await supabase\n      .from('teams')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .order('name');\n\n    if (error) {\n      console.error('Organization teams query error:', {\n        message: error.message,\n        details: error.details,\n        hint: error.hint,\n        code: error.code\n      });\n      throw new Error(`Failed to load organization teams: ${error.message}`);\n    }\n    return data;\n  },\n\n  async getTeamById(id: string) {\n    const { data, error } = await supabase\n      .from('teams')\n      .select('*')\n      .eq('id', id)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data as Team | null;\n  },\n\n  async createTeam(team: TeamInsert) {\n    const cleanedTeam = {\n      name: team.name,\n      organization_id: team.organization_id,\n      department_id: team.department_id\n    };\n\n    console.log('Creating team with data:', cleanedTeam);\n    const { data, error } = await supabase\n      .from('teams')\n      .insert(cleanedTeam)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Team creation error:', {\n        message: error.message,\n        details: error.details,\n        hint: error.hint,\n        code: error.code\n      });\n      throw error;\n    }\n    console.log('Team created successfully:', data);\n    return data as Team;\n  },\n\n  async updateTeam(id: string, updates: TeamUpdate) {\n    const { data, error } = await supabase\n      .from('teams')\n      .update(updates)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Team;\n  },\n\n  async deleteTeam(id: string) {\n    const { error } = await supabase\n      .from('teams')\n      .delete()\n      .eq('id', id);\n\n    if (error) throw error;\n  },\n\n  async getOrganizationMembers(organizationId: string) {\n    const { data, error } = await supabase\n      .from('organization_members')\n      .select(`\n        *,\n        users:user_id (\n          id,\n          user_id,\n          name,\n          email,\n          role\n        )\n      `)\n      .eq('organization_id', organizationId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data;\n  },\n\n  async addOrganizationMember(member: OrganizationMemberInsert) {\n    const { data, error } = await supabase\n      .from('organization_members')\n      .insert(member)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as OrganizationMember;\n  },\n\n  async updateOrganizationMemberRole(id: string, role: OrganizationMember['role']) {\n    const { data, error } = await supabase\n      .from('organization_members')\n      .update({ role })\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as OrganizationMember;\n  },\n\n  async removeOrganizationMember(id: string) {\n    const { error } = await supabase\n      .from('organization_members')\n      .delete()\n      .eq('id', id);\n\n    if (error) throw error;\n  },\n\n\n  async getOrganizationStats() {\n    const { data, error } = await supabase\n      .from('organization_stats')\n      .select('*')\n      .order('name');\n\n    if (error) throw error;\n    return data;\n  },\n\n  async checkOrphanedRecords() {\n    const { data, error } = await supabase.rpc('check_orphaned_records');\n\n    if (error) throw error;\n    return data;\n  },\n\n  async assignTeamToOrganization(teamId: string, organizationId: string | null) {\n    const { data, error } = await supabase\n      .from('teams')\n      .update({\n        organization_id: organizationId\n      })\n      .eq('id', teamId)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n};\n","import { useState, useEffect, useCallback } from 'react';\nimport { organizationQueries } from '../lib/organizationQueries';\nimport type { Database } from '../lib/database.types';\n\ntype Organization = Database['public']['Tables']['organizations']['Row'];\ntype Team = Database['public']['Tables']['teams']['Row'];\n\nexport function useOrganizations(userId: string | undefined) {\n  const [organizations, setOrganizations] = useState<Organization[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!userId) {\n      setLoading(false);\n      return;\n    }\n\n    loadOrganizations();\n  }, [userId]);\n\n  const loadOrganizations = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Log auth state for debugging\n      const { data: { session } } = await (await import('../lib/supabase')).supabase.auth.getSession();\n      console.log('Auth state when loading organizations:', {\n        hasSession: !!session,\n        userId: session?.user?.id,\n        email: session?.user?.email\n      });\n\n      const data = await organizationQueries.getOrganizations();\n      console.log('Organizations loaded successfully:', data.length);\n      setOrganizations(data);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to load organizations';\n      setError(errorMessage);\n      console.error('Error loading organizations:', {\n        error: err,\n        message: errorMessage,\n        stack: err instanceof Error ? err.stack : undefined\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createOrganization = async (name: string, description?: string) => {\n    try {\n      const newOrg = await organizationQueries.createOrganization({\n        name,\n        description: description || ''\n      });\n      setOrganizations(prev => [...prev, newOrg].sort((a, b) => a.name.localeCompare(b.name)));\n      return newOrg;\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to create organization';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  const updateOrganization = async (id: string, updates: { name?: string; description?: string; settings?: Record<string, any> }) => {\n    try {\n      const updated = await organizationQueries.updateOrganization(id, updates);\n      setOrganizations(prev =>\n        prev.map(org => org.id === id ? updated : org).sort((a, b) => a.name.localeCompare(b.name))\n      );\n      return updated;\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to update organization';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  const deleteOrganization = async (id: string) => {\n    try {\n      await organizationQueries.deleteOrganization(id);\n      setOrganizations(prev => prev.filter(org => org.id !== id));\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to delete organization';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  return {\n    organizations,\n    loading,\n    error,\n    createOrganization,\n    updateOrganization,\n    deleteOrganization,\n    reload: loadOrganizations\n  };\n}\n\nexport function useOrganizationTeams(organizationId: string | undefined) {\n  const [teams, setTeams] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadTeams = useCallback(async () => {\n    if (!organizationId) return;\n\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await organizationQueries.getOrganizationTeams(organizationId);\n      console.log('Teams loaded:', data);\n      setTeams(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load teams');\n      console.error('Error loading teams:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [organizationId]);\n\n  useEffect(() => {\n    if (!organizationId) {\n      setTeams([]);\n      setLoading(false);\n      return;\n    }\n\n    loadTeams();\n  }, [organizationId, loadTeams]);\n\n  const createTeam = async (name: string) => {\n    if (!organizationId) throw new Error('Organization ID is required');\n\n    try {\n      const newTeam = await organizationQueries.createTeam({\n        organization_id: organizationId,\n        name\n      });\n      console.log('New team created, reloading teams...');\n      await loadTeams();\n      console.log('Teams reloaded after creation');\n      return newTeam;\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to create team';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  const updateTeam = async (id: string, updates: { name?: string; description?: string; settings?: Record<string, any> }) => {\n    try {\n      const updated = await organizationQueries.updateTeam(id, updates);\n      await loadTeams();\n      return updated;\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to update team';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  const deleteTeam = async (id: string) => {\n    try {\n      await organizationQueries.deleteTeam(id);\n      setTeams(prev => prev.filter(team => team.id !== id));\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to delete team';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  return {\n    teams,\n    loading,\n    error,\n    createTeam,\n    updateTeam,\n    deleteTeam,\n    reload: loadTeams\n  };\n}\n\nexport function useOrganizationHierarchy(organizationId: string | undefined) {\n  const [hierarchy, setHierarchy] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!organizationId) {\n      setHierarchy(null);\n      setLoading(false);\n      return;\n    }\n\n    loadHierarchy();\n  }, [organizationId]);\n\n  const loadHierarchy = async () => {\n    if (!organizationId) return;\n\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await organizationQueries.getOrganizationHierarchy(organizationId);\n      setHierarchy(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load organization hierarchy');\n      console.error('Error loading organization hierarchy:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return {\n    hierarchy,\n    loading,\n    error,\n    reload: loadHierarchy\n  };\n}\n","import { useEffect, useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\n\ntype TrainingRow = {\n  user_id: string;\n  date: string; // YYYY-MM-DD\n  rpe: number;\n  duration_min: number;\n  load: number | null;\n  growth_vector: number | null;\n  intent_signal: number | null;\n  arrow_score: number | null;\n  signal_score: number | null;\n};\n\nexport type DailyCyclePoint = {\n  date: string;\n  x: number;\n  y: number;\n  load: number;\n  rpe: number;\n  n: number;\n};\n\nconst chunk = <T,>(arr: T[], size: number) => {\n  const res: T[][] = [];\n  for (let i = 0; i < arr.length; i += size) res.push(arr.slice(i, i + size));\n  return res;\n};\n\nconst clamp = (n: number, min: number, max: number) => Math.max(min, Math.min(max, n));\nconst avg = (sum: number, n: number) => (n > 0 ? sum / n : 0);\n\nfunction getWeekRangeFromDateKey(dateKey: string) {\n  const d = new Date(`${dateKey}T00:00:00+09:00`);\n  const day = d.getDay();\n  const diffToMon = (day + 6) % 7;\n  const mon = new Date(d);\n  mon.setDate(d.getDate() - diffToMon);\n  const sun = new Date(mon);\n  sun.setDate(mon.getDate() + 6);\n\n  const toKey = (x: Date) =>\n    new Intl.DateTimeFormat('en-CA', {\n      timeZone: 'Asia/Tokyo',\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n    }).format(x);\n\n  return { start: toKey(mon), end: toKey(sun) };\n}\n\nexport function useWeeklyGrowthCycle(params: { baseDate: string; athleteIds: string[] }) {\n  const { baseDate, athleteIds } = params;\n\n  const [teamDaily, setTeamDaily] = useState<DailyCyclePoint[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const weekRange = useMemo(() => {\n    if (!baseDate) return { start: '', end: '' };\n    return getWeekRangeFromDateKey(baseDate);\n  }, [baseDate]);\n\n  //    \n  const athleteIdsKey = useMemo(() => {\n    const ids = Array.isArray(athleteIds) ? athleteIds : [];\n    return ids.slice().sort().join(',');\n  }, [athleteIds]);\n\n  useEffect(() => {\n    const ids = athleteIdsKey ? athleteIdsKey.split(',').filter(Boolean) : [];\n\n    if (!weekRange.start || !weekRange.end || ids.length === 0) {\n      setTeamDaily([]);\n      setLoading(false);\n      setError(null);\n      return;\n    }\n\n    let cancelled = false;\n\n    (async () => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const all: TrainingRow[] = [];\n        for (const idChunk of chunk(ids, 50)) {\n          const { data, error } = await supabase\n            .from('training_records')\n            .select(\n              'user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score'\n            )\n            .in('user_id', idChunk)\n            .gte('date', weekRange.start)\n            .lte('date', weekRange.end);\n\n          if (error) throw error;\n          all.push(...((data ?? []) as TrainingRow[]));\n        }\n\n        if (cancelled) return;\n\n        const map = new Map<\n          string,\n          { sumX: number; sumY: number; sumLoad: number; sumRpe: number; n: number }\n        >();\n\n        for (const r of all) {\n          const xRaw = (r.intent_signal ?? r.signal_score ?? 50) as number;\n          const yRaw = (r.growth_vector ?? r.arrow_score ?? 50) as number;\n\n          const loadRaw =\n            typeof r.load === 'number' && isFinite(r.load)\n              ? r.load\n              : (r.rpe ?? 0) * (r.duration_min ?? 0);\n\n          const x = clamp(Number(xRaw) || 50, 0, 100);\n          const y = clamp(Number(yRaw) || 50, 0, 100);\n          const load = clamp(Number(loadRaw) || 0, 0, 999999);\n          const rpe = clamp(Number(r.rpe) || 0, 0, 10);\n\n          const key = r.date;\n          const cur = map.get(key) ?? { sumX: 0, sumY: 0, sumLoad: 0, sumRpe: 0, n: 0 };\n          cur.sumX += x;\n          cur.sumY += y;\n          cur.sumLoad += load;\n          cur.sumRpe += rpe;\n          cur.n += 1;\n          map.set(key, cur);\n        }\n\n        const days: string[] = [];\n        const start = new Date(`${weekRange.start}T00:00:00+09:00`);\n        for (let i = 0; i < 7; i++) {\n          const d = new Date(start);\n          d.setDate(start.getDate() + i);\n          const key = new Intl.DateTimeFormat('en-CA', {\n            timeZone: 'Asia/Tokyo',\n            year: 'numeric',\n            month: '2-digit',\n            day: '2-digit',\n          }).format(d);\n          days.push(key);\n        }\n\n        const teamDailyPoints: DailyCyclePoint[] = days.map((date) => {\n          const v = map.get(date);\n          if (!v || v.n === 0) return { date, x: 50, y: 50, load: 0, rpe: 0, n: 0 };\n          return {\n            date,\n            x: Math.round(avg(v.sumX, v.n) * 10) / 10,\n            y: Math.round(avg(v.sumY, v.n) * 10) / 10,\n            load: Math.round(avg(v.sumLoad, v.n)),\n            rpe: Math.round(avg(v.sumRpe, v.n) * 10) / 10,\n            n: v.n,\n          };\n        });\n\n        setTeamDaily(teamDailyPoints);\n      } catch (e: any) {\n        console.error('[useWeeklyGrowthCycle] error', e);\n        if (!cancelled) {\n          setError(e?.message ?? '');\n          setTeamDaily([]);\n        }\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [weekRange.start, weekRange.end, athleteIdsKey]);\n\n  return { weekRange, teamDaily, loading, error };\n}","import React, { useMemo } from 'react';\nimport {\n  ResponsiveContainer,\n  ScatterChart,\n  Scatter,\n  CartesianGrid,\n  XAxis,\n  YAxis,\n  Tooltip,\n  Legend,\n  LineChart,\n  Line,\n} from 'recharts';\nimport type { DailyCyclePoint } from '../hooks/useWeeklyGrowthCycle';\n\nconst clamp = (n: number, min: number, max: number) => Math.max(min, Math.min(max, n));\n\nfunction loadToRadius(load: number, maxLoad: number) {\n  if (!isFinite(load) || load <= 0) return 5;\n  if (!isFinite(maxLoad) || maxLoad <= 0) return 5;\n  const t = clamp(load / maxLoad, 0, 1);\n  return 5 + t * 13; // 518\n}\n\nexport function WeeklyGrowthCycleView(props: { teamDaily: DailyCyclePoint[]; weekLabel: string }) {\n  const { teamDaily, weekLabel } = props;\n\n  const maxLoad = useMemo(() => {\n    if (!teamDaily?.length) return 0;\n    return Math.max(...teamDaily.map((d) => d.load ?? 0), 0);\n  }, [teamDaily]);\n\n  // n=0\n  const matrixPoints = useMemo(() => {\n    return (teamDaily ?? []).map((d) => ({\n      ...d,\n      name: d.n > 0 ? d.date : `${d.date}`,\n      opacity: d.n > 0 ? 0.55 : 0.12,\n    }));\n  }, [teamDaily]);\n\n  // n=0 0 \n  const timeline = useMemo(() => {\n    return (teamDaily ?? []).map((d) => ({\n      date: d.date.slice(5), // \"MM-DD\"\n      load: d.load,\n      growth: d.y,\n      understanding: d.x,\n      n: d.n,\n    }));\n  }, [teamDaily]);\n\n  return (\n    <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5 space-y-4\">\n      <div>\n        <div className=\"text-sm sm:text-base font-semibold text-gray-900\">{weekLabel}</div>\n        <div className=\"text-xs text-gray-500\">\n           load / load\n        </div>\n      </div>\n\n      {/* 7 */}\n      <div style={{ width: '100%', height: 360 }}>\n        <ResponsiveContainer>\n          <ScatterChart margin={{ top: 10, right: 14, bottom: 10, left: 10 }}>\n            <CartesianGrid />\n            <XAxis type=\"number\" dataKey=\"x\" domain={[0, 100]} ticks={[0, 25, 50, 75, 100]} />\n            <YAxis type=\"number\" dataKey=\"y\" domain={[0, 100]} ticks={[0, 25, 50, 75, 100]} />\n            <Tooltip\n              cursor={{ strokeDasharray: '3 3' }}\n              content={({ active, payload }) => {\n                if (!active || !payload?.length) return null;\n                const p: any = payload[0].payload;\n                return (\n                  <div className=\"bg-white border border-gray-200 rounded-lg p-3 shadow\">\n                    <div className=\"font-semibold mb-1\">{p.date}</div>\n                    <div className=\"text-sm\">: {Math.round(p.x)}</div>\n                    <div className=\"text-sm\">: {Math.round(p.y)}</div>\n                    <div className=\"text-sm\">(load): {Math.round(p.load)}</div>\n                    <div className=\"text-sm\">RPE: {p.rpe}</div>\n                    <div className=\"text-sm\">: {p.n}</div>\n                  </div>\n                );\n              }}\n            />\n            <Legend />\n            <Scatter\n              name=\"\"\n              data={matrixPoints}\n              fill=\"#3b82f6\"\n              shape={(props: any) => {\n                const { cx, cy, payload } = props;\n                const r = loadToRadius(payload?.load ?? 0, maxLoad);\n                return (\n                  <circle\n                    cx={cx}\n                    cy={cy}\n                    r={r}\n                    fill=\"#3b82f6\"\n                    fillOpacity={payload?.opacity ?? 0.55}\n                    stroke=\"#1d4ed8\"\n                    strokeWidth={1}\n                  />\n                );\n              }}\n            />\n          </ScatterChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/*  */}\n      <div style={{ width: '100%', height: 260 }}>\n        <ResponsiveContainer>\n          <LineChart data={timeline} margin={{ top: 10, right: 14, bottom: 10, left: 10 }}>\n            <CartesianGrid />\n            <XAxis dataKey=\"date\" />\n            <YAxis />\n            <Tooltip />\n            <Legend />\n            <Line type=\"monotone\" dataKey=\"load\" name=\"(load)\" />\n            <Line type=\"monotone\" dataKey=\"growth\" name=\"()\" />\n            <Line type=\"monotone\" dataKey=\"understanding\" name=\"()\" />\n          </LineChart>\n        </ResponsiveContainer>\n      </div>\n\n      <div className=\"text-xs text-gray-500\">\n        / 0100 n=0 load0\n      </div>\n    </div>\n  );\n}","// src/hooks/useDailyGrowthMatrix.ts\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { supabase } from '../lib/supabase';\n\ntype TrainingRow = {\n  user_id: string;\n  date: string;\n  rpe: number;\n  duration_min: number;\n  load: number | null;\n  growth_vector: number | null;\n  intent_signal: number | null;\n  arrow_score: number | null;\n  signal_score: number | null;\n};\n\nexport type MatrixPoint = {\n  user_id: string;\n  name: string;\n  x: number; // understanding 0-100\n  y: number; // growth 0-100\n  load: number; // sRPE\n  rpe: number;\n  duration_min: number;\n};\n\nconst chunk = <T,>(arr: T[], size: number) => {\n  const res: T[][] = [];\n  for (let i = 0; i < arr.length; i += size) res.push(arr.slice(i, i + size));\n  return res;\n};\n\nconst clamp = (n: number, min: number, max: number) => Math.max(min, Math.min(max, n));\n\ntype AthleteLite = {\n  id: string;\n  name?: string | null;\n  nickname?: string | null;\n  email?: string | null;\n};\n\nexport function useDailyGrowthMatrix(params: { date: string; athletes: AthleteLite[] }) {\n  const { date, athletes } = params;\n\n  const [points, setPoints] = useState<MatrixPoint[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  //   useEffect \n  const athletesKey = useMemo(() => {\n    if (!Array.isArray(athletes) || athletes.length === 0) return '';\n    return athletes\n      .map((a) => {\n        const display = a.nickname || a.name || a.email || '';\n        return `${a.id}:${display}`;\n      })\n      .sort()\n      .join('|');\n  }, [athletes]);\n\n  const idsKey = useMemo(() => {\n    if (!Array.isArray(athletes) || athletes.length === 0) return '';\n    return athletes\n      .map((a) => a.id)\n      .filter(Boolean)\n      .sort()\n      .join(',');\n  }, [athletes]);\n\n  const ids = useMemo(() => {\n    if (!idsKey) return [];\n    return idsKey.split(',').filter(Boolean);\n  }, [idsKey]);\n\n  const nameMap = useMemo(() => {\n    const m: Record<string, string> = {};\n    if (!athletesKey) return m;\n\n    // athletesKey \n    for (const token of athletesKey.split('|')) {\n      const [id, ...rest] = token.split(':');\n      const display = rest.join(':') || '';\n      if (id) m[id] = display;\n    }\n    return m;\n  }, [athletesKey]);\n\n  //  \n  const reqSeqRef = useRef(0);\n\n  useEffect(() => {\n    if (!date || ids.length === 0) {\n      setPoints([]);\n      setError(null);\n      setLoading(false);\n      return;\n    }\n\n    let cancelled = false;\n    const reqSeq = ++reqSeqRef.current;\n\n    (async () => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const rows: TrainingRow[] = [];\n\n        for (const idChunk of chunk(ids, 50)) {\n          const { data, error } = await supabase\n            .from('training_records')\n            .select(\n              'user_id,date,rpe,duration_min,load,growth_vector,intent_signal,arrow_score,signal_score'\n            )\n            .in('user_id', idChunk)\n            .eq('date', date);\n\n          if (error) throw error;\n          rows.push(...((data ?? []) as TrainingRow[]));\n        }\n\n        if (cancelled) return;\n        if (reqSeq !== reqSeqRef.current) return; //  \n\n        //   user_id 1\n        const acc = new Map<\n          string,\n          { sumX: number; sumY: number; sumLoad: number; sumRpe: number; sumDur: number; n: number }\n        >();\n\n        for (const r of rows) {\n          const xRaw = (r.intent_signal ?? r.signal_score ?? 50) as number;\n          const yRaw = (r.growth_vector ?? r.arrow_score ?? 50) as number;\n\n          const loadRaw =\n            typeof r.load === 'number' && isFinite(r.load)\n              ? r.load\n              : (r.rpe ?? 0) * (r.duration_min ?? 0);\n\n          const x = clamp(Number(xRaw) || 50, 0, 100);\n          const y = clamp(Number(yRaw) || 50, 0, 100);\n          const load = clamp(Number(loadRaw) || 0, 0, 999999);\n          const rpe = clamp(Number(r.rpe) || 0, 0, 10);\n          const dur = clamp(Number(r.duration_min) || 0, 0, 100000);\n\n          const cur = acc.get(r.user_id) ?? {\n            sumX: 0,\n            sumY: 0,\n            sumLoad: 0,\n            sumRpe: 0,\n            sumDur: 0,\n            n: 0,\n          };\n          cur.sumX += x;\n          cur.sumY += y;\n          cur.sumLoad += load;\n          cur.sumRpe += rpe;\n          cur.sumDur += dur;\n          cur.n += 1;\n          acc.set(r.user_id, cur);\n        }\n\n        const pts: MatrixPoint[] = Array.from(acc.entries()).map(([user_id, v]) => {\n          const n = v.n || 1;\n          return {\n            user_id,\n            name: nameMap[user_id] || '',\n            x: Math.round((v.sumX / n) * 10) / 10,\n            y: Math.round((v.sumY / n) * 10) / 10,\n            load: Math.round(v.sumLoad / n),\n            rpe: Math.round((v.sumRpe / n) * 10) / 10,\n            duration_min: Math.round(v.sumDur / n),\n          };\n        });\n\n        setPoints(pts);\n      } catch (e: any) {\n        console.error('[useDailyGrowthMatrix] error', e);\n        if (!cancelled) {\n          setError(e?.message ?? '');\n          setPoints([]);\n        }\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n    //    \n  }, [date, idsKey, athletesKey]);\n\n  const teamAvg = useMemo(() => {\n    if (!points || points.length === 0) return null;\n    const mean = (arr: number[]) => arr.reduce((a, b) => a + b, 0) / arr.length;\n    return {\n      x: mean(points.map((p) => p.x)),\n      y: mean(points.map((p) => p.y)),\n      load: mean(points.map((p) => p.load)),\n    };\n  }, [points]);\n\n  return { points, teamAvg, loading, error };\n}","// src/lib/perfInsight.ts\nexport type PerfDirection = \"higher\" | \"lower\";\n\nexport type PerfInsightInput = {\n  // \n  athleteName?: string;\n  testDisplayName: string;\n\n  // \n  latestValue: number | null;\n  bestValue?: number | null;\n\n  // \n  unitLabel?: string; // \"kg\", \"\", \"cm\", \"BW\" \n\n  //  lower\n  direction: PerfDirection;\n\n  // \n  teamAvg?: number | null;\n  p10?: number | null;\n  p90?: number | null;\n\n  // \n  teamRank?: number | null; // 1 \n  teamN?: number | null;\n  topPercent?: number | null; // 0100\n\n  // \n  prevValue?: number | null; // \n};\n\nexport type PerfInsight = {\n  title: string;\n  bullets: string[];\n  nextActions: string[];\n  note?: string;\n};\n\n// -------------------------\n// helpers\n// -------------------------\nexport const clamp = (n: number, a: number, b: number) => Math.max(a, Math.min(b, n));\n\nexport const roundTo = (n: number, digits: number) => {\n  const p = Math.pow(10, digits);\n  return Math.round(n * p) / p;\n};\n\nexport const formatVal = (v: number, digits: number, unit?: string) => {\n  const s = v.toFixed(digits);\n  return unit ? `${s} ${unit}` : s;\n};\n\nexport const digitsForTest = (testDisplayName?: string) => {\n  // RSI/RSI-mod 22 2 \n  // 22\n  if (!testDisplayName) return 2;\n  const n = testDisplayName.toLowerCase();\n  if (n.includes(\"rsi\")) return 2;\n  return 2;\n};\n\nexport const inferDirection = (testDisplayName: string): PerfDirection => {\n  const n = testDisplayName.toLowerCase();\n\n  // \n  if (n.includes(\"10m\") || n.includes(\"20m\") || n.includes(\"30m\")) return \"lower\";\n  if (n.includes(\"sprint\") || n.includes(\"dash\")) return \"lower\";\n  if (n.includes(\"time\") || n.includes(\"\") || n.includes(\"sec\")) return \"lower\";\n\n  //  etc\n  return \"higher\";\n};\n\nconst betterThan = (a: number, b: number, dir: PerfDirection) => {\n  return dir === \"higher\" ? a > b : a < b;\n};\n\nconst diff = (a: number, b: number, dir: PerfDirection) => {\n  //  dir \n  const d = a - b;\n  return dir === \"higher\" ? d : -d;\n};\n\nconst gradeVsTeam = (latest: number, teamAvg: number, dir: PerfDirection) => {\n  const d = diff(latest, teamAvg, dir);\n  // 0.0 \n  const eps = Math.max(Math.abs(teamAvg) * 0.002, 0.0001);\n\n  if (d > eps) return \"above\"; // \n  if (d < -eps) return \"below\"; // \n  return \"equal\";\n};\n\n// -------------------------\n// main\n// -------------------------\nexport const buildPerfInsight = (input: PerfInsightInput): PerfInsight | null => {\n  const {\n    athleteName,\n    testDisplayName,\n    latestValue,\n    bestValue,\n    unitLabel,\n    direction,\n    teamAvg,\n    p10,\n    p90,\n    teamRank,\n    teamN,\n    topPercent,\n    prevValue,\n  } = input;\n\n  if (latestValue == null || !Number.isFinite(latestValue)) return null;\n\n  const digits = digitsForTest(testDisplayName);\n\n  const title = `${athleteName ? athleteName + \"\" : \"\"}${testDisplayName}`;\n\n  const bullets: string[] = [];\n  const nextActions: string[] = [];\n\n  bullets.push(`${formatVal(latestValue, digits, unitLabel)}`);\n\n  if (bestValue != null && Number.isFinite(bestValue)) {\n    // best  best best\n    bullets.push(`${formatVal(bestValue, digits, unitLabel)}`);\n  }\n\n  // \n  if (prevValue != null && Number.isFinite(prevValue)) {\n    const d = diff(latestValue, prevValue, direction);\n    const sign = d >= 0 ? \"+\" : \"\";\n    bullets.push(`${sign}${roundTo(d, digits).toFixed(digits)} `);\n    if (Math.abs(d) < Math.max(Math.abs(latestValue) * 0.003, 0.0001)) {\n      nextActions.push(\"/\");\n    }\n  }\n\n  // \n  if (teamAvg != null && Number.isFinite(teamAvg)) {\n    const g = gradeVsTeam(latestValue, teamAvg, direction);\n    const d = diff(latestValue, teamAvg, direction);\n    const sign = d >= 0 ? \"+\" : \"\";\n    bullets.push(`${formatVal(teamAvg, digits, unitLabel)}${sign}${roundTo(d, digits).toFixed(digits)}  `);\n\n    if (g === \"above\") {\n      bullets.push(\"\");\n      nextActions.push(\"1\");\n    } else if (g === \"below\") {\n      bullets.push(\"\");\n      // \n      const n = testDisplayName.toLowerCase();\n      if (direction === \"lower\") {\n        nextActions.push(\"/\");\n        nextActions.push(\"10m210m2\");\n      } else {\n        nextActions.push(\" or \");\n        nextActions.push(\"\");\n      }\n    } else {\n      bullets.push(\"\");\n      nextActions.push(\"\");\n    }\n  }\n\n  // p10/p90\n  if (p10 != null && p90 != null && Number.isFinite(p10) && Number.isFinite(p90)) {\n    // lower  p10 \n    bullets.push(`P10 ${formatVal(p10, digits, unitLabel)} / P90 ${formatVal(p90, digits, unitLabel)}`);\n    const inBand =\n      direction === \"higher\"\n        ? latestValue >= Math.min(p10, p90) && latestValue <= Math.max(p10, p90)\n        : latestValue <= Math.max(p10, p90) && latestValue >= Math.min(p10, p90); // lower\n    if (!inBand) nextActions.push(\"//\");\n  }\n\n  // \n  if (teamRank != null && teamN != null && teamN > 0) {\n    bullets.push(`${teamRank}/${teamN}${topPercent != null ? `${roundTo(topPercent, 1)}%` : \"\"}`);\n    if (teamRank <= Math.max(3, Math.floor(teamN * 0.1))) {\n      nextActions.push(\"//\");\n    }\n  }\n\n  const note =\n    \"\";\n\n  return {\n    title,\n    bullets: bullets.filter(Boolean),\n    nextActions: Array.from(new Set(nextActions)).slice(0, 4),\n    note,\n  };\n};","// src/components/CoachAthletePerformanceModal.tsx\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { X } from 'lucide-react';\nimport {\n  ResponsiveContainer,\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  Tooltip,\n  CartesianGrid,\n  ReferenceLine,\n} from 'recharts';\nimport { buildPerfInsight, inferDirection } from \"../lib/perfInsight\";\n\ntype MetricKey = 'primary_value' | 'relative_1rm';\n\ntype Props = {\n  open: boolean;\n  onClose: () => void;\n  teamId: string;\n  athleteUserId: string;\n  athleteName: string;\n  testTypeId: string;\n  metricKey: MetricKey;\n};\n\ntype Point = {\n  date: string; // YYYY-MM-DD\n  value: number;\n};\n\ntype TestTypeInfo = {\n  id: string;\n  display_name: string;\n  unit: string;\n  is_strength: boolean;\n};\n\ntype Benchmark = {\n  avg_value: number | null;\n  p10: number | null;\n  p90: number | null;\n};\n\n//  2\nconst digitsForByUnit = (unit?: string) => {\n  const u = (unit || '').trim();\n\n  //  1/100 \n  if (u === '' || u === 's' || u === 'sec') return 2;\n\n  // \n  const intUnits = new Set(['', '']);\n  if (intUnits.has(u)) return 0;\n\n  // 2\n  return 2;\n};\n\n//  ISO -> M/D\nconst formatJP = (iso: string) => {\n  const [y, m, d] = iso.split('-').map(Number);\n  if (!y || !m || !d) return iso;\n  return `${m}/${d}`;\n};\n\nexport default function CoachAthletePerformanceModal({\n  open,\n  onClose,\n  teamId,\n  athleteUserId,\n  athleteName,\n  testTypeId,\n  metricKey,\n}: Props) {\n  const [loading, setLoading] = useState(false);\n  const [err, setErr] = useState<string | null>(null);\n\n  const [testType, setTestType] = useState<TestTypeInfo | null>(null);\n  const [series, setSeries] = useState<Point[]>([]);\n  const [benchmark, setBenchmark] = useState<Benchmark | null>(null);\n\n  const isStrength = !!testType?.is_strength;\n\n  const metricLabel = !isStrength\n    ? ''\n    : metricKey === 'relative_1rm'\n      ? '1RM'\n      : '1RM';\n\n  const unitLabel = useMemo(() => {\n    if (!testType) return '';\n    if (metricKey === 'relative_1rm') return 'BW';\n    return testType.unit || '';\n  }, [testType, metricKey]);\n\n  //  1\n  const fmtValue = useMemo(() => {\n    const d = digitsForByUnit(unitLabel);\n    return (v: number | null | undefined) => {\n      if (v == null) return '';\n      const n = Number(v);\n      if (!Number.isFinite(n)) return '';\n      if (d === 0) return String(Math.round(n));\n      return n.toFixed(d);\n    };\n  }, [unitLabel]);\n\n  useEffect(() => {\n    if (!open) return;\n\n    let cancelled = false;\n\n    (async () => {\n      try {\n        setLoading(true);\n        setErr(null);\n\n        //  \n        const tt = await supabase\n          .from('performance_test_types')\n          .select('id, display_name, unit, is_strength')\n          .eq('id', testTypeId)\n          .single();\n\n        if (tt.error) throw tt.error;\n        if (!cancelled) setTestType(tt.data as any);\n\n        //  RPC\n        const { data: ts, error: tsErr } = await supabase.rpc('get_athlete_test_timeseries', {\n          p_team_id: teamId,\n          p_user_id: athleteUserId,\n          p_test_type_id: testTypeId,\n          p_metric: metricKey,\n          p_days: 730,\n        });\n        if (tsErr) throw tsErr;\n\n        const points: Point[] = (ts ?? [])\n          .map((r: any) => ({\n            date: r.date,\n            value: Number(r.value),\n          }))\n          .filter((p: any) => p.date && Number.isFinite(p.value))\n          .sort((a, b) => a.date.localeCompare(b.date));\n\n        if (!cancelled) setSeries(points);\n\n        //  \n        const { data: b, error: bErr } = await supabase.rpc('get_my_team_benchmarks', {\n          p_days: 90,\n          p_metric: metricKey,\n        });\n\n        if (!bErr && b) {\n          const row = Array.isArray(b) ? b[0] : b;\n          const bm: Benchmark = {\n            avg_value: row?.avg_value ?? row?.avg ?? null,\n            p10: row?.p10 ?? null,\n            p90: row?.p90 ?? null,\n          };\n          if (!cancelled) setBenchmark(bm);\n        } else {\n          if (!cancelled) setBenchmark(null);\n        }\n      } catch (e: any) {\n        console.error('[CoachAthletePerformanceModal] error', e);\n        if (!cancelled) {\n          setErr(e?.message ?? '');\n          setSeries([]);\n          setBenchmark(null);\n        }\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [open, teamId, athleteUserId, testTypeId, metricKey]);\n\n  const last = series.length ? series[series.length - 1] : null;\n\n  const insight = buildPerfInsight({\n    athleteName,\n    testDisplayName: testType?.display_name || \"\",\n    latestValue: last?.value ?? null,\n    prevValue: series.length >= 2 ? series[series.length - 2].value : null,\n    unitLabel,\n    direction: inferDirection(testType?.display_name || \"\"),\n    teamAvg: benchmark?.avg_value ?? null,\n    p10: benchmark?.p10 ?? null,\n    p90: benchmark?.p90 ?? null,\n    teamRank: null,\n    teamN: null,\n    topPercent: null,\n  });\n\n  if (!open) return null;\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* header */}\n        <div className=\"px-5 py-4 border-b flex items-start justify-between gap-3\">\n          <div className=\"min-w-0\">\n            <div className=\"text-sm text-gray-500\"></div>\n            <div className=\"text-lg font-bold text-gray-900 truncate\">\n              {athleteName} / {testType?.display_name || ''}{metricLabel ? `${metricLabel}` : ''}\n            </div>\n            <div className=\"text-xs text-gray-600 mt-1\">\n              {last ? `${last.date} / ${fmtValue(last.value)} ${unitLabel}` : ''}\n            </div>\n          </div>\n\n          <button\n            className=\"p-2 rounded-lg hover:bg-gray-100\"\n            onClick={onClose}\n            aria-label=\"close\"\n            title=\"\"\n          >\n            <X className=\"w-5 h-5 text-gray-600\" />\n          </button>\n        </div>\n\n        {/* body */}\n        <div className=\"p-5 space-y-4\">\n          {err && (\n            <div className=\"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2\">\n              {err}\n            </div>\n          )}\n\n          {/*  MVP */}\n          {insight && (\n            <div className=\"rounded-xl border border-gray-200 bg-gray-50 p-4\">\n              <div className=\"text-sm font-semibold text-gray-900\">{insight.title}</div>\n\n              <ul className=\"mt-2 space-y-1 text-sm text-gray-800 list-disc pl-5\">\n                {insight.bullets.map((t, i) => (\n                  <li key={i}>{t}</li>\n                ))}\n              </ul>\n\n              {insight.nextActions.length > 0 && (\n                <>\n                  <div className=\"mt-3 text-xs font-semibold text-gray-700\"></div>\n                  <ul className=\"mt-1 space-y-1 text-sm text-gray-800 list-disc pl-5\">\n                    {insight.nextActions.map((t, i) => (\n                      <li key={i}>{t}</li>\n                    ))}\n                  </ul>\n                </>\n              )}\n\n              {insight.note && <div className=\"mt-2 text-xs text-gray-500\">{insight.note}</div>}\n            </div>\n          )}\n\n          {loading ? (\n            <div className=\"flex items-center justify-center py-16\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n            </div>\n          ) : series.length === 0 ? (\n            <div className=\"py-12 text-center text-sm text-gray-500\"></div>\n          ) : (\n            <div className=\"h-64\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <LineChart data={series} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"date\" tickFormatter={formatJP} minTickGap={18} />\n                  <YAxis />\n                  <Tooltip\n                    formatter={(v: any) => `${fmtValue(Number(v))} ${unitLabel}`}\n                    labelFormatter={(l: any) => `: ${l}`}\n                  />\n                  {benchmark?.avg_value != null && (\n                    <ReferenceLine\n                      y={benchmark.avg_value}\n                      strokeDasharray=\"6 4\"\n                      label={{ value: '', position: 'insideTopRight' }}\n                    />\n                  )}\n                  {benchmark?.p10 != null && <ReferenceLine y={benchmark.p10} strokeDasharray=\"2 6\" />}\n                  {benchmark?.p90 != null && <ReferenceLine y={benchmark.p90} strokeDasharray=\"2 6\" />}\n                  <Line type=\"monotone\" dataKey=\"value\" strokeWidth={3} dot={false} />\n                </LineChart>\n              </ResponsiveContainer>\n            </div>\n          )}\n\n          {/* list */}\n          {series.length > 0 && (\n            <div className=\"border rounded-xl overflow-hidden\">\n              <div className=\"px-4 py-2 bg-gray-50 text-xs text-gray-600 flex justify-between\">\n                <span></span>\n                <span>{unitLabel || '-'}</span>\n              </div>\n              <div className=\"max-h-48 overflow-auto divide-y\">\n                {series\n                  .slice()\n                  .reverse()\n                  .map((p) => (\n                    <div key={p.date} className=\"px-4 py-2 text-sm flex justify-between\">\n                      <span className=\"text-gray-700\">{p.date}</span>\n                      <span className=\"font-semibold text-gray-900\">{fmtValue(p.value)}</span>\n                    </div>\n                  ))}\n              </div>\n            </div>\n          )}\n\n          <div className=\"text-xs text-gray-500\">\n             \n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","// src/components/TeamSeasonPhaseSettings.tsx\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { Plus, Pencil, Trash2, X, AlertTriangle, Save } from 'lucide-react';\nimport { getPhaseAdvice } from '../lib/phaseAdvice';\n\ntype PhaseType = 'off' | 'pre' | 'in' | 'peak' | 'transition' | 'unknown';\n\ntype TeamSeasonPhase = {\n  id: string;\n  team_id: string;\n  start_date: string; // YYYY-MM-DD\n  end_date: string;   // YYYY-MM-DD\n  phase_type: PhaseType;\n  focus_tags: string[];\n  note: string | null;\n};\n\ntype Props = {\n  teamId: string;\n  /** team */\n  teamName?: string;\n};\n\nconst PHASE_LABEL: Record<PhaseType, string> = {\n  off: '',\n  pre: '',\n  in: '',\n  peak: '',\n  transition: '',\n  unknown: '',\n};\n\nconst PHASE_BADGE: Record<PhaseType, string> = {\n  off: 'bg-gray-100 text-gray-700 border-gray-200',\n  pre: 'bg-blue-50 text-blue-700 border-blue-200',\n  in: 'bg-emerald-50 text-emerald-700 border-emerald-200',\n  peak: 'bg-rose-50 text-rose-700 border-rose-200',\n  transition: 'bg-amber-50 text-amber-700 border-amber-200',\n  unknown: 'bg-slate-50 text-slate-700 border-slate-200',\n};\n\nconst toShortRange = (s: string, e: string) => {\n  const sm = Number(s.slice(5, 7));\n  const sd = Number(s.slice(8, 10));\n  const em = Number(e.slice(5, 7));\n  const ed = Number(e.slice(8, 10));\n  if (!sm || !sd || !em || !ed) return `${s}${e}`;\n  return `${sm}/${sd}${em}/${ed}`;\n};\n\nconst todayISO = () => {\n  const d = new Date();\n  // JST \"YYYY-MM-DD\"\n  return new Intl.DateTimeFormat('en-CA', {\n    timeZone: 'Asia/Tokyo',\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n  }).format(d);\n};\n\nconst addDays = (iso: string, days: number) => {\n  const [y, m, d] = iso.split('-').map(Number);\n  const dt = new Date(y, (m ?? 1) - 1, d ?? 1);\n  dt.setDate(dt.getDate() + days);\n  return new Intl.DateTimeFormat('en-CA', {\n    timeZone: 'Asia/Tokyo',\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n  }).format(dt);\n};\n\nconst inRange = (date: string, start: string, end: string) => start <= date && date <= end;\n\nconst normalizeTags = (input: string) => {\n  // \",  \" \n  return input\n    .split(/[,\\n\\t ]+/)\n    .map((s) => s.trim())\n    .filter(Boolean)\n    .slice(0, 12);\n};\n\nfunction validatePhase(p: Partial<TeamSeasonPhase>) {\n  const errs: string[] = [];\n  if (!p.start_date) errs.push('');\n  if (!p.end_date) errs.push('');\n  if (p.start_date && p.end_date && p.start_date > p.end_date) errs.push(' >  ');\n  if (!p.phase_type) errs.push('');\n  return errs;\n}\n\nexport function TeamSeasonPhaseSettings({ teamId, teamName }: Props) {\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [err, setErr] = useState<string | null>(null);\n\n  const [phases, setPhases] = useState<TeamSeasonPhase[]>([]);\n  const [modalOpen, setModalOpen] = useState(false);\n  const [mode, setMode] = useState<'create' | 'edit'>('create');\n  const [editingId, setEditingId] = useState<string | null>(null);\n\n  // form\n  const [startDate, setStartDate] = useState<string>(() => todayISO());\n  const [endDate, setEndDate] = useState<string>(() => addDays(todayISO(), 20));\n  const [phaseType, setPhaseType] = useState<PhaseType>('pre');\n  const [tagsText, setTagsText] = useState<string>('  ');\n  const [note, setNote] = useState<string>('');\n\n  const sortedPhases = useMemo(() => {\n    return [...phases].sort((a, b) => (a.start_date || '').localeCompare(b.start_date || ''));\n  }, [phases]);\n\n  const today = todayISO();\n  const currentPhase = useMemo(() => {\n    return sortedPhases.find((p) => inRange(today, p.start_date, p.end_date)) ?? null;\n  }, [sortedPhases, today]);\n\n  const next3Weeks = useMemo(() => {\n    const end = addDays(today, 21);\n    // 1\n    return sortedPhases.filter((p) => !(p.end_date < today || end < p.start_date));\n  }, [sortedPhases, today]);\n\n  const isSamePhase = (a: TeamSeasonPhase | null, b: TeamSeasonPhase | null) => {\n    if (!a || !b) return false;\n    return a.phase_type === b.phase_type && a.start_date === b.start_date && a.end_date === b.end_date;\n  };\n  \n  const next3WeeksNoDup = useMemo(() => {\n    return next3Weeks.filter((p) => !isSamePhase(p, currentPhase));\n  }, [next3Weeks, currentPhase]);\n\n  const resetFormForCreate = () => {\n    const t = todayISO();\n    setStartDate(t);\n    setEndDate(addDays(t, 20));\n    setPhaseType('pre');\n    setTagsText('  ');\n    setNote('');\n    setMode('create');\n    setEditingId(null);\n  };\n\n  const openCreate = () => {\n    resetFormForCreate();\n    setErr(null);\n    setModalOpen(true);\n  };\n\n  const openEdit = (p: TeamSeasonPhase) => {\n    setMode('edit');\n    setEditingId(p.id);\n    setStartDate(p.start_date);\n    setEndDate(p.end_date);\n    setPhaseType(p.phase_type);\n    setTagsText((p.focus_tags ?? []).join(' '));\n    setNote(p.note ?? '');\n    setErr(null);\n    setModalOpen(true);\n  };\n\n  const closeModal = () => setModalOpen(false);\n\n  const fetchPhases = async () => {\n    if (!teamId) return;\n    try {\n      setLoading(true);\n      setErr(null);\n\n      //  RPC\n      const { data, error } = await supabase.rpc('list_team_season_phases', {\n        p_team_id: teamId,\n      });\n\n      if (error) throw error;\n\n      const rows = (data ?? []) as any[];\n      const mapped: TeamSeasonPhase[] = rows.map((r) => ({\n        id: r.id,\n        team_id: r.team_id ?? teamId,\n        start_date: r.start_date,\n        end_date: r.end_date,\n        phase_type: (r.phase_type ?? 'unknown') as PhaseType,\n        focus_tags: Array.isArray(r.focus_tags) ? r.focus_tags : [],\n        note: r.note ?? null,\n      }));\n\n      setPhases(mapped);\n    } catch (e: any) {\n      console.error('[TeamSeasonPhaseSettings] fetch error', e);\n      setErr(e?.message ?? '');\n      setPhases([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchPhases();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [teamId]);\n\n  const onSave = async () => {\n    try {\n      setSaving(true);\n      setErr(null);\n\n      const payload: Partial<TeamSeasonPhase> = {\n        start_date: startDate,\n        end_date: endDate,\n        phase_type: phaseType,\n        focus_tags: normalizeTags(tagsText),\n        note: note.trim() ? note.trim() : null,\n      };\n\n      const errs = validatePhase(payload);\n      if (errs.length > 0) {\n        setErr(errs.join(' / '));\n        return;\n      }\n\n      if (mode === 'create') {\n        const { error } = await supabase.from('team_season_phases').insert({\n          team_id: teamId,\n          start_date: payload.start_date,\n          end_date: payload.end_date,\n          phase_type: payload.phase_type,\n          focus_tags: payload.focus_tags ?? [],\n          note: payload.note ?? null,\n          // created_by  DB  auth.uid() OK\n        });\n        if (error) throw error;\n      } else {\n        if (!editingId) throw new Error('editingId is missing');\n        const { error } = await supabase\n          .from('team_season_phases')\n          .update({\n            start_date: payload.start_date,\n            end_date: payload.end_date,\n            phase_type: payload.phase_type,\n            focus_tags: payload.focus_tags ?? [],\n            note: payload.note ?? null,\n          })\n          .eq('id', editingId)\n          .eq('team_id', teamId);\n        if (error) throw error;\n      }\n\n      await fetchPhases();\n      closeModal();\n    } catch (e: any) {\n      console.error('[TeamSeasonPhaseSettings] save error', e);\n      setErr(e?.message ?? '');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const onDelete = async (p: TeamSeasonPhase) => {\n    const ok = window.confirm(`\\n${p.start_date}${p.end_date} / ${PHASE_LABEL[p.phase_type]}`);\n    if (!ok) return;\n\n    try {\n      setSaving(true);\n      setErr(null);\n\n      const { error } = await supabase\n        .from('team_season_phases')\n        .delete()\n        .eq('id', p.id)\n        .eq('team_id', teamId);\n\n      if (error) throw error;\n\n      await fetchPhases();\n    } catch (e: any) {\n      console.error('[TeamSeasonPhaseSettings] delete error', e);\n      setErr(e?.message ?? '');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/*  Header */}\n      <div className=\"bg-white rounded-xl border border-gray-200 p-4\">\n        <div className=\"flex items-center justify-between gap-3\">\n          <div className=\"min-w-0\">\n            <div className=\"text-xs text-gray-500\"></div>\n            <div className=\"text-base font-bold text-gray-900 truncate\">\n              {teamName ? ` - ${teamName}` : ''}\n            </div>\n            <div className=\"text-[11px] text-gray-500 mt-1\">\n               3\n            </div>\n          </div>\n  \n          <button\n            onClick={openCreate}\n            className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 text-xs font-semibold shrink-0\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            \n          </button>\n        </div>\n  \n        {err && (\n          <div className=\"mt-3 text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2 flex items-start gap-2\">\n            <AlertTriangle className=\"w-4 h-4 mt-0.5\" />\n            <div className=\"min-w-0\">{err}</div>\n          </div>\n        )}\n      </div>\n  \n      {/* Preview */}\n        <div className=\"space-y-4\">\n          {/*  */}\n          <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xs font-medium text-gray-500\"></span>\n                <span className=\"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-600\">\n                  \n                </span>\n              </div>\n\n              <span className=\"text-xs text-gray-500\">\n                {currentPhase ? toShortRange(currentPhase.start_date, currentPhase.end_date) : ''}\n              </span>\n            </div>\n\n            {/* Body */}\n            {currentPhase ? (\n              <>\n                <div className=\"mt-2 flex items-end justify-between gap-3\">\n                  <div className=\"min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <h3 className=\"text-xl font-semibold text-gray-900 truncate\">\n                        {PHASE_LABEL[currentPhase.phase_type]}\n                      </h3>\n                      <span className={`text-xs px-2 py-0.5 rounded-full border ${PHASE_BADGE[currentPhase.phase_type]}`}>\n                        {currentPhase.phase_type}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Tags6 +n */}\n                {Array.isArray(currentPhase.focus_tags) && currentPhase.focus_tags.length > 0 && (\n                  <div className=\"mt-3 flex flex-wrap gap-2\">\n                    {currentPhase.focus_tags.slice(0, 6).map((tag, i) => (\n                      <span\n                        key={`${tag}-${i}`}\n                        className=\"text-xs px-2 py-1 rounded-full bg-blue-50 text-blue-700\"\n                      >\n                        {tag}\n                      </span>\n                    ))}\n                    {currentPhase.focus_tags.length > 6 && (\n                      <span className=\"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700\">\n                        +{currentPhase.focus_tags.length - 6}\n                      </span>\n                    )}\n                  </div>\n                )}\n\n                {/* Note2 */}\n                <p className=\"mt-3 text-sm text-gray-700 line-clamp-2\">\n                  {getPhaseAdvice(\n                    currentPhase?.phase_type ?? 'unknown',\n                    currentPhase?.focus_tags ?? [],\n                    currentPhase?.note ?? null,\n                    { preferNote: true, appendTagHintsWhenNote: false, maxNoteChars: 80 }\n                  )}\n                </p>\n              </>\n            ) : (\n              <div className=\"mt-3 text-sm text-gray-600\">\n                 \n              </div>\n            )}\n          </div>\n\n          {/* 3 */}\n          <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div>\n                <div className=\"text-sm font-semibold text-gray-900\">3</div>\n                <div className=\"text-xs text-gray-500\"></div>\n              </div>\n              <div className=\"text-[11px] text-gray-400\">\n                {today}{addDays(today, 21)}\n              </div>\n            </div>\n\n            {next3Weeks.length === 0 ? (\n              <div className=\"text-sm text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-3\">\n                \n              </div>\n            ) : (\n              <div className=\"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1\">\n                {next3Weeks.slice(0, 6).map((p, idx) => {\n                  const isSameAsToday =\n                    currentPhase &&\n                    p.phase_type === currentPhase.phase_type &&\n                    p.start_date === currentPhase.start_date &&\n                    p.end_date === currentPhase.end_date;\n\n                  return (\n                    <div\n                      key={`${p.id}-${idx}`}\n                      className={`min-w-[170px] rounded-lg border p-3 ${\n                        isSameAsToday\n                          ? 'border-blue-200 bg-blue-50/60'\n                          : 'border-gray-200 bg-white'\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"text-sm font-semibold text-gray-900 truncate\">\n                          {PHASE_LABEL[p.phase_type]}\n                        </div>\n                        <div className=\"text-[11px] text-gray-500 whitespace-nowrap\">\n                          {toShortRange(p.start_date, p.end_date)}\n                        </div>\n                      </div>\n\n\n\n                      {Array.isArray(p.focus_tags) && p.focus_tags.length > 0 && (\n                        <div className=\"mt-2 flex flex-wrap gap-1.5\">\n                          {p.focus_tags.slice(0, 3).map((t, i) => (\n                            <span\n                              key={`${p.id}-${t}-${i}`}\n                              className=\"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700\"\n                            >\n                              {t}\n                            </span>\n                          ))}\n                          {p.focus_tags.length > 3 && (\n                            <span className=\"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700\">\n                              +{p.focus_tags.length - 3}\n                            </span>\n                          )}\n                        </div>\n                      )}\n\n                      <div className=\"mt-2 text-xs text-gray-600 line-clamp-1\">\n                        {getPhaseAdvice(\n                          p.phase_type ?? 'unknown',\n                          p.focus_tags ?? [],\n                          p.note ?? null,\n                          { preferNote: true, appendTagHintsWhenNote: false, maxNoteChars: 50 }\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n        </div>\n      {/*   */}\n      <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n        <div className=\"px-4 py-3 bg-gray-50 flex items-center justify-between\">\n          <div className=\"text-sm font-semibold text-gray-900\"></div>\n          <button\n            onClick={fetchPhases}\n            className=\"text-xs font-semibold px-3 py-1.5 rounded-lg border bg-white hover:bg-gray-50\"\n            disabled={loading}\n          >\n            {loading ? '' : ''}\n          </button>\n        </div>\n  \n        {loading ? (\n          <div className=\"py-10 flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n          </div>\n        ) : sortedPhases.length === 0 ? (\n          <div className=\"py-10 text-center text-sm text-gray-600\">\n            \n          </div>\n        ) : (\n          <div className=\"divide-y\">\n            {sortedPhases.map((p) => (\n              <div key={p.id} className=\"p-4\">\n                <div className=\"flex items-start justify-between gap-3\">\n                  <div className=\"min-w-0\">\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <span\n                        className={`inline-flex items-center px-2.5 py-1 rounded-full border text-xs font-semibold ${PHASE_BADGE[p.phase_type]}`}\n                      >\n                        {PHASE_LABEL[p.phase_type]}\n                      </span>\n                      <span className=\"text-xs text-gray-500\">\n                        {p.start_date}{p.end_date}\n                      </span>\n                    </div>\n  \n                    {!!(p.focus_tags?.length) && (\n                      <div className=\"mt-2 flex flex-wrap gap-2\">\n                        {p.focus_tags.slice(0, 4).map((t) => (\n                          <span key={t} className=\"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700\">\n                            {t}\n                          </span>\n                        ))}\n                        {p.focus_tags.length > 4 && (\n                          <span className=\"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700\">\n                            +{p.focus_tags.length - 4}\n                          </span>\n                        )}\n                      </div>\n                    )}\n  \n                    {p.note && <div className=\"mt-2 text-xs text-gray-600 line-clamp-2\">{p.note}</div>}\n                  </div>\n  \n                  <div className=\"shrink-0 flex items-center gap-2\">\n                    <button\n                      onClick={() => openEdit(p)}\n                      className=\"p-2 rounded-lg border bg-white hover:bg-gray-50\"\n                      title=\"\"\n                    >\n                      <Pencil className=\"w-4 h-4 text-gray-700\" />\n                    </button>\n  \n                    <button\n                      onClick={() => onDelete(p)}\n                      className=\"p-2 rounded-lg border bg-white hover:bg-red-50\"\n                      title=\"\"\n                      disabled={saving}\n                    >\n                      <Trash2 className=\"w-4 h-4 text-red-600\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n\n      {/*  Modal */}\n      {modalOpen && (\n        <div className=\"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4\" onClick={closeModal}>\n          <div\n            className=\"bg-white w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden\"\n            onClick={(e) => e.stopPropagation()}\n          >\n     \n            <div className=\"px-5 py-4 border-b flex items-start justify-between gap-3\">\n              <div className=\"min-w-0\">\n                <div className=\"text-sm text-gray-500\"></div>\n                <div className=\"text-lg font-bold text-gray-900 truncate\">\n                  {mode === 'create' ? '' : ''}\n                </div>\n              </div>\n              <button className=\"p-2 rounded-lg hover:bg-gray-100\" onClick={closeModal} aria-label=\"close\">\n                <X className=\"w-5 h-5 text-gray-600\" />\n              </button>\n            </div>\n\n            <div className=\"p-5 space-y-4\">\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                <label className=\"block\">\n                  <div className=\"text-xs text-gray-600 mb-1\"></div>\n                  <input\n                    type=\"date\"\n                    value={startDate}\n                    onChange={(e) => setStartDate(e.target.value)}\n                    className=\"w-full px-3 py-2 rounded-lg border border-gray-300\"\n                  />\n                </label>\n\n                <label className=\"block\">\n                  <div className=\"text-xs text-gray-600 mb-1\"></div>\n                  <input\n                    type=\"date\"\n                    value={endDate}\n                    onChange={(e) => setEndDate(e.target.value)}\n                    className=\"w-full px-3 py-2 rounded-lg border border-gray-300\"\n                  />\n                </label>\n              </div>\n\n              <label className=\"block\">\n                <div className=\"text-xs text-gray-600 mb-1\"></div>\n                <select\n                  value={phaseType}\n                  onChange={(e) => setPhaseType(e.target.value as PhaseType)}\n                  className=\"w-full px-3 py-2 rounded-lg border border-gray-300\"\n                >\n                  <option value=\"off\"></option>\n                  <option value=\"pre\"></option>\n                  <option value=\"in\"></option>\n                  <option value=\"peak\"></option>\n                  <option value=\"transition\"></option>\n                  <option value=\"unknown\"></option>\n                </select>\n              </label>\n\n              <label className=\"block\">\n                <div className=\"text-xs text-gray-600 mb-1\">/</div>\n                <input\n                  type=\"text\"\n                  value={tagsText}\n                  onChange={(e) => setTagsText(e.target.value)}\n                  className=\"w-full px-3 py-2 rounded-lg border border-gray-300\"\n                  placeholder=\"  \"\n                />\n                <div className=\"mt-2 flex flex-wrap gap-2\">\n                  {normalizeTags(tagsText).map((t) => (\n                    <span key={t} className=\"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700\">\n                      {t}\n                    </span>\n                  ))}\n                </div>\n              </label>\n\n              <label className=\"block\">\n                <div className=\"text-xs text-gray-600 mb-1\"></div>\n                <textarea\n                  value={note}\n                  onChange={(e) => setNote(e.target.value)}\n                  className=\"w-full px-3 py-2 rounded-lg border border-gray-300 min-h-[90px]\"\n                  placeholder=\"\"\n                />\n              </label>\n\n              <div className=\"flex items-center justify-end gap-2 pt-2\">\n                <button\n                  onClick={closeModal}\n                  className=\"px-4 py-2 rounded-lg border bg-white hover:bg-gray-50 text-sm font-semibold\"\n                  disabled={saving}\n                >\n                  \n                </button>\n\n                <button\n                  onClick={onSave}\n                  className=\"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-sm font-semibold disabled:opacity-50\"\n                  disabled={saving}\n                >\n                  <Save className=\"w-4 h-4\" />\n                  {saving ? '' : ''}\n                </button>\n              </div>\n\n              <div className=\"text-[11px] text-gray-500\">\n                 DBEXCLUDE\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default TeamSeasonPhaseSettings;","// src/components/StaffView.tsx\nimport React, { useEffect, useMemo, useRef, useState, Suspense, lazy } from 'react';\nimport { User, Team, supabase } from '../lib/supabase';\nimport { Alert } from '../lib/alerts';\n\nimport { AthleteList } from './AthleteList';\nimport { AthleteDetailModal } from './AthleteDetailModal';\nimport { TeamACWRChart } from './TeamACWRChart';\nimport { AlertPanel } from './AlertPanel';\nimport { TutorialController } from './TutorialController';\nimport { ChartErrorBoundary } from './ChartErrorBoundary';\n\nimport { useTeamACWR } from '../hooks/useTeamACWR';\nimport { useTutorialContext } from '../contexts/TutorialContext';\nimport { getTutorialSteps } from '../lib/tutorialContent';\nimport { useOrganizations } from '../hooks/useOrganizations';\nimport { calcRiskForAthlete, sortAthletesByRisk, AthleteRisk } from '../lib/riskUtils';\n\nimport { useWeeklyGrowthCycle } from '../hooks/useWeeklyGrowthCycle';\nimport { WeeklyGrowthCycleView } from './WeeklyGrowthCycleView';\nimport { useDailyGrowthMatrix } from '../hooks/useDailyGrowthMatrix';\nimport CoachAthletePerformanceModal from './CoachAthletePerformanceModal';\nimport type { CoachRankingsViewProps } from './CoachRankingsView';\nimport { Calendar } from 'lucide-react';\nimport TeamSeasonPhaseSettings from './TeamSeasonPhaseSettings';\n\n\nimport {\n  Users,\n  BarChart3,\n  TrendingUp,\n  AlertTriangle,\n  Activity,\n  HelpCircle,\n  FileText,\n  Lock,\n  Trophy, \n} from 'lucide-react';\n\nconst TeamExportPanel = lazy(() =>\n  import('./TeamExportPanel').then((m) => ({ default: m.TeamExportPanel }))\n);\nconst ReportView = lazy(() =>\n  import('./ReportView').then((m) => ({ default: m.ReportView }))\n);\n\n\nconst CoachRankingsViewLazy =\n  lazy(async () => {\n    const m = await import('./CoachRankingsView');\n    return { default: m.default }; // default export \n  }) as React.LazyExoticComponent<React.ComponentType<CoachRankingsViewProps>>;\n\n/**\n *  \n * GrowthUnderstandingQuadrantSummary / GrowthUnderstandingMatrix \n * default exportnamed export #306 \n */\nconst GrowthUnderstandingQuadrantSummaryLazy = lazy(async () => {\n  const m: any = await import('./GrowthUnderstandingQuadrantSummary');\n  return { default: m.GrowthUnderstandingQuadrantSummary ?? m.default };\n});\nconst GrowthUnderstandingMatrixLazy = lazy(async () => {\n  const m: any = await import('./GrowthUnderstandingMatrix');\n  return { default: m.GrowthUnderstandingMatrix ?? m.default };\n});\n\ninterface StaffViewProps {\n  user: User;\n  alerts: Alert[];\n  onNavigateToPrivacy?: () => void;\n  onNavigateToTerms?: () => void;\n  onNavigateToCommercial?: () => void;\n  onNavigateToHelp?: () => void;\n}\n\n//  activity view \ntype StaffAthleteWithActivity = User & {\n  training_days_28d: number | null;\n  training_sessions_28d: number | null;\n  last_training_date: string | null;\n};\n\ntype CoachWeekAthleteCard = {\n  team_id: string;\n  athlete_user_id: string;\n  athlete_name: string;\n\n  week_duration_min: number;\n  week_rpe_avg: number | null;\n  week_load_sum: number;\n\n  sleep_hours_avg: number | null;\n  sleep_quality_avg: number | null;\n\n  motivation_avg: number | null;\n  energy_avg: number | null;\n  stress_avg: number | null;\n\n  wellness_shared: boolean;\n\n  action_total: number;\n  action_done: number;\n  action_done_rate: number;\n\n  is_sharing_active: boolean;\n  allow_condition: boolean;\n  allow_training: boolean;\n  allow_body: boolean;\n  allow_reflection: boolean;\n  allow_free_note: boolean;\n};\n\ntype TeamCauseTagRow = {\n  team_id: string;\n  tag: string;\n  cnt: number;\n};\n\nconst NO_DATA_DAYS_THRESHOLD = 14;\n\nconst toISODate = (d: Date) => d.toISOString().slice(0, 10);\n\n//  JST \"YYYY-MM-DD\" \nconst getJSTDateKey = (d: Date) => {\n  return new Intl.DateTimeFormat('en-CA', {\n    timeZone: 'Asia/Tokyo',\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n  }).format(d); // \"YYYY-MM-DD\"\n};\n\nconst getThisWeekRange = () => {\n  const now = new Date();\n  const day = now.getDay(); // 0 Sun ... 6 Sat\n  const diffToMon = (day + 6) % 7; // Mon=0\n\n  const mon = new Date(now);\n  mon.setDate(now.getDate() - diffToMon);\n  mon.setHours(0, 0, 0, 0);\n\n  const sun = new Date(mon);\n  sun.setDate(mon.getDate() + 6);\n\n  return { start: toISODate(mon), end: toISODate(sun) };\n};\n\n// -------------------------\n// ACWR helpers\n// -------------------------\nconst round2 = (n: number) => Math.round(n * 100) / 100;\n\ntype RiskLevel = 'high' | 'caution' | 'good' | 'low';\n\nconst calcRisk = (acwr: number): RiskLevel => {\n  if (acwr >= 1.5) return 'high';\n  if (acwr >= 1.3) return 'caution';\n  if (acwr >= 0.8) return 'good';\n  return 'low';\n};\n\ntype SummaryTone = 'danger' | 'warn' | 'ok' | 'unknown';\n\nconst getSummaryTone = (avg: number | null, valid: number, roster: number): SummaryTone => {\n  const minValid = Math.min(5, Math.max(1, Math.floor(roster * 0.2)));\n  if (avg == null || valid < minValid) return 'unknown';\n  if (avg >= 1.5) return 'danger';\n  if (avg >= 1.3) return 'warn';\n  return 'ok';\n};\n\nconst getSummaryLabel = (tone: SummaryTone) => {\n  if (tone === 'danger') return 'High';\n  if (tone === 'warn') return 'Caution';\n  if (tone === 'ok') return 'Good';\n  return 'Unknown';\n};\n\nconst getSummaryMessage = (tone: SummaryTone, valid: number, roster: number) => {\n  if (tone === 'unknown') return `${valid}/${roster}`;\n  if (tone === 'danger') return 'RPE';\n  if (tone === 'warn') return '';\n  return 'OK';\n};\n\nconst toneStyles: Record<SummaryTone, { box: string; badge: string; dot: string }> = {\n  danger: {\n    box: 'border-red-200 bg-red-50',\n    badge: 'bg-red-100 text-red-700 border-red-200',\n    dot: 'bg-red-500',\n  },\n  warn: {\n    box: 'border-amber-200 bg-amber-50',\n    badge: 'bg-amber-100 text-amber-700 border-amber-200',\n    dot: 'bg-amber-500',\n  },\n  ok: {\n    box: 'border-emerald-200 bg-emerald-50',\n    badge: 'bg-emerald-100 text-emerald-700 border-emerald-200',\n    dot: 'bg-emerald-500',\n  },\n  unknown: {\n    box: 'border-gray-200 bg-gray-50',\n    badge: 'bg-gray-100 text-gray-700 border-gray-200',\n    dot: 'bg-gray-400',\n  },\n};\n\ntype AthleteACWRInfo = {\n  currentACWR: number | null;\n  riskLevel?: RiskLevel;\n  daysOfData?: number | null;\n};\n\ntype AthleteACWRDailyRow = {\n  user_id: string;\n  date: string;\n  acwr: number | null;\n  days_of_data?: number | null;\n  risk_level?: RiskLevel | null;\n};\n\nconst chunk = <T,>(arr: T[], size: number) => {\n  const res: T[][] = [];\n  for (let i = 0; i < arr.length; i += size) res.push(arr.slice(i, i + size));\n  return res;\n};\n\nexport function StaffView({\n  user,\n  alerts,\n  onNavigateToPrivacy,\n  onNavigateToTerms,\n  onNavigateToCommercial,\n  onNavigateToHelp,\n}: StaffViewProps) {\n  // =========================\n  // State\n  // =========================\n  const [teams, setTeams] = useState<Team[]>([]);\n  const [selectedTeam, setSelectedTeam] = useState<Team | null>(null);\n\n  const [athletes, setAthletes] = useState<StaffAthleteWithActivity[]>([]);\n  const [athletesLoading, setAthletesLoading] = useState(false);\n  const [athletesError, setAthletesError] = useState<string | null>(null);\n\n  const [loading, setLoading] = useState(true);\n\n  const [athleteACWRMap, setAthleteACWRMap] = useState<Record<string, AthleteACWRInfo>>({});\n  const [acwrLoading, setAcwrLoading] = useState(false);\n\n  const [weekRange, setWeekRange] = useState(() => getThisWeekRange());\n  const [weekCards, setWeekCards] = useState<CoachWeekAthleteCard[]>([]);\n  const [weekLoading, setWeekLoading] = useState(false);\n\n  const [teamCauseTags, setTeamCauseTags] = useState<TeamCauseTagRow[]>([]);\n\n  const [cycleBaseDate, setCycleBaseDate] = useState<string>(() => getJSTDateKey(new Date()));\n\n  const [selectedAthlete, setSelectedAthlete] = useState<User | null>(null);\n\n  const [activeTab, setActiveTab] = useState<'athletes' | 'team-average' | 'rankings' | 'reports'|'settings'>('athletes');\n\n    // =========================\n  // Rankings -> Performance Modal\n  // =========================\n  type MetricKey = 'primary_value' | 'relative_1rm';\n\n  const [perfModal, setPerfModal] = useState<{\n    open: boolean;\n    athleteUserId: string;\n    athleteName: string;\n    testTypeId: string;\n    metricKey: MetricKey;\n  }>({\n    open: false,\n    athleteUserId: '',\n    athleteName: '',\n    testTypeId: '',\n    metricKey: 'primary_value',\n  });\n\n  const [showAlertPanel, setShowAlertPanel] = useState(false);\n  const [showExportPanel, setShowExportPanel] = useState(false);\n\n  const [showAvgRPE, setShowAvgRPE] = useState(true);\n  const [showAvgLoad, setShowAvgLoad] = useState(false);\n\n  // ===== ACWR request guard=====\n  const selectedTeamIdRef = useRef<string | null>(null);\n  const acwrRequestSeqRef = useRef(0);\n  const athletesIdsKeyRef = useRef<string>('');\n\n  useEffect(() => {\n    selectedTeamIdRef.current = selectedTeam?.id ?? null;\n  }, [selectedTeam?.id]);\n\n  useEffect(() => {\n    athletesIdsKeyRef.current = athletes.map((a) => a.id).slice().sort().join(',');\n  }, [athletes]);\n\n  const todayKey = getJSTDateKey(new Date());\n  const [noDataDismissedToday, setNoDataDismissedToday] = useState<boolean>(() => {\n    if (typeof window === 'undefined') return false;\n    try {\n      const key = `noDataDismissed-${user.id}-${todayKey}`;\n      return localStorage.getItem(key) === '1';\n    } catch {\n      return false;\n    }\n  });\n\n  // =========================\n  // Tutorial / Org\n  // =========================\n  const {\n    isActive,\n    shouldShowTutorial,\n    startTutorial,\n    completeTutorial,\n    skipTutorial,\n    currentStepIndex,\n    setCurrentStepIndex,\n  } = useTutorialContext();\n\n  const orgHook = useOrganizations(user.id);\n  const organizations = Array.isArray(orgHook?.organizations) ? orgHook.organizations : [];\n  const safeOrganizations = Array.isArray(organizations) ? organizations : [];\n\n  const currentOrganizationId =\n    selectedTeam?.organization_id || (safeOrganizations.length > 0 ? safeOrganizations[0].id : '');\n\n  useEffect(() => {\n    if (shouldShowTutorial() && !loading) startTutorial();\n  }, [shouldShowTutorial, startTutorial, loading]);\n\n  // =========================\n  // Team ACWR\n  // =========================\n  const teamACWRHook = useTeamACWR(selectedTeam?.id || null) as any;\n  const teamACWRLoading = !!teamACWRHook.loading;\n  const teamACWRData = teamACWRHook.teamACWRData ?? teamACWRHook.data ?? [];\n  const safeTeamACWRData = Array.isArray(teamACWRData) ? teamACWRData : [];\n\n// =========================\n// Derived: safe arrays\n// =========================\nconst safeAthletes = Array.isArray(athletes) ? athletes : [];\nconst safeAlerts = Array.isArray(alerts) ? alerts : [];\nconst safeWeekCards = Array.isArray(weekCards) ? weekCards : [];\n\n//  \nconst teamAlerts = useMemo(() => {\n  const tid = selectedTeam?.id;\n  if (!tid) return safeAlerts;\n\n  return safeAlerts.filter((al: any) => {\n    if (al?.team_id == null) return true;\n    return al.team_id === tid;\n  });\n}, [safeAlerts, selectedTeam?.id]);\n\nconst highPriorityTeamAlerts = useMemo(() => {\n  return teamAlerts.filter((al: any) => al?.priority === 'high');\n}, [teamAlerts]);\n//  \n\n//  ids  new Array  useMemo fetch\nconst teamAthleteIds = useMemo(() => safeAthletes.map((a) => a.id), [safeAthletes]);\n\n//   athletes  useMemo fetch\nconst matrixAthletes = useMemo(\n  () =>\n    safeAthletes.map((a: any) => ({\n      id: a.id,\n      name: a.name,\n      nickname: a.nickname,\n      email: a.email,\n    })),\n  [safeAthletes]\n);\n\n//  hook  points/teamAvg \nconst {\n  points: matrixPoints,\n  teamAvg: matrixTeamAvg,\n  loading: matrixLoading,\n  error: matrixError,\n} = useDailyGrowthMatrix({\n  date: todayKey,\n  athletes: matrixAthletes,\n});\n\n//  4weekRange + teamAthleteIds  training_records  DataPoint[] \ntype QuadrantDataPoint = {\n  arrow_score?: number | null;\n  signal_score?: number | null;\n  load?: number | null; // sRPE\n};\n\nconst [weeklyQuadrantData, setWeeklyQuadrantData] = useState<QuadrantDataPoint[]>([]);\nconst [weeklyQuadrantLoading, setWeeklyQuadrantLoading] = useState(false);\nconst [weeklyQuadrantError, setWeeklyQuadrantError] = useState<string | null>(null);\nconst weeklyReqSeqRef = useRef(0);\n\n// deps \nconst teamAthleteIdsKey = useMemo(() => teamAthleteIds.slice().sort().join(','), [teamAthleteIds]);\n\nuseEffect(() => {\n  // team-average \n  if (activeTab !== 'team-average') return;\n\n  if (!selectedTeam?.id || !weekRange.start || !weekRange.end || teamAthleteIds.length === 0) {\n    setWeeklyQuadrantData([]);\n    setWeeklyQuadrantLoading(false);\n    setWeeklyQuadrantError(null);\n    return;\n  }\n\n  const reqSeq = ++weeklyReqSeqRef.current;\n  let cancelled = false;\n\n  (async () => {\n    try {\n      setWeeklyQuadrantLoading(true);\n      setWeeklyQuadrantError(null);\n\n      const rows: any[] = [];\n      for (const ids of chunk(teamAthleteIds, 50)) {\n        const { data, error } = await supabase\n          .from('training_records')\n          .select('user_id,date,rpe,duration_min,load,arrow_score,signal_score')\n          .in('user_id', ids)\n          .gte('date', weekRange.start)\n          .lte('date', weekRange.end);\n\n        if (error) throw error;\n        rows.push(...(data ?? []));\n      }\n\n      if (cancelled) return;\n      if (reqSeq !== weeklyReqSeqRef.current) return;\n\n      const pts: QuadrantDataPoint[] = rows.map((r) => {\n        const arrow =\n          typeof r.arrow_score === 'number' && Number.isFinite(r.arrow_score)\n            ? r.arrow_score\n            : null;\n      \n        const signal =\n          typeof r.signal_score === 'number' && Number.isFinite(r.signal_score)\n            ? r.signal_score\n            : null;\n      \n        const load =\n          typeof r.load === 'number' && Number.isFinite(r.load)\n            ? r.load\n            : (Number(r.rpe) || 0) * (Number(r.duration_min) || 0);\n      \n        return {\n          arrow_score: arrow,\n          signal_score: signal,\n          load: Number.isFinite(load) ? load : 0,\n        };\n      });\n\n      setWeeklyQuadrantData(pts);\n    } catch (e: any) {\n      console.error('[weeklyQuadrant] error', e);\n      setWeeklyQuadrantError(e?.message ?? '');\n      setWeeklyQuadrantData([]);\n    } finally {\n      if (!cancelled) setWeeklyQuadrantLoading(false);\n    }\n  })();\n\n  return () => {\n    cancelled = true;\n  };\n  //  idsKey ids\n}, [activeTab, selectedTeam?.id, weekRange.start, weekRange.end, teamAthleteIdsKey]);\n  // =========================\n  //  7\n  // =========================\n  const {\n    weekRange: cycleWeekRange,\n    teamDaily,\n    loading: cycleLoading,\n    error: cycleError,\n  } = useWeeklyGrowthCycle({\n    baseDate: cycleBaseDate,\n    athleteIds: teamAthleteIds,\n  });\n\n  // =========================\n  // Effects\n  // =========================\n  useEffect(() => {\n    fetchStaffTeams();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user.id]);\n\n  useEffect(() => {\n    if (!selectedTeam?.id) return;\n\n    setAthletes([]);\n    setWeekCards([]);\n    setTeamCauseTags([]);\n    setAthleteACWRMap({});\n    setAcwrLoading(false);\n\n    fetchTeamAthletesWithActivity(selectedTeam.id);\n    fetchWeekSummary(selectedTeam.id, weekRange.start, weekRange.end);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedTeam?.id, weekRange.start, weekRange.end]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const key = `noDataDismissed-${user.id}-${todayKey}`;\n    setNoDataDismissedToday(localStorage.getItem(key) === '1');\n  }, [user.id, todayKey]);\n\n  // =========================\n  // Fetchers\n  // =========================\n  const fetchStaffTeams = async () => {\n    try {\n      setLoading(true);\n\n      const { data: staffTeamLinks, error } = await supabase\n        .from('staff_team_links')\n        .select(\n          `\n            team_id,\n            teams (\n              id,\n              name,\n              created_at,\n              organization_id\n            )\n          `\n        )\n        .eq('staff_user_id', user.id);\n\n      if (error) throw error;\n\n      const teamsData = (staffTeamLinks || [])\n        .map((link: any) => link.teams)\n        .filter(Boolean) as Team[];\n\n      setTeams(teamsData || []);\n\n      if (teamsData && teamsData.length > 0) setSelectedTeam(teamsData[0]);\n      else setSelectedTeam(null);\n    } catch (error) {\n      console.error('Error fetching staff teams:', error);\n      setTeams([]);\n      setSelectedTeam(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchTeamAthletesWithActivity = async (teamId: string) => {\n    try {\n      setAthletesLoading(true);\n      setAthletesError(null);\n\n      const currentTeamId = teamId;\n\n      const { data, error } = await supabase\n        .from('staff_team_athletes_with_activity' as any)\n        .select('*')\n        .eq('team_id', teamId);\n\n      if (error) throw error;\n\n      if (selectedTeamIdRef.current !== currentTeamId) return;\n\n      const rows = (data || []) as StaffAthleteWithActivity[];\n      setAthletes(rows);\n\n      const ids = rows.map((r) => r.id);\n      fetchAthleteACWRFromDaily(teamId, ids);\n    } catch (e) {\n      console.error(e);\n      setAthletesError('');\n    } finally {\n      setAthletesLoading(false);\n    }\n  };\n\n  const fetchWeekSummary = async (teamId: string, startDate: string, endDate: string) => {\n    try {\n      setWeekLoading(true);\n\n      const [weekRes, tagsRes] = await Promise.all([\n        supabase.rpc('get_coach_week_athlete_cards', {\n          p_team_id: teamId,\n          p_start_date: startDate,\n          p_end_date: endDate,\n        }),\n        supabase.rpc('get_coach_week_cause_tags', {\n          p_team_id: teamId,\n          p_start_date: startDate,\n          p_end_date: endDate,\n        }),\n      ]);\n\n      if (weekRes.error) throw weekRes.error;\n      if (tagsRes.error) throw tagsRes.error;\n\n      setWeekCards((weekRes.data || []) as CoachWeekAthleteCard[]);\n      setTeamCauseTags((tagsRes.data || []) as TeamCauseTagRow[]);\n    } catch (e) {\n      console.error('Failed to fetch week summary', e);\n      setWeekCards([]);\n      setTeamCauseTags([]);\n    } finally {\n      setWeekLoading(false);\n    }\n  };\n\n  const fetchAthleteACWRFromDaily = async (teamId: string, athleteIds: string[]) => {\n    if (!athleteIds || athleteIds.length === 0) {\n      if (selectedTeamIdRef.current === teamId) {\n        setAthleteACWRMap({});\n        setAcwrLoading(false);\n      }\n      return;\n    }\n\n    const reqSeq = ++acwrRequestSeqRef.current;\n    const reqIdsKey = athleteIds.slice().sort().join(',');\n\n    try {\n      setAcwrLoading(true);\n\n      const today = new Date();\n      const from = new Date(today);\n      from.setDate(from.getDate() - 90);\n\n      const fromKey = getJSTDateKey(from);\n      const toKey = getJSTDateKey(today);\n\n      const idChunks = chunk(athleteIds, 50);\n      const allRows: AthleteACWRDailyRow[] = [];\n\n      for (const ids of idChunks) {\n        const { data, error } = await supabase\n          .from('athlete_acwr_daily')\n          .select('user_id,date,acwr')\n          .in('user_id', ids)\n          .gte('date', fromKey)\n          .lte('date', toKey)\n          .order('date', { ascending: false });\n\n        if (error) throw error;\n        allRows.push(...((data || []) as AthleteACWRDailyRow[]));\n      }\n\n      if (selectedTeamIdRef.current !== teamId) return;\n      if (reqSeq !== acwrRequestSeqRef.current) return;\n\n      const currentIdsKey = athletesIdsKeyRef.current;\n      if (currentIdsKey !== reqIdsKey) return;\n\n      const newMap: Record<string, AthleteACWRInfo> = {};\n\n      for (const r of allRows) {\n        if (newMap[r.user_id]) continue;\n        const acwr = typeof r.acwr === 'number' && Number.isFinite(r.acwr) ? r.acwr : null;\n\n        newMap[r.user_id] = {\n          currentACWR: acwr != null ? round2(acwr) : null,\n          riskLevel: acwr != null ? calcRisk(acwr) : undefined,\n          daysOfData: 28,\n        };\n      }\n\n      for (const id of athleteIds) {\n        if (!newMap[id]) newMap[id] = { currentACWR: null, riskLevel: undefined, daysOfData: null };\n      }\n\n      setAthleteACWRMap(newMap);\n    } catch (e) {\n      console.error('[fetchAthleteACWRFromDaily] failed', e);\n      if (selectedTeamIdRef.current === teamId) setAthleteACWRMap({});\n    } finally {\n      if (selectedTeamIdRef.current === teamId) setAcwrLoading(false);\n    }\n  };\n\n  // =========================\n  // Alert handlers\n  // =========================\n  const markAsRead = async (alertId: string) => console.log('Mark as read:', alertId);\n  const dismissAlert = async (alertId: string) => console.log('Dismiss alert:', alertId);\n  const markAllAsRead = async () => console.log('Mark all as read');\n\n  // =========================\n  // Derived UI values\n  // =========================\n  const latestTeamACWR =\n    safeTeamACWRData.length > 0 ? safeTeamACWRData[safeTeamACWRData.length - 1] : null;\n\n  const noDataAthletes = useMemo(() => {\n    const now = new Date();\n    const msPerDay = 1000 * 60 * 60 * 24;\n\n    return safeAthletes\n      .filter((a) => a.last_training_date)\n      .map((a) => {\n        const last = new Date(a.last_training_date as string);\n        const days = Math.floor((now.getTime() - last.getTime()) / msPerDay);\n        return { athlete: a, daysSinceLast: days };\n      })\n      .filter((x) => x.daysSinceLast >= NO_DATA_DAYS_THRESHOLD)\n      .sort((a, b) => b.daysSinceLast - a.daysSinceLast);\n  }, [safeAthletes]);\n\n  const latestTeamAvg = latestTeamACWR?.averageACWR ?? null;\n  const latestValid = latestTeamACWR?.athleteCount ?? 0;\n  const roster = safeAthletes.length;\n\n  const summaryTone = getSummaryTone(\n    typeof latestTeamAvg === 'number' ? latestTeamAvg : null,\n    latestValid,\n    roster\n  );\n\n  const handleOpenAthleteDetailFromFocus = (it: { user_id: string }) => {\n    const target = safeAthletes.find((a) => a.id === it.user_id);\n    if (!target) {\n      window.alert('');\n      return;\n    }\n\n    const card = safeWeekCards.find((c) => c.athlete_user_id === target.id);\n    if (card && !card.is_sharing_active) {\n      window.alert('OFF');\n      return;\n    }\n\n    setSelectedAthlete(target);\n  };\n\n  type FocusItem = {\n    user_id: string;\n    name: string;\n    category: 'risk' | 'checkin' | 'praise';\n    reason: string;\n    meta?: string;\n  };\n\n  const focusItems = useMemo<FocusItem[]>(() => {\n    const items: FocusItem[] = [];\n\n    noDataAthletes.slice(0, 3).forEach(({ athlete, daysSinceLast }) => {\n      items.push({\n        user_id: athlete.id,\n        name: athlete.name || athlete.email || 'unknown',\n        category: 'risk',\n        reason: '',\n        meta: `${daysSinceLast}`,\n      });\n    });\n\n    if (!safeWeekCards || safeWeekCards.length === 0) return items.slice(0, 5);\n\n    safeWeekCards.forEach((c) => {\n      if (!c.is_sharing_active) return;\n      const acwr = athleteACWRMap?.[c.athlete_user_id]?.currentACWR;\n      if (typeof acwr === 'number' && acwr >= 1.5) {\n        items.push({\n          user_id: c.athlete_user_id,\n          name: c.athlete_name || 'unknown',\n          category: 'risk',\n          reason: 'ACWR',\n          meta: `ACWR ${acwr.toFixed(2)}`,\n        });\n      }\n    });\n\n    safeWeekCards.forEach((c) => {\n      if (!c.is_sharing_active) return;\n      if (c.sleep_hours_avg != null && c.sleep_hours_avg <= 5.5) {\n        items.push({\n          user_id: c.athlete_user_id,\n          name: c.athlete_name || 'unknown',\n          category: 'checkin',\n          reason: '',\n          meta: `${c.sleep_hours_avg.toFixed(1)}h`,\n        });\n      }\n    });\n\n    safeWeekCards.forEach((c) => {\n      if (c.action_total > 0 && (c.action_done_rate ?? 0) >= 90) {\n        items.push({\n          user_id: c.athlete_user_id,\n          name: c.athlete_name || 'unknown',\n          category: 'praise',\n          reason: '',\n          meta: `${Math.round(c.action_done_rate ?? 0)}%`,\n        });\n      }\n    });\n\n    const priority: Record<FocusItem['category'], number> = { risk: 3, checkin: 2, praise: 1 };\n\n    const map = new Map<string, FocusItem>();\n    for (const it of items) {\n      const prev = map.get(it.user_id);\n      if (!prev || priority[it.category] > priority[prev.category]) map.set(it.user_id, it);\n    }\n\n    const merged = Array.from(map.values());\n    merged.sort((a, b) => priority[b.category] - priority[a.category]);\n    return merged.slice(0, 5);\n  }, [noDataAthletes, safeWeekCards, athleteACWRMap]);\n\n  const handleDismissNoDataForToday = () => {\n    if (typeof window !== 'undefined') {\n      const key = `noDataDismissed-${user.id}-${todayKey}`;\n      localStorage.setItem(key, '1');\n    }\n    setNoDataDismissedToday(true);\n  };\n\n  const weekCardMap = useMemo(() => {\n    const map: Record<string, CoachWeekAthleteCard> = {};\n    for (const c of safeWeekCards) map[c.athlete_user_id] = c;\n    return map;\n  }, [safeWeekCards]);\n\n  const noDataMap = useMemo(() => {\n    const map: Record<string, { daysSinceLast: number }> = {};\n    for (const x of noDataAthletes) map[x.athlete.id] = { daysSinceLast: x.daysSinceLast };\n    return map;\n  }, [noDataAthletes]);\n\n  const athleteRiskMap = useMemo(() => {\n    const map: Record<string, AthleteRisk> = {};\n    for (const a of safeAthletes) {\n      map[a.id] = calcRiskForAthlete({\n        id: a.id,\n        name: a.name || a.email || 'unknown',\n        acwrInfo: athleteACWRMap?.[a.id] ?? null,\n        weekCard: weekCardMap?.[a.id] ?? null,\n        noData: noDataMap?.[a.id] ?? null,\n      });\n    }\n    return map;\n  }, [safeAthletes, athleteACWRMap, weekCardMap, noDataMap]);\n\n  const sortedAthletes = useMemo(() => {\n    return sortAthletesByRisk({\n      athletes: safeAthletes,\n      riskMap: athleteRiskMap,\n      weekCardMap,\n    });\n  }, [safeAthletes, athleteRiskMap, weekCardMap]);\n\n  useEffect(() => {\n    if (!sortedAthletes || sortedAthletes.length === 0) return;\n    const withRisk = sortedAthletes.filter((a) => athleteRiskMap?.[a.id]?.riskLevel).length;\n\n    if (withRisk >= Math.floor(sortedAthletes.length * 0.7)) {\n      console.log(\n        '[sortedAthletes]',\n        sortedAthletes.map((a) => ({\n          name: a.name,\n          risk: athleteRiskMap[a.id]?.riskLevel,\n          sharing: weekCardMap[a.id]?.is_sharing_active,\n          acwr: athleteACWRMap[a.id]?.currentACWR,\n          reasons: athleteRiskMap[a.id]?.reasons?.length ?? 0,\n        }))\n      );\n    } else {\n      console.log(`[sortedAthletes] risk not ready: ${withRisk}/${sortedAthletes.length}`);\n    }\n  }, [sortedAthletes, athleteRiskMap, weekCardMap, athleteACWRMap]);\n\n  const handleAthleteSelect = (athlete: User) => {\n    const card = safeWeekCards.find((c) => c.athlete_user_id === athlete.id);\n    if (!card?.is_sharing_active) {\n      window.alert('OFF');\n      return;\n    }\n    setSelectedAthlete(athlete);\n  };\n\n  // =========================\n  // Render\n  // =========================\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <header className=\"bg-white shadow-sm border-b sticky top-0 z-40\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between py-3\">\n            <h1 className=\"text-lg sm:text-xl font-bold text-gray-900\"></h1>\n\n            <div className=\"flex items-center space-x-1\">\n              {highPriorityTeamAlerts.length > 0 && (\n                <button\n                  onClick={() => setShowAlertPanel(true)}\n                  className=\"p-2 text-gray-600 hover:text-red-600 transition-colors relative\"\n                  title=\"\"\n                >\n                  <AlertTriangle className=\"w-5 h-5\" />\n                  <span className=\"absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center\">\n                    {highPriorityTeamAlerts.length}\n                  </span>\n                </button>\n              )}\n\n              <button\n                onClick={startTutorial}\n                className=\"p-2 text-gray-600 hover:text-green-600 transition-colors\"\n                title=\"\"\n              >\n                <HelpCircle className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {teams.length > 0 && (\n            <div className=\"pb-3 border-t border-gray-100\">\n              <div className=\"flex items-center gap-3 pt-3\">\n                <Users className=\"w-4 h-4 text-gray-400 flex-shrink-0\" />\n                <select\n                  value={selectedTeam?.id || ''}\n                  onChange={(e) => {\n                    const team = teams.find((t) => t.id === e.target.value);\n                    if (team) setSelectedTeam(team);\n                  }}\n                  className=\"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500\"\n                >\n                  {teams.map((team) => (\n                    <option key={team.id} value={team.id}>\n                      {team.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          )}\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8\">\n        {teams.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <Users className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\"></h3>\n            <p className=\"text-gray-600\"></p>\n          </div>\n        ) : (\n          <div className=\"space-y-6 sm:space-y-8\">\n            {selectedTeam && (\n              <div className=\"space-y-4\">\n                {!teamACWRLoading && latestTeamACWR && (\n                  <div className={`rounded-xl border p-4 sm:p-5 ${toneStyles[summaryTone].box}`}>\n                    <div className=\"flex items-start justify-between gap-3\">\n                      <div className=\"min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <span\n                            className={`inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs font-semibold ${toneStyles[summaryTone].badge}`}\n                          >\n                            <span className={`w-2 h-2 rounded-full ${toneStyles[summaryTone].dot}`} />\n                            Today Summary\n                          </span>\n\n                          <span\n                            className={`inline-flex items-center px-3 py-1.5 rounded-full border text-sm font-bold ${toneStyles[summaryTone].badge}`}\n                          >\n                            {getSummaryLabel(summaryTone)}\n                          </span>\n                        </div>\n\n                        <div className=\"text-sm sm:text-base text-gray-900 font-semibold\">\n                          {getSummaryMessage(summaryTone, latestValid, roster)}\n                        </div>\n\n                        <div className=\"mt-2 text-xs sm:text-sm text-gray-700 flex flex-wrap gap-x-4 gap-y-1\">\n                          <span>\n                            ACWR<b>{latestTeamACWR.averageACWR}</b>\n                          </span>\n                          <span>\n                            <b>{latestValid}</b> / <b>{roster}</b>\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {!teamACWRLoading && !latestTeamACWR && (\n                  <div className=\"rounded-xl border border-gray-200 bg-gray-50 p-4 sm:p-5\">\n                    <div className=\"text-sm font-semibold text-gray-900 mb-1\">Today Summary</div>\n                    <div className=\"text-sm text-gray-700\">\n                      ACWR\n                      <br />\n                      RPE\n                    </div>\n                  </div>\n                )}\n\n                {focusItems.length > 0 && (\n                  <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"text-sm sm:text-base font-semibold text-gray-900\">\n                        5\n                      </div>\n                      <div className=\"text-xs text-gray-500\"></div>\n                    </div>\n\n                    <ul className=\"space-y-2\">\n                      {focusItems.map((it) => (\n                        <li key={it.user_id}>\n                          <button\n                            onClick={() => handleOpenAthleteDetailFromFocus({ user_id: it.user_id })}\n                            className=\"w-full text-left rounded-lg border border-gray-200 hover:bg-gray-50 px-3 py-2 flex items-start justify-between gap-3\"\n                          >\n                            <div className=\"min-w-0\">\n                              <div className=\"font-semibold text-gray-900 truncate\">{it.name}</div>\n                              <div className=\"text-xs text-gray-700\">\n                                {it.reason}\n                                {it.meta ? <span className=\"text-gray-500\">{it.meta}</span> : null}\n                              </div>\n                            </div>\n\n                            <span\n                              className={`shrink-0 text-[11px] px-2 py-1 rounded-full border ${\n                                it.category === 'risk'\n                                  ? 'bg-red-50 text-red-700 border-red-200'\n                                  : it.category === 'checkin'\n                                  ? 'bg-amber-50 text-amber-700 border-amber-200'\n                                  : 'bg-emerald-50 text-emerald-700 border-emerald-200'\n                              }`}\n                            >\n                              {it.category === 'risk' ? '' : it.category === 'checkin' ? '' : ''}\n                            </span>\n                          </button>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {noDataAthletes.length > 0 && !noDataDismissedToday && (\n              <div className=\"bg-white rounded-xl shadow-sm border border-amber-200 p-4 sm:p-5\">\n                <div className=\"flex items-start justify-between mb-3\">\n                  <div>\n                    <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 mb-1\">\n                      \n                    </h3>\n                    <p className=\"text-xs sm:text-sm text-gray-600\">\n                      \n                    </p>\n                  </div>\n                  <button\n                    onClick={handleDismissNoDataForToday}\n                    className=\"text-xs sm:text-sm text-blue-600 hover:text-blue-700 font-medium px-2 py-1 rounded-lg hover:bg-blue-50\"\n                  >\n                    \n                  </button>\n                </div>\n\n                <ul className=\"space-y-1 sm:space-y-1.5 text-sm sm:text-base\">\n                  {noDataAthletes.map(({ athlete, daysSinceLast }) => (\n                    <li\n                      key={athlete.id}\n                      className=\"flex items-baseline justify-between border-t border-gray-100 pt-1.5 first:border-t-0 first:pt-0\"\n                    >\n                      <div className=\"font-medium text-gray-900 truncate mr-2\">\n                        {athlete.name || athlete.email}\n                      </div>\n                      <div className=\"text-xs sm:text-sm text-gray-600 whitespace-nowrap\">\n                         {athlete.last_training_date || '-'}{daysSinceLast}\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n\n            {selectedTeam && (\n              <div className=\"bg-white rounded-xl shadow-sm p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n                  <h2 className=\"text-lg sm:text-xl font-semibold text-gray-900 truncate\">\n                    <span className=\"hidden sm:inline\">{selectedTeam.name} - </span>\n                    <span className=\"sm:hidden\"></span>\n                  </h2>\n                  <TrendingUp className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 ml-2\" />\n                </div>\n\n                {teamACWRLoading ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500\" />\n                  </div>\n                ) : !latestTeamACWR ? (\n                  <div className=\"py-6 text-center text-sm text-gray-500\">\n                    ACWR\n                    <br />\n                    RPE\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-1 sm:grid-cols-4 gap-4 sm:gap-6\">\n                    <div className=\"bg-purple-50 rounded-lg p-4 sm:p-6 text-center\">\n                      <div className=\"text-xl sm:text-2xl font-bold text-purple-600 mb-1\">\n                        {latestTeamACWR.averageACWR}\n                      </div>\n                      <div className=\"text-xs sm:text-sm text-purple-700\">ACWR</div>\n                    </div>\n\n                    <div className=\"bg-blue-50 rounded-lg p-4 sm:p-6 text-center\">\n                      <div className=\"text-xl sm:text-2xl font-bold text-blue-600 mb-1\">\n                        {latestTeamACWR.athleteCount}\n                      </div>\n                      <div className=\"text-xs sm:text-sm text-blue-700\"></div>\n                    </div>\n\n                    <div className=\"bg-gray-50 rounded-lg p-4 sm:p-6 text-center\">\n                      <div className=\"text-xl sm:text-2xl font-bold text-gray-600 mb-1\">\n                        {safeAthletes.length}\n                      </div>\n                      <div className=\"text-xs sm:text-sm text-gray-700\"></div>\n                    </div>\n\n                    <div className=\"bg-red-50 rounded-lg p-4 sm:p-6 text-center\">\n                      <div className=\"text-xl sm:text-2xl font-bold text-red-600 mb-1\">\n                        {teamAlerts.filter((al) => al.priority === 'high').length}\n                      </div>\n                      <div className=\"text-xs sm:text-sm text-red-700\"></div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {selectedTeam && (\n              <div className=\"bg-white rounded-xl shadow-sm\">\n                <div className=\"border-b border-gray-200\">\n                  <nav className=\"hidden sm:flex px-4 sm:px-6 overflow-x-auto\">\n                    <button\n                      onClick={() => setActiveTab('athletes')}\n                      className={`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm whitespace-nowrap ${\n                        activeTab === 'athletes'\n                          ? 'border-green-500 text-green-600'\n                          : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                      }`}\n                      data-tutorial=\"athletes-tab\"\n                    >\n                      <div className=\"flex items-center\">\n                        <Activity className=\"w-4 h-4 mr-2\" />\n                        \n                      </div>\n                    </button>\n\n                    <button\n                      onClick={() => setActiveTab('team-average')}\n                      className={`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap ${\n                        activeTab === 'team-average'\n                          ? 'border-green-500 text-green-600'\n                          : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                      }`}\n                      data-tutorial=\"team-average-tab\"\n                    >\n                      <div className=\"flex items-center\">\n                        <BarChart3 className=\"w-4 h-4 mr-2\" />\n                        ACWR\n                      </div>\n                    </button>\n\n                    <button\n                      onClick={() => setActiveTab('rankings')}\n                      className={`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap ${\n                        activeTab === 'rankings'\n                          ? 'border-green-500 text-green-600'\n                          : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className=\"flex items-center\">\n                        <Trophy className=\"w-4 h-4 mr-2\" />\n                        \n                      </div>\n                    </button>\n\n                    <button\n                      onClick={() => setActiveTab('reports')}\n                      className={`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap ${\n                        activeTab === 'reports'\n                          ? 'border-green-500 text-green-600'\n                          : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className=\"flex items-center\">\n                        <FileText className=\"w-4 h-4 mr-2\" />\n                        \n                      </div>\n                    </button>\n                    <button\n                      onClick={() => setActiveTab('settings')}\n                      className={`py-3 sm:py-4 px-3 border-b-2 font-medium text-sm ml-6 whitespace-nowrap ${\n                        activeTab === 'settings'\n                          ? 'border-green-500 text-green-600'\n                          : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className=\"flex items-center\">\n                        <Calendar className=\"w-4 h-4 mr-2\" />\n                        \n                      </div>\n                    </button>\n\n\n\n\n                  </nav>\n\n                  <div className=\"sm:hidden px-4 py-3\">\n                    <select\n                      value={activeTab}\n                      onChange={(e) => setActiveTab(e.target.value as typeof activeTab)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500\"\n                    >\n                      <option value=\"athletes\"></option>\n                      <option value=\"team-average\">ACWR</option>\n                      <option value=\"rankings\"></option>\n                      <option value=\"settings\"></option>\n                      <option value=\"reports\"></option>\n                    </select>\n                  </div>\n                </div>\n\n                <div className=\"p-4 sm:p-6\">\n                  {activeTab === 'athletes' && (\n                    <div>\n                      <div className=\"text-xs text-gray-600 mb-3 flex items-center gap-2\">\n                        <Lock className=\"w-4 h-4\" />\n                        OFF\n                        {acwrLoading && <span className=\"ml-2 text-xs text-gray-500\">ACWR</span>}\n                      </div>\n\n                      {athletesLoading ? (\n                        <div className=\"flex items-center justify-center py-12\">\n                          <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n                        </div>\n                      ) : athletesError ? (\n                        <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 text-sm text-red-700\">\n                          <div className=\"font-semibold mb-1\"></div>\n                          <div className=\"mb-3\">{athletesError}</div>\n                          <button\n                            className=\"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50\"\n                            onClick={() => selectedTeam?.id && fetchTeamAthletesWithActivity(selectedTeam.id)}\n                          >\n                            \n                          </button>\n                        </div>\n                      ) : safeAthletes.length === 0 ? (\n                        <div className=\"bg-white border rounded-xl p-6 text-center text-gray-600\">\n                          <div className=\"font-semibold text-gray-900 mb-1\"></div>\n                          <div className=\"text-sm\">\n                            team_id / view \n                          </div>\n                        </div>\n                      ) : (\n                        <AthleteList\n                          athletes={sortedAthletes}\n                          onAthleteSelect={handleAthleteSelect}\n                          athleteACWRMap={athleteACWRMap}\n                          weekCardMap={weekCardMap}\n                          athleteRiskMap={athleteRiskMap}\n                        />\n                      )}\n                    </div>\n                  )}\n\n                  {activeTab === 'team-average' && (\n                    <div className=\"space-y-4\">\n                      {teamACWRLoading ? (\n                        <div className=\"flex items-center justify-center py-12\">\n                          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n                        </div>\n                      ) : (\n                        <ChartErrorBoundary name=\"TeamACWRChart\">\n                          <TeamACWRChart\n                            data={safeTeamACWRData}\n                            teamName={selectedTeam?.name ?? ''}\n                            showAvgRPE={showAvgRPE}\n                            showAvgLoad={showAvgLoad}\n                          />\n                        </ChartErrorBoundary>\n                      )}\n\n                      {/*  7 */}\n                      <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n                        <div className=\"flex items-center justify-between gap-3\">\n                          <div className=\"min-w-0\">\n                            <div className=\"text-sm sm:text-base font-semibold text-gray-900\">\n                              7\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              \n                            </div>\n                          </div>\n\n                          <input\n                            type=\"date\"\n                            value={cycleBaseDate}\n                            onChange={(e) => setCycleBaseDate(e.target.value)}\n                            className=\"px-3 py-2 rounded-lg border border-gray-300\"\n                            title=\"\"\n                          />\n                        </div>\n\n                        <div className=\"mt-3\">\n                          {cycleLoading ? (\n                            <div className=\"flex items-center justify-center py-10\">\n                              <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n                            </div>\n                          ) : cycleError ? (\n                            <div className=\"text-sm text-red-600\">{cycleError}</div>\n                          ) : (\n                            <ChartErrorBoundary name=\"WeeklyGrowthCycleView\">\n                              <WeeklyGrowthCycleView\n                                teamDaily={teamDaily}\n                                weekLabel={`${cycleWeekRange.start}  ${cycleWeekRange.end}`}\n                              />\n                            </ChartErrorBoundary>\n                          )}\n                        </div>\n                      </div>\n\n                      {/*  4 */}\n                      <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n                        {weeklyQuadrantLoading ? (\n                          <div className=\"flex items-center justify-center py-10\">\n                            <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n                          </div>\n                        ) : weeklyQuadrantError ? (\n                          <div className=\"text-sm text-red-600\">{weeklyQuadrantError}</div>\n                        ) : (\n                          <Suspense\n                            fallback={\n                              <div className=\"flex items-center justify-center py-10\">\n                                <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n                              </div>\n                            }\n                          >\n                            <ChartErrorBoundary name=\"GrowthUnderstandingQuadrantSummary\">\n                              <GrowthUnderstandingQuadrantSummaryLazy data={weeklyQuadrantData} />\n                            </ChartErrorBoundary>\n                          </Suspense>\n                        )}\n                      </div>\n\n                      {/*   */}\n                      <div className=\"bg-white rounded-xl border border-gray-200 p-4 sm:p-5\">\n                        {matrixLoading ? (\n                          <div className=\"flex items-center justify-center py-10\">\n                            <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n                          </div>\n                        ) : matrixError ? (\n                          <div className=\"text-sm text-red-600\">{matrixError}</div>\n                        ) : (\n                          <Suspense\n                            fallback={\n                              <div className=\"flex items-center justify-center py-10\">\n                                <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\" />\n                              </div>\n                            }\n                          >\n                            <ChartErrorBoundary name=\"GrowthUnderstandingMatrix\">\n                              {/*  Lazy GrowthUnderstandingMatrix is not defined  */}\n                              <GrowthUnderstandingMatrixLazy points={matrixPoints} teamAvg={matrixTeamAvg} />\n                            </ChartErrorBoundary>\n                          </Suspense>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                  {activeTab === 'rankings' && (\n                    <Suspense\n                      fallback={\n                        <div className=\"flex items-center justify-center h-64\">\n                          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n                        </div>\n                      }\n                    >\n                      <ChartErrorBoundary name=\"CoachRankingsView\">\n                      <CoachRankingsViewLazy\n                       team={selectedTeam!}\n                        onOpenAthlete={(userId, testTypeId, metric, athleteName) => {\n                          setPerfModal({\n                            open: true,\n                            athleteUserId: userId,\n                            athleteName: athleteName || '',\n                            testTypeId,\n                            metricKey: metric,\n                          });\n                        }}\n                      />\n                      </ChartErrorBoundary>\n                    </Suspense>\n                  )}\n                  {activeTab === 'settings' && selectedTeam && (\n                    <div className='space-y-4'>\n                      <TeamSeasonPhaseSettings teamId={selectedTeam.id} teamName={selectedTeam.name}  />\n                    </div>\n                  )}\n\n                  {activeTab === 'reports' && (\n                    <Suspense\n                      fallback={\n                        <div className=\"flex items-center justify-center h-64\">\n                          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n                        </div>\n                      }\n                    >\n                      <ReportView team={selectedTeam!} />\n                    </Suspense>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </main>\n\n      {selectedAthlete && (\n        <AthleteDetailModal\n          athlete={selectedAthlete}\n          onClose={() => setSelectedAthlete(null)}\n          risk={athleteRiskMap[selectedAthlete.id]}\n          weekCard={weekCardMap[selectedAthlete.id]}\n        />\n      )}\n\n      {showAlertPanel && (\n        <AlertPanel\n          alerts={teamAlerts}\n          onMarkAsRead={markAsRead}\n          onDismiss={dismissAlert}\n          onMarkAllAsRead={markAllAsRead}\n          onClose={() => setShowAlertPanel(false)}\n          userRole={user.role}\n        />\n      )}\n\n      {showExportPanel && selectedTeam && (\n        <Suspense\n          fallback={\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-white\" />\n            </div>\n          }\n        >\n          <TeamExportPanel team={selectedTeam} onClose={() => setShowExportPanel(false)} />\n        </Suspense>\n      )}\n\n      <CoachAthletePerformanceModal\n        open={perfModal.open}\n        onClose={() => setPerfModal((p) => ({ ...p, open: false }))}\n        teamId={selectedTeam?.id ?? ''}\n        athleteUserId={perfModal.athleteUserId}\n        athleteName={perfModal.athleteName}\n        testTypeId={perfModal.testTypeId}\n        metricKey={perfModal.metricKey}\n      />\n\n\n\n      <TutorialController\n        steps={getTutorialSteps('staff')}\n        isActive={isActive}\n        onComplete={completeTutorial}\n        onSkip={skipTutorial}\n        currentStepIndex={currentStepIndex}\n        onStepChange={setCurrentStepIndex}\n      />\n    </div>\n  );\n}","import type { AppRole } from './roles';\n\nexport function isGlobalAdmin(role?: AppRole | null) {\n  return role === 'global_admin';\n}\n\nexport function isStaff(role?: AppRole | null) {\n  return role === 'staff';\n}\n\nexport function isStaffOrAdmin(role?: AppRole | null) {\n  return isStaff(role) || isGlobalAdmin(role);\n}\n\nexport function canViewAdminUI(role?: AppRole | null) {\n  return isStaffOrAdmin(role);\n}","import React, { useState, useEffect } from 'react';\nimport { Team, supabase } from '../lib/supabase';\nimport { UserPlus, Mail, CheckCircle, AlertCircle, Download, Info, Eye, EyeOff, Copy, Link as LinkIcon, Building2 } from 'lucide-react';\nimport { generateInvitationEmailHTML, generateInvitationEmailText } from '../lib/emailTemplates';\nimport { organizationQueries } from '../lib/organizationQueries';\nimport { getTodayJSTString } from '../lib/date';\n\n\ninterface UserInvitationProps {\n  teams: Team[];\n  onUserInvited: () => void;\n  restrictToOrganizationId?: string;\n  allowAdminInvite?: boolean;\n}\n\ninterface InvitedUser {\n  name: string;\n  email: string;\n  role: string;\n  teamName?: string;\n  organizationName?: string;\n  user_id?: string;\n  temporaryPassword?: string;\n  invitedAt: string;\n  emailSent: boolean;\n  inviteUrl?: string;\n  token?: string;\n}\n\ninterface Organization {\n  id: string;\n  name: string;\n  description?: string;\n}\n\nexport function UserInvitation({ teams:_teams, onUserInvited, restrictToOrganizationId, allowAdminInvite = true }: UserInvitationProps) {\n  const [organizations, setOrganizations] = useState<Organization[]>([]);\n  const [organizationTeams, setOrganizationTeams] = useState<Team[]>([]);\n  const [loadingOrgs, setLoadingOrgs] = useState(false);\n\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    role: 'athlete' as 'athlete' | 'staff' | 'global_admin',\n    organizationId: restrictToOrganizationId || '',\n    teamId: '',\n  });\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\n  const [invitedUsers, setInvitedUsers] = useState<InvitedUser[]>([]);\n  const [showPassword, setShowPassword] = useState<{ [key: number]: boolean }>({});\n  const [copiedIndex, setCopiedIndex] = useState<number | null>(null);\n\n  // Load organizations on mount\n  useEffect(() => {\n    const loadOrganizations = async () => {\n      try {\n        setLoadingOrgs(true);\n        const orgs = await organizationQueries.getOrganizations();\n        const mappedOrgs: Organization[] = (orgs || []).map((org: any) => ({\n          id: org.id,\n          name: org.name,\n          description: org.description ?? undefined,\n        }))\n        setOrganizations(mappedOrgs);\n\n        // If restricted to specific organization, auto-select it\n        if (restrictToOrganizationId) {\n          setFormData(prev => ({ ...prev, organizationId: restrictToOrganizationId }));\n        }\n      } catch (error) {\n        console.error('Failed to load organizations:', error);\n      } finally {\n        setLoadingOrgs(false);\n      }\n    };\n\n    loadOrganizations();\n  }, [restrictToOrganizationId]);\n\n  // Load teams when organization changes\n  useEffect(() => {\n    const loadTeamsForOrganization = async () => {\n      if (!formData.organizationId) {\n        setOrganizationTeams([]);\n        return;\n      }\n\n      try {\n        const teamsData = await organizationQueries.getOrganizationTeams(formData.organizationId);\n        setOrganizationTeams(teamsData);\n      } catch (error) {\n        console.error('Failed to load organization teams:', error);\n        setOrganizationTeams([]);\n      }\n    };\n\n    loadTeamsForOrganization();\n  }, [formData.organizationId]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setMessage(null);\n\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n\n      if (!session) {\n        throw new Error('');\n      }\n\n      const { data: currentUser } = await supabase\n        .from('users')\n        .select('name')\n        .eq('id', session.user.id)\n        .single();\n\n      const teamName = organizationTeams.find(t => t.id === formData.teamId)?.name;\n      const organizationName = organizations.find(o => o.id === formData.organizationId)?.name;\n\n\n      console.log(' Starting user creation process...');\n\n      // Step 1: Create user - let Edge Function generate password\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n      const payload = {\n        name: formData.name,\n        email: formData.email,\n        role: formData.role,\n        teamId: formData.role === 'athlete' || formData.role === 'staff' ? formData.teamId : undefined,\n        organizationId: formData.organizationId || undefined,\n        redirectUrl: `${window.location.origin}/reset-password`,\n      };\n\n      console.log(' Sending user creation request...');\n\n      const userResponse = await fetch(`${supabaseUrl}/functions/v1/create-user`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      });\n\n      const userResult = await userResponse.json();\n      \n\n      if (!userResponse.ok) {\n        throw new Error(userResult.error || '');\n      }\n\n      console.log(' User created successfully');\n\n      // Get password setup link from Edge Function\n      const passwordSetupLink = userResult.passwordSetupLink;\n\n      console.log(' Password setup link received');\n\n      if (!passwordSetupLink) {\n        throw new Error('Edge Function');\n      }\n\n      // Step 2: No need to save invitation token - password setup link is self-contained\n      console.log(' Skipping token storage - using Supabase native password reset flow');\n\n      // Step 3: Send email with password setup link\n      console.log(' Preparing to send invitation email...');\n\n      const inviteExpiredUrl = `${window.location.origin}/invite-expired`;\n\n      const emailHTML = generateInvitationEmailHTML({\n        name: formData.name,\n        email: formData.email,\n        role: formData.role,\n        teamName: teamName || organizationName,\n        passwordSetupLink: passwordSetupLink,\n        inviteExpiredUrl,\n        inviterName: currentUser?.name,\n        expiresInHours: 24,\n      });\n\n      const emailText = generateInvitationEmailText({\n        name: formData.name,\n        email: formData.email,\n        role: formData.role,\n        teamName: teamName || organizationName,\n        passwordSetupLink: passwordSetupLink,\n        inviteExpiredUrl,\n        inviterName: currentUser?.name,\n        expiresInHours: 24,\n      });\n\n      let emailSent = false;\n      let emailError = '';\n\n      try {\n        console.log(' Sending invitation email to:', formData.email);\n\n        const emailResponse = await fetch(`${supabaseUrl}/functions/v1/send-email`, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${session.access_token}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            to: formData.email,\n            subject: `Bekuta ${teamName || organizationName || 'Bekuta'}`,\n            html: emailHTML,\n            text: emailText,\n          }),\n        });\n\n        const emailResult = await emailResponse.json();\n        emailSent = emailResponse.ok;\n\n        if (!emailSent) {\n          emailError = emailResult.error || 'Unknown error';\n          console.error(' Email sending failed:', {\n            status: emailResponse.status,\n            error: emailError,\n            result: emailResult\n          });\n        } else {\n          console.log(' Email sent successfully to:', formData.email);\n        }\n      } catch (emailErr: any) {\n        emailError = emailErr.message || 'Network error';\n        console.error(' Email sending exception:', emailErr);\n      }\n\n      const newInvitedUser: InvitedUser = {\n        name: formData.name,\n        email: formData.email,\n        role: formData.role,\n        teamName,\n        organizationName,\n        user_id: userResult.user?.user_id,\n        invitedAt: new Date().toLocaleString('ja-JP'),\n        emailSent,\n        inviteUrl: passwordSetupLink,\n        \n      };\n\n      setInvitedUsers(prev => [newInvitedUser, ...prev]);\n\n      setMessage({\n        type: 'success',\n        text: emailSent\n          ? `${formData.name}${formData.email}`\n          : `${formData.name}${formData.email}URL`\n      });\n\n      setFormData({\n        name: '',\n        email: '',\n        role: 'athlete',\n        organizationId: '',\n        teamId: '',\n      });\n\n      onUserInvited();\n\n    } catch (error: any) {\n      console.error('User invitation error:', error);\n      setMessage({\n        type: 'error',\n        text: error.message || ''\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getRoleLabel = (role: string) => {\n    switch (role) {\n      case 'athlete': return '';\n      case 'staff': return '';\n      case 'global_admin': return '';\n      default: return role;\n    }\n  };\n\n  const copyPassword = async (password: string, index: number) => {\n    try {\n      await navigator.clipboard.writeText(password);\n      setCopiedIndex(index);\n      setTimeout(() => setCopiedIndex(null), 2000);\n    } catch (err) {\n      console.error('Failed to copy password:', err);\n    }\n  };\n\n  const copyInviteUrl = async (url: string, index: number) => {\n    try {\n      await navigator.clipboard.writeText(url);\n      setCopiedIndex(index + 1000);\n      setTimeout(() => setCopiedIndex(null), 2000);\n    } catch (err) {\n      console.error('Failed to copy URL:', err);\n    }\n  };\n\n  const downloadInvitedUsersCSV = () => {\n    if (invitedUsers.length === 0) return;\n\n    const headers = ['', '', '', '', '', 'ID', '', 'URL', '', ''];\n    const csvContent = [\n      headers.join(','),\n      ...invitedUsers.map(user => [\n        user.name,\n        user.email,\n        getRoleLabel(user.role),\n        user.organizationName || '-',\n        user.teamName || '-',\n        user.user_id || '',\n        user.temporaryPassword || '-',\n        user.inviteUrl || '-',\n        user.invitedAt,\n        user.emailSent ? '' : ''\n      ].join(','))\n    ].join('\\n');\n\n    const bom = '\\uFEFF';\n    const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });\n    const link = document.createElement('a');\n    const url = URL.createObjectURL(blob);\n    link.setAttribute('href', url);\n    link.setAttribute('download', `_${getTodayJSTString()}.csv`);\n    link.style.visibility = 'hidden';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-3\">\n          <UserPlus className=\"w-6 h-6 text-blue-600\" />\n          <h2 className=\"text-xl font-semibold text-gray-900\"></h2>\n        </div>\n        {invitedUsers.length > 0 && (\n          <button\n            onClick={downloadInvitedUsersCSV}\n            className=\"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm\"\n          >\n            <Download className=\"w-4 h-4\" />\n            <span></span>\n          </button>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        {/* Invitation Form */}\n        <div className=\"bg-white rounded-xl shadow-sm p-6\">\n          <div className=\"flex items-center mb-6\">\n            <Mail className=\"w-5 h-5 text-blue-600 mr-2\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\"></h3>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n              </label>\n              <input\n                type=\"text\"\n                value={formData.name}\n                onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n              </label>\n              <input\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"tanaka@example.com\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n              </label>\n              <select\n                value={formData.role}\n                onChange={(e) => {\n                  const newRole = e.target.value as 'athlete' | 'staff' | 'global_admin';\n                  setFormData(prev => ({\n                    ...prev,\n                    role: newRole,\n                    teamId: newRole === 'global_admin' ? '' : prev.teamId\n                  }));\n                }}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              >\n                <option value=\"athlete\"></option>\n                <option value=\"staff\"></option>\n                {allowAdminInvite && <option value=\"global_admin\"></option>}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2\">\n                <Building2 className=\"w-4 h-4 text-blue-600\" />\n                <span></span>\n              </label>\n              <select\n                value={formData.organizationId}\n                onChange={(e) => setFormData(prev => ({ ...prev, organizationId: e.target.value, teamId: '' }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n                disabled={loadingOrgs || !!restrictToOrganizationId}\n              >\n                <option value=\"\">\n                  {loadingOrgs ? '...' : ''}\n                </option>\n                {organizations\n                  .filter(org => !restrictToOrganizationId || org.id === restrictToOrganizationId)\n                  .map(org => (\n                    <option key={org.id} value={org.id}>{org.name}</option>\n                  ))}\n              </select>\n              <p className=\"text-xs text-gray-500 mt-1\">\n                \n              </p>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n              </label>\n              <select\n                value={formData.teamId}\n                onChange={(e) => setFormData(prev => ({ ...prev, teamId: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required={formData.role === 'athlete'}\n                disabled={formData.role === 'global_admin' || !formData.organizationId}\n              >\n                <option value=\"\">\n                  {formData.role === 'global_admin'\n                    ? ''\n                    : !formData.organizationId\n                    ? ''\n                    : ''}\n                </option>\n                {organizationTeams.map(team => (\n                  <option key={team.id} value={team.id}>{team.name}</option>\n                ))}\n              </select>\n              {formData.role === 'global_admin' && (\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  \n                </p>\n              )}\n              {formData.role !== 'global_admin' && !formData.organizationId && (\n                <p className=\"text-xs text-amber-600 mt-1\">\n                  \n                </p>\n              )}\n            </div>\n\n\n            {message && (\n              <div className={`flex items-center space-x-3 p-3 rounded-lg ${\n                message.type === 'success' \n                  ? 'bg-green-50 border border-green-200 text-green-600'\n                  : 'bg-red-50 border border-red-200 text-red-600'\n              }`}>\n                {message.type === 'success' ? (\n                  <CheckCircle className=\"w-5 h-5 flex-shrink-0\" />\n                ) : (\n                  <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\n                )}\n                <span className=\"text-sm\">{message.text}</span>\n              </div>\n            )}\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center\"\n            >\n              {loading ? (\n                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n              ) : (\n                <Mail className=\"w-5 h-5 mr-2\" />\n              )}\n              {loading ? '...' : ''}\n            </button>\n          </form>\n        </div>\n\n        {/* Information Panel */}\n        <div className=\"space-y-6\">\n          {/* Account Setup Information */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-start\">\n              <Info className=\"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0\" />\n              <div>\n                <h3 className=\"font-medium text-blue-900 mb-2\"></h3>\n                <div className=\"text-sm text-blue-700 space-y-2\">\n                  <p>1. </p>\n                  <p>2. </p>\n                  <p>3. </p>\n                  <p>4.  </p>\n                  <p>5. 24</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Role Information */}\n          <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n            <h4 className=\"font-medium text-gray-900 mb-3\"></h4>\n            <div className=\"space-y-3 text-sm text-gray-700\">\n              <div className=\"flex items-start\">\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                <div>\n                  <strong>:</strong> \n                </div>\n              </div>\n              <div className=\"flex items-start\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                <div>\n                  <strong>:</strong> \n                </div>\n              </div>\n              <div className=\"flex items-start\">\n                <div className=\"w-2 h-2 bg-purple-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                <div>\n                  <strong>:</strong> \n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Invited Users List */}\n          {invitedUsers.length > 0 && (\n            <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h4 className=\"font-medium text-gray-900\"></h4>\n                <span className=\"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs\">\n                  {invitedUsers.length}\n                </span>\n              </div>\n              \n              <div className=\"space-y-3 max-h-60 overflow-y-auto\">\n                {invitedUsers.slice(0, 10).map((user, index) => (\n                  <div key={index} className=\"bg-gray-50 rounded p-3\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <span className=\"font-medium text-gray-900\">{user.name}</span>\n                      <span className=\"text-xs text-gray-500\">{user.invitedAt}</span>\n                    </div>\n                    <div className=\"text-sm text-gray-600 space-y-2\">\n                      <p>{user.email}</p>\n                      <div className=\"flex items-center flex-wrap gap-2\">\n                        <span>{getRoleLabel(user.role)}</span>\n                        {user.organizationName && (\n                          <span className=\"flex items-center gap-1\">\n                             <Building2 className=\"w-3 h-3\" /> {user.organizationName}\n                          </span>\n                        )}\n                        {user.teamName && <span> {user.teamName}</span>}\n                        {user.user_id && (\n                          <span className=\"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs\">\n                            {user.user_id}\n                          </span>\n                        )}\n                        {user.emailSent ? (\n                          <span className=\"bg-green-100 text-green-700 px-2 py-1 rounded text-xs flex items-center space-x-1\">\n                            <Mail className=\"w-3 h-3\" />\n                            <span></span>\n                          </span>\n                        ) : (\n                          <span className=\"bg-red-100 text-red-700 px-2 py-1 rounded text-xs flex items-center space-x-1\">\n                            <AlertCircle className=\"w-3 h-3\" />\n                            <span></span>\n                          </span>\n                        )}\n                      </div>\n                      {user.temporaryPassword && (\n                        <div className=\"flex items-center space-x-2 bg-yellow-50 border border-yellow-200 p-2 rounded\">\n                          <span className=\"text-xs font-medium text-yellow-800\">:</span>\n                          <code className=\"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-yellow-300\">\n                            {showPassword[index] ? user.temporaryPassword : ''}\n                          </code>\n                          <button\n                            onClick={() => setShowPassword(prev => ({ ...prev, [index]: !prev[index] }))}\n                            className=\"p-1 hover:bg-yellow-100 rounded transition-colors\"\n                            title={showPassword[index] ? '' : ''}\n                          >\n                            {showPassword[index] ? (\n                              <EyeOff className=\"w-4 h-4 text-yellow-700\" />\n                            ) : (\n                              <Eye className=\"w-4 h-4 text-yellow-700\" />\n                            )}\n                          </button>\n                          <button\n                            onClick={() => copyPassword(user.temporaryPassword!, index)}\n                            className=\"p-1 hover:bg-yellow-100 rounded transition-colors\"\n                            title=\"\"\n                          >\n                            <Copy className={`w-4 h-4 ${copiedIndex === index ? 'text-green-600' : 'text-yellow-700'}`} />\n                          </button>\n                        </div>\n                      )}\n                      {user.inviteUrl && (\n                        <div className=\"flex items-center space-x-2 bg-blue-50 border border-blue-200 p-2 rounded\">\n                          <span className=\"text-xs font-medium text-blue-800\">URL:</span>\n                          <code className=\"flex-1 text-xs font-mono bg-white px-2 py-1 rounded border border-blue-300 truncate\">\n                            {user.inviteUrl}\n                          </code>\n                          <button\n                            onClick={() => copyInviteUrl(user.inviteUrl!, index)}\n                            className=\"p-1 hover:bg-blue-100 rounded transition-colors\"\n                            title=\"URL\"\n                          >\n                            <Copy className={`w-4 h-4 ${copiedIndex === index + 1000 ? 'text-green-600' : 'text-blue-700'}`} />\n                          </button>\n                          <a\n                            href={user.inviteUrl}\n                            className=\"p-1 hover:bg-blue-100 rounded transition-colors\"\n                            title=\"\"\n                          >\n                            <LinkIcon className=\"w-4 h-4 text-blue-700\" />\n                          </a>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","interface InvitationEmailData {\n  name: string;\n  email: string;\n  role: string;\n  teamName?: string;\n  passwordSetupLink: string;\n  inviteExpiredUrl: string; \n  inviterName?: string;\n  expiresInHours: number;\n}\n\nexport function generateInvitationEmailHTML(data: InvitationEmailData): string {\n  const roleDisplay = {\n    athlete: '',\n    staff: '',\n    admin: ''\n  }[data.role] || data.role;\n\n  return `\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Bekuta</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      min-height: 100vh;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0 auto;\n      padding: 40px 20px;\n    }\n    .card {\n      background: white;\n      border-radius: 20px;\n      overflow: hidden;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    }\n    .header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      padding: 50px 30px;\n      text-align: center;\n      position: relative;\n    }\n    .header::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);\n      background-size: 30px 30px;\n    }\n    .icon {\n      background: white;\n      width: 80px;\n      height: 80px;\n      border-radius: 50%;\n      margin: 0 auto 20px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n      position: relative;\n    }\n    .icon svg {\n      width: 40px;\n      height: 40px;\n    }\n    .header h1 {\n      color: white;\n      font-size: 32px;\n      margin: 0 0 10px 0;\n      font-weight: bold;\n    }\n    .header p {\n      color: rgba(255, 255, 255, 0.9);\n      font-size: 18px;\n      margin: 0;\n    }\n    .content {\n      padding: 40px 30px;\n    }\n    .greeting {\n      font-size: 24px;\n      color: #1a202c;\n      margin: 0 0 20px 0;\n      font-weight: 600;\n    }\n    .message {\n      color: #4a5568;\n      line-height: 1.6;\n      margin-bottom: 30px;\n      font-size: 16px;\n    }\n    .info-box {\n      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);\n      border-left: 4px solid #667eea;\n      padding: 20px;\n      margin: 20px 0;\n      border-radius: 8px;\n    }\n    .info-item {\n      margin: 12px 0;\n      display: flex;\n      align-items: start;\n    }\n    .info-label {\n      font-weight: 600;\n      color: #2d3748;\n      min-width: 120px;\n      font-size: 14px;\n    }\n    .info-value {\n      color: #4a5568;\n      font-size: 14px;\n    }\n    .setup-box {\n      background: linear-gradient(135deg, #e6f7ff 0%, #d0edff 100%);\n      border: 2px solid #3b82f6;\n      padding: 25px;\n      margin: 20px 0;\n      border-radius: 12px;\n      text-align: center;\n    }\n    .setup-label {\n      font-size: 16px;\n      color: #1e40af;\n      font-weight: 600;\n      margin-bottom: 15px;\n    }\n    .setup-note {\n      font-size: 13px;\n      color: #1e40af;\n      margin-top: 12px;\n      line-height: 1.5;\n    }\n    .cta-button {\n      display: block;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      text-decoration: none;\n      padding: 18px 40px;\n      border-radius: 12px;\n      font-weight: 600;\n      font-size: 18px;\n      margin: 30px 0;\n      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);\n      transition: all 0.3s ease;\n      text-align: center;\n    }\n    .cta-button:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);\n    }\n    .steps {\n      background: #f7fafc;\n      padding: 25px;\n      border-radius: 12px;\n      margin: 25px 0;\n    }\n    .steps h3 {\n      color: #2d3748;\n      font-size: 18px;\n      margin: 0 0 20px 0;\n      text-align: center;\n    }\n    .step {\n      display: flex;\n      align-items: start;\n      margin: 15px 0;\n      color: #4a5568;\n    }\n    .step-number {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      width: 28px;\n      height: 28px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      margin-right: 12px;\n      flex-shrink: 0;\n      font-size: 14px;\n    }\n    .urgency {\n      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);\n      padding: 15px 20px;\n      border-radius: 10px;\n      margin: 20px 0;\n      text-align: center;\n      border: 2px solid #fdcb6e;\n    }\n    .urgency-icon {\n      font-size: 24px;\n      margin-bottom: 5px;\n    }\n    .urgency-text {\n      color: #7d6608;\n      font-weight: 600;\n      margin: 0;\n      font-size: 14px;\n    }\n    .footer {\n      padding: 30px;\n      text-align: center;\n      color: #718096;\n      font-size: 14px;\n      background: #f7fafc;\n      border-top: 1px solid #e2e8f0;\n    }\n    .footer a {\n      color: #667eea;\n      text-decoration: none;\n    }\n    @media only screen and (max-width: 600px) {\n      .container {\n        padding: 20px 10px;\n      }\n      .header {\n        padding: 30px 20px;\n      }\n      .header h1 {\n        font-size: 24px;\n      }\n      .content {\n        padding: 30px 20px;\n      }\n      .greeting {\n        font-size: 20px;\n      }\n      .cta-button {\n        padding: 16px 30px;\n        font-size: 16px;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"card\">\n      <div class=\"header\">\n        <div class=\"icon\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#667eea\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M12 2 L2 7 L12 12 L22 7 L12 2z\"/>\n            <polyline points=\"2 17 12 22 22 17\"/>\n            <polyline points=\"2 12 12 17 22 12\"/>\n          </svg>\n        </div>\n        <h1>${data.name}</h1>\n        ${data.teamName ? `<p>${data.teamName} </p>` : '<p></p>'}\n      </div>\n\n      <div class=\"content\">\n        <p class=\"greeting\">Bekuta </p>\n\n        <p class=\"message\">\n          ${data.inviterName ? `${data.inviterName}` : ''}Bekuta<br/>\n          \n        </p>\n\n        <div class=\"info-box\">\n          <div class=\"info-item\">\n            <span class=\"info-label\"></span>\n            <span class=\"info-value\">${roleDisplay}</span>\n          </div>\n          <div class=\"info-item\">\n            <span class=\"info-label\"></span>\n            <span class=\"info-value\">${data.email}</span>\n          </div>\n          ${data.teamName ? `\n          <div class=\"info-item\">\n            <span class=\"info-label\"></span>\n            <span class=\"info-value\">${data.teamName}</span>\n          </div>\n          ` : ''}\n        </div>\n\n        <div class=\"setup-box\">\n          <div class=\"setup-label\"> </div>\n          <div class=\"setup-note\">\n            Bekuta<br>\n             Bekuta \n            <br>\n          </div>\n        </div>\n\n        <div class=\"urgency\">\n          <div class=\"urgency-icon\"></div>\n          <p class=\"urgency-text\">\n             ${data.expiresInHours}<br/>\n            \n          </p>\n        </div>\n\n        <a href=\"${data.passwordSetupLink}\" class=\"cta-button\">\n           \n        </a>\n\n        <div class=\"steps\">\n          <h3></h3>\n          <div class=\"step\">\n            <div class=\"step-number\">1</div>\n            <div></div>\n          </div>\n          <div class=\"step\">\n            <div class=\"step-number\">2</div>\n            <div></div>\n          </div>\n          <div class=\"step\">\n            <div class=\"step-number\">3</div>\n            <div>Bekuta </div>\n          </div>\n          <div class=\"step\">\n            <div class=\"step-number\">4</div>\n            <div></div>\n          </div>\n        </div>\n\n        <p class=\"message\" style=\"font-size: 14px; color: #718096;\">\n          URL<br>\n          <span style=\"word-break: break-all; color: #667eea;\">${data.passwordSetupLink}</span>\n        </p>\n      </div>\n\n      <div style=\"margin-top: 18px; font-size: 13px; color: #4a5568; line-height: 1.6;\">\n        <br />\n        <a href=\"${data.inviteExpiredUrl}\" style=\"color:#667eea; text-decoration: underline;\">\n          \n        </a>\n      </div>\n\n      <div class=\"footer\">\n        <p></p>\n        <p style=\"margin-top: 15px;\">\n          \n        </p>\n        <p style=\"margin-top: 15px; font-size: 12px; color: #a0aec0;\">\n           ${new Date().getFullYear()} Bekuta. All rights reserved.\n        </p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n  `.trim();\n}\n\ninterface AlertEmailData {\n  userName: string;\n  alertTitle: string;\n  alertMessage: string;\n  priority: 'high' | 'medium' | 'low';\n  acwrValue?: number;\n  recommendedRange: string;\n  recommendations?: string[];\n  appUrl: string;\n}\n\ninterface PasswordResetEmailData {\n  userName: string;\n  temporaryPassword: string;\n  appUrl: string;\n}\n\ninterface WeeklySummaryEmailData {\n  userName: string;\n  weekRange: string;\n  trainingDays: number;\n  avgACWR: string;\n  totalLoad: number;\n  alertCount: number;\n  insights?: string[];\n  appUrl: string;\n}\n\nexport function generateAlertEmailHTML(data: AlertEmailData): string {\n  const priorityColors = {\n    high: { bg: '#fee2e2', border: '#dc2626', text: '#991b1b' },\n    medium: { bg: '#fef3c7', border: '#f59e0b', text: '#92400e' },\n    low: { bg: '#dbeafe', border: '#3b82f6', text: '#1e40af' }\n  };\n\n  const colors = priorityColors[data.priority];\n  const priorityLabel = { high: '', medium: '', low: '' }[data.priority];\n\n  return `\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>ACWR </title>\n</head>\n<body style=\"margin: 0; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f3f4f6;\">\n  <div style=\"max-width: 600px; margin: 0 auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n    <div style=\"background: ${colors.border}; color: white; padding: 30px; text-align: center;\">\n      <h1 style=\"margin: 0; font-size: 24px;\"> ACWR </h1>\n      <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">: ${priorityLabel}</p>\n    </div>\n\n    <div style=\"padding: 30px;\">\n      <p style=\"font-size: 18px; color: #1f2937; margin: 0 0 20px 0;\">${data.userName}</p>\n\n      <div style=\"background: ${colors.bg}; border-left: 4px solid ${colors.border}; padding: 20px; margin: 20px 0; border-radius: 4px;\">\n        <h2 style=\"margin: 0 0 10px 0; color: ${colors.text}; font-size: 18px;\">${data.alertTitle}</h2>\n        <p style=\"margin: 0; color: #4b5563; line-height: 1.6;\">${data.alertMessage}</p>\n      </div>\n\n      ${data.acwrValue ? `\n      <div style=\"background: #f9fafb; padding: 15px; border-radius: 8px; margin: 20px 0;\">\n        <p style=\"margin: 0 0 5px 0; color: #6b7280; font-size: 14px;\">ACWR</p>\n        <p style=\"margin: 0; font-size: 32px; font-weight: bold; color: ${colors.text};\">${data.acwrValue.toFixed(2)}</p>\n        <p style=\"margin: 10px 0 0 0; color: #6b7280; font-size: 14px;\">: ${data.recommendedRange}</p>\n      </div>\n      ` : ''}\n\n      ${data.recommendations && data.recommendations.length > 0 ? `\n      <div style=\"margin: 20px 0;\">\n        <h3 style=\"color: #1f2937; font-size: 16px; margin: 0 0 15px 0;\"></h3>\n        ${data.recommendations.map(rec => `\n          <div style=\"display: flex; align-items: start; margin: 10px 0;\">\n            <span style=\"color: ${colors.border}; margin-right: 10px;\"></span>\n            <span style=\"color: #4b5563; line-height: 1.5;\">${rec}</span>\n          </div>\n        `).join('')}\n      </div>\n      ` : ''}\n\n      <a href=\"${data.appUrl}\" style=\"display: inline-block; background: ${colors.border}; color: white; text-decoration: none; padding: 12px 30px; border-radius: 8px; margin: 20px 0; font-weight: 600;\">\n        \n      </a>\n    </div>\n\n    <div style=\"padding: 20px; text-align: center; background: #f9fafb; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px;\">\n      <p style=\"margin: 0;\"> ${new Date().getFullYear()} Bekuta</p>\n    </div>\n  </div>\n</body>\n</html>\n  `.trim();\n}\n\nexport function generateAlertEmailText(data: AlertEmailData): string {\n  const priorityLabel = { high: '', medium: '', low: '' }[data.priority];\n\n  return `\nACWR \n\n${data.userName}\n\n: ${priorityLabel}\n\n\n${data.alertTitle}\n\n\n${data.alertMessage}\n\n${data.acwrValue ? `\nACWR: ${data.acwrValue.toFixed(2)}\n: ${data.recommendedRange}\n` : ''}\n\n${data.recommendations && data.recommendations.length > 0 ? `\n:\n${data.recommendations.map(rec => ` ${rec}`).join('\\n')}\n` : ''}\n\n: ${data.appUrl}\n\n\n ${new Date().getFullYear()} Bekuta\n  `.trim();\n}\n\nexport function generatePasswordResetEmailHTML(data: PasswordResetEmailData): string {\n  return `\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title></title>\n</head>\n<body style=\"margin: 0; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f3f4f6;\">\n  <div style=\"max-width: 600px; margin: 0 auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n    <div style=\"background: #3b82f6; color: white; padding: 30px; text-align: center;\">\n      <h1 style=\"margin: 0; font-size: 24px;\"> </h1>\n    </div>\n\n    <div style=\"padding: 30px;\">\n      <p style=\"font-size: 18px; color: #1f2937; margin: 0 0 20px 0;\">${data.userName}</p>\n\n      <p style=\"color: #4b5563; line-height: 1.6;\">\n        \n      </p>\n\n      <div style=\"background: #fef3c7; border: 2px dashed #f59e0b; padding: 20px; margin: 20px 0; border-radius: 8px; text-align: center;\">\n        <p style=\"margin: 0 0 10px 0; color: #92400e; font-weight: 600;\"></p>\n        <p style=\"margin: 0; font-family: 'Courier New', monospace; font-size: 24px; font-weight: bold; color: #d97706; letter-spacing: 2px;\">${data.temporaryPassword}</p>\n        <p style=\"margin: 10px 0 0 0; color: #92400e; font-size: 12px;\"> </p>\n      </div>\n\n      <a href=\"${data.appUrl}\" style=\"display: inline-block; background: #3b82f6; color: white; text-decoration: none; padding: 12px 30px; border-radius: 8px; margin: 20px 0; font-weight: 600;\">\n        \n      </a>\n\n      <div style=\"background: #fef2f2; border-left: 4px solid #dc2626; padding: 15px; margin: 20px 0; border-radius: 4px;\">\n        <p style=\"margin: 0; color: #991b1b; font-size: 14px; font-weight: 600;\"></p>\n        <p style=\"margin: 10px 0 0 0; color: #7f1d1d; font-size: 14px;\">\n          \n        </p>\n      </div>\n    </div>\n\n    <div style=\"padding: 20px; text-align: center; background: #f9fafb; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px;\">\n      <p style=\"margin: 0;\"> ${new Date().getFullYear()} Bekuta</p>\n    </div>\n  </div>\n</body>\n</html>\n  `.trim();\n}\n\nexport function generatePasswordResetEmailText(data: PasswordResetEmailData): string {\n  return `\n\n\n${data.userName}\n\n\n\n\n\n\n\n\n${data.temporaryPassword}\n\n \n\n\n\n: ${data.appUrl}\n\n\n\n\n\n\n ${new Date().getFullYear()} Bekuta\n  `.trim();\n}\n\nexport function generateWeeklySummaryEmailHTML(data: WeeklySummaryEmailData): string {\n  return `\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title></title>\n</head>\n<body style=\"margin: 0; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f3f4f6;\">\n  <div style=\"max-width: 600px; margin: 0 auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n    <div style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 30px; text-align: center;\">\n      <h1 style=\"margin: 0; font-size: 24px;\"> </h1>\n      <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">${data.weekRange}</p>\n    </div>\n\n    <div style=\"padding: 30px;\">\n      <p style=\"font-size: 18px; color: #1f2937; margin: 0 0 20px 0;\">${data.userName}</p>\n\n      <p style=\"color: #4b5563; line-height: 1.6; margin-bottom: 25px;\">\n        \n      </p>\n\n      <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 25px 0;\">\n        <div style=\"background: #f0fdf4; padding: 20px; border-radius: 8px; text-align: center;\">\n          <p style=\"margin: 0 0 5px 0; color: #16a34a; font-size: 14px; font-weight: 600;\"></p>\n          <p style=\"margin: 0; font-size: 32px; font-weight: bold; color: #15803d;\">${data.trainingDays}</p>\n          <p style=\"margin: 5px 0 0 0; color: #16a34a; font-size: 12px;\"></p>\n        </div>\n\n        <div style=\"background: #eff6ff; padding: 20px; border-radius: 8px; text-align: center;\">\n          <p style=\"margin: 0 0 5px 0; color: #2563eb; font-size: 14px; font-weight: 600;\">ACWR</p>\n          <p style=\"margin: 0; font-size: 32px; font-weight: bold; color: #1e40af;\">${data.avgACWR}</p>\n          <p style=\"margin: 5px 0 0 0; color: #2563eb; font-size: 12px;\">: 0.8-1.3</p>\n        </div>\n\n        <div style=\"background: #fef3c7; padding: 20px; border-radius: 8px; text-align: center;\">\n          <p style=\"margin: 0 0 5px 0; color: #d97706; font-size: 14px; font-weight: 600;\"></p>\n          <p style=\"margin: 0; font-size: 32px; font-weight: bold; color: #b45309;\">${data.totalLoad}</p>\n          <p style=\"margin: 5px 0 0 0; color: #d97706; font-size: 12px;\">AU</p>\n        </div>\n\n        <div style=\"background: ${data.alertCount > 0 ? '#fee2e2' : '#f0fdf4'}; padding: 20px; border-radius: 8px; text-align: center;\">\n          <p style=\"margin: 0 0 5px 0; color: ${data.alertCount > 0 ? '#dc2626' : '#16a34a'}; font-size: 14px; font-weight: 600;\"></p>\n          <p style=\"margin: 0; font-size: 32px; font-weight: bold; color: ${data.alertCount > 0 ? '#b91c1c' : '#15803d'};\">${data.alertCount}</p>\n          <p style=\"margin: 5px 0 0 0; color: ${data.alertCount > 0 ? '#dc2626' : '#16a34a'}; font-size: 12px;\"></p>\n        </div>\n      </div>\n\n      ${data.insights && data.insights.length > 0 ? `\n      <div style=\"background: #f9fafb; padding: 20px; border-radius: 8px; margin: 25px 0;\">\n        <h3 style=\"color: #1f2937; font-size: 16px; margin: 0 0 15px 0;\"> </h3>\n        ${data.insights.map(insight => `\n          <div style=\"display: flex; align-items: start; margin: 10px 0;\">\n            <span style=\"color: #10b981; margin-right: 10px;\"></span>\n            <span style=\"color: #4b5563; line-height: 1.5;\">${insight}</span>\n          </div>\n        `).join('')}\n      </div>\n      ` : ''}\n\n      <a href=\"${data.appUrl}\" style=\"display: inline-block; background: #10b981; color: white; text-decoration: none; padding: 12px 30px; border-radius: 8px; margin: 20px 0; font-weight: 600;\">\n        \n      </a>\n    </div>\n\n    <div style=\"padding: 20px; text-align: center; background: #f9fafb; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px;\">\n      <p style=\"margin: 0;\"> ${new Date().getFullYear()} Bekuta</p>\n    </div>\n  </div>\n</body>\n</html>\n  `.trim();\n}\n\nexport function generateWeeklySummaryEmailText(data: WeeklySummaryEmailData): string {\n  return `\n\n\n${data.userName}\n\n${data.weekRange}\n\n\n\n\n\n\n\n: ${data.trainingDays}\nACWR: ${data.avgACWR} (: 0.8-1.3)\n: ${data.totalLoad} AU\n: ${data.alertCount}\n\n${data.insights && data.insights.length > 0 ? `\n\n\n\n\n${data.insights.map(insight => ` ${insight}`).join('\\n')}\n` : ''}\n\n: ${data.appUrl}\n\n\n ${new Date().getFullYear()} Bekuta\n  `.trim();\n}\n\nexport function generateInvitationEmailText(data: InvitationEmailData): string {\n  const roleDisplay = {\n    athlete: '',\n    staff: '',\n    admin: ''\n  }[data.role] || data.role;\n\n  return `\nBekuta \n\n${data.name}\n\n${data.inviterName ? `${data.inviterName}` : ''}Bekuta\n\n\n\n\n\n\n\n\n: ${roleDisplay}\n: ${data.email}\n${data.teamName ? `: ${data.teamName}\\n` : ''}\n\n\n\n\n\n  Bekuta \nBekuta \n\n\n\n\n\n\n1. URL\n   ${data.passwordSetupLink}\n\n2. \n\n3. Bekuta \n   \n\n4. \n\n\n\n  ${data.expiresInHours}\n   \n   \n\n  \n  ${data.inviteExpiredUrl}\n\n\n\n\n ${new Date().getFullYear()} Bekuta\n  `.trim();\n}","import React, { useState } from 'react';\nimport { getTodayJSTString } from '../lib/date';\nimport { Team, supabase } from '../lib/supabase';\nimport {\n  Upload,\n  Download,\n  Users,\n  CheckCircle,\n  AlertCircle,\n  FileSpreadsheet,\n  Mail,\n} from 'lucide-react';\n\ninterface BulkUserInvitationProps {\n  teams: Team[];\n  onUsersInvited: () => void;\n  restrictToOrganizationId?: string;\n  allowAdminInvite?: boolean;\n}\n\ninterface CsvUserRow {\n  name: string;\n  email: string;\n  role: 'athlete' | 'staff' | 'global_admin';\n  organizationName: string;\n  teamName?: string;\n}\n\ninterface ProcessedUser extends CsvUserRow {\n  status: 'success' | 'error';\n  message: string;\n  user_id?: string;\n  teamId?: string;\n}\n\nexport function BulkUserInvitation({\n  teams,\n  onUsersInvited,\n  restrictToOrganizationId,\n  allowAdminInvite = true,\n}: BulkUserInvitationProps) {\n  const [csvFile, setCsvFile] = useState<File | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [processedUsers, setProcessedUsers] = useState<ProcessedUser[]>([]);\n  const [showResults, setShowResults] = useState(false);\n\n  // ===========================\n  //  CSV\n  // ===========================\n  const downloadTemplate = () => {\n    const headers = ['name', 'email', 'role', 'organizationName', 'team_name'];\n\n    const sampleData = (\n      [\n        ['', 'tanaka@example.com', 'athlete', '', ''],\n        ['', 'sato@example.com', 'staff', '', ''],\n        allowAdminInvite\n          ? ['', 'admin@example.com', 'global_admin', '', '']\n          : null,\n      ].filter(Boolean) as string[][]\n    );\n\n    const csvContent = [\n      '# Bekuta ',\n      '# :',\n      allowAdminInvite\n        ? '# - role  athlete, staff, global_admin '\n        : '# - role  athlete, staff ',\n      '# - organizationName ',\n      '# - athlete  team_name ',\n      '# - staff  team_name ',\n      '# - global_admin  team_name ',\n      '',\n      headers.join(','),\n      ...sampleData.map((row) => row.join(',')),\n    ]\n      .filter(Boolean)\n      .join('\\n');\n\n    const bom = '\\uFEFF';\n    const blob = new Blob([bom + csvContent], {\n      type: 'text/csv;charset=utf-8;',\n    });\n    const link = document.createElement('a');\n    const url = URL.createObjectURL(blob);\n    link.setAttribute('href', url);\n    link.setAttribute('download', '.csv');\n    link.style.visibility = 'hidden';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  // ===========================\n  //  CSVorganizationName\n  // ===========================\n  const parseCSV = (text: string): CsvUserRow[] => {\n    const lines = text\n      .split('\\n')\n      .map((l) => l.trim())\n      .filter((line) => line && !line.startsWith('#'));\n\n    if (lines.length < 2) {\n      throw new Error('CSV1');\n    }\n\n    const header = lines[0]\n      .split(',')\n      .map((h) => h.trim().replace(/^\"|\"$/g, ''));\n\n    const findCol = (keys: string[]) =>\n      header.findIndex((h) =>\n        keys.some((k) => h.toLowerCase() === k.toLowerCase())\n      );\n\n    const nameIdx = findCol(['name']);\n    const emailIdx = findCol(['email']);\n    const roleIdx = findCol(['role']);\n    const orgIdx = findCol(['organizationname', 'organization', 'organization_name']);\n    const teamIdx = findCol(['team_name', 'team']);\n\n    if (nameIdx === -1 || emailIdx === -1 || roleIdx === -1 || orgIdx === -1) {\n      throw new Error(\n        'CSV name, email, role, organizationName 4'\n      );\n    }\n\n    const users: CsvUserRow[] = [];\n\n    for (let i = 1; i < lines.length; i++) {\n      const cols = lines[i]\n        .split(',')\n        .map((c) => c.trim().replace(/^\"|\"$/g, ''));\n\n      if (!cols[nameIdx] || !cols[emailIdx] || !cols[roleIdx] || !cols[orgIdx]) {\n        continue;\n      }\n\n      const roleRaw = cols[roleIdx].toLowerCase();\n      const validRoles = allowAdminInvite\n        ? ['athlete', 'staff', 'global_admin']\n        : ['athlete', 'staff'];\n\n      if (!validRoles.includes(roleRaw)) continue;\n\n      users.push({\n        name: cols[nameIdx],\n        email: cols[emailIdx],\n        role: roleRaw as 'athlete' | 'staff' | 'global_admin',\n        organizationName: cols[orgIdx],\n        teamName: teamIdx !== -1 ? cols[teamIdx] || undefined : undefined,\n      });\n    }\n\n    if (users.length === 0) {\n      throw new Error('CSV');\n    }\n\n    return users;\n  };\n\n  // ===========================\n  //  \n  // ===========================\n  const processBulkInvites = async (\n    rows: CsvUserRow[]\n  ): Promise<ProcessedUser[]> => {\n    const {\n      data: { session },\n    } = await supabase.auth.getSession();\n\n    if (!session) {\n      throw new Error('');\n    }\n\n    // restrictID\n    let orgQuery = supabase.from('organizations').select('id, name');\n\n    if (restrictToOrganizationId) {\n      orgQuery = orgQuery.eq('id', restrictToOrganizationId);\n    }\n\n    const { data: orgs, error: orgErr } = await orgQuery;\n\n    if (orgErr || !orgs || orgs.length === 0) {\n      throw new Error('');\n    }\n\n    const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n    if (!supabaseUrl) {\n      throw new Error('VITE_SUPABASE_URL ');\n    }\n\n    const results: ProcessedUser[] = [];\n\n    for (const row of rows) {\n      try {\n        // ===    ===\n        const org = orgs.find((o) => o.name === row.organizationName);\n\n        if (!org) {\n          results.push({\n            ...row,\n            status: 'error',\n            message: ` \"${row.organizationName}\" `,\n          });\n          continue;\n        }\n\n        // restrictToOrganizationId ID\n        if (restrictToOrganizationId && org.id !== restrictToOrganizationId) {\n          results.push({\n            ...row,\n            status: 'error',\n            message: `ID \"${restrictToOrganizationId}\" CSV: ${row.organizationName}`,\n          });\n          continue;\n        }\n\n        // ===   ===\n        let teamId: string | undefined;\n\n        if (row.teamName) {\n          const team = teams.find(\n            (t) => t.name === row.teamName && t.organization_id === org.id\n          );\n\n          if (!team) {\n            results.push({\n              ...row,\n              status: 'error',\n              message: ` \"${org.name}\"  \"${row.teamName}\" `,\n            });\n            continue;\n          }\n\n          teamId = team.id;\n        }\n\n        if (row.role === 'athlete' && !teamId) {\n          results.push({\n            ...row,\n            status: 'error',\n            message: 'athlete team_name',\n          });\n          continue;\n        }\n\n        // ===  create-user Edge Function  ===\n        console.log(' Creating user:', row.email);\n\n        const response = await fetch(\n          `${supabaseUrl}/functions/v1/create-user`,\n          {\n            method: 'POST',\n            headers: {\n              Authorization: `Bearer ${session.access_token}`,\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              name: row.name,\n              email: row.email,\n              role: row.role,\n              teamId: teamId,\n              organizationId: org.id,\n              redirectUrl: `${window.location.origin}/reset-password`,\n            }),\n          }\n        );\n\n        const result = await response.json();\n\n        if (!response.ok) {\n          console.error(' create-user error:', result);\n          results.push({\n            ...row,\n            status: 'error',\n            message: result.error || '',\n          });\n          continue;\n        }\n\n        const passwordSetupLink = result.passwordSetupLink;\n        if (!passwordSetupLink) {\n          results.push({\n            ...row,\n            status: 'error',\n            message: 'Edge Function ',\n          });\n          continue;\n        }\n\n        // ===  send-email ()  ===\n        let emailSent = false;\n        let emailErrorMsg = '';\n\n        try {\n          console.log(' Sending invitation email to:', row.email);\n\n          const emailResponse = await fetch(\n            `${supabaseUrl}/functions/v1/send-email`,\n            {\n              method: 'POST',\n              headers: {\n                Authorization: `Bearer ${session.access_token}`,\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                to: row.email,\n                type: 'invitation',\n                data: {\n                  name: row.name,\n                  email: row.email,\n                  role: row.role,\n                  teamName: row.teamName,\n                  passwordSetupLink,\n                  expiresInHours: 24,\n                },\n              }),\n            }\n          );\n\n          const emailResult = await emailResponse.json();\n          emailSent = emailResponse.ok;\n\n          if (!emailSent) {\n            emailErrorMsg = emailResult.error || 'Unknown error';\n            console.error(' Invitation email failed:', {\n              status: emailResponse.status,\n              error: emailErrorMsg,\n              result: emailResult,\n            });\n          } else {\n            console.log(' Email sent successfully to:', row.email);\n          }\n        } catch (emailError: any) {\n          emailErrorMsg = emailError.message || 'Network error';\n          console.error(' Invitation email exception:', emailError);\n        }\n\n        results.push({\n          ...row,\n          status: emailSent ? 'success' : 'error',\n          message: emailSent\n            ? ''\n            : `: ${emailErrorMsg}`,\n          user_id: result.user?.user_id,\n          teamId,\n        });\n      } catch (err: any) {\n        console.error(' Bulk invite error for row:', row, err);\n        results.push({\n          ...row,\n          status: 'error',\n          message: err.message || '',\n        });\n      }\n\n      // \n      await new Promise((resolve) => setTimeout(resolve, 2000));\n    }\n\n    return results;\n  };\n\n  // ===========================\n  //  \n  // ===========================\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0] || null;\n    setCsvFile(file);\n    setShowResults(false);\n    setProcessedUsers([]);\n  };\n\n  const handleBulkInvite = async () => {\n    if (!csvFile) return;\n\n    setLoading(true);\n    try {\n      const text = await csvFile.text();\n      const users = parseCSV(text);\n\n      const results = await processBulkInvites(users);\n      setProcessedUsers(results);\n      setShowResults(true);\n\n      const successCount = results.filter((r) => r.status === 'success').length;\n      if (successCount > 0) {\n        onUsersInvited();\n      }\n    } catch (error: any) {\n      console.error('Bulk invitation error:', error);\n      alert(`: ${error.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const downloadResults = () => {\n    if (processedUsers.length === 0) return;\n\n    const headers = [\n      '',\n      '',\n      '',\n      '',\n      '',\n      'ID',\n      '',\n      '',\n    ];\n    const csvContent = [\n      `#  - ${new Date().toLocaleString('ja-JP')}`,\n      `# : ${processedUsers.filter((u) => u.status === 'success').length}`,\n      `# : ${processedUsers.filter((u) => u.status === 'error').length}`,\n      '',\n      headers.join(','),\n      ...processedUsers.map((user) =>\n        [\n          user.name,\n          user.email,\n          user.role === 'athlete'\n            ? ''\n            : user.role === 'staff'\n            ? ''\n            : '',\n          user.organizationName,\n          user.teamName || '-',\n          user.user_id || '-',\n          user.status === 'success' ? '' : '',\n          user.message,\n        ].join(',')\n      ),\n    ].join('\\n');\n\n    const bom = '\\uFEFF';\n    const blob = new Blob([bom + csvContent], {\n      type: 'text/csv;charset=utf-8;',\n    });\n    const link = document.createElement('a');\n    const url = URL.createObjectURL(blob);\n    link.setAttribute('href', url);\n    link.setAttribute(\n      'download',\n      `_${getTodayJSTString()}.csv`\n    );\n    link.style.visibility = 'hidden';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const successCount = processedUsers.filter((u) => u.status === 'success').length;\n  const errorCount = processedUsers.filter((u) => u.status === 'error').length;\n\n  // ===========================\n  //  JSX\n  // ===========================\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-3\">\n          <Users className=\"w-6 h-6 text-purple-600\" />\n          <h2 className=\"text-xl font-semibold text-gray-900\"></h2>\n        </div>\n        <button\n          onClick={downloadTemplate}\n          className=\"bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm\"\n        >\n          <Download className=\"w-4 h-4\" />\n          <span>CSV</span>\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        {/* Upload Section */}\n        <div className=\"bg-white rounded-xl shadow-sm p-6\">\n          <div className=\"text-center\">\n            <Upload className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n              CSV\n            </h3>\n            <p className=\"text-sm text-gray-600 mb-6\">\n              CSV\n            </p>\n\n            <input\n              type=\"file\"\n              accept=\".csv\"\n              onChange={handleFileChange}\n              className=\"hidden\"\n              id=\"csv-upload\"\n            />\n            <label\n              htmlFor=\"csv-upload\"\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg cursor-pointer transition-colors inline-flex items-center space-x-2\"\n            >\n              <FileSpreadsheet className=\"w-5 h-5\" />\n              <span>CSV</span>\n            </label>\n\n            {csvFile && (\n              <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg\">\n                <p className=\"text-sm text-green-700\">\n                  :{' '}\n                  <strong>{csvFile.name}</strong>\n                </p>\n              </div>\n            )}\n\n            {csvFile && (\n              <button\n                onClick={handleBulkInvite}\n                disabled={loading}\n                className=\"mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center\"\n              >\n                {loading ? (\n                  <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\" />\n                ) : (\n                  <Mail className=\"w-5 h-5 mr-2\" />\n                )}\n                {loading ? '...' : ''}\n              </button>\n            )}\n          </div>\n        </div>\n\n        {/* Instructions & Results */}\n        <div className=\"space-y-6\">\n          {/* CSV format info */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <h4 className=\"font-medium text-blue-900 mb-3\">CSV</h4>\n            <div className=\"text-sm text-blue-700 space-y-2\">\n              <p>CSV</p>\n              <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                <li>\n                  <strong>name:</strong> \n                </li>\n                <li>\n                  <strong>email:</strong> \n                </li>\n                <li>\n                  <strong>role:</strong> athlete, staff, global_admin \n                </li>\n                <li>\n                  <strong>organizationName:</strong> \n                </li>\n                <li>\n                  <strong>team_name:</strong> athlete  / staff \n                </li>\n              </ul>\n            </div>\n          </div>\n\n          {/*  */}\n          <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n            <h4 className=\"font-medium text-amber-900 mb-3\"></h4>\n            <div className=\"text-sm text-amber-700 space-y-1\">\n              <p> </p>\n              <p> </p>\n              <p> </p>\n              <p> </p>\n            </div>\n          </div>\n\n          {/*  */}\n          {showResults && (\n            <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h4 className=\"font-medium text-gray-900\"></h4>\n                <button\n                  onClick={downloadResults}\n                  className=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center space-x-1\"\n                >\n                  <Download className=\"w-3 h-3\" />\n                  <span></span>\n                </button>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 mb-4\">\n                <div className=\"bg-green-50 rounded p-3 text-center\">\n                  <div className=\"text-2xl font-bold text-green-600\">\n                    {successCount}\n                  </div>\n                  <div className=\"text-sm text-green-700\"></div>\n                </div>\n                <div className=\"bg-red-50 rounded p-3 text-center\">\n                  <div className=\"text-2xl font-bold text-red-600\">\n                    {errorCount}\n                  </div>\n                  <div className=\"text-sm text-red-700\"></div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                {processedUsers.map((user, index) => (\n                  <div\n                    key={index}\n                    className={`p-3 rounded border ${\n                      user.status === 'success'\n                        ? 'bg-green-50 border-green-200'\n                        : 'bg-red-50 border-red-200'\n                    }`}\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2\">\n                          {user.status === 'success' ? (\n                            <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                          ) : (\n                            <AlertCircle className=\"w-4 h-4 text-red-600\" />\n                          )}\n                          <span className=\"font-medium\">{user.name}</span>\n                          {user.user_id && (\n                            <span className=\"font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs\">\n                              {user.user_id}\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"text-sm text-gray-600 mt-1\">\n                          {user.email}  {user.role}{' '}\n                           {user.organizationName}\n                          {user.teamName && `  ${user.teamName}`}\n                        </div>\n                        <div\n                          className={`text-xs mt-1 ${\n                            user.status === 'success'\n                              ? 'text-green-600'\n                              : 'text-red-600'\n                          }`}\n                        >\n                          {user.message}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useState, useMemo } from 'react';\nimport { ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight } from 'lucide-react';\n\ninterface PaginatedTableProps<T> {\n  data: T[];\n  itemsPerPage?: number;\n  renderItem: (item: T, index: number) => React.ReactNode;\n  renderHeader?: () => React.ReactNode;\n  loading?: boolean;\n  emptyMessage?: string;\n}\n\nexport function PaginatedTable<T>({\n  data,\n  itemsPerPage = 20,\n  renderItem,\n  renderHeader,\n  loading = false,\n  emptyMessage = \"\"\n}: PaginatedTableProps<T>) {\n  const [currentPage, setCurrentPage] = useState(1);\n\n  // \n  const totalPages = Math.ceil(data.length / itemsPerPage);\n  const startIndex = (currentPage - 1) * itemsPerPage;\n  const endIndex = startIndex + itemsPerPage;\n  \n  const currentData = useMemo(() => {\n    return data.slice(startIndex, endIndex);\n  }, [data, startIndex, endIndex]);\n\n  // \n  const goToPage = (page: number) => {\n    if (page >= 1 && page <= totalPages) {\n      setCurrentPage(page);\n    }\n  };\n\n  const goToFirstPage = () => goToPage(1);\n  const goToLastPage = () => goToPage(totalPages);\n  const goToPreviousPage = () => goToPage(currentPage - 1);\n  const goToNextPage = () => goToPage(currentPage + 1);\n\n  // \n  const getPageNumbers = () => {\n    const delta = 2; // \n    const range = [];\n    const rangeWithDots = [];\n\n    for (let i = Math.max(2, currentPage - delta); \n         i <= Math.min(totalPages - 1, currentPage + delta); \n         i++) {\n      range.push(i);\n    }\n\n    if (currentPage - delta > 2) {\n      rangeWithDots.push(1, '...');\n    } else {\n      rangeWithDots.push(1);\n    }\n\n    rangeWithDots.push(...range);\n\n    if (currentPage + delta < totalPages - 1) {\n      rangeWithDots.push('...', totalPages);\n    } else if (totalPages > 1) {\n      rangeWithDots.push(totalPages);\n    }\n\n    return rangeWithDots;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (data.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-gray-500\">{emptyMessage}</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/*  */}\n      <div className=\"flex items-center justify-between text-sm text-gray-600\">\n        <div>\n          {startIndex + 1} - {Math.min(endIndex, data.length)} / {data.length}\n        </div>\n        <div>\n           {currentPage} / {totalPages}\n        </div>\n      </div>\n\n      {/*  */}\n      {renderHeader && renderHeader()}\n\n      {/*  */}\n      <div className=\"space-y-2\">\n        {currentData.map((item, index) => renderItem(item, startIndex + index))}\n      </div>\n\n      {/*  */}\n      {totalPages > 1 && (\n        <div className=\"flex items-center justify-center space-x-2 py-4\">\n          {/*  */}\n          <button\n            onClick={goToFirstPage}\n            disabled={currentPage === 1}\n            className=\"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\"\n            title=\"\"\n          >\n            <ChevronsLeft className=\"w-4 h-4\" />\n          </button>\n\n          {/*  */}\n          <button\n            onClick={goToPreviousPage}\n            disabled={currentPage === 1}\n            className=\"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\"\n            title=\"\"\n          >\n            <ChevronLeft className=\"w-4 h-4\" />\n          </button>\n\n          {/*  */}\n          <div className=\"flex items-center space-x-1\">\n            {getPageNumbers().map((pageNumber, index) => (\n              <React.Fragment key={index}>\n                {pageNumber === '...' ? (\n                  <span className=\"px-3 py-2 text-gray-500\">...</span>\n                ) : (\n                  <button\n                    onClick={() => goToPage(pageNumber as number)}\n                    className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                      currentPage === pageNumber\n                        ? 'bg-blue-600 text-white'\n                        : 'border border-gray-300 text-gray-700 hover:bg-gray-50'\n                    }`}\n                  >\n                    {pageNumber}\n                  </button>\n                )}\n              </React.Fragment>\n            ))}\n          </div>\n\n          {/*  */}\n          <button\n            onClick={goToNextPage}\n            disabled={currentPage === totalPages}\n            className=\"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\"\n            title=\"\"\n          >\n            <ChevronRight className=\"w-4 h-4\" />\n          </button>\n\n          {/*  */}\n          <button\n            onClick={goToLastPage}\n            disabled={currentPage === totalPages}\n            className=\"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\"\n            title=\"\"\n          >\n            <ChevronsRight className=\"w-4 h-4\" />\n          </button>\n        </div>\n      )}\n\n      {/*  */}\n      <div className=\"flex items-center justify-center space-x-2 text-sm\">\n        <span className=\"text-gray-600\">:</span>\n        <select\n          value={itemsPerPage}\n          onChange={(e) => {\n            const newItemsPerPage = parseInt(e.target.value);\n            // 1\n            setCurrentPage(1);\n          }}\n          className=\"border border-gray-300 rounded px-2 py-1\"\n        >\n          <option value={10}>10</option>\n          <option value={20}>20</option>\n          <option value={50}>50</option>\n          <option value={100}>100</option>\n        </select>\n      </div>\n    </div>\n  );\n}","import React, { useState, useEffect } from 'react';\nimport { User, Team, supabase } from '../lib/supabase';\nimport { X, Save, AlertCircle, CheckCircle, AlertTriangle, Users } from 'lucide-react';\n\ninterface UserEditModalProps {\n  user: User;\n  teams: Team[];\n  onClose: () => void;\n  onUserUpdated: () => void;\n}\n\nexport function UserEditModal({ user, teams, onClose, onUserUpdated }: UserEditModalProps) {\n  const [formData, setFormData] = useState({\n    name: user.name,\n    email: user.email,\n    role: user.role,\n    teamId: user.team_id || ''\n  });\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\n  const [staffTeams, setStaffTeams] = useState<Team[]>([]);\n  const [isMultiTeamStaff, setIsMultiTeamStaff] = useState(false);\n\n  // Fetch current teams for staff users\n  useEffect(() => {\n    if (user.role === 'staff') {\n      fetchStaffTeams();\n    }\n  }, [user.id, user.role]);\n\n  const fetchStaffTeams = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('staff_team_links')\n        .select(`\n          team_id,\n          teams (\n            id,\n            name\n          )\n        `)\n        .eq('staff_user_id', user.id);\n\n      if (error) {\n        console.error('Error fetching staff teams:', error);\n        return;\n      }\n\n      const userTeams = data?.map(link => link.teams).filter(Boolean) as Team[];\n      setStaffTeams(userTeams || []);\n      setIsMultiTeamStaff((userTeams || []).length > 1);\n\n      // Set the first team as default if multiple teams exist\n      if (userTeams && userTeams.length > 0) {\n        setFormData(prev => ({ ...prev, teamId: userTeams[0].id }));\n      }\n    } catch (error) {\n      console.error('Error fetching staff teams:', error);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setMessage(null);\n\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        throw new Error('');\n      }\n\n      // Call the update-user Edge Function\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n\n      const response = await fetch(`${supabaseUrl}/functions/v1/update-user`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          userId: user.id,\n          name: formData.name,\n          email: formData.email,\n          role: formData.role,\n          teamId: formData.teamId || undefined\n        }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || '');\n      }\n\n      setMessage({\n        type: 'success',\n        text: ''\n      });\n\n      setTimeout(() => {\n        onUserUpdated();\n      }, 1000);\n\n    } catch (error: any) {\n      console.error('Error updating user:', error);\n      setMessage({\n        type: 'error',\n        text: `: ${error.message}`\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"bg-blue-600 text-white p-6 rounded-t-2xl\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-bold\"></h2>\n            <button\n              onClick={onClose}\n              className=\"bg-blue-500 hover:bg-blue-400 rounded-full p-2 transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6\">\n          {/* Multi-team Staff Warning */}\n          {isMultiTeamStaff && (\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6\">\n              <div className=\"flex items-start\">\n                <AlertTriangle className=\"w-5 h-5 text-amber-600 mr-3 mt-0.5 flex-shrink-0\" />\n                <div className=\"flex-1\">\n                  <h3 className=\"font-medium text-amber-900 mb-2 flex items-center\">\n                    <Users className=\"w-4 h-4 mr-1\" />\n                    \n                  </h3>\n                  <div className=\"text-sm text-amber-700 space-y-2\">\n                    <p></p>\n                    <div className=\"bg-amber-100 rounded p-2\">\n                      {staffTeams.map((team, index) => (\n                        <div key={team.id} className=\"flex items-center\">\n                          <span className=\"w-2 h-2 bg-amber-600 rounded-full mr-2\"></span>\n                          <span className=\"font-medium\">{team.name}</span>\n                        </div>\n                      ))}\n                    </div>\n                    <div className=\"bg-white border border-amber-300 rounded p-3 mt-3\">\n                      <p className=\"font-medium text-amber-900 mb-1\"> </p>\n                      <ul className=\"text-xs space-y-1\">\n                        <li> </li>\n                        <li> Supabase</li>\n                        <li> </li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n              </label>\n              <input\n                type=\"text\"\n                value={formData.name}\n                onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n              </label>\n              <input\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n                {isMultiTeamStaff && (\n                  <span className=\"ml-2 text-xs text-amber-600 font-normal\">\n                     \n                  </span>\n                )}\n              </label>\n              <select\n                value={formData.role}\n                onChange={(e) => {\n                  const newRole = e.target.value as 'athlete' | 'staff' | 'global_admin';\n                  setFormData(prev => ({ \n                    ...prev, \n                    role: newRole,\n                    teamId: newRole === 'global_admin' ? '' : prev.teamId\n                  }));\n                }}\n                className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${\n                  isMultiTeamStaff ? 'border-amber-300 bg-amber-50' : 'border-gray-300'\n                }`}\n              >\n                <option value=\"athlete\"></option>\n                <option value=\"staff\"></option>\n                <option value=\"global_admin\"></option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                \n                {isMultiTeamStaff && formData.role === 'staff' && (\n                  <span className=\"ml-2 text-xs text-amber-600 font-normal\">\n                     \n                  </span>\n                )}\n              </label>\n              <select\n                value={formData.teamId}\n                onChange={(e) => setFormData(prev => ({ ...prev, teamId: e.target.value }))}\n                className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${\n                  isMultiTeamStaff && formData.role === 'staff' ? 'border-amber-300 bg-amber-50' : 'border-gray-300'\n                }`}\n                required={formData.role === 'athlete'}\n                disabled={formData.role === 'global_admin'}\n              >\n                <option value=\"\">\n                  {formData.role === 'global_admin' ? '' : ''}\n                </option>\n                {teams.map(team => (\n                  <option key={team.id} value={team.id}>{team.name}</option>\n                ))}\n              </select>\n              {formData.role === 'global_admin' && (\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  \n                </p>\n              )}\n              {formData.role === 'staff' && !isMultiTeamStaff && (\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  \n                </p>\n              )}\n              {isMultiTeamStaff && formData.role === 'staff' && (\n                <p className=\"text-xs text-amber-600 mt-1\">\n                  Supabase\n                </p>\n              )}\n            </div>\n\n            {message && (\n              <div className={`flex items-center space-x-3 p-3 rounded-lg ${\n                message.type === 'success' \n                  ? 'bg-green-50 border border-green-200 text-green-600'\n                  : 'bg-red-50 border border-red-200 text-red-600'\n              }`}>\n                {message.type === 'success' ? (\n                  <CheckCircle className=\"w-5 h-5 flex-shrink-0\" />\n                ) : (\n                  <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\n                )}\n                <span className=\"text-sm\">{message.text}</span>\n              </div>\n            )}\n\n            <div className=\"flex space-x-3 pt-4\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors\"\n              >\n                \n              </button>\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className={`flex-1 py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center ${\n                  isMultiTeamStaff \n                    ? 'bg-amber-600 hover:bg-amber-700 text-white' \n                    : 'bg-blue-600 hover:bg-blue-700 text-white'\n                }`}\n              >\n                {loading ? (\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                ) : (\n                  <Save className=\"w-4 h-4 mr-2\" />\n                )}\n                {loading ? '...' : (isMultiTeamStaff ? '' : '')}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useState } from 'react';\nimport { User, supabase } from '../lib/supabase';\nimport { X, Trash2, AlertTriangle, CheckCircle } from 'lucide-react';\n\ninterface UserDeleteModalProps {\n  user: User;\n  onClose: () => void;\n  onUserDeleted: () => void;\n}\n\nexport function UserDeleteModal({ user, onClose, onUserDeleted }: UserDeleteModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [confirmText, setConfirmText] = useState('');\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\n\n  const handleDelete = async () => {\n    if (confirmText !== user.name) {\n      setMessage({\n        type: 'error',\n        text: ''\n      });\n      return;\n    }\n\n    setLoading(true);\n    setMessage(null);\n\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        throw new Error('');\n      }\n\n      // Call the delete user function\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n\n      const response = await fetch(`${supabaseUrl}/functions/v1/delete-user`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          userId: user.id\n        }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || '');\n      }\n\n      setMessage({\n        type: 'success',\n        text: ''\n      });\n\n      setTimeout(() => {\n        onUserDeleted();\n      }, 1000);\n\n    } catch (error: any) {\n      console.error('Error deleting user:', error);\n      setMessage({\n        type: 'error',\n        text: `: ${error.message}`\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-2xl shadow-xl max-w-md w-full\">\n        {/* Header */}\n        <div className=\"bg-red-600 text-white p-6 rounded-t-2xl\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center\">\n              <AlertTriangle className=\"w-6 h-6 mr-3\" />\n              <h2 className=\"text-xl font-bold\"></h2>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"bg-red-500 hover:bg-red-400 rounded-full p-2 transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6\">\n          <div className=\"mb-6\">\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-4\">\n              <div className=\"flex items-start\">\n                <AlertTriangle className=\"w-5 h-5 text-red-600 mr-2 mt-0.5\" />\n                <div>\n                  <h3 className=\"font-medium text-red-900 mb-2\">: </h3>\n                  <div className=\"text-sm text-red-700 space-y-1\">\n                    <p> </p>\n                    <p> </p>\n                    <p> </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-gray-50 rounded-lg p-4\">\n              <h4 className=\"font-medium text-gray-900 mb-2\"></h4>\n              <div className=\"text-sm text-gray-700\">\n                <p><strong>:</strong> {user.name}</p>\n                <p><strong>:</strong> {user.email}</p>\n                <p><strong>:</strong> {\n                  user.role === 'athlete' ? '' : \n                  user.role === 'staff' ? '' : ''\n                }</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mb-6\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              <strong>{user.name}</strong>\n            </label>\n            <input\n              type=\"text\"\n              value={confirmText}\n              onChange={(e) => setConfirmText(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent\"\n              placeholder={user.name}\n            />\n          </div>\n\n          {message && (\n            <div className={`flex items-center space-x-3 p-3 rounded-lg mb-4 ${\n              message.type === 'success' \n                ? 'bg-green-50 border border-green-200 text-green-600'\n                : 'bg-red-50 border border-red-200 text-red-600'\n            }`}>\n              {message.type === 'success' ? (\n                <CheckCircle className=\"w-5 h-5 flex-shrink-0\" />\n              ) : (\n                <AlertTriangle className=\"w-5 h-5 flex-shrink-0\" />\n              )}\n              <span className=\"text-sm\">{message.text}</span>\n            </div>\n          )}\n\n          <div className=\"flex space-x-3\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors\"\n            >\n              \n            </button>\n            <button\n              onClick={handleDelete}\n              disabled={loading || confirmText !== user.name}\n              className=\"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\n            >\n              {loading ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n              ) : (\n                <Trash2 className=\"w-4 h-4 mr-2\" />\n              )}\n              {loading ? '...' : ''}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useState, useEffect, useCallback } from 'react';\nimport { User, Team, supabase } from '../lib/supabase';\nimport { PaginatedTable } from './PaginatedTable';\nimport { UserEditModal } from './UserEditModal';\nimport { UserDeleteModal } from './UserDeleteModal';\nimport { Users, Edit, Trash2, AlertCircle, Search, Filter } from 'lucide-react';\n\ninterface UserManagementProps {\n  teams: Team[];\n  restrictToOrganizationId?: string;\n}\n\nexport function UserManagement({ teams, restrictToOrganizationId }: UserManagementProps) {\n  const [users, setUsers] = useState<User[]>([]);\n  const [filteredUsers, setFilteredUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [roleFilter, setRoleFilter] = useState<string>('all');\n\n  const fetchUsers = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      if (restrictToOrganizationId) {\n        // Fetch users belonging to the restricted organization\n        const { data: orgMembers, error: orgError } = await supabase\n          .from('organization_members')\n          .select('user_id')\n          .eq('organization_id', restrictToOrganizationId);\n\n        if (orgError) throw orgError;\n\n        const userIds = orgMembers?.map(m => m.user_id) || [];\n\n        if (userIds.length === 0) {\n          setUsers([]);\n          return;\n        }\n\n        const { data, error } = await supabase\n          .from('users')\n          .select('*')\n          .in('id', userIds)\n          .neq('role', 'global_admin')\n          .order('created_at', { ascending: false });\n\n        if (error) throw error;\n        setUsers(data || []);\n      } else {\n        // Fetch all users (admin view)\n        const { data, error } = await supabase\n          .from('users')\n          .select('*')\n          .order('created_at', { ascending: false });\n\n        if (error) throw error;\n        setUsers(data || []);\n      }\n    } catch (err: any) {\n      console.error('Error fetching users:', err);\n      setError(': ' + err.message);\n    } finally {\n      setLoading(false);\n    }\n  }, [restrictToOrganizationId]);\n\n  useEffect(() => {\n    fetchUsers();\n  }, [fetchUsers]);\n\n  // Filter users based on search term and role filter\n  useEffect(() => {\n    let filtered = users;\n\n    // Apply search filter\n    if (searchTerm) {\n      filtered = filtered.filter(user =>\n        user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (user.user_id && user.user_id.toLowerCase().includes(searchTerm.toLowerCase()))\n      );\n    }\n\n    // Apply role filter\n    if (roleFilter !== 'all') {\n      filtered = filtered.filter(user => user.role === roleFilter);\n    }\n\n    setFilteredUsers(filtered);\n  }, [users, searchTerm, roleFilter]);\n\n  const handleUserUpdated = () => {\n    setShowEditModal(false);\n    setSelectedUser(null);\n    fetchUsers();\n  };\n\n  const handleUserDeleted = () => {\n    setShowDeleteModal(false);\n    setSelectedUser(null);\n    fetchUsers();\n  };\n\n  const handleEditClick = (user: User) => {\n    setSelectedUser(user);\n    setShowEditModal(true);\n  };\n\n  const handleDeleteClick = (user: User) => {\n    setSelectedUser(user);\n    setShowDeleteModal(true);\n  };\n\n  const getTeamName = (teamId: string | null) => {\n    if (!teamId) return '-';\n    const team = teams.find(t => t.id === teamId);\n    return team ? team.name : '';\n  };\n\n  const getRoleLabel = (role: string) => {\n    switch (role) {\n      case 'athlete': return '';\n      case 'staff': return '';\n      case 'global_admin': return '';\n      default: return role;\n    }\n  };\n\n  const getRoleBadgeStyle = (role: string) => {\n    switch (role) {\n      case 'global_admin': return 'bg-purple-100 text-purple-800';\n      case 'staff': return 'bg-green-100 text-green-800';\n      case 'athlete': return 'bg-blue-100 text-blue-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const renderUserRow = (user: User, index: number) => (\n    <div key={user.id} className=\"bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\">\n      {/* Mobile Layout */}\n      <div className=\"block sm:hidden space-y-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center space-x-2 mb-1\">\n              <span className=\"font-mono text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded\">\n                {user.user_id || 'N/A'}\n              </span>\n              <span className={`px-2 py-1 rounded-full text-xs font-medium ${getRoleBadgeStyle(user.role)}`}>\n                {getRoleLabel(user.role)}\n              </span>\n            </div>\n            <h3 className=\"font-semibold text-gray-900 truncate\">{user.name}</h3>\n            <p className=\"text-sm text-gray-600 truncate\">{user.email}</p>\n            <p className=\"text-xs text-gray-500\">{getTeamName(user.team_id)}</p>\n          </div>\n          <div className=\"flex space-x-2 ml-2\">\n            <button\n              onClick={() => handleEditClick(user)}\n              className=\"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors\"\n              title=\"\"\n            >\n              <Edit className=\"w-4 h-4\" />\n            </button>\n            <button\n              onClick={() => handleDeleteClick(user)}\n              className=\"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors\"\n              title=\"\"\n            >\n              <Trash2 className=\"w-4 h-4\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Desktop Layout */}\n      <div className=\"hidden sm:grid grid-cols-6 gap-4 items-center\">\n        {/* User ID */}\n        <div>\n          <div className=\"text-xs font-medium text-gray-500 mb-1\">ID</div>\n          <div className=\"font-mono text-sm bg-gray-100 text-gray-700 px-2 py-1 rounded inline-block\">\n            {user.user_id || 'N/A'}\n          </div>\n        </div>\n        \n        {/* Name */}\n        <div>\n          <div className=\"text-xs font-medium text-gray-500 mb-1\"></div>\n          <div className=\"font-semibold text-gray-900\">{user.name}</div>\n        </div>\n        \n        {/* Email */}\n        <div>\n          <div className=\"text-xs font-medium text-gray-500 mb-1\"></div>\n          <div className=\"text-sm text-gray-700 break-all\">{user.email}</div>\n        </div>\n        \n        {/* Role */}\n        <div>\n          <div className=\"text-xs font-medium text-gray-500 mb-1\"></div>\n          <span className={`px-2 py-1 rounded-full text-xs font-medium ${getRoleBadgeStyle(user.role)}`}>\n            {getRoleLabel(user.role)}\n          </span>\n        </div>\n        \n        {/* Team */}\n        <div>\n          <div className=\"text-xs font-medium text-gray-500 mb-1\"></div>\n          <div className=\"text-sm text-gray-700\">{getTeamName(user.team_id)}</div>\n        </div>\n        \n        {/* Actions */}\n        <div className=\"flex justify-end space-x-2\">\n          <button\n            onClick={() => handleEditClick(user)}\n            className=\"p-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors\"\n            title=\"\"\n          >\n            <Edit className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={() => handleDeleteClick(user)}\n            className=\"p-2 rounded-full bg-red-50 hover:bg-red-100 text-red-600 transition-colors\"\n            title=\"\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-3\">\n          <Users className=\"w-6 h-6 text-purple-600\" />\n          <h2 className=\"text-xl font-semibold text-gray-900\"></h2>\n        </div>\n        <div className=\"text-sm text-gray-600\">\n          {users.length}\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          {/* Search */}\n          <div className=\"flex-1\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"ID...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              />\n            </div>\n          </div>\n\n          {/* Role Filter */}\n          <div className=\"sm:w-48\">\n            <div className=\"relative\">\n              <Filter className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n              <select\n                value={roleFilter}\n                onChange={(e) => setRoleFilter(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none\"\n              >\n                <option value=\"all\"></option>\n                <option value=\"global_admin\"></option>\n                <option value=\"staff\"></option>\n                <option value=\"athlete\"></option>\n              </select>\n            </div>\n          </div>\n        </div>\n\n        {/* Filter Summary */}\n        {(searchTerm || roleFilter !== 'all') && (\n          <div className=\"mt-3 pt-3 border-t border-gray-200\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <div className=\"text-gray-600\">\n                : {filteredUsers.length}\n                {searchTerm && (\n                  <span className=\"ml-2\">\n                    {searchTerm}\n                  </span>\n                )}\n                {roleFilter !== 'all' && (\n                  <span className=\"ml-2\">\n                    : {getRoleLabel(roleFilter)}\n                  </span>\n                )}\n              </div>\n              <button\n                onClick={() => {\n                  setSearchTerm('');\n                  setRoleFilter('all');\n                }}\n                className=\"text-blue-600 hover:text-blue-700 underline\"\n              >\n                \n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Error Display */}\n      {error && (\n        <div className=\"flex items-center space-x-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600\">\n          <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />\n          <span className=\"text-sm\">{error}</span>\n        </div>\n      )}\n\n      {/* User Statistics */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-4 gap-4\">\n        <div className=\"bg-purple-50 border border-purple-200 rounded-lg p-4 text-center\">\n          <div className=\"text-2xl font-bold text-purple-600\">\n            {users.filter(u => u.role === 'global_admin').length}\n          </div>\n          <div className=\"text-sm text-purple-700\"></div>\n        </div>\n        <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 text-center\">\n          <div className=\"text-2xl font-bold text-green-600\">\n            {users.filter(u => u.role === 'staff').length}\n          </div>\n          <div className=\"text-sm text-green-700\"></div>\n        </div>\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center\">\n          <div className=\"text-2xl font-bold text-blue-600\">\n            {users.filter(u => u.role === 'athlete').length}\n          </div>\n          <div className=\"text-sm text-blue-700\"></div>\n        </div>\n        <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center\">\n          <div className=\"text-2xl font-bold text-gray-600\">\n            {users.length}\n          </div>\n          <div className=\"text-sm text-gray-700\"></div>\n        </div>\n      </div>\n\n      {/* User Table */}\n      <div className=\"bg-white border border-gray-200 rounded-lg\">\n        <div className=\"p-4 border-b border-gray-200\">\n          <h3 className=\"font-medium text-gray-900\"></h3>\n        </div>\n        \n        <div className=\"p-4\">\n          <PaginatedTable\n            data={filteredUsers}\n            itemsPerPage={10}\n            renderItem={renderUserRow}\n            loading={loading}\n            emptyMessage={\n              searchTerm || roleFilter !== 'all' \n                ? \"\"\n                : \"\"\n            }\n          />\n        </div>\n      </div>\n\n      {/* Modals */}\n      {selectedUser && showEditModal && (\n        <UserEditModal\n          user={selectedUser}\n          teams={teams}\n          onClose={() => {\n            setShowEditModal(false);\n            setSelectedUser(null);\n          }}\n          onUserUpdated={handleUserUpdated}\n        />\n      )}\n\n      {selectedUser && showDeleteModal && (\n        <UserDeleteModal\n          user={selectedUser}\n          onClose={() => {\n            setShowDeleteModal(false);\n            setSelectedUser(null);\n          }}\n          onUserDeleted={handleUserDeleted}\n        />\n      )}\n    </div>\n  );\n}","import React, { useEffect, useMemo, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\nimport { Activity, RefreshCw, AlertTriangle, Info } from \"lucide-react\";\n\ntype ActivityLevel = \"low\" | \"medium\" | \"high\" | \"elite\";\n\ntype MetabolismResult = {\n  weight: number;\n  body_fat_percent: number | null;\n  lean_mass: number | null;\n  bmr: number;\n  tdee: number;\n};\n\nexport function NutritionDev() {\n  const [activityLevel, setActivityLevel] = useState<ActivityLevel>(\"high\");\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [result, setResult] = useState<MetabolismResult | null>(null);\n\n  const [avg7d, setAvg7d] = useState<any>(null);\n  const [loadingAvg, setLoadingAvg] = useState(false);\n  const [avgErr, setAvgErr] = useState<string | null>(null);\n\n  // Edge Function endpoint\n  const endpoint = useMemo(() => {\n    const base = (import.meta as any).env?.VITE_SUPABASE_URL;\n    return base\n      ? `${base}/functions/v1/calculate-metabolism`\n      : \"/functions/v1/calculate-metabolism\";\n  }, []);\n\n  // -----------------------------\n  // \n  // -----------------------------\n  const fetchMetabolism = async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const { data: auth } = await supabase.auth.getUser();\n      const userId = auth?.user?.id;\n      if (!userId) throw new Error(\"\");\n\n      const { data: sessionData } = await supabase.auth.getSession();\n      const accessToken = sessionData?.session?.access_token;\n      if (!accessToken) throw new Error(\"\");\n\n      const res = await fetch(endpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${accessToken}`,\n        },\n        body: JSON.stringify({\n          activity_level: activityLevel,\n        }),\n      });\n\n      const json = await res.json();\n      if (!res.ok) throw new Error(json?.error ?? \"Edge Function error\");\n\n      setResult(json);\n\n      // 7\n      await fetchMetabolism7dAvg(userId);\n    } catch (e: any) {\n      setError(String(e?.message ?? e));\n      setResult(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // -----------------------------\n  // 7View\n  // -----------------------------\n  const fetchMetabolism7dAvg = async (userId: string) => {\n    setLoadingAvg(true);\n    setAvgErr(null);\n\n    try {\n      const { data, error } = await supabase\n        .from(\"nutrition_metabolism_7d_avg\")\n        .select(\"*\")\n        .eq(\"user_id\", userId)\n        .single();\n\n      if (error) throw error;\n      setAvg7d(data);\n    } catch (e: any) {\n      setAvgErr(String(e?.message ?? e));\n      setAvg7d(null);\n    } finally {\n      setLoadingAvg(false);\n    }\n  };\n\n  // -----------------------------\n  // \n  // -----------------------------\n  const diffKcal = useMemo(() => {\n    if (!result || !avg7d) return null;\n    return result.tdee - avg7d.avg_tdee;\n  }, [result, avg7d]);\n\n  const diffMessage = useMemo(() => {\n    if (diffKcal === null) return null;\n    if (diffKcal > 150) return \"\";\n    if (diffKcal > 50) return \"\";\n    if (diffKcal < -150) return \"\";\n    if (diffKcal < -50) return \"\";\n    return \"\";\n  }, [diffKcal]);\n\n  useEffect(() => {\n    fetchMetabolism();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between gap-3 mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <Activity className=\"w-5 h-5 text-indigo-600\" />\n          <h2 className=\"text-lg font-semibold text-gray-900\">\n            \n          </h2>\n        </div>\n\n        <button\n          onClick={fetchMetabolism}\n          disabled={loading}\n          className=\"inline-flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50\"\n        >\n          <RefreshCw className={`w-4 h-4 ${loading ? \"animate-spin\" : \"\"}`} />\n          \n        </button>\n      </div>\n\n      {/* Controls */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center gap-3 mb-4\">\n        <div className=\"text-sm text-gray-600 flex items-center gap-2\">\n          <Info className=\"w-4 h-4 text-gray-400\" />\n          InBody  LBM  BMR  TDEE\n        </div>\n\n        <div className=\"sm:ml-auto flex items-center gap-2\">\n          <span className=\"text-xs text-gray-500\"></span>\n          <select\n            value={activityLevel}\n            onChange={(e) => setActivityLevel(e.target.value as ActivityLevel)}\n            className=\"px-3 py-2 text-sm border border-gray-300 rounded-lg\"\n          >\n            <option value=\"low\">low</option>\n            <option value=\"medium\">medium</option>\n            <option value=\"high\">high</option>\n            <option value=\"elite\">elite</option>\n          </select>\n\n          <button\n            onClick={fetchMetabolism}\n            disabled={loading}\n            className=\"px-3 py-2 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50\"\n          >\n            \n          </button>\n        </div>\n      </div>\n\n      {/* Error */}\n      {error && (\n        <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700 flex items-start gap-2\">\n          <AlertTriangle className=\"w-4 h-4 mt-0.5\" />\n          <div>{error}</div>\n        </div>\n      )}\n\n      {/* Result */}\n      {result && (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4\">\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <div className=\"text-xs text-gray-500\"></div>\n            <div className=\"text-2xl font-bold\">{result.weight} kg</div>\n          </div>\n\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <div className=\"text-xs text-gray-500\"></div>\n            <div className=\"text-2xl font-bold\">\n              {result.body_fat_percent ?? \"\"}%\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <div className=\"text-xs text-gray-500\">LBM</div>\n            <div className=\"text-2xl font-bold\">\n              {result.lean_mass ?? \"\"} kg\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <div className=\"text-xs text-gray-500\">BMR</div>\n            <div className=\"text-2xl font-bold\">{result.bmr} kcal</div>\n          </div>\n\n          <div className=\"bg-indigo-50 p-4 rounded-lg sm:col-span-2\">\n            <div className=\"text-xs text-indigo-700\">TDEE</div>\n            <div className=\"text-3xl font-extrabold text-indigo-900\">\n              {result.tdee} kcal\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* 7 */}\n      {loadingAvg && (\n        <div className=\"text-sm text-gray-500\">7...</div>\n      )}\n\n      {avgErr && (\n        <div className=\"text-sm text-yellow-700\">\n          7: {avgErr}\n        </div>\n      )}\n\n      {avg7d && result && diffKcal !== null && (\n        <div className=\"border rounded-lg p-4 bg-white\">\n          <div className=\"font-semibold mb-2\">\n            7\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-3 text-sm\">\n            <div>\n              <div className=\"text-gray-500\"></div>\n              <div className=\"font-bold\">{result.tdee} kcal</div>\n            </div>\n            <div>\n              <div className=\"text-gray-500\">7</div>\n              <div className=\"font-bold\">{avg7d.avg_tdee} kcal</div>\n            </div>\n            <div>\n              <div className=\"text-gray-500\"></div>\n              <div\n                className={`font-bold ${\n                  diffKcal > 0\n                    ? \"text-red-600\"\n                    : diffKcal < 0\n                    ? \"text-blue-600\"\n                    : \"text-gray-700\"\n                }`}\n              >\n                {diffKcal > 0 && \"+\"}\n                {diffKcal} kcal\n              </div>\n            </div>\n          </div>\n\n          <div className=\"text-xs text-gray-600 mt-2\">\n            <span className=\"font-semibold\">{diffMessage}</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default NutritionDev;","// src/components/NutritionPhotoUploader.tsx\nimport React, { useMemo, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\n\ntype MealType = \"\" | \"\" | \"\" | \"\";\n\nfunction formatTokyoDate(d = new Date()) {\n  const parts = d\n    .toLocaleDateString(\"ja-JP\", { timeZone: \"Asia/Tokyo\" })\n    .split(\"/\");\n  return `${parts[0]}-${parts[1].padStart(2, \"0\")}-${parts[2].padStart(2, \"0\")}`;\n}\n\nasync function fileToBase64(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      const res = reader.result as string;\n      resolve(res.split(\",\")[1]); // base64\n    };\n    reader.onerror = reject;\n    reader.readAsDataURL(file);\n  });\n}\n\nexport default function NutritionPhotoUploader() {\n  const [mealType, setMealType] = useState<MealType>(\"\");\n  const [mealSlot, setMealSlot] = useState(1);\n  const [recordDate, setRecordDate] = useState(formatTokyoDate());\n  const [file, setFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [msg, setMsg] = useState(\"\");\n\n  const bucket = \"nutrition-images\";\n\n  const previewUrl = useMemo(\n    () => (file ? URL.createObjectURL(file) : \"\"),\n    [file]\n  );\n\n  const handleUploadAndAnalyze = async () => {\n    if (!file) return setMsg(\"\");\n\n    setUploading(true);\n    setMsg(\"\");\n\n    try {\n      /** 1 user */\n      const { data: auth } = await supabase.auth.getUser();\n      const userId = auth?.user?.id;\n      if (!userId) throw new Error(\"\");\n\n      /** 2 Storage upload */\n      const ext = file.name.split(\".\").pop() || \"jpg\";\n      const uuid = crypto.randomUUID();\n      const path = `nutrition/${userId}/${recordDate}/${uuid}.${ext}`;\n\n      const { error: uploadErr } = await supabase.storage\n        .from(bucket)\n        .upload(path, file, { contentType: file.type });\n\n      if (uploadErr) throw uploadErr;\n\n      const { data: pub } = supabase.storage.from(bucket).getPublicUrl(path);\n\n      /** 3 nutrition_logs INSERT */\n      const { data: log, error: insErr } = await supabase\n        .from(\"nutrition_logs\")\n        .insert({\n          user_id: userId,\n          record_date: recordDate,\n          meal_type: mealType,\n          meal_slot: mealSlot,\n          image_path: path,\n          image_url: pub.publicUrl,\n        })\n        .select()\n        .single();\n\n      if (insErr) throw insErr;\n\n      /** 4 base64  nutrition-analyze */\n      const base64 = await fileToBase64(file);\n\n      const { data: session } = await supabase.auth.getSession();\n      const res = await fetch(\n        `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/nutrition-analyze`,\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${session?.session?.access_token}`,\n          },\n          body: JSON.stringify({\n            meal_type: mealType,\n            image_base64: base64,\n            mime_type: file.type,\n            user_name: \"user\",\n          }),\n        }\n      );\n\n      const json = await res.json();\n      if (!res.ok) throw new Error(json.error);\n\n      /** 5 AI UPDATE */\n      await supabase\n        .from(\"nutrition_logs\")\n        .update({\n          total_calories: json.result.total_calories,\n          p: json.result.nutrients.p,\n          f: json.result.nutrients.f,\n          c: json.result.nutrients.c,\n          menu_items: json.result.menu_items,\n          advice_markdown: json.result.advice_markdown,\n        })\n        .eq(\"id\", log.id);\n\n      setMsg(\" AI \");\n      setFile(null);\n    } catch (e: any) {\n      console.error(e);\n      setMsg(` ${e.message}`);\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"bg-white border rounded-xl p-4 space-y-4\">\n      <div className=\"text-lg font-semibold\"> </div>\n  \n      {/*  */}\n      <div>\n        <div className=\"text-xs text-gray-500 mb-1\"></div>\n        <input\n          className=\"w-full border rounded-lg px-3 py-2 text-sm\"\n          value={recordDate}\n          onChange={(e) => setRecordDate(e.target.value)}\n        />\n      </div>\n  \n      {/*  */}\n      <div>\n        <div className=\"text-xs text-gray-500 mb-1\"></div>\n        <select\n          className=\"w-full border rounded-lg px-3 py-2 text-sm\"\n          value={mealType}\n          onChange={(e) => {\n            const v = e.target.value as MealType;\n            setMealType(v);\n            //  slot=1 \n            if (v !== \"\") setMealSlot(1);\n          }}\n        >\n          <option value=\"\"></option>\n          <option value=\"\"></option>\n          <option value=\"\"></option>\n          <option value=\"\"></option>\n        </select>\n      </div>\n  \n      {/*  */}\n      <div>\n        <div className=\"text-xs text-gray-500 mb-1\"></div>\n        <select\n          className=\"w-full border rounded-lg px-3 py-2 text-sm\"\n          value={mealSlot}\n          disabled={mealType !== \"\"}\n          onChange={(e) => setMealSlot(Number(e.target.value))}\n        >\n          <option value={1}>1</option>\n          <option value={2}>2</option>\n        </select>\n        <div className=\"text-[11px] text-gray-500 mt-1\">\n            1 / 2 1 \n        </div>\n      </div>\n  \n      {/*  */}\n      <div className=\"space-y-2\">\n        <input\n          type=\"file\"\n          accept=\"image/*\"\n          onChange={(e) => setFile(e.target.files?.[0] ?? null)}\n        />\n        {previewUrl && (\n          <img src={previewUrl} className=\"max-h-60 rounded border\" />\n        )}\n      </div>\n  \n      {/*  */}\n      <button\n        onClick={handleUploadAndAnalyze}\n        disabled={uploading || !file}\n        className=\"px-4 py-2 bg-indigo-600 text-white rounded disabled:opacity-50\"\n      >\n        {uploading ? \"...\" : \"\"}\n      </button>\n  \n      {msg && <div className=\"text-sm\">{msg}</div>}\n    </div>\n  );\n}","import React, { useState } from 'react';\nimport { useOrganizations, useOrganizationTeams } from '../hooks/useOrganizations';\nimport { Building2, Plus, Edit2, Trash2, Users } from 'lucide-react';\nimport type { Database } from '../lib/database.types';\n\ntype Organization = Database['public']['Tables']['organizations']['Row'];\ntype Team = Database['public']['Tables']['teams']['Row'];\n\ninterface OrganizationManagementProps {\n  userId: string;\n}\n\nexport function OrganizationManagement({ userId }: OrganizationManagementProps) {\n  const { organizations, loading, error, createOrganization, updateOrganization, deleteOrganization } = useOrganizations(userId);\n  const [selectedOrgId, setSelectedOrgId] = useState<string | undefined>();\n  const [showCreateOrgModal, setShowCreateOrgModal] = useState(false);\n  const [showCreateTeamModal, setShowCreateTeamModal] = useState(false);\n  const [editingOrg, setEditingOrg] = useState<Organization | null>(null);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"flex-shrink-0\">\n            <svg className=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\n            </svg>\n          </div>\n          <div className=\"flex-1\">\n            <h3 className=\"text-sm font-medium text-red-800 mb-2\"></h3>\n            <p className=\"text-sm text-red-700 mb-3\">{error}</p>\n            <details className=\"text-xs text-red-600\">\n              <summary className=\"cursor-pointer hover:text-red-800 font-medium mb-1\"></summary>\n              <div className=\"mt-2 bg-red-100 p-2 rounded border border-red-200 font-mono\">\n                <p>User ID: {userId}</p>\n                <p>Error: {error}</p>\n                <p className=\"mt-2 text-red-700\">\n                  :\n                  <br /> RLS\n                  <br /> role\n                  <br /> auth.uid()users.id\n                </p>\n              </div>\n            </details>\n            <button\n              onClick={() => window.location.reload()}\n              className=\"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm\"\n            >\n              \n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\n            <Building2 className=\"h-6 w-6\" />\n            \n          </h2>\n          <p className=\"text-gray-600 mt-1\"></p>\n        </div>\n        <button\n          onClick={() => setShowCreateOrgModal(true)}\n          className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          \n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className=\"bg-white rounded-lg shadow-sm border\">\n          <div className=\"p-6 border-b\">\n            <h3 className=\"text-lg font-semibold text-gray-900\"></h3>\n          </div>\n          <div className=\"divide-y\">\n            {organizations.length === 0 ? (\n              <div className=\"p-6 text-center text-gray-500\">\n                \n              </div>\n            ) : (\n              organizations.map((org) => (\n                <OrganizationCard\n                  key={org.id}\n                  organization={org}\n                  isSelected={selectedOrgId === org.id}\n                  onSelect={() => setSelectedOrgId(org.id)}\n                  onEdit={() => setEditingOrg(org)}\n                  onDelete={async () => {\n                    if (confirm(`${org.name}`)) {\n                      try {\n                        await deleteOrganization(org.id);\n                        if (selectedOrgId === org.id) {\n                          setSelectedOrgId(undefined);\n                        }\n                      } catch (err) {\n                        alert(': ' + (err instanceof Error ? err.message : 'Unknown error'));\n                      }\n                    }\n                  }}\n                />\n              ))\n            )}\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow-sm border\">\n          {selectedOrgId ? (\n            <TeamPanel\n              organizationId={selectedOrgId}\n              onCreateClick={() => setShowCreateTeamModal(true)}\n            />\n          ) : (\n            <div className=\"p-6 text-center text-gray-500\">\n              \n            </div>\n          )}\n        </div>\n      </div>\n\n      {showCreateOrgModal && (\n        <CreateOrganizationModal\n          onClose={() => setShowCreateOrgModal(false)}\n          onCreate={async (name, description) => {\n            try {\n              await createOrganization(name, description);\n\n              // \n              const notification = document.createElement('div');\n              notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2';\n              notification.innerHTML = `\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\n                </svg>\n                <span>${name}</span>\n              `;\n              document.body.appendChild(notification);\n\n              // 3\n              setTimeout(() => {\n                notification.style.opacity = '0';\n                notification.style.transition = 'opacity 0.3s';\n                setTimeout(() => notification.remove(), 300);\n              }, 3000);\n\n              setShowCreateOrgModal(false);\n            } catch (err) {\n              alert(': ' + (err instanceof Error ? err.message : 'Unknown error'));\n            }\n          }}\n        />\n      )}\n\n      {editingOrg && (\n        <EditOrganizationModal\n          organization={editingOrg}\n          onClose={() => setEditingOrg(null)}\n          onUpdate={async (updates) => {\n            try {\n              await updateOrganization(editingOrg.id, updates);\n\n              // \n              const notification = document.createElement('div');\n              notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2';\n              notification.innerHTML = `\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\n                </svg>\n                <span></span>\n              `;\n              document.body.appendChild(notification);\n\n              // 3\n              setTimeout(() => {\n                notification.style.opacity = '0';\n                notification.style.transition = 'opacity 0.3s';\n                setTimeout(() => notification.remove(), 300);\n              }, 3000);\n\n              setEditingOrg(null);\n            } catch (err) {\n              alert(': ' + (err instanceof Error ? err.message : 'Unknown error'));\n            }\n          }}\n        />\n      )}\n\n      {showCreateTeamModal && selectedOrgId && (\n        <CreateTeamModal\n          organizationId={selectedOrgId}\n          onClose={() => setShowCreateTeamModal(false)}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction OrganizationCard({\n  organization,\n  isSelected,\n  onSelect,\n  onEdit,\n  onDelete\n}: {\n  organization: Organization;\n  isSelected: boolean;\n  onSelect: () => void;\n  onEdit: () => void;\n  onDelete: () => void;\n}) {\n  return (\n    <div\n      className={`p-4 cursor-pointer transition-colors ${\n        isSelected ? 'bg-blue-50 border-l-4 border-blue-600' : 'hover:bg-gray-50'\n      }`}\n      onClick={onSelect}\n    >\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex-1 min-w-0\">\n          <h4 className=\"font-semibold text-gray-900 truncate\">{organization.name}</h4>\n          {organization.description && (\n            <p className=\"text-sm text-gray-600 mt-1 line-clamp-2\">{organization.description}</p>\n          )}\n          <p className=\"text-xs text-gray-500 mt-2\">\n            : {new Date(organization.created_at).toLocaleDateString('ja-JP')}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2 ml-4\" onClick={(e) => e.stopPropagation()}>\n          <button\n            onClick={onEdit}\n            className=\"p-1 text-gray-600 hover:text-blue-600 transition-colors\"\n            title=\"\"\n          >\n            <Edit2 className=\"h-4 w-4\" />\n          </button>\n          <button\n            onClick={onDelete}\n            className=\"p-1 text-gray-600 hover:text-red-600 transition-colors\"\n            title=\"\"\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction TeamPanel({\n  organizationId,\n  onCreateClick\n}: {\n  organizationId: string;\n  onCreateClick: () => void;\n}) {\n  const { teams, loading, deleteTeam } = useOrganizationTeams(organizationId);\n\n  console.log('TeamPanel render:', { organizationId, loading, teamsCount: teams.length, teams });\n\n  return (\n    <>\n      <div className=\"p-6 border-b flex items-center justify-between\">\n        <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n          <Users className=\"h-5 w-5\" />\n           ({teams.length})\n        </h3>\n        <button\n          onClick={onCreateClick}\n          className=\"flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          \n        </button>\n      </div>\n      <div className=\"divide-y max-h-[500px] overflow-y-auto\">\n        {loading ? (\n          <div className=\"p-6 text-center\">\n            <div className=\"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\n          </div>\n        ) : teams.length === 0 ? (\n          <div className=\"p-6 text-center text-gray-500\">\n            \n          </div>\n        ) : (\n          teams.map((team: any) => (\n            <TeamCard\n              key={team.id}\n              team={team}\n              onDelete={async () => {\n                if (confirm(`${team.name}`)) {\n                  try {\n                    await deleteTeam(team.id);\n                  } catch (err) {\n                    alert(': ' + (err instanceof Error ? err.message : 'Unknown error'));\n                  }\n                }\n              }}\n            />\n          ))\n        )}\n      </div>\n    </>\n  );\n}\n\nfunction TeamCard({\n  team,\n  onDelete\n}: {\n  team: any;\n  onDelete: () => void;\n}) {\n  return (\n    <div className=\"p-4 hover:bg-gray-50 transition-colors\">\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex-1 min-w-0\">\n          <h4 className=\"font-medium text-gray-900 truncate\">{team.name}</h4>\n          {team.description && (\n            <p className=\"text-sm text-gray-600 mt-1 line-clamp-2\">{team.description}</p>\n          )}\n          <div className=\"flex items-center gap-4 mt-2 text-xs text-gray-500\">\n            <span className=\"flex items-center gap-1\">\n              <Users className=\"h-3 w-3\" />\n              : {team.member_count || 0}\n            </span>\n            <span className=\"flex items-center gap-1\">\n              : {team.staff_count || 0}\n            </span>\n          </div>\n        </div>\n        <button\n          onClick={onDelete}\n          className=\"p-1 text-gray-600 hover:text-red-600 transition-colors ml-4\"\n          title=\"\"\n        >\n          <Trash2 className=\"h-4 w-4\" />\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction CreateOrganizationModal({\n  onClose,\n  onCreate\n}: {\n  onClose: () => void;\n  onCreate: (name: string, description: string) => Promise<void>;\n}) {\n  const [name, setName] = useState('');\n  const [description, setDescription] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!name.trim()) return;\n\n    setSubmitting(true);\n    try {\n      await onCreate(name.trim(), description.trim());\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n        <form onSubmit={handleSubmit}>\n          <div className=\"p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\"></h3>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                   <span className=\"text-red-600\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\": \"\n                  required\n                  autoFocus\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  \n                </label>\n                <textarea\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  rows={3}\n                  placeholder=\"\"\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors\"\n              disabled={submitting}\n            >\n              \n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n              disabled={submitting || !name.trim()}\n            >\n              {submitting ? '...' : ''}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nfunction EditOrganizationModal({\n  organization,\n  onClose,\n  onUpdate\n}: {\n  organization: Organization;\n  onClose: () => void;\n  onUpdate: (updates: { name?: string; description?: string }) => Promise<void>;\n}) {\n  const [name, setName] = useState(organization.name);\n  const [description, setDescription] = useState(organization.description || '');\n  const [submitting, setSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!name.trim()) return;\n\n    setSubmitting(true);\n    try {\n      await onUpdate({\n        name: name.trim(),\n        description: description.trim()\n      });\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n        <form onSubmit={handleSubmit}>\n          <div className=\"p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\"></h3>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                   <span className=\"text-red-600\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  required\n                  autoFocus\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  \n                </label>\n                <textarea\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  rows={3}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors\"\n              disabled={submitting}\n            >\n              \n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n              disabled={submitting || !name.trim()}\n            >\n              {submitting ? '...' : ''}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nfunction CreateTeamModal({\n  organizationId,\n  onClose\n}: {\n  organizationId: string;\n  onClose: () => void;\n}) {\n  const { createTeam } = useOrganizationTeams(organizationId);\n  const [name, setName] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!name.trim()) return;\n\n    setSubmitting(true);\n    try {\n      const team = await createTeam(name.trim());\n      console.log('Team created successfully, closing modal:', team);\n\n      // \n      const notification = document.createElement('div');\n      notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2';\n      notification.innerHTML = `\n        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\n        </svg>\n        <span>${name.trim()}</span>\n      `;\n      document.body.appendChild(notification);\n\n      // 3\n      setTimeout(() => {\n        notification.style.opacity = '0';\n        notification.style.transition = 'opacity 0.3s';\n        setTimeout(() => notification.remove(), 300);\n      }, 3000);\n\n      onClose();\n    } catch (err) {\n      alert(': ' + (err instanceof Error ? err.message : 'Unknown error'));\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n        <form onSubmit={handleSubmit}>\n          <div className=\"p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\"></h3>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                   <span className=\"text-red-600\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\": U-15\"\n                  required\n                  autoFocus\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors\"\n              disabled={submitting}\n            >\n              \n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50\"\n              disabled={submitting || !name.trim()}\n            >\n              {submitting ? '...' : ''}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { Users, UserCheck, UserX, ChevronDown, ChevronRight, UserPlus, Search } from 'lucide-react';\nimport type { Database } from '../lib/database.types';\n\ntype Team = Database['public']['Tables']['teams']['Row'];\ntype User = Database['public']['Tables']['users']['Row'];\n\ninterface OrganizationOverviewProps {\n  organizationId: string;\n  organizationName: string;\n}\n\ninterface TeamWithMembers extends Team {\n  athletes: User[];\n  coaches: User[];\n}\n\nexport function OrganizationOverview({ organizationId, organizationName }: OrganizationOverviewProps) {\n  const [teams, setTeams] = useState<TeamWithMembers[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [expandedTeams, setExpandedTeams] = useState<Set<string>>(new Set());\n  const [showAddMemberModal, setShowAddMemberModal] = useState(false);\n  const [selectedTeam, setSelectedTeam] = useState<Team | null>(null);\n  const [organizationMembers, setOrganizationMembers] = useState<User[]>([]);\n  const [searchQuery, setSearchQuery] = useState('');\n\n  useEffect(() => {\n    loadTeamsAndMembers();\n    loadOrganizationMembers();\n  }, [organizationId]);\n\n  const loadTeamsAndMembers = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const { data: teamsData, error: teamsError } = await supabase\n        .from('teams')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .order('name');\n\n      if (teamsError) throw teamsError;\n\n      if (!teamsData || teamsData.length === 0) {\n        setTeams([]);\n        return;\n      }\n\n      const teamsWithMembers = await Promise.all(\n        teamsData.map(async (team) => {\n          const { data: athletes, error: athletesError } = await supabase\n            .from('users')\n            .select('*')\n            .eq('team_id', team.id)\n            .eq('role', 'athlete')\n            .order('name');\n\n          if (athletesError) throw athletesError;\n\n          const { data: staffLinks, error: staffError } = await supabase\n            .from('staff_team_links')\n            .select(`\n              staff_user_id,\n              users!staff_team_links_staff_user_id_fkey (\n                id,\n                name,\n                email,\n                role\n              )\n            `)\n            .eq('team_id', team.id);\n\n          if (staffError) throw staffError;\n\n          const coaches = staffLinks?.map(link => link.users).filter(Boolean) as User[] || [];\n\n          return {\n            ...team,\n            athletes: athletes || [],\n            coaches\n          };\n        })\n      );\n\n      setTeams(teamsWithMembers);\n    } catch (err) {\n      console.error('Error loading teams and members:', err);\n      setError(err instanceof Error ? err.message : '');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadOrganizationMembers = async () => {\n    try {\n      // Get all user IDs that belong to this organization\n      const { data: memberLinks, error: memberLinksError } = await supabase\n        .from('organization_members')\n        .select('user_id')\n        .eq('organization_id', organizationId);\n\n      if (memberLinksError) throw memberLinksError;\n\n      if (!memberLinks || memberLinks.length === 0) {\n        console.log('No organization members found');\n        setOrganizationMembers([]);\n        return;\n      }\n\n      const userIds = memberLinks.map(m => m.user_id);\n\n      // Fetch user details\n      const { data: users, error: usersError } = await supabase\n        .from('users')\n        .select('id, name, email, role, team_id')\n        .in('id', userIds);\n\n      if (usersError) throw usersError;\n\n      console.log('Organization members loaded:', users);\n      console.log('Total members:', users?.length || 0);\n      setOrganizationMembers(users || []);\n    } catch (err) {\n      console.error('Error loading organization members:', err);\n    }\n  };\n\n  const toggleTeam = (teamId: string) => {\n    setExpandedTeams(prev => {\n      const next = new Set(prev);\n      if (next.has(teamId)) {\n        next.delete(teamId);\n      } else {\n        next.add(teamId);\n      }\n      return next;\n    });\n  };\n\n  const handleOpenAddMember = (team: Team) => {\n    setSelectedTeam(team);\n    setShowAddMemberModal(true);\n    setSearchQuery('');\n  };\n\n  const handleAssignMember = async (userId: string, memberRole: 'athlete' | 'staff') => {\n    if (!selectedTeam) return;\n\n    try {\n      if (memberRole === 'athlete') {\n        console.log(' Adding athlete to team using update_athlete_team function');\n        const { data, error } = await supabase.rpc('update_athlete_team', {\n          athlete_id: userId,\n          new_team_id: selectedTeam.id\n        });\n\n        console.log(' Function response:', { data, error });\n        if (error) throw error;\n      } else {\n        const { error } = await supabase\n          .from('staff_team_links')\n          .insert({\n            staff_user_id: userId,\n            team_id: selectedTeam.id\n          });\n\n        if (error) throw error;\n      }\n\n      console.log(' Reloading teams and members...');\n      await loadTeamsAndMembers();\n      await loadOrganizationMembers();\n      setShowAddMemberModal(false);\n      setSelectedTeam(null);\n      alert('');\n    } catch (err) {\n      console.error(' Error assigning member:', err);\n      alert(': ' + (err instanceof Error ? err.message : ''));\n    }\n  };\n\n  const handleRemoveMember = async (userId: string, memberRole: 'athlete' | 'staff', teamId: string) => {\n    if (!confirm('')) return;\n\n    try {\n      console.log(' Removing member:', { userId, memberRole, teamId });\n\n      if (memberRole === 'athlete') {\n        console.log(' Calling update_athlete_team function with null team_id');\n        const { data, error } = await supabase.rpc('update_athlete_team', {\n          athlete_id: userId,\n          new_team_id: null\n        });\n\n        console.log(' Function response:', { data, error });\n        if (error) throw error;\n        console.log(' Athlete removed successfully');\n      } else {\n        console.log(' Deleting staff_team_link');\n        const { error } = await supabase\n          .from('staff_team_links')\n          .delete()\n          .eq('staff_user_id', userId)\n          .eq('team_id', teamId);\n\n        if (error) throw error;\n        console.log(' Staff removed successfully');\n      }\n\n      console.log(' Reloading teams and members...');\n      await loadTeamsAndMembers();\n      alert('');\n    } catch (err) {\n      console.error(' Error removing member:', err);\n      alert(': ' + (err instanceof Error ? err.message : ''));\n    }\n  };\n\n  const totalAthletes = organizationMembers.filter(m => m.role === 'athlete').length;\n  const athletesWithoutTeam = organizationMembers.filter(m => m.role === 'athlete' && !m.team_id).length;\n  const totalCoaches = organizationMembers.filter(m => m.role === 'staff').length;\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n        <p className=\"text-red-800 dark:text-red-200\">{error}</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n          {organizationName}\n        </h2>\n        <p className=\"text-gray-600 dark:text-gray-400\">\n          \n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-blue-700 dark:text-blue-300 mb-1\"></p>\n              <p className=\"text-3xl font-bold text-blue-900 dark:text-blue-100\">{teams.length}</p>\n            </div>\n            <Users className=\"h-8 w-8 text-blue-600 dark:text-blue-400\" />\n          </div>\n        </div>\n\n        <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-green-700 dark:text-green-300 mb-1\"></p>\n              <p className=\"text-3xl font-bold text-green-900 dark:text-green-100\">{totalAthletes}</p>\n              {athletesWithoutTeam > 0 && (\n                <p className=\"text-xs text-orange-600 dark:text-orange-400 mt-1\">\n                   : {athletesWithoutTeam}\n                </p>\n              )}\n            </div>\n            <UserCheck className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n          </div>\n        </div>\n\n        <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-purple-700 dark:text-purple-300 mb-1\"></p>\n              <p className=\"text-3xl font-bold text-purple-900 dark:text-purple-100\">{totalCoaches}</p>\n            </div>\n            <UserX className=\"h-8 w-8 text-purple-600 dark:text-purple-400\" />\n          </div>\n        </div>\n      </div>\n\n      {athletesWithoutTeam > 0 && (\n        <div className=\"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-2\">\n              <UserX className=\"h-5 w-5 text-orange-600 dark:text-orange-400\" />\n              <h3 className=\"text-sm font-semibold text-orange-900 dark:text-orange-100\">\n                 ({athletesWithoutTeam})\n              </h3>\n            </div>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2\">\n            {organizationMembers\n              .filter(m => m.role === 'athlete' && !m.team_id)\n              .map((athlete) => (\n                <div\n                  key={athlete.id}\n                  className=\"bg-white dark:bg-gray-800 rounded p-2 border border-orange-200 dark:border-orange-600\"\n                >\n                  <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{athlete.name}</p>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400\">{athlete.email}</p>\n                </div>\n              ))\n            }\n          </div>\n        </div>\n      )}\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\n        <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\"></h3>\n        </div>\n        <div className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n          {teams.length === 0 ? (\n            <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">\n              \n            </div>\n          ) : (\n            teams.map((team) => {\n              const isExpanded = expandedTeams.has(team.id);\n              return (\n                <div key={team.id}>\n                  <div className=\"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\n                    <button\n                      onClick={() => toggleTeam(team.id)}\n                      className=\"flex-1 flex items-center gap-3 text-left\"\n                    >\n                      {isExpanded ? (\n                        <ChevronDown className=\"h-5 w-5 text-gray-400\" />\n                      ) : (\n                        <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                      )}\n                      <div>\n                        <h4 className=\"font-semibold text-gray-900 dark:text-white\">{team.name}</h4>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                           {team.athletes.length} /  {team.coaches.length}\n                        </p>\n                      </div>\n                    </button>\n                    <button\n                      onClick={() => handleOpenAddMember(team)}\n                      className=\"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm\"\n                    >\n                      <UserPlus className=\"h-4 w-4\" />\n                      <span></span>\n                    </button>\n                  </div>\n\n                  {isExpanded && (\n                    <div className=\"px-4 pb-4 bg-gray-50 dark:bg-gray-700/30\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\n                        <div>\n                          <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2\">\n                            <UserCheck className=\"h-4 w-4\" />\n                             ({team.athletes.length})\n                          </h5>\n                          <div className=\"space-y-2\">\n                            {team.athletes.length === 0 ? (\n                              <p className=\"text-sm text-gray-500 dark:text-gray-400 italic\"></p>\n                            ) : (\n                              team.athletes.map((athlete) => (\n                                <div\n                                  key={athlete.id}\n                                  className=\"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between\"\n                                >\n                                  <div>\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{athlete.name}</p>\n                                    <p className=\"text-xs text-gray-600 dark:text-gray-400\">{athlete.email}</p>\n                                  </div>\n                                  <button\n                                    onClick={() => handleRemoveMember(athlete.id, 'athlete', team.id)}\n                                    className=\"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors\"\n                                    title=\"\"\n                                  >\n                                    <UserX className=\"h-4 w-4\" />\n                                  </button>\n                                </div>\n                              ))\n                            )}\n                          </div>\n                        </div>\n\n                        <div>\n                          <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2\">\n                            <UserX className=\"h-4 w-4\" />\n                             ({team.coaches.length})\n                          </h5>\n                          <div className=\"space-y-2\">\n                            {team.coaches.length === 0 ? (\n                              <p className=\"text-sm text-gray-500 dark:text-gray-400 italic\"></p>\n                            ) : (\n                              team.coaches.map((coach) => (\n                                <div\n                                  key={coach.id}\n                                  className=\"bg-white dark:bg-gray-800 rounded p-2 border border-gray-200 dark:border-gray-600 flex items-center justify-between\"\n                                >\n                                  <div>\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{coach.name}</p>\n                                    <p className=\"text-xs text-gray-600 dark:text-gray-400\">{coach.email}</p>\n                                  </div>\n                                  <button\n                                    onClick={() => handleRemoveMember(coach.id, 'staff', team.id)}\n                                    className=\"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors\"\n                                    title=\"\"\n                                  >\n                                    <UserX className=\"h-4 w-4\" />\n                                  </button>\n                                </div>\n                              ))\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              );\n            })\n          )}\n        </div>\n      </div>\n\n      {showAddMemberModal && selectedTeam && (\n        <AddMemberToTeamModal\n          team={selectedTeam}\n          allTeams={teams}\n          organizationMembers={organizationMembers}\n          currentTeamMembers={[\n            ...teams.find(t => t.id === selectedTeam.id)?.athletes || [],\n            ...teams.find(t => t.id === selectedTeam.id)?.coaches || []\n          ]}\n          searchQuery={searchQuery}\n          onSearchChange={setSearchQuery}\n          onClose={() => {\n            setShowAddMemberModal(false);\n            setSelectedTeam(null);\n            setSearchQuery('');\n          }}\n          onAssign={handleAssignMember}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction AddMemberToTeamModal({\n  team,\n  allTeams,\n  organizationMembers,\n  currentTeamMembers,\n  searchQuery,\n  onSearchChange,\n  onClose,\n  onAssign\n}: {\n  team: Team;\n  allTeams: TeamWithMembers[];\n  organizationMembers: User[];\n  currentTeamMembers: User[];\n  searchQuery: string;\n  onSearchChange: (query: string) => void;\n  onClose: () => void;\n  onAssign: (userId: string, memberRole: 'athlete' | 'staff') => Promise<void>;\n}) {\n  const [submitting, setSubmitting] = useState(false);\n\n  const currentTeamMemberIds = new Set(currentTeamMembers.map(m => m.id));\n\n  const availableMembers = organizationMembers.filter(member => {\n    if (currentTeamMemberIds.has(member.id)) return false;\n\n    if (member.role === 'athlete' && member.team_id && member.team_id !== team.id) {\n      return false;\n    }\n\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      const nameMatch = member.name?.toLowerCase().includes(query);\n      const emailMatch = member.email?.toLowerCase().includes(query);\n      return nameMatch || emailMatch;\n    }\n\n    return true;\n  });\n\n  console.log('Search query:', searchQuery);\n  console.log('Organization members:', organizationMembers);\n  console.log('Available members after filter:', availableMembers);\n\n  const athletes = availableMembers.filter(m => m.role === 'athlete');\n  const staff = availableMembers.filter(m => m.role === 'staff');\n\n  const handleAssign = async (userId: string, role: 'athlete' | 'staff', currentTeamId?: string) => {\n    if (role === 'athlete' && currentTeamId && currentTeamId !== team.id) {\n      const member = organizationMembers.find(m => m.id === userId);\n      const currentTeam = allTeams.find(t => t.id === currentTeamId);\n      if (!confirm(`${member?.name}${currentTeam?.name}`)) {\n        return;\n      }\n    }\n\n    setSubmitting(true);\n    try {\n      await onAssign(userId, role);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col\">\n        <div className=\"p-6 border-b dark:border-gray-700\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n            {team.name} \n          </h3>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n            \n          </p>\n        </div>\n\n        <div className=\"p-4 border-b dark:border-gray-700\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n            <input\n              type=\"text\"\n              value={searchQuery}\n              onChange={(e) => onSearchChange(e.target.value)}\n              placeholder=\"...\"\n              className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n            />\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {availableMembers.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n              {searchQuery ? '' : ''}\n            </div>\n          ) : (\n            <div className=\"space-y-6\">\n              {athletes.length > 0 && (\n                <div>\n                  <h4 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2\">\n                    <UserCheck className=\"h-4 w-4\" />\n                     ({athletes.length})\n                  </h4>\n                  <div className=\"space-y-2\">\n                    {athletes.map((athlete) => {\n                      const currentTeam = athlete.team_id ? allTeams.find(t => t.id === athlete.team_id) : null;\n                      return (\n                        <div\n                          key={athlete.id}\n                          className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600\"\n                        >\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                              {athlete.name}\n                            </p>\n                            <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">\n                              {athlete.email}\n                            </p>\n                            {currentTeam && (\n                              <p className=\"text-xs text-amber-600 dark:text-amber-400 mt-1\">\n                                : {currentTeam.name}\n                              </p>\n                            )}\n                          </div>\n                          <button\n                            onClick={() => handleAssign(athlete.id, 'athlete', athlete.team_id || undefined)}\n                            disabled={submitting}\n                            className=\"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap\"\n                          >\n                            {currentTeam ? '' : ''}\n                          </button>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n\n              {staff.length > 0 && (\n                <div>\n                  <h4 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2\">\n                    <Users className=\"h-4 w-4\" />\n                     ({staff.length})\n                  </h4>\n                  <div className=\"space-y-2\">\n                    {staff.map((staffMember) => (\n                      <div\n                        key={staffMember.id}\n                        className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600\"\n                      >\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                            {staffMember.name}\n                          </p>\n                          <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">\n                            {staffMember.email}\n                          </p>\n                        </div>\n                        <button\n                          onClick={() => handleAssign(staffMember.id, 'staff')}\n                          disabled={submitting}\n                          className=\"ml-4 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm whitespace-nowrap\"\n                        >\n                          \n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end border-t dark:border-gray-700\">\n          <button\n            onClick={onClose}\n            disabled={submitting}\n            className=\"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","//20251208\n\nimport { supabase } from './supabase';\nimport { getDaysAgoJSTString } from './date'; //  \n\n// ---  -----------------\n\n//  index signature\ntype SubscriptionPlan = {\n  id: string;\n  name?: string | null;\n  athlete_limit: number | null;\n  storage_gb: number;\n  features?: Record<string, boolean> | null;\n  is_active?: boolean | null;\n  sort_order?: number | null;\n  [key: string]: any;\n};\n\ntype SubscriptionPlanInsert = Omit<SubscriptionPlan, 'id'> & { id?: string };\n\n// \ntype OrganizationSubscription = {\n  id: string;\n  organization_id: string;\n  plan_id: string | null;\n  billing_cycle?: 'monthly' | 'yearly' | null;\n  current_period_start?: string | null;\n  current_period_end?: string | null;\n  status?: string | null;\n  cancel_at_period_end?: boolean | null;\n  updated_at?: string | null;\n  [key: string]: any;\n};\n\ntype OrganizationSubscriptionInsert = Omit<OrganizationSubscription, 'id'> & {\n  id?: string;\n};\n\ntype OrganizationSubscriptionUpdate = Partial<OrganizationSubscription>;\n\n// \ntype UserSubscription = {\n  id: string;\n  user_id: string;\n  plan_id: string | null;\n  [key: string]: any;\n};\n\n// \ntype UsageTracking = {\n  id: string;\n  organization_id: string;\n  period_start: string;\n  period_end: string;\n  active_athletes: number;\n  total_users: number;\n  storage_used_mb: number;\n  api_calls: number;\n  data_exports: number;\n  [key: string]: any;\n};\n\ntype UsageTrackingInsert = Omit<UsageTracking, 'id'> & { id?: string };\n\n// \ntype BillingHistory = {\n  id: string;\n  organization_id?: string | null;\n  user_id?: string | null;\n  billing_date?: string | null;\n  [key: string]: any;\n};\n\ntype BillingHistoryInsert = Omit<BillingHistory, 'id'> & { id?: string };\n\n// \ntype PermissionDefinition = {\n  id: string;\n  is_active?: boolean | null;\n  category?: string | null;\n  name?: string | null;\n  [key: string]: any;\n};\n\n//  any \ntype RolePermission = {\n  id: string;\n  role: string;\n  permission_id: string;\n  [key: string]: any;\n};\n\n// Supabase  any \nconst db = supabase as any;\n\n// ---  -----------------\n\nexport const subscriptionQueries = {\n  async getSubscriptionPlans() {\n    const { data, error } = await db\n      .from('subscription_plans')\n      .select('*')\n      .eq('is_active', true)\n      .order('sort_order');\n\n    if (error) throw error;\n    return data as SubscriptionPlan[];\n  },\n\n  async getSubscriptionPlanById(id: string) {\n    const { data, error } = await db\n      .from('subscription_plans')\n      .select('*')\n      .eq('id', id)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data as SubscriptionPlan | null;\n  },\n\n  async createSubscriptionPlan(plan: SubscriptionPlanInsert) {\n    const { data, error } = await db\n      .from('subscription_plans')\n      .insert(plan)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as SubscriptionPlan;\n  },\n\n  async getOrganizationSubscription(organizationId: string) {\n    const { data, error } = await db\n      .from('organization_subscriptions')\n      .select(\n        `\n        *,\n        plan:plan_id (*)\n      `\n      )\n      .eq('organization_id', organizationId)\n      .maybeSingle();\n\n    if (error) throw error;\n    // db  any  data  any plan \n    return data as (OrganizationSubscription & { plan?: SubscriptionPlan }) | null;\n  },\n\n  async createOrganizationSubscription(subscription: OrganizationSubscriptionInsert) {\n    const { data, error } = await db\n      .from('organization_subscriptions')\n      .insert(subscription)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as OrganizationSubscription;\n  },\n\n  async updateOrganizationSubscription(\n    organizationId: string,\n    updates: OrganizationSubscriptionUpdate\n  ) {\n    const { data, error } = await db\n      .from('organization_subscriptions')\n      .update(updates)\n      .eq('organization_id', organizationId)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as OrganizationSubscription;\n  },\n\n  async getUserSubscription(userId: string) {\n    const { data, error } = await db\n      .from('user_subscriptions')\n      .select(\n        `\n        *,\n        plan:plan_id (*)\n      `\n      )\n      .eq('user_id', userId)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data as (UserSubscription & { plan?: SubscriptionPlan }) | null;\n  },\n\n  async getCurrentUsage(organizationId: string) {\n    const now = new Date();\n    const periodStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const periodEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n\n    const { data, error } = await db\n      .from('usage_tracking')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .gte('period_start', periodStart.toISOString())\n      .lte('period_end', periodEnd.toISOString())\n      .maybeSingle();\n\n    if (error) throw error;\n    return data as UsageTracking | null;\n  },\n\n  async calculateCurrentUsage(organizationId: string) {\n    const now = new Date();\n    const thirtyDaysAgo = new Date(now);\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n    //  typed supabase OK\n    const { data: activeAthletes, error: athletesError } = await supabase\n      .from('users')\n      .select('id', { count: 'exact', head: false })\n      .eq('role', 'athlete')\n      .eq('team_id', organizationId)\n      .gte('created_at', thirtyDaysAgo.toISOString());\n\n    if (athletesError) throw athletesError;\n\n    const { data: allUsers, error: usersError } = await supabase\n      .from('organization_members')\n      .select('id', { count: 'exact', head: false })\n      .eq('organization_id', organizationId);\n\n    if (usersError) throw usersError;\n\n    const { error: trainingError } = await supabase\n      .from('training_records')\n      .select('id', { count: 'exact', head: true })\n      .gte('date', getDaysAgoJSTString(30)); //  JST30\n\n    if (trainingError) throw trainingError;\n\n    return {\n      active_athletes: activeAthletes?.length || 0,\n      total_users: allUsers?.length || 0,\n      storage_used_mb: 0,\n      api_calls: 0,\n      data_exports: 0\n    };\n  },\n\n  async createUsageRecord(usage: UsageTrackingInsert) {\n    const { data, error } = await db\n      .from('usage_tracking')\n      .insert(usage)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as UsageTracking;\n  },\n\n  async getBillingHistory(organizationId?: string, userId?: string) {\n    let query = db\n      .from('billing_history')\n      .select('*')\n      .order('billing_date', { ascending: false });\n\n    if (organizationId) {\n      query = query.eq('organization_id', organizationId);\n    } else if (userId) {\n      query = query.eq('user_id', userId);\n    }\n\n    const { data, error } = await query;\n\n    if (error) throw error;\n    return data as BillingHistory[];\n  },\n\n  async createBillingRecord(billing: BillingHistoryInsert) {\n    const { data, error } = await db\n      .from('billing_history')\n      .insert(billing)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as BillingHistory;\n  },\n\n  async updateBillingRecord(id: string, updates: Partial<BillingHistory>) {\n    const { data, error } = await db\n      .from('billing_history')\n      .update(updates)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as BillingHistory;\n  },\n\n  async getPermissionDefinitions() {\n    const { data, error } = await db\n      .from('permission_definitions')\n      .select('*')\n      .eq('is_active', true)\n      .order('category', { ascending: true })\n      .order('name', { ascending: true });\n\n    if (error) throw error;\n    return data as PermissionDefinition[];\n  },\n\n  async getRolePermissions(role: string) {\n    const { data, error } = await db\n      .from('role_permissions')\n      .select(\n        `\n        *,\n        permission:permission_id (*)\n      `\n      )\n      .eq('role', role);\n\n    if (error) throw error;\n    return data as (RolePermission & { permission?: PermissionDefinition })[];\n  },\n\n  async getAllRolePermissions() {\n    const { data, error } = await db\n      .from('role_permissions')\n      .select(\n        `\n        *,\n        permission:permission_id (*)\n      `\n      )\n      .order('role');\n\n    if (error) throw error;\n    return data as (RolePermission & { permission?: PermissionDefinition })[];\n  },\n\n  async checkPlanLimits(organizationId: string) {\n    const subscription = await this.getOrganizationSubscription(organizationId);\n\n    if (!subscription || !subscription.plan) {\n      return {\n        withinLimits: false,\n        message: '',\n        limits: {}\n      };\n    }\n\n    const plan = subscription.plan as SubscriptionPlan;\n    const usage = await this.calculateCurrentUsage(organizationId);\n\n    const withinAthleteLimit =\n      plan.athlete_limit === null || usage.active_athletes <= plan.athlete_limit;\n    const withinStorageLimit = usage.storage_used_mb <= plan.storage_gb * 1024;\n\n    return {\n      withinLimits: withinAthleteLimit && withinStorageLimit,\n      message:\n        withinAthleteLimit && withinStorageLimit\n          ? ''\n          : '',\n      limits: {\n        athletes: {\n          current: usage.active_athletes,\n          limit: plan.athlete_limit,\n          exceeded: !withinAthleteLimit\n        },\n        storage: {\n          current: usage.storage_used_mb,\n          limit: plan.storage_gb * 1024,\n          exceeded: !withinStorageLimit\n        }\n      },\n      plan,\n      usage\n    };\n  },\n\n  async hasFeature(organizationId: string, featureKey: string): Promise<boolean> {\n    const subscription = await this.getOrganizationSubscription(organizationId);\n    if (!subscription || !subscription.plan) {\n      return false;\n    }\n\n    const plan = subscription.plan as SubscriptionPlan;\n    return !!(plan.features && plan.features[featureKey] === true);\n  },\n\n  async upgradePlan(\n    organizationId: string,\n    newPlanId: string,\n    billingCycle: 'monthly' | 'yearly'\n  ) {\n    const currentSubscription = await this.getOrganizationSubscription(organizationId);\n    if (!currentSubscription) {\n      throw new Error('');\n    }\n\n    const now = new Date();\n    const periodEnd = new Date(now);\n    if (billingCycle === 'monthly') {\n      periodEnd.setMonth(periodEnd.getMonth() + 1);\n    } else {\n      periodEnd.setFullYear(periodEnd.getFullYear() + 1);\n    }\n\n    const updates: OrganizationSubscriptionUpdate = {\n      plan_id: newPlanId,\n      billing_cycle: billingCycle,\n      current_period_start: now.toISOString(),\n      current_period_end: periodEnd.toISOString(),\n      status: 'active',\n      updated_at: now.toISOString()\n    };\n\n    return await this.updateOrganizationSubscription(organizationId, updates);\n  },\n\n  async cancelSubscription(organizationId: string, immediate: boolean = false) {\n    const updates: OrganizationSubscriptionUpdate = immediate\n      ? { status: 'cancelled', updated_at: new Date().toISOString() }\n      : { cancel_at_period_end: true, updated_at: new Date().toISOString() };\n\n    return await this.updateOrganizationSubscription(organizationId, updates);\n  },\n\n  async reactivateSubscription(organizationId: string) {\n    const updates: OrganizationSubscriptionUpdate = {\n      status: 'active',\n      cancel_at_period_end: false,\n      updated_at: new Date().toISOString()\n    };\n\n    return await this.updateOrganizationSubscription(organizationId, updates);\n  }\n};","import React, { useState } from 'react';\nimport { useSubscription } from '../hooks/useSubscription';\nimport { CreditCard, TrendingUp, Calendar, AlertCircle, Check, X, DollarSign } from 'lucide-react';\nimport type { Database } from '../lib/database.types';\n\ntype SubscriptionPlan = Database['public']['Tables']['subscription_plans']['Row'];\n\ninterface SubscriptionManagementProps {\n  organizationId: string;\n  organizationName: string;\n}\n\nexport function SubscriptionManagement({ organizationId, organizationName }: SubscriptionManagementProps) {\n  const {\n    subscription,\n    plans,\n    usage,\n    billingHistory,\n    limits,\n    loading,\n    error,\n    upgradePlan,\n    cancelSubscription,\n    reactivateSubscription\n  } = useSubscription(organizationId);\n\n  const [selectedPlan, setSelectedPlan] = useState<SubscriptionPlan | null>(null);\n  const [billingCycle, setBillingCycle] = useState<'monthly' | 'yearly'>('monthly');\n  const [showUpgradeModal, setShowUpgradeModal] = useState(false);\n  const [showCancelModal, setShowCancelModal] = useState(false);\n  const [processing, setProcessing] = useState(false);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n        <p className=\"text-red-800 dark:text-red-200\">{error}</p>\n      </div>\n    );\n  }\n\n  const currentPlan = subscription?.plan as SubscriptionPlan | undefined;\n  const isTrialing = subscription?.status === 'trial';\n  const isCancelled = subscription?.status === 'cancelled';\n  const willCancelAtPeriodEnd = subscription?.cancel_at_period_end;\n\n  const handleUpgrade = async () => {\n    if (!selectedPlan) return;\n\n    setProcessing(true);\n    try {\n      await upgradePlan(selectedPlan.id, billingCycle);\n      setShowUpgradeModal(false);\n      setSelectedPlan(null);\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleCancel = async (immediate: boolean) => {\n    setProcessing(true);\n    try {\n      await cancelSubscription(immediate);\n      setShowCancelModal(false);\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleReactivate = async () => {\n    setProcessing(true);\n    try {\n      await reactivateSubscription();\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('ja-JP', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ja-JP', {\n      style: 'currency',\n      currency: 'JPY'\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n          <CreditCard className=\"h-6 w-6\" />\n          \n        </h2>\n        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">{organizationName}</p>\n      </div>\n\n      {limits && !limits.withinLimits && (\n        <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\n          <div className=\"flex items-start gap-3\">\n            <AlertCircle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5\" />\n            <div>\n              <h3 className=\"font-semibold text-yellow-900 dark:text-yellow-200\"></h3>\n              <p className=\"text-sm text-yellow-800 dark:text-yellow-300 mt-1\">\n                \n              </p>\n              {limits.limits.athletes?.exceeded && (\n                <p className=\"text-sm text-yellow-700 dark:text-yellow-400 mt-1\">\n                  : {limits.limits.athletes.current} / {limits.limits.athletes.limit || ''}\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {willCancelAtPeriodEnd && (\n        <div className=\"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4\">\n          <div className=\"flex items-start justify-between gap-3\">\n            <div className=\"flex items-start gap-3\">\n              <AlertCircle className=\"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5\" />\n              <div>\n                <h3 className=\"font-semibold text-orange-900 dark:text-orange-200\"></h3>\n                <p className=\"text-sm text-orange-800 dark:text-orange-300 mt-1\">\n                  {formatDate(subscription.current_period_end)}\n                </p>\n              </div>\n            </div>\n            <button\n              onClick={handleReactivate}\n              disabled={processing}\n              className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 whitespace-nowrap\"\n            >\n              \n            </button>\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\"></h3>\n\n          {currentPlan ? (\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-2xl font-bold text-gray-900 dark:text-white\">{currentPlan.name}</span>\n                  {isTrialing && (\n                    <span className=\"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-xs font-semibold rounded-full\">\n                      \n                    </span>\n                  )}\n                  {isCancelled && (\n                    <span className=\"px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 text-xs font-semibold rounded-full\">\n                      \n                    </span>\n                  )}\n                </div>\n                <p className=\"text-gray-600 dark:text-gray-400 text-sm\">{currentPlan.description}</p>\n              </div>\n\n              <div className=\"pt-4 border-t dark:border-gray-700\">\n                <div className=\"flex items-baseline gap-2 mb-1\">\n                  <span className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n                    {formatCurrency(subscription.billing_cycle === 'yearly' ? currentPlan.price_yearly : currentPlan.price_monthly)}\n                  </span>\n                  <span className=\"text-gray-600 dark:text-gray-400\">\n                    / {subscription.billing_cycle === 'yearly' ? '' : ''}\n                  </span>\n                </div>\n                {subscription.billing_cycle === 'yearly' && (\n                  <p className=\"text-sm text-green-600 dark:text-green-400\">\n                     {formatCurrency((currentPlan.price_monthly * 12) - currentPlan.price_yearly)} \n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2 pt-4 border-t dark:border-gray-700\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600 dark:text-gray-400\"></span>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                    {subscription.billing_cycle === 'yearly' ? '' : ''}\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-600 dark:text-gray-400\"></span>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                    {formatDate(subscription.current_period_end)}\n                  </span>\n                </div>\n                {isTrialing && subscription.trial_end && (\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-gray-600 dark:text-gray-400\"></span>\n                    <span className=\"font-medium text-blue-600 dark:text-blue-400\">\n                      {formatDate(subscription.trial_end)}\n                    </span>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"pt-4 space-y-2\">\n                <button\n                  onClick={() => setShowUpgradeModal(true)}\n                  disabled={isCancelled}\n                  className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  \n                </button>\n                {!isCancelled && !willCancelAtPeriodEnd && (\n                  <button\n                    onClick={() => setShowCancelModal(true)}\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                  >\n                    \n                  </button>\n                )}\n              </div>\n            </div>\n          ) : (\n            <p className=\"text-gray-600 dark:text-gray-400\"></p>\n          )}\n        </div>\n\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            \n          </h3>\n\n          {limits && (\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\"></span>\n                  <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    {limits.usage?.active_athletes || 0} / {currentPlan?.athlete_limit || ''}\n                  </span>\n                </div>\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n                  <div\n                    className={`h-2 rounded-full ${\n                      limits.limits?.athletes?.exceeded ? 'bg-red-600' : 'bg-blue-600'\n                    }`}\n                    style={{\n                      width: currentPlan?.athlete_limit\n                        ? `${Math.min((limits.usage?.active_athletes || 0) / currentPlan.athlete_limit * 100, 100)}%`\n                        : '0%'\n                    }}\n                  ></div>\n                </div>\n              </div>\n\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\"></span>\n                  <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    {((limits.usage?.storage_used_mb || 0) / 1024).toFixed(2)} GB / {currentPlan?.storage_gb || 0} GB\n                  </span>\n                </div>\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n                  <div\n                    className={`h-2 rounded-full ${\n                      limits.limits?.storage?.exceeded ? 'bg-red-600' : 'bg-green-600'\n                    }`}\n                    style={{\n                      width: currentPlan?.storage_gb\n                        ? `${Math.min(((limits.usage?.storage_used_mb || 0) / 1024) / currentPlan.storage_gb * 100, 100)}%`\n                        : '0%'\n                    }}\n                  ></div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 pt-4 border-t dark:border-gray-700\">\n                <div>\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{limits.usage?.total_users || 0}</p>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\"></p>\n                </div>\n                <div>\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{limits.usage?.data_exports || 0}</p>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\"></p>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\n          <Calendar className=\"h-5 w-5\" />\n          \n        </h3>\n\n        {billingHistory.length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b dark:border-gray-700\">\n                  <th className=\"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white\"></th>\n                  <th className=\"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white\"></th>\n                  <th className=\"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white\"></th>\n                  <th className=\"text-left py-3 px-4 text-sm font-semibold text-gray-900 dark:text-white\"></th>\n                </tr>\n              </thead>\n              <tbody>\n                {billingHistory.slice(0, 10).map((bill) => (\n                  <tr key={bill.id} className=\"border-b dark:border-gray-700 last:border-0\">\n                    <td className=\"py-3 px-4 text-sm text-gray-900 dark:text-white\">\n                      {formatDate(bill.billing_date)}\n                    </td>\n                    <td className=\"py-3 px-4 text-sm font-medium text-gray-900 dark:text-white\">\n                      {formatCurrency(bill.amount)}\n                    </td>\n                    <td className=\"py-3 px-4 text-sm\">\n                      <span\n                        className={`px-2 py-1 rounded-full text-xs font-semibold ${\n                          bill.status === 'paid'\n                            ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200'\n                            : bill.status === 'pending'\n                            ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200'\n                            : 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200'\n                        }`}\n                      >\n                        {bill.status === 'paid' ? '' : bill.status === 'pending' ? '' : ''}\n                      </span>\n                    </td>\n                    <td className=\"py-3 px-4 text-sm text-gray-600 dark:text-gray-400\">\n                      {bill.payment_method || '-'}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        ) : (\n          <p className=\"text-gray-600 dark:text-gray-400 text-center py-4\"></p>\n        )}\n      </div>\n\n      {showUpgradeModal && (\n        <UpgradeModal\n          plans={plans}\n          currentPlan={currentPlan}\n          selectedPlan={selectedPlan}\n          billingCycle={billingCycle}\n          onSelectPlan={setSelectedPlan}\n          onSelectCycle={setBillingCycle}\n          onConfirm={handleUpgrade}\n          onClose={() => {\n            setShowUpgradeModal(false);\n            setSelectedPlan(null);\n          }}\n          processing={processing}\n        />\n      )}\n\n      {showCancelModal && (\n        <CancelModal\n          onCancel={handleCancel}\n          onClose={() => setShowCancelModal(false)}\n          processing={processing}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction UpgradeModal({\n  plans,\n  currentPlan,\n  selectedPlan,\n  billingCycle,\n  onSelectPlan,\n  onSelectCycle,\n  onConfirm,\n  onClose,\n  processing\n}: {\n  plans: SubscriptionPlan[];\n  currentPlan?: SubscriptionPlan;\n  selectedPlan: SubscriptionPlan | null;\n  billingCycle: 'monthly' | 'yearly';\n  onSelectPlan: (plan: SubscriptionPlan) => void;\n  onSelectCycle: (cycle: 'monthly' | 'yearly') => void;\n  onConfirm: () => void;\n  onClose: () => void;\n  processing: boolean;\n}) {\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ja-JP', {\n      style: 'currency',\n      currency: 'JPY'\n    }).format(amount);\n  };\n\n  const getFeatureValue = (plan: SubscriptionPlan, key: string) => {\n    return plan.features && plan.features[key];\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white\"></h3>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            >\n              <X className=\"h-6 w-6\" />\n            </button>\n          </div>\n\n          <div className=\"flex items-center justify-center gap-4 mb-8\">\n            <button\n              onClick={() => onSelectCycle('monthly')}\n              className={`px-6 py-2 rounded-lg font-medium transition-colors ${\n                billingCycle === 'monthly'\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'\n              }`}\n            >\n              \n            </button>\n            <button\n              onClick={() => onSelectCycle('yearly')}\n              className={`px-6 py-2 rounded-lg font-medium transition-colors ${\n                billingCycle === 'yearly'\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'\n              }`}\n            >\n              \n            </button>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n            {plans.map((plan) => {\n              const isCurrentPlan = currentPlan?.id === plan.id;\n              const isSelected = selectedPlan?.id === plan.id;\n              const price = billingCycle === 'yearly' ? plan.price_yearly : plan.price_monthly;\n\n              return (\n                <div\n                  key={plan.id}\n                  onClick={() => onSelectPlan(plan)}\n                  className={`border-2 rounded-lg p-4 cursor-pointer transition-all ${\n                    isSelected\n                      ? 'border-blue-600 bg-blue-50 dark:bg-blue-900/20'\n                      : isCurrentPlan\n                      ? 'border-gray-400 dark:border-gray-600'\n                      : 'border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700'\n                  }`}\n                >\n                  {isCurrentPlan && (\n                    <div className=\"mb-2\">\n                      <span className=\"px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-xs font-semibold rounded\">\n                        \n                      </span>\n                    </div>\n                  )}\n                  <h4 className=\"text-xl font-bold text-gray-900 dark:text-white mb-2\">{plan.name}</h4>\n                  <div className=\"mb-4\">\n                    <span className=\"text-3xl font-bold text-gray-900 dark:text-white\">{formatCurrency(price)}</span>\n                    <span className=\"text-gray-600 dark:text-gray-400 text-sm\">\n                      / {billingCycle === 'yearly' ? '' : ''}\n                    </span>\n                  </div>\n                  <ul className=\"space-y-2 text-sm\">\n                    <li className=\"flex items-center gap-2\">\n                      <Check className=\"h-4 w-4 text-green-600\" />\n                      <span className=\"text-gray-700 dark:text-gray-300\">\n                        {plan.athlete_limit ? `${plan.athlete_limit}` : ''}\n                      </span>\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Check className=\"h-4 w-4 text-green-600\" />\n                      <span className=\"text-gray-700 dark:text-gray-300\">{plan.storage_gb}GB </span>\n                    </li>\n                    {getFeatureValue(plan, 'advanced_analytics') && (\n                      <li className=\"flex items-center gap-2\">\n                        <Check className=\"h-4 w-4 text-green-600\" />\n                        <span className=\"text-gray-700 dark:text-gray-300\"></span>\n                      </li>\n                    )}\n                    {getFeatureValue(plan, 'priority_support') && (\n                      <li className=\"flex items-center gap-2\">\n                        <Check className=\"h-4 w-4 text-green-600\" />\n                        <span className=\"text-gray-700 dark:text-gray-300\"></span>\n                      </li>\n                    )}\n                  </ul>\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"flex justify-end gap-3 pt-6 border-t dark:border-gray-700\">\n            <button\n              onClick={onClose}\n              disabled={processing}\n              className=\"px-6 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50\"\n            >\n              \n            </button>\n            <button\n              onClick={onConfirm}\n              disabled={!selectedPlan || processing}\n              className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {processing ? '...' : ''}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction CancelModal({\n  onCancel,\n  onClose,\n  processing\n}: {\n  onCancel: (immediate: boolean) => void;\n  onClose: () => void;\n  processing: boolean;\n}) {\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n        <div className=\"p-6\">\n          <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-4\"></h3>\n          <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\n            \n          </p>\n\n          <div className=\"space-y-3\">\n            <button\n              onClick={() => onCancel(false)}\n              disabled={processing}\n              className=\"w-full px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 text-left\"\n            >\n              <div className=\"font-semibold\"></div>\n              <div className=\"text-sm opacity-90\"></div>\n            </button>\n\n            <button\n              onClick={() => onCancel(true)}\n              disabled={processing}\n              className=\"w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 text-left\"\n            >\n              <div className=\"font-semibold\"></div>\n              <div className=\"text-sm opacity-90\"></div>\n            </button>\n\n            <button\n              onClick={onClose}\n              disabled={processing}\n              className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50\"\n            >\n              \n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { subscriptionQueries } from '../lib/subscriptionQueries';\nimport type { Database } from '../lib/database.types';\n\ntype SubscriptionPlan = Database['public']['Tables']['subscription_plans']['Row'];\ntype OrganizationSubscription = Database['public']['Tables']['organization_subscriptions']['Row'];\ntype UsageTracking = Database['public']['Tables']['usage_tracking']['Row'];\ntype BillingHistory = Database['public']['Tables']['billing_history']['Row'];\n\nexport function useSubscription(organizationId: string | undefined) {\n  const [subscription, setSubscription] = useState<any>(null);\n  const [plans, setPlans] = useState<SubscriptionPlan[]>([]);\n  const [usage, setUsage] = useState<UsageTracking | null>(null);\n  const [billingHistory, setBillingHistory] = useState<BillingHistory[]>([]);\n  const [limits, setLimits] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!organizationId) {\n      setLoading(false);\n      return;\n    }\n\n    loadSubscriptionData();\n  }, [organizationId]);\n\n  const loadSubscriptionData = async () => {\n    if (!organizationId) return;\n\n    try {\n      setLoading(true);\n      setError(null);\n\n      const [subData, plansData, usageData, billingData, limitsData] = await Promise.all([\n        subscriptionQueries.getOrganizationSubscription(organizationId),\n        subscriptionQueries.getSubscriptionPlans(),\n        subscriptionQueries.getCurrentUsage(organizationId),\n        subscriptionQueries.getBillingHistory(organizationId),\n        subscriptionQueries.checkPlanLimits(organizationId)\n      ]);\n\n      setSubscription(subData);\n      setPlans(plansData);\n      setUsage(usageData);\n      setBillingHistory(billingData);\n      setLimits(limitsData);\n    } catch (err) {\n      // Subscription tables are not yet implemented, so suppress errors\n      console.warn('Subscription feature not yet implemented:', err);\n      setError(null); // Don't show error to user\n      setSubscription(null);\n      setPlans([]);\n      setUsage(null);\n      setBillingHistory([]);\n      setLimits(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const upgradePlan = async (newPlanId: string, billingCycle: 'monthly' | 'yearly') => {\n    if (!organizationId) {\n      throw new Error('Organization ID is required');\n    }\n\n    try {\n      const updated = await subscriptionQueries.upgradePlan(organizationId, newPlanId, billingCycle);\n      await loadSubscriptionData();\n      return updated;\n    } catch (err) {\n      const message = err instanceof Error ? err.message : '';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  const cancelSubscription = async (immediate: boolean = false) => {\n    if (!organizationId) {\n      throw new Error('Organization ID is required');\n    }\n\n    try {\n      const updated = await subscriptionQueries.cancelSubscription(organizationId, immediate);\n      await loadSubscriptionData();\n      return updated;\n    } catch (err) {\n      const message = err instanceof Error ? err.message : '';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  const reactivateSubscription = async () => {\n    if (!organizationId) {\n      throw new Error('Organization ID is required');\n    }\n\n    try {\n      const updated = await subscriptionQueries.reactivateSubscription(organizationId);\n      await loadSubscriptionData();\n      return updated;\n    } catch (err) {\n      const message = err instanceof Error ? err.message : '';\n      setError(message);\n      throw new Error(message);\n    }\n  };\n\n  const hasFeature = async (featureKey: string): Promise<boolean> => {\n    if (!organizationId) return false;\n\n    try {\n      return await subscriptionQueries.hasFeature(organizationId, featureKey);\n    } catch (err) {\n      console.error('Error checking feature:', err);\n      return false;\n    }\n  };\n\n  const refreshUsage = async () => {\n    if (!organizationId) return;\n\n    try {\n      const [usageData, limitsData] = await Promise.all([\n        subscriptionQueries.getCurrentUsage(organizationId),\n        subscriptionQueries.checkPlanLimits(organizationId)\n      ]);\n\n      setUsage(usageData);\n      setLimits(limitsData);\n    } catch (err) {\n      console.error('Error refreshing usage:', err);\n    }\n  };\n\n  return {\n    subscription,\n    plans,\n    usage,\n    billingHistory,\n    limits,\n    loading,\n    error,\n    upgradePlan,\n    cancelSubscription,\n    reactivateSubscription,\n    hasFeature,\n    refreshUsage,\n    reload: loadSubscriptionData\n  };\n}\n\nexport function usePermissions(role: string | undefined) {\n  const [permissions, setPermissions] = useState<any[]>([]);\n  const [allPermissions, setAllPermissions] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    loadPermissions();\n  }, [role]);\n\n  const loadPermissions = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const [allPerms, rolePerms] = await Promise.all([\n        subscriptionQueries.getPermissionDefinitions(),\n        role ? subscriptionQueries.getRolePermissions(role) : Promise.resolve([])\n      ]);\n\n      setAllPermissions(allPerms);\n      setPermissions(rolePerms);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '');\n      console.error('Error loading permissions:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const hasPermission = (permissionKey: string): boolean => {\n    if (!permissions || permissions.length === 0) return false;\n\n    return permissions.some(rp => {\n      const perm = rp.permission;\n      return perm && perm.permission_key === permissionKey;\n    });\n  };\n\n  const hasAnyPermission = (permissionKeys: string[]): boolean => {\n    return permissionKeys.some(key => hasPermission(key));\n  };\n\n  const hasAllPermissions = (permissionKeys: string[]): boolean => {\n    return permissionKeys.every(key => hasPermission(key));\n  };\n\n  return {\n    permissions,\n    allPermissions,\n    loading,\n    error,\n    hasPermission,\n    hasAnyPermission,\n    hasAllPermissions,\n    reload: loadPermissions\n  };\n}\n","import React, { useState } from 'react';\nimport { useOrganizations } from '../hooks/useOrganizations';\nimport { Settings, Bell, Shield, Palette, Globe } from 'lucide-react';\nimport type { Database } from '../lib/database.types';\n\ntype Organization = Database['public']['Tables']['organizations']['Row'];\n\ninterface OrganizationSettingsProps {\n  organizationId: string;\n}\n\nexport function OrganizationSettings({ organizationId }: OrganizationSettingsProps) {\n  const { organizations, updateOrganization } = useOrganizations(undefined);\n  const organization = organizations.find(org => org.id === organizationId);\n\n  const [activeTab, setActiveTab] = useState<'general' | 'notifications' | 'security' | 'appearance'>('general');\n  const [saving, setSaving] = useState(false);\n\n  if (!organization) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-600 dark:text-gray-400\"></div>\n      </div>\n    );\n  }\n\n  const tabs = [\n    { id: 'general' as const, name: '', icon: Globe },\n    { id: 'notifications' as const, name: '', icon: Bell },\n    { id: 'security' as const, name: '', icon: Shield },\n    { id: 'appearance' as const, name: '', icon: Palette },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n          <Settings className=\"h-6 w-6\" />\n          \n        </h2>\n        <p className=\"text-gray-600 dark:text-gray-400 mt-1\">{organization.name}</p>\n      </div>\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700\">\n        <div className=\"border-b dark:border-gray-700\">\n          <nav className=\"flex px-6\">\n            {tabs.map((tab) => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  className={`py-4 px-1 mr-8 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors ${\n                    activeTab === tab.id\n                      ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                      : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300'\n                  }`}\n                >\n                  <Icon className=\"h-4 w-4\" />\n                  <span>{tab.name}</span>\n                </button>\n              );\n            })}\n          </nav>\n        </div>\n\n        <div className=\"p-6\">\n          {activeTab === 'general' && (\n            <GeneralSettings\n              organization={organization}\n              onUpdate={updateOrganization}\n              saving={saving}\n              setSaving={setSaving}\n            />\n          )}\n          {activeTab === 'notifications' && (\n            <NotificationSettings\n              organization={organization}\n              onUpdate={updateOrganization}\n              saving={saving}\n              setSaving={setSaving}\n            />\n          )}\n          {activeTab === 'security' && (\n            <SecuritySettings\n              organization={organization}\n              onUpdate={updateOrganization}\n              saving={saving}\n              setSaving={setSaving}\n            />\n          )}\n          {activeTab === 'appearance' && (\n            <AppearanceSettings\n              organization={organization}\n              onUpdate={updateOrganization}\n              saving={saving}\n              setSaving={setSaving}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction GeneralSettings({\n  organization,\n  onUpdate,\n  saving,\n  setSaving\n}: {\n  organization: Organization;\n  onUpdate: (id: string, updates: any) => Promise<any>;\n  saving: boolean;\n  setSaving: (saving: boolean) => void;\n}) {\n  const [name, setName] = useState(organization.name);\n  const [description, setDescription] = useState(organization.description || '');\n  const settings = organization.settings || {};\n  const [timezone, setTimezone] = useState(settings.timezone || 'Asia/Tokyo');\n  const [language, setLanguage] = useState(settings.language || 'ja');\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      await onUpdate(organization.id, {\n        name,\n        description,\n        settings: {\n          ...settings,\n          timezone,\n          language\n        }\n      });\n      alert('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          \n        </label>\n        <input\n          type=\"text\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n        />\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          \n        </label>\n        <textarea\n          value={description}\n          onChange={(e) => setDescription(e.target.value)}\n          rows={3}\n          className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n        />\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          \n        </label>\n        <select\n          value={timezone}\n          onChange={(e) => setTimezone(e.target.value)}\n          className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n        >\n          <option value=\"Asia/Tokyo\"> (JST)</option>\n          <option value=\"America/New_York\"> (EST)</option>\n          <option value=\"America/Los_Angeles\"> (PST)</option>\n          <option value=\"Europe/London\"> (GMT)</option>\n          <option value=\"UTC\"> (UTC)</option>\n        </select>\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          \n        </label>\n        <select\n          value={language}\n          onChange={(e) => setLanguage(e.target.value)}\n          className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n        >\n          <option value=\"ja\"></option>\n          <option value=\"en\">English</option>\n        </select>\n      </div>\n\n      <div className=\"pt-4 border-t dark:border-gray-700\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n        >\n          {saving ? '...' : ''}\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction NotificationSettings({\n  organization,\n  onUpdate,\n  saving,\n  setSaving\n}: {\n  organization: Organization;\n  onUpdate: (id: string, updates: any) => Promise<any>;\n  saving: boolean;\n  setSaving: (saving: boolean) => void;\n}) {\n  const settings = organization.settings || {};\n  const notifications = settings.notifications || {};\n\n  const [emailAlerts, setEmailAlerts] = useState(notifications.emailAlerts !== false);\n  const [highPriorityOnly, setHighPriorityOnly] = useState(notifications.highPriorityOnly || false);\n  const [weeklyReport, setWeeklyReport] = useState(notifications.weeklyReport || false);\n  const [usageLimitWarnings, setUsageLimitWarnings] = useState(notifications.usageLimitWarnings !== false);\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      await onUpdate(organization.id, {\n        settings: {\n          ...settings,\n          notifications: {\n            emailAlerts,\n            highPriorityOnly,\n            weeklyReport,\n            usageLimitWarnings\n          }\n        }\n      });\n      alert('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-4\">\n        <label className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"font-medium text-gray-900 dark:text-white\"></div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n              ACWR\n            </div>\n          </div>\n          <input\n            type=\"checkbox\"\n            checked={emailAlerts}\n            onChange={(e) => setEmailAlerts(e.target.checked)}\n            className=\"h-5 w-5 text-blue-600 rounded focus:ring-blue-500\"\n          />\n        </label>\n\n        <label className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"font-medium text-gray-900 dark:text-white\"></div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n              \n            </div>\n          </div>\n          <input\n            type=\"checkbox\"\n            checked={highPriorityOnly}\n            onChange={(e) => setHighPriorityOnly(e.target.checked)}\n            disabled={!emailAlerts}\n            className=\"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50\"\n          />\n        </label>\n\n        <label className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"font-medium text-gray-900 dark:text-white\"></div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n              \n            </div>\n          </div>\n          <input\n            type=\"checkbox\"\n            checked={weeklyReport}\n            onChange={(e) => setWeeklyReport(e.target.checked)}\n            className=\"h-5 w-5 text-blue-600 rounded focus:ring-blue-500\"\n          />\n        </label>\n\n        <label className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"font-medium text-gray-900 dark:text-white\"></div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n              \n            </div>\n          </div>\n          <input\n            type=\"checkbox\"\n            checked={usageLimitWarnings}\n            onChange={(e) => setUsageLimitWarnings(e.target.checked)}\n            className=\"h-5 w-5 text-blue-600 rounded focus:ring-blue-500\"\n          />\n        </label>\n      </div>\n\n      <div className=\"pt-4 border-t dark:border-gray-700\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n        >\n          {saving ? '...' : ''}\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction SecuritySettings({\n  organization,\n  onUpdate,\n  saving,\n  setSaving\n}: {\n  organization: Organization;\n  onUpdate: (id: string, updates: any) => Promise<any>;\n  saving: boolean;\n  setSaving: (saving: boolean) => void;\n}) {\n  const settings = organization.settings || {};\n  const security = settings.security || {};\n\n  const [dataRetentionDays, setDataRetentionDays] = useState(security.dataRetentionDays || 365);\n  const [requireMFA, setRequireMFA] = useState(security.requireMFA || false);\n  const [allowExport, setAllowExport] = useState(security.allowExport !== false);\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      await onUpdate(organization.id, {\n        settings: {\n          ...settings,\n          security: {\n            dataRetentionDays,\n            requireMFA,\n            allowExport\n          }\n        }\n      });\n      alert('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          \n        </label>\n        <input\n          type=\"number\"\n          value={dataRetentionDays}\n          onChange={(e) => setDataRetentionDays(parseInt(e.target.value))}\n          min=\"30\"\n          max=\"3650\"\n          className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n        />\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n          \n        </p>\n      </div>\n\n      <div className=\"space-y-4\">\n        <label className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"font-medium text-gray-900 dark:text-white\"></div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n              MFA\n            </div>\n          </div>\n          <input\n            type=\"checkbox\"\n            checked={requireMFA}\n            onChange={(e) => setRequireMFA(e.target.checked)}\n            disabled\n            className=\"h-5 w-5 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50\"\n          />\n        </label>\n\n        <label className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"font-medium text-gray-900 dark:text-white\"></div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n              \n            </div>\n          </div>\n          <input\n            type=\"checkbox\"\n            checked={allowExport}\n            onChange={(e) => setAllowExport(e.target.checked)}\n            className=\"h-5 w-5 text-blue-600 rounded focus:ring-blue-500\"\n          />\n        </label>\n      </div>\n\n      <div className=\"pt-4 border-t dark:border-gray-700\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n        >\n          {saving ? '...' : ''}\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction AppearanceSettings({\n  organization,\n  onUpdate,\n  saving,\n  setSaving\n}: {\n  organization: Organization;\n  onUpdate: (id: string, updates: any) => Promise<any>;\n  saving: boolean;\n  setSaving: (saving: boolean) => void;\n}) {\n  const settings = organization.settings || {};\n  const appearance = settings.appearance || {};\n\n  const [primaryColor, setPrimaryColor] = useState(appearance.primaryColor || '#3B82F6');\n  const [acwrThresholdLow, setAcwrThresholdLow] = useState(appearance.acwrThresholdLow || 0.8);\n  const [acwrThresholdHigh, setAcwrThresholdHigh] = useState(appearance.acwrThresholdHigh || 1.3);\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      await onUpdate(organization.id, {\n        settings: {\n          ...settings,\n          appearance: {\n            primaryColor,\n            acwrThresholdLow,\n            acwrThresholdHigh\n          }\n        }\n      });\n      alert('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          \n        </label>\n        <div className=\"flex items-center gap-4\">\n          <input\n            type=\"color\"\n            value={primaryColor}\n            onChange={(e) => setPrimaryColor(e.target.value)}\n            className=\"h-10 w-20 rounded border border-gray-300 dark:border-gray-600 cursor-pointer\"\n          />\n          <input\n            type=\"text\"\n            value={primaryColor}\n            onChange={(e) => setPrimaryColor(e.target.value)}\n            className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n          />\n        </div>\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n          \n        </p>\n      </div>\n\n      <div className=\"pt-4 border-t dark:border-gray-700\">\n        <h4 className=\"font-semibold text-gray-900 dark:text-white mb-4\">ACWR</h4>\n\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              \n            </label>\n            <input\n              type=\"number\"\n              value={acwrThresholdLow}\n              onChange={(e) => setAcwrThresholdLow(parseFloat(e.target.value))}\n              step=\"0.1\"\n              min=\"0.5\"\n              max=\"1.0\"\n              className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n            />\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n              \n            </p>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              \n            </label>\n            <input\n              type=\"number\"\n              value={acwrThresholdHigh}\n              onChange={(e) => setAcwrThresholdHigh(parseFloat(e.target.value))}\n              step=\"0.1\"\n              min=\"1.2\"\n              max=\"2.0\"\n              className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n            />\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n              \n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"pt-4 border-t dark:border-gray-700\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n        >\n          {saving ? '...' : ''}\n        </button>\n      </div>\n    </div>\n  );\n}\n","// src/lib/teamAccessQueries.ts\nimport { supabase } from './supabase';\nimport type { AppRole } from './roles';\n\nexport interface TeamAccessRequest {\n  id: string;\n  requester_id: string;\n  team_id: string;\n  organization_id: string;\n  status: 'pending' | 'approved' | 'rejected';\n  request_message: string;\n  reviewed_by: string | null;\n  reviewed_at: string | null;\n  review_notes: string;\n  created_at: string;\n  updated_at: string;\n  requester?: {\n    id: string;\n    name: string;\n    email: string;\n  };\n  team?: {\n    id: string;\n    name: string;\n    organization_id?: string;\n  };\n  reviewer?: {\n    id: string;\n    name: string;\n  };\n}\n\nconst isGlobalAdmin = (role?: AppRole | string | null) => role === 'global_admin';\n\nexport const teamAccessQueries = {\n  async getMyRequests(userId: string) {\n    const { data, error } = await supabase\n      .from('team_access_requests')\n      .select(\n        `\n        *,\n        team:teams (\n          id,\n          name\n        )\n      `,\n      )\n      .eq('requester_id', userId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as TeamAccessRequest[];\n  },\n\n  async getPendingRequestsForMyTeams(userId: string) {\n    // users.role users\n    const { data: userData, error: userError } = await supabase\n      .from('users')\n      .select('role')\n      .eq('id', userId)\n      .maybeSingle();\n\n    if (userError) throw userError;\n\n    //  global_admin \n    if (isGlobalAdmin(userData?.role)) {\n      const { data, error } = await supabase\n        .from('team_access_requests')\n        .select(\n          `\n          *,\n          requester:users!team_access_requests_requester_id_fkey (\n            id,\n            name,\n            email\n          ),\n          team:teams (\n            id,\n            name,\n            organization_id\n          )\n        `,\n        )\n        .eq('status', 'pending')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      return data as TeamAccessRequest[];\n    }\n\n    //  staff team\n    const { data: myTeams, error: teamsError } = await supabase\n      .from('staff_team_links')\n      .select('team_id')\n      .eq('staff_user_id', userId);\n\n    if (teamsError) throw teamsError;\n\n    const teamIds = myTeams?.map((t) => t.team_id).filter(Boolean) || [];\n    if (teamIds.length === 0) return [];\n\n    const { data, error } = await supabase\n      .from('team_access_requests')\n      .select(\n        `\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        )\n      `,\n      )\n      .eq('status', 'pending')\n      .in('team_id', teamIds)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as TeamAccessRequest[];\n  },\n\n  async getRequestsForOrganization(organizationId: string) {\n    const { data, error } = await supabase\n      .from('team_access_requests')\n      .select(\n        `\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        ),\n        reviewer:users!team_access_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      `,\n      )\n      .eq('organization_id', organizationId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as TeamAccessRequest[];\n  },\n\n  async getAvailableTeamsToRequest(userId: string, organizationId: string) {\n    //  users.team_id users\n    const { data: userData, error: userError } = await supabase\n      .from('users')\n      .select('team_id')\n      .eq('id', userId)\n      .maybeSingle();\n\n    if (userError) throw userError;\n\n    //  staff_team_links \n    const { data: myTeams, error: myTeamsError } = await supabase\n      .from('staff_team_links')\n      .select('team_id')\n      .eq('staff_user_id', userId);\n\n    if (myTeamsError) throw myTeamsError;\n\n    const myTeamIds = (myTeams ?? []).map((t) => t.team_id).filter(Boolean);\n\n    //  primary team \n    if (userData?.team_id) myTeamIds.push(userData.team_id);\n\n    //  pending request \n    const { data: pendingRequests, error: pendingError } = await supabase\n      .from('team_access_requests')\n      .select('team_id')\n      .eq('requester_id', userId)\n      .eq('status', 'pending');\n\n    if (pendingError) throw pendingError;\n\n    const pendingTeamIds = (pendingRequests ?? []).map((r) => r.team_id).filter(Boolean);\n    const excludedTeamIds = Array.from(new Set([...myTeamIds, ...pendingTeamIds])).filter(Boolean);\n\n    //  organizationteam excluded \n    // 1000RPC/VIEWOK\n    const { data, error } = await supabase\n      .from('teams')\n      .select('id, name, organization_id')\n      .eq('organization_id', organizationId)\n      .order('name');\n\n    if (error) throw error;\n\n    if (!excludedTeamIds.length) return data ?? [];\n\n    return (data ?? []).filter((t) => !excludedTeamIds.includes(t.id));\n  },\n\n  async createRequest(requesterId: string, teamId: string, organizationId: string, message: string = '') {\n    const { data, error } = await supabase\n      .from('team_access_requests')\n      .insert({\n        requester_id: requesterId,\n        team_id: teamId,\n        organization_id: organizationId,\n        status: 'pending',\n        request_message: message,\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as TeamAccessRequest;\n  },\n\n  async approveRequest(requestId: string, reviewerId: string, notes: string = '') {\n    const { error } = await supabase.rpc('approve_team_access_request', {\n      request_id: requestId,\n      reviewer_user_id: reviewerId,\n      notes,\n    });\n\n    if (error) throw error;\n  },\n\n  async rejectRequest(requestId: string, reviewerId: string, notes: string = '') {\n    const { error } = await supabase.rpc('reject_team_access_request', {\n      request_id: requestId,\n      reviewer_user_id: reviewerId,\n      notes,\n    });\n\n    if (error) throw error;\n  },\n\n  async cancelRequest(requestId: string) {\n    const { error } = await supabase\n      .from('team_access_requests')\n      .delete()\n      .eq('id', requestId)\n      .eq('status', 'pending');\n\n    if (error) throw error;\n  },\n\n  async getRequestById(requestId: string) {\n    const { data, error } = await supabase\n      .from('team_access_requests')\n      .select(\n        `\n        *,\n        requester:users!team_access_requests_requester_id_fkey (\n          id,\n          name,\n          email\n        ),\n        team:teams (\n          id,\n          name\n        ),\n        reviewer:users!team_access_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      `,\n      )\n      .eq('id', requestId)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data as TeamAccessRequest | null;\n  },\n};","import React, { useState } from 'react';\nimport { useTeamAccessRequests } from '../hooks/useTeamAccessRequests';\nimport { Users, Send, Check, X, Clock, AlertCircle, Plus } from 'lucide-react';\nimport { TeamAccessRequest } from '../lib/teamAccessQueries';\n\ninterface TeamAccessRequestManagementProps {\n  userId: string;\n  organizationId: string;\n  isAdmin?: boolean;\n}\n\nexport function TeamAccessRequestManagement({\n  userId,\n  organizationId,\n  isAdmin = false\n}: TeamAccessRequestManagementProps) {\n  const {\n    myRequests,\n    pendingRequests,\n    organizationRequests,\n    availableTeams,\n    loading,\n    error,\n    createRequest,\n    approveRequest,\n    rejectRequest,\n    cancelRequest\n  } = useTeamAccessRequests(userId, organizationId);\n\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [selectedTeamId, setSelectedTeamId] = useState<string>('');\n  const [requestMessage, setRequestMessage] = useState('');\n  const [reviewNotes, setReviewNotes] = useState('');\n  const [selectedRequest, setSelectedRequest] = useState<TeamAccessRequest | null>(null);\n  const [processing, setProcessing] = useState(false);\n  const [activeTab, setActiveTab] = useState<'my' | 'pending' | 'all'>('my');\n\n  const handleCreateRequest = async () => {\n    if (!selectedTeamId) return;\n\n    setProcessing(true);\n    try {\n      await createRequest(selectedTeamId, requestMessage);\n      setShowCreateModal(false);\n      setSelectedTeamId('');\n      setRequestMessage('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleApprove = async (request: TeamAccessRequest) => {\n    setProcessing(true);\n    try {\n      await approveRequest(request.id, reviewNotes);\n      setSelectedRequest(null);\n      setReviewNotes('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleReject = async (request: TeamAccessRequest) => {\n    setProcessing(true);\n    try {\n      await rejectRequest(request.id, reviewNotes);\n      setSelectedRequest(null);\n      setReviewNotes('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleCancel = async (requestId: string) => {\n    if (!confirm('')) return;\n\n    setProcessing(true);\n    try {\n      await cancelRequest(requestId);\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  // Debug log\n  console.log('TeamAccessRequestManagement render:', {\n    userId,\n    organizationId,\n    availableTeamsCount: availableTeams.length,\n    loading,\n    error\n  });\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300\">\n            <Clock className=\"h-3 w-3\" />\n            \n          </span>\n        );\n      case 'approved':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\">\n            <Check className=\"h-3 w-3\" />\n            \n          </span>\n        );\n      case 'rejected':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300\">\n            <X className=\"h-3 w-3\" />\n            \n          </span>\n        );\n      default:\n        return null;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n        <div className=\"flex items-center gap-2\">\n          <AlertCircle className=\"h-5 w-5 text-red-600 dark:text-red-400\" />\n          <p className=\"text-red-800 dark:text-red-200\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Users className=\"h-6 w-6\" />\n            \n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n            \n          </p>\n        </div>\n        {availableTeams.length > 0 && (\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n            <Plus className=\"h-4 w-4\" />\n            \n          </button>\n        )}\n      </div>\n\n      <div className=\"border-b border-gray-200 dark:border-gray-700\">\n        <nav className=\"flex gap-4\">\n          <button\n            onClick={() => setActiveTab('my')}\n            className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${\n              activeTab === 'my'\n                ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400'\n                : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n            }`}\n          >\n             ({myRequests.length})\n          </button>\n          <button\n            onClick={() => setActiveTab('pending')}\n            className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${\n              activeTab === 'pending'\n                ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400'\n                : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n            }`}\n          >\n             ({pendingRequests.length})\n          </button>\n          {isAdmin && (\n            <button\n              onClick={() => setActiveTab('all')}\n              className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${\n                activeTab === 'all'\n                  ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n              }`}\n            >\n               ({organizationRequests.length})\n            </button>\n          )}\n        </nav>\n      </div>\n\n      {activeTab === 'my' && (\n        <div className=\"space-y-4\">\n          {myRequests.length === 0 ? (\n            <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n              \n            </div>\n          ) : (\n            myRequests.map((request) => (\n              <div\n                key={request.id}\n                className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                        {request.team?.name}\n                      </h3>\n                      {getStatusBadge(request.status)}\n                    </div>\n                    {request.request_message && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                        {request.request_message}\n                      </p>\n                    )}\n                    {request.review_notes && (\n                      <div className=\"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded\">\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          <span className=\"font-medium\">:</span> {request.review_notes}\n                        </p>\n                      </div>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\n                      {new Date(request.created_at).toLocaleString('ja-JP')}\n                    </p>\n                  </div>\n                  {request.status === 'pending' && (\n                    <button\n                      onClick={() => handleCancel(request.id)}\n                      disabled={processing}\n                      className=\"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50\"\n                    >\n                      \n                    </button>\n                  )}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      )}\n\n      {activeTab === 'pending' && (\n        <div className=\"space-y-4\">\n          {pendingRequests.length === 0 ? (\n            <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n              \n            </div>\n          ) : (\n            pendingRequests.map((request) => (\n              <div\n                key={request.id}\n                className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                        {request.requester?.name}\n                      </h3>\n                      <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                         {request.team?.name} \n                      </span>\n                    </div>\n                    {request.request_message && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                        {request.request_message}\n                      </p>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\n                      {new Date(request.created_at).toLocaleString('ja-JP')}\n                    </p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => setSelectedRequest(request)}\n                      className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors\"\n                    >\n                      \n                    </button>\n                    <button\n                      onClick={() => {\n                        setSelectedRequest(request);\n                        setReviewNotes('');\n                      }}\n                      className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\"\n                    >\n                      \n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      )}\n\n      {activeTab === 'all' && isAdmin && (\n        <div className=\"space-y-4\">\n          {organizationRequests.length === 0 ? (\n            <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n              \n            </div>\n          ) : (\n            organizationRequests.map((request) => (\n              <div\n                key={request.id}\n                className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                        {request.requester?.name}\n                      </h3>\n                      <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                         {request.team?.name}\n                      </span>\n                      {getStatusBadge(request.status)}\n                    </div>\n                    {request.request_message && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                        {request.request_message}\n                      </p>\n                    )}\n                    {request.review_notes && (\n                      <div className=\"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded\">\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          <span className=\"font-medium\">:</span> {request.review_notes}\n                          {request.reviewer && ` by ${request.reviewer.name}`}\n                        </p>\n                      </div>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\n                      {new Date(request.created_at).toLocaleString('ja-JP')}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      )}\n\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              \n            </h3>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  \n                </label>\n                <select\n                  value={selectedTeamId}\n                  onChange={(e) => setSelectedTeamId(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                >\n                  <option value=\"\"></option>\n                  {availableTeams.map((team) => (\n                    <option key={team.id} value={team.id}>\n                      {team.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  \n                </label>\n                <textarea\n                  value={requestMessage}\n                  onChange={(e) => setRequestMessage(e.target.value)}\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                  placeholder=\"...\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => setShowCreateModal(false)}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n              <button\n                onClick={handleCreateRequest}\n                disabled={processing || !selectedTeamId}\n                className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n              >\n                {processing ? '...' : ''}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedRequest && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              \n            </h3>\n            <div className=\"space-y-4\">\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  <span className=\"font-medium\">:</span> {selectedRequest.requester?.name}\n                </p>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  <span className=\"font-medium\">:</span> {selectedRequest.team?.name}\n                </p>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  \n                </label>\n                <textarea\n                  value={reviewNotes}\n                  onChange={(e) => setReviewNotes(e.target.value)}\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                  placeholder=\"...\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => {\n                  setSelectedRequest(null);\n                  setReviewNotes('');\n                }}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n              <button\n                onClick={() => handleReject(selectedRequest)}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n              <button\n                onClick={() => handleApprove(selectedRequest)}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport { teamAccessQueries, TeamAccessRequest } from '../lib/teamAccessQueries';\n\nexport function useTeamAccessRequests(userId: string, organizationId?: string) {\n  const [myRequests, setMyRequests] = useState<TeamAccessRequest[]>([]);\n  const [pendingRequests, setPendingRequests] = useState<TeamAccessRequest[]>([]);\n  const [organizationRequests, setOrganizationRequests] = useState<TeamAccessRequest[]>([]);\n  const [availableTeams, setAvailableTeams] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadMyRequests = useCallback(async () => {\n    try {\n      const data = await teamAccessQueries.getMyRequests(userId);\n      setMyRequests(data);\n    } catch (err) {\n      console.error('Error loading my requests:', err);\n      throw err;\n    }\n  }, [userId]);\n\n  const loadPendingRequests = useCallback(async () => {\n    try {\n      const data = await teamAccessQueries.getPendingRequestsForMyTeams(userId);\n      setPendingRequests(data);\n    } catch (err) {\n      console.error('Error loading pending requests:', err);\n      throw err;\n    }\n  }, [userId]);\n\n  const loadOrganizationRequests = useCallback(async () => {\n    if (!organizationId) return;\n    try {\n      const data = await teamAccessQueries.getRequestsForOrganization(organizationId);\n      setOrganizationRequests(data);\n    } catch (err) {\n      console.error('Error loading organization requests:', err);\n      throw err;\n    }\n  }, [organizationId]);\n\n  const loadAvailableTeams = useCallback(async () => {\n    if (!organizationId) return;\n    try {\n      const data = await teamAccessQueries.getAvailableTeamsToRequest(userId, organizationId);\n      setAvailableTeams(data);\n    } catch (err) {\n      console.error('Error loading available teams:', err);\n      throw err;\n    }\n  }, [userId, organizationId]);\n\n  const loadAll = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const results = await Promise.allSettled([\n        loadMyRequests(),\n        loadPendingRequests(),\n        organizationId ? loadOrganizationRequests() : Promise.resolve(),\n        organizationId ? loadAvailableTeams() : Promise.resolve()\n      ]);\n\n      // Log any errors but don't fail the entire load\n      results.forEach((result, index) => {\n        if (result.status === 'rejected') {\n          const labels = ['myRequests', 'pendingRequests', 'organizationRequests', 'availableTeams'];\n          console.error(`Failed to load ${labels[index]}:`, result.reason);\n        }\n      });\n\n      // Only set error if all critical loads failed\n      const criticalFailures = results.filter((r, i) => i < 2 && r.status === 'rejected');\n      if (criticalFailures.length === 2) {\n        setError('Failed to load team access requests');\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load team access requests');\n    } finally {\n      setLoading(false);\n    }\n  }, [loadMyRequests, loadPendingRequests, loadOrganizationRequests, loadAvailableTeams, organizationId]);\n\n  useEffect(() => {\n    loadAll();\n  }, [loadAll]);\n\n  const createRequest = useCallback(async (teamId: string, message: string = '') => {\n    if (!organizationId) {\n      throw new Error('Organization ID is required');\n    }\n    try {\n      await teamAccessQueries.createRequest(userId, teamId, organizationId, message);\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to create request');\n    }\n  }, [userId, organizationId, loadAll]);\n\n  const approveRequest = useCallback(async (requestId: string, notes: string = '') => {\n    try {\n      await teamAccessQueries.approveRequest(requestId, userId, notes);\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to approve request');\n    }\n  }, [userId, loadAll]);\n\n  const rejectRequest = useCallback(async (requestId: string, notes: string = '') => {\n    try {\n      await teamAccessQueries.rejectRequest(requestId, userId, notes);\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to reject request');\n    }\n  }, [userId, loadAll]);\n\n  const cancelRequest = useCallback(async (requestId: string) => {\n    try {\n      await teamAccessQueries.cancelRequest(requestId);\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to cancel request');\n    }\n  }, [loadAll]);\n\n  return {\n    myRequests,\n    pendingRequests,\n    organizationRequests,\n    availableTeams,\n    loading,\n    error,\n    createRequest,\n    approveRequest,\n    rejectRequest,\n    cancelRequest,\n    refresh: loadAll\n  };\n}\n","import { supabase } from './supabase';\n\nexport interface AthleteTransferRequest {\n  id: string;\n  athlete_id: string;\n  from_team_id: string;\n  to_team_id: string;\n  organization_id: string;\n  requested_by: string;\n  status: 'pending' | 'approved' | 'rejected' | 'completed';\n  request_reason: string;\n  reviewed_by: string | null;\n  reviewed_at: string | null;\n  review_notes: string;\n  completed_at: string | null;\n  created_at: string;\n  updated_at: string;\n  athlete?: {\n    id: string;\n    name: string;\n    email: string;\n  };\n  from_team?: {\n    id: string;\n    name: string;\n  };\n  to_team?: {\n    id: string;\n    name: string;\n  };\n  requester?: {\n    id: string;\n    name: string;\n  };\n  reviewer?: {\n    id: string;\n    name: string;\n  };\n}\n\nexport interface TransferHistory {\n  id: string;\n  athlete_id: string;\n  from_team_id: string | null;\n  to_team_id: string;\n  organization_id: string;\n  transfer_request_id: string | null;\n  transferred_by: string;\n  transfer_reason: string;\n  transfer_date: string;\n  metadata: Record<string, unknown>;\n  athlete?: {\n    id: string;\n    name: string;\n  };\n  from_team?: {\n    id: string;\n    name: string;\n  };\n  to_team?: {\n    id: string;\n    name: string;\n  };\n  transferred_by_user?: {\n    id: string;\n    name: string;\n  };\n}\n\nexport const athleteTransferQueries = {\n  async getMyTransferRequests(userId: string) {\n    const { data, error } = await supabase\n      .from('athlete_transfer_requests')\n      .select(`\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        )\n      `)\n      .or(`athlete_id.eq.${userId},requested_by.eq.${userId}`)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as AthleteTransferRequest[];\n  },\n\n  async getPendingRequestsForMyTeams(userId: string) {\n    // First get the teams managed by this user\n    const { data: myTeams, error: teamsError } = await supabase\n      .from('staff_team_links')\n      .select('team_id')\n      .eq('staff_user_id', userId);\n\n    if (teamsError) throw teamsError;\n\n    const teamIds = myTeams?.map(t => t.team_id) || [];\n\n    if (teamIds.length === 0) {\n      return [];\n    }\n\n    // Then get the pending transfer requests for those teams\n    const { data, error } = await supabase\n      .from('athlete_transfer_requests')\n      .select(`\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        )\n      `)\n      .eq('status', 'pending')\n      .in('from_team_id', teamIds)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as AthleteTransferRequest[];\n  },\n\n  async getRequestsForOrganization(organizationId: string) {\n    const { data, error } = await supabase\n      .from('athlete_transfer_requests')\n      .select(`\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        ),\n        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      `)\n      .eq('organization_id', organizationId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as AthleteTransferRequest[];\n  },\n\n  async getAthletesInMyTeams(userId: string) {\n    const { data: myTeams, error: teamsError } = await supabase\n      .from('staff_team_links')\n      .select('team_id')\n      .eq('staff_user_id', userId);\n\n    if (teamsError) throw teamsError;\n\n    const teamIds = myTeams?.map(t => t.team_id) || [];\n\n    if (teamIds.length === 0) {\n      return [];\n    }\n\n    const { data, error } = await supabase\n      .from('users')\n      .select(`\n        id,\n        name,\n        email,\n        team_id,\n        team:teams (\n          id,\n          name\n        )\n      `)\n      .eq('role', 'athlete')\n      .in('team_id', teamIds)\n      .order('name');\n\n    if (error) throw error;\n    return data;\n  },\n\n  async getAvailableDestinationTeams(organizationId: string, currentTeamId: string) {\n    const { data, error } = await supabase\n      .from('teams')\n      .select('id, name, organization_id')\n      .eq('organization_id', organizationId)\n      .neq('id', currentTeamId)\n      .order('name');\n\n    if (error) throw error;\n    return data;\n  },\n\n  async createTransferRequest(\n    athleteId: string,\n    fromTeamId: string,\n    toTeamId: string,\n    organizationId: string,\n    requestedBy: string,\n    reason: string = ''\n  ) {\n    const { data, error } = await supabase\n      .from('athlete_transfer_requests')\n      .insert({\n        athlete_id: athleteId,\n        from_team_id: fromTeamId,\n        to_team_id: toTeamId,\n        organization_id: organizationId,\n        requested_by: requestedBy,\n        status: 'pending',\n        request_reason: reason\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as AthleteTransferRequest;\n  },\n\n  async approveTransfer(requestId: string, reviewerId: string, notes: string = '') {\n    const { error } = await supabase.rpc('approve_athlete_transfer', {\n      request_id: requestId,\n      reviewer_user_id: reviewerId,\n      notes: notes\n    });\n\n    if (error) throw error;\n  },\n\n  async rejectTransfer(requestId: string, reviewerId: string, notes: string = '') {\n    const { error } = await supabase.rpc('reject_athlete_transfer', {\n      request_id: requestId,\n      reviewer_user_id: reviewerId,\n      notes: notes\n    });\n\n    if (error) throw error;\n  },\n\n  async cancelTransferRequest(requestId: string) {\n    const { error } = await supabase\n      .from('athlete_transfer_requests')\n      .delete()\n      .eq('id', requestId)\n      .eq('status', 'pending');\n\n    if (error) throw error;\n  },\n\n  async getTransferHistory(athleteId: string) {\n    const { data, error } = await supabase\n      .from('team_transfer_history')\n      .select(`\n        *,\n        athlete:users!team_transfer_history_athlete_id_fkey (\n          id,\n          name\n        ),\n        from_team:teams!team_transfer_history_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!team_transfer_history_to_team_id_fkey (\n          id,\n          name\n        ),\n        transferred_by_user:users!team_transfer_history_transferred_by_fkey (\n          id,\n          name\n        )\n      `)\n      .eq('athlete_id', athleteId)\n      .order('transfer_date', { ascending: false });\n\n    if (error) throw error;\n    return data as TransferHistory[];\n  },\n\n  async getTeamTransferHistory(teamId: string) {\n    const { data, error } = await supabase\n      .from('team_transfer_history')\n      .select(`\n        *,\n        athlete:users!team_transfer_history_athlete_id_fkey (\n          id,\n          name\n        ),\n        from_team:teams!team_transfer_history_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!team_transfer_history_to_team_id_fkey (\n          id,\n          name\n        ),\n        transferred_by_user:users!team_transfer_history_transferred_by_fkey (\n          id,\n          name\n        )\n      `)\n      .or(`from_team_id.eq.${teamId},to_team_id.eq.${teamId}`)\n      .order('transfer_date', { ascending: false });\n\n    if (error) throw error;\n    return data as TransferHistory[];\n  },\n\n  async getRequestById(requestId: string) {\n    const { data, error } = await supabase\n      .from('athlete_transfer_requests')\n      .select(`\n        *,\n        athlete:users!athlete_transfer_requests_athlete_id_fkey (\n          id,\n          name,\n          email\n        ),\n        from_team:teams!athlete_transfer_requests_from_team_id_fkey (\n          id,\n          name\n        ),\n        to_team:teams!athlete_transfer_requests_to_team_id_fkey (\n          id,\n          name\n        ),\n        requester:users!athlete_transfer_requests_requested_by_fkey (\n          id,\n          name\n        ),\n        reviewer:users!athlete_transfer_requests_reviewed_by_fkey (\n          id,\n          name\n        )\n      `)\n      .eq('id', requestId)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data as AthleteTransferRequest | null;\n  }\n};\n","import React, { useState } from 'react';\nimport { useAthleteTransfers } from '../hooks/useAthleteTransfers';\nimport { UserCog, ArrowRight, Check, X, Clock, AlertCircle, History } from 'lucide-react';\nimport { AthleteTransferRequest, TransferHistory } from '../lib/athleteTransferQueries';\n\ninterface AthleteTransferManagementProps {\n  userId: string;\n  organizationId: string;\n  isAdmin?: boolean;\n}\n\nexport function AthleteTransferManagement({\n  userId,\n  organizationId,\n  isAdmin = false\n}: AthleteTransferManagementProps) {\n  const {\n    myRequests,\n    pendingRequests,\n    organizationRequests,\n    myAthletes,\n    loading,\n    error,\n    createTransferRequest,\n    approveTransfer,\n    rejectTransfer,\n    cancelTransferRequest,\n    getTransferHistory,\n    getAvailableDestinationTeams\n  } = useAthleteTransfers(userId, organizationId);\n\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [selectedAthlete, setSelectedAthlete] = useState<any>(null);\n  const [destinationTeamId, setDestinationTeamId] = useState('');\n  const [transferReason, setTransferReason] = useState('');\n  const [reviewNotes, setReviewNotes] = useState('');\n  const [selectedRequest, setSelectedRequest] = useState<AthleteTransferRequest | null>(null);\n  const [processing, setProcessing] = useState(false);\n  const [activeTab, setActiveTab] = useState<'my' | 'pending' | 'all'>('my');\n  const [availableTeams, setAvailableTeams] = useState<any[]>([]);\n  const [viewingHistory, setViewingHistory] = useState(false);\n  const [historyData, setHistoryData] = useState<TransferHistory[]>([]);\n\n  const handleSelectAthlete = async (athlete: any) => {\n    setSelectedAthlete(athlete);\n    try {\n      const teams = await getAvailableDestinationTeams(athlete.team_id);\n      setAvailableTeams(teams);\n      setShowCreateModal(true);\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    }\n  };\n\n  const handleCreateRequest = async () => {\n    if (!selectedAthlete || !destinationTeamId) return;\n\n    setProcessing(true);\n    try {\n      await createTransferRequest(\n        selectedAthlete.id,\n        selectedAthlete.team_id,\n        destinationTeamId,\n        transferReason\n      );\n      setShowCreateModal(false);\n      setSelectedAthlete(null);\n      setDestinationTeamId('');\n      setTransferReason('');\n      setAvailableTeams([]);\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleApprove = async (request: AthleteTransferRequest) => {\n    if (!confirm(`${request.athlete?.name}`)) return;\n\n    setProcessing(true);\n    try {\n      await approveTransfer(request.id, reviewNotes);\n      setSelectedRequest(null);\n      setReviewNotes('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleReject = async (request: AthleteTransferRequest) => {\n    setProcessing(true);\n    try {\n      await rejectTransfer(request.id, reviewNotes);\n      setSelectedRequest(null);\n      setReviewNotes('');\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleCancel = async (requestId: string) => {\n    if (!confirm('')) return;\n\n    setProcessing(true);\n    try {\n      await cancelTransferRequest(requestId);\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleViewHistory = async (athleteId: string) => {\n    try {\n      const history = await getTransferHistory(athleteId);\n      setHistoryData(history);\n      setViewingHistory(true);\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '');\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300\">\n            <Clock className=\"h-3 w-3\" />\n            \n          </span>\n        );\n      case 'approved':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300\">\n            <Check className=\"h-3 w-3\" />\n            \n          </span>\n        );\n      case 'completed':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\">\n            <Check className=\"h-3 w-3\" />\n            \n          </span>\n        );\n      case 'rejected':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300\">\n            <X className=\"h-3 w-3\" />\n            \n          </span>\n        );\n      default:\n        return null;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n        <div className=\"flex items-center gap-2\">\n          <AlertCircle className=\"h-5 w-5 text-red-600 dark:text-red-400\" />\n          <p className=\"text-red-800 dark:text-red-200\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <UserCog className=\"h-6 w-6\" />\n            \n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n            \n          </p>\n        </div>\n      </div>\n\n      <div className=\"border-b border-gray-200 dark:border-gray-700\">\n        <nav className=\"flex gap-4\">\n          <button\n            onClick={() => setActiveTab('my')}\n            className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${\n              activeTab === 'my'\n                ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400'\n                : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n            }`}\n          >\n             ({myRequests.length})\n          </button>\n          <button\n            onClick={() => setActiveTab('pending')}\n            className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${\n              activeTab === 'pending'\n                ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400'\n                : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n            }`}\n          >\n             ({pendingRequests.length})\n          </button>\n          {isAdmin && (\n            <button\n              onClick={() => setActiveTab('all')}\n              className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${\n                activeTab === 'all'\n                  ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n              }`}\n            >\n               ({organizationRequests.length})\n            </button>\n          )}\n        </nav>\n      </div>\n\n      {activeTab === 'my' && (\n        <div className=\"space-y-6\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              \n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {myAthletes.map((athlete) => (\n                <div\n                  key={athlete.id}\n                  className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n                >\n                  <h4 className=\"font-semibold text-gray-900 dark:text-white\">\n                    {athlete.name}\n                  </h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                    {athlete.team?.name}\n                  </p>\n                  <div className=\"flex gap-2 mt-3\">\n                    <button\n                      onClick={() => handleSelectAthlete(athlete)}\n                      className=\"flex-1 px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n                    >\n                      \n                    </button>\n                    <button\n                      onClick={() => handleViewHistory(athlete.id)}\n                      className=\"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                    >\n                      <History className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              \n            </h3>\n            <div className=\"space-y-4\">\n              {myRequests.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                  \n                </div>\n              ) : (\n                myRequests.map((request) => (\n                  <div\n                    key={request.id}\n                    className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <span className=\"font-semibold text-gray-900 dark:text-white\">\n                            {request.athlete?.name}\n                          </span>\n                          {getStatusBadge(request.status)}\n                        </div>\n                        <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                          <span>{request.from_team?.name}</span>\n                          <ArrowRight className=\"h-4 w-4\" />\n                          <span>{request.to_team?.name}</span>\n                        </div>\n                        {request.request_reason && (\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                            : {request.request_reason}\n                          </p>\n                        )}\n                        {request.review_notes && (\n                          <div className=\"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded\">\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                              <span className=\"font-medium\">:</span> {request.review_notes}\n                            </p>\n                          </div>\n                        )}\n                        <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\n                          {new Date(request.created_at).toLocaleString('ja-JP')}\n                        </p>\n                      </div>\n                      {request.status === 'pending' && (\n                        <button\n                          onClick={() => handleCancel(request.id)}\n                          disabled={processing}\n                          className=\"ml-4 px-3 py-1 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 rounded transition-colors disabled:opacity-50\"\n                        >\n                          \n                        </button>\n                      )}\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {activeTab === 'pending' && (\n        <div className=\"space-y-4\">\n          {pendingRequests.length === 0 ? (\n            <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n              \n            </div>\n          ) : (\n            pendingRequests.map((request) => (\n              <div\n                key={request.id}\n                className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <span className=\"font-semibold text-gray-900 dark:text-white\">\n                        {request.athlete?.name}\n                      </span>\n                      <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                        \n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2\">\n                      <span>{request.from_team?.name}</span>\n                      <ArrowRight className=\"h-4 w-4\" />\n                      <span>{request.to_team?.name}</span>\n                    </div>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      : {request.requester?.name}\n                    </p>\n                    {request.request_reason && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                        : {request.request_reason}\n                      </p>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\n                      {new Date(request.created_at).toLocaleString('ja-JP')}\n                    </p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => setSelectedRequest(request)}\n                      className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors\"\n                    >\n                      \n                    </button>\n                    <button\n                      onClick={() => {\n                        setSelectedRequest(request);\n                        setReviewNotes('');\n                      }}\n                      className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\"\n                    >\n                      \n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      )}\n\n      {activeTab === 'all' && isAdmin && (\n        <div className=\"space-y-4\">\n          {organizationRequests.length === 0 ? (\n            <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n              \n            </div>\n          ) : (\n            organizationRequests.map((request) => (\n              <div\n                key={request.id}\n                className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <span className=\"font-semibold text-gray-900 dark:text-white\">\n                        {request.athlete?.name}\n                      </span>\n                      {getStatusBadge(request.status)}\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2\">\n                      <span>{request.from_team?.name}</span>\n                      <ArrowRight className=\"h-4 w-4\" />\n                      <span>{request.to_team?.name}</span>\n                    </div>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      : {request.requester?.name}\n                    </p>\n                    {request.request_reason && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                        : {request.request_reason}\n                      </p>\n                    )}\n                    {request.review_notes && (\n                      <div className=\"mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded\">\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          <span className=\"font-medium\">:</span> {request.review_notes}\n                          {request.reviewer && ` by ${request.reviewer.name}`}\n                        </p>\n                      </div>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-2\">\n                      {new Date(request.created_at).toLocaleString('ja-JP')}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      )}\n\n      {showCreateModal && selectedAthlete && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              \n            </h3>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  \n                </label>\n                <p className=\"text-gray-900 dark:text-white\">{selectedAthlete.name}</p>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  : {selectedAthlete.team?.name}\n                </p>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  \n                </label>\n                <select\n                  value={destinationTeamId}\n                  onChange={(e) => setDestinationTeamId(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                >\n                  <option value=\"\"></option>\n                  {availableTeams.map((team) => (\n                    <option key={team.id} value={team.id}>\n                      {team.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  \n                </label>\n                <textarea\n                  value={transferReason}\n                  onChange={(e) => setTransferReason(e.target.value)}\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                  placeholder=\"...\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => {\n                  setShowCreateModal(false);\n                  setSelectedAthlete(null);\n                  setDestinationTeamId('');\n                  setTransferReason('');\n                  setAvailableTeams([]);\n                }}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n              <button\n                onClick={handleCreateRequest}\n                disabled={processing || !destinationTeamId}\n                className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n              >\n                {processing ? '...' : ''}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedRequest && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              \n            </h3>\n            <div className=\"space-y-4\">\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  <span className=\"font-medium\">:</span> {selectedRequest.athlete?.name}\n                </p>\n                <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                  <span>{selectedRequest.from_team?.name}</span>\n                  <ArrowRight className=\"h-4 w-4\" />\n                  <span>{selectedRequest.to_team?.name}</span>\n                </div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                  <span className=\"font-medium\">:</span> {selectedRequest.requester?.name}\n                </p>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  \n                </label>\n                <textarea\n                  value={reviewNotes}\n                  onChange={(e) => setReviewNotes(e.target.value)}\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                  placeholder=\"...\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => {\n                  setSelectedRequest(null);\n                  setReviewNotes('');\n                }}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n              <button\n                onClick={() => handleReject(selectedRequest)}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n              <button\n                onClick={() => handleApprove(selectedRequest)}\n                disabled={processing}\n                className=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50\"\n              >\n                \n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {viewingHistory && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                \n              </h3>\n              <button\n                onClick={() => setViewingHistory(false)}\n                className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300\"\n              >\n                <X className=\"h-5 w-5\" />\n              </button>\n            </div>\n            <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n              {historyData.length === 0 ? (\n                <p className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                  \n                </p>\n              ) : (\n                historyData.map((history) => (\n                  <div\n                    key={history.id}\n                    className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-3\"\n                  >\n                    <div className=\"flex items-center gap-2 text-sm mb-1\">\n                      {history.from_team ? (\n                        <>\n                          <span className=\"text-gray-600 dark:text-gray-400\">\n                            {history.from_team.name}\n                          </span>\n                          <ArrowRight className=\"h-4 w-4\" />\n                        </>\n                      ) : (\n                        <span className=\"text-gray-600 dark:text-gray-400\"></span>\n                      )}\n                      <span className=\"text-gray-900 dark:text-white font-medium\">\n                        {history.to_team.name}\n                      </span>\n                    </div>\n                    {history.transfer_reason && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        {history.transfer_reason}\n                      </p>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\n                      {new Date(history.transfer_date).toLocaleString('ja-JP')} by{' '}\n                      {history.transferred_by_user?.name}\n                    </p>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport { athleteTransferQueries, AthleteTransferRequest, TransferHistory } from '../lib/athleteTransferQueries';\n\nexport function useAthleteTransfers(userId: string, organizationId?: string) {\n  const [myRequests, setMyRequests] = useState<AthleteTransferRequest[]>([]);\n  const [pendingRequests, setPendingRequests] = useState<AthleteTransferRequest[]>([]);\n  const [organizationRequests, setOrganizationRequests] = useState<AthleteTransferRequest[]>([]);\n  const [myAthletes, setMyAthletes] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadMyRequests = useCallback(async () => {\n    try {\n      const data = await athleteTransferQueries.getMyTransferRequests(userId);\n      setMyRequests(data);\n    } catch (err) {\n      console.error('Error loading my transfer requests:', err);\n      throw err;\n    }\n  }, [userId]);\n\n  const loadPendingRequests = useCallback(async () => {\n    try {\n      const data = await athleteTransferQueries.getPendingRequestsForMyTeams(userId);\n      setPendingRequests(data);\n    } catch (err) {\n      console.error('Error loading pending transfer requests:', err);\n      throw err;\n    }\n  }, [userId]);\n\n  const loadOrganizationRequests = useCallback(async () => {\n    if (!organizationId) return;\n    try {\n      const data = await athleteTransferQueries.getRequestsForOrganization(organizationId);\n      setOrganizationRequests(data);\n    } catch (err) {\n      console.error('Error loading organization transfer requests:', err);\n      throw err;\n    }\n  }, [organizationId]);\n\n  const loadMyAthletes = useCallback(async () => {\n    try {\n      const data = await athleteTransferQueries.getAthletesInMyTeams(userId);\n      setMyAthletes(data);\n    } catch (err) {\n      console.error('Error loading my athletes:', err);\n      throw err;\n    }\n  }, [userId]);\n\n  const loadAll = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      await Promise.all([\n        loadMyRequests(),\n        loadPendingRequests(),\n        loadMyAthletes(),\n        organizationId ? loadOrganizationRequests() : Promise.resolve()\n      ]);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load transfer requests');\n    } finally {\n      setLoading(false);\n    }\n  }, [loadMyRequests, loadPendingRequests, loadMyAthletes, loadOrganizationRequests, organizationId]);\n\n  useEffect(() => {\n    loadAll();\n  }, [loadAll]);\n\n  const createTransferRequest = useCallback(async (\n    athleteId: string,\n    fromTeamId: string,\n    toTeamId: string,\n    reason: string = ''\n  ) => {\n    if (!organizationId) {\n      throw new Error('Organization ID is required');\n    }\n    try {\n      await athleteTransferQueries.createTransferRequest(\n        athleteId,\n        fromTeamId,\n        toTeamId,\n        organizationId,\n        userId,\n        reason\n      );\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to create transfer request');\n    }\n  }, [userId, organizationId, loadAll]);\n\n  const approveTransfer = useCallback(async (requestId: string, notes: string = '') => {\n    try {\n      await athleteTransferQueries.approveTransfer(requestId, userId, notes);\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to approve transfer');\n    }\n  }, [userId, loadAll]);\n\n  const rejectTransfer = useCallback(async (requestId: string, notes: string = '') => {\n    try {\n      await athleteTransferQueries.rejectTransfer(requestId, userId, notes);\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to reject transfer');\n    }\n  }, [userId, loadAll]);\n\n  const cancelTransferRequest = useCallback(async (requestId: string) => {\n    try {\n      await athleteTransferQueries.cancelTransferRequest(requestId);\n      await loadAll();\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to cancel transfer request');\n    }\n  }, [loadAll]);\n\n  const getTransferHistory = useCallback(async (athleteId: string): Promise<TransferHistory[]> => {\n    try {\n      return await athleteTransferQueries.getTransferHistory(athleteId);\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to get transfer history');\n    }\n  }, []);\n\n  const getAvailableDestinationTeams = useCallback(async (currentTeamId: string) => {\n    if (!organizationId) {\n      throw new Error('Organization ID is required');\n    }\n    try {\n      return await athleteTransferQueries.getAvailableDestinationTeams(organizationId, currentTeamId);\n    } catch (err) {\n      throw new Error(err instanceof Error ? err.message : 'Failed to get available teams');\n    }\n  }, [organizationId]);\n\n  return {\n    myRequests,\n    pendingRequests,\n    organizationRequests,\n    myAthletes,\n    loading,\n    error,\n    createTransferRequest,\n    approveTransfer,\n    rejectTransfer,\n    cancelTransferRequest,\n    getTransferHistory,\n    getAvailableDestinationTeams,\n    refresh: loadAll\n  };\n}\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { organizationQueries } from '../lib/organizationQueries';\nimport { supabase } from '../lib/supabase';\nimport { Users, Plus, Trash2, Shield, Search, UserPlus, RefreshCcw, CheckCircle, AlertTriangle } from 'lucide-react';\nimport type { Database } from '../lib/database.types';\n\ntype OrganizationMember = Database['public']['Tables']['organization_members']['Row'];\ntype User = Database['public']['Tables']['users']['Row'];\n\ninterface OrganizationMembersManagementProps {\n  organizationId: string;\n  organizationName: string;\n}\n\ntype SendStatus = 'idle' | 'sending' | 'success' | 'error';\n\nfunction normalizeEmail(v: string) {\n  return v.trim().toLowerCase();\n}\n\nexport function OrganizationMembersManagement({\n  organizationId,\n  organizationName\n}: OrganizationMembersManagementProps) {\n  const [members, setMembers] = useState<any[]>([]);\n  const [availableUsers, setAvailableUsers] = useState<User[]>([]);\n  const [organizationTeams, setOrganizationTeams] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [showAssignTeamModal, setShowAssignTeamModal] = useState(false);\n  const [selectedMemberForTeam, setSelectedMemberForTeam] = useState<any | null>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n\n  //  \n  const [sendStateByEmail, setSendStateByEmail] = useState<Record<string, SendStatus>>({});\n  const [sendMsgByEmail, setSendMsgByEmail] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    loadMembers();\n    loadAvailableUsers();\n    loadOrganizationTeams();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [organizationId]);\n\n  const loadMembers = async () => {\n    try {\n      setLoading(true);\n      const data = await organizationQueries.getOrganizationMembers(organizationId);\n      setMembers(data || []);\n    } catch (error) {\n      console.error('Error loading members:', error);\n      alert('');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadAvailableUsers = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('users')\n        .select('*')\n        .order('name');\n\n      if (error) throw error;\n      setAvailableUsers(data || []);\n    } catch (error) {\n      console.error('Error loading users:', error);\n    }\n  };\n\n  const loadOrganizationTeams = async () => {\n    try {\n      const teams = await organizationQueries.getOrganizationTeams(organizationId);\n      setOrganizationTeams(teams || []);\n    } catch (error) {\n      console.error('Error loading organization teams:', error);\n    }\n  };\n\n  const handleAssignToTeam = async (userId: string, teamId: string) => {\n    try {\n      const { error } = await supabase.rpc('assign_user_to_team', {\n        p_user_id: userId,\n        p_team_id: teamId,\n        p_organization_id: organizationId,\n        p_assignment_type: 'primary'\n      });\n\n      if (error) throw error;\n\n      await loadMembers();\n      setShowAssignTeamModal(false);\n      setSelectedMemberForTeam(null);\n      alert('');\n    } catch (error) {\n      console.error('Error assigning to team:', error);\n      alert(': ' + (error instanceof Error ? error.message : ''));\n    }\n  };\n\n  const handleAddMember = async (userId: string, role: OrganizationMember['role']) => {\n    try {\n      await organizationQueries.addOrganizationMember({\n        user_id: userId,\n        organization_id: organizationId,\n        role\n      });\n      await loadMembers();\n      setShowAddModal(false);\n      alert('');\n    } catch (error) {\n      console.error('Error adding member:', error);\n      alert(': ' + (error instanceof Error ? error.message : ''));\n    }\n  };\n\n  const handleUpdateRole = async (memberId: string, newRole: OrganizationMember['role']) => {\n    try {\n      await organizationQueries.updateOrganizationMemberRole(memberId, newRole);\n      await loadMembers();\n      alert('');\n    } catch (error) {\n      console.error('Error updating role:', error);\n      alert('');\n    }\n  };\n\n  const handleRemoveMember = async (memberId: string) => {\n    if (!confirm('')) return;\n\n    try {\n      await organizationQueries.removeOrganizationMember(memberId);\n      await loadMembers();\n      alert('');\n    } catch (error) {\n      console.error('Error removing member:', error);\n      alert('');\n    }\n  };\n\n  //  recovery\n  const handleResendPasswordLink = async (rawEmail: string) => {\n    const email = normalizeEmail(rawEmail);\n    if (!email) return;\n\n    // \n    if (sendStateByEmail[email] === 'sending') return;\n\n    setSendStateByEmail((prev) => ({ ...prev, [email]: 'sending' }));\n    setSendMsgByEmail((prev) => ({ ...prev, [email]: '' }));\n\n    try {\n      const { data, error } = await supabase.functions.invoke('request-password-reset', {\n        body: {\n          email,\n          redirectUrl: `${window.location.origin}/reset-password`,\n        },\n      });\n\n      if (error) {\n        console.error('[OrganizationMembersManagement] request-password-reset error:', error);\n        setSendStateByEmail((prev) => ({ ...prev, [email]: 'error' }));\n        setSendMsgByEmail((prev) => ({ ...prev, [email]: '' }));\n        return;\n      }\n\n      console.log('[OrganizationMembersManagement] request-password-reset result:', data);\n\n      //  success OK\n      setSendStateByEmail((prev) => ({ ...prev, [email]: 'success' }));\n      setSendMsgByEmail((prev) => ({ ...prev, [email]: '' }));\n\n      // \n      window.setTimeout(() => {\n        setSendStateByEmail((prev) => ({ ...prev, [email]: 'idle' }));\n        setSendMsgByEmail((prev) => ({ ...prev, [email]: '' }));\n      }, 5000);\n    } catch (err: any) {\n      console.error('[OrganizationMembersManagement] exception:', err);\n      setSendStateByEmail((prev) => ({ ...prev, [email]: 'error' }));\n      setSendMsgByEmail((prev) => ({ ...prev, [email]: err?.message || '' }));\n    }\n  };\n\n  const getRoleIcon = (role: string) => {\n    switch (role) {\n      case 'organization_admin':\n        return <Shield className=\"h-4 w-4 text-blue-600\" />;\n      case 'member':\n        return <Users className=\"h-4 w-4 text-gray-600\" />;\n      default:\n        return <Users className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getRoleLabel = (role: string) => {\n    switch (role) {\n      case 'organization_admin':\n        return '';\n      case 'member':\n        return '';\n      default:\n        return role;\n    }\n  };\n\n  const getRoleBadgeColor = (role: string) => {\n    switch (role) {\n      case 'organization_admin':\n        return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\n      case 'member':\n        return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const filteredMembers = useMemo(() => {\n    return members.filter(member => {\n      if (!searchQuery) return true;\n      const user = member.users;\n      if (!user) return false;\n      const searchLower = searchQuery.toLowerCase();\n      return (\n        user.name?.toLowerCase().includes(searchLower) ||\n        user.email?.toLowerCase().includes(searchLower)\n      );\n    });\n  }, [members, searchQuery]);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Users className=\"h-6 w-6\" />\n            \n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n            {organizationName}\n          </p>\n        </div>\n        <button\n          onClick={() => setShowAddModal(true)}\n          className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          \n        </button>\n      </div>\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 p-4\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n          <input\n            type=\"text\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            placeholder=\"...\"\n            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n          />\n        </div>\n      </div>\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700\">\n        <div className=\"p-6 border-b dark:border-gray-700\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n               ({filteredMembers.length})\n            </h3>\n          </div>\n        </div>\n\n        <div className=\"divide-y dark:divide-gray-700\">\n          {filteredMembers.length === 0 ? (\n            <div className=\"p-6 text-center text-gray-500 dark:text-gray-400\">\n              {searchQuery ? '' : ''}\n            </div>\n          ) : (\n            filteredMembers.map((member) => (\n              <MemberCard\n                key={member.id}\n                member={member}\n                onUpdateRole={handleUpdateRole}\n                onRemove={handleRemoveMember}\n                onAssignTeam={(m) => {\n                  setSelectedMemberForTeam(m);\n                  setShowAssignTeamModal(true);\n                }}\n                onResendPasswordLink={handleResendPasswordLink}\n                sendStateByEmail={sendStateByEmail}\n                sendMsgByEmail={sendMsgByEmail}\n                getRoleIcon={getRoleIcon}\n                getRoleLabel={getRoleLabel}\n                getRoleBadgeColor={getRoleBadgeColor}\n              />\n            ))\n          )}\n        </div>\n      </div>\n\n      {showAddModal && (\n        <AddMemberModal\n          organizationId={organizationId}\n          existingMembers={members}\n          availableUsers={availableUsers}\n          onClose={() => setShowAddModal(false)}\n          onAdd={handleAddMember}\n          getRoleIcon={getRoleIcon}\n          getRoleLabel={getRoleLabel}\n        />\n      )}\n\n      {showAssignTeamModal && selectedMemberForTeam && (\n        <AssignTeamModal\n          member={selectedMemberForTeam}\n          teams={organizationTeams}\n          onClose={() => {\n            setShowAssignTeamModal(false);\n            setSelectedMemberForTeam(null);\n          }}\n          onAssign={handleAssignToTeam}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction MemberCard({\n  member,\n  onUpdateRole,\n  onRemove,\n  onAssignTeam,\n  onResendPasswordLink,\n  sendStateByEmail,\n  sendMsgByEmail,\n  getRoleIcon,\n  getRoleLabel,\n  getRoleBadgeColor\n}: {\n  member: any;\n  onUpdateRole: (memberId: string, role: OrganizationMember['role']) => void;\n  onRemove: (memberId: string) => void;\n  onAssignTeam: (member: any) => void;\n  onResendPasswordLink: (email: string) => void;\n  sendStateByEmail: Record<string, SendStatus>;\n  sendMsgByEmail: Record<string, string>;\n  getRoleIcon: (role: string) => React.ReactNode;\n  getRoleLabel: (role: string) => string;\n  getRoleBadgeColor: (role: string) => string;\n}) {\n  const user = member.users;\n  if (!user) return null;\n\n  const emailKey = normalizeEmail(user.email || '');\n  const sendState = sendStateByEmail[emailKey] || 'idle';\n  const sendMsg = sendMsgByEmail[emailKey] || '';\n  const isSending = sendState === 'sending';\n\n  return (\n    <div className=\"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\n      <div className=\"flex items-start justify-between gap-3\">\n        <div className=\"flex items-center gap-4 flex-1 min-w-0\">\n          <div className=\"flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center\">\n            <span className=\"text-blue-600 dark:text-blue-200 font-semibold\">\n              {user.name?.[0]?.toUpperCase() || user.email?.[0]?.toUpperCase() || '?'}\n            </span>\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <h4 className=\"font-medium text-gray-900 dark:text-white truncate\">\n                {user.name || 'Unknown User'}\n              </h4>\n              <span className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${getRoleBadgeColor(member.role)}`}>\n                {getRoleIcon(member.role)}\n                {getRoleLabel(member.role)}\n              </span>\n            </div>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n              {user.email}\n            </p>\n            <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\n              : {new Date(member.created_at).toLocaleDateString('ja-JP')}\n            </p>\n\n            {/*   */}\n            {sendMsg && (\n              <div\n                className={`mt-2 text-xs rounded-md px-2 py-1 inline-flex items-start gap-1 border ${\n                  sendState === 'success'\n                    ? 'bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200'\n                    : sendState === 'error'\n                      ? 'bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200'\n                      : 'bg-gray-50 border-gray-200 text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200'\n                }`}\n              >\n                {sendState === 'success' ? (\n                  <CheckCircle className=\"h-3.5 w-3.5 mt-0.5\" />\n                ) : sendState === 'error' ? (\n                  <AlertTriangle className=\"h-3.5 w-3.5 mt-0.5\" />\n                ) : null}\n                <span>{sendMsg}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2 ml-2 flex-shrink-0\">\n          <button\n            onClick={() => onAssignTeam(member)}\n            className=\"px-3 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1\"\n            title=\"\"\n          >\n            <UserPlus className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\"></span>\n          </button>\n\n          {/*   */}\n          <button\n            onClick={() => onResendPasswordLink(user.email)}\n            disabled={!user.email || isSending}\n            className=\"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\n                       disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1\"\n            title=\"\"\n          >\n            {isSending ? (\n              <>\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                <span className=\"hidden sm:inline\"></span>\n              </>\n            ) : (\n              <>\n                <RefreshCcw className=\"h-4 w-4\" />\n                <span className=\"hidden sm:inline\"></span>\n              </>\n            )}\n          </button>\n\n          <select\n            value={member.role}\n            onChange={(e) => onUpdateRole(member.id, e.target.value as OrganizationMember['role'])}\n            className=\"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n          >\n            <option value=\"organization_admin\"></option>\n            <option value=\"member\"></option>\n          </select>\n\n          <button\n            onClick={() => onRemove(member.id)}\n            className=\"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors\"\n            title=\"\"\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction AddMemberModal({\n  organizationId,\n  existingMembers,\n  availableUsers,\n  onClose,\n  onAdd,\n  getRoleIcon,\n  getRoleLabel\n}: {\n  organizationId: string;\n  existingMembers: any[];\n  availableUsers: User[];\n  onClose: () => void;\n  onAdd: (userId: string, role: OrganizationMember['role']) => Promise<void>;\n  getRoleIcon: (role: string) => React.ReactNode;\n  getRoleLabel: (role: string) => string;\n}) {\n  const [selectedUserId, setSelectedUserId] = useState('');\n  const [selectedRole, setSelectedRole] = useState<OrganizationMember['role']>('organization_admin');\n  const [submitting, setSubmitting] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const existingMemberUserIds = new Set(existingMembers.map(m => m.user_id));\n  const availableUsersFiltered = availableUsers.filter(user => !existingMemberUserIds.has(user.id));\n\n  const filteredUsers = availableUsersFiltered.filter(user => {\n    if (!searchQuery) return true;\n    const searchLower = searchQuery.toLowerCase();\n    return (\n      user.name?.toLowerCase().includes(searchLower) ||\n      user.email?.toLowerCase().includes(searchLower)\n    );\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedUserId) {\n      alert('');\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      await onAdd(selectedUserId, selectedRole);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const roles: { value: OrganizationMember['role']; label: string; description: string }[] = [\n    {\n      value: 'organization_admin',\n      label: '',\n      description: 'GM'\n    },\n    {\n      value: 'member',\n      label: '',\n      description: '/'\n    }\n  ];\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        <form onSubmit={handleSubmit}>\n          <div className=\"p-6 border-b dark:border-gray-700\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              \n            </h3>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n              \n            </p>\n          </div>\n\n          <div className=\"p-6 space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                 <span className=\"text-red-600\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                placeholder=\"...\"\n                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-3\"\n              />\n              <div className=\"border dark:border-gray-600 rounded-lg max-h-60 overflow-y-auto\">\n                {filteredUsers.length === 0 ? (\n                  <div className=\"p-4 text-center text-gray-500 dark:text-gray-400\">\n                    {searchQuery ? '' : ''}\n                  </div>\n                ) : (\n                  <div className=\"divide-y dark:divide-gray-700\">\n                    {filteredUsers.map((user) => (\n                      <label\n                        key={user.id}\n                        className={`flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${\n                          selectedUserId === user.id ? 'bg-blue-50 dark:bg-blue-900/20' : ''\n                        }`}\n                      >\n                        <input\n                          type=\"radio\"\n                          name=\"user\"\n                          value={user.id}\n                          checked={selectedUserId === user.id}\n                          onChange={(e) => setSelectedUserId(e.target.value)}\n                          className=\"h-4 w-4 text-blue-600\"\n                        />\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"font-medium text-gray-900 dark:text-white truncate\">\n                            {user.name || 'Unknown User'}\n                          </div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n                            {user.email}\n                          </div>\n                          {user.role && (\n                            <div className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\n                              : {user.role}\n                            </div>\n                          )}\n                        </div>\n                      </label>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n                 <span className=\"text-red-600\">*</span>\n              </label>\n              <div className=\"space-y-3\">\n                {roles.map((role) => (\n                  <label\n                    key={role.value}\n                    className={`flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-colors ${\n                      selectedRole === role.value\n                        ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400'\n                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n                    }`}\n                  >\n                    <input\n                      type=\"radio\"\n                      name=\"role\"\n                      value={role.value}\n                      checked={selectedRole === role.value}\n                      onChange={(e) => setSelectedRole(e.target.value as OrganizationMember['role'])}\n                      className=\"mt-1 h-4 w-4 text-blue-600\"\n                    />\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        {getRoleIcon(role.value)}\n                        <span className=\"font-medium text-gray-900 dark:text-white\">\n                          {role.label}\n                        </span>\n                      </div>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                        {role.description}\n                      </p>\n                    </div>\n                  </label>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n              disabled={submitting}\n            >\n              \n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\n              disabled={submitting || !selectedUserId}\n            >\n              {submitting ? '...' : ''}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nfunction AssignTeamModal({\n  member,\n  teams,\n  onClose,\n  onAssign\n}: {\n  member: any;\n  teams: any[];\n  onClose: () => void;\n  onAssign: (userId: string, teamId: string) => Promise<void>;\n}) {\n  const [selectedTeamId, setSelectedTeamId] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n\n  const user = member.users;\n  if (!user) return null;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedTeamId) {\n      alert('');\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      await onAssign(user.id, selectedTeamId);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n        <form onSubmit={handleSubmit}>\n          <div className=\"p-6 border-b dark:border-gray-700\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              \n            </h3>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n              {user.name}\n            </p>\n          </div>\n\n          <div className=\"p-6 space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                 <span className=\"text-red-600\">*</span>\n              </label>\n              <select\n                value={selectedTeamId}\n                onChange={(e) => setSelectedTeamId(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                required\n              >\n                <option value=\"\">...</option>\n                {teams.map((team) => (\n                  <option key={team.id} value={team.id}>\n                    {team.name}\n                  </option>\n                ))}\n              </select>\n              {teams.length === 0 && (\n                <p className=\"text-sm text-amber-600 dark:text-amber-400 mt-2\">\n                  \n                </p>\n              )}\n            </div>\n\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\n              <p className=\"text-sm text-blue-800 dark:text-blue-200\">\n                <strong>:</strong> \n              </p>\n            </div>\n          </div>\n\n          <div className=\"px-6 py-4 bg-gray-50 dark:bg-gray-900 rounded-b-lg flex justify-end gap-3 border-t dark:border-gray-700\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n              disabled={submitting}\n            >\n              \n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center gap-2\"\n              disabled={submitting || !selectedTeamId || teams.length === 0}\n            >\n              {submitting ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  <span>...</span>\n                </>\n              ) : (\n                <>\n                  <UserPlus className=\"h-4 w-4\" />\n                  <span></span>\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}","import React, { useMemo, useState } from \"react\";\nimport { Upload, FileText, CheckCircle2, AlertTriangle, Loader2 } from \"lucide-react\";\nimport { supabase } from \"../lib/supabase\";\n\ntype ParsedRow = {\n  rowIndex: number;\n  phone_number: string;\n  measured_at: string; // YYYY-MM-DD\n  height: number | null;\n  weight: number | null;\n  body_fat_percent: number | null;\n  raw: Record<string, string>;\n};\n\ntype RowError = {\n  rowIndex: number;\n  message: string;\n  raw: Record<string, string>;\n};\n\nconst MAX_ROWS = 2000;\nconst UPSERT_CHUNK = 200; // UIEdge/\n\nfunction parseCSV(text: string): string[][] {\n  const rows: string[][] = [];\n  let row: string[] = [];\n  let field = \"\";\n  let inQuotes = false;\n\n  for (let i = 0; i < text.length; i++) {\n    const c = text[i];\n    const next = text[i + 1];\n\n    if (c === '\"') {\n      if (inQuotes && next === '\"') {\n        field += '\"';\n        i++;\n      } else {\n        inQuotes = !inQuotes;\n      }\n      continue;\n    }\n\n    if (!inQuotes && (c === \",\" || c === \"\\t\")) {\n      row.push(field);\n      field = \"\";\n      continue;\n    }\n\n    if (!inQuotes && (c === \"\\n\" || c === \"\\r\")) {\n      if (c === \"\\r\" && next === \"\\n\") i++;\n      row.push(field);\n      field = \"\";\n      rows.push(row);\n      row = [];\n      continue;\n    }\n\n    field += c;\n  }\n\n  row.push(field);\n  rows.push(row);\n\n  while (rows.length && rows[rows.length - 1].every((x) => (x ?? \"\").trim() === \"\")) {\n    rows.pop();\n  }\n  return rows;\n}\n\n//  \nfunction normalizeHeader(h: string) {\n  const s = (h ?? \"\")\n    .trim()\n    .replace(/^\\uFEFF/, \"\")\n    .replace(/\\u3000/g, \" \")\n    .replace(/\\s+/g, \" \");\n\n  // : \"1. Mobile Number\" / \"2) Height\" / \"3 - Test Date / Time\"\n  const withoutPrefix = s.replace(/^\\s*\\d+\\s*[\\.\\)\\-:]\\s*/g, \"\");\n\n  return withoutPrefix\n    .toLowerCase()\n    .replace(/\\s+/g, \" \")\n    .replace(/[^a-z0-9\\u3040-\\u30ff\\u4e00-\\u9faf %/_-]/g, \"\");\n}\n\nfunction digitsOnlyPhone(v: string) {\n  return (v ?? \"\").toString().replace(/\\D/g, \"\");\n}\n\nfunction parseNumberOrNull(v: string): number | null {\n  const s = (v ?? \"\").toString().trim();\n  if (!s) return null;\n  const n = Number(s.replace(/,/g, \"\"));\n  return Number.isFinite(n) ? n : null;\n}\n\n// Test Date / Time  YYYY-MM-DD/\nfunction parseToISODateOnly(v: string): string | null {\n  const s = (v ?? \"\").toString().trim();\n  if (!s) return null;\n\n  const m = s.match(/(\\d{4})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{1,2})/);\n  if (m) {\n    const y = m[1];\n    const mm = String(Number(m[2])).padStart(2, \"0\");\n    const dd = String(Number(m[3])).padStart(2, \"0\");\n    return `${y}-${mm}-${dd}`;\n  }\n\n  const d = new Date(s);\n  if (!Number.isNaN(d.getTime())) {\n    const y = d.getFullYear();\n    const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n    const dd = String(d.getDate()).padStart(2, \"0\");\n    return `${y}-${mm}-${dd}`;\n  }\n\n  return null;\n}\n\nfunction buildObjectsFromCSV(table: string[][]) {\n  if (!table.length) return { rows: [] as Record<string, string>[], headers: [] as string[] };\n\n  const headers = table[0].map((h) => (h ?? \"\").trim());\n  const rows = table.slice(1).map((r) => {\n    const obj: Record<string, string> = {};\n    for (let i = 0; i < headers.length; i++) {\n      obj[headers[i]] = (r[i] ?? \"\").toString();\n    }\n    return obj;\n  });\n\n  return { headers, rows };\n}\n\nfunction findFieldKey(headers: string[], candidates: string[]) {\n  const normalized = headers.map((h) => ({ raw: h, norm: normalizeHeader(h) }));\n  const found = normalized.find((h) => candidates.includes(h.norm));\n  return found?.raw ?? null;\n}\n\nexport default function AdminInbodyCsvImport() {\n  const [fileName, setFileName] = useState<string>(\"\");\n  const [csvText, setCsvText] = useState<string>(\"\"); //  Edge\n  const [parsing, setParsing] = useState(false);\n  const [importing, setImporting] = useState(false);\n\n  const [parsed, setParsed] = useState<ParsedRow[]>([]);\n  const [errors, setErrors] = useState<RowError[]>([]);\n  const [info, setInfo] = useState<string>(\"\");\n\n  const validCount = parsed.length;\n  const errorCount = errors.length;\n\n  const canImport = useMemo(() => validCount > 0 && !importing, [validCount, importing]);\n\n  const handleFile = async (f: File) => {\n    setFileName(f.name);\n    setInfo(\"\");\n    setParsed([]);\n    setErrors([]);\n    setParsing(true);\n\n    try {\n      const text = await f.text();\n      setCsvText(text); //  \n      const table = parseCSV(text);\n\n      const { headers, rows } = buildObjectsFromCSV(table);\n      if (!headers.length) {\n        setInfo(\"CSV\");\n        return;\n      }\n\n      //   normalizeHeader OK\n      const keyPhone = findFieldKey(headers, [\n        \"mobile number\",\n        \"mobile\",\n        \"phone\",\n        \"phone number\",\n        \"phone_number\",\n        \"tel\",\n        \"telephone\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n      ]);\n\n      const keyTest = findFieldKey(headers, [\n        \"test date / time\",\n        \"test date/time\",\n        \"test date time\",\n        \"test date\",\n        \"measured_at\",\n        \"date\",\n        \"\",\n        \"\",\n        \"inbody\",\n        \"inbody \",\n      ]);\n\n      const keyHeight = findFieldKey(headers, [\"height\", \"height_cm\", \"\"]);\n      const keyWeight = findFieldKey(headers, [\"weight\", \"\"]);\n      const keyPbf = findFieldKey(headers, [\n        \"pbf (percent body fat)\",\n        \"pbf\",\n        \"percent body fat\",\n        \"percent_body_fat\",\n        \"body fat percent\",\n        \"body_fat_percent\",\n        \"\"\n      ]);\n\n      const missing = [\n        !keyPhone ? \"Mobile Number()\" : null,\n        !keyTest ? \"Test Date / Time()\" : null,\n        !keyHeight ? \"Height()\" : null,\n        !keyWeight ? \"Weight()\" : null,\n        !keyPbf ? \"PBF()\" : null,\n      ].filter(Boolean);\n\n      if (missing.length) {\n        setInfo(`CSV: ${missing.join(\", \")}`);\n        return;\n      }\n\n      if (rows.length > MAX_ROWS) {\n        setInfo(` ${MAX_ROWS} CSV`);\n        return;\n      }\n\n      const ok: ParsedRow[] = [];\n      const ng: RowError[] = [];\n\n      rows.forEach((r, idx) => {\n        const rowIndex = idx + 1;\n        const phone = digitsOnlyPhone(r[keyPhone!]);\n        const measured = parseToISODateOnly(r[keyTest!]);\n\n        const height = parseNumberOrNull(r[keyHeight!]);\n        const weight = parseNumberOrNull(r[keyWeight!]);\n        const pbf = parseNumberOrNull(r[keyPbf!]);\n\n        if (!phone) {\n          ng.push({ rowIndex, message: \" or \", raw: r });\n          return;\n        }\n        if (!measured) {\n          ng.push({ rowIndex, message: \"(Test Date / Time): 2025-12-21\", raw: r });\n          return;\n        }\n        if (height == null || height <= 0 || height > 250) {\n          ng.push({ rowIndex, message: \"0250cm\", raw: r });\n          return;\n        }\n        if (weight == null || weight <= 0 || weight > 300) {\n          ng.push({ rowIndex, message: \"0300kg\", raw: r });\n          return;\n        }\n        if (pbf == null || pbf < 0 || pbf > 80) {\n          ng.push({ rowIndex, message: \"(PBF)080%\", raw: r });\n          return;\n        }\n\n        ok.push({\n          rowIndex,\n          phone_number: phone,\n          measured_at: measured,\n          height,\n          weight,\n          body_fat_percent: pbf,\n          raw: r,\n        });\n      });\n\n      setParsed(ok);\n      setErrors(ng);\n      setInfo(` ${ok.length}  /  ${ng.length} `);\n    } catch (e: any) {\n      console.error(e);\n      setInfo(`CSV: ${String(e?.message ?? e)}`);\n    } finally {\n      setParsing(false);\n    }\n  };\n\n  const handleImport = async () => {\n    if (!canImport) return;\n    setImporting(true);\n    setInfo(\"\");\n\n    try {\n      //  Edge Function  CSV Edge measured_at_ts / phone_norm / upsert\n      const { data, error } = await supabase.functions.invoke(\"import-inbody-csv\", {\n        body: {\n          csv: csvText,\n          source: \"csv\",\n          note: null,\n        },\n      });\n\n      if (error) throw error;\n\n      const inserted = (data as any)?.inserted_or_updated ?? 0;\n      const rejected = (data as any)?.rejected ?? 0;\n\n      setInfo(` ${inserted}  upsertrejected: ${rejected}`);\n    } catch (e: any) {\n      console.error(e);\n      setInfo(` : ${String(e?.message ?? e)}`);\n    } finally {\n      setImporting(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"bg-white border border-gray-200 rounded-xl p-5\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <FileText className=\"w-5 h-5 text-gray-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">InBody CSV </h3>\n        </div>\n\n        <div className=\"text-sm text-gray-600 mb-4\">\n          <div className=\"font-medium text-gray-800 mb-1\"></div>\n          <ul className=\"list-disc pl-5 space-y-1\">\n            <li>Mobile Number1. Mobile NumberOK</li>\n            <li>Test Date / TimeOK / </li>\n            <li>Height</li>\n            <li>Weight</li>\n            <li>PBFPercent Body Fat / </li>\n          </ul>\n          <div className=\"mt-2 text-xs text-gray-500\">\n            : 1. Mobile Number\n          </div>\n        </div>\n\n        <label className=\"block\">\n          <div className=\"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-blue-400 transition-colors cursor-pointer bg-gray-50\">\n            <div className=\"text-center\">\n              <Upload className=\"w-7 h-7 mx-auto text-gray-500 mb-2\" />\n              <div className=\"text-sm font-medium text-gray-800\">\n                CSV&OK\n              </div>\n              <div className=\"text-xs text-gray-500 mt-1\"> {MAX_ROWS} </div>\n              {fileName && <div className=\"text-xs text-gray-700 mt-2\">: {fileName}</div>}\n            </div>\n          </div>\n          <input\n            type=\"file\"\n            accept=\".csv,text/csv\"\n            className=\"hidden\"\n            onChange={(e) => {\n              const f = e.target.files?.[0];\n              if (f) handleFile(f);\n            }}\n          />\n        </label>\n\n        {info && (\n          <div className=\"mt-4 flex items-start gap-2 text-sm\">\n            {info.startsWith(\"\") ? (\n              <CheckCircle2 className=\"w-5 h-5 text-green-600 mt-0.5\" />\n            ) : info.startsWith(\"\") ? (\n              <AlertTriangle className=\"w-5 h-5 text-red-600 mt-0.5\" />\n            ) : (\n              <AlertTriangle className=\"w-5 h-5 text-yellow-600 mt-0.5\" />\n            )}\n            <div className=\"text-gray-700 whitespace-pre-wrap\">{info}</div>\n          </div>\n        )}\n\n        <div className=\"mt-4 flex items-center gap-3\">\n          <button\n            onClick={handleImport}\n            disabled={!canImport}\n            className={`px-4 py-2 rounded-lg text-white text-sm font-medium transition-colors ${\n              canImport ? \"bg-blue-600 hover:bg-blue-700\" : \"bg-gray-300 cursor-not-allowed\"\n            }`}\n          >\n            {importing ? (\n              <span className=\"inline-flex items-center gap-2\">\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                ...\n              </span>\n            ) : (\n              \"DBEdge\"\n            )}\n          </button>\n\n          {parsing && (\n            <span className=\"text-sm text-gray-600 inline-flex items-center gap-2\">\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n              ...\n            </span>\n          )}\n\n          <div className=\"text-sm text-gray-600\">\n             <span className=\"font-semibold text-gray-900\">{validCount}</span>  / {\" \"}\n            <span className=\"font-semibold text-gray-900\">{errorCount}</span> \n          </div>\n        </div>\n      </div>\n\n      {errors.length > 0 && (\n        <div className=\"bg-white border border-gray-200 rounded-xl p-5\">\n          <div className=\"flex items-center gap-2 mb-3\">\n            <AlertTriangle className=\"w-5 h-5 text-red-600\" />\n            <h4 className=\"text-md font-semibold text-gray-900\"></h4>\n          </div>\n\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full text-sm\">\n              <thead>\n                <tr className=\"text-left text-gray-600\">\n                  <th className=\"py-2 pr-3\"></th>\n                  <th className=\"py-2 pr-3\"></th>\n                  <th className=\"py-2 pr-3\"></th>\n                </tr>\n              </thead>\n              <tbody>\n                {errors.slice(0, 50).map((e) => (\n                  <tr key={`${e.rowIndex}-${e.message}`} className=\"border-t\">\n                    <td className=\"py-2 pr-3 font-mono\">{e.rowIndex}</td>\n                    <td className=\"py-2 pr-3 text-red-700\">{e.message}</td>\n                    <td className=\"py-2 pr-3 text-gray-600\">\n                      {JSON.stringify(e.raw).slice(0, 140)}\n                      {JSON.stringify(e.raw).length > 140 ? \"...\" : \"\"}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n\n          {errors.length > 50 && <div className=\"text-xs text-gray-500 mt-2\">50</div>}\n        </div>\n      )}\n\n      {parsed.length > 0 && (\n        <div className=\"bg-white border border-gray-200 rounded-xl p-5\">\n          <h4 className=\"text-md font-semibold text-gray-900 mb-3\">10</h4>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full text-sm\">\n              <thead>\n                <tr className=\"text-left text-gray-600\">\n                  <th className=\"py-2 pr-3\"></th>\n                  <th className=\"py-2 pr-3\"></th>\n                  <th className=\"py-2 pr-3\"></th>\n                  <th className=\"py-2 pr-3\"></th>\n                  <th className=\"py-2 pr-3\"></th>\n                  <th className=\"py-2 pr-3\"></th>\n                </tr>\n              </thead>\n              <tbody>\n                {parsed.slice(0, 10).map((r) => (\n                  <tr key={r.rowIndex} className=\"border-t\">\n                    <td className=\"py-2 pr-3 font-mono\">{r.rowIndex}</td>\n                    <td className=\"py-2 pr-3 font-mono\">{r.phone_number}</td>\n                    <td className=\"py-2 pr-3 font-mono\">{r.measured_at}</td>\n                    <td className=\"py-2 pr-3\">{r.height}</td>\n                    <td className=\"py-2 pr-3\">{r.weight}</td>\n                    <td className=\"py-2 pr-3\">{r.body_fat_percent}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          <div className=\"text-xs text-gray-500 mt-2\"> Edge measured_at_ts</div>\n        </div>\n      )}\n    </div>\n  );\n}","import React, { useState, useEffect } from 'react';\nimport { User, Team, supabase } from '../lib/supabase';\nimport { isGlobalAdmin } from '../lib/permissions';\nimport { Alert } from '../lib/alerts';\nimport { UserInvitation } from './UserInvitation';\nimport { BulkUserInvitation } from './BulkUserInvitation';\nimport { UserManagement } from './UserManagement';\nimport { AlertSummary } from './AlertSummary';\nimport { TutorialController } from './TutorialController';\nimport { useTutorialContext } from '../contexts/TutorialContext';\nimport { getTutorialSteps } from '../lib/tutorialContent';\nimport NutritionDev from \"./NutritionDev\"; //  \nimport NutritionPhotoUploader from \"./NutritionPhotoUploader\";\nimport {\n  Settings,\n  Users,\n  UserPlus,\n  AlertTriangle,\n  BarChart3,\n  X,\n  HelpCircle,\n  Building2,\n  CreditCard,\n  Sliders,\n  UserCog,\n  UsersRound,\n  Layout,\n  ShieldCheck,\n  MessageSquare,\n  Menu,\n  Shield,\n  FileText\n} from 'lucide-react';\nimport { OrganizationManagement } from './OrganizationManagement';\nimport { OrganizationOverview } from './OrganizationOverview';\nimport { SubscriptionManagement } from './SubscriptionManagement';\nimport { OrganizationSettings } from './OrganizationSettings';\nimport { TeamAccessRequestManagement } from './TeamAccessRequestManagement';\nimport { AthleteTransferManagement } from './AthleteTransferManagement';\nimport { OrganizationMembersManagement } from './OrganizationMembersManagement';\nimport { useOrganizations } from '../hooks/useOrganizations';\n\n//  InBody CSV Import\nimport AdminInbodyCsvImport from './AdminInbodyCsvImport';\n\ninterface AdminViewProps {\n  user: User;\n  alerts: Alert[];\n  onNavigateToPrivacy?: () => void;\n  onNavigateToTerms?: () => void;\n  onNavigateToCommercial?: () => void;\n  onNavigateToHelp?: () => void;\n}\n\nexport function AdminView({\n  user,\n  alerts,\n  onNavigateToPrivacy,\n  onNavigateToTerms,\n  onNavigateToCommercial,\n  onNavigateToHelp\n}: AdminViewProps) {\n\n  if (!user || !isGlobalAdmin(user.role)) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"bg-white border rounded-xl p-6\">\n          <div className=\"text-lg font-semibold\"></div>\n          <div className=\"text-sm text-gray-600 mt-2\">\n            \n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const [teams, setTeams] = useState<Team[]>([]);\n  const [activeTab, setActiveTab] = useState<'system' | 'users' | 'organization'>('system');\n  const [systemSubTab, setSystemSubTab] = useState<'overview' | 'nutrition-dev'>('overview');\n\n  //  'inbody' \n  const [usersSubTab, setUsersSubTab] = useState<'invite' | 'manage' | 'inbody'>('invite');\n  const [targetUserId, setTargetUserId] = useState<string>(\"\");\n  const [organizationSubTab, setOrganizationSubTab] = useState<\n    'overview' | 'list' | 'members' | 'settings' | 'subscription' | 'transfers' | 'team-access'\n  >('overview');\n  const [inbodyUsers, setInbodyUsers] = useState<{ user_id: string; name?: string }[]>([]);\n  const [inbodyUsersLoading, setInbodyUsersLoading] = useState(false);\n\n  const [inviteSubTab, setInviteSubTab] = useState<'single' | 'bulk'>('single');\n  const [selectedOrganizationId, setSelectedOrganizationId] = useState<string | undefined>();\n  const [loading, setLoading] = useState(true);\n  const [showAlertPanel, setShowAlertPanel] = useState(false);\n  const [criticalAlertDismissed, setCriticalAlertDismissed] = useState(false);\n  const [showMobileMenu, setShowMobileMenu] = useState(false);\n  const { isActive, shouldShowTutorial, startTutorial, completeTutorial, skipTutorial, currentStepIndex, setCurrentStepIndex } =\n    useTutorialContext();\n  const { organizations, loading: orgsLoading } = useOrganizations(user.id);\n\n  useEffect(() => {\n    if (shouldShowTutorial() && !loading) {\n      startTutorial();\n    }\n  }, [shouldShowTutorial, startTutorial, loading]);\n\n  useEffect(() => {\n    const savedOrgId = localStorage.getItem('admin_selected_organization');\n    if (savedOrgId && organizations.some((org) => org.id === savedOrgId)) {\n      setSelectedOrganizationId(savedOrgId);\n    } else if (organizations.length > 0 && !selectedOrganizationId) {\n      setSelectedOrganizationId(organizations[0].id);\n      localStorage.setItem('admin_selected_organization', organizations[0].id);\n    }\n  }, [organizations]);\n\n  const handleOrganizationSelect = (orgId: string) => {\n    setSelectedOrganizationId(orgId);\n    localStorage.setItem('admin_selected_organization', orgId);\n  };\n\n  const selectedOrganization = organizations.find((org) => org.id === selectedOrganizationId);\n\n  const highPriorityAlerts = alerts.filter((alert) => alert.priority === 'high');\n  const systemAlerts = alerts.filter((alert) => alert.type === 'no_data' || alert.type === 'reminder');\n\n  useEffect(() => {\n    const dismissed = localStorage.getItem('criticalAlertDismissed');\n    const dismissedTime = dismissed ? parseInt(dismissed, 10) : 0;\n    const now = Date.now();\n    const thirtyMinutes = 30 * 60 * 1000;\n\n    if (dismissedTime && now - dismissedTime < thirtyMinutes) {\n      setCriticalAlertDismissed(true);\n    } else if (dismissedTime && now - dismissedTime >= thirtyMinutes) {\n      localStorage.removeItem('criticalAlertDismissed');\n    }\n  }, []);\n\n  const handleDismissCriticalAlert = () => {\n    setCriticalAlertDismissed(true);\n    localStorage.setItem('criticalAlertDismissed', Date.now().toString());\n  };\n  const fetchInbodyUsers = async () => {\n    try {\n      setInbodyUsersLoading(true);\n  \n      // inbody_records  user_id \n      const { data, error } = await supabase\n        .from('inbody_records')\n        .select('user_id')\n        .not('user_id', 'is', null);\n  \n      if (error) throw error;\n  \n      const unique = Array.from(new Set((data ?? []).map((r) => r.user_id))).filter(Boolean);\n  \n      //  app_users  users \n      const { data: usersData, error: usersErr } = await supabase\n        .from('app_users')\n        .select('id, nickname, email') //  nickname name \n        .in('id', unique);\n  \n      if (usersErr) {\n        //  user_id OK\n        console.warn('fetchInbodyUsers: failed to fetch app_users info:', usersErr);\n        setInbodyUsers(unique.map((id) => ({ user_id: id })));\n        return;\n      }\n  \n      const mapped =\n        (usersData ?? []).map((u: any) => ({\n          user_id: u.id,\n          name: u.nickname || u.email || u.id,\n        })) ?? [];\n  \n      setInbodyUsers(mapped);\n    } catch (e) {\n      console.error('fetchInbodyUsers error:', e);\n    } finally {\n      setInbodyUsersLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchTeams();\n  }, []);\n\n  useEffect(() => {\n    if (activeTab === 'system' && systemSubTab === 'nutrition-dev') {\n      fetchInbodyUsers();\n    }\n  }, [activeTab, systemSubTab]);\n\n  const fetchTeams = async () => {\n    try {\n      const { data, error } = await supabase.from('teams').select('*').order('name');\n      if (error) throw error;\n      setTeams(data || []);\n    } catch (error) {\n      console.error('Error fetching teams:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const testCalculateMetabolism = async () => {\n    try {\n      if (!targetUserId) {\n        alert(\"user_id \");\n        return;\n      }\n  \n      const { data } = await supabase.auth.getSession();\n      const accessToken = data.session?.access_token;\n  \n      if (!accessToken) {\n        alert(\"\");\n        return;\n      }\n  \n      const res = await fetch(\n        \"https://cymnqmbdwaveccoooics.supabase.co/functions/v1/calculate-metabolism\",\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${accessToken}`,\n          },\n          body: JSON.stringify({\n            user_id: targetUserId,\n            activity_level: \"medium\",\n          }),\n        }\n      );\n  \n      const json = await res.json();\n      console.log(\" calculate-metabolism result:\", json);\n  \n      if (!res.ok) {\n        alert(`: ${res.status}\\n` + JSON.stringify(json, null, 2));\n        return;\n      }\n  \n      alert(JSON.stringify(json, null, 2));\n    } catch (e) {\n      console.error(e);\n      alert(\"console\");\n    }\n  };\n \n\n\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <header className=\"bg-white shadow-sm border-b sticky top-0 z-40\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between py-3\">\n            <h1 className=\"text-lg sm:text-xl font-bold text-gray-900\"></h1>\n            <div className=\"flex items-center space-x-1\">\n              {highPriorityAlerts.length > 0 && (\n                <button\n                  onClick={() => setShowAlertPanel(true)}\n                  className=\"p-2 text-gray-600 hover:text-red-600 transition-colors relative\"\n                  title=\"\"\n                >\n                  <AlertTriangle className=\"w-5 h-5\" />\n                  <span className=\"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full\"></span>\n                </button>\n              )}\n\n              <button\n                onClick={startTutorial}\n                className=\"p-2 text-gray-600 hover:text-purple-600 transition-colors\"\n                title=\"\"\n              >\n                <HelpCircle className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Organization Selector in Header */}\n          {!orgsLoading && organizations.length > 1 && (\n            <div className=\"pb-3 border-t border-gray-100\">\n              <div className=\"flex items-center gap-3 pt-3\">\n                <Building2 className=\"w-4 h-4 text-gray-400 flex-shrink-0\" />\n                <select\n                  value={selectedOrganizationId || ''}\n                  onChange={(e) => handleOrganizationSelect(e.target.value)}\n                  className=\"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\n                >\n                  {organizations.map((org) => (\n                    <option key={org.id} value={org.id}>\n                      {org.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          )}\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8\">\n        <div className=\"space-y-6 sm:space-y-8\">\n          {/* Critical Alert Banner */}\n          {highPriorityAlerts.length > 0 && !criticalAlertDismissed && (\n            <div className=\"bg-red-50 border border-red-200 rounded-xl p-4\">\n              <div className=\"flex items-center\">\n                <AlertTriangle className=\"w-6 h-6 text-red-600 mr-3 flex-shrink-0\" />\n                <div className=\"flex-1 min-w-0\">\n                  <h3 className=\"font-semibold text-red-900\"></h3>\n                  <p className=\"text-sm text-red-700\">{highPriorityAlerts.length}</p>\n                </div>\n                <button\n                  onClick={handleDismissCriticalAlert}\n                  className=\"ml-3 p-1 text-red-400 hover:text-red-600 transition-colors flex-shrink-0\"\n                  title=\"30\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n            </div>\n          )}\n\n          {/* System Overview */}\n          <div className=\"bg-white rounded-xl shadow-sm p-6\">\n            <div className=\"flex items-center mb-6\">\n              <BarChart3 className=\"w-6 h-6 text-blue-600 mr-3\" />\n              <h2 className=\"text-xl font-semibold text-gray-900\"></h2>\n            </div>\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n              <div className=\"bg-blue-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-blue-600 mb-1\">{alerts.length}</div>\n                <div className=\"text-sm text-blue-700\"></div>\n              </div>\n\n              <div className=\"bg-red-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-red-600 mb-1\">{highPriorityAlerts.length}</div>\n                <div className=\"text-sm text-red-700\"></div>\n              </div>\n\n              <div className=\"bg-yellow-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-yellow-600 mb-1\">{systemAlerts.length}</div>\n                <div className=\"text-sm text-yellow-700\"></div>\n              </div>\n\n              <div className=\"bg-green-50 rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-green-600 mb-1\">{teams.length}</div>\n                <div className=\"text-sm text-green-700\"></div>\n              </div>\n            </div>\n          </div>\n\n          {/* Management Tabs */}\n          <div className=\"bg-white rounded-xl shadow-sm mb-8\">\n            <div className=\"border-b border-gray-200\">\n              <nav className=\"flex px-6 overflow-x-auto\">\n                <button\n                  onClick={() => setActiveTab('system')}\n                  className={`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${\n                    activeTab === 'system'\n                      ? 'border-blue-500 text-blue-600 bg-blue-50'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                  data-tutorial=\"system-tab\"\n                >\n                  <BarChart3 className=\"w-4 h-4\" />\n                  <span></span>\n                </button>\n\n                <button\n                  onClick={() => setActiveTab('users')}\n                  className={`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${\n                    activeTab === 'users'\n                      ? 'border-green-500 text-green-600 bg-green-50'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                  data-tutorial=\"users-tab\"\n                >\n                  <Users className=\"w-4 h-4\" />\n                  <span></span>\n                </button>\n\n                <button\n                  onClick={() => setActiveTab('organization')}\n                  className={`py-4 px-6 border-b-2 font-medium text-sm flex items-center space-x-2 whitespace-nowrap transition-colors ${\n                    activeTab === 'organization'\n                      ? 'border-orange-500 text-orange-600 bg-orange-50'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                  data-tutorial=\"organization-tab\"\n                >\n                  <Building2 className=\"w-4 h-4\" />\n                  <span></span>\n                </button>\n              </nav>\n            </div>\n\n            \n\n\n\n\n            {/* Sub-tabs Section */}\n            {(activeTab === 'system' || activeTab === 'users' || activeTab === 'organization') && (\n              <div className=\"border-b border-gray-100 bg-gray-50\">\n                <nav className=\"flex px-6 overflow-x-auto\">\n                  {activeTab === 'system' && (\n                    <>\n                      <button\n                        onClick={() => setSystemSubTab('overview')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${\n                          systemSubTab === 'overview'\n                            ? 'border-blue-500 text-blue-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <BarChart3 className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setSystemSubTab('nutrition-dev')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          systemSubTab === 'nutrition-dev'\n                            ? 'border-blue-500 text-blue-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <MessageSquare className=\"w-3.5 h-3.5\" />\n                        <span>Dev</span>\n                      </button>\n                    </>\n                  )}\n\n                  {activeTab === 'users' && (\n                    <>\n                      <button\n                        onClick={() => setUsersSubTab('invite')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${\n                          usersSubTab === 'invite'\n                            ? 'border-green-500 text-green-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <UserPlus className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setUsersSubTab('manage')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          usersSubTab === 'manage'\n                            ? 'border-green-500 text-green-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <UserCog className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setUsersSubTab('inbody')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          usersSubTab === 'inbody'\n                            ? 'border-green-500 text-green-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <FileText className=\"w-3.5 h-3.5\" />\n                        <span>InBody(CSV)</span>\n                      </button>\n                    </>\n                  )}\n\n                  {activeTab === 'organization' && (\n                    <>\n                      <button\n                        onClick={() => setOrganizationSubTab('overview')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 whitespace-nowrap ${\n                          organizationSubTab === 'overview'\n                            ? 'border-orange-500 text-orange-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <Layout className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setOrganizationSubTab('list')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          organizationSubTab === 'list'\n                            ? 'border-orange-500 text-orange-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <Building2 className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setOrganizationSubTab('members')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          organizationSubTab === 'members'\n                            ? 'border-orange-500 text-orange-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <ShieldCheck className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setOrganizationSubTab('settings')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          organizationSubTab === 'settings'\n                            ? 'border-orange-500 text-orange-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <Sliders className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setOrganizationSubTab('subscription')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          organizationSubTab === 'subscription'\n                            ? 'border-orange-500 text-orange-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <CreditCard className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setOrganizationSubTab('transfers')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          organizationSubTab === 'transfers'\n                            ? 'border-orange-500 text-orange-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <UserCog className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n\n                      <button\n                        onClick={() => setOrganizationSubTab('team-access')}\n                        className={`py-3 px-4 border-b-2 font-medium text-xs flex items-center space-x-2 ml-4 whitespace-nowrap ${\n                          organizationSubTab === 'team-access'\n                            ? 'border-orange-500 text-orange-700'\n                            : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300'\n                        }`}\n                      >\n                        <UsersRound className=\"w-3.5 h-3.5\" />\n                        <span></span>\n                      </button>\n                    </>\n                  )}\n                </nav>\n              </div>\n            )}\n\n            <div className=\"p-6\">\n            {activeTab === 'system' ? (\n              <div className=\"space-y-6\">\n                {systemSubTab === 'overview' ? (\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4\"></h3>\n                    <div className=\"bg-gray-50 rounded-lg p-4\">\n                      <p className=\"text-gray-600 text-center\">\n                        ACWR\n                        \n                      </p>\n                    </div>\n                  </div>\n                ) : systemSubTab === 'nutrition-dev' ? (\n                  <div className=\"space-y-4\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">Dev</h3>\n                      <p className=\"text-sm text-gray-600\">\n                        \n                      </p>\n                    </div>\n                      <div className=\"space-y-4\">\n                        <NutritionPhotoUploader />\n                        <NutritionDev />\n                      </div>\n\n                  {/*  calculate-metabolism  */}\n                    <div className=\"bg-gray-50 border rounded-lg p-4 space-y-3\">\n                      <div>\n                        <p className=\"text-sm font-semibold text-gray-900\"> user_id</p>\n                        <p className=\"text-xs text-gray-500\">\n                          inbody_records user_id \n                        </p>\n                      </div>\n                      {inbodyUsers.length > 0 && (\n                      <select\n                        value={targetUserId}\n                        onChange={(e) => setTargetUserId(e.target.value)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white\"\n                      >\n                        <option value=\"\">InBody</option>\n                        {inbodyUsers.map((u) => (\n                          <option key={u.user_id} value={u.user_id}>\n                            {u.name}  {u.user_id.slice(0, 8)}\n                          </option>\n                        ))}\n                      </select>\n                    )}\n\n\n                      <input\n                        value={targetUserId}\n                        onChange={(e) => setTargetUserId(e.target.value)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm\"\n                        placeholder=\": f7f3aea1-764f-4013-b51d-c7bca2ed6d20\"\n                      />\n\n                      <button\n                        onClick={testCalculateMetabolism}\n                        disabled={!targetUserId}\n                        className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n                      >\n                          Edge Function \n                      </button>\n\n                      <p className=\"text-xs text-gray-500\">\n                         console / alert \n                      </p>\n                    </div>\n                  </div>\n                ) : null}\n              </div>\n            ) : activeTab === 'users' ? (\n              \n\n                <div>\n                  {usersSubTab === 'invite' ? (\n                    <div>\n                      <div className=\"border-b border-gray-200 mb-6\">\n                        <nav className=\"flex space-x-8\">\n                          <button\n                            onClick={() => setInviteSubTab('single')}\n                            className={`py-3 px-1 border-b-2 font-medium text-sm ${\n                              inviteSubTab === 'single'\n                                ? 'border-green-500 text-green-600'\n                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                            }`}\n                          >\n                            \n                          </button>\n                          <button\n                            onClick={() => setInviteSubTab('bulk')}\n                            className={`py-3 px-1 border-b-2 font-medium text-sm ${\n                              inviteSubTab === 'bulk'\n                                ? 'border-green-500 text-green-600'\n                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                            }`}\n                          >\n                             (CSV)\n                          </button>\n                        </nav>\n                      </div>\n\n                      {inviteSubTab === 'single' ? (\n                        <div data-tutorial=\"single-invite\">\n                          <UserInvitation teams={teams} onUserInvited={() => {}} />\n                        </div>\n                      ) : (\n                        <div data-tutorial=\"bulk-invite\">\n                          <BulkUserInvitation teams={teams} onUsersInvited={() => {}} />\n                        </div>\n                      )}\n                    </div>\n                  ) : usersSubTab === 'manage' ? (\n                    <div data-tutorial=\"user-list\">\n                      <UserManagement teams={teams} />\n                    </div>\n                  ) : usersSubTab === 'inbody' ? (\n                    //  \n                    <div className=\"space-y-4\">\n                      <div>\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">InBody </h3>\n                        <p className=\"text-sm text-gray-600\">\n                          CSV inbody_records  upsert phone_number + measured_at \n                        </p>\n                      </div>\n                      <AdminInbodyCsvImport />\n                    </div>\n                  ) : null}\n                </div>\n              ) : activeTab === 'organization' ? (\n                <div>\n                  {organizationSubTab === 'overview' ? (\n                    selectedOrganizationId && selectedOrganization ? (\n                      <OrganizationOverview organizationId={selectedOrganizationId} organizationName={selectedOrganization.name} />\n                    ) : (\n                      <div className=\"text-center py-12\">\n                        <p className=\"text-gray-600 dark:text-gray-400 mb-4\"></p>\n                        <button\n                          onClick={() => setOrganizationSubTab('list')}\n                          className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors\"\n                        >\n                          \n                        </button>\n                      </div>\n                    )\n                  ) : organizationSubTab === 'list' ? (\n                    <OrganizationManagement userId={user.id} />\n                  ) : organizationSubTab === 'members' ? (\n                    <div>\n                      {selectedOrganizationId && selectedOrganization ? (\n                        <OrganizationMembersManagement organizationId={selectedOrganizationId} organizationName={selectedOrganization.name} />\n                      ) : (\n                        <div className=\"text-center py-12\">\n                          <p className=\"text-gray-600 dark:text-gray-400 mb-4\"></p>\n                          <button\n                            onClick={() => setOrganizationSubTab('list')}\n                            className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors\"\n                          >\n                            \n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  ) : organizationSubTab === 'settings' ? (\n                    <div>\n                      {selectedOrganizationId ? (\n                        <OrganizationSettings organizationId={selectedOrganizationId} />\n                      ) : (\n                        <div className=\"text-center py-12\">\n                          <p className=\"text-gray-600 dark:text-gray-400 mb-4\"></p>\n                          <button\n                            onClick={() => setOrganizationSubTab('list')}\n                            className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors\"\n                          >\n                            \n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  ) : organizationSubTab === 'subscription' ? (\n                    <div>\n                      {selectedOrganizationId ? (\n                        <SubscriptionManagement organizationId={selectedOrganizationId} organizationName=\"\" />\n                      ) : (\n                        <div className=\"text-center py-12\">\n                          <p className=\"text-gray-600 dark:text-gray-400 mb-4\"></p>\n                          <button\n                            onClick={() => setOrganizationSubTab('list')}\n                            className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors\"\n                          >\n                            \n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  ) : organizationSubTab === 'transfers' ? (\n                    <div>\n                      {selectedOrganizationId ? (\n                      <AthleteTransferManagement\n                      userId={user.id}\n                      organizationId={selectedOrganizationId}\n                      isAdmin={isGlobalAdmin(user.role)}\n                    />\n                      ) : (\n                        <div className=\"text-center py-12\">\n                          <p className=\"text-gray-600 dark:text-gray-400 mb-4\"></p>\n                          <button\n                            onClick={() => setOrganizationSubTab('list')}\n                            className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors\"\n                          >\n                            \n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  ) : organizationSubTab === 'team-access' ? (\n                    <div>\n                      {selectedOrganizationId ? (\n                        <TeamAccessRequestManagement\n                        userId={user.id}\n                        organizationId={selectedOrganizationId}\n                        isAdmin={isGlobalAdmin(user.role)}\n                      />\n                      ) : (\n                        <div className=\"text-center py-12\">\n                          <p className=\"text-gray-600 dark:text-gray-400 mb-4\"></p>\n                          <button\n                            onClick={() => setOrganizationSubTab('list')}\n                            className=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors\"\n                          >\n                            \n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  ) : null}\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <TutorialController\n        steps={getTutorialSteps('global_admin')}\n        isActive={isActive}\n        onComplete={completeTutorial}\n        onSkip={skipTutorial}\n        currentStepIndex={currentStepIndex}\n        onStepChange={setCurrentStepIndex}\n      />\n    </div>\n  );\n}","// src/hooks/useBadges.ts\nimport { useState, useEffect, useRef, useCallback, useMemo } from \"react\";\nimport type { RealtimeChannel } from \"@supabase/supabase-js\";\nimport { supabase } from \"../lib/supabase\";\nimport { useRealtimeHub } from \"./useRealtimeHub\";\n\nconst ENABLE_REALTIME = import.meta.env.VITE_ENABLE_REALTIME === \"true\";\n\ntype Options = {\n  enabled?: boolean;\n  pollMs?: number;\n  pauseWhenHidden?: boolean;\n};\n\nexport function useBadges(userId: string, options: Options = {}) {\n  const enabled = options.enabled ?? true;\n  const pollMs = options.pollMs ?? 0;\n  const pauseWhenHidden = options.pauseWhenHidden ?? true;\n\n  const mountedRef = useRef(true);\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  }, [userId]);\n\n  const [allBadges, setAllBadges] = useState<any[]>([]);\n  const [userBadges, setUserBadges] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const { state, registerPollJob } = useRealtimeHub();\n\n  const instanceId = useMemo(\n    () => globalThis.crypto?.randomUUID?.() ?? Math.random().toString(36).slice(2),\n    []\n  );\n\n  const channelRef = useRef<RealtimeChannel | null>(null);\n  const unregisterPollRef = useRef<null | (() => void)>(null);\n\n  const badgesLoadedRef = useRef(false);\n  const inflightRef = useRef(false);\n\n  const cleanupRealtime = useCallback(() => {\n    const ch = channelRef.current;\n    if (!ch) return;\n    try {\n      ch.unsubscribe?.();\n    } catch (_) {}\n    try {\n      supabase.removeChannel(ch);\n    } catch (_) {}\n    channelRef.current = null;\n  }, []);\n\n  const cleanupPoll = useCallback(() => {\n    if (unregisterPollRef.current) {\n      unregisterPollRef.current();\n      unregisterPollRef.current = null;\n    }\n  }, []);\n\n  const fetchBadges = useCallback(async () => {\n    const { data, error } = await supabase.from(\"badges\").select(\"*\").order(\"sort_order\");\n    if (error) throw error;\n    if (!mountedRef.current) return;\n    setAllBadges(data ?? []);\n  }, []);\n\n  const fetchUserBadges = useCallback(async () => {\n    if (!userId || !enabled) return;\n\n    if (inflightRef.current) return;\n    inflightRef.current = true;\n\n    try {\n      const { data, error } = await supabase\n        .from(\"user_badges\")\n        .select(`*, badge:badges(*)`)\n        .eq(\"user_id\", userId)\n        .order(\"earned_at\", { ascending: false });\n\n      if (error) throw error;\n\n      if (!mountedRef.current) return;\n      setUserBadges(data ?? []);\n      setError(null);\n    } catch (e: any) {\n      if (!mountedRef.current) return;\n      setError(e?.message ?? \"\");\n    } finally {\n      inflightRef.current = false;\n    }\n  }, [userId, enabled]);\n\n  //  DB is_new\n  //  viewed_at / is_viewed / viewed \n  const getNewBadges = useCallback(() => {\n    return (userBadges ?? []).filter((ub: any) => {\n      if (typeof ub?.is_new === \"boolean\") return ub.is_new === true;\n\n      // /\n      const viewedAt = ub?.viewed_at;\n      const isViewed = ub?.is_viewed ?? ub?.viewed ?? false;\n      return !viewedAt && !isViewed;\n    });\n  }, [userBadges]);\n\n  const getBadgeProgress = useCallback(() => {\n    const earned = (userBadges ?? []).length;\n    const total = (allBadges ?? []).length;\n    const percentage = total > 0 ? Math.round((earned / total) * 100) : 0;\n    return { earned, total, percentage };\n  }, [userBadges, allBadges]);\n\n  //   is_new=false/\n  //  viewed_at / is_viewed / viewed \n  const markBadgeAsViewed = useCallback(\n    async (userBadgeId: string) => {\n      if (!userBadgeId) return;\n\n      //   schema\n      const r0 = await supabase\n        .from(\"user_badges\")\n        .update({ is_new: false } as any)\n        .eq(\"id\", userBadgeId);\n\n      if (!r0.error) {\n        // \n        setUserBadges((prev) =>\n          (prev ?? []).map((ub: any) => (ub?.id === userBadgeId ? { ...ub, is_new: false } : ub))\n        );\n        await fetchUserBadges();\n        return;\n      }\n\n      //  viewed_at \n      const r1 = await supabase\n        .from(\"user_badges\")\n        .update({ viewed_at: new Date().toISOString() } as any)\n        .eq(\"id\", userBadgeId);\n\n      if (!r1.error) {\n        await fetchUserBadges();\n        return;\n      }\n\n      //  is_viewed \n      const r2 = await supabase\n        .from(\"user_badges\")\n        .update({ is_viewed: true } as any)\n        .eq(\"id\", userBadgeId);\n\n      if (!r2.error) {\n        await fetchUserBadges();\n        return;\n      }\n\n      //  viewed \n      const r3 = await supabase\n        .from(\"user_badges\")\n        .update({ viewed: true } as any)\n        .eq(\"id\", userBadgeId);\n\n      if (r3.error) {\n        console.warn(\"[useBadges] markBadgeAsViewed failed:\", r3.error);\n        throw r3.error;\n      }\n\n      await fetchUserBadges();\n    },\n    [fetchUserBadges]\n  );\n\n  // \n  useEffect(() => {\n    let cancelled = false;\n\n    const run = async () => {\n      cleanupRealtime();\n      cleanupPoll();\n\n      if (!userId || !enabled) {\n        if (mountedRef.current) setLoading(false);\n        return;\n      }\n\n      try {\n        if (mountedRef.current) setLoading(true);\n\n        if (!badgesLoadedRef.current) {\n          await fetchBadges();\n          badgesLoadedRef.current = true;\n        }\n\n        await fetchUserBadges();\n      } catch (e: any) {\n        if (mountedRef.current) {\n          setError(e?.message ?? \"\");\n        }\n      } finally {\n        if (!cancelled && mountedRef.current) setLoading(false);\n      }\n    };\n\n    void run();\n\n    return () => {\n      cancelled = true;\n      cleanupRealtime();\n      cleanupPoll();\n    };\n  }, [userId, enabled, fetchBadges, fetchUserBadges, cleanupRealtime, cleanupPoll]);\n\n  // Realtime\n  useEffect(() => {\n    cleanupRealtime();\n\n    const canUseRealtime = !!userId && enabled && ENABLE_REALTIME && state.canRealtime;\n    if (!canUseRealtime) return;\n\n    const channel = supabase\n      .channel(`user-badges:${userId}:${instanceId}`)\n      .on(\n        \"postgres_changes\",\n        { event: \"*\", schema: \"public\", table: \"user_badges\", filter: `user_id=eq.${userId}` },\n        () => {\n          void fetchUserBadges();\n        }\n      );\n\n    channelRef.current = channel;\n\n    channel.subscribe((status) => {\n      if (import.meta.env.DEV) console.log(\"[useBadges] realtime status\", status);\n      if (status === \"CHANNEL_ERROR\" || status === \"TIMED_OUT\") {\n        console.warn(\"[useBadges] realtime issue:\", status);\n        cleanupRealtime();\n      }\n    });\n\n    return () => cleanupRealtime();\n  }, [userId, enabled, state.canRealtime, fetchUserBadges, cleanupRealtime, instanceId]);\n\n  // PollingRealtime\n  useEffect(() => {\n    cleanupPoll();\n\n    const shouldPoll =\n      !!userId && enabled && pollMs > 0 && (!ENABLE_REALTIME || !state.canRealtime);\n\n    if (!shouldPoll) return;\n\n    const key = `badges:${userId}:${instanceId}`;\n    const unregister = registerPollJob({\n      key,\n      intervalMs: pollMs,\n      run: async () => {\n        await fetchUserBadges();\n      },\n      enabled: true,\n      requireVisible: pauseWhenHidden,\n      requireOnline: true,\n      immediate: false,\n    });\n\n    unregisterPollRef.current = unregister;\n    return () => cleanupPoll();\n  }, [\n    userId,\n    enabled,\n    pollMs,\n    pauseWhenHidden,\n    state.canRealtime,\n    registerPollJob,\n    fetchUserBadges,\n    cleanupPoll,\n    instanceId,\n  ]);\n\n  return {\n    allBadges,\n    userBadges,\n    loading,\n    error,\n    getNewBadges,\n    getBadgeProgress,\n    markBadgeAsViewed,\n    refresh: async () => {\n      await Promise.all([fetchBadges(), fetchUserBadges()]);\n    },\n  };\n}","import React, { useEffect, useCallback } from \"react\";\nimport confettiImport from \"canvas-confetti\";\nimport { Award, Star, X } from \"lucide-react\";\nimport type { Badge } from \"../lib/gamification\";\n\ninterface BadgeEarnedModalProps {\n  badge: Badge;\n  onClose: () => void;\n}\n\nconst confetti = ((confettiImport as unknown as { default?: any })?.default ?? confettiImport) as any;\n\nexport function BadgeEarnedModal({ badge, onClose }: BadgeEarnedModalProps) {\n  useEffect(() => {\n    if (typeof confetti === \"function\") {\n      confetti({\n        particleCount: 100,\n        spread: 70,\n        origin: { y: 0.6 },\n      });\n    }\n  }, [badge?.id]);\n\n  const handleClose = useCallback(() => {\n    // async handler async OK\n    onClose();\n  }, [onClose]);\n\n  // ESC\n  useEffect(() => {\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") handleClose();\n    };\n    window.addEventListener(\"keydown\", onKeyDown);\n    return () => window.removeEventListener(\"keydown\", onKeyDown);\n  }, [handleClose]);\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\"\n      onClick={handleClose} // \n      role=\"dialog\"\n      aria-modal=\"true\"\n    >\n      <div\n        className=\"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl relative\"\n        onClick={(e) => e.stopPropagation()} // \n      >\n        <button\n          onClick={handleClose}\n          className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n          aria-label=\"\"\n        >\n          <X className=\"w-6 h-6\" />\n        </button>\n\n        <div className=\"text-center\">\n          <div className=\"w-20 h-20 bg-yellow-100 dark:bg-yellow-900/20 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <Award className=\"w-10 h-10 text-yellow-600 dark:text-yellow-400\" />\n          </div>\n\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n            \n          </h2>\n\n          <div className=\"flex items-center justify-center space-x-2 mb-4\">\n            <Star className=\"w-5 h-5 text-yellow-500\" />\n            <span className=\"text-xl font-semibold text-gray-800 dark:text-gray-200\">\n              {badge.name}\n            </span>\n            <Star className=\"w-5 h-5 text-yellow-500\" />\n          </div>\n\n          <p className=\"text-gray-600 dark:text-gray-400 mb-8\">{badge.description}</p>\n\n          <button\n            onClick={handleClose}\n            className=\"bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors\"\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","import { useEffect, useMemo, useRef, useState } from 'react';\nimport { useBadges } from '../hooks/useBadges';\nimport { BadgeEarnedModal } from './BadgeEarnedModal';\n\ntype Props = {\n  userId: string;\n};\n\nexport function BadgeModalController({ userId }: Props) {\n  const { userBadges, markBadgeAsViewed } = useBadges(userId);\n\n  const [activeUserBadgeId, setActiveUserBadgeId] = useState<string | null>(null);\n\n  //   user_badges.id\n  const shownRef = useRef<Set<string>>(new Set());\n\n  //  NEWgetNewBadges\n  //  earned_at  tierOrder  name\n  const newBadges = useMemo(() => {\n    const list = (userBadges ?? []).filter((ub) => ub.is_new);\n\n    const tierOrder: Record<string, number> = {\n      '': 10,\n      '': 20,\n      '': 30,\n      '': 40,\n      '': 50,\n      '': 60,\n    };\n\n    return [...list].sort((a, b) => {\n      // 1) earned_at \n      const aTime = new Date(a.earned_at).getTime();\n      const bTime = new Date(b.earned_at).getTime();\n      if (aTime !== bTime) return aTime - bTime;\n\n      // 2)  tierOrder \n      const aName = a.badge?.name ?? '';\n      const bName = b.badge?.name ?? '';\n      const aTier = tierOrder[aName] ?? 999;\n      const bTier = tierOrder[bName] ?? 999;\n      if (aTier !== bTier) return aTier - bTier;\n\n      // 3) \n      return aName.localeCompare(bName, 'ja');\n    });\n  }, [userBadges]);\n\n  useEffect(() => {\n    if (activeUserBadgeId) return;\n\n    const next = newBadges.find((ub) => !shownRef.current.has(ub.id));\n    if (!next) return;\n\n    shownRef.current.add(next.id);\n    setActiveUserBadgeId(next.id);\n  }, [newBadges, activeUserBadgeId]);\n\n  const active = (userBadges ?? []).find((ub) => ub.id === activeUserBadgeId) || null;\n\n  const handleClose = async () => {\n    if (activeUserBadgeId) {\n      await markBadgeAsViewed(activeUserBadgeId);\n    }\n    setActiveUserBadgeId(null);\n  };\n\n  if (!active?.badge) return null;\n\n  return <BadgeEarnedModal badge={active.badge} onClose={handleClose} />;\n}","import React from 'react';\nimport { supabase } from '../lib/supabase';\n\n/**\n * decodeURIComponent \n */\nfunction safeDecode(value: string) {\n  try {\n    return decodeURIComponent(value);\n  } catch {\n    return value;\n  }\n}\n\n/**\n * open redirect \n * - \n */\nfunction normalizeNext(next: string | null) {\n  if (!next) return '/';\n  if (next.startsWith('http://') || next.startsWith('https://')) return '/';\n  if (!next.startsWith('/')) return '/';\n  return next;\n}\n\nexport function AuthCallbackPage({ onDone }: { onDone: () => void }) {\n  const [loading, setLoading] = React.useState(false);\n  const [error, setError] = React.useState<string | null>(null);\n\n  const url = new URL(window.location.href);\n\n  //  \n  const next = normalizeNext(url.searchParams.get('next'));\n\n  //  verify URL \n  // /auth/callback?verify=<ENCODED_SUPABASE_VERIFY_URL>&next=/reset-password\n  const verify = url.searchParams.get('verify');\n  const verifyUrl = verify ? safeDecode(verify) : null;\n\n  //  PKCE code Supabase code \n  const code = url.searchParams.get('code');\n\n  //   recovery hash \n  // #access_token=xxx&refresh_token=yyy&type=recovery\n  const hash = window.location.hash;\n  const hashParams = hash ? new URLSearchParams(hash.replace('#', '')) : null;\n  const hashType = hashParams?.get('type');\n  const access_token = hashParams?.get('access_token');\n  const refresh_token = hashParams?.get('refresh_token');\n\n  const hint = React.useMemo(() => {\n    if (verifyUrl) {\n      return '';\n    }\n    if (code) {\n      return '';\n    }\n    if (hashType === 'recovery') {\n      return '';\n    }\n    return '';\n  }, [verifyUrl, code, hashType]);\n\n  const handleConfirm = async () => {\n    setError(null);\n    setLoading(true);\n\n    try {\n      /**\n       * A) verify URL \n       *   Supabase  verify \n       */\n      if (verifyUrl) {\n        window.location.href = verifyUrl;\n        return;\n      }\n\n      /**\n       * B) PKCE code \n       */\n      if (code) {\n        const { error } = await supabase.auth.exchangeCodeForSession(code);\n        if (error) throw error;\n\n        // code  URL \n        window.history.replaceState({}, document.title, url.pathname);\n\n        window.location.href = next;\n        return;\n      }\n\n      /**\n       * C) recovery hash \n       */\n      if (hashType === 'recovery' && access_token && refresh_token) {\n        const { error } = await supabase.auth.setSession({\n          access_token,\n          refresh_token,\n        });\n        if (error) throw error;\n\n        // hash \n        window.history.replaceState({}, document.title, url.pathname + url.search);\n\n        window.location.href = next;\n        return;\n      }\n\n      throw new Error(\n        ''\n      );\n    } catch (e: any) {\n      console.error('[AuthCallback] failed:', e);\n      setError(e?.message ?? '');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 p-6\">\n      <div className=\"bg-white rounded-xl shadow p-6 max-w-md w-full space-y-4\">\n        <h1 className=\"text-lg font-bold\"></h1>\n\n        <p className=\"text-sm text-gray-600\">\n          {hint}\n        </p>\n\n        {error && (\n          <p className=\"text-sm text-red-600\">\n            {error}\n          </p>\n        )}\n\n        <button\n          onClick={handleConfirm}\n          disabled={loading}\n          className=\"w-full bg-blue-600 text-white rounded-lg py-2 disabled:opacity-50\"\n        >\n          {loading ? '' : ''}\n        </button>\n\n        {/*  */}\n        <button\n          type=\"button\"\n          onClick={() => (window.location.href = '/invite-expired')}\n          className=\"w-full text-sm text-gray-600 underline\"\n        >\n          \n        </button>\n\n        <button\n          type=\"button\"\n          onClick={() => {\n            window.history.replaceState({}, '', '/');\n            onDone();\n          }}\n          className=\"w-full text-sm text-gray-500 underline\"\n        >\n          \n        </button>\n      </div>\n    </div>\n  );\n}","// src/pages/InviteExpired.tsx\nimport React, { useMemo, useState } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { Mail, RefreshCcw, AlertTriangle, CheckCircle, ArrowLeft } from 'lucide-react';\n\ntype Status = 'idle' | 'sending' | 'success' | 'error';\n\nfunction normalizeEmail(v: string) {\n  return v.trim().toLowerCase();\n}\n\nexport default function InviteExpired() {\n  const [email, setEmail] = useState('');\n  const [status, setStatus] = useState<Status>('idle');\n  const [message, setMessage] = useState<string>('');\n\n  const canSubmit = useMemo(() => {\n    const e = normalizeEmail(email);\n    return e.includes('@') && e.includes('.') && status !== 'sending';\n  }, [email, status]);\n\n  const handleSend = async () => {\n    const e = normalizeEmail(email);\n    if (!e) return;\n\n    setStatus('sending');\n    setMessage('');\n\n    try {\n      //  Edge Function: request-password-reset \n      // - recoveryResend\n      const { data, error } = await supabase.functions.invoke('request-password-reset', {\n        body: {\n          email: e,\n          redirectUrl: `${window.location.origin}/reset-password`,\n        },\n      });\n\n      if (error) {\n        console.error('[InviteExpired] request-password-reset error:', error);\n        setStatus('error');\n        setMessage('');\n        return;\n      }\n\n      //  success\n      // OK\n      console.log('[InviteExpired] request-password-reset result:', data);\n      setStatus('success');\n      setMessage('');\n    } catch (err: any) {\n      console.error('[InviteExpired] exception:', err);\n      setStatus('error');\n      setMessage(err?.message || '');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden\">\n        <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-start space-x-3\">\n            <div className=\"mt-1\">\n              <AlertTriangle className=\"w-6 h-6 text-amber-500\" />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                \n              </h1>\n              <p className=\"text-sm text-gray-600 dark:text-gray-300 mt-1\">\n                = \n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"p-6 space-y-4\">\n          <div className=\"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 text-sm text-amber-900 dark:text-amber-200\">\n            <p className=\"font-medium mb-1\"></p>\n            <ul className=\"list-disc list-inside space-y-1\">\n              <li></li>\n              <li></li>\n              <li></li>\n            </ul>\n          </div>\n\n          <label className=\"block\">\n            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-200\">\n              \n            </span>\n            <div className=\"mt-2 flex items-center space-x-2\">\n              <div className=\"relative flex-1\">\n                <Mail className=\"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2\" />\n                <input\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"tanaka@example.com\"\n                  className=\"w-full pl-10 pr-3 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900\n                             text-gray-900 dark:text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  type=\"email\"\n                  autoComplete=\"email\"\n                />\n              </div>\n              <button\n                onClick={handleSend}\n                disabled={!canSubmit}\n                className=\"px-4 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium\n                           disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2\"\n                type=\"button\"\n              >\n                {status === 'sending' ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\" />\n                    <span></span>\n                  </>\n                ) : (\n                  <>\n                    <RefreshCcw className=\"w-4 h-4\" />\n                    <span></span>\n                  </>\n                )}\n              </button>\n            </div>\n          </label>\n\n          {message && (\n            <div\n              className={`rounded-lg p-3 text-sm border ${\n                status === 'success'\n                  ? 'bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200'\n                  : 'bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200'\n              }`}\n            >\n              <div className=\"flex items-start space-x-2\">\n                {status === 'success' ? (\n                  <CheckCircle className=\"w-4 h-4 mt-0.5\" />\n                ) : (\n                  <AlertTriangle className=\"w-4 h-4 mt-0.5\" />\n                )}\n                <p>{message}</p>\n              </div>\n            </div>\n          )}\n\n          <div className=\"text-xs text-gray-600 dark:text-gray-300 space-y-1\">\n            <p> </p>\n            <p> </p>\n          </div>\n\n          <div className=\"pt-2\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                window.history.replaceState({}, '', '/');\n                window.location.reload();\n              }}\n              className=\"text-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white flex items-center space-x-2\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              <span></span>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","import React from 'react';\nimport { Bell, AlertTriangle } from 'lucide-react';\n\ninterface AlertBadgeProps {\n  count: number;\n  hasHighPriority?: boolean;\n  onClick?: () => void;\n  className?: string;\n}\n\nexport function AlertBadge({ count, hasHighPriority = false, onClick, className = '' }: AlertBadgeProps) {\n  if (count === 0) {\n    return (\n      <button\n        onClick={onClick}\n        className={`\n          relative p-2 text-gray-400 dark:text-gray-500 \n          hover:text-gray-600 dark:hover:text-gray-300 \n          transition-colors ${className}\n        `}\n      >\n        <Bell className=\"w-6 h-6\" />\n      </button>\n    );\n  }\n\n  return (\n    <button\n      onClick={onClick}\n      className={`\n        relative p-2 transition-colors ${\n          hasHighPriority \n            ? 'text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300' \n            : 'text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300'\n        } ${className}\n      `}\n    >\n      {hasHighPriority ? (\n        <AlertTriangle className=\"w-6 h-6 animate-pulse\" />\n      ) : (\n        <Bell className=\"w-6 h-6\" />\n      )}\n      \n      {/* Badge */}\n      <span className={`\n        absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white \n        transform translate-x-1/2 -translate-y-1/2 rounded-full min-w-[20px] h-5 ${\n          hasHighPriority \n            ? 'bg-red-600 dark:bg-red-500 animate-pulse' \n            : count > 9 \n              ? 'bg-blue-600 dark:bg-blue-500' \n              : 'bg-blue-600 dark:bg-blue-500'\n        }\n      `}>\n        {count > 99 ? '99+' : count}\n      </span>\n    </button>\n  );\n}","// src/components/GlobalHeader.tsx\nimport React from 'react';\nimport { AlertTriangle, HelpCircle, Menu, X, LogOut, Shield, FileText, Building2 } from 'lucide-react';\nimport { AlertBadge } from './AlertBadge';\nimport type { AppRole } from '../lib/roles';\n\ntype Role = AppRole;\n\ntype GlobalHeaderProps = {\n  effectiveRole: Role;\n\n  userProfile: {\n    id: string;\n    name: string;\n    email: string;\n  };\n\n  alertsLoading: boolean;\n  unreadCount: number;\n  hasHighPriorityAlerts: boolean;\n\n  onOpenAlertPanel: () => void;\n  onLogout: (e: React.MouseEvent<HTMLButtonElement>) => void;\n\n  onHome: () => void;\n\n  onNavigateToPrivacy?: () => void;\n  onNavigateToTerms?: () => void;\n  onNavigateToCommercial?: () => void;\n  onNavigateToHelp?: () => void;\n};\n\nexport function GlobalHeader({\n  effectiveRole,\n  userProfile,\n  alertsLoading,\n  unreadCount,\n  hasHighPriorityAlerts,\n  onOpenAlertPanel,\n  onLogout,\n  onHome,\n  onNavigateToPrivacy,\n  onNavigateToTerms,\n  onNavigateToCommercial,\n  onNavigateToHelp,\n}: GlobalHeaderProps) {\n  const [showMobileMenu, setShowMobileMenu] = React.useState(false);\n\n  // Athletes: AthleteView\n  if (effectiveRole === 'athlete') return null;\n\n  const closeMenu = () => setShowMobileMenu(false);\n\n  return (\n    <>\n      <nav className=\"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 relative z-40 transition-colors\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            {/* Left: Logo */}\n            <div className=\"flex items-center\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  onHome();\n                  closeMenu();\n                }}\n                className=\"flex items-baseline space-x-2 transition-colors active:opacity-70 cursor-pointer\"\n                style={{ WebkitTapHighlightColor: 'transparent' }}\n              >\n                <span\n                  className=\"text-xl font-bold tracking-tight text-gray-900 dark:text-white\"\n                  style={{\n                    fontFamily:\n                      '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif',\n                    letterSpacing: '-0.02em',\n                  }}\n                >\n                  Bekuta\n                </span>\n                <span\n                  className=\"text-xs font-medium text-gray-500 dark:text-gray-400 hidden sm:inline\"\n                  style={{ letterSpacing: '0.05em' }}\n                >\n                  by ARCA\n                </span>\n              </button>\n            </div>\n\n            {/* Right */}\n            <div className=\"flex items-center space-x-3\">\n              {/* Desktop name */}\n              <span className=\"text-sm text-gray-600 dark:text-gray-300 hidden md:block transition-colors\">\n                {userProfile.name}\n              </span>\n\n              {/* Alerts */}\n              {!alertsLoading && (\n                <AlertBadge\n                  count={unreadCount}\n                  hasHighPriority={hasHighPriorityAlerts}\n                  onClick={onOpenAlertPanel}\n                  className=\"touch-target\"\n                />\n              )}\n\n              {/* Desktop legal/help (optional): OK */}\n              {/* Desktop logout */}\n              <button\n                onClick={onLogout}\n                className=\"hidden md:flex bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600\n                  text-gray-700 dark:text-gray-200 px-3 py-2 rounded-lg\n                  border border-gray-300 dark:border-gray-600\n                  transition-colors items-center space-x-2 text-sm\"\n                type=\"button\"\n              >\n                <LogOut className=\"w-4 h-4\" />\n                <span></span>\n              </button>\n\n              {/* Mobile hamburger */}\n              <button\n                onClick={() => setShowMobileMenu((v) => !v)}\n                className=\"md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\n                type=\"button\"\n                aria-label=\"\"\n              >\n                {showMobileMenu ? <X className=\"w-6 h-6\" /> : <Menu className=\"w-6 h-6\" />}\n              </button>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Mobile Menu */}\n      {showMobileMenu && (\n        <div className=\"md:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg transition-colors relative z-40\">\n          <div className=\"px-4 py-3 space-y-2\">\n            {/* Profile */}\n            <div className=\"flex items-center space-x-3 pb-3 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center\">\n                <span className=\"text-blue-600 dark:text-blue-400 font-semibold text-sm\">\n                  {(userProfile.name || 'U').charAt(0)}\n                </span>\n              </div>\n              <div className=\"min-w-0\">\n                <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                  {userProfile.name}\n                </p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">{userProfile.email}</p>\n              </div>\n            </div>\n\n            {/* Help / Legal */}\n            {onNavigateToHelp && (\n              <button\n                onClick={() => {\n                  closeMenu();\n                  onNavigateToHelp();\n                }}\n                className=\"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                type=\"button\"\n              >\n                <HelpCircle className=\"w-5 h-5\" />\n                <span></span>\n              </button>\n            )}\n\n            {onNavigateToPrivacy && (\n              <button\n                onClick={() => {\n                  closeMenu();\n                  onNavigateToPrivacy();\n                }}\n                className=\"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                type=\"button\"\n              >\n                <Shield className=\"w-5 h-5\" />\n                <span></span>\n              </button>\n            )}\n\n            {onNavigateToTerms && (\n              <button\n                onClick={() => {\n                  closeMenu();\n                  onNavigateToTerms();\n                }}\n                className=\"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                type=\"button\"\n              >\n                <FileText className=\"w-5 h-5\" />\n                <span></span>\n              </button>\n            )}\n\n            {onNavigateToCommercial && (\n              <button\n                onClick={() => {\n                  closeMenu();\n                  onNavigateToCommercial();\n                }}\n                className=\"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                type=\"button\"\n              >\n                <Building2 className=\"w-5 h-5\" />\n                <span></span>\n              </button>\n            )}\n\n            {/* Divider */}\n            <div className=\"border-t border-gray-200 dark:border-gray-700 my-2\" />\n\n            {/* Logout */}\n            <button\n              onClick={(e) => {\n                closeMenu();\n                onLogout(e);\n              }}\n              className=\"w-full flex items-center space-x-3 px-4 py-3 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n              type=\"button\"\n            >\n              <LogOut className=\"w-5 h-5\" />\n              <span></span>\n            </button>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}","//components/BekutaSplash.tsx\nimport React from \"react\";\n\nexport function BekutaSplash({ subtitle }: { subtitle?: string }) {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950\">\n      <div className=\"text-center px-6\">\n        <div className=\"text-4xl font-extrabold tracking-tight text-gray-900 dark:text-white\">\n          Bekuta\n        </div>\n        <div className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\n          {subtitle ?? \"\"}\n        </div>\n\n        {/*  */}\n        <div className=\"mt-6 flex justify-center\">\n          <div className=\"h-6 w-6 rounded-full border-2 border-gray-300 dark:border-gray-700 border-t-transparent animate-spin\" />\n        </div>\n      </div>\n    </div>\n  );\n}","// src/components/ProfileGate.tsx\nimport React, { useEffect, useState } from \"react\";\nimport { BekutaSplash } from \"./BekutaSplash\";\nimport { supabase } from \"../lib/supabase\";\n\ntype Props = {\n  loading: boolean;\n  ready: boolean;\n  onRetry: () => void;\n  children: React.ReactNode;\n  timeoutMs?: number; // : 12000\n};\n\nexport function ProfileGate({ loading, ready, onRetry, children, timeoutMs = 12000 }: Props) {\n  const [timedOut, setTimedOut] = useState(false);\n\n  useEffect(() => {\n    if (!loading) {\n      setTimedOut(false);\n      return;\n    }\n    const t = setTimeout(() => setTimedOut(true), timeoutMs);\n    return () => clearTimeout(t);\n  }, [loading, timeoutMs]);\n\n  if (ready) return <>{children}</>;\n\n  if (!timedOut) {\n    return <BekutaSplash subtitle=\"\" />;\n  }\n\n  //  UI\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-white dark:bg-gray-950\">\n      <div className=\"max-w-md w-full p-6 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900\">\n        <div className=\"text-xl font-bold text-gray-900 dark:text-white\">Bekuta</div>\n        <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-300\">\n          \n        </p>\n\n        <div className=\"mt-5 flex gap-2\">\n          <button\n            type=\"button\"\n            className=\"px-4 py-2 rounded-lg bg-gray-900 text-white dark:bg-white dark:text-gray-900 text-sm font-semibold\"\n            onClick={onRetry}\n          >\n            \n          </button>\n\n          <button\n            type=\"button\"\n            className=\"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 text-sm\"\n            onClick={async () => {\n              await supabase.auth.signOut();\n              window.location.href = \"/\";\n            }}\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","// src/pages/MaintenancePage.tsx\nimport React, { useMemo } from \"react\";\nimport { Sparkles, ShieldAlert, RefreshCcw, ExternalLink } from \"lucide-react\";\n\ntype Props = {\n  title?: string;\n  message?: string;\n  etaText?: string; // \n  showRetry?: boolean;\n};\n\nfunction getJSTNowLabel() {\n  const now = new Date();\n  // JST\n  const pad = (n: number) => String(n).padStart(2, \"0\");\n  return `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())} ${pad(\n    now.getHours()\n  )}:${pad(now.getMinutes())}`;\n}\n\nexport default function MaintenancePage({\n  title = \"\",\n  message = \"\",\n  etaText = \"\",\n  showRetry = true,\n}: Props) {\n  const nowLabel = useMemo(() => getJSTNowLabel(), []);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50 text-slate-900\">\n      {/* subtle background blobs */}\n      <div className=\"pointer-events-none fixed inset-0 overflow-hidden\">\n        <div className=\"absolute -top-24 -right-24 h-80 w-80 rounded-full bg-blue-200/35 blur-3xl\" />\n        <div className=\"absolute -bottom-28 -left-28 h-96 w-96 rounded-full bg-emerald-200/30 blur-3xl\" />\n        <div className=\"absolute top-1/3 left-1/2 h-72 w-72 -translate-x-1/2 rounded-full bg-violet-200/20 blur-3xl\" />\n      </div>\n\n      <div className=\"relative mx-auto max-w-2xl px-5 py-10\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-11 w-11 rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 flex items-center justify-center\">\n              <Sparkles className=\"h-5 w-5 text-slate-700\" />\n            </div>\n            <div>\n              <div className=\"text-xl font-extrabold tracking-tight\">\n                Bekuta\n                <span className=\"ml-2 text-xs font-semibold text-slate-500 align-middle\">\n                  maintenance\n                </span>\n              </div>\n              <div className=\"text-sm text-slate-500\">strength for the future</div>\n            </div>\n          </div>\n\n          <div className=\"text-xs text-slate-400\">\n            JST {nowLabel}\n          </div>\n        </div>\n\n        {/* Card */}\n        <div className=\"mt-8 rounded-3xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden\">\n          <div className=\"border-b border-slate-100 px-6 py-5 flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 text-sm font-semibold text-slate-700\">\n              <ShieldAlert className=\"h-4 w-4 text-rose-500\" />\n              {title}\n            </div>\n            <div className=\"text-xs text-slate-400\">System Status</div>\n          </div>\n\n          <div className=\"px-6 py-6\">\n            <div className=\"rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-5\">\n              <p className=\"text-slate-700 leading-relaxed\">\n                {message}\n              </p>\n\n              {etaText ? (\n                <div className=\"mt-3 text-sm text-slate-600\">\n                  <span className=\"font-semibold\"></span>{etaText}\n                </div>\n              ) : null}\n\n              <div className=\"mt-4 text-xs text-slate-500 leading-relaxed\">\n                 DB\n              </div>\n            </div>\n\n            {/* Actions */}\n            <div className=\"mt-5 flex flex-col sm:flex-row gap-3\">\n              {showRetry && (\n                <button\n                  onClick={() => window.location.reload()}\n                  className=\"inline-flex items-center justify-center gap-2 rounded-2xl bg-slate-900 text-white px-5 py-3 font-extrabold tracking-wide shadow-sm hover:bg-slate-800 active:scale-[0.99] transition\"\n                >\n                  <RefreshCcw className=\"h-4 w-4\" />\n                  \n                </button>\n              )}\n\n              <a\n                href=\"https://bekuta.netlify.app/\"\n                className=\"inline-flex items-center justify-center gap-2 rounded-2xl bg-white ring-1 ring-slate-200 px-5 py-3 font-bold text-slate-700 hover:bg-slate-50 active:scale-[0.99] transition\"\n              >\n                <ExternalLink className=\"h-4 w-4\" />\n                \n              </a>\n            </div>\n\n            {/* Footer note */}\n            <div className=\"mt-6 text-center text-xs text-slate-400\">\n              Small steps, big futures.  Bekuta\n            </div>\n          </div>\n        </div>\n\n        {/* Bottom */}\n        <div className=\"mt-8 text-center text-xs text-slate-400\">\n          \n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useState } from 'react';\nimport { Shield, FileText, CheckCircle, AlertCircle } from 'lucide-react';\n\ninterface ConsentModalProps {\n  onAccept: () => void;\n  onDecline: () => void;\n}\n\nexport function ConsentModal({ onAccept, onDecline }: ConsentModalProps) {\n  const [agreedToTerms, setAgreedToTerms] = useState(false);\n  const [agreedToPrivacy, setAgreedToPrivacy] = useState(false);\n  const [isMinor, setIsMinor] = useState<boolean | null>(null);\n  const [isLoggingOut, setIsLoggingOut] = useState(false);\n\n  // \n  const canAccept = agreedToTerms && agreedToPrivacy && isMinor !== null;\n\n  //  1\n  const handleAccept = () => {\n    if (!canAccept || isLoggingOut) return;\n    onAccept();\n  };\n\n  const handleDecline = async () => {\n    setIsLoggingOut(true);\n    await onDecline();\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6\">\n          <div className=\"flex items-center space-x-3\">\n            <Shield className=\"w-8 h-8\" />\n            <div>\n              <h2 className=\"text-2xl font-bold\">Bekuta </h2>\n              <p className=\"text-blue-100 text-sm mt-1\"></p>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 overflow-y-auto flex-1\">\n          <div className=\"space-y-6\">\n            {/*  */}\n            <div className=\"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-4 rounded\">\n              <div className=\"flex items-start\">\n                <AlertCircle className=\"w-5 h-5 text-orange-600 dark:text-orange-400 mr-3 mt-0.5 flex-shrink-0\" />\n                <div className=\"text-sm space-y-2\">\n                  <p className=\"font-bold text-orange-900 dark:text-orange-200\">\n                    \n                  </p>\n                  <ul className=\"space-y-1 text-orange-800 dark:text-orange-300\">\n                    <li> </li>\n                    <li> </li>\n                    <li> ACWR</li>\n                    <li> </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n\n            {/*  */}\n            <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-5\">\n              <h3 className=\"font-bold text-gray-900 dark:text-white mb-3 flex items-center\">\n                <FileText className=\"w-5 h-5 mr-2 text-purple-600 dark:text-purple-400\" />\n                \n              </h3>\n              <p className=\"text-sm text-gray-700 dark:text-gray-300 mb-4\">\n                18\n              </p>\n              <div className=\"flex space-x-4\">\n                <button\n                  onClick={() => setIsMinor(false)}\n                  className={`flex-1 py-3 px-4 rounded-lg border-2 transition-all ${\n                    isMinor === false\n                      ? 'border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-green-400'\n                  }`}\n                >\n                  <CheckCircle\n                    className={`w-5 h-5 mx-auto mb-1 ${\n                      isMinor === false ? 'text-green-500' : 'text-gray-400'\n                    }`}\n                  />\n                  <span className=\"text-sm font-medium\">18</span>\n                </button>\n                <button\n                  onClick={() => setIsMinor(true)}\n                  className={`flex-1 py-3 px-4 rounded-lg border-2 transition-all ${\n                    isMinor === true\n                      ? 'border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-yellow-400'\n                  }`}\n                >\n                  <AlertCircle\n                    className={`w-5 h-5 mx-auto mb-1 ${\n                      isMinor === true ? 'text-yellow-500' : 'text-gray-400'\n                    }`}\n                  />\n                  <span className=\"text-sm font-medium\">18</span>\n                </button>\n              </div>\n\n              {/* 18 */}\n              {isMinor !== null && isMinor && (\n                <div className=\"mt-4 bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-600 rounded-lg p-4\">\n                  <p className=\"text-sm text-yellow-800 dark:text-yellow-200 font-medium mb-2\">\n                    \n                  </p>\n                  <p className=\"text-xs text-yellow-700 dark:text-yellow-300 mb-3\">\n                    18\n                    \n                  </p>\n                  <div className=\"bg-white dark:bg-yellow-800/20 rounded-lg p-3 text-xs text-yellow-900 dark:text-yellow-100\">\n                    \n                    \n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/*  */}\n            <div className=\"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800\">\n              <label className=\"flex items-start cursor-pointer group\">\n                <div className=\"relative flex-shrink-0\">\n                  <input\n                    type=\"checkbox\"\n                    checked={agreedToTerms}\n                    onChange={(e) => setAgreedToTerms(e.target.checked)}\n                    className=\"sr-only peer\"\n                  />\n                  <div\n                    className={`\n                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center\n                    ${\n                      agreedToTerms\n                        ? 'bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500'\n                        : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500'\n                    }\n                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800\n                  `}\n                  >\n                    {agreedToTerms && (\n                      <CheckCircle className=\"w-4 h-4 text-white\" strokeWidth={3} />\n                    )}\n                  </div>\n                </div>\n                <div className=\"ml-4 flex-1\">\n                  <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    \n                  </span>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\n                    <a\n                      href=\"/terms\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-blue-600 dark:text-blue-400 hover:underline\"\n                      onClick={(e) => e.stopPropagation()}\n                    >\n                       \n                    </a>\n                  </p>\n                </div>\n              </label>\n            </div>\n\n            {/*  */}\n            <div className=\"border-2 border-gray-200 dark:border-gray-700 rounded-lg p-5 hover:border-blue-300 dark:hover:border-blue-600 transition-colors bg-white dark:bg-gray-800\">\n              <label className=\"flex items-start cursor-pointer group\">\n                <div className=\"relative flex-shrink-0\">\n                  <input\n                    type=\"checkbox\"\n                    checked={agreedToPrivacy}\n                    onChange={(e) => setAgreedToPrivacy(e.target.checked)}\n                    className=\"sr-only peer\"\n                  />\n                  <div\n                    className={`\n                    w-6 h-6 border-2 rounded-md transition-all duration-200 flex items-center justify-center\n                    ${\n                      agreedToPrivacy\n                        ? 'bg-blue-600 border-blue-600 dark:bg-blue-500 dark:border-blue-500'\n                        : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 group-hover:border-blue-400 dark:group-hover:border-blue-500'\n                    }\n                    peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-800\n                  `}\n                  >\n                    {agreedToPrivacy && (\n                      <CheckCircle className=\"w-4 h-4 text-white\" strokeWidth={3} />\n                    )}\n                  </div>\n                </div>\n                <div className=\"ml-4 flex-1\">\n                  <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    \n                  </span>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\n                    <a\n                      href=\"/privacy\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-blue-600 dark:text-blue-400 hover:underline\"\n                      onClick={(e) => e.stopPropagation()}\n                    >\n                       \n                    </a>\n                  </p>\n                </div>\n              </label>\n            </div>\n\n            {/*  */}\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\n              <h4 className=\"text-sm font-bold text-gray-900 dark:text-white mb-2\">\n                \n              </h4>\n              <ul className=\"text-xs text-gray-700 dark:text-gray-300 space-y-1\">\n                <li> RPE</li>\n                <li> </li>\n                <li> </li>\n                <li> </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-6 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700\">\n          {isLoggingOut ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n              <p className=\"text-gray-700 dark:text-gray-300 font-medium mb-2\">\n                \n              </p>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                ...\n              </p>\n            </div>\n          ) : (\n            <>\n              <div className=\"flex space-x-3\">\n                <button\n                  onClick={handleDecline}\n                  disabled={isLoggingOut}\n                  className=\"flex-1 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  \n                </button>\n                <button\n                  onClick={handleAccept}\n                  disabled={!canAccept || isLoggingOut}\n                  className={`flex-1 py-3 px-4 rounded-lg font-medium transition-all ${\n                    canAccept && !isLoggingOut\n                      ? 'bg-blue-600 hover:bg-blue-700 text-white'\n                      : 'bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-500 cursor-not-allowed'\n                  }`}\n                >\n                  {isMinor ? '' : ''}\n                </button>\n              </div>\n              <p className=\"text-xs text-center text-gray-500 dark:text-gray-400 mt-3\">\n                \n              </p>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useEffect } from 'react';\nimport { CheckCircle, X, AlertCircle, Info } from 'lucide-react';\n\nexport interface ToastProps {\n  id: string;\n  message: string;\n  type?: 'success' | 'error' | 'info';\n  duration?: number;\n  onClose: (id: string) => void;\n}\n\nexport function Toast({ id, message, type = 'success', duration = 3000, onClose }: ToastProps) {\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      onClose(id);\n    }, duration);\n\n    return () => clearTimeout(timer);\n  }, [id, duration, onClose]);\n\n  const getIcon = () => {\n    switch (type) {\n      case 'success':\n        return <CheckCircle className=\"w-5 h-5 text-green-600 dark:text-green-400\" />;\n      case 'error':\n        return <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400\" />;\n      case 'info':\n        return <Info className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />;\n      default:\n        return <CheckCircle className=\"w-5 h-5 text-green-600 dark:text-green-400\" />;\n    }\n  };\n\n  const getBackgroundColor = () => {\n    switch (type) {\n      case 'success':\n        return 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800';\n      case 'error':\n        return 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800';\n      case 'info':\n        return 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800';\n      default:\n        return 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800';\n    }\n  };\n\n  return (\n    <div\n      className={`${getBackgroundColor()} border rounded-lg shadow-lg p-4 flex items-center space-x-3 min-w-[300px] max-w-md animate-slide-in-right`}\n      role=\"alert\"\n    >\n      {getIcon()}\n      <p className=\"flex-1 text-sm font-medium text-gray-900 dark:text-white\">{message}</p>\n      <button\n        onClick={() => onClose(id)}\n        className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors\"\n      >\n        <X className=\"w-4 h-4\" />\n      </button>\n    </div>\n  );\n}\n","import React from 'react';\nimport { Toast, ToastProps } from './Toast';\n\ninterface ToastContainerProps {\n  toasts: Omit<ToastProps, 'onClose'>[];\n  onClose: (id: string) => void;\n}\n\nexport function ToastContainer({ toasts, onClose }: ToastContainerProps) {\n  return (\n    <div className=\"fixed top-4 right-4 z-50 space-y-2\">\n      {toasts.map((toast) => (\n        <Toast key={toast.id} {...toast} onClose={onClose} />\n      ))}\n    </div>\n  );\n}\n","import React from 'react';\nimport { Shield, FileText, Building2, Mail } from 'lucide-react';\n\ninterface FooterProps {\n  onNavigateToPrivacy?: () => void;\n  onNavigateToTerms?: () => void;\n  onNavigateToCommercial?: () => void;\n}\n\nexport function Footer({ onNavigateToPrivacy, onNavigateToTerms, onNavigateToCommercial }: FooterProps) {\n  const currentYear = new Date().getFullYear();\n\n  return (\n    <footer className=\"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8\">\n        {/* :  */}\n        <div className=\"md:hidden\">\n          <div className=\"text-center space-y-3\">\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n               {currentYear} ARCA. All Rights Reserved.\n            </p>\n            <p className=\"text-xs text-gray-400 dark:text-gray-500\">\n              \n            </p>\n          </div>\n        </div>\n\n        {/* PC:  */}\n        <div className=\"hidden md:grid grid-cols-1 md:grid-cols-3 gap-8\">\n          {/*  */}\n          <div>\n            <h3 className=\"text-sm font-bold text-gray-900 dark:text-white mb-3\">\n              Bekuta by ARCA\n            </h3>\n            <p className=\"text-xs text-gray-600 dark:text-gray-400 leading-relaxed\">\n              \n              ACWR\n            </p>\n            <div className=\"mt-4 flex items-center text-xs text-gray-500 dark:text-gray-400\">\n              <AlertCircle className=\"w-4 h-4 mr-1\" />\n              <span></span>\n            </div>\n          </div>\n\n          {/*  */}\n          <div>\n            <h3 className=\"text-sm font-bold text-gray-900 dark:text-white mb-3\">\n              \n            </h3>\n            <ul className=\"space-y-2\">\n              <li>\n                <button\n                  onClick={onNavigateToPrivacy}\n                  className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors\"\n                >\n                  <Shield className=\"w-4 h-4 mr-2\" />\n                  \n                </button>\n              </li>\n              <li>\n                <button\n                  onClick={onNavigateToTerms}\n                  className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors\"\n                >\n                  <FileText className=\"w-4 h-4 mr-2\" />\n                  \n                </button>\n              </li>\n              <li>\n                <button\n                  onClick={onNavigateToCommercial}\n                  className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors\"\n                >\n                  <Building2 className=\"w-4 h-4 mr-2\" />\n                  \n                </button>\n              </li>\n            </ul>\n          </div>\n\n          {/*  */}\n          <div>\n            <h3 className=\"text-sm font-bold text-gray-900 dark:text-white mb-3\">\n              \n            </h3>\n            <div className=\"space-y-3\">\n              <a\n                href=\"mailto:info@arca.fit\"\n                className=\"flex items-center text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors\"\n              >\n                <Mail className=\"w-4 h-4 mr-2\" />\n                info@arca.fit\n              </a>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                2-3\n              </p>\n            </div>\n\n            <div className=\"mt-4\">\n              <h4 className=\"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2\">\n                \n              </h4>\n              <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n                ARCA<br/>\n                 \n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/*  - PC */}\n        <div className=\"hidden md:block mt-8 pt-6 border-t border-gray-200 dark:border-gray-700\">\n          <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-4 rounded\">\n            <p className=\"text-xs text-yellow-800 dark:text-yellow-200 leading-relaxed\">\n              <strong>:</strong> \n              ACWR\n              \n            </p>\n          </div>\n        </div>\n\n        {/*  - PC */}\n        <div className=\"hidden md:block mt-6 pt-6 border-t border-gray-200 dark:border-gray-700\">\n          <div className=\"flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0\">\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n               {currentYear} ARCA. All Rights Reserved.\n            </p>\n            <div className=\"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400\">\n              <span>Version 1.0.0</span>\n              <span></span>\n              <span></span>\n            </div>\n          </div>\n        </div>\n\n        {/*  - PC */}\n        <div className=\"hidden md:block mt-4\">\n          <details className=\"text-xs text-gray-500 dark:text-gray-400\">\n            <summary className=\"cursor-pointer hover:text-gray-700 dark:hover:text-gray-300\">\n              \n            </summary>\n            <div className=\"mt-2 pl-4 space-y-1\">\n              <p> React - MIT License</p>\n              <p> Recharts - MIT License</p>\n              <p> Supabase - Apache License 2.0</p>\n              <p> Lucide Icons - ISC License</p>\n              <p> Tailwind CSS - MIT License</p>\n            </div>\n          </details>\n        </div>\n      </div>\n    </footer>\n  );\n}\n\n// AlertCircle component for inline use\nfunction AlertCircle({ className }: { className?: string }) {\n  return (\n    <svg\n      className={className}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        strokeWidth={2}\n        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n      />\n    </svg>\n  );\n}\n","// src/components/TeamAchievementNotification.tsx\nimport React, { useEffect, useState, useRef, useCallback } from \"react\";\nimport { Trophy, X, Users, Award, TrendingUp } from \"lucide-react\";\nimport { supabase } from \"../lib/supabase\";\nimport confetti from \"canvas-confetti\";\nimport { useRealtimeHub } from \"../hooks/useRealtimeHub\";\n\nconst ENABLE_REALTIME = import.meta.env.VITE_ENABLE_REALTIME === \"true\";\nconst POLL_MS = 120_000; // 120\n\ninterface TeamAchievement {\n  id: string;\n  team_id: string;\n  achievement_type: string;\n  title: string;\n  description: string | null;\n  achieved_at: string | null;\n  metadata: any;\n  celebrated: boolean;\n}\n\ninterface TeamAchievementNotificationRow {\n  id: string;\n  team_id: string;\n  user_id: string;\n  achievement_id: string;\n  is_read: boolean;\n  created_at: string;\n  achievement: TeamAchievement | null;\n}\n\ninterface Props {\n  userId: string;\n}\n\nexport function TeamAchievementNotification({ userId }: Props) {\n  const { state, registerPollJob } = useRealtimeHub();\n\n  const [notifications, setNotifications] = useState<TeamAchievementNotificationRow[]>([]);\n  const [showNotification, setShowNotification] = useState(false);\n  const [currentNotification, setCurrentNotification] =\n    useState<TeamAchievementNotificationRow | null>(null);\n\n  //  hookjob key / channel\n  const instanceIdRef = useRef(\n    globalThis.crypto?.randomUUID?.() ?? Math.random().toString(36).slice(2)\n  );\n\n  //  WS channel\n  const channelRef = useRef<ReturnType<typeof supabase.channel> | null>(null);\n\n  //  Poll unregister\n  const unregisterPollRef = useRef<null | (() => void)>(null);\n\n  //  realtime  poll fallback \n  const [realtimeFailed, setRealtimeFailed] = useState(false);\n\n  const removeChannelSafe = useCallback(() => {\n    const ch = channelRef.current;\n    if (!ch) return;\n\n    try {\n      ch.unsubscribe?.();\n    } catch (_) {}\n\n    try {\n      supabase.removeChannel(ch);\n    } catch (_) {}\n\n    channelRef.current = null;\n  }, []);\n\n  const loadUnreadNotifications = useCallback(async () => {\n    if (!userId) return;\n\n    const { data, error } = await supabase\n      .from(\"team_achievement_notifications\")\n      .select(\n        `\n        id, team_id, user_id, achievement_id, is_read, created_at,\n        achievement:team_achievements (\n          id, team_id, achievement_type, title, description, achieved_at, metadata, celebrated\n        )\n      `\n      )\n      .eq(\"user_id\", userId)\n      .eq(\"is_read\", false)\n      .order(\"created_at\", { ascending: true });\n\n    if (error) {\n      console.error(\"[team_achievement_notifications] load error:\", error);\n      return;\n    }\n    if (!data) return;\n\n    // achievement null RLS/\n    const safe = (data as any[]).filter((n) => n.achievement);\n    setNotifications(safe as TeamAchievementNotificationRow[]);\n  }, [userId]);\n\n  //  visible/online  1Hubstate\n  useEffect(() => {\n    if (!userId) return;\n    if (!state.canRun) return;\n    void loadUnreadNotifications();\n  }, [userId, state.canRun, loadUnreadNotifications]);\n\n  //  RealtimeHubvisible & online\n  useEffect(() => {\n    // \n    removeChannelSafe();\n\n    if (!userId) return;\n\n    const canUseRealtime =\n      ENABLE_REALTIME && state.canRealtime && !realtimeFailed;\n\n    if (!canUseRealtime) return;\n\n    const channel = supabase\n      .channel(`team-achievements:${userId}:${instanceIdRef.current}`)\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"INSERT\",\n          schema: \"public\",\n          table: \"team_achievement_notifications\",\n          filter: `user_id=eq.${userId}`,\n        },\n        () => {\n          void loadUnreadNotifications();\n        }\n      );\n\n    channelRef.current = channel;\n\n    channel.subscribe((status) => {\n      if (import.meta.env.DEV) console.log(\"[TeamAchievementNotification] rt\", status);\n\n      if (status === \"SUBSCRIBED\") {\n        void loadUnreadNotifications();\n      }\n\n      //   poll fallback \n      if (status === \"CHANNEL_ERROR\" || status === \"TIMED_OUT\") {\n        console.warn(\"[TeamAchievementNotification] realtime issue:\", status);\n        setRealtimeFailed(true);\n        removeChannelSafe();\n      }\n    });\n\n    return () => {\n      removeChannelSafe();\n    };\n  }, [userId, state.canRealtime, realtimeFailed, loadUnreadNotifications, removeChannelSafe]);\n\n  //  PollingRealtime Hub \n  useEffect(() => {\n    // job\n    if (unregisterPollRef.current) {\n      unregisterPollRef.current();\n      unregisterPollRef.current = null;\n    }\n\n    if (!userId) return;\n\n    // RealtimeOFF Realtime poll fallback\n    const pollEnabled = !ENABLE_REALTIME || realtimeFailed;\n\n    if (!pollEnabled) return;\n\n    const key = `team_achievements:${userId}:${instanceIdRef.current}`;\n\n    const unregister = registerPollJob({\n      key,\n      intervalMs: POLL_MS,\n      run: async () => {\n        await loadUnreadNotifications();\n      },\n      enabled: true,\n      requireVisible: true, //  \n      requireOnline: true,  //  offline \n      immediate: true,      //  poll fallback\n    });\n\n    unregisterPollRef.current = unregister;\n\n    return () => {\n      if (unregisterPollRef.current) {\n        unregisterPollRef.current();\n        unregisterPollRef.current = null;\n      }\n    };\n  }, [userId, realtimeFailed, registerPollJob, loadUnreadNotifications]);\n\n  //  Realtime /\n  useEffect(() => {\n    if (!ENABLE_REALTIME) return;\n    if (!userId) return;\n    if (!state.canRealtime) return;\n\n    // visible&online\n    if (realtimeFailed) {\n      setRealtimeFailed(false);\n    }\n  }, [userId, state.canRealtime, realtimeFailed]);\n\n  useEffect(() => {\n    if (notifications.length > 0 && !showNotification) {\n      setCurrentNotification(notifications[0]);\n      setShowNotification(true);\n      triggerConfetti();\n    }\n  }, [notifications, showNotification]);\n\n  const triggerConfetti = () => {\n    const duration = 2500;\n    const end = Date.now() + duration;\n    const defaults = { startVelocity: 25, spread: 360, ticks: 60, zIndex: 9999 };\n\n    const interval: any = setInterval(() => {\n      const timeLeft = end - Date.now();\n      if (timeLeft <= 0) return clearInterval(interval);\n\n      const particleCount = 50 * (timeLeft / duration);\n      confetti({ ...defaults, particleCount, origin: { x: 0.2, y: 0.2 } });\n      confetti({ ...defaults, particleCount, origin: { x: 0.8, y: 0.2 } });\n    }, 200);\n  };\n\n  const handleClose = async () => {\n    if (!currentNotification) return;\n\n    const { error } = await supabase.rpc(\"mark_team_notification_read\", {\n      p_notification_id: currentNotification.id,\n    });\n    if (error) console.error(\"[mark_team_notification_read] error:\", error);\n\n    setShowNotification(false);\n    setNotifications((prev) => prev.filter((n) => n.id !== currentNotification.id));\n    setCurrentNotification(null);\n  };\n\n  const getAchievementIcon = (type: string) => {\n    switch (type) {\n      case \"team_streak\":\n      case \"streak_7\":\n        return Users;\n      case \"team_personal_best\":\n      case \"pb\":\n        return Award;\n      case \"team_acwr_safe\":\n        return TrendingUp;\n      case \"team_goals_complete\":\n      case \"goal\":\n        return Trophy;\n      default:\n        return Trophy;\n    }\n  };\n\n  if (!showNotification || !currentNotification) return null;\n\n  const achievement = currentNotification.achievement;\n  if (!achievement) return null;\n\n  const Icon = getAchievementIcon(achievement.achievement_type);\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4 animate-fade-in\">\n      <div className=\"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-2xl shadow-2xl max-w-md w-full p-8 border-4 border-yellow-400 dark:border-yellow-600 animate-bounce-in\">\n        <div className=\"flex justify-end mb-2\">\n          <button\n            onClick={handleClose}\n            className=\"p-2 hover:bg-yellow-200 dark:hover:bg-yellow-800 rounded-lg transition-colors\"\n          >\n            <X className=\"w-5 h-5 text-gray-600 dark:text-gray-400\" />\n          </button>\n        </div>\n\n        <div className=\"text-center\">\n          <div className=\"inline-flex items-center justify-center w-20 h-20 bg-yellow-400 dark:bg-yellow-600 rounded-full mb-4 animate-pulse\">\n            <Icon className=\"w-10 h-10 text-white\" />\n          </div>\n\n          <h2 className=\"text-3xl font-bold mb-2 text-gray-900 dark:text-white\"></h2>\n\n          <div className=\"mb-4\">\n            <h3 className=\"text-xl font-semibold text-yellow-800 dark:text-yellow-200 mb-1\">\n              {achievement.title}\n            </h3>\n            {achievement.description ? (\n              <p className=\"text-gray-700 dark:text-gray-300\">{achievement.description}</p>\n            ) : null}\n          </div>\n\n          <button\n            onClick={handleClose}\n            className=\"w-full py-3 bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 text-white font-semibold rounded-lg transition-colors\"\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","// App.tsx\nimport React, { Suspense, lazy } from 'react';\nimport { useAuth } from './hooks/useAuth';\nimport { useAlerts } from './hooks/useAlerts';\nimport { useOrganizationRole } from './hooks/useOrganizationRole';\nimport { useToast } from './hooks/useToast';\nimport { TutorialProvider } from './contexts/TutorialContext';\nimport { LoginForm } from './components/LoginForm';\nimport { PasswordChangeForm } from './components/PasswordChangeForm';\nimport { WelcomePage } from './components/WelcomePage';\nimport { AthleteView } from './components/AthleteView';\nimport { StaffView } from './components/StaffView';\nimport { AdminView } from './components/AdminView';\nimport { BadgeModalController } from './components/BadgeModalController';\nimport { AuthCallbackPage } from './pages/AuthCallbackPage';\nimport InviteExpired from './pages/InviteExpired';\nimport { GlobalHeader } from './components/GlobalHeader';\nimport { ProfileGate } from \"./components/ProfileGate\";\n\n//  \nimport MaintenancePage from \"./pages/MaintenancePage\";\n\nconst OrganizationAdminView = lazy(() =>\n  import('./components/OrganizationAdminView').then((m) => ({\n    default: m.OrganizationAdminView,\n  })),\n);\n\nimport { AlertBadge } from './components/AlertBadge';\nconst AlertPanel = lazy(() =>\n  import('./components/AlertPanel').then((m) => ({ default: m.AlertPanel })),\n);\n\nimport { Building2, Users } from 'lucide-react';\nimport { ConsentModal } from './components/ConsentModal';\nimport { ToastContainer } from './components/ToastContainer';\nimport { Footer } from './components/Footer';\nimport { PrivacyPolicy } from './pages/PrivacyPolicy';\nimport { TermsOfService } from './pages/TermsOfService';\nimport { CommercialTransactions } from './pages/CommercialTransactions';\nimport { HelpPage } from './pages/HelpPage';\nimport { TeamAchievementNotification } from './components/TeamAchievementNotification';\nimport type { AppRole } from './lib/roles';          //  TypeScript\nimport { isGlobalAdmin } from './lib/permissions';\nimport { supabase, recoverFromInvalidRefreshToken } from './lib/supabase';\n\nfunction App() {\n  const {\n    user,\n    userProfile,\n    loading: authLoading,\n    requiresPasswordChange: authRequiresPasswordChange,\n    signIn,\n    signOut,\n    changePassword,\n    acceptTerms,\n    refreshUserProfile,\n  } = useAuth();\n\n  //   + auth state \n  React.useEffect(() => {\n    let mounted = true;\n\n    //   refresh_token \n    (async () => {\n      const { error } = await supabase.auth.getSession();\n      if (!mounted) return;\n\n      if (error) {\n        await recoverFromInvalidRefreshToken(error);\n      }\n    })();\n\n    //  // auth \n    const { data } = supabase.auth.onAuthStateChange(async (event, session) => {\n      if (!mounted) return;\n\n      //  refresh \n      if (!session && (event === 'TOKEN_REFRESHED' || event === 'SIGNED_IN')) {\n        const { error } = await supabase.auth.getSession();\n        if (error) await recoverFromInvalidRefreshToken(error);\n      }\n    });\n\n    return () => {\n      mounted = false;\n      data.subscription.unsubscribe();\n    };\n  }, []);\n\n  const effectiveRole: AppRole =\n    userProfile?.role === \"staff\" ||\n    userProfile?.role === \"global_admin\" ||\n    userProfile?.role === \"athlete\"\n      ? (userProfile.role as AppRole)\n      : \"athlete\";\n\n  const [requiresPasswordChange, setRequiresPasswordChange] = React.useState(false);\n  const { isOrganizationAdmin, getOrganizationAdminRoles } = useOrganizationRole(userProfile?.id);\n\n  const {\n    alerts,\n    loading: alertsLoading,\n    unreadCount,\n    markAsRead,\n    dismissAlert,\n    markAllAsRead,\n    getAlertsByPriority,\n  } = useAlerts(userProfile?.id || '', effectiveRole);\n\n  const { toasts, removeToast } = useToast();\n\n  const [showAlertPanel, setShowAlertPanel] = React.useState(false);\n  const [showConsentModal, setShowConsentModal] = React.useState(false);\n  const [currentPage, setCurrentPage] =\n    React.useState<'app' | 'privacy' | 'terms' | 'commercial' | 'help' | 'reset-password' | 'auth-callback' | 'invite-expired' | 'welcome'>('app');\n\n  const [dashboardMode, setDashboardMode] = React.useState<'staff' | 'org-admin'>('staff');\n  const [termsAcceptedLocally, setTermsAcceptedLocally] = React.useState(false);\n\n  React.useEffect(() => {\n    setRequiresPasswordChange(authRequiresPasswordChange);\n  }, [authRequiresPasswordChange]);\n\n  //  URL \n  React.useEffect(() => {\n    const url = new URL(window.location.href);\n    const pathname = url.pathname;\n    const searchParams = url.searchParams;\n\n    if (pathname.startsWith('/auth/callback')) {\n      setCurrentPage('auth-callback');\n      return;\n    }\n\n    if (pathname.startsWith('/invite-expired')) {\n      setCurrentPage('invite-expired');\n      return;\n    }\n\n    if (pathname.startsWith('/reset-password')) {\n      setCurrentPage('reset-password');\n      return;\n    }\n\n    //  welcometoken  WelcomePage \n    if (pathname.startsWith('/welcome') || searchParams.get('token')) {\n      setCurrentPage('welcome');\n      return;\n    }\n  }, []);\n\n  // recovery hash\n  React.useEffect(() => {\n    const hash = window.location.hash;\n    if (!hash) return;\n\n    const params = new URLSearchParams(hash.replace('#', ''));\n    if (params.get('type') !== 'recovery') return;\n\n    const access_token = params.get('access_token');\n    const refresh_token = params.get('refresh_token');\n    if (!access_token || !refresh_token) return;\n\n    (async () => {\n      const { data } = await supabase.auth.setSession({\n        access_token,\n        refresh_token,\n      });\n\n      if (data.session?.user) {\n        setRequiresPasswordChange(true);\n        window.history.replaceState({}, document.title, window.location.pathname);\n        setCurrentPage('reset-password');\n      }\n    })();\n  }, []);\n\n  // \n  React.useEffect(() => {\n    if (user && userProfile && !requiresPasswordChange) {\n      if (!userProfile.terms_accepted && !termsAcceptedLocally) {\n        setShowConsentModal(true);\n      } else {\n        setShowConsentModal(false);\n      }\n    } else {\n      setShowConsentModal(false);\n    }\n  }, [user, userProfile, requiresPasswordChange, termsAcceptedLocally]);\n\n  // ---  ---\n\n  if (currentPage === 'auth-callback') {\n    return (\n      <AuthCallbackPage\n        onDone={() => {\n          setCurrentPage('app');\n          window.history.replaceState({}, '', '/');\n        }}\n      />\n    );\n  }\n\n  //  \n  const MAINTENANCE_MODE =\n    String(import.meta.env.VITE_MAINTENANCE_MODE || \"false\") === \"true\";\n\n  // auth/callback return\n  const pathnameNow = window.location.pathname;\n  const isAuthCallback = pathnameNow.startsWith(\"/auth/callback\");\n\n  if (MAINTENANCE_MODE && !isAuthCallback) {\n    return (\n      <MaintenancePage\n        etaText=\"\"\n      />\n    );\n  }\n\n\n\n  if (currentPage === 'invite-expired') {\n    return <InviteExpired />;\n  }\n\n  //  Welcometoken  WelcomePage \n  if (currentPage === 'welcome') {\n    return (\n      <WelcomePage\n        onContinue={() => {\n          setCurrentPage('app');\n          window.history.replaceState({}, '', '/');\n        }}\n      />\n    );\n  }\n\n  if (!user) return <LoginForm onLogin={signIn} />;\n\n  return (\n    <ProfileGate\n      loading={authLoading || (!!user && !userProfile)}\n      ready={!!user && !!userProfile}\n      onRetry={refreshUserProfile}\n    >\n      {(() => {\n        //  \n        if (!userProfile) return null;\n  \n        if (requiresPasswordChange) {\n          return (\n            <PasswordChangeForm\n              onPasswordChange={async (password) => {\n                await changePassword(password);\n                setRequiresPasswordChange(false);\n                window.history.replaceState({}, \"\", \"/\");\n              }}\n              userName={userProfile.name}\n            />\n          );\n        }\n  \n        if (showConsentModal) {\n          return (\n            <ConsentModal\n              onAccept={async () => {\n                await acceptTerms();\n                setTermsAcceptedLocally(true);\n                setShowConsentModal(false);\n              }}\n              onDecline={signOut}\n            />\n          );\n        }\n  \n        const hasHighPriorityAlerts = getAlertsByPriority(\"high\").length > 0;\n  \n        const handleLogout = async (e: React.MouseEvent<HTMLButtonElement>) => {\n          e.preventDefault();\n          await signOut();\n          setCurrentPage(\"app\");\n          window.history.replaceState({}, \"\", \"/\");\n        };\n  \n        return (\n          <TutorialProvider userId={userProfile.id} role={effectiveRole}>\n            <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors\">\n              <GlobalHeader\n                effectiveRole={effectiveRole}\n                userProfile={{\n                  id: userProfile.id,\n                  name: userProfile.name,\n                  email: userProfile.email,\n                }}\n                alertsLoading={alertsLoading}\n                unreadCount={unreadCount}\n                hasHighPriorityAlerts={hasHighPriorityAlerts}\n                onOpenAlertPanel={() => setShowAlertPanel(true)}\n                onLogout={handleLogout}\n                onHome={() => {\n                  console.log(\" Bekuta logo clicked\");\n                  setCurrentPage(\"app\");\n                  setDashboardMode(\"staff\");\n                  setShowAlertPanel(false);\n                }}\n                onNavigateToPrivacy={() => setCurrentPage(\"privacy\")}\n                onNavigateToTerms={() => setCurrentPage(\"terms\")}\n                onNavigateToCommercial={() => setCurrentPage(\"commercial\")}\n                onNavigateToHelp={() => setCurrentPage(\"help\")}\n              />\n  \n              {/* Main Content */}\n              <div className=\"relative\">\n                <BadgeModalController userId={userProfile.id} />\n  \n                {effectiveRole === \"athlete\" ? (\n                  <AthleteView\n                    user={userProfile}\n                    alerts={alerts}\n                    onLogout={signOut}\n                    onUserUpdated={refreshUserProfile}\n                    onHome={() => {\n                      console.log(\" Athlete Bekuta home tapped\");\n                      window.location.assign(\"https://bekuta.netlify.app/\");\n                    }}\n                    onNavigateToPrivacy={() => setCurrentPage(\"privacy\")}\n                    onNavigateToTerms={() => setCurrentPage(\"terms\")}\n                    onNavigateToCommercial={() => setCurrentPage(\"commercial\")}\n                    onNavigateToHelp={() => setCurrentPage(\"help\")}\n                  />\n                ) : isGlobalAdmin(effectiveRole) ? (\n                  <AdminView\n                    user={userProfile}\n                    alerts={alerts}\n                    onNavigateToPrivacy={() => setCurrentPage(\"privacy\")}\n                    onNavigateToTerms={() => setCurrentPage(\"terms\")}\n                    onNavigateToCommercial={() => setCurrentPage(\"commercial\")}\n                    onNavigateToHelp={() => setCurrentPage(\"help\")}\n                  />\n                ) : (\n                  <>\n                    {isOrganizationAdmin() && (\n                      <div className=\"bg-white dark:bg-gray-800 border-b dark:border-gray-700 transition-colors sticky top-0 z-30\">\n                        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2\">\n                          <div className=\"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1 max-w-md\">\n                            <button\n                              type=\"button\"\n                              onClick={() => setDashboardMode(\"staff\")}\n                              className={`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 ${\n                                dashboardMode === \"staff\"\n                                  ? \"bg-white dark:bg-gray-600 text-green-600 dark:text-green-400 shadow-sm\"\n                                  : \"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white\"\n                              }`}\n                            >\n                              <Users className=\"w-4 h-4\" />\n                              <span></span>\n                            </button>\n  \n                            <button\n                              type=\"button\"\n                              onClick={() => setDashboardMode(\"org-admin\")}\n                              className={`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 ${\n                                dashboardMode === \"org-admin\"\n                                  ? \"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm\"\n                                  : \"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white\"\n                              }`}\n                            >\n                              <Building2 className=\"w-4 h-4\" />\n                              <span></span>\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n  \n                    {dashboardMode === \"staff\" ? (\n                      <StaffView\n                        user={userProfile}\n                        alerts={alerts}\n                        onNavigateToPrivacy={() => setCurrentPage(\"privacy\")}\n                        onNavigateToTerms={() => setCurrentPage(\"terms\")}\n                        onNavigateToCommercial={() => setCurrentPage(\"commercial\")}\n                        onNavigateToHelp={() => setCurrentPage(\"help\")}\n                      />\n                    ) : (\n                      getOrganizationAdminRoles().length > 0 && (\n                        <Suspense\n                          fallback={\n                            <div className=\"flex items-center justify-center min-h-screen\">\n                              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n                            </div>\n                          }\n                        >\n                          <OrganizationAdminView\n                            user={userProfile}\n                            alerts={alerts}\n                            organizationId={getOrganizationAdminRoles()[0].organizationId}\n                            organizationName={getOrganizationAdminRoles()[0].organizationName}\n                            onNavigateToPrivacy={() => setCurrentPage(\"privacy\")}\n                            onNavigateToTerms={() => setCurrentPage(\"terms\")}\n                            onNavigateToCommercial={() => setCurrentPage(\"commercial\")}\n                            onNavigateToHelp={() => setCurrentPage(\"help\")}\n                          />\n                        </Suspense>\n                      )\n                    )}\n                  </>\n                )}\n              </div>\n  \n              {/* Alert Panel */}\n              {showAlertPanel && !alertsLoading && (\n                <Suspense\n                  fallback={\n                    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n                      <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-white\" />\n                    </div>\n                  }\n                >\n                  <AlertPanel\n                    alerts={alerts}\n                    onMarkAsRead={markAsRead}\n                    onDismiss={dismissAlert}\n                    onMarkAllAsRead={markAllAsRead}\n                    onClose={() => setShowAlertPanel(false)}\n                    userRole={effectiveRole}\n                  />\n                </Suspense>\n              )}\n  \n              {userProfile && <TeamAchievementNotification userId={userProfile.id} />}\n  \n              <ToastContainer toasts={toasts} onClose={removeToast} />\n  \n              <Footer\n                onNavigateToPrivacy={() => setCurrentPage(\"privacy\")}\n                onNavigateToTerms={() => setCurrentPage(\"terms\")}\n                onNavigateToCommercial={() => setCurrentPage(\"commercial\")}\n              />\n            </div>\n          </TutorialProvider>\n        );\n      })()}\n    </ProfileGate>\n  );\n}\nexport default App;","import { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\n\ninterface OrganizationRole {\n  organizationId: string;\n  organizationName: string;\n  role: 'organization_admin' | 'member';\n}\n\nexport function useOrganizationRole(userId: string | undefined) {\n  const [organizationRoles, setOrganizationRoles] = useState<OrganizationRole[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!userId) {\n      setLoading(false);\n      return;\n    }\n\n    loadOrganizationRoles();\n  }, [userId]);\n\n  const loadOrganizationRoles = async () => {\n    if (!userId) return;\n\n    try {\n      setLoading(true);\n      setError(null);\n\n      const { data, error: queryError } = await supabase\n        .from('organization_members')\n        .select(`\n          organization_id,\n          role,\n          organizations (\n            id,\n            name\n          )\n        `)\n        .eq('user_id', userId);\n\n      if (queryError) throw queryError;\n\n      const roles: OrganizationRole[] = (data || []).map((item: any) => ({\n        organizationId: item.organization_id,\n        organizationName: item.organizations?.name || 'Unknown',\n        role: item.role\n      }));\n\n      setOrganizationRoles(roles);\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to load organization roles';\n      setError(message);\n      console.error('Error loading organization roles:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isOrganizationAdmin = (organizationId?: string) => {\n    if (!organizationId) {\n      return organizationRoles.some(role => role.role === 'organization_admin');\n    }\n    return organizationRoles.some(\n      role => role.organizationId === organizationId && role.role === 'organization_admin'\n    );\n  };\n\n  const getOrganizationAdminRoles = () => {\n    return organizationRoles.filter(role => role.role === 'organization_admin');\n  };\n\n  return {\n    organizationRoles,\n    loading,\n    error,\n    isOrganizationAdmin,\n    getOrganizationAdminRoles,\n    reload: loadOrganizationRoles\n  };\n}\n","import { useState, useCallback } from 'react';\n\nexport interface Toast {\n  id: string;\n  message: string;\n  type?: 'success' | 'error' | 'info';\n  duration?: number;\n}\n\nexport function useToast() {\n  const [toasts, setToasts] = useState<Toast[]>([]);\n\n  const showToast = useCallback((message: string, type: 'success' | 'error' | 'info' = 'success', duration = 3000) => {\n    const id = `toast-${Date.now()}-${Math.random()}`;\n    const newToast: Toast = { id, message, type, duration };\n\n    setToasts((prev) => [...prev, newToast]);\n  }, []);\n\n  const removeToast = useCallback((id: string) => {\n    setToasts((prev) => prev.filter((toast) => toast.id !== id));\n  }, []);\n\n  const success = useCallback((message: string, duration?: number) => {\n    showToast(message, 'success', duration);\n  }, [showToast]);\n\n  const error = useCallback((message: string, duration?: number) => {\n    showToast(message, 'error', duration);\n  }, [showToast]);\n\n  const info = useCallback((message: string, duration?: number) => {\n    showToast(message, 'info', duration);\n  }, [showToast]);\n\n  return {\n    toasts,\n    showToast,\n    removeToast,\n    success,\n    error,\n    info,\n  };\n}\n","// src/main.tsx\nimport { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App.tsx';\nimport './index.css';\n\n//  RealtimeHubProvider  import\nimport { RealtimeHubProvider } from './hooks/useRealtimeHub';\n\nconsole.log(' main.tsx is executing');\nconsole.log(' Current URL:', window.location.href);\nconsole.log(' Checking for root element...');\n\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n  console.error(' Root element not found!');\n  document.body.innerHTML =\n    '<div style=\"padding: 40px; font-family: sans-serif;\"><h1>Error: Root element not found</h1><p>The #root div is missing from index.html</p></div>';\n  throw new Error('Root element not found');\n}\n\nconsole.log(' Root element found, creating React root...');\n\ntry {\n  const root = createRoot(rootElement);\n  console.log(' React root created, rendering App...');\n\n  root.render(\n    <StrictMode>\n      {/*  App  Provider  */}\n      <RealtimeHubProvider>\n        <App />\n      </RealtimeHubProvider>\n    </StrictMode>\n  );\n\n  console.log(' App render initiated successfully');\n} catch (error) {\n  console.error(' Error during React initialization:', error);\n  document.body.innerHTML = `<div style=\"padding: 40px; font-family: sans-serif;\">\n    <h1>React Initialization Error</h1>\n    <pre>${error}</pre>\n  </div>`;\n}"],"file":"assets/index-DC548egD.js"}